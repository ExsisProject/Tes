/*! 
 * go-gadget - v1.5.0 
 * 그룹 오피스 가젯 프레임워크
 * 
 * Date: 2014-04-18 

 */ 
!function(a,b,c){b.GO||(b.GO={});var d=b.GO,e={};e.namespace=function(a,c){for(var d=a.split("."),c="undefined"==typeof c?!0:!1,e=b,f=0,g=d.length;g>f;f++){if("undefined"==typeof e[d[f]]){if(!c)throw new Error("해당 모듈이 존재하지 않습니다.");e[d[f]]={}}e=e[d[f]]}return e},e.isString=function(a){return"string"==typeof a||a instanceof String},e.require=function(a){e.namespace(a,!1)},e.extend=function(b,c){var d=function(){},e=function(){this._init.apply(this,arguments)};return b.prototype._init||(b.prototype._init=function(){}),d.prototype=a.extend(!0,{},b.prototype,c),e.prototype=new d,e.fn=e.prototype,e.fn.parent=e,e._super=e.__proto__,e},e.parseUrl=function(a){var d=b.location,e=c.createElement("a"),f={};return e.setAttribute("href",a),f={protocol:/^(http|https)/.test(e.protocol)?e.protocol:d.protocol,host:e.host?e.host:d.host,hostname:e.hostname?e.hostname:d.hostname,port:e.port?e.port:d.port,pathname:"/"===e.pathname[0]?e.pathname:"/"+e.pathname,search:e.search?e.search:"",href:e.href,hash:e.hash?e.hash:d.hash}},e.fixUrl=function(a,b){var c=e.parseUrl(a),d=b||"/",f=c.pathname,g="/"===f[0]?f.slice(1):f;return d&&0!==f.indexOf(d)&&(f=d+g),[f,c.search,c.hash].join("")},e.serializeForm=function(b,c){c=c||!1;var d=a(b).serializeArray(),e={};return a.each(d,function(a,b){var d=c?encodeURIComponent(b.value):b.value;b.name in e?(e[b.name]instanceof Array||(e[b.name]=[e[b.name]]),e[b.name].push(d)):e[b.name]=d}),e},e.namespace("GO.gadget"),d.gadget.dom={select:function(b){for(var c=a("<select />").attr("name",b.name),d=b.value.split("|"),e=b.labels?b.labels.split("|"):d,f=(b.defaultValue,[]),g=0,h=d.length;h>g;g++){var i=d[g],j=a('<option value="'+d[g]+'">'+e[g]+"</option>");b.defaultValue===i&&j.prop("selected",!0),f.push(j)}return c.append(f)},checkbox:function(b){var c=a('<input type="checkbox"/>'),d="gadget-opt-cb-"+b.name+"-"+b.value;return c.prop("id",d).prop("name",b.name).prop("checked",b.checked||!1).val(b.value),c},text:function(b){return a("<input />").attr("type","text").attr("name",b.name).val(b.value||"")},textarea:function(b){return a("<textarea>").attr("name",b.name).val(b.value||"")},parse:function(a){return this[a.type].call(this,a)}},e.namespace("GO.gadget"),d.gadget.i18n=function(){function b(a,b){this.locale=b,this.langs=c(a,b)}function c(b,c){var d={};return a.each(b,function(a,b){e.isString(b)&&(d[a]=b)}),c&&a.extend(d,b[c]||{}),d}return b.prototype={parse:function(a,c){c=c||{};var d=this.langs[a];return d&&(d=b.parse(d,c)),d}},b.parse=function(a,b){var c;return c=a.replace(/\{\{([\s\S]+?\}?)\}\}/g,function(a,c){return b[c]||""})},b}(),e.namespace("GO.gadget"),d.gadget.ContentProvider=function(){function b(){this.extProps.options.hasOwnProperty("editable")||delete this.options.editable,this.extProps.options.hasOwnProperty("removable")||delete this.options.removable,this.extProps.options.hasOwnProperty("highlight")||delete this.options.highlight}function f(a,b){return console.warn("[:::Gadget errors:::] : Caused by..."),console.log(b.stack?b.stack:b.message),this.extProps.onError(a,b)}function g(a,b){a.styleSheet?a.styleSheet.cssText+=b:a.appendChild(c.createTextNode(b))}function h(){var b,c=[this.langs.refresh.none,d.gadget.i18n.parse(this.langs.refresh.unit_minute,{time:1}),d.gadget.i18n.parse(this.langs.refresh.unit_minute,{time:5}),d.gadget.i18n.parse(this.langs.refresh.unit_minute,{time:10}),d.gadget.i18n.parse(this.langs.refresh.unit_minute,{time:15}),d.gadget.i18n.parse(this.langs.refresh.unit_minute,{time:30}),d.gadget.i18n.parse(this.langs.refresh.unit_hour,{time:1}),d.gadget.i18n.parse(this.langs.refresh.unit_hour,{time:2})];return b=a(l(this.langs.refresh.label)).find("li:first").append(d.gadget.dom.select({name:"refresh",value:"-1|1|5|10|15|30|60|120",labels:c.join("|"),defaultValue:"-1"})).end()}function i(){var b=a(l(this.langs.personalize.label)),c=d.gadget.dom.checkbox({name:"editable",value:"Y",checked:this.options.editable||!1}),e=d.gadget.dom.checkbox({name:"removable",value:"Y",checked:this.options.removable||!1});return b.find("li:first").append(k(c,this.langs.personalize.editable)).append(k(e,this.langs.personalize.removable)),b}function j(){var b=a(l(this.langs.highlight.label)),c=d.gadget.dom.checkbox({name:"highlight",value:"Y",checked:this.options.highlight||!1});return b.find("li:first").append(k(c,this.langs.highlight.highlight)),b}function k(b,c){var d=a('<span class="wrap_option wrap_label"></span>');return d.append(b,'<label for="'+b.attr("id")+'">'+c+"</label>"),d}function l(a){var b=[];return b.push('<ul class="static_style">'),b.push("<li>"),b.push('<p class="title">'+a+"</p>"),b.push("</li>"),b.push("</ul>"),b.join("\n")}function m(a){var b=[];return b.push('<ul class="type_simple_list">'),b.push('<li class="null_data">'),b.push('<span class="ic_data_type ic_error_page"></span>'),b.push('<p class="desc">'+a+"</p>"),b.push("</li>"),b.push("</ul>"),b.join("\n")}function n(){var a=[];return a.push('<div class="gadget_design_wrap">'),a.push('<div class="go_gadget_header">'),a.push('<div class="gadget_h1">'),a.push('<span class="title">'+this.getTitle()+"</span>"),a.push("</div>"),a.push("</div>"),a.push('<ul class="type_simple_list">'),a.push('<li class="null_data">'),a.push('<span class="ic_data_type ic_error_page"></span>'),a.push('<p class="desc">'+this.langs.msg.load_error+"</p>"),a.push("</li>"),a.push("</ul>"),a.push("</div>"),a.join("\n")}e.require("GO.gadget.i18n"),e.require("GO.gadget.dom");var o=function(b,c,e){var f=this,e=e||{};if(!c)throw new Error("gadget spec data error");this.el=b,this.$el=a(this.el),this.locale=e.locale||"ko",this.contextRoot=e.contextRoot||"/",this.methodType=e.methodType||"create",this.spec={id:c.id,name:c.name||"Title",version:c.version||"1.0",description:c.description||"",author:c.author||""},this.pageTemplate={empty:m,loadError:function(){return n.call(f)}},this.canPersonalize=e.canPersonalize||!1,this.langs=a.extend(!0,{refresh:{label:"새로고침",none:"안함",unit_minute:"{{time}}분",unit_hour:"{{time}}시간"},personalize:{label:"개인화",editable:"편집 가능",removable:"삭제 가능"},highlight:{label:"가젯 테두리",highlight:"강조"},msg:{load_error:"요청하신 내용을 불러오지 못했습니다.<br />오류가 지속될 경우, 운영자에게 문의해 주십시오."}},e.langs||{}),this.options={},this.extProps={url:"",refreshable:!1,highlightable:!1,events:{},styles:{},langs:{},options:{},defaultOptions:{refresh:-1},setTitle:function(){return f.spec.name},validate:function(){return!1},renderConfig:function(){},onSuccess:function(){},onMoved:function(){},onError:function(){f.getContentContainer().empty().append(n.call(f))}},this.dom=d.gadget.dom,this.editorRunner={},this.reqParams={}};return o.prototype={load:function(b){var c=Array.prototype.slice.call(arguments),f=c.length,g={};if(e.isString(b)){var g=f>1?c[f-1]:{};f>2&&a.isPlainObject(c[1])&&a.extend(!0,this.reqParams,c[1]),a.extend(g,{url:b})}else a.isPlainObject(b)&&(g=b);a.extend(!0,this.extProps,g),"create"===this.methodType&&a.extend(!0,this.options,this.extProps.defaultOptions),this.extProps.spec=this.spec,this.extProps.contextRoot=this.contextRoot,this.extProps.locale=this.locale,this.extProps.i18n=new d.gadget.i18n(this.extProps.langs,this.locale),this.extProps.dom=d.gadget.dom,this.extProps.template=function(a,b,c){var d=Hogan.compile(a);return d.render(b||{},c||{})},this.extProps.pageTemplate=this.pageTemplate,this.extProps.requestContent=this.requestContent,a.extend(!0,this.extProps.options,this.options),this.init()},init:function(){this.delegateEvents(),this.loadStyle(),this.render(),this.setRefresh()},setRefresh:function(){if(this.extProps.refreshable){var b=(this.getOptionForm(),+this.options.refresh);this.intervalId&&clearInterval(this.intervalId),b>0&&(this.intervalId=setInterval(a.proxy(function(){this.$el.trigger("gadget:request-content")},this),60*b*1e3))}},loadEditor:function(){this.$el.find("[data-role=editable]").each(a.proxy(function(b,c){a(c).data("initstatus")||(this.editorRunner.load(c),a(c).data("initstatus",!0))},this))},getOptionForm:function(){return this.$el.find(".gadget-options-form")},getContentContainer:function(){return this.$el.find(".go-gadget-content")},setLangs:function(b){a.extend(!0,this.langs,b)},setOption:function(b){if(a.isPlainObject(b))a.extend(!0,this.options,b);else{var c=Array.prototype.slice.call(arguments,1);this.options[b]=c[0]}a.extend(!0,this.extProps.options,this.options)},setGadgetOptions:function(c){this.extProps.options=c||{},b.call(this),a.extend(!0,this.options,this.extProps.options)},setEditorRunner:function(b){a.extend(!0,this.editorRunner,b)},getEditorRunner:function(){return this.editorRunner},getEditorData:function(){var b={};return this.$el.find("textarea[data-role=editable]").each(a.proxy(function(c,d){var e=a(d).attr("name"),f=this.getEditorRunner().getData(d);a.isPlainObject(f)?a.extend(b,f):b[e]=f},this)),b},getOption:function(a){return"undefined"==typeof a?this.options:this.options[a]||""},loadStyle:function(){var b="go-gadget-style-"+this.spec.id;if(this.$el.addClass("go-gadget-"+this.spec.id),!(a.isEmptyObject(this.extProps.styles)||a("#"+b).length>0)){var d=".go-gadget-"+this.spec.id+" .go-gadget-content",e=c.getElementsByTagName("head")[0],f=c.createElement("style");f.type="text/css",f.setAttribute("id",b),e.appendChild(f),a.each(this.extProps.styles,function(a,b){g(f,d+" "+a+" {"+b+"}")})}},render:function(){this.setTitle()},setTitle:function(){},getTitle:function(){return this.extProps.setTitle()},isRefreshable:function(){return!!this.extProps.refreshable},isHighlightable:function(){return!!this.extProps.highlightable},renderConfig:function(){var a=this.getOptionForm();a.html("");try{this.extProps.renderConfig(a.get(0))}catch(b){f.call(this,a.get(0),b)}this.isRefreshable()&&(a.prepend(h.call(this)),a.find("select[name=refresh]").val(this.options.refresh||"-1")),this.canPersonalize&&a.append(i.call(this)),this.isHighlightable()&&a.append(j.call(this))},reloadConfig:function(){this.renderConfig(),this.setRefresh()},renderContent:function(a,b){try{this.extProps.onSuccess(a,b)}catch(c){f.call(this,a,c)}},renderError:function(a,b){self.extProps.onError(a,b)},afterMoved:function(){return this.extProps.onMoved(this.getContentContainer().get(0))},serializeForm:function(){var b=e.serializeForm(this.$el.find(".gadget-options-form"));return a.extend(!0,b,this.getEditorData()),b},validateForm:function(a){return this.extProps.validate(this.$el.find(".gadget-options-form").get(0),a)},requestContent:function(){var b,c=a.Deferred(),d=this.extProps,e=this.getContentContainer().get(0);if(b="function"==typeof d.url?d.url.call(d):d.url){var f={type:"GET",statusCode:{401:function(){}},beforeSend:function(){c.notifyWith(this,[e])}};a.ajax(b,f).done(function(a){c.resolveWith(this,[e,a])}).fail(function(a,b){c.rejectWith(this,[e,b])})}else c.notifyWith(this,[e]),c.resolveWith(this,[e,{}]);return c},delegateEvents:function(){var b=this.extProps,c=this.getContentContainer();a.each(this.extProps.events,function(d,f){var g=[],h=f;if(e.isString(h)&&(h=b[h]),d.search(/\s+/)>0){var i=d.search(/\s+/),j=d.slice(0,i),k=d.slice(i+1);g.push(j,k)}else g.push(d);g.push(a.proxy(h||function(){},b)),a.fn.on.apply(c,g)})}},o}()}(jQuery,window,document);