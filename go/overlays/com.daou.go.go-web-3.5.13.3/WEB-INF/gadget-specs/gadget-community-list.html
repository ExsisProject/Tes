<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="utf-8">
    <title>가입 커뮤니티 바로가기</title>
    <meta name = "gadget:name-ko" content="가입 커뮤니티 바로가기" />
    <meta name = "gadget:name-en" content="Communities" />
    <meta name = "gadget:name-ja" content="参加コミュニティへ" />
    <meta name = "gadget:name-zhcn" content="加入社区" />
    <meta name = "gadget:name-zhtw" content="加入社區" />
    <meta name = "gadget:name-vi" content="Phím tắt gia nhập Community" />
    <meta name = "gadget:description" content="가입 커뮤니티" />
    <meta name = "gadget:version" content="1.5.0" />
    <meta name = "gadget:app-dependency" content="COMMUNITY" />
    <meta name = "gadget:thumbnail" content="gadget_community.png" />
    
    <meta name = "locale" content="ko" />
    <meta name = "contextRoot" content="/" />
    <link rel="stylesheet" href="css/go-gadget-standalone.css" media="screen, print" />
    <!--[if IE]>
    <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <script type="text/javascript" src="js/go-gadget-standalone.js"></script>

    <script type="text/javascript">
    $.ajaxMock.register('/api/community/list/menu', {
        responseText:$.parseJSON('{"data":[{"id":7,"createdAt":"2013-05-29T17:05:57","updatedAt":"2013-05-29T17:05:57","name":"가입진행중","description":"","status":"ONLINE","publicFlag":true,"memberCount":1,"masterUser":"진범동2","masterPosition":"부장","newCommunity":true,"memberStatus":"WAIT","memberType":"USER","postCount":0,"newPostCount":0},{"id":5,"createdAt":"2013-05-29T17:04:09","updatedAt":"2013-05-29T17:04:09","name":"비공개커뮤니티","description":"","status":"WAIT","publicFlag":false,"memberCount":1,"masterUser":"진범동1","masterPosition":"부회장","newCommunity":true,"memberStatus":"ONLINE","memberType":"MASTER","postCount":0,"newPostCount":0},{"id":4,"createdAt":"2013-05-29T17:04:01","updatedAt":"2013-05-29T17:15:07","name":"공개커뮤니티","description":"","status":"ONLINE","publicFlag":true,"memberCount":1,"masterUser":"진범동1","masterPosition":"부회장","newCommunity":true,"memberStatus":"ONLINE","memberType":"MASTER","postCount":1,"newPostCount":1,"newPostDate":"2013-05-2917:15:06.961"}],"page":{"page":0,"offset":20,"total":3,"sort":[{"direction":"DESC","property":"createdAt","ascending":false}],"lastPage":true},"message":"OK","code":"200","__go_checksum__":true}'),
        statusCode: 200,
        status:'OK',
        type: 'GET'
    });
    </script>

    <script type="text/javascript" id="go-gadget-script">	    
	    gadget.load({
	    	
	    	highlightable : true,
	    	
	        refreshable: true, 
	        
	        langs: {
	            "gadget_title": "가입 커뮤니티 바로가기",
	            "refresh": "새로고침 간격",
	            "member_wait": "가입대기",
	            "community_wait": "생성대기",
	            "empty" : "가입된 커뮤니티가 없습니다.",
	            "none" : "안함",
	            "min" : "분",
	            "hour" : "시간",
	            "not_wait" : "아직 개설되지 않았습니다.", 
	            "not_create" : "관리자의 승인이 필요합니다.",
	            "not_join" : "아직 가입되지 않았습니다.", 
	            "not_accept" : "커뮤니티 관리자의 승인이 필요합니다.",
	            
	            "en": {
	                "gadget_title" : "Communities",
	                "refresh" : "Refresh Interval",
	                "member_wait" : "Waiting for Approval",
	                "community_wait" : "Waiting",
	                "empty" : "You have joined no community.",
	                "none" : "None",
	                "min" : "min",
	                "hour" : "hour",
	                "not_wait" : "This board has not been active yet.",
	                "not_create" : "You need an approval from the community administrator.",
	                "not_join" : "You have not joined yet.",
	                "not_accept" : "You need an approval from the community administrator."
	            },
	            
	            "ja": {
	                "gadget_title" : "参加コミュニティへ",
	                "refresh" : "更新間隔",
	                "member_wait" : "参加待ち",
	                "community_wait" : "開設待ち",
	                "empty" : "参加しているコミュニティがありません。",
	                "none" : "更新しない",
	                "min" : "分",
	                "hour" : "時間",
	                "not_wait" : "まだ、作成（開設）されていません。",
	                "not_create" : "管理者の承認が必要です。",
	                "not_join" : "まだ、参加されていません。",
	                "not_accept" : "コミュニティ管理者の承認が必要です。"
	            },
	            
	            "zh_CN": {
	                "gadget_title" : "加入社区",
	                "refresh" : "更新间隔",
	                "member_wait" : "等待加入",
	                "community_wait" : "等待生成",
	                "empty" : "没有已被加入的社区。",
	                "none" : "不",
	                "min" : "分",
	                "hour" : "时间",
	                "not_wait" : "尚未创建。",
	                "not_create" : "需要管理员的批准。",
	                "not_join" : "尚未加入。",
	                "not_accept" : "需要社区管理员的批准。"
	            },
	            
	            "zh_TW": {
	                "gadget_title" : "加入社區",
	                "refresh" : "更新間隔",
	                "member_wait" : "等待加入",
	                "community_wait" : "等待生成",
	                "empty" : "沒有已被加入的社區。",
	                "none" : "不",
	                "min" : "分",
	                "hour" : "時間",
	                "not_wait" : "尚未創建。",
	                "not_create" : "需要管理員的批准。",
	                "not_join" : "尚未加入。",
	                "not_accept" : "需要社區管理員的批准。"
	            },
	            "vi": {
	            	"gadget_title": "Phím tắt gia nhập Community",
		            "refresh": "Khoảng cách làm mới dữ liệu",
		            "member_wait": "Chờ gia nhập",
		            "community_wait": "Chờ tạo",
		            "empty" : "Không có đăng ký trao đổi tập thể.",
		            "none" : "Không",
		            "min" : "Phút",
		            "hour" : "Thời gian",
		            "not_wait" : "Chưa được tạo.",
		            "not_create" : "Cần phê duyệt của người điều hành.",
		            "not_join" : "Chưa gia nhập.",
		            "not_accept" : "Cần phê duyệt của người điều hành Community."
	            }
	        }, 
	        
	        events: {
                "click li.community": "goCommunity"
            },
            
            url: function() {
                return this.contextRoot + "api/community/list/menu";
            }, 
            
            goCommunity : function(e) {   	
            	
            	var currentTarget = $(e.currentTarget),	
	            	communityId = currentTarget.attr('data-id'),
	    			status = currentTarget.attr('data-status'),
	    			publicFlag = currentTarget.attr('data-publicFlag');
	    			memberStatus = currentTarget.attr('data-memberStatus');
            	
    			if(status == 'WAIT') {	
    				$.goAlert(this.i18n.parse("not_wait"), this.i18n.parse("not_create"));		
    			} else {
    				if(publicFlag == 'false' && memberStatus != 'ONLINE') { //공개
    					$.goAlert(this.i18n.parse("not_join"), this.i18n.parse("not_accept"));
    				} else {
    					GO.router.navigate("community/"+communityId, true);
    				}
    			}
            },
	
	        setTitle: function() {
	            return this.getTitle();
	        }, 
	        
	        getTitle: function() {
	        	return this.i18n.parse("gadget_title");
	        }, 
	
	        onSuccess: function(el, resp) {
	            var dataset = resp.data;
	            _.map(dataset, function(item) {
	                item.createdAt = moment(item.createdAt).format("YYYY-MM-DD HH:mm");
	                item.device = (item.clientType == "BROWSER") ? "PC" : "Mobile"
	            });
	            
	            $(el).append(this.template(this.makeTemplate(), {
	            	
	                "dataset": dataset,	            
	                
	                isNewDate : function() {
	                	if(this.newPostCount > 0)
	                		return true;
	                	else {
	                		return false;
	                	}
	                },	                
	                isMemberWait : function() {
	                	if(this.memberStatus == 'WAIT')
	                		return true;
	                	else {
	                		return false;
	                	}
	                },
	                isCommunityWait : function() {
	                	if(this.status == "WAIT") {
							return true;
						} else {
							return false;
						}
	                }
	            }));
	        }, 
	
	        makeTemplate: function() {
	            var html = [];
            	html.push('<div class="gadget_design_wrap">');
	            
	            html.push('<div class="go_gadget_header">')
	            html.push('    <div class="gadget_h1">');
	            html.push('        <span class="type"><span class="ic_dashboard2 ic_type_comm" title="' + this.getTitle() + '"></span></span>');
	            html.push('        <span class="title">'+ this.getTitle() +'</span>');
	            html.push('    </div>');
	            html.push('</div>');
	            
	            html.push("<ul class='side_depth'>");
	            html.push("    {{#dataset}}");
	            html.push("    <li class='community' data-id='{{communityId}}' data-status='{{status}}' data-publicFlag='{{publicFlag}}' data-memberStatus='{{memberStatus}}'>");
	            html.push("        <p class='title'>");
	            html.push("        <a><ins class='ic'></ins>{{#isCommunityWait}}<span class='btn_state_disable'><span class='txt'>" + this.i18n.parse("community_wait") + "</span></span>{{/isCommunityWait}}");
	            html.push("        {{#isMemberWait}}<span class='btn_state_disable'><span class='txt'>" + this.i18n.parse("member_wait") + "</span></span>{{/isMemberWait}}{{^publicFlag}}<span class='ic_side ic_private'></span>{{/publicFlag}}<span class='txt' title='{{name}}'>{{name}}</span>");
	            html.push("        </a>");
	            html.push("        {{#isNewDate}}<span class='ic_classic ic_new2'></span>{{/isNewDate}}{{^isCommunityWait}}<span class='num'>{{newPostCount}}/{{postCount}}</span>{{/isCommunityWait}}");
	            html.push("        </p>");
	            html.push("    </li>");
	            html.push("    {{/dataset}}");
	            html.push("    {{^dataset}}");
	            html.push("        <div class='null_data'><p class='desc'>" + this.i18n.parse("empty") + "</p></div>");
	            html.push("    {{/dataset}}");
	            html.push("</ul>");
	            
	            html.push('</div>');
	            return html.join("\n");
	        }
	    });
    </script>
</head>

<body id="main" class="go_skin_home_default" data-role="main">
    <div class="go-dashboard go-dashboard-editing go_dashboard_3_2">
        <div class="go-gadget-column gadget-col-1" data-columnid="1">
            <!-- empty -->
        </div>
        
        <div class="gripper"></div>

        <div id="gadget-containter" class="go-gadget-column gadget-col-2" data-columnid="2">
            <!-- empty -->
        </div>

        <div class="gripper"></div>

        <div class="go-gadget-column gadget-col-3" data-columnid="3">
            <!-- empty -->
        </div>
    </div>
</body>
</html>