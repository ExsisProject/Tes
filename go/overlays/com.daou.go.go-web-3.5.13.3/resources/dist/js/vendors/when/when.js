/** @license MIT License (c) copyright 2011-2013 original author or authors */

/**
 * A lightweight CommonJS Promises/A and when() implementation
 * when is part of the cujo.js family of libraries (http://cujojs.com/)
 *
 * Licensed under the MIT License at:
 * http://www.opensource.org/licenses/mit-license.php
 *
 * @author Brian Cavalier
 * @author John Hann
 * @version 2.7.1
 */

(function(e){e(function(require){function e(e,t,n,i){return r(e).then(t,n,i)}function t(e){return new n(e,B.PromiseStatus&&B.PromiseStatus())}function n(e,t){function o(){return r?r.inspect():N()}function f(e,t,n,s,o){function u(r){r._when(e,t,n,s,o)}i?i.push(u):R(function(){u(r)})}function l(e){if(!i)return;var s=i;i=q,R(function(){r=a(n,e),t&&p(r,t),u(s,r)})}function d(e){l(new c(e))}function v(e){if(i){var t=i;R(function(){u(t,new h(e))})}}var n,r,i=[];n=this,this._status=t,this.inspect=o,this._when=f;try{e(l,d,v)}catch(s){d(s)}}function r(e){return e instanceof n?e:i(e)}function i(e){return t(function(t){t(e)})}function s(t){return e(t,function(e){return new c(e)})}function o(){function s(t,s,o){e.resolve=e.resolver.resolve=function(e){return r?i(e):(r=!0,t(e),n)},e.reject=e.resolver.reject=function(e){return r?i(new c(e)):(r=!0,s(e),n)},e.notify=e.resolver.notify=function(e){return o(e),e}}var e,n,r;return e={promise:q,resolve:q,reject:q,notify:q,resolver:{resolve:q,reject:q,notify:q}},e.promise=n=t(s),e}function u(e,t){for(var n=0;n<e.length;n++)e[n](t)}function a(e,t){if(t===e)return new c(new TypeError);if(t instanceof n)return t;try{var r=t===Object(t)&&t.then;return typeof r=="function"?f(r,t):new l(t)}catch(i){return new c(i)}}function f(e,n){return t(function(t,r){O(e,n,t,r)})}function l(e){this.value=e}function c(e){this.value=e}function h(e){this.value=e}function p(e,t){function n(){t.fulfilled()}function r(e){t.rejected(e)}e.then(n,r)}function d(e){return e&&typeof e.then=="function"}function v(n,r,i,s,o){return e(n,function(n){function u(t,i,s){function d(e){c(e)}function v(e){l(e)}var o,u,a,f,l,c,h,p;h=n.length>>>0,o=Math.max(0,Math.min(r,h)),a=[],u=h-o+1,f=[];if(!o)t(a);else{c=function(e){f.push(e),--u||(l=c=W,i(f))},l=function(e){a.push(e),--o||(l=c=W,t(a))};for(p=0;p<h;++p)p in n&&e(n[p],v,d,s)}}return t(u).then(i,s,o)})}function m(e,t,n,r){function i(e){return t?t(e[0]):e[0]}return v(e,1,i,n,r)}function g(e,t,n,r){return E(e,W).then(t,n,r)}function y(){return E(arguments,W)}function b(e){return E(e,x,T)}function w(e,t){return E(e,t)}function E(t,r,i){return e(t,function(t){function s(n,s,o){function c(t,a){e(t,r,i).then(function(e){u[a]=e,--f||n(u)},s,o)}var u,a,f,l;f=a=t.length>>>0,u=[];if(!f){n(u);return}for(l=0;l<a;l++)l in t?c(t[l],l):--f}return new n(s)})}function S(t,n){var r=O(A,arguments,1);return e(t,function(t){var i;return i=t.length,r[0]=function(t,r,s){return e(t,function(t){return e(r,function(e){return n(t,e,s,i)})})},L.apply(t,r)})}function x(e){return{state:"fulfilled",value:e}}function T(e){return{state:"rejected",reason:e}}function N(){return{state:"pending"}}function R(e){_.push(e)===1&&M(U)}function U(){u(_),_=[]}function W(e){return e}function X(e){throw typeof B.reportUnhandled=="function"?B.reportUnhandled():R(function(){throw e}),e}e.promise=t,e.resolve=i,e.reject=s,e.defer=o,e.join=y,e.all=g,e.map=w,e.reduce=S,e.settle=b,e.any=m,e.some=v,e.isPromise=d,e.isPromiseLike=d,C=n.prototype,C.then=function(e,t,r){var i=this;return new n(function(n,s,o){i._when(n,o,e,t,r)},this._status&&this._status.observed())},C["catch"]=C.otherwise=function(e){return this.then(q,e)},C["finally"]=C.ensure=function(e){function t(){return i(e())}return typeof e=="function"?this.then(t,t).yield(this):this},C.done=function(e,t){this.then(e,t)["catch"](X)},C.yield=function(e){return this.then(function(){return e})},C.tap=function(e){return this.then(e).yield(this)},C.spread=function(e){return this.then(function(t){return g(t,function(t){return e.apply(q,t)})})},C.always=function(e,t){return this.then(e,e,t)},k=Object.create||function(e){function t(){}return t.prototype=e,new t},l.prototype=k(C),l.prototype.inspect=function(){return x(this.value)},l.prototype._when=function(e,t,n){try{e(typeof n=="function"?n(this.value):this.value)}catch(r){e(new c(r))}},c.prototype=k(C),c.prototype.inspect=function(){return T(this.value)},c.prototype._when=function(e,t,n,r){try{e(typeof r=="function"?r(this.value):this)}catch(i){e(new c(i))}},h.prototype=k(C),h.prototype._when=function(e,t,n,r,i){try{t(typeof i=="function"?i(this.value):this.value)}catch(s){t(s)}};var C,k,L,A,O,M,_,D,P,H,B,j,F,I,q;F=require,_=[],B=typeof console!="undefined"?console:e;if(typeof process=="object"&&process.nextTick)M=process.nextTick;else if(I=typeof MutationObserver=="function"&&MutationObserver||typeof WebKitMutationObserver=="function"&&WebKitMutationObserver)M=function(e,t,n){var r=e.createElement("div");return(new t(n)).observe(r,{attributes:!0}),function(){r.setAttribute("x","x")}}(document,I,U);else try{M=F("vertx").runOnLoop||F("vertx").runOnContext}catch(z){j=setTimeout,M=function(e){j(e,0)}}return D=Function.prototype,P=D.call,O=D.bind?P.bind(P):function(e,t){return e.apply(t,A.call(arguments,2))},H=[],A=H.slice,L=H.reduce||function(e){var t,n,r,i,s;s=0,t=Object(this),i=t.length>>>0,n=arguments;if(n.length<=1)for(;;){if(s in t){r=t[s++];break}if(++s>=i)throw new TypeError}else r=n[1];for(;s<i;++s)s in t&&(r=e(r,t[s],s,t));return r},e})})(typeof define=="function"&&define.amd?define:function(e){module.exports=e(require)});