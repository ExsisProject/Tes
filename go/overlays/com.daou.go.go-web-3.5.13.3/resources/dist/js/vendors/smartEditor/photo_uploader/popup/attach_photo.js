function checkDragAndDropAPI(){try{oNavigator.ie?bSupportDragAndDropAPI=!1:!!oNavigator.safari&&oNavigator.version<=5?bSupportDragAndDropAPI=!1:bSupportDragAndDropAPI=!0}catch(e){bSupportDragAndDropAPI=!1}}function goStartMode(){fnUploadImage.attach(welBtnConfirm.$value(),"click")}function goReadyMode(){fnUploadImage.detach(welBtnConfirm.$value(),"click")}function generalUpload(){oFileUploader.upload()}function readyModeBG(){var e=welTextGuide.className();e.indexOf("nobg")>=0&&(welTextGuide.removeClass("nobg"),welTextGuide.className("bg"))}function startModeBG(){var e=welTextGuide.className();e.indexOf("nobg")<0&&(welTextGuide.removeClass("bg"),welTextGuide.className("nobg"))}function updateViewCount(e,t){var n=e+t;return elCountTxtTxt.innerHTML=n+"\uc7a5",nImageFileCount=n,n}function updateViewTotalSize(){var e=Number(parseInt(nTotalSize||0,10)/1048576);elTotalSizeTxt.innerHTML=e.toFixed(2)+"MB"}function refreshTotalImageSize(e){var t=htImageInfo[e].size;nTotalSize-t>-1&&(nTotalSize-=t)}function removeImageInfo(e){htImageInfo[e]=null}function setUnitString(e){var t,n;return e<0&&(e=0),e<1024?(t=Number(e),n="B",t+n):e>1048576?(t=Number(parseInt(e||0,10)/1048576),n="MB",t.toFixed(2)+n):(t=Number(parseInt(e||0,10)/1024),n="KB",t.toFixed(0)+n)}function cuttingNameByLength(e,t){var n,r;return e.length>t?(r=e.indexOf("."),n=e.substring(0,t)+"..."+e.substring(r,e.length)):n=e,n}function checkTotalImageSize(e){return nTotalSize+e<nMaxTotalImageSize?(nTotalSize+=e,!1):!0}function dragEnter(e){e.stopPropagation(),e.preventDefault()}function dragExit(e){e.stopPropagation(),e.preventDefault()}function dragOver(e){e.stopPropagation(),e.preventDefault()}function drop(e){e.stopPropagation(),e.preventDefault();if(nImageFileCount>=10){alert("\ucd5c\ub300 10\uc7a5\uae4c\uc9c0\ub9cc \ub4f1\ub85d\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.");return}if(typeof e.dataTransfer.files=="undefined")alert("HTML5\ub97c \uc9c0\uc6d0\ud558\uc9c0 \uc54a\ub294 \ube0c\ub77c\uc6b0\uc800\uc785\ub2c8\ub2e4.");else{var t,n,r,i="";n=e.dataTransfer.files,r=n.length;if(!!n&&r===0){alert("\uc815\uc0c1\uc801\uc778 \ucca8\ubd80\ubc29\uc2dd\uc774 \uc544\ub2d9\ub2c8\ub2e4.");return}for(var s=0,o=nImageFileCount;s<r;s++)if(!rFilter.test(n[s].type))alert("\uc774\ubbf8\uc9c0\ud30c\uc77c (jpg,gif,png,bmp)\ub9cc \uc5c5\ub85c\ub4dc \uac00\ub2a5\ud569\ub2c8\ub2e4.");else if(n[s].size>nMaxImageSize)alert("\uc774\ubbf8\uc9c0 \uc6a9\ub7c9\uc774 10MB\ub97c \ucd08\uacfc\ud558\uc5ec \ub4f1\ub85d\ud560 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4.");else{if(!(o<nMaxImageCount)){alert("\ucd5c\ub300 10\uc7a5\uae4c\uc9c0\ub9cc \ub4f1\ub85d\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.");break}i+=addImage(n[s]),o+=1,nImageInfoCnt+=1}o>0?(startModeBG(),i.length>1&&welDropAreaUL.prependHTML(i),updateViewTotalSize(),nImageFileCount=o,updateViewCount(nImageFileCount,0),goStartMode()):readyModeBG()}}function addImage(e){var e=e,t=0,n="",r="",i=!1,s=[];return t=setUnitString(e.size),n=cuttingNameByLength(e.name,15),i=checkTotalImageSize(e.size),i?alert("\uc804\uccb4 \uc774\ubbf8\uc9c0 \uc6a9\ub7c9\uc774 50MB\ub97c \ucd08\uacfc\ud558\uc5ec \ub4f1\ub85d\ud560 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4. \n\n (\ud30c\uc77c\uba85 : "+n+", \uc0ac\uc774\uc988 : "+t+")"):(htImageInfo["img"+nImageInfoCnt]=e,s.push('	<li id="img'+nImageInfoCnt+'" class="imgLi"><span>'+n+"</span>"),s.push("	<em>"+t+"</em>"),s.push("	<a onclick=\"delImage('img"+nImageInfoCnt+'\')"><img class="del_button" src="../../img/photoQuickPopup/btn_del.png"  width="14" height="13" alt="\ucca8\ubd80 \uc0ac\uc9c4 \uc0ad\uc81c"></a>'),s.push("	</li> "),r=s.join(" "),s=[]),r}function html5Upload(){var e,t;t="/api/mail/image/upload";for(var n=0,r=0;n<nImageInfoCnt;n++){e=htImageInfo["img"+n];try{!e||(callAjaxForHTML5(e,t),r+=1)}catch(i){}e=null}}function callAjaxForHTML5(e,t){var n=jindo.$Ajax(t,{type:"xhr",method:"post",onload:function(e){var t=e._response.responseText;if(e.readyState()==4)if(t.indexOf("NOTALLOW_")>-1){var n=t.replace("NOTALLOW_","");alert("\uc774\ubbf8\uc9c0 \ud30c\uc77c(jpg,gif,png,bmp)\ub9cc \uc5c5\ub85c\ub4dc \ud558\uc2e4 \uc218 \uc788\uc2b5\ub2c8\ub2e4. ("+n+")")}else makeArrayFromString(e._response.responseText)},timeout:3,onerror:jindo.$Fn(onAjaxError,this).bind()});n.header("contentType","multipart/form-data"),n.header("file-name",encodeURIComponent(e.name)),n.header("file-size",e.size),n.header("file-Type",e.type),n.request(e)}function makeArrayFromString(e){var t=[],n=[],r={};aResultleng=0;try{if(!e||e.indexOf("sFileURL")<0)return;t=e.split("&");for(var i=0;i<t.length;i++)!!t[i]&&t[i]!=""&&t[i].indexOf("=")>0&&(n=t[i].split("="),r[n[0]]=n[1])}catch(s){}aResultleng=aResult.length,aResult[aResultleng]=r,aResult.length==nImageFileCount&&(setPhotoToEditor(aResult),aResult=null,window.close())}function delImage(e){var t=jindo.$$.getSingle("#"+e);refreshTotalImageSize(e),updateViewTotalSize(),updateViewCount(nImageFileCount,-1),removeImageInfo(e),$Element(t).leave(),nImageFileCount===0&&(readyModeBG(),goReadyMode()),bAttachEvent||addEvent()}function addEvent(){bAttachEvent=!0,elDropArea.addEventListener("dragenter",dragEnter,!1),elDropArea.addEventListener("dragexit",dragExit,!1),elDropArea.addEventListener("dragover",dragOver,!1),elDropArea.addEventListener("drop",drop,!1)}function removeEvent(){bAttachEvent=!1,elDropArea.removeEventListener("dragenter",dragEnter,!1),elDropArea.removeEventListener("dragexit",dragExit,!1),elDropArea.removeEventListener("dragover",dragOver,!1),elDropArea.removeEventListener("drop",drop,!1)}function onAjaxError(){alert("[\uac00\uc774\ub4dc]\uc0ac\uc9c4 \uc5c5\ub85c\ub354\ud560 \uc11c\ubc84URL\uc14b\ud305\uc774 \ud544\uc694\ud569\ub2c8\ub2e4.-onAjaxError")}function uploadImage(e){bSupportDragAndDropAPI?html5Upload():generalUpload()}function callFileUploader(){oFileUploader=(new jindo.FileUploader(jindo.$("uploadInputBox"),{sUrl:location.protocol+"//"+location.host+"/api/mail/image/upload",sCallback:location.href.replace(/\/[^\/]*$/,"")+"/callback.html",sFiletype:"*.jpg;*.png;*.bmp;*.gif",sMsgNotAllowedExt:settingMsg.conf_sign_8,bAutoUpload:!0,bAutoReset:!0})).attach({select:function(e){e.bAllowed===!0?goStartMode():(goReadyMode(),oFileUploader.reset())},success:function(e){var t=[];t[0]=e.htResult,setPhotoToEditor(t),goReadyMode(),oFileUploader.reset(),window.close()},error:function(e){alert(e.htResult.errstr)}})}function closeWindow(){bSupportDragAndDropAPI&&removeEvent(),window.close()}function setPhotoToEditor(e){!!opener&&!!opener.nhn&&!!opener.nhn.husky&&!!opener.nhn.husky.PopUpManager&&opener.nhn.husky.PopUpManager.setCallback(window,"SET_PHOTO",[e])}var nImageInfoCnt=0,htImageInfo=[],aResult=[],rFilter=/^(image\/bmp|image\/gif|image\/jpg|image\/jpeg|image\/png)$/i,rFilter2=/^(bmp|gif|jpg|jpeg|png)$/i,nTotalSize=0,nMaxImageSize=10485760,nMaxTotalImageSize=52428800,nMaxImageCount=10,nImageFileCount=0,bSupportDragAndDropAPI=!1,oFileUploader,bAttachEvent=!1,elContent=$("pop_content"),elDropArea=jindo.$$.getSingle(".drag_area",elContent),elDropAreaUL=jindo.$$.getSingle(".lst_type",elContent),elCountTxtTxt=jindo.$$.getSingle("#imageCountTxt",elContent),elTotalSizeTxt=jindo.$$.getSingle("#totalSizeTxt",elContent),elTextGuide=$("guide_text"),welUploadInputBox=$Element("uploadInputBox"),oNavigator=jindo.$Agent().navigator(),welBtnConfirm=$Element("btn_confirm"),welBtnCancel=$Element("btn_cancel"),welTextGuide=$Element(elTextGuide),welDropArea=$Element(elDropArea),welDropAreaUL=$Element(elDropAreaUL),fnUploadImage=null;window.onload=function(){bSupportDragAndDropAPI?($Element("pop_container2").hide(),$Element("pop_container").show(),welTextGuide.removeClass("nobg"),welTextGuide.className("bg"),addEvent()):($Element("pop_container").hide(),$Element("pop_container2").show(),callFileUploader()),fnUploadImage=$Fn(uploadImage,this),$Fn(closeWindow,this).attach(welBtnCancel.$value(),"click")},jindo.$Ajax.prototype.request=function(e){this._status++;var t=this,n=this._request,r=this._options,i,s,o=[],i="",u=null,a=this._url;this._is_abort=!1,r.postBody&&r.type.toUpperCase()=="XHR"&&r.method.toUpperCase()!="GET"?typeof e=="string"?i=e:i=jindo.$Json(e).toString():typeof e=="undefined"||!e?i=null:i=e,n.open(r.method.toUpperCase(),a,r.async);if(r.sendheader){this._headers["Content-Type"]||n.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=utf-8"),n.setRequestHeader("charset","utf-8");for(var f in this._headers)if(this._headers.hasOwnProperty(f)){if(typeof this._headers[f]=="function")continue;n.setRequestHeader(f,String(this._headers[f]))}}var l=navigator.userAgent;if(!n.addEventListener||l.indexOf("Opera")>-1||l.indexOf("MSIE")>-1)if(typeof n.onload!="undefined")n.onload=function(e){n.readyState==4&&!t._is_abort&&(clearTimeout(u),u=undefined,t._onload(e))};else if(window.navigator.userAgent.match(/(?:MSIE) ([0-9.]+)/)[1]==6&&r.async){var c=function(e){n.readyState==4&&!t._is_abort&&(u&&(clearTimeout(u),u=undefined),t._onload(e),clearInterval(t._interval),t._interval=undefined)};this._interval=setInterval(c,300)}else n.onreadystatechange=function(e){n.readyState==4&&(clearTimeout(u),u=undefined,t._onload(e))};else this._loadFunc&&n.removeEventListener("load",this._loadFunc,!1),this._loadFunc=function(e){clearTimeout(u),u=undefined,t._onload(e)},n.addEventListener("load",this._loadFunc,!1);return n.send(i),this};