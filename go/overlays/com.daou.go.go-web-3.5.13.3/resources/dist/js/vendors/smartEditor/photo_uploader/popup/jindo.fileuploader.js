jindo.Component=jindo.$Class({_htEventHandler:null,_htOption:null,$init:function(){var e=this.constructor.getInstance();e.push(this),this._htEventHandler={},this._htOption={},this._htOption._htSetter={}},option:function(e,t){switch(typeof e){case"undefined":return this._htOption;case"string":if(typeof t=="undefined")return this._htOption[e];if(e=="htCustomEventHandler"){if(typeof this._htOption[e]!="undefined")return this;this.attach(t)}this._htOption[e]=t,typeof this._htOption._htSetter[e]=="function"&&this._htOption._htSetter[e](t);break;case"object":for(var n in e){if(n=="htCustomEventHandler"){if(typeof this._htOption[n]!="undefined")continue;this.attach(e[n])}this._htOption[n]=e[n],typeof this._htOption._htSetter[n]=="function"&&this._htOption._htSetter[n](e[n])}}return this},optionSetter:function(e,t){switch(typeof e){case"undefined":return this._htOption._htSetter;case"string":if(typeof t=="undefined")return this._htOption._htSetter[e];this._htOption._htSetter[e]=jindo.$Fn(t,this).bind();break;case"object":for(var n in e)this._htOption._htSetter[n]=jindo.$Fn(e[n],this).bind()}return this},fireEvent:function(e,t){t=t||{};var n=this["on"+e],r=this._htEventHandler[e]||[],i=typeof n=="function",s=r.length>0;if(!i&&!s)return!0;r=r.concat(),t.sType=e,typeof t._aExtend=="undefined"&&(t._aExtend=[],t.stop=function(){t._aExtend.length>0&&(t._aExtend[t._aExtend.length-1].bCanceled=!0)}),t._aExtend.push({sType:e,bCanceled:!1});var o=[t],u,a;for(u=2,a=arguments.length;u<a;u++)o.push(arguments[u]);i&&n.apply(this,o);if(s){var f;for(u=0,f;f=r[u];u++)f.apply(this,o)}return!t._aExtend.pop().bCanceled},attach:function(e,t){if(arguments.length==1)return jindo.$H(arguments[0]).forEach(jindo.$Fn(function(e,t){this.attach(t,e)},this).bind()),this;var n=this._htEventHandler[e];return typeof n=="undefined"&&(n=this._htEventHandler[e]=[]),n.push(t),this},detach:function(e,t){if(arguments.length==1)return jindo.$H(arguments[0]).forEach(jindo.$Fn(function(e,t){this.detach(t,e)},this).bind()),this;var n=this._htEventHandler[e];if(n)for(var r=0,i;i=n[r];r++)if(i===t){n=n.splice(r,1);break}return this},detachAll:function(e){var t=this._htEventHandler;if(arguments.length)return typeof t[e]=="undefined"?this:(delete t[e],this);for(var n in t)delete t[n];return this}}),jindo.Component.factory=function(e,t){var n=[],r;typeof t=="undefined"&&(t={});for(var i=0,s;s=e[i];i++)r=new this(s,t),n[n.length]=r;return n},jindo.Component.getInstance=function(){return typeof this._aInstance=="undefined"&&(this._aInstance=[]),this._aInstance},jindo.UIComponent=jindo.$Class({$init:function(){this._bIsActivating=!1},isActivating:function(){return this._bIsActivating},activate:function(){return this.isActivating()?this:(this._bIsActivating=!0,arguments.length>0?this._onActivate.apply(this,arguments):this._onActivate(),this)},deactivate:function(){return this.isActivating()?(this._bIsActivating=!1,arguments.length>0?this._onDeactivate.apply(this,arguments):this._onDeactivate(),this):this}}).extend(jindo.Component),jindo.FileUploader=jindo.$Class({_bIsActivating:!1,_aHiddenInput:[],$init:function(e,t){var n={sUrl:"",sCallback:"",htData:{},sFiletype:"*",sMsgNotAllowedExt:"\uc5c5\ub85c\ub4dc\uac00 \ud5c8\uc6a9\ub418\uc9c0 \uc54a\ub294 \ud30c\uc77c\ud615\uc2dd\uc785\ub2c8\ub2e4",bAutoUpload:!1,bAutoReset:!0,bActivateOnload:!0};this.option(n),this.option(t||{}),this._el=jindo.$(e),this._wel=jindo.$Element(this._el),this._elForm=this._el.form,this._aHiddenInput=[],this.constructor._oCallback={},this._wfChange=jindo.$Fn(this._onFileSelectChange,this),this.option("bActivateOnload")&&this.activate()},_appendIframe:function(){var e="tmpFrame_"+this._makeUniqueId();this._welIframe=jindo.$Element(jindo.$('<iframe name="'+e+'" src="'+this.option("sCallback")+'?blank">')).css({width:"10px",border:"2px",height:"10px",left:"10px",top:"10px"}),document.body.appendChild(this._welIframe.$value())},_removeIframe:function(){this._welIframe.leave()},getBaseElement:function(){return this.getFileSelect()},getFileSelect:function(){return this._el},getFormElement:function(){return this._elForm},upload:function(){this._appendIframe();var e=this.getFormElement(),t=jindo.$Element(e),n=this._welIframe.attr("name"),r=n+"_func",i=this.option("sUrl");t.attr({target:n,action:i}),this._aHiddenInput.push(this._createElement("input",{type:"hidden",name:"callback",value:this.option("sCallback")})),this._aHiddenInput.push(this._createElement("input",{type:"hidden",name:"callback_func",value:r}));for(var s in this.option("htData"))this._aHiddenInput.push(this._createElement("input",{type:"hidden",name:s,value:this.option("htData")[s]}));for(var o=0;o<this._aHiddenInput.length;o++)e.appendChild(this._aHiddenInput[o]);this.constructor._oCallback[r+"_success"]=jindo.$Fn(function(e){this.fireEvent("success",{htResult:e}),delete this.constructor._oCallback[e.callback_func+"_success"],delete this.constructor._oCallback[e.callback_func+"_error"];for(var t=0;t<this._aHiddenInput.length;t++)jindo.$Element(this._aHiddenInput[t]).leave();this._aHiddenInput.length=0,this._removeIframe()},this).bind(),this.constructor._oCallback[r+"_error"]=jindo.$Fn(function(e){this.fireEvent("error",{htResult:e}),delete this.constructor._oCallback[e.callback_func+"_success"],delete this.constructor._oCallback[e.callback_func+"_error"];for(var t=0;t<this._aHiddenInput.length;t++)jindo.$Element(this._aHiddenInput[t]).leave();this._aHiddenInput.length=0,this._removeIframe()},this).bind(),e.submit(),this.option("bAutoReset")&&this.reset()},reset:function(){var e=jindo.$("<form>");this._wel.wrap(e),e.reset(),jindo.$Element(e).replace(this._el);var t=this.getFormElement(),n=jindo.$Element(t);return n.attr({target:this._sPrevTarget,action:this._sAction}),this},_onActivate:function(){var e=this.getFormElement(),t=jindo.$Element(e);this._sPrevTarget=t.attr("target"),this._sAction=t.attr("action"),this._el.value="",this._wfChange.attach(this._el,"change")},_onDeactivate:function(){this._wfChange.detach(this._el,"change")},_makeUniqueId:function(){return(new Date).getMilliseconds()+Math.floor(Math.random()*1e5)},_createElement:function(e,t){var n=jindo.$("<"+e+">"),r=jindo.$Element(n);for(var i in t)r.attr(i,t[i]);return n},_checkExtension:function(e){var t=this.option("sFiletype").split(";");for(var n=0,r;n<t.length;n++){r=t[n]=="*.*"?"*":t[n],r=r.replace(/^\s+|\s+$/,""),r=r.replace(/\./g,"\\."),r=r.replace(/\*/g,"[^\\/]+");if((new RegExp(r+"$","gi")).test(e))return!0}return!1},_onFileSelectChange:function(e){var t=e.element.value,n=this._checkExtension(t),r={sValue:t,bAllowed:n,sMsgNotAllowedExt:this.option("sMsgNotAllowedExt")};t.length&&this.fireEvent("select",r)&&(n?this.option("bAutoUpload")&&this.upload():alert(r.sMsgNotAllowedExt))}}).extend(jindo.UIComponent);