function makeWorker(e,t){if("script"==e)try{var n=new Blob([t]);worker=new Worker(URL.createObjectURL(n)),URL.revokeObjectURL(n)}catch(r){worker=new Worker(t)}else worker=new Worker(t);return worker}function checkFileReaderSyncSupport(){if(fileOpenWorker=makeWorker("url",Dext5LayerWin._dext_editor._config.fileEncodingWorkerJSUrl+"?ver="+DEXTTOP.DEXT5.ReleaseVer))fileOpenWorker.onmessage=function(e){FileReaderSyncSupport=e.data.result,releaseWorker()},fileOpenWorker.postMessage({init:!0})}function processFiles(e,t){if(FileReaderSyncSupport){var n=makeWorker("url",Dext5LayerWin._dext_editor._config.fileEncodingWorkerJSUrl+"?ver="+DEXTTOP.DEXT5.ReleaseVer);n&&(n.onmessage=function(e){t(e.data.hasBom,e.data.result)},Array.prototype.forEach.call(e,function(e){n.postMessage(e)}))}}function handleFileSelect(e){FileReaderSyncSupport&&processFiles(e,function(e,t){if(0==t.indexOf("[DEXT5Error]"))alert(t),event_dext_open_file_upload_completed("");else{var n=t.toLowerCase(),r,i,s;r=n.indexOf("<!doctype"),i=n.indexOf("<html"),s=n.indexOf("<head"),0>s&&(s=n.indexOf("<meta")),0>s&&(s=n.indexOf("<title")),n=n.indexOf("<body"),-1<r&&r<i&&i<n?t=t.substring(r):-1<i&&i<n?t=t.substring(i):-1<s&&s<n?t=t.substring(s):-1<n&&(t=t.substring(n)),event_dext_open_file_upload_completed(t)}releaseWorker()})}var FileReaderSyncSupport=!1,syncDetectionScript="onmessage = function(e) { postMessage(!!FileReaderSync); };",fileOpenWorker;checkFileReaderSyncSupport();var releaseWorker=function(){fileOpenWorker.terminate()};