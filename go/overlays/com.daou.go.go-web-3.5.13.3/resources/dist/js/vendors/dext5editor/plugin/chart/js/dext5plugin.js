(function(){try{var e=function(){i.G_TABLE_TO_CHART_CURSOR=GetParentbyTagName(getFirstRange().range.startContainer,"table",!0);var e=t(),n=e.length,s=r(e);4>=e.length||e.length==s||e.length==e.length/s?alert(i.lang.message.not_enough_data):(i.G_TABLE_TO_CHART_ROW=n/s,i.G_TABLE_TO_CHART_COLUMN=s,i.G_TABLE_TO_CHART_DATA=e,DEXT5_EDITOR.prototype.dialog.show(_dext_editor._config.webPath.plugin,"chart/editor_popup.html"))},t=function(){var e=GetTableSelectionCells(DEXTTOP.G_SELECTED_ELEMENT,!0);if(1>e.length){var t,e=[];t=navigator.userAgent.toLowerCase();if(-1<t.indexOf("chrome")||-1<t.indexOf("firefox")||-1<t.indexOf("safari")){t=ActiveCurrTable;for(var n=t.rows.length,r=0,i=0;i<n;i++)for(var s=t.firstElementChild.children[i].childElementCount,o=0;o<s;o++)e[r]=t.firstElementChild.children[i].childNodes[o],r++}else for(t=ActiveCurrTable.cells,n=0;n<t.length;n++)e[n]=t[n]}return e},n=function(){for(var e=t(),n=/colspan="[2-9][0-9]*"/,r=/rowspan="[2-9][0-9]*"/,i=0;i<e.length;i++)if(null!=e[i].outerHTML.match(n)||null!=e[i].outerHTML.match(r))return!0;return!1},r=function(e){for(var t=u=o=0,n=0,r,i,s=0,l=0;l<e.length;l++)0==l?(r=e[l].cellIndex,i=e[l].cellIndex+e[l].colSpan-1,1<e[l].rowSpan&&o++,1<e[l].colSpan&&(u++,s=e[l].colSpan-1)):(i<e[l].cellIndex+e[l].colSpan-1+s&&(i=e[l].cellIndex+e[l].colSpan-1+s),r==e[l].cellIndex&&(s=0),1<e[l].rowSpan&&(o++,a.push({cellIndex:e[l].cellIndex,rangeIdx:l}),t++),1<e[l].colSpan&&(u++,f.push({cellIndex:e[l].cellIndex,rangeIdx:l}),n++));for(e=0;e<t;e++);for(e=0;e<n;e++);return i-r+1},i={pluginName:"chart"};G_DEPlugin.chart=i,i.isSupportBrowser=!0,i.onShowTopMenu=function(e,t){if(!i.isSupportBrowser)return null;switch(e){case"m_insert":return t.push("p_chart"),t;case"m_table":return null;default:return null}},i.onResize=function(e){if("end"==e.cmd&&(void 0!=e.isResize||void 0!=e.target)&&i.isSupportBrowser){var t=e.isResize;e=e.target,t&&e&&"img"==e.nodeName.toLowerCase()&&e.getAttribute("raon_chart")?(t={element:e},i.G_TABLE_TO_CHART_CURSOR=null,i.insertChart(t)):!t&&e.getAttribute("raon_chart")&&(t={element:e},i.G_TABLE_TO_CHART_CURSOR=null,i.insertChart(t))}},i.insertChart=function(e,t){var n=function(e){var t=e.split(",");return 4==t.length?(t[3]="0.7)",e=t.join()):(e=e.replace(/b/,"ba"),e=e.replace(/\)/,",0.7)")),e},r=e.element,s=e.chart,o=e.preview;if(null!=r&&!s&&!o){var u=DEXTTOP.DEXT5.util.makeDecryptReponseMessage(r.getAttribute("raon_chart")),s=JSON.parse(u.replace(/&quot;/g,'"')).data;s.width=r.clientWidth,s.height=r.clientHeight}var u="line",a={},f={responsive:!1},l=!0,h=!1,p,d,v,m,g,y,b;yStack=xStack=!1,a.labels=[];for(var w=1;w<s.data.length;w++)a.labels.push(s.data[w][0]);w=s.type.split("-"),u=w[0],w=w[1];switch(u){case"line":u="line",p=!1,d=s.color.column;if(2==w||4==w)y=0;if(3==w||4==w)b=0;break;case"bar":u=3==w||4==w?"horizontalBar":"bar",v=s.color.column;if(2==w||4==w)yStack=xStack=!0;break;case"area":u="line",v=s.color.column,p=!0;if(2==w||4==w)y=0;if(3==w||4==w)yStack=!0;break;case"circle":l=!1,1==w?u="pie":2==w&&(u="doughnut"),v=s.color.column;break;case"radar":5==w?(u="polarArea",l=!1,v=s.color.column,f.layout={padding:{top:5,bottom:5}}):(u="radar",1==w?m=v=d=s.color.column:2==w?(v=d=s.color.column,y=0):3==w?(d=s.color.column,p=!1,v=s.color.column,y=0):4==w&&(d=["rgba(0,0,0,0)"],p=!1,g=m=v=s.color.column));break;case"scatter":u=1==w?"scatter":"bubble",h=!0,v=s.color.column}a.datasets=[];var E=0;if(l)for(w=1;w<s.data[0].length;w++){var S={};if(h){if(S.label=s.data[0][w],v&&(S.backgroundColor=v[E]),S.data=[],"scatter"==u)for(var x=1;x<s.data.length;x++)S.data.push({x:s.data[x][0],y:s.data[x][w]});else if("bubble"==u){for(x=1;x<s.data.length;x++)S.data.push({x:s.data[x][0],y:s.data[x][w],r:s.data[x][w+1]});w++}}else{S.label=s.data[0][w],S.data=[];for(x=1;x<s.data.length;x++)S.data.push(s.data[x][w]);S.fill=p,S.pointRadius=y,S.lineTension=b,d&&(S.borderColor=d[E]?d[E]:d),v&&(S.backgroundColor=v[E]?n(v[E]):v),m&&(S.pointBorderColor=m[E]),g&&(S.pointBackgroundColor=n(g[E]))}a.datasets.push(S),E++}else{a.labels=s.data[0],S={data:s.data[1],fill:p,pointRadius:y},d&&(S.borderColor=d);if(v)for(S.backgroundColor=[];E<s.data[0].length;)S.backgroundColor.push(n(v[E++]));a.datasets.push(S)}n=parseFloat(s.axes.max),p=parseFloat(s.axes.min),d=parseFloat(s.axes.step);if(l&&"radar"!=u)f.scales={xAxes:[{stacked:xStack,gridLines:{display:s.grid},scaleLabel:{display:0<s.axes.x.text.length,labelString:s.axes.x.text,fontFamily:s.axes.x.fontFamily,fontSize:s.axes.x.fontSize,fontStyle:s.axes.x.fontStyle,fontColor:s.axes.x.fontColor},ticks:{}}],yAxes:[{stacked:yStack,gridLines:{display:s.grid},scaleLabel:{display:0<s.axes.y.text.length,labelString:s.axes.y.text,fontFamily:s.axes.y.fontFamily,fontSize:s.axes.y.fontSize,fontStyle:s.axes.y.fontStyle,fontColor:s.axes.y.fontColor},ticks:{}}]},"horizontalBar"==u?(""!=s.axes.max&&(f.scales.xAxes[0].ticks.max=n),""!=s.axes.min&&(f.scales.xAxes[0].ticks.min=p),""!=s.axes.step&&(f.scales.xAxes[0].ticks.stepSize=d)):"scatter"==u||"bubble"==u?(""!=s.axes.max&&(f.scales.xAxes[0].ticks.max=n,f.scales.yAxes[0].ticks.max=n),""!=s.axes.min&&(f.scales.xAxes[0].ticks.min=p,f.scales.yAxes[0].ticks.min=p),""!=s.axes.step&&(f.scales.xAxes[0].ticks.stepSize=d,f.scales.yAxes[0].ticks.stepSize=d)):(""!=s.axes.max&&(f.scales.yAxes[0].ticks.max=n),""!=s.axes.min&&(f.scales.yAxes[0].ticks.min=p),""!=s.axes.step&&(f.scales.yAxes[0].ticks.stepSize=d));else if("radar"==u||"polarArea"==u)f.scale={ticks:{}},""!=s.axes.max&&(f.scale.ticks.max=n),""!=s.axes.min&&(f.scale.ticks.min=p),""!=s.axes.step&&(f.scale.ticks.stepSize=d);f.title={display:0<s.title.text.length,position:s.title.position,text:s.title.text,fontFamily:s.title.fontFamily,fontSize:s.title.fontSize,fontStyle:s.title.fontStyle,fontColor:s.title.fontColor},f.legend={display:s.legend.display,position:s.legend.position,labels:{fontFamily:s.legend.fontFamily,fontSize:parseFloat(s.legend.fontSize),fontStyle:s.legend.fontStyle,fontColor:s.legend.fontColor}},canvas=document.createElement("canvas"),s.width=0<parseIntOr0(s.width)?s.width:400,s.height=0<parseIntOr0(s.height)?s.height:200,canvas.width=s.width,canvas.height=s.height,f.animation={duration:0,onComplete:function(e,n){var u=document.createElement("canvas");u.width=s.width,u.height=s.height,u.getContext("2d").fillStyle=s.color.background,u.getContext("2d").fillRect(this.chartArea.left,this.chartArea.top,this.chartArea.right-this.chartArea.left,this.chartArea.bottom-this.chartArea.top),u.getContext("2d").drawImage(this.canvas,0,0,u.width,u.height);var a=u.toDataURL();if(o)r.width=582<u.width?582:u.width,r.height=320<u.height?320:u.height,r.src=a;else{if(r)hideDialog(t);else{r=_iframeDoc.createElement("img"),u={pluginName:i.pluginName,action:"insert_image",image:r,closeDialog:!!t};if(i.G_TABLE_TO_CHART_CURSOR){var f=i.G_TABLE_TO_CHART_CURSOR;if(!f.nextSibling){var l=_iframeDoc.createElement("p");f.parentNode.appendChild(l)}var l=getFirstRange(),h=l.range;h.setStart(f.nextSibling,0),h.setEnd(f.nextSibling,0),l.sel.removeAllRanges(),l.sel.addRange(h),_dext_editor._LastRange=h}event_dext5plugin_action(u,t)}r.src=a,a=DEXTTOP.DEXT5.util.makeEncryptParam(JSON.stringify({data:s})),r.setAttribute("raon_chart",a),r.style.width=s.width+"px",r.style.height=s.height+"px"}}},new Chart(canvas,{type:u,data:a,options:f})},i.onClickToolIcon=function(e){if(i.isSupportBrowser)switch(i.G_TABLE_TO_CHART_DATA=null,i.G_TABLE_TO_CHART_COLUMN=null,i.G_TABLE_TO_CHART_ROW=null,i.G_TABLE_TO_CHART_CURSOR=null,e){case"chart":DEXTTOP.G_SELECTED_ELEMENT=null,DEXT5_EDITOR.prototype.dialog.show(_dext_editor._config.webPath.plugin,"chart/editor_popup.html");break;case"tabletochart":i.tableToChart();case"chartproperty":DEXT5_EDITOR.prototype.dialog.show(_dext_editor._config.webPath.plugin,"chart/editor_popup.html")}},i.onDisableToolIcon=function(e){switch(e){case"":case"default":return["p_chart_tabletochart"];case"selectedMultiCell":return["p_chart"];case"focusInCell":return!1;default:return["p_chart","p_chart_tabletochart"]}},i.onCreateContextMenu=function(e){i.isSupportBrowser&&(e.items="paste cut copy  select_all  p_chart_chartproperty".split(" "),e.disabledItems=["paste"],e.height="300px",e.width="200px")},i.onDbClickImage=function(e){i.isSupportBrowser&&(i.G_TABLE_TO_CHART_DATA=null,i.G_TABLE_TO_CHART_COLUMN=null,i.G_TABLE_TO_CHART_ROW=null,i.G_TABLE_TO_CHART_CURSOR=null,DEXT5_EDITOR.prototype.dialog.show(_dext_editor._config.webPath.plugin,"chart/editor_popup.html"))},i.onInit=function(){if(!DEXTTOP.DEXT5.browser.canvasSupported||DEXTTOP.DEXT5.browser.ie&&9>DEXTTOP.DEXT5.browser.ieVersion){i.isSupportBrowser=!1;var e=_dext_editor;e.remove_item.push("p_chart"),e.remove_item.push("p_chart_tabletochart")}else s("../plugin/chart/js"+(DEXTTOP.DEXT5.isRelease?"":"_dev")+"/chart.js?ver="+DEXTTOP.DEXT5.ReleaseVer),s("../plugin/chart/js"+(DEXTTOP.DEXT5.isRelease?"":"_dev")+"/grid.js?ver="+DEXTTOP.DEXT5.ReleaseVer),e="../plugin/chart/js"+(DEXTTOP.DEXT5.isRelease?"":"_dev")+"/config.js",e="1"==DEXTTOP.DEXT5.config.UseConfigTimeStamp?e+("?t="+DEXTTOP.DEXT5.util.getTimeStamp()):e+("?ver="+DEXTTOP.DEXT5.ReleaseVer),s(e)};var s=function(e){var t=document.getElementsByTagName("head")[0],n=document.createElement("script");n.type="text/javascript",n.src=e,t.appendChild(n)};i.onInit(),i.onLoaded=function(){i.isSupportBrowser&&(DEXT5_CONTEXT._item_sub_list.table_tool.push("p_chart_tabletochart"),DEXT5_TOPMENU._item_sub_list.table_tool.push("p_chart_tabletochart"))};var o=0,u=0,a=[],f=[];i.tableToChart=function(){restoreSelection();var s=t(),o,u,a=0;if(i.allowMergedTableToChart)if(u=r(s),4>=s.length||s.length==u||s.length==s.length/u)alert(i.lang.message.not_enough_data);else{o=s.length,a=0,o=[];for(var f=0,l=0;s[a];){f=0,rowPos=parseInt(a/u);if(1<s[a].colSpan){for(f=2;f<=s[a].colSpan;f++)s.splice(a+f-1,0,"0");for(var f=0,h=2;h<=s[a].rowSpan;){for(var p=2;p<=s[a].colSpan;p++)o.push(a+l+((h-1)*u+p-1)),f++;o.push(a+l+(h-1)*u),f++,h++}l+=f}else if(1<s[a].rowSpan){for(h=2;h<=s[a].rowSpan;h++)o.push(a+l+u*(h-1)),f++;l+=f}a++}o=o.sort(function(e,t){return e-t});for(a=0;a<o.length;a++)s.splice(o[a],0,"0");o=s.length,o/=u,i.G_TABLE_TO_CHART_ROW=o,i.G_TABLE_TO_CHART_DATA=s,i.G_TABLE_TO_CHART_COLUMN=u,o!==parseInt(o)?alert(i.lang.message.incorrect_selection):(i.G_TABLE_TO_CHART_CURSOR=GetParentbyTagName(getFirstRange().range.startContainer,"table",!0),DEXT5_EDITOR.prototype.dialog.show(_dext_editor._config.webPath.plugin,"chart/editor_popup.html"))}else n()?alert(i.lang.message.merge):e()}}catch(l){}})();