/*
 *	jQuery dotdotdot 1.6.16
 *
 *	Copyright (c) Fred Heusschen
 *	www.frebsite.nl
 *
 *	Plugin website:
 *	dotdotdot.frebsite.nl
 *
 *	Dual licensed under the MIT and GPL licenses.
 *	http://en.wikipedia.org/wiki/MIT_License
 *	http://en.wikipedia.org/wiki/GNU_General_Public_License
 */

(function(e,t){function r(e,t,n){var r=e.children(),i=!1;e.empty();for(var s=0,u=r.length;s<u;s++){var a=r.eq(s);e.append(a),n&&e.append(n);if(o(e,t)){a.remove(),i=!0;break}n&&n.detach()}return i}function i(t,n,r,u,a){var f=!1,l="table, thead, tbody, tfoot, tr, col, colgroup, object, embed, param, ol, ul, dl, blockquote, select, optgroup, option, textarea, script, style",c="script, .dotdotdot-keep";return t.contents().detach().each(function(){var h=this,p=e(h);if(typeof h=="undefined"||h.nodeType==3&&e.trim(h.data).length==0)return!0;if(p.is(c))t.append(p);else{if(f)return!0;t.append(p),a&&t[t.is(l)?"after":"append"](a),o(r,u)&&(h.nodeType==3?f=s(p,n,r,u,a):f=i(p,n,r,u,a),f||(p.detach(),f=!0)),f||a&&a.detach()}}),f}function s(t,n,r,i,s){var a=t[0];if(!a)return!1;var c=l(a),p=c.indexOf(" ")!==-1?" ":"\u3000",d=i.wrap=="letter"?"":p,v=c.split(d),m=-1,g=-1,y=0,b=v.length-1;i.fallbackToLetter&&y==0&&b==0&&(d="",v=c.split(d),b=v.length-1);while(y<=b&&(y!=0||b!=0)){var w=Math.floor((y+b)/2);if(w==g)break;g=w,f(a,v.slice(0,g+1).join(d)+i.ellipsis),o(r,i)?(b=g,i.fallbackToLetter&&y==0&&b==0&&(d="",v=v[0].split(d),m=-1,g=-1,y=0,b=v.length-1)):(m=g,y=g)}if(m==-1||v.length==1&&v[0].length==0){var E=t.parent();t.detach();var S=s&&s.closest(E).length?s.length:0;E.contents().length>S?a=h(E.contents().eq(-1-S),n):(a=h(E,n,!0),S||E.detach()),a&&(c=u(l(a),i),f(a,c),S&&s&&e(a).parent().append(s))}else c=u(v.slice(0,m+1).join(d),i),f(a,c);return!0}function o(e,t){return e.innerHeight()>t.maxHeight}function u(t,n){while(e.inArray(t.slice(-1),n.lastCharacter.remove)>-1)t=t.slice(0,-1);return e.inArray(t.slice(-1),n.lastCharacter.noEllipsis)<0&&(t+=n.ellipsis),t}function a(e){return{width:e.innerWidth(),height:e.innerHeight()}}function f(e,t){e.innerText?e.innerText=t:e.nodeValue?e.nodeValue=t:e.textContent&&(e.textContent=t)}function l(e){return e.innerText?e.innerText:e.nodeValue?e.nodeValue:e.textContent?e.textContent:""}function c(e){do e=e.previousSibling;while(e&&e.nodeType!==1&&e.nodeType!==3);return e}function h(t,n,r){var i=t&&t[0],s;if(i){if(!r){if(i.nodeType===3)return i;if(e.trim(t.text()))return h(t.contents().last(),n)}s=c(i);while(!s){t=t.parent();if(t.is(n)||!t.length)return!1;s=c(t[0])}if(s)return h(e(s),n)}return!1}function p(t,n){return t?typeof t=="string"?(t=e(t,n),t.length?t:!1):t.jquery?t:!1:!1}function d(e){var t=e.innerHeight(),n=["paddingTop","paddingBottom"];for(var r=0,i=n.length;r<i;r++){var s=parseInt(e.css(n[r]),10);isNaN(s)&&(s=0),t-=s}return t}if(e.fn.dotdotdot)return;e.fn.dotdotdot=function(t){if(this.length==0)return e.fn.dotdotdot.debug('No element found for "'+this.selector+'".'),this;if(this.length>1)return this.each(function(){e(this).dotdotdot(t)});var s=this;s.data("dotdotdot")&&s.trigger("destroy.dot"),s.data("dotdotdot-style",s.attr("style")||""),s.css("word-wrap","break-word"),s.css("white-space")==="nowrap"&&s.css("white-space","normal"),s.bind_events=function(){return s.bind("update.dot",function(t,n){t.preventDefault(),t.stopPropagation(),f.maxHeight=typeof f.height=="number"?f.height:d(s),f.maxHeight+=f.tolerance;if(typeof n!="undefined"){if(typeof n=="string"||n instanceof HTMLElement)n=e("<div />").append(n).contents();n instanceof e&&(u=n)}v=s.wrapInner('<div class="dotdotdot" />').children(),v.contents().detach().end().append(u.clone(!0)).find("br").replaceWith("  <br />  ").end().css({height:"auto",width:"auto",border:"none",padding:0,margin:0});var a=!1,c=!1;return l.afterElement&&(a=l.afterElement.clone(!0),a.show(),l.afterElement.detach()),o(v,f)&&(f.wrap=="children"?c=r(v,f,a):c=i(v,s,v,f,a)),v.replaceWith(v.contents()),v=null,e.isFunction(f.callback)&&f.callback.call(s[0],c,u),l.isTruncated=c,c}).bind("isTruncated.dot",function(e,t){return e.preventDefault(),e.stopPropagation(),typeof t=="function"&&t.call(s[0],l.isTruncated),l.isTruncated}).bind("originalContent.dot",function(e,t){return e.preventDefault(),e.stopPropagation(),typeof t=="function"&&t.call(s[0],u),u}).bind("destroy.dot",function(e){e.preventDefault(),e.stopPropagation(),s.unwatch().unbind_events().contents().detach().end().append(u).attr("style",s.data("dotdotdot-style")||"").data("dotdotdot",!1)}),s},s.unbind_events=function(){return s.unbind(".dot"),s},s.watch=function(){s.unwatch();if(f.watch=="window"){var t=e(window),n=t.width(),r=t.height();t.bind("resize.dot"+l.dotId,function(){if(n!=t.width()||r!=t.height()||!f.windowResizeFix)n=t.width(),r=t.height(),h&&clearInterval(h),h=setTimeout(function(){s.trigger("update.dot")},100)})}else c=a(s),h=setInterval(function(){if(s.is(":visible")){var e=a(s);if(c.width!=e.width||c.height!=e.height)s.trigger("update.dot"),c=e}},500);return s},s.unwatch=function(){return e(window).unbind("resize.dot"+l.dotId),h&&clearInterval(h),s};var u=s.contents(),f=e.extend(!0,{},e.fn.dotdotdot.defaults,t),l={},c={},h=null,v=null;return f.lastCharacter.remove instanceof Array||(f.lastCharacter.remove=e.fn.dotdotdot.defaultArrays.lastCharacter.remove),f.lastCharacter.noEllipsis instanceof Array||(f.lastCharacter.noEllipsis=e.fn.dotdotdot.defaultArrays.lastCharacter.noEllipsis),l.afterElement=p(f.after,s),l.isTruncated=!1,l.dotId=n++,s.data("dotdotdot",!0).bind_events().trigger("update.dot"),f.watch&&s.watch(),s},e.fn.dotdotdot.defaults={ellipsis:"... ",wrap:"word",fallbackToLetter:!0,lastCharacter:{},tolerance:0,callback:null,after:null,height:null,watch:!1,windowResizeFix:!0},e.fn.dotdotdot.defaultArrays={lastCharacter:{remove:[" ","\u3000",",",";",".","!","?"],noEllipsis:[]}},e.fn.dotdotdot.debug=function(e){};var n=1,v=e.fn.html;e.fn.html=function(n){return n!=t&&!e.isFunction(n)&&this.data("dotdotdot")?this.trigger("update",[n]):v.apply(this,arguments)};var m=e.fn.text;e.fn.text=function(n){return n!=t&&!e.isFunction(n)&&this.data("dotdotdot")?(n=e("<div />").text(n).html(),this.trigger("update",[n])):m.apply(this,arguments)}})(jQuery);