/*
	Blackbird - Open Source JavaScript Logging Utility
	Author: G Scott Olson
	Web: http://blackbirdjs.googlecode.com/
	     http://www.gscottolson.com/blackbirdjs/
	Version: 1.0

	The MIT License - Copyright (c) 2008 Blackbird Project
*/

(function(){function generateMarkup(){var e=[];for(type in messageTypes)e.push(['<span class="',type,'" type="',type,'"></span>'].join(""));var t=document.createElement("DIV");return t.id=IDs.blackbird,t.style.display="none",t.innerHTML=['<div class="header">','<div class="left">','<div id="',IDs.filters,'" class="filters" title="click to filter by message type">',e.join(""),"</div>","</div>",'<div class="right">','<div id="',IDs.controls,'" class="controls">','<span id="',IDs.size,'" title="contract" op="resize"></span>','<span class="clear" title="clear" op="clear"></span>','<span class="close" title="close" op="close"></span>',"</div>","</div>","</div>",'<div class="main">','<div class="left"></div><div class="mainBody">',"<ol>",cache.join(""),"</ol>",'</div><div class="right"></div>',"</div>",'<div class="footer">','<div class="left"><label for="',IDs.checkbox,'"><input type="checkbox" id="',IDs.checkbox,'" />Visible on page load</label></div>','<div class="right"></div>',"</div>"].join(""),t}function backgroundImage(){var e=document.getElementsByTagName("BODY")[0];e.currentStyle&&IE6_POSITION_FIXED&&(e.currentStyle.backgroundImage=="none"&&(e.style.backgroundImage="url(about:blank)"),e.currentStyle.backgroundAttachment=="scroll"&&(e.style.backgroundAttachment="fixed"))}function addMessage(e,t){t=t.constructor==Array?t.join(""):t;if(outputList){var n=document.createElement("LI");n.className=e,n.innerHTML=['<span class="icon"></span>',t].join(""),outputList.appendChild(n),scrollToBottom()}else cache.push(['<li class="',e,'"><span class="icon"></span>',t,"</li>"].join(""))}function clear(){outputList.innerHTML=""}function clickControl(e){e||(e=window.event);var t=e.target?e.target:e.srcElement;if(t.tagName=="SPAN")switch(t.getAttributeNode("op").nodeValue){case"resize":resize();break;case"clear":clear();break;case"close":hide()}}function clickFilter(e){e||(e=window.event);var t=e.target?e.target:e.srcElement;if(t&&t.tagName=="SPAN"){var n=t.getAttributeNode("type").nodeValue;if(e.altKey){var r=document.getElementById(IDs.filters).getElementsByTagName("SPAN"),i=0;for(entry in messageTypes)messageTypes[entry]&&i++;var s=i==1&&messageTypes[n];for(var o=0;r[o];o++){var u=r[o].getAttributeNode("type").nodeValue;r[o].className=s||u==n?u:u+"Disabled",messageTypes[u]=s||u==n}}else messageTypes[n]=!messageTypes[n],t.className=messageTypes[n]?n:n+"Disabled";var a=[];for(n in messageTypes)messageTypes[n]||a.push(n);a.push(""),outputList.className=a.join("Hidden "),scrollToBottom()}}function clickVis(e){e||(e=window.event);var t=e.target?e.target:e.srcElement;state.load=t.checked,setState()}function scrollToBottom(){outputList.scrollTop=outputList.scrollHeight}function isVisible(){return bbird.style.display=="block"}function hide(){bbird.style.display="none"}function show(){var e=document.getElementsByTagName("BODY")[0];e.removeChild(bbird),e.appendChild(bbird),bbird.style.display="block"}function reposition(e){if(e===undefined||e==null)e=state&&state.pos===null?1:(state.pos+1)%4;switch(e){case 0:classes[0]="bbTopLeft";break;case 1:classes[0]="bbTopRight";break;case 2:classes[0]="bbBottomLeft";break;case 3:classes[0]="bbBottomRight"}state.pos=e,setState()}function resize(e){if(e===undefined||e===null)e=state&&state.size==null?0:(state.size+1)%2;classes[1]=e===0?"bbSmall":"bbLarge";var t=document.getElementById(IDs.size);t.title=e===1?"small":"large",t.className=t.title,state.size=e,setState(),scrollToBottom()}function setState(){var e=[];for(entry in state){var t=state[entry]&&state[entry].constructor===String?'"'+state[entry]+'"':state[entry];e.push(entry+":"+t)}e=e.join(",");var n=new Date;n.setDate(n.getDate()+14),document.cookie=["blackbird={",e,"}; expires=",n.toUTCString(),";"].join("");var r=[];for(word in classes)r.push(classes[word]);bbird.className=r.join(" ")}function getState(){var re=new RegExp(/blackbird=({[^;]+})(;|\b|$)/),match=re.exec(document.cookie);return match&&match[1]?eval("("+match[1]+")"):{pos:null,size:null,load:null}}function readKey(e){e||(e=window.event);var t=113;if(e&&e.keyCode==t){var n=isVisible();n&&e.shiftKey&&e.altKey?clear():n&&e.shiftKey?reposition():!e.shiftKey&&!e.altKey&&(n?hide():show())}}function addEvent(e,t,n){var e=e.constructor===String?document.getElementById(e):e;e.attachEvent?(e["e"+t+n]=n,e[t+n]=function(){e["e"+t+n](window.event)},e.attachEvent("on"+t,e[t+n])):e.addEventListener(t,n,!1)}function removeEvent(e,t,n){var e=e.constructor===String?document.getElementById(e):e;e.detachEvent?(e.detachEvent("on"+t,e[t+n]),e[t+n]=null):e.removeEventListener(t,n,!1)}var NAMESPACE="log",IE6_POSITION_FIXED=!0,bbird,outputList,cache=[],state=getState(),classes={},profiler={},IDs={blackbird:"blackbird",checkbox:"bbVis",filters:"bbFilters",controls:"bbControls",size:"bbSize"},messageTypes={debug:!0,info:!0,warn:!0,error:!0,profile:!0};window[NAMESPACE]={toggle:function(){isVisible()?hide():show()},resize:function(){resize()},clear:function(){clear()},move:function(){reposition()},debug:function(e){addMessage("debug",e)},warn:function(e){addMessage("warn",e)},info:function(e){addMessage("info",e)},error:function(e){addMessage("error",e)},profile:function(e){var t=new Date;return e==undefined||e==""?addMessage("error","<b>ERROR:</b> Please specify a label for your profile statement"):profiler[e]?(addMessage("profile",[e,": ",t-profiler[e],"ms"].join("")),delete profiler[e]):(profiler[e]=t,addMessage("profile",e)),t}},addEvent(window,"load",function(){var e=document.getElementsByTagName("BODY")[0];bbird=e.appendChild(generateMarkup()),outputList=bbird.getElementsByTagName("OL")[0],backgroundImage(),addEvent(IDs.checkbox,"click",clickVis),addEvent(IDs.filters,"click",clickFilter),addEvent(IDs.controls,"click",clickControl),addEvent(document,"keyup",readKey),resize(state.size),reposition(state.pos),state.load&&(show(),document.getElementById(IDs.checkbox).checked=!0),scrollToBottom(),window[NAMESPACE].init=function(){show(),window[NAMESPACE].error(["<b>",NAMESPACE,"</b> can only be initialized once"])},addEvent(window,"unload",function(){removeEvent(IDs.checkbox,"click",clickVis),removeEvent(IDs.filters,"click",clickFilter),removeEvent(IDs.controls,"click",clickControl),removeEvent(document,"keyup",readKey)})})})();