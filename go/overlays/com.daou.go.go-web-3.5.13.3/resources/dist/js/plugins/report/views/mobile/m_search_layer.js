(function(){define(function(require){var e=require("jquery"),t=require("backbone"),n=require("app"),r=require("i18n!nls/commons"),i=require("i18n!admin/nls/admin"),s=require("i18n!report/nls/report"),o=require("hgn!report/templates/mobile/m_search_layer"),u=require("views/mobile/m_search_header"),a=require("report/views/mobile/m_search_result"),f=require("report/collections/left_menu");require("GO.util");var l=null,c={"\uac80\uc0c9 \uc870\uac74":r["\uac80\uc0c9 \uc870\uac74"],"\uc804\uccb4":r["\uc804\uccb4"],"\uac80\uc0c9":r["\uac80\uc0c9"],"\ubcf4\uace0\uc790":s["\ubcf4\uace0\uc790"],"\uc704\uce58":s["\uc704\uce58"],"\ubd80\uc11c":s["\ubd80\uc11c"],"\ubcf8\ubb38":r["\ubcf8\ubb38"],"\ub313\uae00":r["\ub313\uae00"],"\ucca8\ubd80\ud30c\uc77c":r["\ucca8\ubd80\ud30c\uc77c"],"\ucd08\uae30\ud654":i["\ucd08\uae30\ud654"],"\uac80\uc0c9\uc5b4":r["\uac80\uc0c9\uc5b4"],"\uac80\uc0c9 \ud0a4\uc6cc\ub4dc\ub97c \uc785\ub825\ud558\uc138\uc694":r["\uac80\uc0c9 \ud0a4\uc6cc\ub4dc\ub97c \uc785\ub825\ud558\uc138\uc694."]},h=t.View.extend({el:"#goSearch",events:{"vclick #searchInit":"_detailSearchInit","vclick a[data-search]":"_simpleSearch","keyup #detailSearchWrap input":"_detailSearch","change #deptSelect":"_showFolderSelect"},initialize:function(e){this.$el.off(),this.packageName=e.packageName,this.reportMenu=f.get()},render:function(){return this.$el.html(o({lang:c,data:this.reportMenu.toJSON()})),this._renderSearchHeader(),this.el},_renderSearchHeader:function(){var e=this;u.render({enterSimpleSearchCallback:function(t){e._simpleSearch(t)}})},_showFolderSelect:function(t){var n=e(t.currentTarget),r=n.val();if(r=="all")e("#folderSelect").hide();else{var i=this.reportMenu.get(r),s=['<option value="all">'+c["\uc804\uccb4"]+"</option>"];e.each(i.get("folders"),function(){s.push('<option value="'+this.id+'">'+this.name+"</option>")}),e("#folderSelect").html(s.join("")).show()}},_detailSearchInit:function(t){t.preventDefault(),e("#detailSearchWrap input[type=search], #detailSearchWrap input[type=checkbox]").prop("checked",!1).val(""),e("#detailSearchWrap select").prop("selectedIndex",0)},_detailSearch:function(t){if(t.keyCode!=13)return;var r=e.trim(e("#stext").val()),i=e.trim(e("#detailRepoter").val()),s=n.util.shortDate(new Date),o=n.util.toISO8601("1970/01/01"),u=n.util.searchEndDate(s),f=[{data:r,id:"stext"},{data:i,id:"detailRepoter"}];if(n.util.isAllEmptySearchText(f)){alert(c["\uac80\uc0c9 \ud0a4\uc6cc\ub4dc\ub97c \uc785\ub825\ud558\uc138\uc694"]);return}if(!n.util.isValidForSearchTextWithCheckbox("stext"))return;if(!n.util.isValidSearchTextForDetail(f))return;var l=this._getFolderInfo(),h={stype:"detail",content:e("#detailContent").is(":checked")?r:"",comment:e("#detailComment").is(":checked")?r:"",attachFileNames:e("#detailAttach").is(":checked")?r:"",attachFileContents:e("#detailAttach").is(":checked")?r:"",reporterName:e.trim(i),folderIds:l.folderIds.join(),folderNames:l.folderNames.join(),properties:"submittedAt",fromDate:o,toDate:u};a.render(h)},_simpleSearch:function(t){t.preventDefault();var r=e(t.currentTarget),i=e.trim(e("#commonSearchInput").val());if(!n.util.isValidSearchText(i))return;var s=r.attr("data-search")||"all",o={page:0,offset:15,properties:"submittedAt"};if(s=="all")o.stype="simple",o.keyword=i;else{var u=this._getFolderInfo();o.stype="detail",o[s]=i,o.folderIds=u.folderIds.join(),o.folderNames=u.folderNames.join()}a.render(o)},_getFolderInfo:function(){var t=e("#deptSelect").val(),n={folderIds:[],folderNames:[]};if(t=="all")e.each(this.reportMenu.models,function(t,r){e.each(r.get("folders"),function(){n.folderIds.push(this.id)})}),n.folderNames.push(c["\uc804\uccb4"]);else{var r=e("#folderSelect").val();if(r=="all"){var i=this.reportMenu.get(t);e.each(i.get("folders"),function(){n.folderIds.push(this.id),n.folderNames.push(this.name)})}else n.folderIds.push(r),n.folderNames.push(e("#folderSelect :selected").text())}return n}});return{render:function(e){return l=new h(e),l.render()}}})}).call(this);