(function(){define(["jquery","underscore","backbone","app","hgn!report/templates/report_title","hgn!report/templates/detail_search_layer","report/collections/left_menu","dashboard/views/search/detail_search_popup","i18n!report/nls/report","i18n!calendar/nls/calendar","i18n!nls/commons","jquery.go-popup","jquery.go-validation"],function(e,t,n,r,i,s,o,u,a,f,l){function p(e,t,n){}var c={keyword:l["\uac80\uc0c9\uc5b4"],alert_keyword:l["\uac80\uc0c9\uc5b4\ub97c \uc785\ub825\ud558\uc138\uc694."],alert_length:l["0\uc790\uc774\uc0c1 0\uc774\ud558 \uc785\ub825\ud574\uc57c\ud569\ub2c8\ub2e4."],all:l["\uc804\uccb4"],search:l["\uac80\uc0c9"],location:l["\uc704\uce58"],content:l["\ubcf8\ubb38"],comment:l["\ub313\uae00"],attach:l["\ucca8\ubd80\ud30c\uc77c\uba85"],attachContent:l["\ucca8\ubd80\ud30c\uc77c \ub0b4\uc6a9"],term:l["\uae30\uac04"],detail_search:l["\uc0c1\uc138\uac80\uc0c9"],department:a["\ubd80\uc11c"],reporter:a["\ubcf4\uace0\uc790"],direct_selection:a["\uc9c1\uc811\uc120\ud0dd"],one_week:r.i18n(f["{{week}}\uc8fc\uc77c"],{week:1}),two_week:r.i18n(f["{{week}}\uc8fc\uc77c"],{week:2}),one_month:r.i18n(f["{{month}}\uac1c\uc6d4"],{month:1}),app_search:l["\uc571\uac80\uc0c9"],unified_search:l["\ud1b5\ud569\uac80\uc0c9"],report:l["\ubcf4\uace0"],detail:l["\uc0c1\uc138"]},h=n.View.extend({el:"header.content_top",events:{"click #detailSeach":"renderDetailSearchLayer","keydown input:text#simpleInput":"searchKeyboardEvent","click #btn_search_report":"simpleSearch"},initialize:function(e){this.options=e||{},this.$el.off(),this.searchParam={}},render:function(t){var n={text:this.options.text,meta_data:this.options.meta_data,meta_section:this.options.meta_section,num_section:this.options.num_section,favorite:this.options.favorite,folder_id:t||"all"};return this.$el.html(i({data:n,lang:c})),e("input[placeholder]").placeholder(),this},showDetailTerm:function(){e("#directSelect").show()},searchKeyboardEvent:function(e){e.keyCode==13&&this.simpleSearch()},_serializeObj:function(e){var t=[];for(var n in e)t.push(encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t.join("&")},search:function(){var t=e("#searchType").val();if(t=="appSearch")var n="report/search?"+this._serializeObj(this.searchParam);else{this.searchParam.offset=5;var n="unified/search?"+this._serializeObj(this.searchParam)}r.router.navigate(n,{trigger:!0})},simpleSearch:function(e,t){var n=t||this.$el.find("input:text#simpleInput");if(!this.validate(n))return;this.setSimpleSearchData(),this.search()},detailSearch:function(){if(!this.detailValidate.call(this))return;this.setDetailSearchData(),this.search()},validate:function(t){var n=e.trim(t.val());if(e.trim(n)=="")return e.goSlideMessage(c.alert_keyword,"caution"),t.focus(),!1;if(!e.goValidation.isCheckLength(2,64,n))return e.goMessage(r.i18n(c.alert_length,{arg1:"2",arg2:"64"})),t.focus(),!1;if(e.goValidation.isInValidEmailChar(n)){e.goMessage(l["\uba54\uc77c \uc0ac\uc6a9 \ubd88\uac00 \ubb38\uc790"]);return}return!0},setSimpleSearchData:function(){var t=r.util.shortDate(new Date);this.searchParam.stype="simple",this.searchParam.keyword=e.trim(this.$el.find("input:text#simpleInput").val()),this.searchParam.fromDate=r.util.toISO8601("1970/01/01"),this.searchParam.toDate=r.util.searchEndDate(t),this.searchParam.page=0,this.searchParam.offset=15,this.searchParam.properties="submittedAt"},setDetailSearchData:function(){var t=this,n=e("#deptSelect").val(),i=this.searchEl.find("input:radio:checked").val(),s=e.trim(e("#stext").val());this.searchParam.stype="detail",this.searchParam.content=e("#detailContent").attr("checked")?s:"",this.searchParam.comment=e("#detailComment").attr("checked")?s:"",this.searchParam.attachFileNames=e("#detailAttach").attr("checked")?s:"",this.searchParam.attachFileContents=e("#detailAttachContent").attr("checked")?s:"",this.searchParam.reporterName=e.trim(this.searchEl.find("#detailRepoter").val()),this.searchParam.folderIds=[],this.searchParam.folderNames=[],this.searchParam.properties="submittedAt";if(i=="detail_term_all"){var o=r.util.shortDate(new Date);this.searchParam.fromDate=r.util.toISO8601("1970/01/01"),this.searchParam.toDate=r.util.searchEndDate(o)}else if(i=="detail_term_custom")this.searchParam.fromDate=r.util.searchStartDate(e("#searchStartDate").val()),this.searchParam.toDate=r.util.searchEndDate(e("#searchEndDate").val());else{var o=r.util.shortDate(new Date),u=e('input:radio[name="searchType"]:checked'),a=u.attr("data-key"),f=u.attr("data-amount");this.searchParam.fromDate=r.util.calDate(o,a,f),this.searchParam.toDate=r.util.searchEndDate(o)}if(n=="all")e.each(this.reportMenu.models,function(n,r){e.each(r.get("folders"),function(){t.searchParam.folderIds.push(this.id)})}),t.searchParam.folderNames.push(c.all);else{var l=e("#folderSelect").val();if(l=="all"){var h=this.reportMenu.get(n);e.each(h.get("folders"),function(){t.searchParam.folderIds.push(this.id),t.searchParam.folderNames.push(this.name)})}else t.searchParam.folderIds.push(l),t.searchParam.folderNames.push(e("#folderSelect :selected").text())}this.searchParam.page=0,this.searchParam.offset=15},detailValidate:function(){var t=e.trim(e("#stext").val()),n=this.searchEl.find("#detailRepoter"),r=e.trim(n.val());if(t==""&&r=="")return e.goError(c.alert_keyword),content.focus(),!1;var i=[r,t];for(var s=0;s<i.length;s++)if(i[s]!=""){if(!e.goValidation.isCheckLength(2,64,i[s])){e.goError(App.i18n(tplVar.alert_length,{arg1:"2",arg2:"64"}));return}if(e.goValidation.isInValidEmailChar(i[s])){e.goMessage(l["\uba54\uc77c \uc0ac\uc6a9 \ubd88\uac00 \ubb38\uc790"]);return}}var o=!1;e("input[type=checkbox]").each(function(){this.checked&&(o=!0)});if(t&&!o){e.goError(l["\uac80\uc0c9\uc5b4 \uad6c\ubd84\uc744 \uc120\ud0dd\ud574\uc8fc\uc138\uc694."]);return}return!0},renderDetailSearchLayer:function(t){var n=e("#searchType").val();if(n!="appSearch"){this.detailPopup(t);return}var i=e(t.currentTarget),u=this;this.searchEl=e.goSearch({header:c.detail_search,modal:!0,offset:{top:parseInt(i.offset().top+30,10),right:7},callback:e.proxy(u.detailSearch,u)}),this.reportMenu==undefined&&(this.reportMenu=o.get()),this.searchEl.find("div.content").html(s({data:this.reportMenu.toJSON(),lang:c}));var a=e("#searchStartDate"),f=e("#searchEndDate");e.datepicker.setDefaults(e.datepicker.regional[r.config("locale")]),a.datepicker({dateFormat:"yy-mm-dd",changeMonth:!0,changeYear:!0,yearSuffix:"",onSelect:function(e){f.datepicker("option","minDate",e)}}),f.datepicker({dateFormat:"yy-mm-dd",changeMonth:!0,changeYear:!0,yearSuffix:"",onSelect:function(e){a.datepicker("option","maxDate",e)}}),this.searchEl.on("click","#detail_term_custom",e.proxy(this.showDetailTerm,this)),this.searchEl.on("change","#deptSelect",e.proxy(this.showFolderSelect,this))},showFolderSelect:function(t){var n=e(t.currentTarget),r=n.val();if(r=="all")this.searchEl.find("#folderSelect").hide();else{var i=this.reportMenu.get(r),s=["<option value='all'>"+c.all+"</option>"];e.each(i.get("folders"),function(){s.push("<option value='"+this.id+"'>"+this.name+"</option>")}),this.searchEl.find("#folderSelect").html(s.join("")).show()}},release:function(){this.childView.release(),this.$el.off(),this.$el.empty(),this.remove()},detailPopup:function(t){var n=this,r=new u,i=e(t.currentTarget).offset();this.searchPopup=e.goSearch({modal:!0,header:l["\uc0c1\uc138\uac80\uc0c9"],offset:{top:parseInt(i.top+30,10),right:7},callback:function(){r.validate()&&(n.searchParam=r.getSearchParam(),n.search())}}),this.searchPopup.find(".content").html(r.el),r.render()}},{__instance__:null,create:function(e){return(new h(e)).render()}});return h})})();