(function(){define(["jquery","backbone","app","hogan","i18n!report/nls/report","i18n!nls/commons","views/mobile/header_toolbar","hgn!report/templates/mobile/m_report_detail","report/models/report","report/models/report_folder","attach_file","views/mobile/m_font_resize","iscroll","GO.util","GO.m.util","formutil"],function(e,t,n,r,i,s,o,u,a,f,l,c){var h={list:s["\ubaa9\ub85d"],commentCount:i["\uc774 \ubcf4\uace0\uc758 \ub313\uae00"],modify:s["\uc218\uc815"],remove:s["\uc0ad\uc81c"],removeDesc:i["\ud574\ub2f9 \ubcf4\uace0\uc11c\ub97c \uc0ad\uc81c \ud558\uc2dc\uaca0\uc2b5\ub2c8\uae4c?"],modifyAlert:i["PC \uc5d0\uc11c \uc791\uc131\ud55c \ubcf4\uace0\uc11c\ub294 \ubaa8\ubc14\uc77c\uc5d0\uc11c \uc218\uc815\ud560 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4."]},p=t.View.extend({el:"#content",events:{"vclick div.tool_bar a.list":"list","vclick #copyUrl":"copyUrl"},initialize:function(e){this.options=e||{};var t=this.options.reportId;this.model=a.get(t),this.folder=(new f).set(this.model.get("folder")),this.headerBindEvent(),this.$el.off()},headerBindEvent:function(){n.EventEmitter.off("trigger-action"),n.EventEmitter.on("trigger-action","report-comment",this.comment,this),n.EventEmitter.on("trigger-action","report-modify",this.modify,this),n.EventEmitter.on("trigger-action","report-delete",this.remove,this)},render:function(){var e=this;return this.headerToolbarView=o,this.headerToolbarView.render({isPrev:!0,title:this.makeViewTitle(),actionMenu:this.getUseMenus()}),this.makeContent(),n.util.imagesLoaded("#report_detail",this.initIScroll),this.$el.addClass("report"),this.initWindowEvent(),this.$el},getUseMenus:function(){var e=this.model.toJSON(),t=[],n={"\ub313\uae00":{id:"report-comment",text:s["\ub313\uae00"],cls:"btn_comments",triggerFunc:"report-comment",commentsCount:e.commentCount},"\uc218\uc815":{id:"report-modify",text:s["\uc218\uc815"],triggerFunc:"report-modify",inMoreBtn:!0},"\uc0ad\uc81c":{id:"report-delete",text:s["\uc0ad\uc81c"],triggerFunc:"report-delete",inMoreBtn:!0}};return t.push(n.\ub313\uae00),e.actions.updatable&&t.push(n.\uc218\uc815),e.actions.removable&&t.push(n.\uc0ad\uc81c),t},initWindowEvent:function(){this.orientationWindowEvent={name:"orientation",event:function(){this.$el.find("#report_detail").width(e(window).width()),this.initIScroll()}},this.setTimeoutToWindowEventHandler(this.orientationWindowEvent)},setTimeoutToWindowEventHandler:function(t){var n=this;e(window).on(t.name,function(){this.timeout&&clearTimeout(this.timeout),this.timeout=setTimeout(e.proxy(t.event,n),200)})},initIScroll:function(){e(document).width()<e("#report_detail").width()&&n.util.initDetailiScroll("articleViewWrap","iScrollContentWrap","report_detail")},reload:function(){this.model.fetch({async:!1}),this.folder=(new f).set(this.model.get("folder")),this.render()},makeContent:function(){var t=this;this.$el.html(u({data:e.extend({},this.model.toJSON(),{createdAtBasicDate:n.util.basicDate(this.model.get("submittedAt")),content:function(){var r=n.util.convertMSWordTag(n.util.escapeXssFromHtml(t.model.get("content")));return t.model.get("contentType")=="TEXT"&&(r=n.util.convertRichText(r)),r=e.goFormUtil.convertViewMode(r),r}}),lang:h})),this.attachView=l.create("#report-attach-placeholder",this.model.get("attaches"),function(e){return n.config("contextRoot")+"api/report/"+t.options.reportId+"/download/"+e.id}),this.fontResizeLayerAdd()},fontResizeLayerAdd:function(){c.render({el:"#fontResizeWrap",targetContentEl:"#report_detail"})},list:function(){var e="";return this.folder.isPeriodic()?e="report/series/"+this.model.get("series").id:e="report/folder/"+this.folder.get("id")+"/reports",e=n.router.getSearch("page")?e+="/?page="+n.router.getSearch("page"):e,n.router.navigate(e,!0),!1},comment:function(){var e="";this.folder.isPeriodic()?e="/report/series/"+this.model.get("series").id+"/report/"+this.model.get("id")+"/comments":e="/report/folder/"+this.folder.get("id")+"/report/"+this.model.get("id")+"/comments",n.router.navigate(e,{trigger:!0})},modify:function(){var e="";this.folder.isPeriodic()?e="report/series/"+this.model.get("series").id+"/report/"+this.model.get("id")+"/form":e="/report/folder/"+this.folder.get("id")+"/report/"+this.model.get("id")+"/edit",n.router.navigate(e,{trigger:!0})},remove:function(){var e=this;if(confirm(h.removeDesc))if(this.folder.isPeriodic()){var t=this.model.get("id"),n=new a;n.set({id:t,status:"UNDONE"}),n.save(null,{success:function(){e.list()}})}else this.model.destroy({success:function(){e.list()}})},makeViewTitle:function(){var e="";return this.folder.isPeriodic()?e=this.model.getSeriesStr():e=this.folder.get("name"),e},makeTitle:function(){var e="";return this.folder.isPeriodic()?e=this.folder.get("name")+" > "+this.model.getSeriesStr():e=this.folder.get("name")+" > "+this.model.get("name"),e},copyUrl:function(e){n.util.copyUrl(e)}},{__instance__:null,create:function(e){return this.__instance__=new this.prototype.constructor({packageName:e}),this.__instance__}});return p})}).call(this);