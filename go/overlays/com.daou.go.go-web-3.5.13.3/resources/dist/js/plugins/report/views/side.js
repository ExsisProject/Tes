(function(){define(["jquery","backbone","app","hgn!report/templates/side","i18n!nls/commons","i18n!report/nls/report","report/collections/left_menu","favorite","amplify","jquery.go-popup","jquery.go-validation","jquery.go-sdk"],function(e,t,n,r,i,s,o,u,a){var f={report:s["\ubcf4\uace0"],deptFolder:s["\ubd80\uc11c\ubcc4 \ubcf4\uace0\uc11c"],descendant:s["\ud558\uc704 \ubd80\uc11c \ubcf4\uace0\uc11c \uc870\ud68c"],folderAdd:s["\ubcf4\uace0\uc11c \ucd94\uac00"],reportManage:s["\ubcf4\uace0\uc11c \uad00\ub9ac"],reportConfig:s["\ubcf4\uace0\uc11c \uc124\uc815"],fold:i["\uc811\uae30"],unfold:i["\ud3bc\uce58\uae30"],alert_check_editor:i["\ub0b4\uc6a9 \uc791\uc131 \uc911 \uc774\ub3d9 \uacbd\uace0 \uba54\uc2dc\uc9c0"],confirm:i["\ud655\uc778"],cancel:i["\ucde8\uc18c"],closed_report_list:s["\uc911\uc9c0\ub41c \ubcf4\uace0\uc11c \uad00\ub9ac"],favorite:i["\uc990\uaca8\ucc3e\uae30"],empty_department:i["\uc18c\uc18d\ub41c \ubd80\uc11c\uac00 \uc5c6\uc2b5\ub2c8\ub2e4.<br> \uad00\ub9ac\uc790\uc5d0\uac8c \ubb38\uc758\ud558\uc138\uc694."],empty_report:s["\uc0dd\uc131\ub41c \ubcf4\uace0\uac00 \uc5c6\uc2b5\ub2c8\ub2e4."],deleted_department:i["\uc0ad\uc81c\ub41c \ubd80\uc11c"]},l=n.session("loginId")+"-report-category-toggle",c=t.Model.extend({url:n.contextRoot+"api/department/subdeptcheck"}),h=t.Model.extend({url:n.contextRoot+"api/report/folder/closedcheck"}),p=t.View.extend({el:"#side",events:{"click #reportFolderAdd":"folderAdd","click #folderOption>span.txt, #folderOption>span.ic_side":"folderToggle","click #folders li a.active_folder":"viewReports","click #folders li span.managable":"viewFolderConfig","click #folders span.dept_managable":"viewActiveFolders","click #descendant":"viewDescendant","click #folders li a.closed_folder":"viewCloseFolders","click #reportHome":"reportHome"},initialize:function(){this.$el.off(),this.reportMenu=o.get(),this._setLeftMenu(),this.$el.on("change:url",e.proxy(this.writePageMovePopup,this)),this.$el.on("change:folder",e.proxy(this.reloadFolder,this))},render:function(){return this.renderFolder(),this.renderFavorite(),this},renderFolder:function(){var t=this.reportMenu.toJSON(),i=new c,s=new h,o=!1,u=!1;i.fetch({async:!1}),s.fetch({async:!1}),o=i.has(!0),u=s.has(!0),e.each(t,function(){e.each(this.folders,function(){this.publicOption!="OPEN"?this.isPublic=!1:this.isPublic=!0})}),this.$el.html(r({data:t,lang:f,hasDescendant:o,hasClosedReport:u,home_url:n.contextRoot+"app/report",category_is_open:this.getStoredCategoryIsOpen(),show_folder_add_btn:t.length>0?!0:!1,contextRoot:n.contextRoot,appName:n.util.getAppName("report")}))},renderFavorite:function(){var e=u.create({el:"#side_favorite",url:n.config("contextRoot")+"api/report/folder/favorite",type:"report",liClass:function(e){return e.get("shared")?"report report_share":"report"},link:function(e){return"report/folder/"+e.get("id")+"/reports/favorite"},overrideDataSet:function(e){return{id:e.get("id"),name:e.get("name"),newMark:e.get("newReport"),privateMark:e.get("publicOption")=="CLOSED"}}});return e.$el.on("refresh",function(){e.reload()}),e},reloadFolder:function(){this.reportMenu=o.get(),this.renderFolder()},writePageMovePopup:function(t,r){var i=this.$el.find("li p.on a"),s=i.attr("data-form-flag"),o=e("#content div.reportCreateArea").length==0?!1:!0;if(!o){r();return}if(!s){r();return}if(s&&n.util.hasActiveEditor()&&!n.util.isEditorWriting()){r();return}e.goPopup({title:"",message:f.alert_check_editor,modal:!0,buttons:[{btext:f.confirm,btype:"confirm",callback:r},{btext:f.cancel,btype:"normal",callback:function(){}}]})},viewDescendant:function(){this.$el.trigger("change:url",[function(){var e="report/dept/descendant",t=function(){n.router.navigate(e,{trigger:!0})};n.util.editorConfirm(t)}])},viewFolderConfig:function(t){this.$el.trigger("change:url",[function(){var r=e(t.currentTarget),i="report/folder/"+r.attr("data-id"),s=function(){n.router.navigate(i,{trigger:!0})};n.util.editorConfirm(s)}])},viewActiveFolders:function(t){this.$el.trigger("change:url",[function(){var r=e(t.currentTarget).parents("li.org"),i="report/dept/"+r.attr("data-id")+"/folder/active",s=function(){n.router.navigate(i,{trigger:!0})};n.util.editorConfirm(s)}])},viewCloseFolders:function(t){this.$el.trigger("change:url",[function(){var r=e(t.currentTarget).parents("li.org"),i="report/dept/"+r.attr("data-id")+"/folder/close",s=function(){n.router.navigate(i,{trigger:!0})};n.util.editorConfirm(s)}])},viewReports:function(t){this.$el.trigger("change:url",[function(){var r=e(t.currentTarget),i=r.parents("li");folderId=i.attr("data-id"),type=i.attr("data-type"),url="report/folder/"+folderId+"/reports";var s=function(){n.router.navigate(url,{trigger:!0})};n.util.editorConfirm(s)}])},folderAdd:function(){this.$el.trigger("change:url",[function(){var e=function(){n.router.navigate("report/folder/create",{trigger:!0})};n.util.editorConfirm(e)}])},folderToggle:function(t){var n=e(t.currentTarget),r=n.parents("h1"),i=r.find("span.ic_side");r.hasClass("folded")?(e("#folders").slideDown(200),r.removeClass("folded"),i.attr("title",f.fold)):(e("#folders").slideUp(200),r.addClass("folded"),i.attr("title",f.unfold)),this.storeCategoryIsOpen(!r.hasClass("folded"))},getStoredCategoryIsOpen:function(){var e="";return window.sessionStorage?e=a.store.sessionStorage(l):e=a.store(l),e==undefined&&(e=!0),e},storeCategoryIsOpen:function(e){return a.store(l,e,{type:window.sessionStorage?"sessionStorage":null})},_setLeftMenu:function(){var t=this;this.$el.on("set:leftMenu",function(n,r,i){var s="",o="";e.each(t.$el.find("li.report p.title"),function(){e(this).removeClass("on")});if(r=="closed_folder")return t.$el.find("li.closed>p").addClass("on");if(r=="descendant_folder")return t.$el.find("li.assigned>p").addClass("on");window.location.href.search("favorite")>0?s="#side_favorite":s="#side_folder",i=="department"?o="department":o="report",t.$el.find(s+" li."+o+"[data-id='"+r+"']>p").addClass("on")})},reportHome:function(){var e=function(){n.router.navigate("report",!0)};n.util.editorConfirm(e)}});return p})}).call(this);