(function(){define(["jquery","underscore","backbone","app","i18n!nls/commons","i18n!report/nls/report","hgn!report/templates/dept_descendant","report/views/report_title","collections/dept_descendants_managable","jquery.go-grid","GO.util"],function(e,t,n,r,i,s,o,u,a){function c(e,t,n){}var f={descendant_reports:s["\ud558\uc704 \ubd80\uc11c \ubcf4\uace0\uc11c \uc870\ud68c"],descendant_all:s["\ud558\uc704\ubd80\uc11c \uc804\uccb4"],descendant_reports_empty_msg:s["\ud558\uc704 \ubd80\uc11c \ubcf4\uace0\uc11c\uac00 \uc5c6\uc2b5\ub2c8\ub2e4."],report_config:s["\ubcf4\uace0\uc11c \uc124\uc815"],normal:s["\uc815\uc0c1"],close:s["\uc911\uc9c0"],dept_name:s["\ubd80\uc11c\uba85"],report_name:s["\ubcf4\uace0\uc11c \uc81c\ubaa9"],admin:s["\uc6b4\uc601\uc790"],createAt:s["\uac1c\uc124\uc77c"],config:s["\uc124\uc815"],empty:i["\uc5c6\uc74c"]},l=n.View.extend({el:"#content",events:{"click #selectStatus li":"changeTap","change #deptList":"changeDept"},initialize:function(){this.$el.off(),this.descendant=a.fetch(),e("#side").trigger("set:leftMenu","descendant_folder")},render:function(){return this.$el.html(o({data:this.descendant.toJSON(),lang:f})),this.renderGrid(),u.create({text:f.descendant_reports}),this},reloadGrid:function(e,t){this.dataTable.tables.setParam(e,t)},renderGrid:function(){var t=this.getParam(),n=this;this.dataTable=e.goGrid({el:"#dept_descendant_table",method:"GET",url:r.contextRoot+"api/report/folder/subdept",emptyMessage:"<p class='data_null'> <span class='ic_data_type ic_no_data'></span><span class='txt'>"+f.descendant_reports_empty_msg+"</span>"+"</p>",params:e.extend({},n.getParam(),{property:"department",direction:"asc"}),sDomUse:!0,destroy:!0,columns:[{mData:"department",bSortable:!0,sClass:"part",fnRender:function(e){var t=e.aData;return t.department.name}},{mData:"name",bSortable:!0,sClass:"subject",fnRender:function(e){var t=e.aData;return"<span data-id='"+t.id+"'>"+t.name+"</span>"}},{mData:null,bSortable:!1,sClass:"name",fnRender:function(t){var n=t.aData.admin.nodes,r=[];return n.length!=0?(e.each(n,function(){r.push(this.nodeValue+"</br>")}),r.join("")):f.empty}},{mData:"createdAt",bSortable:!0,sClass:"date",fnRender:function(e){var t=e.aData;return r.util.basicDate3(e.aData.createdAt)}},{mData:null,bSortable:!1,sClass:"setting",fnRender:function(e){var t=e.aData;return"<a class='btn_bdr' data-id='"+t.id+"'><span class='ic_classic ic_setup' title='"+f.report_config+"'></span></a>"}}],fnDrawCallback:function(t){n.$el.find(".tool_bar .custom_header").append(n.$el.find("#controlButtons").show()),n.$el.find("tr>td:nth-child(2) span").css("cursor","pointer").click(function(t){var n=e(t.currentTarget);url="report/folder/"+n.attr("data-id")+"/reports",r.router.navigate(url,{trigger:!0})}),n.$el.find("tr>td:nth-child(5) a").css("cursor","pointer").click(function(t){var n=e(t.currentTarget);url="report/folder/"+n.attr("data-id"),r.router.navigate(url,{trigger:!0})})}})},changeDept:function(t){var n=e(t.currentTarget);this.reloadGrid("deptId",n.val())},changeTap:function(t){var n=e(t.currentTarget);e.each(e(n).siblings(),function(){e(this).removeClass("active")}),n.addClass("active"),this.reloadGrid("status",n.attr("data-value"))},getParam:function(){var e={status:this.$el.find("#selectStatus li.active").attr("data-value"),deptId:this.$el.find("#deptList :selected").val()};return e},release:function(){}},{__instance__:null,create:function(){return this.__instance__===null&&(this.__instance__=new this.prototype.constructor),this.__instance__}});return l})})();