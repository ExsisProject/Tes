(function(){define(["backbone","app","hogan","hgn!report/templates/series_report","hgn!report/templates/series_exclude_popup","hgn!report/templates/series_reporter_card","hgn!report/templates/series_report_create","hgn!report/templates/series_report_info","hgn!report/templates/series_report_info_preview","hgn!report/templates/series_report_comment","hgn!report/templates/report_attaches_file","hgn!report/templates/report_attaches_image","report/views/report_title","report/views/activity_logs","i18n!report/nls/report","i18n!nls/commons","report/collections/series_reports","report/models/series_report","report/models/report","file_upload","comment","attach_file","content_viewer","formutil","GO.util","jquery.go-sdk","jquery.go-grid","jquery.go-popup"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S){var x={detailSearch:v["\uc0c1\uc138\uac80\uc0c9"],search:v["\uac80\uc0c9"],reportWrite:d["\ubcf4\uace0 \uc791\uc131"],reporterExclude:d["\ubcf4\uace0\uc790 \uc81c\uc678"],prev:v["\uc544\ub798"],next:v["\uc704"],list:v["\ubaa9\ub85d"],excludedReporters:d["\uc81c\uc678\ub41c \ubcf4\uace0\uc790"],undoneReporters:d["\ubbf8\ubcf4\uace0\uc790"],undoneReport:d["\ubbf8\ubcf4\uace0"],doneReporters:d["\ubcf4\uace0\uc790"],doneReport:d["\ubcf4\uace0"],confirm:v["\ud655\uc778"],cancel:v["\ucde8\uc18c"],tempSave:v["\uc784\uc2dc\uc800\uc7a5"],callPrevSeries:d["\uc774\uc804 \ud68c\ucc28 \ubd88\ub7ec\uc624\uae30"],close:v["\ub2eb\uae30"],submitReport:d["\ub4f1\ub85d"],edit:v["\uc218\uc815"],popupView:d["\ud31d\uc5c5\ubcf4\uae30"],remove:v["\uc0ad\uc81c"],print:v["\uc778\uc1c4"],reportContent:d["\ubcf4\uace0\ub0b4\uc6a9"],attachFile:v["\ucca8\ubd80\ud30c\uc77c"],"\ud30c\uc77c\ucca8\ubd80":v["\ud30c\uc77c\ucca8\ubd80"],undoneDesc:d["\ubbf8\ubcf4\uace0 \uc911\uc785\ub2c8\ub2e4"],series_comment:d["\ud68c\ucc28 \ub313\uae00"],activityLog:d["\ubcc0\uacbd\uc774\ub825"],report_status:d["\ubcf4\uace0\ud604\ud669"],series:d["\ubcf4\uace0 \ud68c\ucc28"],more:v["\ub354\ubcf4\uae30"],save:v["\uc800\uc7a5"],lang:d["\ubcc0\uacbd\uc774\ub825\uc774 \uc5c6\uc2b5\ub2c8\ub2e4."],report_comment:d["\uc774 \ubcf4\uace0\uc758 \ub313\uae00"],all:v["\uc804\uccb4"],errorMessage:v["500 \uc624\ub958\ud398\uc774\uc9c0 \ud0c0\uc774\ud2c0"],not_selected_reporter:d["\ubcf4\uace0\uc790\ub97c \uc120\ud0dd\ud574 \uc8fc\uc138\uc694."],current_report:d["\ud604\uc7ac \ubcf4\uace0\ub9cc"],all_report:d["\uc804\uccb4 \ubcf4\uace0"],preview_desc:d["\uc774\uc804 \ud68c\ucc28\ub97c \ubd88\ub7ec\uc624\ub294 \uc911\uc785\ub2c8\ub2e4. \uc7a0\uc2dc \ud6c4\uc5d0 \ub2e4\uc2dc \uc2dc\ub3c4\ud574 \uc8fc\uc138\uc694."],preview:v["\ubbf8\ub9ac\ubcf4\uae30"],download:v["\ub2e4\uc6b4\ub85c\ub4dc"],"\uc774 \uacf3\uc5d0 \ud30c\uc77c\uc744 \ub4dc\ub798\uadf8 \ud558\uc138\uc694":v["\uc774 \uacf3\uc5d0 \ud30c\uc77c\uc744 \ub4dc\ub798\uadf8 \ud558\uc138\uc694"],"\uc774 \uacf3\uc5d0 \ud30c\uc77c\uc744 \ub4dc\ub798\uadf8 \ud558\uc138\uc694 \ub610\ub294":v["\uc774 \uacf3\uc5d0 \ud30c\uc77c\uc744 \ub4dc\ub798\uadf8 \ud558\uc138\uc694 \ub610\ub294"],"\ud30c\uc77c\uc120\ud0dd":v["\ud30c\uc77c\uc120\ud0dd"],"\ucca8\ubd80\ud30c\uc77c 1\uac1c\uc758 \ucd5c\ub300 \uc6a9\ub7c9\uc740 NNN MB \uc774\uba70 \ucd5c\ub300 N\uac1c \uae4c\uc9c0 \ub4f1\ub85d \uac00\ub2a5\ud569\ub2c8\ub2e4":t.i18n(v["\ucca8\ubd80\ud30c\uc77c 1\uac1c\uc758 \ucd5c\ub300 \uc6a9\ub7c9\uc740 {{size}} MB \uc774\uba70 \ucd5c\ub300 {{number}} \uac1c \uae4c\uc9c0 \ub4f1\ub85d \uac00\ub2a5\ud569\ub2c8\ub2e4"],{size:t.config("commonAttachConfig").maxAttachSize,number:t.config("commonAttachConfig").maxAttachNumber})},T="body {margin: 22px;}",N=t.BaseView.extend({el:"#content",events:{"click #excludeReporter":"excludeReporterPopup","click #undoneList section.clickable":"renderCreateForm","click #doneList section.clickable":"showReport","click #closeCreateForm":"closeCreateForm","click #callPrevSeries":"callPrevSeries","click #btnSave":"saveReport","click #btnTempSave":"saveTempReport","click #reportInfos section.clickable":"toggleSelectReport","click #writeReport":"renderCreateForm","click div.series_controll ul.optional li.prev":"prev","click div.series_controll ul.optional li.next":"next","click div.series_controll ul.optional a.list":"list","click #reportControll #popup":"showPopupReport","click #reportControll li.edit":"editReport","click #reportControll li.delete":"removeReport","click #reportControll #print":"printReport","click #reportControll a.btn_layer_x":"closeReport","click span.ic_del":"deleteFile","click #series_tap li":"toggleTap","click #activity_more":"activityMore","click span[data-tag=option]":"toggleOption","click #popupOption li[data-range]":"showPopupReport","click #printOption li[data-range]":"printReport","dragover #dropZone":"_dragOver","dragleave #dropZone":"_dragLeave","drop #dropZone":"_drop"},initialize:function(e){this.options=e||{},this.$el.off(),this.$el.addClass("go_renew"),this.$el.on("change:url",this.writePageMovePopup),this.isEditorComplete=!0,this.report=y.init(),this.isSaaS=t.session().brandName=="DO_SAAS",this.totalAttachSize=0,this.totalAttachCount=0},render:function(){this.reportSeriesModel=g.get(this.options.id);var e=this.options.reportId,n=t.session(),i=this.reportSeriesModel.findReporterByUserId(n.id);$("#content").append(r({data:$.extend({},this.reportSeriesModel.toJSON(),{closedAt:this.reportSeriesModel.closedAtBasicDate2(),series:t.i18n(d["\uc81c {{arg1}} \ud68c\ucc28"],{arg1:this.reportSeriesModel.get("series")}),hasExcludeReport:this.reportSeriesModel.hasExcludeReport(),excludeReportsStr:this.reportSeriesModel.excludeReportsStr(),myReport:i,isReportWritable:i.status=="undones"&&i.user.actions.writable,isEmptyUndones:_.isEmpty(this.reportSeriesModel.get("undones"))?!0:!1,isEmptyDones:_.isEmpty(this.reportSeriesModel.get("dones"))?!0:!1}),lang:x,undonesCardTmpl:this.makeUndonesCardTmpl(),donesCardTmpl:this.makeDonesCardTmpl()}));if(e){this._fetchReport(e);if(!this.reportSeriesModel.isExistReport(e)){t.router.navigate("report",{trigger:!0});return}i.user.reportId==e&&i.status=="undones"?(this._viewCreateForm(e,"#reportWrite"),$("#writeReportBtn").hide(),$("#writeReportBtn").closest("section").removeClass("clickable").css("cursor","")):this._renderDetailReport(n.id,e)}h.create({text:this.reportSeriesModel.get("folder").name,meta_data:this.reportSeriesModel.get("department").name,meta_section:" "+t.util.basicDate2(this.reportSeriesModel.get("closedAt"))+" "+this.reportSeriesModel.getSeriesStr()}).$el.addClass("report_top"),this.renderGrid(),$("#side").trigger("set:leftMenu",this.reportSeriesModel.get("folder").id),w.render({el:this.$el.find("#series_comments"),typeUrl:"report/series",typeId:this.reportSeriesModel.get("id"),isWritable:!this.reportSeriesModel.get("department").deletedDept}),this.commentCountUpate(),this.allowAction=!0},_dragOver:function(e){e.preventDefault(),e.stopPropagation(),e.originalEvent.dataTransfer.dropEffect="move",$("#dropZone").addClass("drag_file")},_dragLeave:function(e){e.preventDefault(),e.stopPropagation(),$("#dropZone").removeClass("drag_file")},_drop:function(e){this._dragLeave(e)},_fetchReport:function(e){this.report.set("id",e),this.report.fetch({async:!1}),this.report.setAttacheUrl()},writePageMovePopup:function(e,n){this.reportSeriesModel.get("folder").formUse;if(!t.util.hasActiveEditor()){n();return}if(!t.util.isEditorWriting()){n();return}$.goPopup({title:"",message:x.alert_check_editor,modal:!0,buttons:[{btext:x.confirm,btype:"confirm",callback:n},{btext:x.cancel,btype:"normal",callback:function(){}}]})},commentCountUpate:function(){var e=this;this.$el.on("comment:change",function(t,n,r){var i="";if(n=="report"){var s=e.$el.find("#doneList section.on span.num");s.text(r),i=e.$el.find("#reportDetail li.view_option span.num")}else i=e.$el.find("section.article_reply li[data-type='series_comments'] span.num");i.html(r)})},loadActivityLog:function(){var e=this.$el.find("section.article_reply li[data-type='activity_logs'] span.num");this.activityLogsView?this.activityLogsView.reload():(this.activityLogsView=new p({seriesId:this.reportSeriesModel.get("id")}),this.$el.find("#activity_logs_content").html(this.activityLogsView.render().$el)),this.activityLogsView.collections.page.lastPage?$("#activity_logs_more").hide():$("#activity_logs_more").show(),$("#series_tap li[data-type='activity_logs'] span.num").text(parseInt(this.activityLogsView.collections.page.total))},activityMore:function(){var e=this.$el.find("#activity_logs_content");e.html(""),e.html(this.activityLogsView.more().$el),this.activityLogsView.collections.page.lastPage?$("#activity_logs_more").hide():$("#activity_logs_more").show()},deleteFile:function(e){$(e.currentTarget).parents("li").remove(),this.setViewedTotalAttachSize()},renderGrid:function(){var e=this;this.dataTable=$.goGrid({el:"#report_list",method:"GET",url:t.contextRoot+"api/report/series/"+this.options.id+"/tiny",emptyMessage:"<p class='data_null'> <span class='ic_data_type ic_no_data'></span><span class='txt'>"+d["\ud68c\ucc28 \uc815\ubcf4\uac00 \uc5c6\uc2b5\ub2c8\ub2e4."]+"</span>"+"</p>",defaultSorting:[[1,"asc"]],sDomUse:!1,checkbox:!1,pageUse:!1,checkboxData:"id",columns:[{mData:"createdAt",bSortable:!1,sClass:"time",sWidth:"220px",fnRender:function(n){var r=n.aData,i=[];return r.id==e.options.id&&i.push("<span class='ic_classic ic_now'></span>"),i.push("<span class='date'>"+t.util.basicDate2(r.closedAt)+" "+t.i18n(d["\uc81c {{arg1}}\ud68c\ucc28"],{arg1:r.series})),i.join("")}},{mData:null,bSortable:!1,sClass:"status",sWidth:"750px",fnRender:function(e){var n=e.aData,r=n.dones,i=n.undones,s=[],o=[],u=[];return $.each(r,function(e,t){s.push(t.name+" "+t.position)}),$.each(i,function(e,t){o.push(t.name+" "+t.position)}),u.push("<span data-id='"+n.id+"'>"),u.push('<span class="reporter" data-series-id="'+n.id+'" title="'+d["\ubcf4\uace0\uc790"]+": "+s.join(", ")+" / "+d["\ubbf8\ubcf4\uace0\uc790"]+": "+o.join(", ")+'">'),u.push(t.i18n(d["\ubcf4\uace0\uc790 {{arg1}}\uba85"],{arg1:r.length})),i.length==0?u.push("<span class='ok'>"+d["\uc804\uc6d0\ubcf4\uace0"]+"</span>"):u.push("<span class='not'>("+t.i18n(d["\ubbf8\ubcf4\uace0\uc790 {{arg1}}\uba85"],{arg1:i.length})+" )</span>"),u.push("</span>"),n.commentCount>0&&u.push("<span class='ic_classic ic_reply'></span><span class='num'>[<strong>"+n.commentCount+"</strong>]</span>"),u.join("")}}],fnDrawCallback:function(n){e.$el.find("tr>td:nth-child(2) span.reporter").css("cursor","pointer").click(function(e){var n=$(e.currentTarget);url="report/series/"+n.attr("data-series-id"),$("#side").trigger("change:url",[function(){t.router.navigate(url,{trigger:!0})}])}),e.dataTable.find("tr span[data-id='"+e.options.id+"']").parents("tr").addClass("active")}}).tables},toggleTap:function(e){var t=$(e.currentTarget),n=t.attr("data-type"),r=$(e.currentTarget).find("li.on").attr("data-type");if(n==r)return;$.each(t.siblings(),function(){$(this).removeClass("on")});var i=this.$el.find("#activity_logs"),s=this.$el.find("#series_comments");n=="activity_logs"?(this.activityLogsView==undefined&&(this.activityLogsView=new p({seriesId:this.reportSeriesModel.get("id")}),this.$el.find("#activity_logs_content").html(this.activityLogsView.render().$el)),this.activityLogsView.collections.page.lastPage?$("#activity_logs_more").hide():$("#activity_logs_more").show(),s.hide(),i.show()):(s.show(),i.hide()),t.addClass("on")},prev:function(e){var n=$(e.currentTarget),r=n.attr("data-id"),i="report/series/"+r;if(r==0){$.goMessage(d["\uc774\uc804 \ud68c\ucc28\uac00 \uc5c6\uc2b5\ub2c8\ub2e4."]);return}$("#side").trigger("change:url",[function(){t.router.navigate(i,{trigger:!0})}])},next:function(e){var n=$(e.currentTarget),r=n.attr("data-id"),i="report/series/"+r;if(r==0){$.goMessage(d["\ub2e4\uc74c \ud68c\ucc28\uac00 \uc5c6\uc2b5\ub2c8\ub2e4."]);return}$("#side").trigger("change:url",[function(){t.router.navigate(i,{trigger:!0})}])},list:function(){var e="report/folder/"+this.reportSeriesModel.get("folder").id+"/reports",n=sessionStorage.getItem("report-list-page")||0,r=sessionStorage.getItem("report-list-offset")||20;e+="?page="+n+"&offset="+r,$("#side").trigger("change:url",[function(){t.router.navigate(e,{trigger:!0})}])},toggleSelectReport:function(e){var t=$(e.target).parents("section.card_item");this._toggleSelectReport(t)},_toggleSelectReport:function(e){parentEl=e.parents("div.dashboard_box"),$.each(parentEl.find("section.card_item"),function(e,t){$(t).removeClass("on")}),e.addClass("on")},_getPopupUrl:function(e,n){this.$("#popupOption").hide();var r=window.location.protocol+"//"+window.location.host+t.contextRoot+"app/report/series/";if(e)r+=this.reportSeriesModel.id+"/report/popup";else{var i=n.parents("ul[data-id]").attr("data-id");r+="report/"+i+"/popup"}return r},showPopupReport:function(e){var t=$(e.currentTarget),n=t.attr("data-range")=="all",r=this._getPopupUrl(n,t);this._openPopup(r)},_openPopup:function(e){return window.open(e,"","location=no, directories=no,resizable=yes,status=no,toolbar=no,menubar=no, width=1280,height=650,left=0, top=0, scrollbars=yes")},printReport:function(e){this.$("#printOption").hide();var t=$(e.currentTarget),n=t.attr("data-range")=="all",r=this._getPopupUrl(n,t);this._openPopup(r+"/print")},editReport:function(e){var t=$(e.currentTarget).parents("ul").attr("data-id");$("#reportDetail").hide().html(""),this._fetchReport(t),this._viewCreateForm(t,"#reportUpdate")},removeReport:function(e){var t=this,n=$(e.currentTarget);$.goConfirm(d["\ubcf4\uace0\uc11c \uc0ad\uc81c"],d["\ud574\ub2f9 \ubcf4\uace0\uc11c\ub97c \uc0ad\uc81c \ud558\uc2dc\uaca0\uc2b5\ub2c8\uae4c?"],function(){var e=n.parents("ul").attr("data-id");reportModel=new y,reportModel.set({id:e,status:"UNDONE"}),reportModel.save(null,{success:function(){t.refreshReporters.call(t),t.dataTable.reload(),$("#reportDetail").hide().html(""),$("#reportUpdate").hide().html(""),t.showWriteButton(t),t.loadActivityLog(),t._fetchReport(e),t._viewCreateForm(e,"#reportWrite"),$("#writeReportBtn").hide(),$("#writeReportBtn").closest("section").removeClass("clickable").css("cursor","")}})})},hideWriteButton:function(){$.each(this.$el.find("div.series_controll a.write"),function(){$(this).hide()})},showWriteButton:function(){$.each(this.$el.find("div.series_controll a.write"),function(){$(this).show()})},closeReport:function(){$("#reportDetail").slideUp().html("")},_initSmartEditor:function(e,n){var r=t.session("locale");$("#"+e).goWebEditor({contextRoot:t.config("contextRoot"),lang:r,editorValue:n||"",onLoad:function(){t.Editor.getInstance(e).setContent(n||""),$("#"+e).trigger("edit:complete")}})},_setContent:function(e){var n=e||"";if(this.reportSeriesModel.get("folder").formFlag){var r=this.reportSeriesModel.get("department").name;$.go(t.contextRoot+"api/user/representative/dept","",{qryType:"GET",async:!0,contentType:"application/json",responseFn:function(e){var i=e.data,s=e.data;s&&(r=s.name);var o={data:n,contextRoot:t.contextRoot,userId:t.session().id,userProfileApi:"api/user/profile",deptName:r};$("#editor").setTemplate(o),this.isEditorComplete=!1},error:function(e){var i={data:n,contextRoot:t.contextRoot,userId:t.session().id,userProfileApi:"api/user/profile",deptName:r};$("#editor").setTemplate(i),this.isEditorComplete=!1}})}else setTimeout(function(){t.Editor.getInstance("editor").setContent(t.util.convertMSWordTag(n))},1e3)},getReportDetails:function(e){if(e.isAll){this.seriesReports||(this.seriesReports=new m({seriesId:e.seriesId}),this.seriesReports.fetch({async:!1}));var t=$("<div></div>");return _.each(this.seriesReports.models,function(n){t.append(this.makeReportTemplate(_.extend(e,{report:n})))},this),t}this.makeReportTemplate(e)},getReportDetail:function(e){return this.makeReportTemplate(e)},_parseContent:function(e){var n=t.util.convertMSWordTag(e.get("content"));return e.get("contentType")=="TEXT"&&(n=t.util.convertRichText(n)),n=$.goFormUtil.convertViewMode(n),n},makeReportTemplate:function(e){var n=e.report||this.report;n.id||(n.set("id",e.reportId),n.fetch({async:!1}));var r=this._parseContent(n),i=n.get("actions"),s=n.id||e.reportId,o=e.isPrintMode==undefined?!1:e.isPrintMode,a=n.get("folder").status=="ACTIVE"?!0:!1,f=u({data:$.extend({},n.toJSON(),{actions:i,submittedAtBasicDate:n.submittedAtBasicDate(),attachesCount:n.attachesCount(),attachesSize:t.util.getHumanizedFileSize(n.attachesSize()),isActiveFolder:a,isPrintMode:o,commentCount:n.get("commentCount"),content:r}),lang:x}),l=$(f);if(!e.isPrintMode){var c=l.find("div[id*='reportContentView']"),h="table {width: 100%;}";h+=T,S.init({$el:c,content:r,style:h})}e.isAll&&!n.get("attaches").length?(l.find("div.bar").hide(),l.find("div.add_file").hide()):E.create(l.find("#report-attach-placeholder"),n.get("attaches"),function(e){return t.config("contextRoot")+"api/report/"+n.get("id")+"/download/"+e.id});var p=w.init({el:l.find("#reportReply"),typeUrl:"report",typeId:s,isPrintMode:o,isWritable:!n.get("department").deletedDept});return p.render().fetchComments(),e.isAll&&!p.collection.length&&l.find("section.article_reply").hide(),l},_renderDetailReport:function(e,t,n){var r=this.$el.find("#reportDetail"),i=this.$el.find("#reportUpdate"),s={reportId:t,isPrintMode:!1};n&&(s.report=n);var o=this.getReportDetail(s);r.html(""),r.append(o),i.hide().html(""),r.slideDown(),this.$el.find("#doneList section[data-reportid='"+t+"']").addClass("on")},showReport:function(e){var t=$(e.currentTarget),n=t.attr("data-id"),r=t.attr("data-reportId");this._fetchReport(r),this._renderDetailReport(n,r)},saveReport:function(e){var n=this;t.EventEmitter.trigger("common","layout:setOverlay",!0);if(!n.reportSeriesModel.get("folder").formFlag&&!t.Editor.getInstance("editor").validate())return $.goError(v["\ub9c8\uc784 \uc0ac\uc774\uc988 \ucd08\uacfc"]),!1;var r=new y,i=$(e.currentTarget).parents("div.reportInputForm").find("#reportStatus").val();r.set(n.getReportData()),r.set({status:"DONE",contentType:"HTML"}),r.save(null,{success:function(e,r,i){$.each(n.$el.find("div.series_controll a.write"),function(){$(this).hide()}),$("#reportWrite").hide().empty(),$("#reportUpdate").hide().empty(),n._renderDetailReport(e.get("reporter").id,e.get("id"),e),n.refreshReporters.call(n),n.dataTable.reload(),n.loadActivityLog(),n.$el.find("#doneList section[data-reportid='"+e.get("id")+"']").addClass("on"),t.EventEmitter.trigger("common","layout:clearOverlay",!0)},error:function(e,n,r){t.EventEmitter.trigger("common","layout:clearOverlay",!0),$.goError(v["\uc800\uc7a5\uc5d0 \uc2e4\ud328 \ud558\uc600\uc2b5\ub2c8\ub2e4."])}})},refreshReporters:function(){var e=this.$el.find("#doneList"),t=this.$el.find("#undoneList");this.reportSeriesModel=g.get(this.options.id);var n=this.reportSeriesModel.get("undones"),r=this.reportSeriesModel.get("dones");_.isEmpty(n)?this.$el.find("#undoneList").closest("div #undone").hide():(this.$el.find("#undoneList").closest("div #undone").show(),t.html(this.makeUndonesCardTmpl())),_.isEmpty(r)?this.$el.find("#doneList").closest("div #done").hide():(this.$el.find("#doneList").closest("div #done").show(),e.html(this.makeDonesCardTmpl())),$("#writeReportBtn").hide(),$("#writeReportBtn").closest("section").removeClass("clickable").addClass("on").css("cursor","")},makeUndonesCardTmpl:function(){var e=[],t=this;return $.each(this.reportSeriesModel.get("undones"),function(){var t=s({data:this,lang:x});e.push(t)}),e.join("")},makeDonesCardTmpl:function(){var e=[],t=this;return $.each(this.reportSeriesModel.get("dones"),function(){var t=s({data:this,lang:x});e.push(t)}),e.join("")},getReportData:function(){var e={},n=[];return $.each($("#fileComplete li:not(.attachError)"),function(e,t){var r=$(t),i={id:r.attr("data-id"),name:r.attr("data-name"),hostId:r.attr("host-id"),size:r.attr("data-size")};$.trim(r.attr("data-path"))!=""&&(i.path=r.attr("data-path")),n.push(i)}),this.reportSeriesModel.get("folder").formFlag?e.content=this.removeEditorWrap($("#editorForm").getFormData()):e.content=t.Editor.getInstance("editor").getContent(),e.attaches=n,e.id=this.$el.find("#reportId").val(),e},removeEditorWrap:function(e){var t=$(e);for(var n=0;n<$(e).find("div#editor").length;n++)$(e).wrap().attr("id")=="editor"&&(t=$(t.html()));return $("<div>").append(t).html()},saveTempReport:function(){var e=this;if(!this.reportSeriesModel.get("folder").formFlag&&!t.Editor.getInstance("editor").validate())return $.goError(v["\ub9c8\uc784 \uc0ac\uc774\uc988 \ucd08\uacfc"]),!1;var n=new y;n.set(this.getReportData()),n.set({status:"TEMP"}),n.save(null,{success:function(t){$.goMessage(d["\uc784\uc2dc\uc800\uc7a5 \ub418\uc5c8\uc2b5\ub2c8\ub2e4."]),e.refreshReporters.call(e),$("#reportWrite").slideUp().html(""),$("#reportDetail").slideUp().html(""),$("#reportUpdate").slideUp().html(""),e.showWriteButton(e),e.loadActivityLog(),$("#writeReportBtn").show(),$("#writeReportBtn").closest("section").addClass("clickable").addClass("on").css("cursor","")}}),e.setViewedTotalAttachSize()},closeCreateForm:function(){$("#reportWrite").slideUp().html(""),$("#reportUpdate").slideUp().html(""),$("#writeReportBtn").show(),$("#writeReportBtn").closest("section").addClass("clickable").css("cursor","pointer")},_buildCreateForm:function(e,n){var r=this,i=t.util.useButtonWindow(),s={el:"#swfupload-control",context_root:t.contextRoot,useButtonWindow:i,button_title:x["\ud30c\uc77c\uc120\ud0dd"],button_text:"<span class='txt'>"+x["\ud30c\uc77c\uc120\ud0dd"]+"</span>",url:"api/file?GOSSOcookie="+$.cookie("GOSSOcookie"),textTmpl:["<span class='btn_file''>","{text}","<input type='file' name='file' title='{title}' multiple='' accept={accept} />","</span>"].join(""),dropZone:"#dropZone",progressEl:"div.progress"};i&&(s.button_height=26);var o=parseInt(t.config("commonAttachConfig").maxAttachSize),u=o*1024*1024,a=parseInt(t.config("commonAttachConfig").maxAttachNumber);(new b(s)).queue(function(e,t){}).start(function(e,n){if(!t.config("attachFileUpload"))return $.goAlert(v["\ud30c\uc77c\ucca8\ubd80\uc6a9\ub7c9\ucd08\uacfc"]),r.$("#dropZone").removeClass("drag_file"),!1;if(r.isSaaS){if(u<n.size)return $.goMessage(t.i18n(v["\ucca8\ubd80\ud560 \uc218 \uc788\ub294 \ucd5c\ub300 \uc0ac\uc774\uc988\ub294 0MB \uc785\ub2c8\ub2e4."],"arg1",o)),r.$("#dropZone").removeClass("drag_file"),!1;r.totalAttachSize+=n.size;var i=$("#fileWrap").children().size()+$("#imgWrap").children().size()+r.totalAttachCount+1;if(a<i)return $.goMessage(t.i18n(v["\ucd5c\ub300 \ucca8\ubd80 \uac2f\uc218\ub294 0\uac1c \uc785\ub2c8\ub2e4."],"arg1",a)),r.$("#dropZone").removeClass("drag_file"),!1;r.totalAttachCount++}}).progress(function(e,t){}).success(function(e,n,i){if(t.util.fileUploadErrorCheck(n))i.find(".item_file").append("<strong class='caution'>"+t.util.serverMessage(n)+"</strong>"),i.addClass("attachError");else if(t.util.isFileSizeZero(n))return $.goAlert(t.util.serverMessage(n)),!1;var s=n.data.fileSize,o=t.util.getHumanizedFileSize(s),u=n.data.fileExt,a=n.data.fileName;i.attr("data-size",s),t.util.isImage(u)?(i.find(".item_image").append("<span class='name'>"+a+"</span>"+"<span class='size'>("+o+")</span>"),r.$("#imgWrap").append(i)):r.$("#fileWrap").append(i),r.setViewedTotalAttachSize(),r.resetAttachSizeAndCount()}).complete(function(e,t){}).error(function(e,t){t.jqXHR&&(t.jqXHR.statusText=="abort"?$.goAlert(v["\ucde8\uc18c\ub418\uc5c8\uc2b5\ub2c8\ub2e4."]):$.goAlert(v["\uc5c5\ub85c\ub4dc\uc5d0 \uc2e4\ud328\ud558\uc600\uc2b5\ub2c8\ub2e4."]),r.resetAttachSizeAndCount())});if(!this.reportSeriesModel.get("folder").formFlag)this._initSmartEditor("editor",n);else{var f=this.reportSeriesModel.get("department").name;$.go(t.contextRoot+"api/user/representative/dept","",{qryType:"GET",async:!0,contentType:"application/json",responseFn:function(e){var r=e.data;r&&(f=r.name);var i={data:n||"",contextRoot:t.contextRoot,userId:t.session().id,userProfileApi:"api/user/profile",deptName:f};$("#editor").setTemplate(i),this.isEditorComplete=!1},error:function(e){var r={data:n||"",contextRoot:t.contextRoot,userId:t.session().id,userProfileApi:"api/user/profile",deptName:f};$("#editor").setTemplate(r),this.isEditorComplete=!1}})}},_viewCreateForm:function(e,n){var r=this.report,i=$(n),s=this;this.$el.find("#undoneList section[data-reportid='"+e+"']").addClass("on");if($.trim(i.html())==""){var u=r.toJSON();i.html(o({data:u,lang:x,isSaaS:this.isSaaS}));var a="",f=[];r.get("tempExist")&&r.get("status")!="INVALID"?a=r.get("formContent"):(r.get("status")=="INVALID"?($.goAlert("",d["\uc591\uc2dd\uc774 \ubcc0\uacbd\ub418\uc5b4 \uc784\uc2dc\uc800\uc7a5\uac12\uc744 \ubd88\ub7ec\uc62c \uc218 \uc5c6\uc2b5\ub2c8\ub2e4."]),a=r.get("formContent")):(a=r.get("content"),f=u.attaches),r.get("contentType")=="TEXT"?a=t.util.convertRichText(a):a=t.util.convertMSWordTag(a)),this._buildCreateForm(n,a),this._setAttaches(f),this.setViewedTotalAttachSize()}else if(i.css("display")=="block"){i.slideUp().html("");return}$("#editor").on("edit:complete",function(){$("#editor").off("edit:complete"),s.isEditorComplete=!0,r.get("tempExist")&&r.get("status")!="INVALID"&&$.goConfirm(d["\uc784\uc2dc\uc800\uc7a5 \ubd88\ub7ec\uc624\uae30"],d["\uc791\uc131\uc911\uc778 \ubcf4\uace0\uc11c\uac00 \uc788\uc2b5\ub2c8\ub2e4. \ubd88\ub7ec\uc624\uc2dc\uaca0\uc2b5\ub2c8\uae4c?"],function(){s._setContent(r.get("content")),s._setAttaches(u.attaches),s.setViewedTotalAttachSize()})}),i.slideDown()},_setAttaches:function(e){var n=[],r=[];e&&$.each(e,function(){this.icon=t.util.getFileIconStyle({extention:this.extention}),this.humanSize=t.util.getHumanizedFileSize(this.size),t.util.isImage(this.extention)?r.push(this):n.push(this)}),r.length>0&&this.$el.find("#imgWrap").html(c({images:r})),n.length>0&&this.$el.find("#fileWrap").html(l({files:n}))},renderCreateForm:function(e){var t=$(e.currentTarget),n=t.attr("data-reportid");this._fetchReport(n),this._viewCreateForm(n,"#reportWrite"),$("#writeReportBtn").hide(),$("#writeReportBtn").closest("section").removeClass("clickable").css("cursor","")},callPrevSeries:function(e){var n=$("#reportId").val(),r=this,i=t.contextRoot+"api/report/"+n+"/prev";if(!this.isEditorComplete){$.goAlert(x.preview_desc);return}$.go(i,"",{qryType:"GET",contentType:"application/json",responseFn:function(e){t.EventEmitter.trigger("common","layout:setOverlay",!0),r._setContent(e.data.content),t.EventEmitter.trigger("common","layout:clearOverlay",!0)},error:function(e){var t=JSON.parse(e.responseText);$.goAlert(t.message)}})},popupBindEvents:function(){this.popupEl.on("click.series","#exculdeCheckList input:checkbox",$.proxy(this.exculdeCheck,this))},exculdeCheck:function(e){var t=$(e.target).val(),n=$(e.target).is(":checked");t==="all"?n?$.each($("#exculdeCheckList input:checkbox"),function(){$(this).attr("checked","checked")}):$.each($("#exculdeCheckList input:checkbox"),function(){$(this).removeAttr("checked")}):n||$("#excludeAll").removeAttr("checked")},excludeReporterPopup:function(){var e=this;this.popupEl=$.goPopup({header:x.reporterExclude,width:300,title:"",pclass:"layer_select_member layer_normal ui-draggable",modal:!0,contents:i({lang:x,data:e.reportSeriesModel.get("undones"),exclusion:e.reportSeriesModel.get("exclusion")}),buttons:[{btext:x.confirm,btype:"normal",callback:function(){var n=[],r=[],i=[],s=[],o=$("#gpopupLayer input:checkbox:checked:not([value='all'])"),u=$("#gpopupLayer input:checkbox:not(:checked):not([value='all'])"),a=t.contextRoot+"api/report/series/reporter/status";$.each(o,function(e,t){n.push($(t).val()),i.push($(t).attr("data-id"))}),$.each(u,function(e,t){r.push($(t).val()),s.push($(t).attr("data-id"))}),$.ajax({url:a,data:JSON.stringify({excludeIds:n,undoneIds:r}),type:"PUT",dataType:"json",contentType:"application/json"}).done(function(n){$.each(i,function(n,r){e.reportSeriesModel.changeStatus(r,"exclusion"),r==t.session().id&&e.hideWriteButton(e)}),$.each(s,function(n,r){e.reportSeriesModel.changeStatus(r,"undones"),r==t.session().id&&e.showWriteButton(e)});var r=e.$el.find("#excludeReporters"),o=r.parents("div:first");r.text(e.reportSeriesModel.excludeReportsStr()),o.show(),e.refreshReporters.call(e),e.loadActivityLog(),e.closeCreateForm()}).fail(function(e){$.goAlert(x.errorMessage)})}},{btext:x.cancel,btype:"cancle"}]}),this.popupBindEvents()},makeReporterLayout:function(){return n.compile(s.text)},makeReportInfo:function(){return n.compile(u.text)},toggleOption:function(e){var t=$(e.currentTarget).siblings("div"),n=t.is(":visible");this.$("div[data-range]").not(t).hide(),t.toggle(!n)},getViewedTotalAttachSize:function(){var e=0;return $("#fileWrap, #imgWrap").find("li").each(function(){e+=parseInt(this.getAttribute("data-size"),0)}),e},setViewedTotalAttachSize:function(){if(this.isSaaS){var e=this.getViewedTotalAttachSize();this.$el.find("#total_size").html(t.util.displayHumanizedAttachSizeStatus(e))}},resetAttachSizeAndCount:function(){this.isSaaS&&(this.totalAttachSize=0,this.totalAttachCount=0)}},{});return N})})();