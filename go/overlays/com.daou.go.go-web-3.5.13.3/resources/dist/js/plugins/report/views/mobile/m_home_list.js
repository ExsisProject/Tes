(function(){define(["jquery","backbone","app","i18n!report/nls/report","hgn!report/templates/mobile/m_home_undone_item","hgn!report/templates/mobile/m_home_recent_item","views/mobile/header_toolbar","report/collections/report_todos","report/collections/report_recent_list","GO.util"],function(e,t,n,r,i,s,o,u,a){var f={home:r["\ubcf4\uace0\uc11c \ud648"],todo_reports:r["\uc791\uc131\ud560 \ubcf4\uace0"],recent_reports:r["\ucd5c\uadfc \uc791\uc131\ub41c \ubcf4\uace0"],recent_empty_msg:r["\ucd5c\uadfc \uc791\uc131\ub41c \ubcf4\uace0\uac00 \uc5c6\uc2b5\ub2c8\ub2e4."],undone_empty_msg:r["\uc791\uc131\ud560 \ubcf4\uace0\uac00 \uc5c6\uc2b5\ub2c8\ub2e4."]},l=t.View.extend({el:"#content",events:{"vclick #home_tap ul li":"changeTap","vclick li.recent a[data-report-id]":"reportDetail","vclick li.undone a[data-report-id]":"seriesDetail","vclick li.undone a.btn_report_write":"write"},initialize:function(){n.util.appLoading(!0),this.$el.off(),this.undoneReports=null},render:function(){n.util.pageDone();var e=this,t=["<div class='tab_wrap' id='home_tap'>","<ul class='tab'>","<li class='undone'><a href='javascript:;'>"+f.todo_reports+"</a></li>","<li class='recent on'><a href='javascript:;'>"+f.recent_reports+"</a></li>","</ul>","</div>","<div class='content'>","<ul class='list_box list_box_report' id='home_list'>","</ul>","</div>"];this.headerToolbarView=o,this.headerToolbarView.render({title:r["\ubcf4\uace0"],isList:!0,isSideMenu:!0,isHome:!0,isSearch:!0}),this.$el.html(t.join(""));var i=new a,s={offset:10,page:0,property:"submittedAt",direction:"desc"};n.util.appLoading(!0),i.conditions=s,i.fetch({async:!0,success:function(t){e.recentReports=t,e.renderRecentList(),n.util.appLoading(!1)}})},reload:function(){n.util.appLoading(!0);var e=this.$el.find("#home_tap li.on");e.hasClass("undone")?(this.undoneReports.fetch(),this.renderTodoList()):(this.recentReports.fetch(),this.renderRecentList()),n.util.appLoading(!1)},changeTap:function(t){n.util.appLoading(!0);var r=e(t.currentTarget);if(r.hasClass("undone"))this.undoneReports=u.fetch(),this.renderTodoList();else{var i={offset:10,page:0,property:"submittedAt",direction:"desc"},s=new a;s.conditions=i,s.fetch({async:!1}),this.recentReports=s,this.renderRecentList()}e.each(r.siblings(),function(){e(this).removeClass("on")}),r.addClass("on"),n.util.appLoading(!1)},reportDetail:function(t){var r=e(t.currentTarget),i=r.attr("data-type"),s=r.attr("data-report-id"),o=r.attr("data-series-id"),u=r.attr("data-folder-id");i=="PERIODIC"?url="report/series/"+o+"/report/"+s:url="report/folder/"+u+"/report/"+s,n.router.navigate(url,{trigger:!0})},seriesDetail:function(t){var r=e(t.currentTarget),i=r.attr("data-series-id"),s="report/series/"+i;n.router.navigate(s,{trigger:!0})},write:function(t){var r=e(t.currentTarget),i=r.parents("li.undone").find("a[data-report-id]"),s=i.attr("data-report-id"),o=i.attr("data-series-id"),u="report/series/"+o+"/report/"+s+"/form";n.router.navigate(u,{trigger:!0})},renderTodoList:function(){var t=[],s="";this.undoneReports.length==0?(s="<li class='creat data_null'><span class='txt_ellipsis'>"+f.undone_empty_msg+"</span></li>",t.push(s)):this.undoneReports.each(function(s,o){var u=n.session(),a=i({data:e.extend({},s.toJSON(),{seriesId:s.get("id"),reportId:s.findReporterByUserId(u.id,"undones").user.reportId,closedAtBasicDate:n.util.basicDate2(s.get("closedAt")),seriesText:s.getSeriesStr(),donesText:n.i18n(r["\ubcf4\uace0\uc790 {{arg1}}\uba85"],{arg1:s.get("dones").length}),undonesText:n.i18n(r["\ubbf8\ubcf4\uace0\uc790 {{arg1}}\uba85"],{arg1:s.get("undones").length}),isCommentCountZero:function(){return s.get("commentCount")==0?!0:!1},actions:{writable:!0}}),lang:f});t.push(a)}),this.$el.find("#home_list").html(t.join(""))},renderRecentList:function(){var t=[],r="",i=this;this.recentReports.length==0?(r="<li class='creat data_null'><span class='txt_ellipsis'>"+f.recent_empty_msg+"</span></li>",t.push(r)):this.recentReports.each(function(r,o){var u=s({data:e.extend({},r.toJSON(),{title:i._makeRecentTitle(r),createdAtBasicDate:n.util.basicDate(r.get("submittedAt")),isCommentCountZero:function(){return r.get("commentCount")==0?!0:!1},deptName:r.get("folder").name,isReadable:r.get("actions").readable}),lang:f});t.push(u)}),this.$el.find("#home_list").html(t.join(""))},_makeRecentTitle:function(e){if(e.get("folder").type=="PERIODIC"){var t=n.util.parseOrdinaryNumber(e.get("series").series,n.config("locale"));return e.get("folder").name+" ("+n.i18n(r["\uc81c {{arg1}}\ud68c\ucc28"],{arg1:t})+")"}return e.get("name")}},{__instance__:null,create:function(e){return this.__instance__=new this.prototype.constructor({packageName:e}),this.__instance__}});return l})}).call(this);