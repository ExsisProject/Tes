(function(){define(["jquery","hogan","underscore","backbone","app","i18n!nls/commons","i18n!report/nls/report","models/dept_profile","report/models/report_dept","hgn!report/templates/dept_active_folders","report/views/report_title","GO.util","jquery.go-grid","jquery.go-orgslide","jquery.go-preloader"],function(e,t,n,r,i,s,o,u,a,f,l){function g(e,t,n){}var c={empty_msg:o["\uc0dd\uc131\ub41c \ubcf4\uace0\uc11c\uac00 \uc5c6\uc2b5\ub2c8\ub2e4."],report_manage:o["\ubcf4\uace0\uc11c \uad00\ub9ac"],remove_msg:o["\ubcf4\uace0\uc11c \ubc0f \uc120\ud0dd\ud55c \ubcf4\uace0\uc11c \ub0b4 \ubaa8\ub4e0 \ub370\uc774\ud130\uac00 \uc0ad\uc81c \ub429\ub2c8\ub2e4. \uc0ad\uc81c\ud558\uc2dc\uaca0\uc2b5\ub2c8\uae4c?"],stop_title:o["\ud3f4\ub354 \uc911\uc9c0"],stop_msg:o["\ud3f4\ub354 \uc911\uc9c0 \uc124\uba85"],stop:o["\uc911\uc9c0"],remove:s["\uc0ad\uc81c"],edit:s["\uc218\uc815"],save:s["\uc800\uc7a5"],cancel:s["\ucde8\uc18c"],report_title:o["\ubcf4\uace0\uc11c \uc81c\ubaa9"],type:o["\uc720\ud615"],created_at:o["\uac1c\uc124\uc77c"],config:s["\uc124\uc815"],empty:s["\uc5c6\uc74c"],config:s["\uc124\uc815"],sort:s["\uc21c\uc11c \ubc14\uafb8\uae30"],add_separate:s["\uad6c\ubd84\uc120 \ucd94\uac00"],move_folder:o["\ubcf4\uace0\uc11c \uc774\uad00"],sort_success:o["\uc21c\uc11c \ubc14\uafb8\uae30 \uc644\ub8cc"],select_report:o["\ubcf4\uace0\uc11c\ub97c \uc120\ud0dd\ud574 \uc8fc\uc138\uc694."],change_success:s["\ubcc0\uacbd\ub418\uc5c8\uc2b5\ub2c8\ub2e4."],save_success:s["\uc800\uc7a5\ub418\uc5c8\uc2b5\ub2c8\ub2e4."],remove_success:s["\uc0ad\uc81c\ub418\uc5c8\uc2b5\ub2c8\ub2e4."]},h=r.View.extend({el:"#content",events:{"click #controlButtons a.sort":"setOrder","click #controlButtons a.add_separate":"addSeparate","click #controlButtons a.close":"close","click #controlButtons a.delete":"remove","click #controlButtons a.move":"move","click #checkedAll":"toggleCheckbox","click #folder_items tr input:checkbox":"toggleCheckboxAll"},initialize:function(t){this.options=t||{},this.$el.off(),this.department=u.read(this.options.deptId),this.model=a.get(this.options.deptId),this.collection=new r.Collection(this.model.get("folders")),e("#side").trigger("set:leftMenu",[this.department.get("id"),"department"])},render:function(){var e=this;return this.$el.html(f({lang:c})),this.renderItem(),l.create({text:c.report_manage,meta_data:this.department.get("name")}),this},renderItem:function(){this.$el.find("#folder_items").html(""),this.$el.find("#folder_items").off();var t=this;this.$el.find("#folder_items").html(""),e.each(this.model.get("folders"),function(n,i){var s="",o=new r.Model(i);o.get("separator")?(s=new m({model:o}),s.$el.on("remove:separate",e.proxy(t.removeSeparate,t)),s.$el.on("update:separate",e.proxy(t.updateSeparate,t))):s=new d({model:o}),s.render(),t.$el.find("#folder_items").append(s.$el)})},updateSeparate:function(t,n){var r=e(t.currentTarget);separate=this.collection.get(n.id),separate.set({name:n.name}),this.saveList(this.collection,function(t){e.goMessage(c.change_success),r.find("td span.title_depart").text(n.name),r.find("td").toggle(),e("#side").trigger("change:folder",[])})},removeSeparate:function(t,n){var r=this.collection.get(n),i=e(t.currentTarget);this.collection.remove(r),this.saveList(this.collection,function(t){e.goMessage(c.change_success),i.remove(),e("#side").trigger("change:folder",[])})},addSeparate:function(){var t=this,n=new r.Model;n.set({name:"",separator:!0}),this.collection.add(n),this.saveList(this.collection,function(n){e.goMessage(c.save_success),e.proxy(t.reload(),t)})},toggleCheckbox:function(t){var n=this.$el.find("#folder_items tr input:checkbox");n.each(function(){e(t.currentTarget).is(":checked")?e(this).attr("checked",!0):e(this).attr("checked",!1)})},toggleCheckboxAll:function(t){e(t.currentTarget).is(":checked")||this.$el.find("#checkedAll").attr("checked",!1)},getCheckedIds:function(){var t=[];return e.each(e("#folders_table td input:checkbox:checked"),function(n,r){t.push(e(r).val())}),t},move:function(){var t=this.getCheckedIds();if(t.length==0){e.goMessage(c.select_report);return}var n=this;e.goOrgSlide({type:"department",contextRoot:i.contextRoot,callback:e.proxy(function(r){var s='<p class="add">'+i.i18n(o["\ud3f4\ub354 \uc774\uad00 \uacbd\uace0"],{arg1:r.name})+"</p>";e.goConfirm(s,"",function(){n.moveSave(r.id,t)})},this)})},moveSave:function(t,n){var r=i.contextRoot+"api/report/folder/department/"+this.department.get("id")+"/transfer/"+t,s=this;e.go(r,JSON.stringify({ids:n}),{async:!1,qryType:"PUT",contentType:"application/json",responseFn:function(t){e.goMessage(c.change_success),i.router.navigate("report/dept/"+s.department.get("id")+"/folder/active",{trigger:!0})},error:function(t){e.goAlert(type.error)}})},remove:function(){var t=this,n=this.getCheckedIds();if(n.length==0){e.goMessage(c.select_report);return}e.goConfirm("",c.remove_msg,function(){var r=i.contextRoot+"api/report/folder",o={id:t.options.deptId,ids:n};t.preloader=e.goPreloader(),t.preloader.render(),e.go(r,JSON.stringify(o),{async:!0,qryType:"DELETE",contentType:"application/json",responseFn:function(e){t.preloader.release(),e.code==="200"&&t.reload.call(t)},error:function(n){t.preloader.release(),e.goAlert(s["\uc0ad\uc81c\uc5d0 \uc2e4\ud328\ud558\uc600\uc2b5\ub2c8\ub2e4."])}})})},close:function(){var t=this,n=this.getCheckedIds();if(n.length==0){e.goMessage(c.select_report);return}e.goConfirm(c.stop_title,c.stop_msg,function(){var r=i.contextRoot+"api/report/folder/status/inactive",s={id:t.options.deptId,ids:n};e.go(r,JSON.stringify(s),{async:!1,qryType:"PUT",contentType:"application/json",responseFn:function(e){e.code==="200"&&t.reload.call(t)},error:function(t){e.goAlert(type.error)}})})},reload:function(){var e="report/dept/"+this.options.deptId+"/folder/active";i.router.navigate(e,!0)},setOrder:function(t){var n=this,r=e(t.currentTarget),i=this.$el.find("#folders_table").find("tbody").hasClass("ui-sortable"),s=this.$el.find("#controlButtons a").not(".sort");if(i){var o=[];this.$el.find("#folders_table").find("tbody").sortable("destroy").removeAttr("class"),e.each(this.$el.find("tbody tr"),function(t,r){var i=n.collection.get(parseInt(e(r).attr("data-id")));o.push(i)}),this.saveList(o,function(t){e.goMessage(c.change_success),e.proxy(n.reload(),n)}),r.find("span.txt").text(c.sort),e.each(s,function(t,n){e(n).show()})}else e.each(s,function(t,n){e(n).hide()}),r.find("span.txt").text(c.sort_success),this.$el.find("#folders_table").find("tbody").sortable({opacity:"1",delay:100,cursor:"move",items:"tr",containment:".go_content",hoverClass:"ui-state-hover",placeholder:"ui-sortable-placeholder",start:function(e,t){t.placeholder.html(t.helper.html()),t.placeholder.find("td").css("padding","5px 10px")}})},saveList:function(t,n){var r=i.contextRoot+"api/report/folder/department/"+this.department.get("id"),s=this;e.go(r,JSON.stringify(t),{qryType:"PUT",contentType:"application/json",responseFn:n,error:function(t){e.goAlert(type.account_delete_error)}})},release:function(){this.childView.release(),this.$el.off(),this.$el.empty(),this.remove()}},{__instance__:null,create:function(){return this.__instance__===null&&(this.__instance__=new this.prototype.constructor),this.__instance__}}),p=t.compile(["<td class='align_c'><input name='id' type='checkbox' value='{{data.id}}'></td>","<td class='subject sorting_1'><span data-id='4' style='cursor: pointer;'> {{data.name}} </span></td>","<td class='name'>{{{data.reportType}}}</td>","<td class='date'>{{data.createdAt}}</td>","<td class='setting'><a class='btn_bdr' style='cursor: pointer;'><span class='ic_classic ic_setup' title='{{lang.config}}'></span></a></td>"].join("")),d=r.View.extend({tagName:"tr",events:{"click td.subject span":"goList","click td.setting a":"goConfig"},initialize:function(e){this.options=e||{},this.model=this.options.model,this.$el.attr("data-id",this.model.get("id"))},render:function(){var t=this,n=p.render({data:e.extend({},this.model.toJSON(),{reportType:function(){var e=t.model.get("type");return e=="PERIODIC"?o["\uc815\uae30 \ubcf4\uace0\uc11c"]:e=="OCCASIONAL"?o["\uc218\uc2dc \ubcf4\uace0\uc11c"]:""},createdAt:i.util.basicDate(t.model.get("createdAt"))}),lang:c});return this.$el.html(n),this},goList:function(){var e="report/folder/"+this.model.get("id")+"/reports";i.router.navigate(e,{trigger:!0})},goConfig:function(){var e="report/folder/"+this.model.get("id");i.router.navigate(e,{trigger:!0})}}),v=t.compile(['<td colspan="6" class="depart_bg align_l" data-tag="view">','&lt;<span class="title_depart vm" data-tag="content">{{data.name}}</span>&gt;','<span class="btn_fn7 vm edit">{{lang.edit}}</span> ','<span class="btn_fn7 vm remove" >{{lang.remove}}</span>','</td><td colspan="6" class="depart_bg align_l" data-tag="edit" style="display:none;">','<input type="text" class="input w_medium vm" value="{{data.name}}">&nbsp;<span class="btn_fn7 vm save" data-tag="saveSeparator">{{lang.save}}</span>&nbsp;','<span class="btn_fn7 vm cancel" data-tag="cancelSeparator">{{lang.cancel}}</span>',"</td>"].join("")),m=r.View.extend({tagName:"tr",events:{"click span.edit":"edit","click span.remove":"remove","click span.save":"save","click span.cancel":"cancel"},initialize:function(e){this.options=e||{},this.model=this.options.model,this.$el.attr("data-id",this.model.get("id"))},render:function(){var e=v.render({data:this.model.toJSON(),lang:c});return this.$el.html(e),this},edit:function(){this.$el.find("td").toggle()},remove:function(){this.$el.trigger("remove:separate",[this.model.get("id")])},save:function(){this.$el.trigger("update:separate",[{id:this.model.get("id"),name:this.$el.find("input:text").val()}])},cancel:function(){this.$el.find("td").toggle()}});return h})})();