(function(){define(["views/mobile/m_more_list","jquery","backbone","app","i18n!nls/commons","i18n!asset/nls/asset","hgn!asset/templates/mobile/m_asset_item_list_unit","hgn!asset/templates/mobile/m_asset_item_list","views/mobile/header_toolbar","asset/collections/asset_item_list","asset/collections/asset_admin","asset/models/asset_guide","jquery.go-popup","GO.util","jquery.go-validation","jquery.placeholder"],function(e,t,n,r,i,s,o,u,a,f,l,c){function v(e){var n=this,r=e.collection,i=e.isRental,s=e.attrCol;t.each(r,function(e,n){t.each(n.properties,function(e,n){t.each(s.attributes,function(e,t){n.attributeId==t.id&&(n.attrName=t.name)})})});var u=function(){var e=[];return t.each(this.properties,function(t,n){e.push('<span class="txt">'+n.attrName+" : "+n.content+"</span>")}),e.join('<span class="part">|</span>')},a={dataset:r,isRental:i,lang:p,parseAttr:u},f=o(a);return f}var h=null,p={no_asset:s["\uc774\uc6a9\uac00\ub2a5\ud55c \uc790\uc0b0\uc774 \uc5c6\uc2b5\ub2c8\ub2e4."],rent:s["\ub300\uc5ec\uac00\ub2a5"],no_rent:s["\ub300\uc5ec\ubd88\uac00"]},d=e.extend({el:"#content",unbindEvent:function(){this.$el.off("vclick","#rentalTab li"),this.$el.off("vclick","#assetItemList li[data-assetid]")},bindEvent:function(){this.$el.on("vclick","#rentalTab li",t.proxy(this.tabWrap,this)),this.$el.on("vclick","#assetItemList li[data-assetid]",t.proxy(this.itemTab,this))},initialize:function(e){this.tabKind=sessionStorage.getItem("tabKind"),this.key=e.queryString||"empty",this.assetData=GO.util.store.get(this.key),this.assetId=e.assetId,this.type=e.type,this.startTime=e.startTime,this.endTime=e.endTime,this.isRental=!0;if(this.type=="reservation"||this.type=="calendar")this.isRental=!1;this.attrCol=this.getAttribute(),this.collection=new f.init,this.collection.setAssetId(this.assetId),this.setKind(this.type,this.tabKind!=="RETURN"&&this.tabKind!=="NORENTABLE");var n={};n.property="name",n.direction="desc",this.type=="calendar"&&(n.startTime=this.startTime,n.endTime=this.endTime),this.unbindEvent(),this.bindEvent(),this.headerToolbarView=a,this.guidemodel=new c;var r={listFunc:t.proxy(function(e){this.renderList(e)},this)};this.setRenderListFunc(r),this.setFetchInfo(n,this.collection)},itemTab:function(e){this.setSessionInfo(e);var n=t(e.currentTarget),i=n.attr("data-assetid"),s=n.attr("data-itemid"),o;if(n.attr("data-type")=="rent"){var u=n.attr("data-status");if(u=="RENTABLE")o=["asset",i,"item",s,"create","rental"];else if(u=="RETURN"||u=="NORENTABLE")sessionStorage.setItem("tabKind",u),o=["asset",i,"item",s,"status","rental"]}else{var a=n.attr("data-assetname");this.type=="calendar"?o=["asset",i,"item",s,"create","calreservation",this.startTime,this.endTime,"c",this.key]:o=["asset/monthly",i,s,a,GO.util.shortDate(new Date)]}return r.router.navigate(o.join("/"),!0),!1},tabWrap:function(e){var n=this;this.pageNo=0;var r=t(e.currentTarget);return t("#rentalTab li").removeClass("on"),r.addClass("on"),this.setKind("rental",r.attr("data-type")==="rentable"),this.$listEl.empty(),this.dataFetch().done(t.proxy(function(e){n.renderListFunc.listFunc(e)})),!1},renderList:function(e){var t=v({collection:this.filterCollection(e).toJSON(),isRental:this.isRental,attrCol:this.attrCol.toJSON()[0]});this.$listEl.append(t)},filterCollection:function(e){var t;if(this.type==="calendar"){var r=_.map(this.assetData.asset,function(e){return parseInt(e.itemId)}),i=e.filter(function(e){return!_.contains(r,e.id)});t=new n.Collection(i)}else t=e;return t},getAttribute:function(){var e=new l.prototype.constructor;return e.setUrlPart("info"),e.setAssetId(this.assetId),e.fetch({async:!1,reset:!0}),e},setKind:function(e,t){var n="";this.isRental=!0,e=="reservation"?(n="reservation",this.isRental=!1):e=="rental"&&t?n="rentable":e=="calendar"?(n="calendar",this.isRental=!1):n="notavailable",this.collection.setUrlPart(n)},render:function(){var e=this;t("#btnHeaderSearch").show().attr("data-assetid",this.assetId);var n=u({isRental:this.isRental,lang:p});this.$el.html(n),this.tabKind==="RETURN"||this.tabKind==="NORENTABLE"?t('li[data-type="norentable"]').addClass("on"):t('li[data-type="rentable"]').addClass("on"),this.$listEl=this.$el.find("#assetItemList"),this.dataFetch().done(t.proxy(function(t){e.renderListFunc.listFunc(t),e.scrollToEl()},this));var r={title:this.renderTitle(),isList:!0,isSideMenu:!0,isHome:!0};this.key!="empty"&&(r={title:this.renderTitle(),isClose:!0,closeCallback:function(){GO.router.navigate(GO.contextRoot+"calendar/asset/write/"+e.startTime+"/"+e.endTime+"/"+e.key,!0)}}),this.headerToolbarView.render(r),t("#btnHeaderSearch").show().attr("data-assetid",this.assetId),this.renderGuide(),GO.util.appLoading(!1)},renderTitle:function(){return this.guidemodel.clear(),this.guidemodel.set({assetId:this.assetId},{silent:!0}),this.guidemodel.fetch({async:!1}),this.guidemodel.get("name")},renderGuide:function(){this.guidemodel.clear(),this.guidemodel.set({assetId:this.assetId},{silent:!0}),this.guidemodel.fetch({async:!1}),t("#titleToolbar h2").text(this.guidemodel.get("name"))}});return{render:function(e){return h=new d(e),h.render()}}})}).call(this);