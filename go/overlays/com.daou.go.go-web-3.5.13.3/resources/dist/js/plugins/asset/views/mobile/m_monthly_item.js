(function(){define(["jquery","backbone","app","views/mobile/header_toolbar","components/minical/views/minical_app","i18n!nls/commons","i18n!asset/nls/asset","i18n!calendar/nls/calendar","GO.util","jquery.go-validation"],function(e,t,n,r,i,s,o,u){var a=t.Collection.extend({initialize:function(e){this.assetId=e.assetId,this.itemId=e.itemId},setDuration:function(e,t){this.from=e,this.to=t},url:function(){var e="/api/asset/"+this.assetId+"/item/"+this.itemId+"/reservation";return e}}),f=t.View.extend({el:"#content",initialize:function(t){GO.util.appLoading(!0),this.assetId=t.assetId,this.assetName=decodeURIComponent(t.name),this.itemId=t.itemId,this.reservations=new a({assetId:this.assetId,itemId:this.itemId}),this.miniCalendar=new i({renderTarget:this.$el,loadDataOnDateSet:e.proxy(this._loadDataOnDateSet,this),dateDataEmptyMessage:o["\ub4f1\ub85d\ub41c \uc608\uc57d\uc774 \uc5c6\uc2b5\ub2c8\ub2e4."],buttonLeft:{label:s["\ubaa9\ub85d"],url:e.proxy(function(e){return"asset/"+this.assetId+"/list/reservation"},this)}})},_loadDataOnDateSet:function(t,n){var r=e.proxy(function(e){var t="asset/"+this.assetId+"/item/"+this.itemId+"/status/reservation/";return _.map(e.data,function(e){var n=!!e.useAnonym;return{id:e.id,companyName:e.user.companyName,name:n?"("+o["\uc775\uba85\uc608\uc57d"]+")":e.user.name||"",startTime:moment(e.startTime),endTime:moment(e.endTime),alldayType:!1,moveURL:t+e.id,otherCompanyReservation:!!e.otherCompanyReservation}})},this),i=e.Deferred(),s={startAt:GO.util.toISO8601(t),endAt:GO.util.toISO8601(n)};return this.reservations.fetch({data:s}).done(function(e){i.resolve(r(e)),GO.util.appLoading(!1)}).fail(function(){i.reject(),GO.util.appLoading(!1)}),i.promise()},render:function(){r.render({title:this.assetName,isList:!0,isSideMenu:!0,isHome:!0,isWriteBtn:!0,writeBtnCallback:e.proxy(function(){var e=this.miniCalendar.getSelectedDate();if(GO.util.isBeforeToday(e)){alert(o["\uc624\ub298 \uc774\uc804\uc758 \ub0a0\uc9dc\uc5d0\ub294 \uc608\uc57d\ud560 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4."]);return}var t=["asset",this.assetId,"item",this.itemId,"create","reservation",e,"r"];n.router.navigate(t.join("/"),{trigger:!0,pushState:!0})},this)}),e("#btnHeaderSearch").show().attr("data-assetid",this.assetId),this.miniCalendar.render()}});return{render:function(e){return(new f(e)).render()}}})}).call(this);