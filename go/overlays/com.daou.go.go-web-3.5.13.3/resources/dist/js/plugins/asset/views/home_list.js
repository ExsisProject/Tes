(function(){define(["jquery","backbone","app","hgn!asset/templates/home_list","hgn!asset/templates/asset_my_condition","asset/collections/home_list","asset/models/asset_user_create","calendar/libs/recurrence_parser","asset/views/asset_timeline","views/profile_card","i18n!asset/nls/asset","i18n!nls/commons","i18n!calendar/nls/calendar","jquery.go-sdk"],function(e,t,n,r,i,s,o,u,a,f,l,c,h){var p={all:l["\uc804\uccb4"],item_count:c["\uc804\uccb4\uac2f\uc218"],admin:l["\uc6b4\uc601\uc790"],reservation:l["\uc608\uc57d"],rent:l["\ub300\uc5ec"],use_return:l["\uc774\uc6a9 \ubc18\ub0a9"],is_return:l["\uc774\uc6a9\uc744 \ubc18\ub0a9\ud558\uc2dc\uaca0\uc2b5\ub2c8\uae4c?"],reservation_cancel:l["\uc608\uc57d \ucde8\uc18c"],is_reservation_cancel:l["\uc608\uc57d\uc744 \ucde8\uc18c\ud558\uc2dc\uaca0\uc2b5\ub2c8\uae4c?"],no_content:l["\uc608\uc57d/\ub300\uc5ec \uc911\uc778 \ud56d\ubaa9\uc774 \uc5c6\uc2b5\ub2c8\ub2e4."],no_use:l["\uc0ac\uc6a9\uc548\ud568"],use:l["\uc0ac\uc6a9\uc911"],"return":l["\ubc18\ub0a9"],cancel:c["\ucde8\uc18c"],current:l["\ub0b4 \uc608\uc57d/\ub300\uc5ec \ud604\ud669"],asset:l["\uc790\uc0b0"],name:l["\uc774\ub984"],use_time:l["\uc774\uc6a9 \uc2dc\uac04"],use_calendar:l["\uce98\ub9b0\ub354 \uc5f0\ub3d9"],calcel_return:l["\ucde8\uc18c/\ubc18\ub0a9"],open:c["\uc5f4\uae30"],close:c["\ub2eb\uae30"],"\uc790\uc0b0 \uc608\uc57d \ud604\ud669":l["\uc790\uc0b0 \uc608\uc57d \ud604\ud669"],type:l["\uc608\uc57d \uc885\ub958"],repeat:l["\ubc18\ubcf5\uc608\uc57d"],normal:l["\uc77c\ubc18\uc608\uc57d"]};return t.View.extend({showProfile:function(t){var n=e(t.currentTarget).attr("data-userid");f.render(n,t.currentTarget)},initialize:function(){var e=r({isAvailableCal:!1,lang:p});this.$el.html(e)},events:{"click a[data-btntype='statusMove']":"statusMove","click span[data-btntype='returnRental']":"returnRental","click span[data-btntype='reservationCancel']":"reservationCancel","click span[data-type='profile']":"showProfile","click span.ic_classic":"_subAssetListToggle"},render:function(){var t=this;this.$("div[data-matrix-area]").html((new a).render().el);var n=s.getCollection("myReservation");n.on("reset",function(n){var r=t.makeTempleteMycondition({collection:n.toJSON()});t.$el.find("#myCondition").html(r),e("#myCondition tr:last, #myCondition tr:last td:last").addClass("last")})},returnRental:function(t){var n=this;e.goConfirm(p.use_return,p.is_return,function(){n.returnRentalAction(t)})},returnRentalAction:function(t){var n=e(t.currentTarget).parents("tr").first(),r=n.attr("data-assetid"),i=n.attr("data-itemid"),s=GO.contextRoot+"api/asset/"+r+"/item/"+i+"/reservation/return";e.go(s,"",{qryType:"PUT",contentType:"application/json",responseFn:function(){e(t.currentTarget).parents("tr").first().remove()}})},reservationCancel:function(t){var n=this;e.goConfirm(p.reservation_cancel,p.is_reservation_cancel,function(){n.reservationCancelActin(t)})},reservationCancelActin:function(t){var n=this,r=e(t.currentTarget).parents("tr").first(),i=r.attr("data-recurrence"),s=r.attr("data-reservationid");if(i){var o=GO.contextRoot+"api/asset/item/loop/reservation?"+e.param({reservationId:s,recurChange:"all"});e.go(o,"",{qryType:"DELETE",responseFn:function(){n.render()}})}else{var o=GO.contextRoot+"api/asset/item/reservation",u=[];u.push(s),e.go(o,JSON.stringify({ids:u}),{qryType:"DELETE",contentType:"application/json",responseFn:function(){n.render()}})}},statusMove:function(t){var r=e(t.currentTarget).parents("tr").first(),i=r.attr("data-assetid"),s=r.attr("data-itemid"),o=r.attr("data-reservationid"),u=r.attr("data-userental");u=="true"?n.router.navigate("asset/"+i+"/item/"+s+"/status/rental",!0):n.router.navigate("asset/"+i+"/item/"+s+"/status/reservation/"+o,!0)},makeTempleteMycondition:function(e){var t=e.collection,n=function(){if(this.groupStartTime!=undefined)return GO.util.basicDate3(this.groupStartTime)+"~ "+GO.util.basicDate3(this.groupEndTime);var e=GO.util.basicDate3(this.reservedStartTime),t="";return this.reservedEndTime&&(t=" ~ "+GO.util.basicDate3(this.reservedEndTime)),e+t},r=function(){return GO.util.hourMinute(this.reservedStartTime)},s=function(){return GO.util.hourMinute(this.reservedEndTime)},o=function(){return this.recurrenceParser=new u,this.recurrenceParser.parse(this.recurrenceText),this.recurrenceParser.humanize().split("(")[0]},a=function(){return GO.i18n(h["{{startDate}}\ubd80\ud130"],"startDate",GO.util.shortDate(this.recurrenceStartDate))},f=function(){return GO.i18n(h["{{endDate}}\uae4c\uc9c0"],"endDate",GO.util.shortDate(this.recurrenceEndDate))};return i({dataset:t,parseDate:n,text:o,recurrenceStartTime:r,recurrenceEndTime:s,startDate:a,endDate:f,isAvailableCal:!1,lang:p})},_subAssetListToggle:function(t){t.stopPropagation();var n=e(t.currentTarget),r=n.hasClass("ic_open");r?(n.removeClass("ic_open"),n.addClass("ic_close")):(n.removeClass("ic_close"),n.addClass("ic_open")),e(t.currentTarget).toggleClass("ic_open").toggleClass("ic_close"),e(t.currentTarget).attr("title",r?p.open:p.close);var i=n.closest("td").find("ul");if(_.isUndefined(i.attr("data-rendered"))){var s=n.closest("tr").attr("data-reservationid");this._renderSubAssetListView(i,s)}i.toggle(!r)},_renderSubAssetListView:function(t,n){e.ajax({url:GO.contextRoot+"api/asset/reservation/"+n,success:e.proxy(function(e){var n="{{#dataset}}<li {{#groupStartTime}}style='color: #0c43b7'{{/groupStartTime}}><span>{{parseDate}}</span>{{#groupStartTime}}<span style='margin: 5px' class='ic ic_info wrap_tool_tip'><span class='tool_tip top'>{{tooltipInfo}}</span></span>{{/groupStartTime}}</li>{{/dataset}}",r=function(){var e=GO.util.basicDate3(this.reservedStartTime),t=this.reservedEndTime?" ~ "+GO.util.basicDate3(this.reservedEndTime):"";return e+t},i=Hogan.compile(n).render({dataset:e.data,parseDate:r,tooltipInfo:l["\uc774 \uc608\uc57d\ub9cc \uc218\uc815\ub418\uc5c8\uc2b5\ub2c8\ub2e4."]});t.attr("data-rendered","").html(i)},this)})}})})})();