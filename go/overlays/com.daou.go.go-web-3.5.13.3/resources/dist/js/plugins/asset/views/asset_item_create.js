(function(){define(["jquery","backbone","app","i18n!nls/commons","i18n!asset/nls/asset","hgn!asset/templates/asset_item_create","hgn!asset/templates/asset_item_modify","asset/collections/asset_admin","asset/models/asset_admin","asset/models/asset_item","jquery.go-validation"],function(e,t,n,r,i,s,o,u,a,f){function m(e){v=e}function g(){return v}var l=2,c=30,h=GO.session(),p={asset_add:i["\uc790\uc0b0\ucd94\uac00"],asset_modify:i["\uc790\uc0b0\uc218\uc815"],code:i["\ucf54\ub4dc"],name:i["\uc774\ub984"],recurrence:i["\ubc18\ubcf5\uc608\uc57d"],ok:r["\ud655\uc778"],cancel:r["\ucde8\uc18c"],alert_delete:i["\ud56d\ubaa9 \uc0ad\uc81c"],alert_delete_info:i["\ud574\ub2f9 \ud56d\ubaa9\uc774 \uc0ad\uc81c\ub429\ub2c8\ub2e4.<br>\uc0ad\uc81c\ud558\uc2dc\uaca0\uc2b5\ub2c8\uae4c?"],"delete":r["\uc0ad\uc81c"],alert_code_name:i["\ucf54\ub4dc\uc640 \uc774\ub984\uc740 \ud544\uc218\uc785\ub2c8\ub2e4."],alert_code:i["\ucf54\ub4dc\ub294 \uc601\uc5b4\uc640 \uc22b\uc790\ub9cc \uac00\ub2a5\ud569\ub2c8\ub2e4."],use:r["\uc0ac\uc6a9\ud568"],not_use:r["\uc0ac\uc6a9\ud558\uc9c0 \uc54a\uc74c"],asset_limit:i["\uc608\uc57d \uc81c\ud55c \uc0ac\ud56d \uc124\uc815"],asset_limit_description:i["\ubc18\ubcf5 \uc608\uc57d\uc744 \ud560 \uc218 \uc788\ub294 \ucd5c\ub300 \uae30\uac04 \ubc0f \ud69f\uc218\ub97c \uc124\uc815\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4."],not_use_limit:i["\uc0ac\uc6a9\uc548\ud568"],recurence_count:i["\ud68c \ubc18\ubcf5"],recurence_yearly:i["\ub144 \ubc18\ubcf5"]},d=t.View.extend({el:"#content",initialize:function(){},unbindEvent:function(){this.$el.off("focus","input.w_max"),this.$el.off("blur","input.enter"),this.$el.off("click","a[data-btntype='itemSubmit']"),this.$el.off("click","a[data-btntype='itemCancel']"),this.$el.off("click","a[data-btntype='itemUpdate']"),this.$el.off("click","a[data-btntype='itemDelete']"),this.$el.off("click","input[name=use_recurrence]")},bindEvent:function(){this.$el.on("focus","input.w_max",e.proxy(this.inputFocus,this)),this.$el.on("blur","input.enter",e.proxy(this.inputBlur,this)),this.$el.on("click","a[data-btntype='itemSubmit']",e.proxy(this.createItem,this)),this.$el.on("click","a[data-btntype='itemCancel']",e.proxy(this.itemCancel,this)),this.$el.on("click","a[data-btntype='itemUpdate']",e.proxy(this.updateItem,this)),this.$el.on("click","a[data-btntype='itemDelete']",e.proxy(this.updateDelete,this)),this.$el.on("click","a[data-btntype='itemDelete']",e.proxy(this.updateDelete,this)),this.$el.on("click","input[name=use_recurrence]",e.proxy(this._onClickRecurrenceOption,this)),this.$el.on("click","input[type=radio][name=use]",e.proxy(this._onChangeRadio,this)),this.$el.on("keyup","input[type=text][name^=radio-use]",e.proxy(this._validateCount,this))},_validateCount:function(t){var n=e(t.currentTarget).val();if(!(n.length>0&&!/^(\d)+$/.test(n)))return;t.target.name==="radio-use-d"&&e(t.currentTarget).val(l),t.target.name==="radio-use-c"&&e(t.currentTarget).val(c)},itemCancel:function(){n.router.navigate("asset/"+this.assetId+"/admin/manage",!0)},render:function(e){var t=this;this.unbindEvent(),this.bindEvent(),this.assetId=e.assetId,this.itemId=e.itemId;var n=u.getCollection({assetId:this.assetId,type:"info"});n.on("reset",function(e,n){var r=t.makeTemplete({collection:e.toJSON()});t.$el.html(r),t.itemId&&(t.model=new f,t.model.clear(),t.model.set({assetId:t.assetId,itemId:t.itemId},{silent:!0}),t.model.fetch({async:!1}),t.setData(t.model))})},setData:function(t){e("#code").val(t.get("code")),e("#name").val(t.get("name"));if(t.get("useRecurrence")){e("#radio-use-recurrence-y").prop("checked",!0),e("input[type=radio][value="+t.get("limitRecurrence")+"]").prop("checked",!0);var n=e("input[name=use]:checked").attr("id");e("input[name="+n+"]").val(t.get("limitRecurrenceCount")),e("input[name="+n+"]").attr("disabled",!1)}else e("#radio-use-recurrence-n").prop("checked",!0),e("#recurrence-limit").hide();e.each(t.get("properties"),function(t,n){e('tr[data-id="'+n.attributeId+'"]').find("input").val(n.content)})},makeTemplete:function(e){var t=e.collection,n;return this.itemId?n=o({dataset:t,lang:p}):n=s({dataset:t,lang:p}),n},inputFocus:function(t){e(t.currentTarget).removeClass().addClass("txt w_max enter")},inputBlur:function(t){e(t.currentTarget).removeClass().addClass("txt w_max")},getData:function(){var t={name:e.trim(e("#name").val()),code:e("#code").val(),useRecurrence:e("#radio-use-recurrence-y").is(":checked")},n=[],r=e("#createPart").find("tr.attribute");r.each(function(){var t={};t.attributeId=e(this).attr("data-id"),t.content=e(this).find("input.txt").val(),n.push(t)}),t.properties=n;if(t.useRecurrence===!0){t.limitRecurrence=e("input[name=use]:checked").val();var i=e("input[name=use]:checked").attr("id");t.limitRecurrenceCount=e("input[name="+i+"]").val()}return t},createItem:function(){var t=this,r=this.getData();if(g())return;if(e("#code").val()==""||e("#name").val()==""){e.goMessage(p.alert_code_name);return}if(!e.goValidation.validateNumericAlpha(e("#code").val())){e.goMessage(p.alert_code);return}this.assetModel=new f,this.assetModel.clear(),this.assetModel.set({assetId:this.assetId}),m(!0),this.assetModel.save(r,{success:function(r,i){m(!1),e("#side").trigger("changeAssetItem"),n.router.navigate("asset/"+t.assetId+"/admin/manage",!0)}})},updateItem:function(){var t=this,r=this.getData();r.id=this.assetId;if(e("#code").val()==""||e("#name").val()==""){e.goMessage(p.alert_code_name);return}if(!e.goValidation.validateNumericAlpha(e("#code").val())){e.goMessage(p.alert_code);return}this.assetModel=new f,this.assetModel.clear(),this.assetModel.set({assetId:this.assetId,itemId:this.itemId}),this.assetModel.save(r,{success:function(r,i){e("#side").trigger("changeAssetItem"),n.router.navigate("asset/"+t.assetId+"/admin/manage",!0)}})},updateDelete:function(){var t=this;e.goConfirm(p.alert_delete,p.alert_delete_info,function(){var r=GO.contextRoot+"api/asset/"+t.assetId+"/item/"+t.itemId;e.go(r,{},{qryType:"DELETE",contentType:"application/json",responseFn:function(r){e("#side").trigger("changeAssetItem"),n.router.navigate("asset/"+t.assetId+"/admin/manage",!0)}})})},_onClickRecurrenceOption:function(t){var n=e(t.currentTarget);n.val()==="true"?e("#recurrence-limit").show():e("#recurrence-limit").hide()},_onChangeRadio:function(t){var n=t.target.id,r=e("input[name="+n+"]");e("input[type=text][name^=radio-use]").attr("disabled",!0),e("input[type=text][name^=radio-use]").attr("value",""),r.attr("disabled",!1),n==="radio-use-d"&&r.attr("value",l),n==="radio-use-c"&&r.attr("value",c)}},{__instance__:null,create:function(e){return this.__instance__=new this.prototype.constructor({assetId:e.assetId,itemId:e.itemId}),this.__instance__},render:function(e){var t=this.create(e),n=arguments.length>0?Array.prototype.slice.call(arguments):[];return this.prototype.render.apply(t,n)}}),v=!1;return d})}).call(this);