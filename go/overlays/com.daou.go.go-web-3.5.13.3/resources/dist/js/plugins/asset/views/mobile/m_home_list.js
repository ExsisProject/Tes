(function(){define(["views/mobile/m_more_list","jquery","backbone","app","i18n!nls/commons","views/mobile/header_toolbar","hgn!asset/templates/mobile/m_home_list","hgn!asset/templates/mobile/m_home_list_unit","asset/collections/home_list","i18n!asset/nls/asset","i18n!nls/commons","jquery.go-popup","GO.util","jquery.go-validation","jquery.placeholder","jquery.go-sdk"],function(e,t,n,r,i,s,o,u,a,f,i){var l=null,c={no_content:f["\uc608\uc57d/\ub300\uc5ec \uc911\uc778 \ud56d\ubaa9\uc774 \uc5c6\uc2b5\ub2c8\ub2e4."],item_count:i["\uc804\uccb4\uac2f\uc218"],admin:f["\uc6b4\uc601\uc790"],asset_current:f["\uc608\uc57d/\ub300\uc5ec \ud604\ud669"],asset_list:f["\uc790\uc0b0\ubaa9\ub85d"]},h=n.View.extend({el:"#content",unbindEvent:function(){this.$el.off("vclick","#tabWrap li"),this.$el.off("vclick","#assetHomeList>li.assetList"),this.$el.off("vclick","#assetHomeList>li.mycondition")},bindEvent:function(){this.$el.on("vclick","#tabWrap li",t.proxy(this.tabWrap,this)),this.$el.on("vclick","#assetHomeList>li.assetList",t.proxy(this.moveAssetItemList,this)),this.$el.on("vclick","#assetHomeList>li.mycondition",t.proxy(this.moveDetail,this))},initialize:function(){this.unbindEvent(),this.bindEvent(),this.headerToolBarView=s,GO.util.appLoading(!0);var e=o({lang:c});this.$el.html(e)},appendRenderList:function(){},moveDetail:function(e){e.preventDefault(),e.stopPropagation();var n=t(e.currentTarget),i=n.attr("data-assetid"),s=n.attr("data-itemid"),o=n.attr("data-reservationid"),u,a=n.attr("data-isrental"),f=n.attr("data-group");if(f=="true"){this.makeGroupTemplete(e);return}a=="true"?u=["asset",i,"item",s,"status","rental"]:u=["asset",i,"item",s,"status","reservation",o],r.router.navigate(u.join("/"),{trigger:!0,pushState:!0})},moveAssetItemList:function(e){e.preventDefault(),e.stopPropagation();var n=t(e.currentTarget),i=n.attr("data-assetid"),s=["asset",i,"list"];n.attr("data-type")=="true"?s.push("rental"):s.push("reservation"),r.router.navigate(s.join("/"),!0)},tabWrap:function(e){var n=t(e.currentTarget);t("#tabWrap li").removeClass("on"),n.addClass("on"),n.attr("data-type")=="currentList"?this.renderUnit("myReservation"):this.renderUnit("assetList")},initIscroll:function(){var e=this,t={pullDownAction:function(){},pullUpAction:function(){}};GO.EventEmitter.trigger("common","layout:initIscroll")},makeGroupTemplete:function(e){var n=t(e.currentTarget);if(n.find(".ic_arrow3_d").size()>0){n.find(".ic_arrow3_d").removeClass("ic_arrow3_d").addClass("ic_arrow3_t");var r=t(e.currentTarget).attr("data-reservationid");if(!r||r==undefined)return;t.go(GO.contextRoot+"api/asset/reservation/"+r,"",{async:!1,qryType:"GET",contentType:"application/json",responseFn:function(e){var r=e.data,i=!0,s={dataset:r,isCurrent:i,lang:c,isSubReservation:!0,groupid:n.attr("data-reservationid")},o=function(){var e=GO.util.formatDatetime(this.reservedStartTime,null,"MM.DD(ddd) HH:mm"),t="";return this.reservedEndTime&&(t=" ~ "+GO.util.formatDatetime(this.reservedEndTime,null,"MM.DD(ddd) HH:mm")),e+t},a=function(){var e=[];return t.each(this.managers,function(t,n){e.push(n.user.name)}),e.join(",")},f=function(){return GO.i18n(c.item_count,"num",this.itemCount)};i?s.parseDate=o:s.parseManager=a,s.parseItemCount=f;var l=u(s);n.after(l)},error:function(e){}})}else n.find(".ic_arrow3_t").removeClass("ic_arrow3_t").addClass("ic_arrow3_d"),n.parent().find("[data-groupid="+n.attr("data-reservationid")+"]").remove()},makeTemplete:function(e){var n=e.collection,r=e.isCurrent,i={dataset:n,isCurrent:r,lang:c},s=function(){if(this.groupStartTime!=undefined)return GO.util.formatDatetime(this.groupStartTime,null,"MM.DD(ddd) HH:mm")+"~ "+GO.util.formatDatetime(this.groupEndTime,null,"MM.DD(ddd) HH:mm");var e=GO.util.formatDatetime(this.reservedStartTime,null,"MM.DD(ddd) HH:mm"),t="";return this.reservedEndTime&&(t=" ~ "+GO.util.formatDatetime(this.reservedEndTime,null,"MM.DD(ddd) HH:mm")),e+t},o=function(){var e=[];return t.each(this.managers,function(t,n){e.push(n.user.name)}),e.join(",")},a=function(){return GO.i18n(c.item_count,"num",this.itemCount)};r?i.parseDate=s:i.parseManager=o,i.parseItemCount=a;var f=u(i);return f},getCollection:function(e){var t=a.getCollection(e);return t},renderUnit:function(e){t("#titleToolbar").html("");var n=this,r=this.getCollection(e),i=e=="myReservation"?!0:!1;r.on("reset",function(e,t){n.collection=e;var r=n.makeTemplete({collection:e.toJSON(),isCurrent:i});n.$el.find("#assetHomeList").html(r),n.initIscroll(),GO.util.appLoading(!1)})},render:function(){GO.util.pageDone();var e=this;t("#titleToolbar").hide(),this.headerToolBarView.render({title:f["\uc608\uc57d"],isList:!0,isHome:!0});var n=this.getCollection("myReservation");n.on("reset",function(n,r){n.toJSON().length<1?(e.renderUnit("assetList"),t("#tabWrap li").removeClass("on"),t("#tabWrap li").eq(1).addClass("on")):e.renderUnit("myReservation"),t("#btnHeaderSearch").hide()})}});return{render:function(){return l=new h,l.render()}}})}).call(this);