define(["jquery","backbone","app","hgn!asset/templates/asset_admin_guidance","asset/models/asset_guide","hgn!asset/templates/asset_attach_file","i18n!nls/commons","i18n!asset/nls/asset","file_upload","jquery.progressbar","go-webeditor/jquery.go-webeditor"],function(e,t,n,r,i,s,o,u,a){var f={info:u["\uccab \ud398\uc774\uc9c0\uc5d0 \ub098\uc624\ub294 \uc548\ub0b4\ubb38\uc744 \uc791\uc131\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4."],file_attach:u["\ud30c\uc77c\ucca8\ubd80"],ok:o["\ud655\uc778"],cancel:o["\ucde8\uc18c"],success:u["\uc131\uacf5\ud588\uc2b5\ub2c8\ub2e4."],save_ok:o["\uc800\uc7a5\ub418\uc5c8\uc2b5\ub2c8\ub2e4."]},l=null,c=t.View.extend({el:"#assetAdminPart",unbindEvent:function(){this.$el.off("click","span[data-btntype='guideSubmit']"),this.$el.off("click","span[data-btntype='guideCancel']"),this.$el.off("click","span.ic_del"),this.$el.off("click","#fileWrap span.name")},bindEvent:function(){this.$el.on("click","span[data-btntype='guideSubmit']",e.proxy(this.guideSubmit,this)),this.$el.on("click","span[data-btntype='guideCancel']",e.proxy(this.guideCancel,this)),this.$el.on("click","span.ic_del",e.proxy(this.attachDelete,this)),this.$el.on("click","#fileWrap span.name",e.proxy(this.attachDownload,this))},initialize:function(){this.unbindEvent(),this.bindEvent(),this.model=new i},attachDownload:function(t){var n=e(t.currentTarget);n.closest("li").attr("data-id")&&(location.href=GO.contextRoot+"api/asset/"+this.assetId+"/attach/"+n.closest("li").attr("data-id"))},attachDelete:function(t){e(t.target).parents("li").first().remove()},guideCancel:function(){this.render({assetId:this.assetId})},guideSubmit:function(){if(!GO.Editor.getInstance("description").validate())return e.goError(o["\ub9c8\uc784 \uc0ac\uc774\uc988 \ucd08\uacfc"]),!1;var t=GO.Editor.getInstance("description").getContent(),r={description:t},i=[],s=e("#fileWrap").find("li:not(.attachError)"),u;s.each(function(){u={},e(this).attr("data-tmpname")&&(u.path=e(this).attr("data-tmpname")),e(this).attr("data-name")&&(u.name=e(this).attr("data-name")),e(this).attr("data-id")&&(u.id=e(this).attr("data-id")),e(this).attr("host-id")&&(u.hostId=e(this).attr("host-id")),i.push(u)}),i.length>0&&(r.attaches=i),this.model.clear(),this.model.set({assetId:this.assetId,id:this.assetId},{silent:!1}),this.model.save(r,{success:function(t){n.router.navigate("asset/"+t.assetId+"/list/reservation",!0),e.goMessage(f.save_ok)}})},render:function(e){this.assetId=e.assetId,this.model.clear(),this.model.set({assetId:this.assetId},{silent:!0}),this.model.fetch({async:!1});var t=r({description:this.model.get("description"),lang:f});this.$el.html(t),this.initSWFUpload(),this.initSmartEditor(),this.model.get("attaches").length>0&&this.setAttachFile()},initSmartEditor:function(){var t=GO.session("locale");e("#description").goWebEditor({contextRoot:GO.config("contextRoot"),lang:t,editorValue:this.model.get("description")})},setAttachFile:function(){var t=[];e.each(this.model.get("attaches"),function(e,n){t.push(n)});var n=function(){var e=this.size,t=GO.util.getHumanizedFileSize(e);return t},r=function(){var e=new RegExp("(jpeg|jpg|png|gif|tif|bmp)","gi");return e.test(this.extention)?!0:!1};this.$el.find("#fileWrap").html(s({dataset:t,sizeCal:n,isImgFile:r,modify:!0}))},initSWFUpload:function(){var t=this,n=f.file_attach;options={el:"#swfupload-control",context_root:GO.contextRoot,button_text:"<span class='buttonText'>"+n+"</span>",url:"api/file?GOSSOcookie="+e.cookie("GOSSOcookie")},(new a(options)).queue(function(e,t){}).start(function(e,t){}).progress(function(e,t){}).success(function(t,n,r){var i="",s="";if(GO.util.fileUploadErrorCheck(n))i="<strong class='caution'>"+GO.util.serverMessage(n)+"</strong>",s="attachError";else if(GO.util.isFileSizeZero(n))return e.goAlert(GO.util.serverMessage(n)),!1;var o=n.data,u=o.filePath,a=o.fileName,f=o.hostId,l=o.fileExt.toLowerCase(),c=GO.util.getHumanizedFileSize(o.fileSize),h="",p=l;h='<li class="'+s+'" data-tmpname="'+u+'" data-name="'+a+'" host-id="'+f+'">'+'<span class="item_file">'+'<span class="ic_file ic_'+p+'"></span>'+'<span class="name">'+a+"</span>"+'<span class="size">('+c+")</span>"+'<span class="btn_wrap">'+'<span class="ic_classic ic_del"></span>'+"</span>"+i+"</span>"+"</li>",e("#fileWrap").append(h)}).complete(function(e,t){console.info(t)}).error(function(e,t){console.info(t)})}},{create:function(e){return l=new c,l.render(e)}});return{render:function(e){var t=c.create(e);return t}}});