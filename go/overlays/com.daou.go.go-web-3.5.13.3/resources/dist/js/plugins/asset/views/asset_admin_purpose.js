define(["jquery","backbone","app","hgn!asset/templates/asset_admin_purpose","asset/models/asset_admin","asset/collections/asset_admin","i18n!nls/commons","i18n!asset/nls/asset"],function(e,t,n,r,i,s,o,u){var a={info:u["\uc774\uc6a9\uc790\uac00 \uc790\uc0b0\uc744 \uc608\uc57d \ub610\ub294 \ub300\uc5ec\uc2dc \uc785\ub825 \ubc1b\uc744 \uc815\ubcf4\ub97c \uc124\uc815\ud569\ub2c8\ub2e4."],asset_add:u["\ucd94\uac00\ud558\uae30"],input_info:u["\uc774\uc6a9\uc790 \uc785\ub825 \uc815\ubcf4"],del:o["\uc0ad\uc81c"],ok:o["\ud655\uc778"],cancel:o["\ucde8\uc18c"],success:u["\uc131\uacf5\ud588\uc2b5\ub2c8\ub2e4."],alert_purpose:u["\uc774\uc6a9\uc790 \uc785\ub825\uc815\ubcf4\ub97c \uc785\ub825\ud558\uc138\uc694."],save_ok:o["\uc800\uc7a5\ub418\uc5c8\uc2b5\ub2c8\ub2e4."]},f=null,l=t.View.extend({el:"#assetAdminPart",unbindEvent:function(){this.$el.off("click","a[data-btntype='purposeAdd']"),this.$el.off("focus","input.comp"),this.$el.off("blur","input.enter"),this.$el.off("click","span[data-btntype='purposeDel']"),this.$el.off("click","span[data-btnype='purposeSubmit']"),this.$el.off("click","span[data-btnype='purposeCancel']")},bindEvent:function(){this.$el.on("click","a[data-btntype='purposeAdd']",e.proxy(this.purposeAdd,this)),this.$el.on("focus","input.comp",e.proxy(this.inputFocus,this)),this.$el.on("blur","input.enter",e.proxy(this.inputBlur,this)),this.$el.on("click","span[data-btntype='purposeDel']",e.proxy(this.purposeDel,this)),this.$el.on("click","span[data-btnype='purposeSubmit']",e.proxy(this.savePurpose,this)),this.$el.on("click","span[data-btnype='purposeCancel']",e.proxy(this.cancelPurpose,this))},initialize:function(){this.unbindEvent(),this.bindEvent()},render:function(e){this.assetId=e.assetId;var t=this;this.unbindEvent(),this.bindEvent();var n=s.getCollection({assetId:this.assetId,type:"reservation"});n.on("reset",function(e,n){var r=t.makeTemplete({collection:e.toJSON()});t.$el.html(r)})},makeTemplete:function(e){var t=e.collection,n=r({dataset:t,lang:a});return n},purposeAdd:function(){var t=e("#purposeText").val();if(e.trim(t)==""){e.goMessage(a.alert_purpose);return}var n='<tr class="attribute"><td><span class="txt_edit"><span class="wrap_txt"><label></label><input class="txt comp" type="text" value="'+t+'" /></span>'+"</span>"+"</td>"+'<td class="align_c"><span class="btn"><span class="ic_side ic_basket_bx" title="\uc0ad\uc81c" data-btntype="purposeDel"></span></span></td>'+"</tr>";e("#purposePart").append(n),e("#purposeText").val("")},purposeDel:function(t){var n=e(t.currentTarget);n.parents("tr").first().remove()},inputFocus:function(t){e(t.currentTarget).removeClass().addClass("txt enter")},inputBlur:function(t){e(t.currentTarget).removeClass().addClass("txt comp")},savePurpose:function(){var t=this,n={},r=[],s=e("#purposePart").find("tr.attribute");s.each(function(){var t={};t.id=e(this).attr("data-attrid"),t.name=e.trim(e(this).find("input.txt").val()),t.visibility=!0,r.push(t)}),n.attributes=r,this.assetModel=new i,this.assetModel.set({id:this.assetId,assetId:this.assetId,urlPart:"attribute/reservation"}),this.assetModel.save(n,{success:function(n,r){e.goMessage(a.save_ok),t.render({assetId:t.assetId})}})},cancelPurpose:function(){this.render({assetId:this.assetId})}},{create:function(e){return f=new l,f.render(e)}});return{render:function(e){var t=l.create(e);return t}}});