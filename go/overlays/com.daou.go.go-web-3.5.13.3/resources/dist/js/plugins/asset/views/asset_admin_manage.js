define(["jquery","backbone","app","hgn!asset/templates/asset_admin_manage","hgn!asset/templates/asset_admin_manage_list","asset/collections/asset_admin","asset/collections/asset_item_list_manage","i18n!nls/commons","i18n!asset/nls/asset","jquery.go-grid"],function(e,t,n,r,i,s,o,u,a){var f={asset_add:a["\uc790\uc0b0\ucd94\uac00"],code:a["\ucf54\ub4dc"],name:a["\uc774\ub984"],recurrence:a["\ubc18\ubcf5\uc608\uc57d"],setting:a["\uc124\uc815"],asset_name:a["\uc790\uc0b0\uc774\ub984"],search:u["\uac80\uc0c9"],alert_keyword:u["\uac80\uc0c9\uc5b4\ub97c \uc785\ub825\ud558\uc138\uc694."],no_asset:a["\uc774\uc6a9\uac00\ub2a5\ud55c \uc790\uc0b0\uc774 \uc5c6\uc2b5\ub2c8\ub2e4."],asset_reorder:u["\uc21c\uc11c \ubc14\uafb8\uae30"],asset_reorder_save:u["\uc21c\uc11c\ubc14\uafb8\uae30 \uc644\ub8cc"],use:u["\uc0ac\uc6a9"],not_use:u["\uc0ac\uc6a9\ud558\uc9c0 \uc54a\uc74c"]},l=null,c=t.View.extend({el:"#assetAdminPart",unbindEvent:function(){this.$el.off("click","a[data-btntype='assetItemAdd']"),this.$el.off("click","span[data-btntype='settingItem']"),this.$el.off("click","a.btnAssetSortable")},bindEvent:function(){this.$el.on("click","a[data-btntype='assetItemAdd']",e.proxy(this.assetItemAdd,this)),this.$el.on("click","span[data-btntype='settingItem']",e.proxy(this.settingItem,this)),this.$el.on("click","a.btnAssetSortable",e.proxy(this.bindListSortableToggle,this))},initialize:function(){},render:function(e){this.unbindEvent(),this.bindEvent();var t=this;this.assetId=e.assetId,this.attributesLen,this.assetRecurrence;var n=s.getCollection({assetId:this.assetId,type:"info"});n.on("reset",function(e,n){t.attributesLen=e.models[0].get("attributes").length,t.assetRecurrence=e.models[0].get("useRecurrence");var r=t.makeTemplete({collection:e.toJSON()});t.$el.html(r),t.renderAssetList()})},renderAssetList:function(){var e=this,t={offset:999,page:0,assetId:this.assetId},n=o.getCollection(t);n.on("reset",function(t,n){var r=i({dataset:t.toJSON(),attributesLen:this.attributesLen+3,assetRecurrence:e.assetRecurrence,lang:f});e.$el.find("#assetList").html(r)})},bindListSortableToggle:function(t){var n=this;e(t.currentTarget).toggle(function(){n.bindListSortable(t)},function(){n.actionListSortPut(t)}).click()},bindListSortable:function(e){this.$el.find(".btnAssetSortable").addClass("btn_save").find("span.txt").html(f.asset_reorder_save),this.$el.find('a[data-btntype="assetItemAdd"]').hide(),this.$el.find("tbody").removeClass().sortable({opacity:"1",delay:100,cursor:"move",items:"tr",containment:".content_page",hoverClass:"ui-state-hover",placeholder:"ui-sortable-placeholder",start:function(e,t){t.placeholder.html(t.helper.html()),t.placeholder.find("td").css("padding","5px 10px")}})},actionListSortPut:function(t){var n=this,r=this.$el.find("tbody"),i=r.find("tr").map(function(t,n){return e(n).attr("data-id")}).get();this.$el.find("tbody").sortable("destroy"),this.$el.find(".btnAssetSortable").removeClass("btn_save").find("span.txt").html(f.asset_reorder),this.$el.find('a[data-btntype="assetItemAdd"]').show(),e.ajax({type:"PUT",async:!0,data:JSON.stringify({ids:i}),dataType:"json",contentType:"application/json",url:GO.config("contextRoot")+"api/asset/"+n.assetId+"/item",success:function(t){e.goMessage(u["\uc800\uc7a5\ub418\uc5c8\uc2b5\ub2c8\ub2e4."]),n.renderAssetList()},error:function(t){e.goMessage(u["\uc800\uc7a5\uc5d0 \uc2e4\ud328 \ud558\uc600\uc2b5\ub2c8\ub2e4."])}})},makeTemplete:function(e){var t=e.collection,n=r({dataset:t,lang:f});return n},assetItemAdd:function(){n.router.navigate("asset/"+this.assetId+"/create",!0)},settingItem:function(t){var r=e(t.currentTarget);n.router.navigate("asset/"+this.assetId+"/modify/"+r.attr("data-id"),!0)}},{create:function(e){return l=new c,l.render(e)}});return{render:function(e){var t=c.create(e);return t}}});