(function(){define(["backbone","hogan","app","i18n!nls/commons","i18n!task/nls/task","collections/circle_nodes","jquery.go-grid"],function(e,t,n,r,i,s){var o={desc1:i["\ud604\uc7ac \uc5c5\ubb34 \ud3f4\ub354\uc758 \uacf5\uac1c/\uacf5\uc720 \ud604\ud669\uc744 \uc54c\ub824\ub4dc\ub9bd\ub2c8\ub2e4"],desc2:i["\ud604\uc7ac \uc5c5\ubb34 \ud3f4\ub354\uc758 \uacf5\uac1c \ud604\ud669\uc744 \uc54c\ub824\ub4dc\ub9bd\ub2c8\ub2e4"],dept:i["\ubd80\uc11c"],deptShare:i["\ubd80\uc11c\uacf5\uac1c\uc5ec\ubd80"],member:i["\uba64\ubc84\ud655\uc778"],confirm:r["\ud655\uc778"],shareInfo:i["\uacf5\uac1c \ud604\ud669"],close:r["\ub2eb\uae30"],shareTarget:i["\uacf5\uac1c \ub300\uc0c1"],all:i["\uc804\uccb4 \uc5f4\ub78c"],partial:i["\ubd80\ubd84 \uc5f4\ub78c"],show:r["\ubcf4\uae30"],shareSubdept:i["\ud558\uc704\ubd80\uc11c\uacf5\uc720"]},u=t.compile('<p class="desc">{{lang.desc1}}</p><table id="shareList" class="type_normal"><thead><tr><th class="sorting_desc"><span class="title_sort">{{lang.dept}}<ins class="ic"></ins><span class="selected"></span></span></th><th class="sorting"><span class="title_sort">{{lang.deptShare}}<ins class="ic"></ins></span></th><th class="sorting"><span class="title_sort">{{lang.shareSubdept}}<ins class="ic"></ins></span></th><th class="sorting"><span class="title_sort">{{lang.member}}<ins class="ic"></ins></span></th></tr></thead><tbody></tbody></table>'),a=t.compile('<p class="desc">{{lang.desc2}}</p><table id="publicList" class="type_normal"><thead><tr><th class="sorting"><span class="title_sort">{{lang.shareTarget}}<ins class="ic"></ins></span></th></tr></thead><tbody></tbody></table>'),f=t.compile('<tr class="detail_info" data-id="{{id}}"><td colspan="4"><ul class="name_tag">{{#members}}<li class="default_option">{{.}}</li>{{/members}}</ul></td></tr>'),l=e.View.extend({el:"#sharePopupContent",events:{"click a[data-tag=showMembers]":"showMembers","click a[data-tag=editFolder]":"goFolderEdit"},initialize:function(e){this.options=e||{},this.parent=e.parent,this.folder=this.options.folder,this.circles=new s({type:"tree"})},render:function(){return this.folder.get("publicShare")?(this.$el.html(a.render({lang:o})),this.renderList("public")):(this.$el.html(u.render({lang:o})),this.renderList("share")),this.renderButton(),this},showMembers:function(e){var t=this,n=$(e.currentTarget),i=$(e.currentTarget).attr("data-id"),s=this.$("tr[data-id='"+i+"']");if(s.length){var o=s.is(":visible"),u=o?r["\ubcf4\uae30"]:r["\uc811\uae30"];s.toggle(!o),n.text(u),t.parent.reoffset()}else this.circles.fetch({data:JSON.stringify(this.folder.get("share")),type:"POST",contentType:"application/json",success:function(e){var s=e.getCircle(i),o=s.getMemberNames();n.parents("tr").after(f.render({members:o,id:i})),n.text(r["\uc811\uae30"]),t.parent.reoffset()}})},getColumns:function(e){return e=="share"?[{mData:null,sClass:"",bSortable:!1,fnRender:function(e){return"<span>"+e.aData.nodeValue+"</span>"}},{mData:null,sClass:"",bSortable:!1,fnRender:function(e){var t=e.aData.members.length?i["\ubd80\ubd84 \uc5f4\ub78c"]:i["\uc804\uccb4 \uc5f4\ub78c"];return"<span>"+t+"</span>"}},{mData:null,sClass:"",bSortable:!1,fnRender:function(e){var t=e.aData.nodeType=="subdepartment"?"O":"X";return"<span>"+t+"</span>"}},{mData:null,sClass:"",bSortable:!1,fnRender:function(e){return'<a data-tag="showMembers" class="btn_fn7" data-id="'+e.aData.nodeId+'">'+r["\ubcf4\uae30"]+"</a>"}}]:[{mData:null,sClass:"",bSortable:!1,fnRender:function(e){return"<span>"+e.aData.nodeValue+"</span>"}}]},renderList:function(e){var t=this;$.goGrid({el:"#"+e+"List",url:GO.contextRoot+"api/task/folder/"+this.folder.get("id")+"/share",displayLength:5,displayLengthSelect:!1,emptyMessage:"",defaultSorting:[],sDomUse:!0,columns:t.getColumns(e),fnDrawCallback:function(e,n,r){t.parent.reoffset()}})},renderButton:function(){var e='<div class="tool_bar"><div class="critical"><a class="btn_tool" data-role="button" data-tag="editFolder"><span class="ic_toolbar modify"></span><span class="txt">'+r["\ud3b8\uc9d1"]+"</span>"+"</a>"+"</div>"+"</div>";this.$el.find("table").after(e)},goFolderEdit:function(){GO.util.store.set("taskFolderId",null,{type:"session"}),n.router.navigate("task/folder/"+this.folder.id,!0)}});return l})}).call(this);