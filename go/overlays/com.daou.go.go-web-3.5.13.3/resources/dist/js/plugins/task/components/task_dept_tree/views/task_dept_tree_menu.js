define("task/components/task_dept_tree/views/task_dept_tree_menu",function(require){var e=require("app"),t=require("task/components/task_dept_tree/views/base_task_dept_tree_menu"),n=require("text!task/components/task_dept_tree/templates/task_dept_tree_menu.html"),r=require("models/dept_descendants_tree");require("jquery"),require("jquery.go-popup");var i=t.extend({template:n,events:{"click .open":"_onClickToggleNode","click .close":"_onClickToggleNode"},getTemplateVars:function(e,n){var r=t.prototype.getTemplateVars.apply(this,arguments);return r.nodeId=e.data.id,r},_onClickToggleNode:function(e){var t=$(e.currentTarget),n=t.closest("li"),i=t.hasClass("close")?!0:!1;e.stopImmediatePropagation(),this.toggleNode(n);if(!i&&n.has("ul").length<=0){var s=new r({deptId:n.data("id")});s.fetch({async:!1});var o=new this.constructor({nodes:s.get("children"),deptId:s.get("data").id,parentId:s.get("data").parentId}),u=this;_.each(this.taskTreeNodes,function(e){e.data.id==s.get("data").id&&(e.children=s.toJSON().children)},this),o.render(),n.append(o.el)}}});return i});