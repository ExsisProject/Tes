define(["backbone","task/models/task"],function(e,t){var n=e.Collection.extend({model:t,initialize:function(e){this.options=e||{},this.type=e?e.type:null},url:function(){return GO.contextRoot+"api/task/"+this.type+"?"+$.param(this.listOption)},listOption:{page:0,offset:20},fetchAll:function(){var e=this,t=$.Deferred();this.listOption.offset=1,this.setType("referred");var n=this.fetch().done(function(t){e.referredCount=t.page.total});this.setType("approvable");var r=this.fetch().done(function(t){e.approvableCount=t.page.total});this.setType("assigned");var i=this.fetch().done(function(t){e.assignedCount=t.page.total});this.setType("requested");var s=this.fetch().done(function(t){e.requestedCount=t.page.total});return $.when(n,r,i,s).done(function(){e.totalCount=e.referredCount+e.approvableCount+e.assignedCount+e.requestedCount,e.listOption.offset=20,e.setType("associated"),e.fetch().done(function(){t.resolve()})}),t},isEmpty:function(){return this.page.total==0},setType:function(e){this.type=e},length:function(){return this.models.length},setPage:function(e){this.listOption.page=e},getPageInfo:function(){var e=this.listOption.page,t=this.page.total,n=this.listOption.offset,r=t>0,i=e==0,s=this.page.lastPage,o=e*n+1,u=s?t:(e+1)*n;return{hasTodos:r,lastIndex:u,firstIndex:o,isPossiblePrev:!i,isPossibleNext:!s,total:t}}});return n});