(function(){define(["backbone","app","i18n!nls/commons","i18n!task/nls/task","hgn!task/templates/closed_folder_list","task/collections/closed_folders","task/views/task_title","task/views/side","grid","jquery.go-grid","jquery.go-orgslide"],function(e,t,n,r,i,s,o,u,a){var f=e.View.extend({events:{"click a[data-tag=deleteTaskBtn]":"deleteConfirm","click a[data-tag=restartTaskBtn]":"restartConfirm","click a[data-tag=transferTaskBtn]":"callOrg","click a[data-tag=goFolder]":"goFolder"},initialize:function(){this.collection=new s},render:function(){this.$el.addClass("go_renew"),this.$el.html(i());var e=new o({title:r["\uc911\uc9c0\ub41c \uc5c5\ubb34 \ud3f4\ub354"]});return this.$el.find(".content_top").html(e.el),e.render(),this.renderList(),this.renderButton(),this},callOrg:function(){if($("input[type=checkbox][data-id]:checked").length==0)return;var e=this;$.goOrgSlide({type:"department",contextRoot:GO.contextRoot,callback:$.proxy(function(t){var n='<p class="add">'+GO.i18n(r["\ud3f4\ub354 \uc774\uad00 \uacbd\uace0"],{arg1:t.name})+"</p>";$.goConfirm(n,"",function(){e.transferFolder(t.id)})},this)})},renderButton:function(){var e='<a class="btn_tool" data-role="button" data-tag="deleteTaskBtn"><span class="txt_caution txt_normal">'+n["\uc0ad\uc81c"]+"</span>"+"</a>"+'<a class="btn_tool" data-role="button" data-tag="restartTaskBtn">'+'<span class="txt">'+r["\uc815\uc0c1 \uc0c1\ud0dc\ub85c \ubcc0\uacbd"]+"</span></a>"+'<a class="btn_tool" data-role="button" data-tag="transferTaskBtn">'+'<span class="txt">'+n["\ud3f4\ub354 \uc774\uad00"]+"</span>"+"</a>";this.$("div.critical").append(e)},getQueryString:function(){var e="";return _.each($("input[type=checkbox][data-id]:checked"),function(t){e=e+"id="+$(t).attr("data-id")+"&"}),e},getIds:function(){var e=[];return _.each($("input[type=checkbox][data-id]:checked"),function(t){e.push(parseInt($(t).attr("data-id")))}),{ids:e}},isNotSelected:function(){var e=$("input[type=checkbox]:checked");return e.length?!1:!0},deleteConfirm:function(){if(this.isNotSelected())return;var e=this;$.goPopup({title:r["\ud3f4\ub354 \uc0ad\uc81c"],message:r["\ud3f4\ub354 \uc0ad\uc81c \uc124\uba85"],buttons:[{btype:"confirm",btext:n["\ud655\uc778"],callback:function(){e.deleteFolder()}},{btext:n["\ucde8\uc18c"],callback:function(){}}]})},deleteFolder:function(){var e=this;$.ajax({type:"DELETE",dataType:"json",url:GO.contextRoot+"api/task/folder?"+e.getQueryString(),success:function(t){$.goMessage(n["\uc0ad\uc81c\ub418\uc5c8\uc2b5\ub2c8\ub2e4."]),e.render()},error:function(e){$.goError(e.responseJSON.message)}})},restartConfirm:function(){if(this.isNotSelected())return;var e=this;$.goPopup({title:r["\uc815\uc0c1 \uc0c1\ud0dc\ub85c \ubcc0\uacbd"],message:r["\uc815\uc0c1 \uc0c1\ud0dc\ub85c \ubcc0\uacbd \uc124\uba85"],buttons:[{btype:"confirm",btext:n["\ud655\uc778"],callback:function(){e.restartFolder()}},{btext:n["\ucde8\uc18c"],callback:function(){}}]})},restartFolder:function(){var e=this;$.ajax({type:"PUT",dataType:"json",url:GO.contextRoot+"api/task/folder/restart?"+e.getQueryString(),success:function(t){GO.util.store.set("sideItem","closedFolder",{type:"session"}),u.render(),$.goMessage(n["\ubcc0\uacbd\ub418\uc5c8\uc2b5\ub2c8\ub2e4."]),e.render()},error:function(e){$.goError(e.responseJSON.message)}})},transferFolder:function(e){if(this.isNotSelected())return;var t=this;$.go(GO.contextRoot+"api/task/folder/transfer/dept/"+e,JSON.stringify(t.getIds()),{contentType:"application/json",qryType:"put",responseFn:function(e){GO.util.store.set("sideItem","closedFolder",{type:"session"}),u.render(),$.goMessage(r["\uc774\uad00\ub418\uc5c8\uc2b5\ub2c8\ub2e4."]),t.render()},error:function(e){$.goError(e.responseJSON.message)}})},goFolder:function(e){var n=$(e.currentTarget).attr("data-id");t.router.navigate("task/folder/"+n+"/task",!0)},renderList:function(e){this.gridView=new a({el:"#closedListWrapper",collection:this.collection,tableClass:"type_normal list_task list_task001 dataTable",columns:[{name:"closedAt",className:"period",sortable:!0,label:r["\uc5c5\ubb34 \uae30\uac04"],render:function(e){return'<span class="date">'+GO.util.shortDate(e.get("createdAt"))+" ~ "+GO.util.shortDate(e.get("closedAt"))+"</span>"}},{name:null,className:"subject",sortable:!1,label:n["\ubd80\uc11c\uba85"],render:function(e){return'<span class="txt">'+e.get("departmentName")+"</span>"}},{name:"name",className:"subject",sortable:!0,label:r["\ud3f4\ub354 \uc81c\ubaa9"],render:function(e){return'<a data-tag="goFolder" data-id="'+e.id+'">'+'<span class="txt">'+e.get("name")+"</span>"+"</a>"}},{name:null,className:"num",sortable:!1,label:r["\uc5c5\ubb34\uc218"],render:function(e){return'<span class="num">'+e.get("taskCount")+"</span>"}}]}),this.gridView.render(),this.collection.fetch()}});return f})}).call(this);