(function(){define(["backbone","app","i18n!nls/commons","i18n!task/nls/task","hgn!task/templates/sub_dept_folder_list","task/collections/task_department_folders","task/views/task_title","jquery.go-grid"],function(e,t,n,r,i,s,o){var u={normal:r["\uc815\uc0c1"],stop:n["\uc911\uc9c0"],allSubDept:r["\ud558\uc704\ubd80\uc11c \uc804\uccb4"],deptName:n["\ubd80\uc11c\uba85"],folderName:r["\ud3f4\ub354 \uc81c\ubaa9"],admin:r["\uc6b4\uc601\uc790"],taskCount:r["\uc5c5\ubb34\uc218"],createdAt:r["\uac1c\uc124\uc77c"],setting:n["\uc124\uc815"]},a=Hogan.compile('<span class="wrap_select"><select id="selectDepts"><option value="">{{lang.allSubDept}}</option>{{#subDepts}}<option value="{{id}}">{{name}}</option>{{/subDepts}}</select></span>'),f=e.View.extend({events:{"change #selectDepts":"changeDept","click span.ic_setup":"goEditFolder","click span[data-tag=folder]":"goFolder","click li[data-tag=stateTab]":"changeTab"},initialize:function(e){this.status=e.status||"Live",this.listOption={status:this.status,page:0,size:20}},dataFetch:function(){var e=this;return $.ajax({type:"GET",dataType:"json",url:GO.contextRoot+"api/department/descendant",success:function(t){e.subDepts=t.data},error:function(e){$.goError(e.responseJSON.message)}})},render:function(){this.$el.addClass("go_renew"),this.$el.html(i({lang:u,isLive:this.status=="Live"}));var e=new o({title:r["\ud558\uc704 \ubd80\uc11c \uc5c5\ubb34 \ud3f4\ub354"]});return this.$el.find(".content_top").html(e.el),e.render(),this.renderList(),this.renderButton(),this},renderButton:function(){$("div.tool_bar:first").append(a.render({lang:u,subDepts:this.subDepts}))},goEditFolder:function(e){GO.util.store.set("taskFolderId",null,{type:"session"});var n=e.currentTarget.getAttribute("data-id");t.router.navigate("task/folder/"+n,!0)},goFolder:function(e){GO.util.store.set("taskFolderId",null,{type:"session"});var n=e.currentTarget.getAttribute("data-id");t.router.navigate("task/folder/"+n+"/task",!0)},changeDept:function(e){var t=$(e.target).val();t==""?delete this.listOption.subDeptId:this.listOption.subDeptId=t,this.render(),$("#selectDepts").val(t)},changeTab:function(e){var t=$(e.currentTarget),n=t.attr("data-status");if(this.status==n)return;$("li[data-tag=stateTab]").toggleClass("active"),this.status=n,this.listOption.status=n;var r=GO.contextRoot+"api/task/folder/subdept?"+$.param(this.listOption);this.dataTable.tables.fnSettings().sAjaxSource=r,this.dataTable.tables.fnClearTable()},renderList:function(){var e=this;this.dataTable=$.goGrid({el:"#subDeptFolderList",url:GO.contextRoot+"api/task/folder/subdept?"+$.param(e.listOption),displayLength:e.listOption.size,emptyMessage:'<tr style="display:"><td colspan="6"><p class="data_null"> <span class="ic_data_type ic_no_contents"></span><span class="txt">'+r["\ubaa9\ub85d\uc774 \uc5c6\uc2b5\ub2c8\ub2e4"]+"</span>"+"</p>"+"</td>"+"</tr>",defaultSorting:[],sDomUse:!0,columns:[{mData:"departmentName",sClass:"part",bSortable:!0,fnRender:function(e){return'<span class="txt">'+e.aData.departmentName+"</span>"}},{mData:"name",sClass:"subject",bSortable:!0,fnRender:function(e){return'<span class="txt" data-tag="folder" data-id="'+e.aData.id+'"><a>'+e.aData.name+"</a></span>"}},{mData:null,sClass:"name",bSortable:!1,fnRender:function(t){return'<span class="txt">'+e.userLabel(t.aData.admins)+"</span>"}},{mData:"taskCount",sClass:"num",bSortable:!0,fnRender:function(e){return'<span class="num">'+e.aData.taskCount+"</span>"}},{mData:"createdAt",sClass:"date",bSortable:!0,fnRender:function(e){return'<span class="date">'+GO.util.basicDate2(e.aData.createdAt)+"</span>"}},{mData:null,sClass:"setting",bSortable:!1,fnRender:function(e){return'<a class="btn_bdr"><span class="ic_classic ic_setup" data-id="'+e.aData.id+'" title="'+n["\uc124\uc815"]+'"></span></a>'}}],fnDrawCallback:function(t,n,r){e.$el.find(".dataTables_paginate").css("padding-top","40px")}})},userLabel:function(e){if(e.length==0)return"";var t=e[0].name+" "+e[0].position||"";return e.length>1&&(t=t+" "+r["\uc678"]+" "+(e.length-1)+n["\uba85"]),t}});return f})}).call(this);