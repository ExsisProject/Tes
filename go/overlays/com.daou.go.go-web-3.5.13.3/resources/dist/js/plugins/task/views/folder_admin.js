(function(){define(["backbone","app","i18n!nls/commons","i18n!task/nls/task","hgn!task/templates/folder_admin","task/models/task_department_folder","task/models/task_folder","task/views/task_title","task/views/side","jquery.ui","jquery.go-sdk","jquery.go-orgslide"],function(e,t,n,r,i,s,o,u,a){var f={stop:n["\uc911\uc9c0"],edit:n["\uc218\uc815"],save:n["\uc800\uc7a5"],"delete":n["\uc0ad\uc81c"],cancel:n["\ucde8\uc18c"],setting:n["\uc124\uc815"],addSeparator:n["\uad6c\ubd84\uc120 \ucd94\uac00"],transferFolder:n["\ud3f4\ub354 \uc774\uad00"],setOrder:r["\uc21c\uc11c \ubc14\uafb8\uae30"],orderComplte:r["\uc21c\uc11c\ubc14\uafb8\uae30 \uc644\ub8cc"],taskFolderName:r["\uc5c5\ubb34 \ud3f4\ub354\uba85"],admin:r["\uc6b4\uc601\uc790"],createdAt:r["\uac1c\uc124\uc77c"],taskCount:r["\uc5c5\ubb34\uc218"],isEmpty:r["\ubaa9\ub85d\uc774 \uc5c6\uc2b5\ub2c8\ub2e4"]},l=Hogan.compile('<tr data-type="folder" data-folderId="{{folder.id}}"><td class="checkbox"><input type="checkbox" data-folderId="{{folder.id}}"></td><td class="subject"><a data-tag="folder" data-folderId="{{folder.id}}"><span class="txt">{{folder.name}}</span></a></td><td class="name"><span class="txt">{{adminLabel}}</span></td><td class="date"><span class="date">{{createdAt}}</span></td><td class="num"><span class="num">{{folder.taskCount}}</span></td><td class="setting"><span class="wrap_btn_m" data-tag="setting" data-folderId="{{folder.id}}"><span class="ic_setting"></span></span></td></tr>'),c=Hogan.compile('<tr data-type="separator"><td colspan="6" class="depart_bg align_l" data-tag="view">&lt;<span class="title_depart vm" data-tag="content">{{separator.name}}</span>&gt;<span class="btn_fn7 vm" data-tag="editSeparator">{{lang.edit}}</span><span class="btn_fn7 vm" data-tag="deleteSeparator">{{lang.delete}}</span></td><td colspan="6" class="depart_bg align_l" data-tag="edit" style="display:none;"><input type="text" class="input w_medium vm">&nbsp;<span class="btn_fn7 vm save" data-tag="saveSeparator">{{lang.save}}</span>&nbsp;<span class="btn_fn7 vm cancel" data-tag="cancelSeparator">{{lang.cancel}}</span></td></tr>'),h=e.View.extend({events:{"click span[data-tag=editSeparator]":"editSeparator","click span[data-tag=deleteSeparator]":"deleteSeparator","click span[data-tag=saveSeparator]":"saveSeparator","click span[data-tag=cancelSeparator]":"cancelSeparator","click span[data-tag=setting]":"goFolderSetting","click a[data-tag=folder]":"goFolder","click a[data-tag=order]":"orderList","click a[data-tag=orderComplete]":"orderComplete","click a[data-tag=separator]":"addSeparator","click a[data-tag=close]":"closeConfirm","click a[data-tag=delete]":"deleteConfirm","click a[data-tag=transfer]":"callOrg","click #checkAllAdmin":"checkAll"},initialize:function(e){this.options=e||{},this.dept=new s(this.options),this.defaultSeparator={name:r["\uad6c\ubd84\uc120"],separator:!0}},dataFetch:function(){return this.dept.fetch({statusCode:{400:function(){GO.util.error("404",{msgCode:"400-common"})},403:function(){GO.util.error("403",{msgCode:"400-common"})},404:function(){GO.util.error("404",{msgCode:"400-common"})},500:function(){GO.util.error("500")}}})},render:function(){this.$el.addClass("go_renew"),this.$el.html(i({dept:this.dept.toJSON(),lang:f,isEmpty:this.dept.isEmptyfolder()}));var e=new u({title:r["\uc5c5\ubb34 \ud3f4\ub354 \uad00\ub9ac"],subTitle:this.dept.get("name")});return this.$el.find(".content_top").html(e.el),e.render(),this.renderList(),this},renderList:function(){var e=this.$el.find("tbody");_.each(this.dept.get("folders"),function(t){if(!t.deptId)e.append(c.render({lang:f,separator:t}));else{var i=new o(t);e.append(l.render({folder:i.toJSON(),adminLabel:i.minAdminLabel(r["\uc678"],n["\uba85"]),createdAt:GO.util.basicDate2(i.get("createdAt"))}))}},this)},orderList:function(){this.$el.find("a[data-tag=order]").hide(),this.$el.find("a[data-tag=orderComplete]").show(),this.$el.find("tbody").removeClass().sortable({opacity:"1",delay:100,cursor:"move",items:"tr",containment:".content_page",hoverClass:"ui-state-hover",forceHelperSize:"true",helper:"clone",placeholder:"ui-sortable-placeholder",start:function(e,t){t.placeholder.html("<td colspan='5'>&nbsp;</td>")}})},combinedItems:function(){return _.map($("tbody").find("tr"),function(e){return $(e).attr("data-type")=="folder"?_.find(this.dept.getFolders(),function(t){return t.id==$(e).attr("data-folderId")}):{name:$(e).find("span[data-tag=content]").text(),separator:!0}},this)},submit:function(e){var t=this,n=$.Deferred(),r=this.combinedItems();return $.go(GO.contextRoot+"api/task/folder/dept/"+t.dept.get("id")+"/",JSON.stringify(r),{contentType:"application/json",qryType:"put",responseFn:function(r){GO.util.store.set("sideItem","department"+t.dept.id,{type:"session"}),a.render(),$.goMessage(e),n.resolve()},error:function(e){$.goError(e.responseJSON.message)}}),n},orderComplete:function(){var e=this;this.submit(n["\ubcc0\uacbd\ub418\uc5c8\uc2b5\ub2c8\ub2e4."]).done(function(){e.dept.fetch().done(function(){e.render()})})},addSeparator:function(){this.$el.find("tbody").append(c.render({lang:f,separator:this.defaultSeparator})),this.submit(r["\ucd94\uac00\ub418\uc5c8\uc2b5\ub2c8\ub2e4."])},editSeparator:function(e){var t=$(e.currentTarget).parents("tr"),n=t.find("span[data-tag=content]").text();t.find("td[data-tag=view]").hide(),t.find("td[data-tag=edit]").show(),t.find("input").val(n)},deleteSeparator:function(e){$(e.currentTarget).parents("tr[data-type=separator]").remove(),this.submit(n["\uc0ad\uc81c\ub418\uc5c8\uc2b5\ub2c8\ub2e4."])},saveSeparator:function(e){var t=$(e.currentTarget).parents("tr"),r=t.find("input").val();t.find("td[data-tag=view]").show(),t.find("td[data-tag=edit]").hide(),t.find("span[data-tag=content]").text(r),this.submit(n["\ubcc0\uacbd\ub418\uc5c8\uc2b5\ub2c8\ub2e4."])},cancelSeparator:function(e){var t=$(e.currentTarget).parents("tr");t.find("td[data-tag=view]").show(),t.find("td[data-tag=edit]").hide(),t.find("input").val("")},goFolder:function(e){var n=$(e.currentTarget).attr("data-folderId");GO.util.store.set("sideItem","departmentFolder"+n,{type:"session"}),GO.util.store.set("taskFolderId",null,{type:"session"}),t.router.navigate("task/folder/"+n+"/task",!0)},goFolderSetting:function(e){var n=$(e.currentTarget).attr("data-folderId");GO.util.store.set("sideItem","departmentFolder"+n,{type:"session"}),GO.util.store.set("taskFolderId",null,{type:"session"}),t.router.navigate("task/folder/"+n,!0)},checkAll:function(e){var t=$(e.currentTarget).is(":checked");$("input[type=checkbox][data-folderId]").attr("checked",t)},getQueryString:function(){var e="";return _.each($("input[type=checkbox][data-folderId]:checked"),function(t){e=e+"id="+$(t).attr("data-folderId")+"&"}),e},isNotSelected:function(){var e=$("input[type=checkbox][data-folderId]:checked");return e.length?!1:!0},closeConfirm:function(){var e=this;this.isNotSelected()?$.goAlert(r["\uc911\uc9c0\ud560 \ud3f4\ub354\ub97c \uc120\ud0dd\ud574\uc8fc\uc138\uc694."]):$.goPopup({title:r["\ud3f4\ub354 \uc911\uc9c0"],message:r["\ud3f4\ub354 \uc911\uc9c0 \uc124\uba85"],buttons:[{btype:"confirm",btext:n["\ud655\uc778"],callback:function(){e.closeFolders()}},{btext:n["\ucde8\uc18c"],callback:function(){}}]})},closeFolders:function(){var e=this;$.ajax({type:"PUT",dataType:"json",url:GO.contextRoot+"api/task/folder/stop?"+e.getQueryString(),success:function(e){$.goMessage(n["\ubcc0\uacbd\ub418\uc5c8\uc2b5\ub2c8\ub2e4."]),GO.util.store.set("sideItem","closedFolder",{type:"session"}),GO.util.store.set("taskFolderId",null,{type:"session"}),t.router.navigate("task/dept/close",!0)},error:function(e){$.goError(e.responseJSON.message)}})},deleteConfirm:function(){var e=this;this.isNotSelected()?$.goAlert(r["\uc0ad\uc81c\ud560 \ud3f4\ub354\ub97c \uc120\ud0dd\ud574\uc8fc\uc138\uc694."]):$.goPopup({title:r["\ud3f4\ub354 \uc0ad\uc81c"],message:r["\ud3f4\ub354 \uc0ad\uc81c \uc124\uba85"],buttons:[{btype:"confirm",btext:n["\ud655\uc778"],callback:function(){e.deleteFolders()}},{btext:n["\ucde8\uc18c"],callback:function(){}}]})},deleteFolders:function(){var e=this;$.ajax({type:"DELETE",dataType:"json",url:GO.contextRoot+"api/task/folder?"+e.getQueryString(),success:function(t){GO.util.store.set("sideItem","department"+e.dept.id,{type:"session"}),a.render(),$.goMessage(n["\uc0ad\uc81c\ub418\uc5c8\uc2b5\ub2c8\ub2e4."]),e.dept.fetch({success:function(){e.render()}})},error:function(e){$.goError(e.responseJSON.message)}})},transferFolder:function(e){if(this.isNotSelected())return;var t=this;$.go(GO.contextRoot+"api/task/folder/transfer/dept/"+e,JSON.stringify(t.getIds()),{contentType:"application/json",qryType:"put",responseFn:function(e){GO.util.store.set("sideItem","department"+t.dept.id,{type:"session"}),a.render(),$.goMessage(r["\uc774\uad00\ub418\uc5c8\uc2b5\ub2c8\ub2e4."]),t.dept.fetch({success:function(){t.render()}})},error:function(e){$.goError(e.responseJSON.message)}})},getIds:function(){var e=[];return _.each($("input[type=checkbox][data-folderId]:checked"),function(t){e.push(parseInt($(t).attr("data-folderId")))}),{ids:e}},callOrg:function(){var e=this;this.isNotSelected()?$.goAlert(r["\uc774\uad00\ud560 \ud3f4\ub354\ub97c \uc120\ud0dd\ud574\uc8fc\uc138\uc694."]):$.goOrgSlide({type:"department",contextRoot:GO.contextRoot,callback:$.proxy(function(t){var n='<p class="add">'+GO.i18n(r["\ud3f4\ub354 \uc774\uad00 \uacbd\uace0"],{arg1:t.name})+"</p>";$.goConfirm(n,"",function(){e.transferFolder(t.id)})},this)})}});return h})}).call(this);