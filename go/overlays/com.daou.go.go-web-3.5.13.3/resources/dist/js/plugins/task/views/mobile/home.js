(function(){define(["views/mobile/m_more_list","backbone","app","i18n!nls/commons","i18n!task/nls/task","hgn!task/templates/mobile/home","task/collections/todos","views/mobile/header_toolbar","jquery.go-preloader"],function(e,t,n,r,i,s,o,u){var a={myTodo:i["\ub098\uc758 \uc5c5\ubb34"],count:i["\uac74"],total:i["\ucd1d"],all:r["\uc804\uccb4"],assign:i["\ub2f4\ub2f9"],approve:i["\uc2b9\uc778"],refer:i["\ucc38\uc870"],request:i["\ub4f1\ub85d"],showMore:i["\ub354 \ubcf4\uae30"],prev:i["\uc774\uc804"],next:i["\ub2e4\uc74c"],activity:i["\ud65c\ub3d9\uae30\ub85d"],empty:i["\ubbf8\uc9c0\uc815"]},f='<li class="creat data_null"><span class="txt_ellipsis">'+i["\ub4f1\ub85d\ub41c \uc5c5\ubb34\uac00 \uc5c6\uc2b5\ub2c8\ub2e4."]+"</span></li>",l=Hogan.compile('<li class="{{^isRead}}read_no{{/isRead}}" id="{{task.id}}" data-type="task" data-list-id="{{task.id}}"><a class="tit" data-list-id="{{task.id}}"><span class="state etc">{{task.status.name}}</span><span class="subject">{{#isPrivate}}<span class="ic ic_lock"></span>{{/isPrivate}}<span class="title">{{task.name}}</span></span><span class="info"><span class="reporter txt_ellipsis">{{#assignee}}{{assigneeLabel}}{{/assignee}}{{^assignee}}{{lang.empty}}{{/assignee}}</span><span class="part">|</span>{{#hasDueDate}}<span class="date {{#isDelay}}delay{{/isDelay}}">{{dueDate}}</span><span class="part">|</span>{{/hasDueDate}}<span class="category txt_ellipsis">{{task.folderName}}</span><span class="part">|</span><span class="activity"><span class="txt_b">{{lang.activity}} </span><span class="num">{{task.activityCount}}</span></span></span></a></li>'),c=e.extend({el:"#content",events:{"vclick #taskTypes li":"tab","vclick li[data-type=task]":"goTaskDetail"},initialize:function(){this.$el.off(),GO.util.appLoading(!0),this.todos=new o({type:"associated"}),this.$el.html(s({lang:a}));var e={listFunc:$.proxy(function(e){this.renderTodos(e)},this),emptyListFunc:$.proxy(function(){this.$("#todoList").append(f),this.$("#moreTodos").remove()},this)};this.setRenderListFunc(e);var t={};this.setFetchInfo(t,this.todos)},render:function(){return setTimeout(function(){GO.util.pageDone()},500),this.dataFetch().done($.proxy(function(e){e.isEmpty()?this.renderListFunc.emptyListFunc():(this.renderListFunc.listFunc(e),this.scrollToEl())},this)),u.render({title:i["\uc5c5\ubb34"],isList:!0,isSideMenu:!0,isHome:!0,isSearch:!0,isWriteBtn:!0,writeBtnCallback:function(){n.router.navigate("task/create",{trigger:!0,pushState:!0})}}),GO.util.appLoading(!1),this},renderTodos:function(e){_.each(e.models,function(e){this.$("#todoList").append(l.render({lang:a,task:e.toJSON(),dueDate:e.getDueDate(),hasDueDate:e.hasDueDate(),activityFlag:e.hasActivity(),assignee:e.firstAssignee(),assigneeLabel:e.assigneeLabel(i["\uc678"],r["\uba85"]),isPrivate:e.get("privateTask"),isDelay:e.get("delay"),isRead:e.get("read")}))},this)},tab:function(e){var t=$(e.currentTarget),n=t.attr("data-type");if(this.pageType==n)return;this.$("#taskTypes").find("li").removeClass("on"),t.addClass("on"),this.$("#todoList").find("li").remove(),this.renderTaskByType(n),this.pageType=n,this.setCurrentPage()},renderTaskByType:function(e){this.todos.setType(e),this.todos.setPage(0),this.dataFetch().done($.proxy(function(e){e.isEmpty()?this.renderListFunc.emptyListFunc():this.renderListFunc.listFunc(e)},this))},goTaskDetail:function(e){this.setSessionInfo(e);var t=e.currentTarget.getAttribute("id");n.router.navigate("task/"+t+"/detail",!0)},setCurrentPage:function(){var e=this.todos.getPageInfo();$("#todoCurrent").text(e.firstIndex),$("#todoMax").text(e.lastIndex)}});return c})}).call(this);