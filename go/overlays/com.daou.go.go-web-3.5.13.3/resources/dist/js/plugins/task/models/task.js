define(["backbone","task/models/task_folder"],function(e,t){var n=e.Model.extend({initialize:function(e){this.id=e?e.id:null},urlRoot:function(){return"/api/task"},isDelay:function(){if(this.get("dueDate")===undefined)return!1;var e=GO.util.toMoment(this.get("dueDate")),t=GO.util.now();return e<t&&!this.get("status").end?!0:!1},hasActivity:function(){return this.get("activityCount")>0?!0:!1},hasBeginDate:function(){return this.get("beginDate")?!0:!1},hasDueDate:function(){return this.get("dueDate")?!0:!1},getShortBeginDate:function(){return this.get("beginDate")?GO.util.shortDate(this.get("beginDate")):""},getBeginDate:function(){return this.get("beginDate")?GO.util.basicDate2(this.get("beginDate")):""},getShortDueDate:function(){return this.get("dueDate")?GO.util.shortDate(this.get("dueDate")):""},getDueDate:function(){return this.get("dueDate")?GO.util.basicDate2(this.get("dueDate")):""},firstAssignee:function(){var e=this.get("assignees"),t=_.find(e,function(e){return e.id==GO.session().id});return t||e[0]},assigneeLabel:function(e,t){var n=this.get("assignees");if(n.length==0)return"-";var r=this.firstAssignee(),i=r.name;return n.length==1?i=i+" "+r.position||"":n.length>1&&(i=i+" "+e+" "+(n.length-1)+t),i},creatorLabel:function(){var e=this.get("creator");return e.name+" "+e.position||""},getEditableAttribute:function(){var e=$.Deferred(),t={APPROVER:!0,ASSIGNEE:!0,CONTENT:!0,DUEDATE:!0,FIELD:!0,NAME:!0,PRIVATETASK:!0,REFERER:!0,TAG:!0},n;if(this.get("id"))n=this.get("id")+"/attribute/editable";else{var r=this.get("issueType").id;if(!r)return e.resolve(t);n="attribute/writable/"+this.get("issueType").id}return $.ajax({type:"GET",async:!1,url:GO.contextRoot+"api/task/"+n,success:function(n){var r=_.keys(t),i=_.difference(r,n.data);_.each(n.data,function(e){t[e]=!0}),_.each(i,function(e){t[e]=!1}),e.resolve(t)}}),e},getAction:function(){var e=this,t=$.Deferred();return $.ajax({type:"GET",url:GO.contextRoot+"api/task/"+this.get("id")+"/action",success:function(n){e.actions=n.data,t.resolve(n.data)}}),t},hasAction:function(){return this.actions&&this.actions.length>0},getUpdatedAt:function(){return this.get("id")?GO.util.toISO8601(new Date):null},getTagLabel:function(){return this.get("tags").join(", ")},isReadable:function(){return this.get("actions").readable},parsedAttaches:function(){return _.each(this.get("attaches"),function(e){e.icon=GO.util.getFileIconStyle(e),e.fileSizeString=GO.util.getHumanizedFileSize(e.size)})},getFiles:function(){return _.filter(this.parsedAttaches(),function(e){return!GO.util.isImage(e.extention)})},getImages:function(){return _.filter(this.parsedAttaches(),function(e){return GO.util.isImage(e.extention)})},hasEvent:function(){var e=this.get("calendarEvent");return e?!0:!1},getEventStartDate:function(){return this.hasEvent()?GO.util.basicDate(this.get("calendarEvent").startTime):""},getEventEndDate:function(){return this.hasEvent()?GO.util.basicDate(this.get("calendarEvent").endTime):""},getEventSummary:function(){return this.hasEvent()?this.get("calendarEvent").summary:""},getEventLocation:function(){return this.hasEvent()?this.get("calendarEvent").location:""},getCalendarId:function(){return this.hasEvent()?this.get("calendarEvent").calendarId:""},getEventType:function(){return this.hasEvent()?this.get("calendarEvent").type:""},getEventId:function(){return this.hasEvent()?this.get("calendarEvent").id:""},getCalendarTimeType:function(){return this.hasEvent()?this.get("calendarEvent").timeType:""},getCalendarEventCreator:function(){return this.hasEvent()?this.get("calendarEvent").creator:null}});return n});