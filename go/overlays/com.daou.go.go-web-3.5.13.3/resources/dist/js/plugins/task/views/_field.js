(function(){define(["backbone","hogan","i18n!nls/commons","i18n!task/nls/task","hgn!task/templates/field_setting","task/views/_field_option"],function(e,t,n,r,i,s){var o={add:n["\ucd94\uac00"],"delete":n["\uc0ad\uc81c"],setting:n["\uc124\uc815"],defaultValue:r["\uae30\ubcf8\uac12"],optionName:r["\ud56d\ubaa9\uba85"],type:r["\ud0c0\uc785"],inputOption:r["\uc785\ub825\uc635\uc158"],require:r["\uc5c5\ubb34 \ub4f1\ub85d \uc2dc \ud544\uc218 \uc785\ub825 \uc0ac\ud56d"],optional:r["\uc120\ud0dd\uc0ac\ud56d"],detail:r["\uc138\ubd80\ud56d\ubaa9"],inputOptionName:r["\ud56d\ubaa9\uba85 \uc785\ub825"],letters:r["\uc790"],addOptionName:r["\ud56d\ubaa9\uba85 \ucd94\uac00"],defaultMessage:r["\uae30\ubcf8\uba54\uc2dc\uc9c0"],checkState:r["\uccb4\ud06c \uc0c1\ud0dc"],nonChecked:r["\uccb4\ud06c\ud558\uc9c0 \uc54a\uc74c"],typeDesc:r["\ud0c0\uc785\uc740 \ubcc0\uacbd\ud560 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4."],detailDesc:r["\uc138\ubd80 \ud56d\ubaa9 \uc124\uba85"]},u=t.compile('<td class="subject"><span class="txt">{{data.name}}</span></td><td class="type"><span class="txt">{{data.typeText}}</span></td><td class="essential"><span class="txt">{{data.requiredText}}</span></td><td class="detail">{{#data.detail}}{{#value}}<span class="txt">{{value}}{{#defaultValue}}<strong>({{lang.defaultValue}})</strong>{{/defaultValue}}</span>{{/value}}{{#value}}<br>{{/value}}{{/data.detail}}</td><td class="mgmt"><span class="wrap_btn_m"><span class="ic_setting" title="{{lang.setting}}"></span></span> <span class="wrap_btn_m"><span class="ic_side ic_basket_bx" title="{{lang.delete}}"></span></span></td>'),a=e.View.extend({tagName:"tr",events:{"click span.ic_setting":"fieldPopup","click span.ic_basket_bx":"destroy"},initialize:function(e){this.dataSet=this.dataParser(e),this.render()},render:function(){this.$el.html(u.render({data:this.dataSet,lang:o})),this.$el.attr("id",this.dataSet.id)},dataParser:function(e){return{id:e.id,name:e.name,type:e.type,typeText:this._getFieldType(e.type),required:e.required,requiredText:e.required?r["\ud544\uc218"]:n["\uc120\ud0dd"],defaultValue:e.defaultValue,options:e.options,message:e.message,detail:this.getDetail(e),isSelectType:this._isSelectType(e.type),isBooleanType:this._isBooleanType(e.type),isTextType:this._isTextType(e.type)}},getDetail:function(e){if(this._isSelectType(e.type))return $.map(e.options,function(t){return dataSet={value:t,defaultValue:t==e.defaultValue}});if(this._isBooleanType(e.type))return[{value:e.message,defaultValue:!1},{value:e.defaultValue?r["\uccb4\ud06c \uc0c1\ud0dc"]:r["\uccb4\ud06c\ud558\uc9c0 \uc54a\uc74c"],defaultValue:!0}];if(this._isTextType(e.type)){if(e.message=="")return;return dataSet=[{value:e.message,defaultValue:!1}]}return""},fieldPopup:function(){var e=this;this.popup=$.goPopup({modal:!0,pclass:"layer_normal layer_task_type",header:r["\ud56d\ubaa9 \uc218\uc815"],width:500,contents:i({data:this.dataSet,lang:o}),buttons:[{btext:n["\ud655\uc778"],btype:"confirm",autoclose:!1,callback:function(){if(!e.popupValidate())return;var t=e.getModifyData();e.dataSet=e.dataParser(t),e.$el.html(u.render({data:e.dataSet,lang:o})),e.$el.data("instance",t),e.popup.close()}},{btext:n["\ucde8\uc18c"],btype:"cancel"}]}),this.popupViewBind()},popupValidate:function(){var e=!0,t=$("#fieldName");if(t.val().length>40||t.val().length<2)$.goError(GO.i18n(n["0\uc790\uc774\uc0c1 0\uc774\ud558 \uc785\ub825\ud574\uc57c\ud569\ub2c8\ub2e4."],{arg1:2,arg2:40}),t,!1,!0),e=!1;var r=$("#message");return r.val()&&r.val().length>200&&($.goError(GO.i18n(n["\ucd5c\ub300 {{arg1}}\uc790 \uae4c\uc9c0 \uc785\ub825\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4."],{arg1:200}),$("#message"),!1,!0),e=!1),_.each(this.getDetailOptions(),function(t){if(!$(t).val()||$(t).val().length>200){var r=GO.i18n(n["0\uc790\uc774\uc0c1 0\uc774\ud558 \uc785\ub825\ud574\uc57c\ud569\ub2c8\ub2e4."],{arg1:1,arg2:200});$.goError(r,$(t),!1,!0),e=!1}}),e},getModifyData:function(){var e=$.map($("#optionList").find("tr"),function(e){return $(e).find("#option").val()}),t={id:this.dataSet.id,name:$("#fieldName").val(),type:this.dataSet.type,required:$("#required").find("input[name=require]:checked").val()=="true"?!0:!1,defaultValue:this.getDefaultValue(),options:e,message:$("#message").val()==""?null:$("#message").val()};return this._isSelectType(this.dataSet.type)&&!e.length&&(t.required=!1),t},getDefaultValue:function(){return this._isSelectType(this.dataSet.type)?$("#optionList").find("input[name=option]:checked").parents("tr:first").find("#option").val():this._isBooleanType(this.dataSet.type)?$("#defaultValue").find("input[name=defaultValue]:checked").val()=="true"?!0:!1:""},popupViewBind:function(){var e=this;this.popup.find("span.ic_basket_bx").on("click",function(t,n){e.destroyOption(t)}),this.popup.find("#addOption").on("click",function(t,n){$("#optionList").find("tr").length<30?(e.addOption(),e.popup.reoffset()):$.goError(r["\uc138\ubd80\ud56d\ubaa9 30\uac1c"],$("#detailError"),!1,!0)}),this.popup.find("#optionInput").on("keyup",function(t,n){e.optionLengthCheck(t)}),this.popup.find("input[name=option]").on("click",function(t,n){e.uniqCheckbox(this)})},checkboxRebind:function(){var e=this;$("input[name=option]").off("click"),$("input[name=option]").on("click",function(t,n){e.uniqCheckbox(this)})},destroyOption:function(e){$(e.target).parents("tr:first").remove()},addOption:function(){var e=$("#optionInput").val();if(e=="")return;if(e.length>200){$.goError(GO.i18n(n["\ucd5c\ub300 {{arg1}}\uc790 \uae4c\uc9c0 \uc785\ub825\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4."],{arg1:"200"}),$("#detailError"),!1,!0);return}var t=_.map(this.getDetailOptions(),function(e){return $(e).val()});if(_.contains(t,e)){$.goError(r["\uc138\ubd80\ud56d\ubaa9\uc774 \uc774\ubbf8 \uc874\uc7ac\ud569\ub2c8\ub2e4."],$("#detailError"),!1,!0);return}var i=new s({name:e});$("#optionList").append(i.el),$("#optionInput").val(""),$("#optionInputLength").text(0),this.checkboxRebind()},optionLengthCheck:function(e){var t=$(e.target);$("#"+t.attr("id")+"Length").text(t.val().length)},uniqCheckbox:function(e){$(e).is(":checked")&&$("input[name=option]").not(e).attr("checked",!1)},destroy:function(){var e=this;$.goConfirm(n["\uc0ad\uc81c\ud558\uc2dc\uaca0\uc2b5\ub2c8\uae4c?"],"",function(){e.$el.remove()})},getDetailOptions:function(){return $("input[data-tag=optionInput]")},_getFieldType:function(e){return this._isSelectType(e)?r["\uc120\ud0dd\ud615"]:this._isBooleanType(e)?r["\ud655\uc778\ud615"]:this._isTextType(e)?r["\ud14d\uc2a4\ud2b8\ud615"]:""},_isSelectType:function(e){return e=="SELECT"},_isBooleanType:function(e){return e=="BOOLEAN"},_isTextType:function(e){return e=="TEXT"}});return a})}).call(this);