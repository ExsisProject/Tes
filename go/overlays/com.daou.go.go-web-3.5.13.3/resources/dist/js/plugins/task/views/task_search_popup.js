(function(){define(["backbone","app","i18n!nls/commons","i18n!task/nls/task","hgn!task/templates/task_search_popup","task/collections/task_departments","task/collections/task_folders"],function(e,t,n,r,i,s,o){var u={context:n["\uc704\uce58"],status:r["\uc0c1\ud0dc"],all:n["\uc804\uccb4"],keyword:n["\uac80\uc0c9\uc5b4"],title:n["\uc81c\ubaa9"],detail:r["\uc0c1\uc138\ub0b4\uc6a9"],activity:r["\ud65c\ub3d9\uae30\ub85d"],comment:n["\ub313\uae00"],assignee:r["\ub2f4\ub2f9\uc790"],register:r["\ub4f1\ub85d\uc790"],term:n["\uae30\uac04"],week:n["\uc8fc\uc77c"],directly:r["\uc9c1\uc811\uc120\ud0dd"],attachName:n["\ucca8\ubd80\ud30c\uc77c \uba85"],attachContent:n["\ucca8\ubd80\ud30c\uc77c \ub0b4\uc6a9"]},a=e.View.extend({tagName:"form",events:{"change #departments":"changeDepartment","change #folders":"changeFolder","change input[type=radio]":"changeTerm"},initialize:function(){this.departments=new s,this.folders=new o},dataFetch:function(){return this.departments.fetch()},render:function(){this.$el.html(i({lang:u,departments:this.departments.toJSON()})),$.datepicker.setDefaults($.datepicker.regional[GO.config("locale")]),this.renderDatePicker()},renderDatePicker:function(){this.$("#fromDate").datepicker({yearSuffix:"",dateFormat:"yy-mm-dd",changeMonth:!0,changeYear:!0}),this.$("#toDate").datepicker({yearSuffix:"",dateFormat:"yy-mm-dd",changeMonth:!0,changeYear:!0})},changeDepartment:function(e){var t=this,n=$(e.currentTarget).val(),r=n=="all";this.$("#foldersWrap").toggle(!r),this.$("#statusWrap").toggle(!r),r?(this.folders.reset([]),this.$("#folders").empty()):(this.folders.setDeptId(n),this.folders.fetch().done(function(e){t.renderFolders(e.data);var n=t.folders.getIds();t.getStatus(n)}))},getStatus:function(e){var t=this,n=$.Deferred();this.status=[],e.length?$.ajax({url:GO.contextRoot+"api/task/statuses?"+$.param({folderId:e}),success:function(e){t.status=e.data,n.resolve()}}):n.resolve(),n.done(function(){t.renderStatus(t.status)})},renderFolders:function(e){this.$("#folders").empty(),this.$("#folders").append("<option value='all'>"+n["\uc804\uccb4"]+"</option>"),_.each(e,function(e){var t="<option value='"+e.id+"'>"+e.name+"</option>";this.$("#folders").append(t)},this)},renderStatus:function(e){this.$("#status").empty(),this.$("#status").append("<option value=''>"+n["\uc804\uccb4"]+"</option>"),_.each(e,function(e){var t="<option value='"+e+"'>"+e+"</option>";this.$("#status").append(t)},this)},changeFolder:function(e){var t=[],n=this.$("#folders").val();n=="all"?t=this.folders.getIds():t.push(n),this.getStatus(t)},changeTerm:function(e){var t=$(e.currentTarget).attr("id")=="radioDirectly";this.$("input[data-type=datepicker]").prop("disabled",!t),this.renderDatePicker(),t&&this.$("input[data-type=datepicker]").val(GO.util.shortDate(new Date))},getSearchParam:function(){var e=this.getSearchTerm(),t=this.getFolders(),n=$.trim($("#stext").val()),r={stype:"detail",name:this.$("#name").attr("checked")?n:"",content:this.$("#content").attr("checked")?n:"",activityContents:this.$("#activityContents").attr("checked")?n:"",comments:this.$("#comments").attr("checked")?n:"",assignees:this.$("#assignees").val(),attachFileNames:this.$("#attachFileNames").attr("checked")?n:"",attachFileContents:this.$("#attachFileContents").attr("checked")?n:"",creator:this.$("#creator").val(),fromDate:e.fromDate,toDate:e.toDate,folderIds:t.ids,statusName:this.$("#status").val(),folderNames:t.names.join(", "),termName:this.$el.find("input[type=radio]:checked").siblings().text()};return r},getSearchTerm:function(){var e=this.$el.find("input[type=radio]:checked").val(),t=GO.util.shortDate(new Date),n=GO.util.toISO8601("1970/01/01"),r=GO.util.toISO8601(new Date);return e=="-1"||e=="-2"?n=GO.util.calDate(t,"weeks",e):e=="directly"&&(n=GO.util.toISO8601($("#fromDate").val()),r=GO.util.searchEndDate($("#toDate").val())),{fromDate:n,toDate:r}},getFolders:function(){var e=this.$("#folders"),t=[],n=[];return e.val()=="all"?(t=_.map(e.find("option:gt(0)"),function(e){return $(e).val()}),n=_.map(e.find("option:gt(0)"),function(e){return $(e).text()})):e.val()&&(t.push(e.val()),n.push(e.find("option:selected").text())),{ids:t,names:n}},validate:function(){var e=0,r=$.trim($("#creator").val()),i=$.trim($("#assignees").val()),s=$.trim($("#stext").val()),o=[r,i,s];for(var u=0;u<o.length;u++)if(o[u]!=""){$.goValidation.isCheckLength(2,64,o[u])||($.goError(t.i18n(n["0\uc790\uc774\uc0c1 0\uc774\ud558 \uc785\ub825\ud574\uc57c\ud569\ub2c8\ub2e4."],{arg1:"2",arg2:"64"})),e+=1);if($.goValidation.isInValidEmailChar(o[u])){$.goMessage(n["\uba54\uc77c \uc0ac\uc6a9 \ubd88\uac00 \ubb38\uc790"]);return}}var a=!1;return $("input[type=checkbox]").each(function(){this.checked&&(a=!0)}),s&&!a&&($.goError(n["\uac80\uc0c9\uc5b4 \uad6c\ubd84\uc744 \uc120\ud0dd\ud574\uc8fc\uc138\uc694."]),e+=1),e==0?!0:!1}});return a})}).call(this);