(function(){define(["views/mobile/m_more_list","backbone","hogan","app","i18n!nls/commons","i18n!task/nls/task","task/collections/tasks","task/models/task_folder","views/mobile/header_toolbar"],function(e,t,n,r,i,s,o,u,a){var f={total:s["\ucd1d"],count:s["\uac74"],addr:s["\ud3f4\ub354 \uc8fc\uc18c"],copy:i["\ubcf5\uc0ac"],showShareInfo:s["\uacf5\uac1c/\uacf5\uc720 \ud604\ud669 \ubcf4\uae30"],admin:s["\uc6b4\uc601\uc790"],state:s["\uc0c1\ud0dc"],title:i["\uc81c\ubaa9"],dueDate:s["\uae30\ud55c"],assignee:s["\ub2f4\ub2f9\uc790"],activity:s["\ud65c\ub3d9\uae30\ub85d"],prev:s["\uc774\uc804"],next:s["\ub2e4\uc74c"],notReadable:s["\uc5f4\ub78c \uad8c\ud55c\uc774 \uc5c6\ub294 \uc5c5\ubb34\uc785\ub2c8\ub2e4"],empty:s["\ubbf8\uc9c0\uc815"]},l=n.compile('<div class="content"><ul id="taskList" class="list_normal list_task" data-type="list"></ul></div>'),c='<li class="creat data_null"><span class="subject"><span class="txt_ellipsis">'+s["\ubaa9\ub85d\uc774 \uc5c6\uc2b5\ub2c8\ub2e4"]+"</span>"+"</span>"+"</li>",h=n.compile('{{#isReadable}}<li class="{{^isRead}}read_no{{/isRead}}" data-id="{{task.id}}" data-type="task"  data-list-id="{{task.id}}"><a href="javascript:;" class="tit" data-list-id="{{task.id}}"><span class="state {{#isEnd}}finished{{/isEnd}} {{^isEnd}}etc{{/isEnd}}">{{task.status.name}}</span><span class="subject"><span class="title">{{task.name}}</span></span><span class="info"><span class="reporter txt_ellipsis">{{#assignee}}{{assigneeLabel}}{{/assignee}}{{^assignee}}{{lang.empty}}{{/assignee}}</span><span class="part">|</span>{{#hasBeginDate}}<span class="date">{{beginDate}}</span>{{/hasBeginDate}}{{#hasDate}}~{{/hasDate}}{{#hasDueDate}}<span class="date {{#isDelay}}delay{{/isDelay}}">{{dueDate}}</span>{{/hasDueDate}}{{#hasDate}}<span class="part">|</span>{{/hasDate}}<span class="activity"><span class="txt_b">{{lang.activity}} </span><span class="num">{{task.activityCount}}</span></span></span></a></li>{{/isReadable}}{{^isReadable}}<li data-id="null"><a class="tit"><span class="subject"><span class="ic ic_lock"></span><span class="title">{{lang.notReadable}}</span></span></a></li>{{/isReadable}}'),p=e.extend({el:"#content",unbindEvent:function(){this.$el.off("vclick","a[data-tag='createTaskBtn']"),this.$el.off("vclick","li[data-type='task']")},bindEvent:function(){this.$el.on("vclick","a[data-tag='createTaskBtn']",$.proxy(this.goCreateTask,this)),this.$el.on("vclick","li[data-type='task']",$.proxy(this.goTaskDetail,this))},initialize:function(e){this.options=e,this.$el.off(),this.tasks=new o([],{folderId:this.options.id}),this.folder=new u(this.options);var t={listFunc:$.proxy(function(e){this.folder.fetch({success:function(e){e.getDepartment().done(function(e){self.department=e.data})}}),this.renderList(e)},this),emptyListFunc:$.proxy(function(){this.$("#taskList").append(c)},this)};this.setRenderListFunc(t);var n={keyword:this.keyword,property:this.property,direction:this.direction,searchType:this.searchType};this.setFetchInfo(n,this.tasks)},render:function(){this.unbindEvent();var e=this;return a.render({title:this.folder.get("name"),isList:!0,isSideMenu:!0,isHome:!0,isSearch:!0,isWriteBtn:!0,writeBtnCallback:function(){r.router.navigate("task/folder/"+e.folder.id+"/create",{trigger:!0,pushState:!0})}}),this.$el.addClass("go_renew"),this.$el.html(l.render({lang:f,list:this.tasks.toJSON(),folder:this.folder.toJSON(),dept:this.department,adminLabel:this.folder.adminLabel()})),this.dataFetch().done($.proxy(function(e){e.isEmpty()?this.renderListFunc.emptyListFunc():(this.renderListFunc.listFunc(e),this.scrollToEl())},this)),this.bindEvent(),this},goCreateTask:function(){r.router.navigate("task/folder/"+this.folder.get("id")+"/create",!0)},goTaskDetail:function(e){this.setSessionInfo(e);var t=e.currentTarget.getAttribute("data-id");r.router.navigate("task/"+t+"/detail",!0)},renderList:function(e){_.each(e.models,function(e){this.$("#taskList").append(h.render({lang:f,task:e.toJSON(),assignee:e.firstAssignee(),assigneeLabel:e.assigneeLabel(s["\uc678"],i["\uba85"]),isReadable:e.get("actions").readable,hasDate:e.hasBeginDate()||e.hasDueDate(),hasBeginDate:e.hasBeginDate(),beginDate:e.getBeginDate(),hasDueDate:e.hasDueDate(),dueDate:e.getDueDate(),isDelay:e.get("delay"),isRead:e.get("read"),isEnd:e.get("status").end}))},this)}});return p})}).call(this);