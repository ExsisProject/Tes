define(function(require){var e=require("backbone"),t=require("hogan"),n=require("i18n!contact/nls/contact"),r=require("hgn!contact/templates/tab_book/connector_group"),i=require("contact/collections/personal_group"),s=require("contact/views/tab_book/detail/contact"),o=require("contact/views/tab_book/toolbar/initial_bar");require("jquery.go-sdk");var u=e.View.extend({type:"USER",initialize:function(e){this.userSideView=new a,this.detailView=new s({type:this.type,mode:e.mode}),this.initialView=new o,this.initialView.on("click.initialWord",$.proxy(function(e){this.detailView.refresh({initial:e})},this)),this.userSideView.on("click.userSideView",$.proxy(function(e){this.detailView.refresh({groupId:e,type:this.type}),this.initialView.show(),this.initialView.reset()},this)),this.detailView.on("detail.search",$.proxy(function(){this.initialView.hide()},this))},render:function(){this.$el.html(r());var e=this.$el.find("#contactWrap");e.append(this.userSideView.el),e.append(this.detailView.el),this.$el.append(this.initialView.el),this.detailView.render(),this.userSideView.render(),this.initialView.render()},getSelectedGroup:function(){return this.userSideView.getSelectedGroup()},getSelectedUsers:function(){return this.detailView.getSelectedUsers()}}),a=e.View.extend({className:"content_tab_wrap",template:"<div id='group-tree' style='height:350px' class='jstree jstree-default'><ul></ul></div>",events:{"click #group-tree li.contact_group":"_onClickSideGroup"},initialize:function(){},render:function(){this.$el.html(this.template),this._renderTree(),this.$el.find("#group-tree li:first").trigger("click")},_renderTree:function(){function o(e){var n=t.compile("<li data-group-id='{{id}}' data-name='{{name}}' class='contact_group jstree-leaf {{#isLast}} jstree-last {{/isLast}}' data-loaded='false'><ins class='jstree-icon'></ins><a class=''>{{name}}</a></li>"),r=$.map(e,function(t,r){return e.length==r+1&&(t.isLast=!0),n.render(t)});return r}var e=this.$el.find("#group-tree").jstree("destroy").addClass("jstree jstree-default").html("<ul />").find("ul"),r=[];r.push({name:n["\uc804\uccb4 \uc8fc\uc18c\ub85d"]}),r=r.concat(i.getCollection().toJSON()||[]);var s=o(r);e.html(s)},_onClickSideGroup:function(e){function r(){t.closest("ul").find("a").removeClass("jstree-clicked"),t.find("a").addClass("jstree-clicked")}var t=$(e.currentTarget);r();var n=t.data("group-id");this.trigger("click.userSideView",n)},getSelectedGroup:function(){var e=this.$el.find("#group-tree a.jstree-clicked").closest("li"),t=e.data("group-id"),n=e.data("name");if(!t)throw new Error("not select group");return{data:[{dataId:t,dataName:n}],groupType:"GROUP"}}});return u});