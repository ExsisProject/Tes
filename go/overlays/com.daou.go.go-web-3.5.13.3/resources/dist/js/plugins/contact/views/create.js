define(function(require){function N(e){return moment(e,"YYYY-MM-DD").format("YYYY-MM-DD")}var e=require("underscore"),t=require("app"),n=require("hgn!contact/templates/create"),r=require("hgn!contact/templates/modify"),i=require("hgn!contact/templates/group_create"),s=require("hgn!contact/templates/addr_detail"),o=require("contact/models/personal_create_contact"),u=require("contact/models/company_create_contact"),a=require("contact/models/delete_contact"),f=require("contact/models/company_contact_info"),l=require("contact/models/company_contact_modify"),c=require("contact/models/dept_contact"),h=require("contact/models/create_group"),p=require("contact/models/contact_info"),d=require("contact/models/contact_modify"),v=require("contact/collections/personal_group"),m=require("contact/collections/dept_group"),g=require("i18n!nls/user"),y=require("i18n!nls/commons"),b=require("i18n!contact/nls/contact"),w=require("file_upload"),E=require("contact/models/group_info");require("jquery.go-popup"),require("jquery.ui");var S={name:b["\uc774\ub984(\ud45c\uc2dc\uba85)"],firstName:y["\uc774\ub984"],middleName:b["\uc911\uac04\uc774\ub984"],lastName:b["\uc131"],hurigana:b["\ud6c4\ub9ac\uac00\ub098"],company:g["\ud68c\uc0ac"],dept:g["\ubd80\uc11c"],position:g["\uc9c1\uc704"],group:b["\uadf8\ub8f9"],group_create:b["\uadf8\ub8f9\ucd94\uac00"],email:g["\uc774\uba54\uc77c"],phone:g["\ud734\ub300\ud3f0"],company_tel:b["\ud68c\uc0ac\uc804\ud654"],company_addr:b["\ud68c\uc0ac\uc8fc\uc18c"],description:b["\uba54\ubaa8"],nickName:b["\uc560\uce6d"],birthday:b["\uc0dd\uc77c"],anniversary:b["\uae30\ub150\uc77c"],home_tel:b["\uc9d1 \uc804\ud654"],home_addr:b["\uc9d1 \uc8fc\uc18c"],home_fax:b["\uc9d1 \ud329\uc2a4"],home_homepage:b["\uc9d1 \ud648\ud398\uc774\uc9c0"],company_fax:b["\ud68c\uc0ac \ud329\uc2a4"],company_homepage:b["\ud68c\uc0ac \ud648\ud398\uc774\uc9c0"],item_add:b["\ud56d\ubaa9\ucd94\uac00"],select_desc:b["\ucd94\uac00\ud560 \ud56d\ubaa9\uc744 \uc120\ud0dd\ud558\uc138\uc694"],save:y["\uc800\uc7a5"],cancel:y["\ucde8\uc18c"],save_continue:b["\uacc4\uc18d\ub4f1\ub85d"],return_list:y["\ubaa9\ub85d"],modify:y["\uc218\uc815"],"delete":y["\uc0ad\uc81c"],copy:y["URL \ubcf5\uc0ac"],image:y["\uc0ac\uc9c4"],imageUpload:y["\uc0ac\uc9c4 \uc62c\ub9ac\uae30"],imageUploadInfo:y["\u203b \uc0ac\uc9c4\uc740 \uc790\ub3d9\uc73c\ub85c 100x100 \uc0ac\uc774\uc988\ub85c \uc801\uc6a9 \ub429\ub2c8\ub2e4."],contact_modify:b["\uc8fc\uc18c\ub85d \uc218\uc815"],item_modify:b["\uc218\uc815\ud558\uae30"],add_detail:b["\uc0c1\uc138\uc8fc\uc18c\uc785\ub825"],new_group_name:b["\uc0c8 \uadf8\ub8f9 \uc774\ub984"],new_group:b["\uc0c8 \uadf8\ub8f9"],name_detail:b["\uc774\ub984 \uc0c1\uc138\uc785\ub825"],contact_add:b["\uc5f0\ub77d\ucc98 \ucd94\uac00"],homepage_link:b["\uc5f0\uacb0"],phone_desc:b["\uad6d\uac00\ucf54\ub4dc\ub3c4\uc6c0\ub9d0"],contact:y["\uc8fc\uc18c\ub85d"]},x={addr_country:b["\uad6d\uac00/\uc9c0\uc5ed"],addr_zipcode:b["\uc6b0\ud3b8\ubc88\ud638"],addr_state:b["\uc2dc/\ub3c4"],addr_city:b["\uad6c/\uad70"],addr_ext:b["\uae30\ud0c0\uc8fc\uc18c"]},T=Backbone.View.extend({el:"#content",manage:!1,events:{"click #groupCreate":"groupCreate","click #officeDetail":"officeDetail","click #homeDetail":"homeDetail","click #saveDone":"saveDone","click #saveContinueDone":"saveContinueDone","click #saveCancel":"saveCancel","click #groupNameTag li span.ic_del":"deleteGroup","change select[name=contactItem]":"selectItem","click #saveModify":"saveModify","click #contactDelete":"contactDelete","click #modifyCancel":"modifyCancel","click #returnList":"returnList","click #bottomSaveModify":"saveModify","click #bottomContactDelete":"contactDelete","click #bottomModifyCancel":"modifyCancel","click #bottomReturnList":"returnList","click .contact_item_modify":"contactItemModify","click #birthdayDateIcon":"birthdayDateIcon","click #anniversaryDateIcon":"anniversaryDateIcon","focus input":"focusForm","focusout input":"focusoutForm","click #del_photo":"deletePhoto","click #home_link":"homepageLink","click #company_link":"homepageLink","keyup input[name=firstName]":"checkName","keyup input[name=lastName]":"checkName","keyup input[name=middleName]":"checkName","focusout input[name=firstName]":"checkName","focusout input[name=lastName]":"checkName","focusout input[name=middleName]":"checkName","keyup input[name=firstNameHurigana]":"checkNameHurigana","keyup input[name=lastNameHurigana]":"checkNameHurigana","keyup input[name=middleNameHurigana]":"checkNameHurigana","focusout input[name=firstNameHurigana]":"checkNameHurigana","focusout input[name=lastNameHurigana]":"checkNameHurigana","focusout input[name=middleNameHurigana]":"checkNameHurigana"},isUser:function(){return this.type=="personal"},isCompany:function(){return this.type=="company"},isDept:function(){return this.type=="department"},isCreateMode:function(){return this.mode=="create"},isModifyMode:function(){return this.mode=="modify"},initialize:function(){this.mode=null,this.$el.off(),this.type=this.options.type,this.mode=this.options.mode,this.groupId=this.options.groupId,this.deptId=this.options.deptId,this.contactId=this.options.contactId,this.initData=this.options.initData||{}},render:function(){this.isModifyMode()?this.renderModify():this.renderCreate(),this.initFileUpload()},renderCreate:function(){var e=null;this.groupId&&(e=E.read({groupId:this.groupId}).toJSON());var r=[{value:"nickName",name:b["\uc560\uce6d"]},{value:"birthday",name:b["\uc0dd\uc77c"]},{value:"anniversary",name:b["\uae30\ub150\uc77c"]},{value:"home_tel",name:b["\uc9d1 \uc804\ud654"]},{value:"home_basicAddress",name:b["\uc9d1 \uc8fc\uc18c"]},{value:"home_fax",name:b["\uc9d1 \ud329\uc2a4"]},{value:"home_homepage",name:b["\uc9d1 \ud648\ud398\uc774\uc9c0"]},{value:"company_fax",name:b["\ud68c\uc0ac \ud329\uc2a4"]},{value:"company_homepage",name:b["\ud68c\uc0ac \ud648\ud398\uc774\uc9c0"]}],i=n({lang:S,data:this.initData,contextRoot:t.contextRoot,optionList:r,group:e,isCompany:this.isCompany(),isJapanese:GO.session().locale=="ja"});this.$el.html(i)},renderModify:function(){var n;if(this.isUser())n=p.read({contactId:this.contactId});else if(this.isCompany()){var i=E.read({groupId:this.groupId}).toJSON();n=new f,n.set({groupId:this.groupId,contactId:this.contactId}),n.fetch({async:!1,error:function(e,t){return!1}})}else n=new c,n.setDeptId(this.deptId),n.set("id",this.contactId),n.fetch({async:!1});var s=n.toJSON();e.map(s,function(t,n){typeof t=="string"&&!t&&(s[n]=null),typeof t=="object"&&e.map(t,function(e,t){typeof e=="string"&&!e&&(s[n][t]=null)});if(n=="birthday"||n=="anniversary")s[n]=N(t);n=="description"&&(typeof t=="string"&&!t?s[n]=null:(t=GO.util.textToHtml(t),s[n]=t))});var o=r({lang:S,contextRoot:t.contextRoot,data:s,isCompany:this.isCompany(),isJapanese:GO.session().locale=="ja"});this.$el.html(o),(!n.toJSON().hasOwnProperty("home")||n.get("home").basicAddress==null)&&$("#homeDetail").parents("tr").hide(),(!n.toJSON().hasOwnProperty("office")||n.get("office").basicAddress==null)&&$("#officeDetail").parents("tr").hide(),this.isCompany()&&(i.removable||($("#contactDelete").remove(),$("#bottomContactDelete").remove()),i.writable||($("#modifyCancel").remove(),$("#bottomModifyCancel").remove(),$("#saveModify").remove(),$("#bottomSaveModify").remove(),this.removeModifyClass()))},focusForm:function(e){$(e.currentTarget).addClass("edit")},focusoutForm:function(e){$(e.currentTarget).removeClass("edit")},birthdayDateIcon:function(e){$("#birthdayDate").focus()},anniversaryDateIcon:function(e){$("#anniversaryDate").focus()},homepageLink:function(e){var t=$(e.currentTarget).parents("td");window.open(t.find("span.txt_form").text(),"scrollbars=yes,resizable=yes,width=800,height=640")},contactItemModify:function(e){var t=$.trim($(e.currentTarget).text()),n=$(e.currentTarget).parents("td");n.find("span.btn_fn7").hide(),n.find("span.txt_edit,span.noti_date_wrap,span.textarea").show().find("input").val(t).focus(),n.find("span.textarea").show().find("textarea").text(t).focus(),n.find("span.txt_form").remove(),n.find("span.noti_date_wrap").length&&this.initializeDatepicker()},removeModifyClass:function(e){this.$el.find(".contact_item_modify").removeClass("contact_item_modify"),this.$el.find("input").attr("readonly",!0),this.$el.find("#swfupload-control").remove(),this.$el.find(".ui_edit").remove(),this.$el.find(".ic_detail").remove(),this.$el.find("select[name=contactItem]").parents("tr").remove()},groupCreate:function(e){var t;this.isUser()?t=v.getCollection().toJSON()||[]:t=m.get(this.deptId).toJSON(),this.popupEl=$.goPopup({header:b["\uadf8\ub8f9\ucd94\uac00"],width:"262px",pclass:"layer_creat_group layer_normal",contents:i({data:t,lang:S})}),this.popupEl.reoffset(),this.popupUnbindEvents(),this.popupBindEvents()},selectItem:function(e){var t=$(e.currentTarget).val(),n=this.$el.find('form[name="formContactCreate"]');t=="description"?itemEl=n.find('textarea[name="'+t+'"]'):itemEl=n.find('input[name="'+t+'"]'),itemEl.parents("tr").css("display")=="none"&&(itemEl.parents("tr").show(),(t=="birthday"||t=="anniversary")&&this.initializeDatepicker(),$(e.currentTarget).find('option[value="'+t+'"]').remove())},initializeDatepicker:function(){var e=$("#birthdayDate"),t=$("#anniversaryDate");$.datepicker.setDefaults($.datepicker.regional[GO.config("locale")]),e.datepicker({defaultDate:"+1w",dateFormat:"yy-mm-dd",changeMonth:!0,changeYear:!0,yearRange:"c-80:c+10",yearSuffix:""}),t.datepicker({defaultDate:"+1w",dateFormat:"yy-mm-dd",changeMonth:!0,changeYear:!0,yearRange:"c-80:c+10",yearSuffix:""})},deletePhoto:function(){var e=$("#thumbnail_image");e.attr("data-filepath",""),e.attr("data-filename",""),e.attr("src",GO.contextRoot+"resources/images/photo_profile_large.jpg")},saveDone:function(){var e=this.saveContactData();e.code=="200"&&((new RegExp("create")).test(t.router.getUrl())?(new RegExp("contact/create")).test(t.router.getUrl())?t.router.navigate("contact",{trigger:!0}):window.history.back():t.router.navigate(t.router.getUrl(),{replace:!0,trigger:!0,pushState:!0}),$.goMessage(y["\uc800\uc7a5\ub418\uc5c8\uc2b5\ub2c8\ub2e4."]))},saveContinueDone:function(){var e=this,t=this.saveContactData();if(t.code=="200"){$.goMessage(y["\uc800\uc7a5\ub418\uc5c8\uc2b5\ub2c8\ub2e4."]);var n=$(".title.on").parent().attr("data-id"),r=$(".title.on").parent().attr("data-type");if(n!=undefined){var i={groupId:n};e.renderCreate(i,r)}else e.renderCreate();this.initFileUpload()}},saveModify:function(){var e=this.saveContactData(this.contactId);e.code=="200"&&($.goMessage(y["\uc218\uc815\ub418\uc5c8\uc2b5\ub2c8\ub2e4."]),window.history.back())},saveContactData:function(e){var n=null,r=this.$el.find("form[name=formContactCreate]"),i=r.find('input[name="name"]'),s=r.find('input[name="email"]'),a={},f={},h=[],p;this.isCompany()?e?(p=new l,p.set({groupId:this.groupId,id:e})):(p=new u,p.setGroupId(this.groupId)):this.isUser()?e?(p=new d,p.set("id",e)):p=new o:(p=new c,p.setDeptId(this.deptId),e&&p.set("id",e)),$.each(r.serializeArray(),function(e,t){t.name=="groupId"?h.push(t.value):t.name=="description"?p.set(t.name,GO.util.htmlToText(t.value),{silent:!0}):t.name=="company_tel"?f.tel=t.value:t.name=="company_fax"?f.fax=t.value:t.name=="company_basicAddress"?f.basicAddress=t.value:t.name=="company_country"?f.country=t.value:t.name=="company_postalCode"?f.postalCode=t.value:t.name=="company_state"?f.state=t.value:t.name=="company_city"?f.city=t.value:t.name=="company_extAddress"?f.extAddress=t.value:t.name=="company_homepage"?f.homepage=t.value:t.name=="home_tel"?a.tel=t.value:t.name=="home_fax"?a.fax=t.value:t.name=="home_basicAddress"?a.basicAddress=t.value:t.name=="home_country"?a.country=t.value:t.name=="home_postalCode"?a.postalCode=t.value:t.name=="home_state"?a.state=t.value:t.name=="home_city"?a.city=t.value:t.name=="home_extAddress"?a.extAddress=t.value:t.name=="home_homepage"?a.homepage=t.value:t.name=="birthday"&&t.value.length>0?p.set(t.name,GO.util.dateFormatWithoutTimeZone(t.value),{silent:!0}):t.name=="anniversary"&&t.value.length>0?p.set(t.name,GO.util.dateFormatWithoutTimeZone(t.value),{silent:!0}):t.name!="contactItemDesc"&&p.set(t.name,t.value,{silent:!0})}),p.set({office:f,home:a,groupIds:h}),$thumbnail=$("#thumbnail_image"),thumbnail_image={filePath:$thumbnail.attr("data-filepath").replace(GO.contextRoot,""),fileName:$thumbnail.attr("data-filename"),hostId:$thumbnail.attr("host-id")},thumbnail_image["filePath"]==""&&thumbnail_image["fileName"]==""&&(thumbnail_image=null),p.set("photo",thumbnail_image);var v=function(e,t){return $.goMessage(e),t&&t.focus(),!1};if(!$.goValidation.isCheckLength(2,64,$.trim(p.get("name"))))return v(t.i18n(y["0\uc790\uc774\uc0c1 0\uc774\ud558 \uc785\ub825\ud574\uc57c\ud569\ub2c8\ub2e4."],{arg1:"2",arg2:"64"}),i),!1;if(!$.goValidation.isCheckLength(0,255,$.trim(p.get("companyName"))))return v(t.i18n(y["0\uc790\uc774\uc0c1 0\uc774\ud558 \uc785\ub825\ud574\uc57c\ud569\ub2c8\ub2e4."],{arg1:"0",arg2:"255"}),r.find('input[name="companyName"]')),!1;if(!$.goValidation.isCheckLength(0,255,$.trim(p.get("departmentName"))))return v(t.i18n(y["0\uc790\uc774\uc0c1 0\uc774\ud558 \uc785\ub825\ud574\uc57c\ud569\ub2c8\ub2e4."],{arg1:"0",arg2:"255"}),r.find('input[name="departmentName"]')),!1;if(!$.goValidation.isCheckLength(0,255,$.trim(p.get("positionName"))))return v(t.i18n(y["0\uc790\uc774\uc0c1 0\uc774\ud558 \uc785\ub825\ud574\uc57c\ud569\ub2c8\ub2e4."],{arg1:"0",arg2:"255"}),r.find('input[name="positionName"]')),!1;if(p.get("email").length>0){if(!$.goValidation.isValidEmail(p.get("email")))return v(y["\uc774\uba54\uc77c \ud615\uc2dd\uc774 \uc62c\ubc14\ub974\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4."],s),!1;if(!$.goValidation.isCheckLength(0,255,$.trim(p.get("email"))))return v(t.i18n(y["0\uc790\uc774\uc0c1 0\uc774\ud558 \uc785\ub825\ud574\uc57c\ud569\ub2c8\ub2e4."],{arg1:"0",arg2:"255"}),s),!1}if(p.get("mobileNo").length>0){if(!$.goValidation.isCheckLength(0,40,$.trim(p.get("mobileNo"))))return v(t.i18n(y["0\uc790\uc774\uc0c1 0\uc774\ud558 \uc785\ub825\ud574\uc57c\ud569\ub2c8\ub2e4."],{arg1:"0",arg2:"40"}),r.find('input[name="mobileNo"]')),!1;if(!$.goValidation.isInvalidTel(p.get("mobileNo")))return v(b["\ubc88\ud638\ud615\uc2dd\uc774 \uc62c\ubc14\ub974\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4(-,0~9)"],r.find('input[name="mobileNo"]')),!1}if(p.get("office").tel.length>0){if(!$.goValidation.isCheckLength(0,40,$.trim(p.get("office").tel)))return v(t.i18n(y["0\uc790\uc774\uc0c1 0\uc774\ud558 \uc785\ub825\ud574\uc57c\ud569\ub2c8\ub2e4."],{arg1:"0",arg2:"40"}),r.find('input[name="company_tel"]')),!1;if(!$.goValidation.isInvalidTel(p.get("office").tel))return v(b["\ubc88\ud638\ud615\uc2dd\uc774 \uc62c\ubc14\ub974\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4(-,0~9)"],r.find('input[name="company_tel"]')),!1}if(!$.goValidation.isCheckLength(0,255,$.trim(p.get("office").basicAddress)))return v(t.i18n(y["0\uc790\uc774\uc0c1 0\uc774\ud558 \uc785\ub825\ud574\uc57c\ud569\ub2c8\ub2e4."],{arg1:"0",arg2:"255"}),r.find('input[name="company_basicAddress"]')),!1;if(!$.goValidation.isCheckLength(0,255,$.trim(p.get("description"))))return v(t.i18n(y["0\uc790\uc774\uc0c1 0\uc774\ud558 \uc785\ub825\ud574\uc57c\ud569\ub2c8\ub2e4."],{arg1:"0",arg2:"255"}),r.find('input[name="description"]')),!1;if(!$.goValidation.isCheckLength(0,64,$.trim(p.get("nickName"))))return v(t.i18n(y["0\uc790\uc774\uc0c1 0\uc774\ud558 \uc785\ub825\ud574\uc57c\ud569\ub2c8\ub2e4."],{arg1:"0",arg2:"64"}),r.find('input[name="nickName"]')),!1;if(p.get("home").tel.length>0){if(!$.goValidation.isCheckLength(0,40,$.trim(p.get("home").tel)))return v(t.i18n(y["0\uc790\uc774\uc0c1 0\uc774\ud558 \uc785\ub825\ud574\uc57c\ud569\ub2c8\ub2e4."],{arg1:"0",arg2:"40"}),r.find('input[name="home_tel"]')),!1;if(!$.goValidation.isInvalidTel(p.get("home").tel))return v(b["\ubc88\ud638\ud615\uc2dd\uc774 \uc62c\ubc14\ub974\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4(-,0~9)"],r.find('input[name="home_tel"]')),!1}if(!$.goValidation.isCheckLength(0,255,$.trim(p.get("home").basicAddress)))return v(t.i18n(y["0\uc790\uc774\uc0c1 0\uc774\ud558 \uc785\ub825\ud574\uc57c\ud569\ub2c8\ub2e4."],{arg1:"0",arg2:"255"}),r.find('input[name="home_basicAddress"]')),!1;if(p.get("home").fax.length>0){if(!$.goValidation.isCheckLength(0,40,$.trim(p.get("home").fax)))return v(t.i18n(y["0\uc790\uc774\uc0c1 0\uc774\ud558 \uc785\ub825\ud574\uc57c\ud569\ub2c8\ub2e4."],{arg1:"0",arg2:"40"}),r.find('input[name="home_fax"]')),!1;if(!$.goValidation.isInvalidTel(p.get("home").fax))return v(b["\ubc88\ud638\ud615\uc2dd\uc774 \uc62c\ubc14\ub974\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4(-,0~9)"],r.find('input[name="home_fax"]')),!1}if(p.get("home").homepage.length>0){if(!$.goValidation.isCheckLength(0,255,$.trim(p.get("home").homepage)))return v(t.i18n(y["0\uc790\uc774\uc0c1 0\uc774\ud558 \uc785\ub825\ud574\uc57c\ud569\ub2c8\ub2e4."],{arg1:"0",arg2:"255"}),r.find('input[name="home_homepage"]')),!1;if(!$.goValidation.validateURL(p.get("home").homepage))return v(b["\ud648\ud398\uc774\uc9c0 \uc624\ub958 \uc124\uba85"],r.find('input[name="home_homepage"]')),!1}if(p.get("office").fax.length>0){if(!$.goValidation.isCheckLength(0,40,$.trim(p.get("office").fax)))return v(t.i18n(y["0\uc790\uc774\uc0c1 0\uc774\ud558 \uc785\ub825\ud574\uc57c\ud569\ub2c8\ub2e4."],{arg1:"0",arg2:"40"}),r.find('input[name="company_fax"]')),!1;if(!$.goValidation.isInvalidTel(p.get("office").fax))return v(b["\ubc88\ud638\ud615\uc2dd\uc774 \uc62c\ubc14\ub974\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4(-,0~9)"],r.find('input[name="company_fax"]')),!1}if(p.get("office").homepage.length>0){if(!$.goValidation.isCheckLength(0,255,$.trim(p.get("office").homepage)))return v(t.i18n(y["0\uc790\uc774\uc0c1 0\uc774\ud558 \uc785\ub825\ud574\uc57c\ud569\ub2c8\ub2e4."],{arg1:"0",arg2:"255"}),r.find('input[name="office_homepage"]')),!1;if(!$.goValidation.validateURL(p.get("office").homepage))return v(b["\ud648\ud398\uc774\uc9c0 \uc624\ub958 \uc124\uba85"],r.find('input[name="office_homepage"]')),!1}return p.save({},{async:!1,success:function(e,t){t.code=="200"&&(n=t)},error:function(e,t){var r=JSON.parse(t.responseText);$.goMessage(r.message),n=t}}),n},returnList:function(){var n=t.router.getUrl(),r=["contact"];this.isDept()||this.type=="dept"?(r.push("dept"),r.push(this.deptId),e.isEmpty(this.groupId)||(r.push("group"),r.push(this.groupId))):(r.push(this.type),r.push(this.groupId)),t.router.navigate(r.join("/"),{replace:!0,trigger:!0})},saveCancel:function(){var e=this;$.goConfirm(y["\ucde8\uc18c\ud558\uc2dc\uaca0\uc2b5\ub2c8\uae4c?"],y["\uc785\ub825\ud558\uc2e0 \uc815\ubcf4\uac00 \ucd08\uae30\ud654\ub429\ub2c8\ub2e4."],function(){e.renderCreate(),e.initFileUpload()})},modifyCancel:function(){var e=this;$.goConfirm(y["\ucde8\uc18c\ud558\uc2dc\uaca0\uc2b5\ub2c8\uae4c?"],y["\uc785\ub825\ud558\uc2e0 \uc815\ubcf4\uac00 \ucd08\uae30\ud654\ub429\ub2c8\ub2e4."],function(){e.renderModify({contactId:e.contactId}),e.initFileUpload()})},contactDelete:function(e){var t=this,n=[];n.push(t.contactId),$.goCaution(b["\uc8fc\uc18c\ub85d\uc744 \uc0ad\uc81c\ud558\uc2dc\uaca0\uc2b5\ub2c8\uae4c"],"",function(){var e=new a;e.set({ids:n},{silent:!0}),e.save({},{type:"DELETE",success:function(e,t){t.code=="200"&&($.goMessage(y["\uc0ad\uc81c\ub418\uc5c8\uc2b5\ub2c8\ub2e4."]),window.history.back())},error:function(e,t){var n=JSON.parse(t.responseText);$.goMessage(n.message)}})})},popupUnbindEvents:function(){this.popupEl.off()},popupBindEvents:function(){this.popupEl.on("click","#popupGroupAdd",$.proxy(this.popupGroupAdd,this)),this.popupEl.on("click",".popupGroupName",$.proxy(this.popupGroupName,this)),this.popupEl.on("click","#popupGroupCreate",$.proxy(this.popupGroupCreate,this)),this.popupEl.on("click","#popupGroupCancel",$.proxy(this.popupGroupCancel,this))},checkName:function(e){var t=this.$el.find("input[name=firstName]").val(),n=this.$el.find("input[name=lastName]").val(),r=this.$el.find("input[name=middleName]").val(),i=this.$el.find("input[name=name]");n+=" ",r!=""&&(r+=" "),i.val(n+r+t)},checkNameHurigana:function(){var e,t,n,r;e=this.$el.find("input[name=firstNameHurigana]").val(),t=this.$el.find("input[name=lastNameHurigana]").val(),n=this.$el.find("input[name=middleNameHurigana]").val(),r=this.$el.find("input[name=nameHurigana]"),t+=" ",n!=""&&(n+=" "),r.val(t+n+e)},popupGroupAdd:function(e){var t=$(e.currentTarget).parents("ul.group_tag").children("li.edit");t.css("display")=="none"?t.show():$.goAlert(b["1\uac1c \uc774\uc0c1 \ucd94\uac00\ud560 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4."])},popupGroupCreate:function(e){var n=this,r=$(e.currentTarget).parents("li.edit").children("input").val(),i=function(e,t){return $.goMessage(e),t&&t.focus(),!1};if(!$.goValidation.isCheckLength(2,16,r))return i(t.i18n(y["0\uc790\uc774\uc0c1 0\uc774\ud558 \uc785\ub825\ud574\uc57c\ud569\ub2c8\ub2e4."],{arg1:"2",arg2:"16"}),$(e.currentTarget).parents("li.edit").children("input")),!1;var s;this.isUser()?s="USER":s="DEPARTMENT";var o=new h({type:s});o.isDept()&&o.set("deptId",this.deptId),o.set({name:r},{silent:!0}),o.save({},{type:"POST",success:function(e,t){t.code=="200"&&(n.groupCreate(),n.popupGroupNameAdd(r,t.data.id),GO.EventEmitter.trigger("contact","changed:sideGroups"))},error:function(e,t){var n=JSON.parse(t.responseText);$.goMessage(n.message)}})},popupGroupCancel:function(e){$(e.currentTarget).parents("li.edit").hide().children("input").val("")},popupGroupNameAdd:function(e,t){$("#groupNameTag li.creat").before("<li data-id="+t+'><input type="hidden" name="groupId" value='+t+'><span class="name">'+e+'</span><span class="btn_wrap"><span class="ic_classic ic_del" title="'+y["\uc0ad\uc81c"]+'"></span></span></li>')},popupGroupName:function(e){var t=$(e.currentTarget).attr("data-id"),n=$(e.currentTarget).children("a").text(),r=$("#groupNameTag");r.find('li[data-id="'+t+'"]').length?$.goMessage(y["\uc774\ubbf8 \uc120\ud0dd\ub418\uc5c8\uc2b5\ub2c8\ub2e4."]):$("#groupNameTag li.creat").before("<li data-id="+t+'><input type="hidden" name="groupId" value='+t+'><span class="name">'+n+'</span><span class="btn_wrap"><span class="ic_classic ic_del" title="'+y["\uc0ad\uc81c"]+'"></span></span></li>')},deleteGroup:function(e){$(e.currentTarget).parents("li").remove()},officeDetail:function(e){this.addDetail("company_basicAddress")},homeDetail:function(e){this.addDetail("home_basicAddress")},addDetail:function(e){var t="",n=e.split("_")[0],r={country:$("input[name="+n+"_country]").val(),postalCode:$("input[name="+n+"_postalCode]").val(),state:$("input[name="+n+"_state]").val(),city:$("input[name="+n+"_city]").val(),extAddress:$("input[name="+n+"_extAddress]").val()};$.goPopup({header:b["\uc8fc\uc18c \uc0c1\uc138\uc785\ub825"],pclass:"layer_normal layer_addr_mgmt",buttons:[{btype:"confirm",btext:y["\uc800\uc7a5"],callback:function(){var r=$("form[name=formAddrDetail]");$.each(r.serializeArray(),function(e,r){r.name=="country"?$("input[name="+n+"_"+r.name+"]").val(r.value):r.name=="postalCode"?$("input[name="+n+"_"+r.name+"]").val(r.value):r.name=="state"?$("input[name="+n+"_"+r.name+"]").val(r.value):r.name=="city"?$("input[name="+n+"_"+r.name+"]").val(r.value):r.name=="extAddress"&&$("input[name="+n+"_"+r.name+"]").val(r.value),t+=r.value+" "}),$("input[name="+e+"]").val(t)}},{btype:"normail",btext:y["\ucde8\uc18c"],callback:function(){}}],width:"300px",contents:s({lang:x,data:r})})},initFileUpload:function(){var e=this,t={el:"#swfupload-control",context_root:GO.contextRoot,button_text:"<span class='buttonText'>"+y["\uc0ac\uc9c4 \uc62c\ub9ac\uae30"]+"</span>",button_style:"text-align:center; color:#ffffff; font-size:12px;",button_height:30,button_width:100,progressBarUse:!1,url:"api/file?GOSSOcookie="+$.cookie("GOSSOcookie")};(new w(t)).queue(function(e,t){}).start(function(e,t){var n=new RegExp("(jpeg|jpg|gif|png|bmp)","gi"),r=t.type;if(!n.test(r))return $.goMessage(y["\ud3ec\uba67 \uacbd\uace0"]),!1;if(t.size>5242880)return $.goMessage(y["\ucca8\ubd80\ud30c\uc77c \uc6a9\ub7c9\uc740 5MB\uc774\ud558 \uc785\ub2c8\ub2e4."]),!1}).progress(function(e,t){}).success(function(e,t,n){if(GO.util.fileUploadErrorCheck(t))return $.goAlert(GO.util.serverMessage(t)),!1;if(GO.util.isFileSizeZero(t))return $.goAlert(GO.util.serverMessage(t)),!1;var r=t.data,i=r.fileName,s=r.filePath,o=r.hostId,u=r.thumbnail;$("#thumbnail_image").attr("src",u).attr("data-filepath",s).attr("host-id",o).attr("data-filename",i)}).complete(function(e,t){console.info(t)}).error(function(e,t){console.info(t)})}});return{render:function(e,t,n,r){e.mode=t,e.type=n,e.initData=r;var i=new T(e);return i.render()}}});