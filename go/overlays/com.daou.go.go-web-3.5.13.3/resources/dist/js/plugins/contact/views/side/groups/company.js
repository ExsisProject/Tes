define(function(require){function p(t,n){var r=t.closest("section"),i=t.parents("h1"),s=i.find(".ic_side");r.find("ul.side_depth").slideToggle("fast",function(){e(this).css("display")=="block"?(i.removeClass("folded"),s.attr("title",f["\uc811\uae30"])):(i.addClass("folded"),s.attr("title",f["\ud3bc\uce58\uae30"]));var t=!i.hasClass("folded");u.storeCategoryIsOpen(n,t)})}var e=require("jquery"),t=require("backbone"),n=require("app"),r=require("underscore"),i=require("hgn!contact/templates/side_company"),s=require("hgn!docs/templates/docs_tree_menu"),o=require("contact/collections/company_group"),u=require("contact/helpers/local_storage"),a=require("contact/views/side/components/tree_menu"),f=require("i18n!nls/commons"),l=require("i18n!contact/nls/contact");require("jquery.go-popup"),require("jquery.go-validation");var c={USER:l["\uac1c\uc778 \uc8fc\uc18c\ub85d"],COMPANY:l["\uc804\uc0ac \uc8fc\uc18c\ub85d"],DEPARTMENT:l["\ubd80\uc11c \uc8fc\uc18c\ub85d"],contact_group:l["\uc8fc\uc18c\ub85d \uadf8\ub8f9"],group_add:l["\uc5f0\ub77d\ucc98 \uadf8\ub8f9 \ucd94\uac00"],contact_add:l["\uc5f0\ub77d\ucc98 \uc8fc\uc18c\ub85d \ucd94\uac00"],contact_all:l["\uc804\uccb4 \uc8fc\uc18c\ub85d"],contact_manage:l["\uc8fc\uc18c\ub85d \uad00\ub9ac"],group_manage:l["\uadf8\ub8f9\uad00\ub9ac"],fold:f["\uc811\uae30"],open:f["\ud3bc\uce58\uae30"],new_contact:l["\uc0c8 \uc5f0\ub77d\ucc98"],contact:l["\uc8fc\uc18c\ub85d"],delete_contact:l["\uc8fc\uc18c\ub85d \uc0ad\uc81c"]},h=t.View.extend({tagName:"section",className:"lnb oganization",LOCAL_STORAGE_KEY:"-contact-folder-toggle",SIDE_STORE_KEY:n.session("loginId")+"-contact-company-toggle",type:"COMPANY",events:{"click span.ic_side_setting":"moveManageLink","click #toggleFolder":"toggleFolder","click a.node-value":"moveLink","click .side_toggle":"sideToggle"},initialize:function(e){this.$el.attr("data-type","COMPANY"),this.collection=o.init(),this.collection.set(e.collection.toJSON()),this.isManager=e.isManager},render:function(){function s(t,n){var r;return r=e(this.renderBoardTreeMenuNode({nodeId:t.id,nodeType:"FOLDER",nodeValue:t.getName(),isAccessible:t.isReadable()?t.isReadable():!1,hasChild:t.hasChild(),close:!1,iconType:"folder",managable:!1,isWritable:t.isWritable()})),r}var t=i({lang:c,isToggleOpen:u.getStoredCategoryIsOpen(this.SIDE_STORE_KEY),isManager:this.isManager});this.$el.html(t);var n=this.collection.convertNodeTree(),r=this.$el.find("#company_side");n.each(e.proxy(function(e){var t=s.call(this,e,e.getChildren());r.append(t)},this))},renderChildrens:function(e){var t=e.attr("data-id"),n=o.getCollectionByParent(t),r=this._renderMenuTree(Number(t),n.toJSON(),undefined);e.parent().after(r.el)},moveManageLink:function(){var e="contact/company/manage";n.router.navigate(e,{trigger:!0,pushState:!0})},renderBoardTreeMenuNode:function(){return s.apply(undefined,arguments)},_renderMenuTree:function(e,t,n){var r=new a({nodes:t,menuId:n,parentId:e,localStorageKey:this.LOCAL_STORAGE_KEY,isSiteAdmin:!1});return r.render(),r},toggleFolder:function(t){var r=e(t.currentTarget),i=r.parent().find("a").attr("data-id"),s=r.parent().find("a").attr("title");r.hasClass("opened")||(this.renderChildrens(r.parent().find("a")),r.addClass("opened"));var o=r.hasClass("close");u.storeCategoryIsOpen(n.session("loginId")+i+s+this.LOCAL_STORAGE_KEY,!o),o?(r.removeClass("close").addClass("open"),r.parent().next("ul").hide()):(r.removeClass("open").addClass("close"),r.parent().next("ul").show())},moveLink:function(t){t.preventDefault();var r=e(t.currentTarget).attr("data-id");if(r&&e(t.currentTarget).data("readable")){e("#side p.title.on").removeClass("on"),e(t.currentTarget).parent().addClass("on");var i="contact/company/"+r;n.router.navigate(i,!0)}return!1},sideToggle:function(t){var n=e(t.currentTarget);p(n,this.SIDE_STORE_KEY)}});return h});