define(function(require){var e=require("views/mobile/m_more_list"),t=require("jquery"),n=require("backbone"),r=require("app"),i=require("views/mobile/header_toolbar"),s=require("hgn!contact/templates/mobile/m_home"),o=require("hgn!contact/templates/mobile/m_home_nolist"),u=require("i18n!nls/commons"),a=require("i18n!contact/nls/contact");require("GO.util");var f=require("contact/models/group_info"),l=require("contact/collections/contacts_pager"),c=require("contact/helpers/contacts"),h={add_contact:a["\uc5f0\ub77d\ucc98 \ucd94\uac00"],return_home:u["\ud648\uc73c\ub85c \uc774\ub3d9"],not_contact:a["\ub4f1\ub85d\ub41c \uc8fc\uc18c\ub85d\uc774 \uc5c6\uc2b5\ub2c8\ub2e4"],company:u["\uacf5\uc6a9"],personal:u["\uac1c\uc778"],all_contact:a["\uc804\uccb4 \uc8fc\uc18c\ub85d"],list_exposure_message:a["\ubaa8\ubc14\uc77c \uc8fc\uc18c\ub85d \uc815\ubcf4 \ubcf4\ud638 \ubb38\uad6c"]},p=null,d=e.extend({el:"#content",isCompanyType:function(){return this.type=="COMPANY"},events:{"vclick a[data-id]":"getContact","vclick .telMobile":"telMobile","vclick .smsMobile":"smsMobile","vclick .sendMail":"sendMail"},initialize:function(e){GO.util.appLoading(!0),this.$el.off(),this.type=this.options.type,this.deptId=this.options.deptId,this.groupId=this.options.groupId,this.$el.data("type",this.type),this.$el.data("deptId",this.deptId),this.$el.data("groupId",this.groupId),c.init(e),this.groupId&&(this.groupInfo=f.read({groupId:this.groupId}).toJSON());if(!this.isContactListExposure())return!1;this.$el.data("type",this.type),this.$el.data("deptId",this.deptId),this.$el.data("groupId",this.groupId);var n={type:this.type,property:"nameInitialConsonant",direction:"asc",deptId:this.deptId,groupId:this.groupId};this.searchType&&(n.searchType=this.searchType),this.keyWord&&(n.keyWord=this.keyWord),this.collection=new l([],_.extend(n,{collectionType:"home"}));var r={listFunc:t.proxy(function(e){this.renderList(e)},this)};this.setRenderListFunc(r),this.setFetchInfo(n,this.collection)},renderList:function(e){var t=s({lang:h,data:e.toJSON(),isAvailableMail:function(){return r.isAvailableApp("mail")?!0:!1}});this.$el.find("ul.list_normal").append(t)},render:function(){GO.util.pageDone(),this.renderHeaderView(),this.$el.html('<ul class="content list_normal list_photo list_address" data-type="list"></ul>');if(!this.isContactListExposure())return this.$el.html(o({lang:h})),this.$el;GO.util.appLoading(!0),this.dataFetch().done(t.proxy(function(e){this.renderListFunc.listFunc(e),this.scrollToEl()},this)),GO.util.appLoading(!1)},renderHeaderView:function(){function r(){return!this.isCompanyType()||this.isCompanyType()&&this.groupInfo.writable}var e=this,n={title:this.groupInfo?this.groupInfo.name:h.all_contact,isList:!0,isSideMenu:this.isContactListExposure()?!0:!1,isHome:!0,isSearch:!0};r.call(this)&&(n.isWriteBtn=!0,n.writeBtnCallback=function(){e.contactCreate()}),i.render(n),this.isContactListExposure()||t("#btnSideMenu").hide()},isContactListExposure:function(){return _.isUndefined(this.options.contactListExposure)||this.options.contactListExposure},renderContacts:function(){GO.util.appLoading(!0),this.$el.html(s({lang:h,data:this.collection.toJSON(),isAvailableMail:function(){return r.isAvailableApp("mail")?!0:!1}}));var e=GO.util.mPaging(this.collection);this.$el.find(".paging").remove(),this.$el.append(e),GO.util.appLoading(!1)},getContact:function(e){this.setSessionInfo(e);var n=t(e.currentTarget).data("id"),r=["contact"];this.groupId?(this.type&&r.push(c.getURL()),c.isDept()?t.merge(r,[this.deptId,"group",this.groupId]):r.push(this.groupId)):c.isDept()&&t.merge(r,[c.getURL(),this.deptId]),t.merge(r,["view",n]),r&&GO.router.navigate(r.join("/"),{trigger:!0,pushState:!0})},contactCreate:function(){var e=["contact"];this.groupId?(this.type&&e.push(c.getURL()),c.isDept()?t.merge(e,[this.deptId,"group",this.groupId]):e.push(this.groupId)):c.isDept()&&t.merge(e,[c.getURL(),this.deptId]),e.push("create"),r.router.navigate(e.join("/"),{trigger:!0,pushState:!0})},telMobile:function(e){e.stopPropagation(),window.location.href="tel:"+t(e.currentTarget).attr("data-mobile");return},smsMobile:function(e){e.stopPropagation(),GO.config("isMobileApp")?window.location.href="smsto:"+t(e.currentTarget).attr("data-mobile"):window.location.href="sms://"+t(e.currentTarget).attr("data-mobile");return},sendMail:function(e){if(!r.isAvailableApp("mail"))return;e.stopPropagation();var n=this;if(confirm(a["\uba54\uc77c\uc744 \ubcf4\ub0b4\uc2dc\uaca0\uc2b5\ub2c8\uae4c?"])){var i=t(e.currentTarget).parent().siblings().attr("data-id"),s="",o="",u="",f="";n.collection.toJSON().forEach(function(e){e.id==i&&(_.isEmpty(e.name)||(s=e.name),_.isEmpty(e.positionName)||(o="/"+e.positionName),_.isEmpty(e.departmentName)||(u="/"+e.departmentName),f=s+o+u,f.length>0&&(f='"'+f+'"'))}),console.log(sessionStorage.getItem("GO-Agent-mail")),_.isNull(sessionStorage.getItem("GO-Agent-mail"))&&sessionStorage.setItem("GO-Agent-mail",this._getGoAgentMail()),window.location.href=r.contextRoot+"app/mail?work=write&toAddr="+encodeURIComponent(t(e.currentTarget).attr("data-email"))}return},_getGoAgentMail:function(){return GO.util.isMobileApp()?GO.util.isAndroidApp()?"GO-Android":"GO-iPhone":"BROWSER"}});return{render:function(e){return p=new d(e),p.render()}}});