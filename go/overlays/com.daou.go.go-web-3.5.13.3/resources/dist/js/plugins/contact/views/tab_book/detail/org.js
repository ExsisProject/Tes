define(function(require){var e=require("app"),t=require("backbone"),n=require("hgn!contact/templates/tab_book/connector_list"),r=require("hgn!contact/templates/tab_book/connector_detail"),i=require("contact/collections/contacts_org_member"),s=require("i18n!nls/commons"),o=require("i18n!contact/nls/contact"),u=require("i18n!nls/user");require("jquery.placeholder"),require("jquery.go-sdk");var a={all:s["\uc804\uccb4"],search:s["\uac80\uc0c9"],user:s["\uc0ac\uc6a9\uc790"],group:s["\uadf8\ub8f9"],etc:s["\uae30\ud0c0"],search_null:s["\uac80\uc0c9\uacb0\uacfc\uc5c6\uc74c"],list_more:s["\ub354\ubcf4\uae30"],user:s["\uc0ac\uc6a9\uc790"],name:s["\uc774\ub984"],dept:u["\ubd80\uc11c"],position:u["\uc9c1\uc704"],email:u["\uc774\uba54\uc77c"],company:u["\ud68c\uc0ac"],mobileNo:o["\ud734\ub300\ud3f0"]},f=t.View.extend({className:"content_list",events:{"keydown #contactSearch1":"_onKeyupSearch","click #contactSearch2":"_onClickSearch","click .btn_list_reload":"_onClickListMore","click #contactChkAll":"contactChkAll","click #contactTable tr td[class!='checkbox']":"selectLow"},mode:"MAIL",isMailMode:function(){return this.mode=="MAIL"},isSMSMode:function(){return this.mode=="SMS"},isMailExposure:function(){return this.isMailMode()&&e.config("mailExposure")},initialize:function(e){this.mode=_.isEmpty(e.mode)?this.mode:e.mode},render:function(){this.$el.html(r({lang:a,isMailExposure:this.isMailExposure(),isSMSMode:this.isSMSMode()})),this._setPlaceHolder()},_setPlaceHolder:function(){var e=[];e.push(a.name),e.push(a.dept),this.$el.find("#contactSearch1").attr("placeholder",e),this.$el.find("input[placeholder], textarea[placeholder]").placeholder()},selectLow:function(e){var t=$(e.currentTarget).parents("tr").first(),n=t.find("input"),r=n.is(":checked");t.find("input[type=checkbox]").not("[disabled]").attr("checked",!r)},contactChkAll:function(e){var t=$(e.currentTarget).is(":checked");this.$el.find("#contactTable").find("tbody input[type=checkbox]").not("[disabled]").attr("checked",t)},refresh:function(e){this._initListEl();var t={deptId:e.deptId,deptName:e.deptName,keyword:null,page:0},n=i.getCollection(t.deptId,t.keyword,t.page);this._makeListEl(n,t.deptName,t)},_makeListEl:function(e,t,r){var i=this,s=n({data:e.toJSON(),lang:a,isMailExposure:this.isMailExposure(),isSMSMode:this.isSMSMode(),isCheckBoxEnable:function(){return i.isMailMode()?!0:this.mobileNo},departmentName:function(){return t?t:this.departments?this.departments.join(","):""},positionName:function(){return this.position}});this.$("#contactChkAll").attr("checked",!1);var o=this.$el.find("#contactTable tbody");o.append(s);if(e.page.lastPage||e.page==0)$(".bottom_action").hide();else{$(".bottom_action").show();var u=this.$el.find(".btn_list_reload");u.data("params",r)}},_onKeyupSearch:function(e){e.keyCode==13&&this._onClickSearch()},_onClickSearch:function(){var t=this.$el.find("#contactSearch1").val();if(!t){$.goSlideMessage(s["\uac80\uc0c9\uc5b4\ub97c \uc785\ub825\ud558\uc138\uc694."],"caution");return}if(!$.goValidation.isCheckLength(2,64,t)){$.goSlideMessage(e.i18n(s["0\uc790\uc774\uc0c1 0\uc774\ud558 \uc785\ub825\ud574\uc57c\ud569\ub2c8\ub2e4."],{arg1:"2",arg2:"64"}),"caution");return}var n={deptId:0,keyword:t,page:0},r=i.getCollection(n.deptId,n.keyword,n.page);this._initListEl(),this._makeListEl(r,"",n),this.$el.find("#contactSearch1").val(""),this.trigger("click.search")},_initListEl:function(e){this.$el.find("#contactTable tbody").empty()},_onClickListMore:function(e){var t=$(e.currentTarget),n=t.data("params");n.page=n.page+1;var r=i.getCollection(n.deptId,n.keyword,n.page);this._makeListEl(r,n.deptName,n)},getSelectedUsers:function(){var e=this.$el.find("#contactTable tbody input[type='checkbox']:checked");if(e.length==0)throw new Error("not select users");var t=[];return $.each(e,function(){var e=$(this);if(e.data("nodetype")=="department")return;var n={name:e.data("name"),email:e.data("email"),deptName:e.data("deptname"),position:e.data("position"),mobileNo:e.data("mobileno")};t.push(n)}),t},getSelectedGroup:function(){var e=this.$el.find('tbody input[data-nodetype="department"][type="checkbox"]:checked');if(e.length==0)return{};var t=[];return $.each(e,function(){var e=$(this).data("id"),n=$(this).data("name");t.push({dataId:e,dataName:n})}),{data:t,groupType:"ORG"}}});return f});