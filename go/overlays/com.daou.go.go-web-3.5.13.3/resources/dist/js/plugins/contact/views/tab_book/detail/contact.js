define(function(require){var e=require("app"),t=require("backbone"),n=require("hgn!contact/templates/tab_book/connector_list"),r=require("hgn!contact/templates/tab_book/connector_detail"),i=require("contact/collections/contacts"),s=require("contact/collections/search_contact"),o=require("i18n!nls/commons"),u=require("i18n!contact/nls/contact"),a=require("i18n!nls/user");require("jquery.placeholder"),require("jquery.go-sdk");var f={all:o["\uc804\uccb4"],search:o["\uac80\uc0c9"],user:o["\uc0ac\uc6a9\uc790"],group:o["\uadf8\ub8f9"],etc:o["\uae30\ud0c0"],search_null:o["\uac80\uc0c9\uacb0\uacfc\uc5c6\uc74c"],list_more:o["\ub354\ubcf4\uae30"],user:o["\uc0ac\uc6a9\uc790"],name:o["\uc774\ub984"],dept:a["\ubd80\uc11c"],position:a["\uc9c1\uc704"],email:a["\uc774\uba54\uc77c"],company:a["\ud68c\uc0ac"],mobileNo:u["\ud734\ub300\ud3f0"]},l=t.View.extend({className:"content_list",events:{"keydown #contactSearch1":"_onKeyupSearch","click #contactSearch2":"_onClickSearch","click .btn_list_reload":"_onClickListMore","click #contactChkAll":"contactChkAll","click #contactTable tr td[class!='checkbox']":"selectLow"},mode:"MAIL",LIST_TYPE:{LIST:"LIST",SEARCH:"SEARCH"},isMailMode:function(){return this.mode=="MAIL"},isSMSMode:function(){return this.mode=="SMS"},isDept:function(){return this.type=="DEPARTMENT"},initialize:function(e){this.mode=e.mode,this.type=e.type,this.groupId=e.groupId,this.deptId=e.deptId},render:function(){this.$el.html(r({lang:f,isMailExposure:this.isMailMode(),isSMSMode:this.isSMSMode()})),this._setPlaceHolder()},_setPlaceHolder:function(){var e=[];e.push(f.name),this.isMailMode()?e.push(f.email):e.push(f.mobileNo),e.push(f.company),this.$el.find("#contactSearch1").attr("placeholder",e),this.$el.find("input[placeholder], textarea[placeholder]").placeholder()},refresh:function(e){this._renderList(e)},_renderList:function(e){function r(){this.$el.find("#contactTable tbody").empty()}this.type=_.isUndefined(e.type)?this.type:e.type,this.groupId=_.isUndefined(e.groupId)?this.groupId:e.groupId,this.initial=_.isUndefined(e.initial)?this.initial:e.initial,this.deptId=_.isUndefined(e.deptId)?this.deptId:e.deptId;var t={};t.type=this.type,t.groupId=this.groupId,t.initialConsonantPattern=this.initial,this.isDept()&&(t.deptId=this.deptId),r.call(this);var n=new i;n.findAll(t),t["list-type"]=this.LIST_TYPE.LIST,this._makeListEl(n,t)},_makeListEl:function(e,t){var r=this,i=n({data:e.toJSON(),lang:f,isMailExposure:this.isMailMode(),isSMSMode:this.isSMSMode(),isCheckBoxEnable:function(){return r.isMailMode()?this.email.length?!0:!1:this.nodeType=="department"||this.mobileNo.length}}),s=this.$el.find("#contactTable tbody");s.append(i),this.$el.find("#contactChkAll").attr("checked",!1);if(e.page.lastPage)this.$el.find(".bottom_action").hide();else{this.$el.find(".bottom_action").show();var o=this.$el.find(".btn_list_reload");o.data("list-type",t["list-type"]),o.data("page",e.page.page),o.data("params",t)}},_onKeyupSearch:function(e){e.keyCode==13&&this._onClickSearch()},_onClickSearch:function(){var t=this.$el.find("#contactSearch1").val();if(!t){$.goSlideMessage(o["\uac80\uc0c9\uc5b4\ub97c \uc785\ub825\ud558\uc138\uc694."],"caution");return}if(!$.goValidation.isCheckLength(2,64,t)){$.goSlideMessage(e.i18n(o["0\uc790\uc774\uc0c1 0\uc774\ud558 \uc785\ub825\ud574\uc57c\ud569\ub2c8\ub2e4."],{arg1:"2",arg2:"64"}),"caution");return}var n=new s,r={ownerType:this.type,keyword:t};this.isDept()&&(r.deptId=this.deptId),n.search(r),this._initListEl(),r["list-type"]=this.LIST_TYPE.SEARCH,this._makeListEl(n,r),this.$el.find("#contactSearch1").val(""),this.trigger("detail.search")},_initListEl:function(e){this.$el.find("#contactTable tbody").empty()},_onClickListMore:function(e){var t=$(e.currentTarget),n=t.data("list-type"),r=t.data("page"),o=t.data("params"),u;o.page=r+1,o["list-type"]=n,this.LIST_TYPE.LIST==n?(u=new i,u.findAll(o)):(u=new s,u.search(o)),this._makeListEl(u,o)},contactChkAll:function(e){var t=$(e.currentTarget).is(":checked");this.$el.find("#contactTable").find("tbody input[type=checkbox]").not("[disabled]").attr("checked",t)},selectLow:function(e){var t=$(e.currentTarget).parents("tr").first(),n=t.find("input"),r=n.is(":checked");t.find("input[type=checkbox]").not("[disabled]").attr("checked",!r)},getSelectedUsers:function(){var e=this.$el.find("#contactTable tbody input[type='checkbox']:checked");if(e.length==0)throw new Error("not select users");var t=[];return $.each(e,function(){var e=$(this),n={name:e.data("name"),email:e.data("email"),deptName:e.data("deptname"),position:e.data("position"),mobileNo:e.data("mobileno")};t.push(n)}),t}});return l});