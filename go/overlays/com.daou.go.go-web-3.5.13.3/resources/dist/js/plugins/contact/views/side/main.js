define(function(require){var e=require("jquery"),t=require("backbone"),n=require("app"),r=require("hgn!contact/templates/side"),i=require("i18n!nls/commons"),s=require("i18n!contact/nls/contact"),o=require("contact/models/contact_side"),u=require("contact/views/side/groups/user"),a=require("contact/views/side/groups/department"),f=require("contact/views/side/groups/company");require("jquery.go-popup"),require("jquery.go-validation");var l={USER:s["\uac1c\uc778 \uc8fc\uc18c\ub85d"],COMPANY:s["\uc804\uc0ac \uc8fc\uc18c\ub85d"],DEPARTMENT:s["\ubd80\uc11c \uc8fc\uc18c\ub85d"],contact_group:s["\uc8fc\uc18c\ub85d \uadf8\ub8f9"],group_add:s["\uc5f0\ub77d\ucc98 \uadf8\ub8f9 \ucd94\uac00"],contact_add:s["\uc5f0\ub77d\ucc98 \uc8fc\uc18c\ub85d \ucd94\uac00"],contact_all:s["\uc804\uccb4 \uc8fc\uc18c\ub85d"],contact_manage:s["\uc8fc\uc18c\ub85d \uad00\ub9ac"],group_manage:s["\uadf8\ub8f9\uad00\ub9ac"],fold:i["\uc811\uae30"],open:i["\ud3bc\uce58\uae30"],new_contact:s["\uc0c8 \uc5f0\ub77d\ucc98"],contact:s["\uc8fc\uc18c\ub85d"],delete_contact:s["\uc8fc\uc18c\ub85d \uc0ad\uc81c"]},c=null,h={isCompany:function(e){return e=="COMPANY"},isUser:function(e){return e=="USER"},isDept:function(e){return e=="DEPARTMENT"}},p={personal:"USER",company:"COMPANY",dept:"DEPARTMENT"},d=t.View.extend({STORE_KEY:{DEPARTMENT:GO.session("loginId")+"-contact-department-toggle",COMPANY:GO.session("loginId")+"-contact-company-toggle",USER:GO.session("loginId")+"-contact-personal-toggle"},el:"#side",events:{"click #contactCreate":"contactCreate","click .side_toggle":"slideContactToggle","click .user_contact":"getUserContact","click .company_contact":"getCompanyContact"},initialize:function(){this.$el.off(),GO.EventEmitter.on("contact","changed:sideGroups",function(){this.contactSide=o.read(),this._renderGroups(),this._selectSideMenu()},this),this.contactSide=o.read()},render:function(){this._renderGroups(),this._selectSideMenu()},_renderGroups:function(){function i(){var e=new u({collection:this.contactSide.getPersonalGroups()});this.$el.append(e.el),e.render()}function s(){var e=this.contactSide.getDeptGroups();if(e.isEmpty())return;var t=new a({collection:this.contactSide.getDeptGroups()});this.$el.append(t.el),t.render()}function o(){var e=this.contactSide.getCompanyGroups();if(!this.contactSide.isAdmin()&&e.isEmpty())return;var t=new f({collection:e,isManager:this.contactSide.get("admin")});this.$el.append(t.el),t.render()}var t=r({lang:l,appName:GO.util.getAppName("contact"),contextRoot:GO.config("contextRoot")});this.$el.html(t);var n={USER:e.proxy(i,this),DEPARTMENT:e.proxy(s,this),COMPANY:e.proxy(o,this)};this.contactSide.get("priority").priorityTypes.forEach(function(e){n[e]()})},contactCreate:function(){n.router.navigate("contact/create",{trigger:!0,pushState:!0})},_selectSideMenu:function(){var e=n.router.getUrl().split("?"),t=e[0].split("/"),r=p[t[1]];this.$el.find("p.title").removeClass("on");if(n.router.getUrl()=="contact"){this.$el.find("section.lnb:first li.group:first p.title").addClass("on");return}if(n.router.getUrl()=="contact/create"){this.$el.find("section.lnb[data-type='USER'] li.group:first p.title").addClass("on");return}var i=function(){return h.isDept(r)?t[3]=="modify"?"":t[4]:t[2]}();if(i){this.$el.find("[data-id="+i+"]>p.title").addClass("on");return}if(h.isDept(r)){var s=t[2],o=this.$el.find("section.lnb[data-type='DEPARTMENT']");o.find("[data-dept-id="+s+"] li.group:first>p.title").addClass("on");return}h.isUser(r)&&this.$el.find("section.lnb[data-type='USER'] ul.side_depth li:first>p.title").addClass("on")},getInitParam:function(){return this.contactSide.getInitMenu()}},{create:function(){return c===null&&(c=new layoutView),c.render()}});return d});