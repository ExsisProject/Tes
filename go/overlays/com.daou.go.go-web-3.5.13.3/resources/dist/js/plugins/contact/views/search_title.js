define(function(require){var e=require("app"),t=require("hgn!contact/templates/search_title"),n=require("contact/views/search_layer"),r=require("dashboard/views/search/detail_search_popup"),i=require("i18n!nls/commons");require("jquery.go-grid"),require("jquery.go-popup"),require("jquery.go-validation");var s={placeholder_search:i["\ud50c\ub808\uc774\uc2a4\ud640\ub354\uac80\uc0c9"],search_detail:i["\uc0c1\uc138\uac80\uc0c9"],search:i["\uac80\uc0c9"],app_search:i["\uc571\uac80\uc0c9"],unified_search:i["\ud1b5\ud569\uac80\uc0c9"],detail:i["\uc0c1\uc138"],contact:i["\uc8fc\uc18c\ub85d"]},o={USER:"user",COMPANY:"company",DEPARTMENT:"department"},u=Backbone.View.extend({el:".content_top",events:{"click #detailContactSearch":"detailContactSearch","click #simpleContactSearch":"simpleContactSearch","keydown #simpleContactInput":"simpleContactInput"},isUser:function(){return this.type=="USER"},isCompany:function(){return this.type=="COMPANY"},isDept:function(){return this.type=="DEPARTMENT"},initialize:function(){this.type=this.options.type,this.groupId=this.options.groupId,this.deptId=this.options.deptId,this.$el.off()},render:function(){var e=t({lang:s});this.$el.find("#search").remove(),this.$el.append(e),$("input[placeholder], textarea[placeholder]").placeholder()},detailContactSearch:function(e){var t=$("#searchType").val();t!="appSearch"?this.totalSearchDetailPopup(e):this.appSearchDetailPopup(e)},appSearchDetailPopup:function(e){var t=$(e.currentTarget).offset(),r=this;this.appSearchPopup=$.goSearch({header:i["\uc0c1\uc138\uac80\uc0c9"],modal:!0,offset:{top:parseInt(t.top+30,10),right:7},callback:function(){r.searchAction()}}),$("div.detail_search input").die("keydown"),$("div.detail_search input").live("keydown",function(e){r.detailSearchNameInput(e)}),n.render()},totalSearchDetailPopup:function(e){var t=this,n=new r,s=$(e.currentTarget).offset(),o=$.goSearch({modal:!0,header:i["\uc0c1\uc138\uac80\uc0c9"],offset:{top:parseInt(s.top+30,10),right:7},callback:function(){n.validate()&&t.search(n.getSearchParam())}});o.find(".content").html(n.el),n.render()},simpleContactSearch:function(){var t=$.trim($("#simpleContactInput").val()),n=$("#searchType").val();if(t==""||t==$("#simpleContactInput").attr("placeholder")){$.goSlideMessage(i["\uac80\uc0c9\uc5b4\ub97c \uc785\ub825\ud558\uc138\uc694."],"caution");return}if(!$.goValidation.isCheckLength(2,64,t)){$.goMessage(e.i18n(i["0\uc790\uc774\uc0c1 0\uc774\ud558 \uc785\ub825\ud574\uc57c\ud569\ub2c8\ub2e4."],{arg1:"2",arg2:"64"}));return}if($.goValidation.isInValidEmailChar(t)){$.goMessage(i["\uba54\uc77c \uc0ac\uc6a9 \ubd88\uac00 \ubb38\uc790"]);return}var r={name:t,keyword:t,deptId:this.deptId,ownerType:o[this.type],date:GO.util.toISO8601(new Date)};n=="appSearch"?(r.email=t,r.mobileNo=t,r.companyName=t,r.officeTel=t,r.searchType="or",e.router.navigate("contact/search?"+this._serializeObj(r),{replace:!0,trigger:!0,pushState:!0})):(r.stype="simple",r.searchTerm="all",r.offset=5,e.router.navigate("unified/search?"+this._serializeObj(r),!0))},searchAction:function(){var t=this.appSearchPopup,n=$.trim(t.find("#name").val()),r=$.trim(t.find("#email").val()),s=$.trim(t.find("#mobileNo").val()),o=$.trim(t.find("#companyName").val()),u=$.trim(t.find("#officeTel").val()),a=t.find("#searchType").val();if(n==""&&r==""&&s==""&&o==""&&u==""){$.goSlideMessage(i["\uac80\uc0c9\uc5b4\ub97c \uc785\ub825\ud558\uc138\uc694."],"caution");return}var f=function(e,t){return $.goMessage(e),t&&t.focus(),!1};if(n.length>0){if(!$.goValidation.isCheckLength(2,64,n))return f(e.i18n(i["0\uc790\uc774\uc0c1 0\uc774\ud558 \uc785\ub825\ud574\uc57c\ud569\ub2c8\ub2e4."],{arg1:"2",arg2:"64"}),$("#name")),!1;if($.goValidation.isInValidEmailChar(n))return $.goMessage(i["\uba54\uc77c \uc0ac\uc6a9 \ubd88\uac00 \ubb38\uc790"]),!1}if(r.length>0){if(!$.goValidation.isCheckLength(2,255,r))return f(e.i18n(i["0\uc790\uc774\uc0c1 0\uc774\ud558 \uc785\ub825\ud574\uc57c\ud569\ub2c8\ub2e4."],{arg1:"2",arg2:"255"}),$("#email")),!1;if($.goValidation.isInValidEmailChar(r))return $.goMessage(i["\uba54\uc77c \uc0ac\uc6a9 \ubd88\uac00 \ubb38\uc790"]),!1}if(!$.goValidation.isCheckLength(0,40,s))return f(e.i18n(i["0\uc790\uc774\uc0c1 0\uc774\ud558 \uc785\ub825\ud574\uc57c\ud569\ub2c8\ub2e4."],{arg1:"0",arg2:"40"}),$("#mobileNo")),!1;if($.goValidation.isInValidEmailChar(s))return $.goMessage(i["\uba54\uc77c \uc0ac\uc6a9 \ubd88\uac00 \ubb38\uc790"]),!1;if(!$.goValidation.isCheckLength(0,255,o))return f(e.i18n(i["0\uc790\uc774\uc0c1 0\uc774\ud558 \uc785\ub825\ud574\uc57c\ud569\ub2c8\ub2e4."],{arg1:"0",arg2:"255"}),$("#companyName")),!1;if($.goValidation.isInValidEmailChar(o))return $.goMessage(i["\uba54\uc77c \uc0ac\uc6a9 \ubd88\uac00 \ubb38\uc790"]),!1;if(!$.goValidation.isCheckLength(0,40,u))return f(e.i18n(i["0\uc790\uc774\uc0c1 0\uc774\ud558 \uc785\ub825\ud574\uc57c\ud569\ub2c8\ub2e4."],{arg1:"0",arg2:"40"}),$("#officeTel")),!1;if($.goValidation.isInValidEmailChar(u))return $.goMessage(i["\uba54\uc77c \uc0ac\uc6a9 \ubd88\uac00 \ubb38\uc790"]),!1;var l={name:n,email:r,mobileNo:s,companyName:o,officeTel:u,ownerType:a,date:GO.util.toISO8601(new Date)};l["ownerType"]=="DEPARTMENT"&&(l.deptId=$("#deptList").val()),this.search(l)},search:function(t){var n=$("#searchType").val();n=="appSearch"?e.router.navigate("contact/search?"+this._serializeObj(t),{trigger:!0,pushState:!0}):e.router.navigate("unified/search?"+this._serializeObj(t),{trigger:!0,pushState:!0})},detailSearchNameInput:function(e){e.keyCode==13&&this.searchAction()},simpleContactInput:function(e){e.keyCode==13&&this.simpleContactSearch()},_serializeObj:function(e){var t=[];for(var n in e)e[n]!=undefined&&e[n]!=""&&t.push(encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t.join("&")}});return{render:function(e,t,n){var r=new u({type:e,groupId:t,deptId:n});return r.render()}}});