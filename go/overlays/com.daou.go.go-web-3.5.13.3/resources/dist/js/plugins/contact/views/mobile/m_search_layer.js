(function(){define(function(require){var e=require("jquery"),t=require("backbone"),n=require("app"),r=require("i18n!nls/commons"),i=require("i18n!contact/nls/contact"),s=require("i18n!admin/nls/admin"),o=require("hgn!contact/templates/mobile/m_search_layer"),u=require("contact/views/mobile/m_search_result"),a=require("views/mobile/m_search_header"),f=require("collections/joined_depts");require("GO.util");var l=null,c={"\uac80\uc0c9 \uc870\uac74":r["\uac80\uc0c9 \uc870\uac74"],"\uc804\uccb4":r["\uc804\uccb4"],"\uac80\uc0c9":r["\uac80\uc0c9"],"\uc774\ub984(\ud45c\uc2dc\uba85)":i["\uc774\ub984(\ud45c\uc2dc\uba85)"],"\uc774\uba54\uc77c":r["\uc774\uba54\uc77c"],"\ud734\ub300\ud3f0":i["\ud734\ub300\ud3f0"],"\uac1c\uc778\uc8fc\uc18c\ub85d":i["\uac1c\uc778 \uc8fc\uc18c\ub85d"],"\uacf5\uc6a9\uc8fc\uc18c\ub85d":i["\uacf5\uc6a9 \uc8fc\uc18c\ub85d"],"\ubd80\uc11c\uc8fc\uc18c\ub85d":i["\ubd80\uc11c \uc8fc\uc18c\ub85d"],"\ud68c\uc0ac":i["\ud68c\uc0ac"],"\ud68c\uc0ac\uc804\ud654":i["\ud68c\uc0ac\uc804\ud654"],"\ucd08\uae30\ud654":s["\ucd08\uae30\ud654"],"\uc8fc\uc18c\ub85d \uad6c\ubd84":i["\uc8fc\uc18c\ub85d \uad6c\ubd84"],"\uac80\uc0c9 \ud0a4\uc6cc\ub4dc\ub97c \uc785\ub825\ud558\uc138\uc694":r["\uac80\uc0c9 \ud0a4\uc6cc\ub4dc\ub97c \uc785\ub825\ud558\uc138\uc694."]},h=t.View.extend({el:"#goSearch",events:{"vclick #searchInit":"_detailSearchInit","vclick a[data-search]":"_simpleSearch","keyup #detailSearchWrap input":"_detailSearch","change #searchType":"_searchAddrType"},initialize:function(e){this.$el.off(),this.joinedDepts=f.fetch()},render:function(){return this.$el.html(o({lang:c,depts:this.joinedDepts.toJSON()})),this._renderSearchHeader(),this.el},_renderSearchHeader:function(){var e=this;a.render({enterSimpleSearchCallback:function(t){e._simpleSearch(t)}})},_detailSearchInit:function(t){t.preventDefault(),e("#detailSearchWrap input").val("")},_detailSearch:function(t){if(t.keyCode!=13)return;var r={collectionType:"search",ownerType:e("#searchType").val(),date:n.util.toISO8601(new Date),offset:"20",page:"0",property:"nameInitialConsonant",direction:"asc",searchType:"and"},i=e.trim(e("#addrName").val()),s=e.trim(e("#addrEmail").val()),o=e.trim(e("#addrMobileNo").val()),a=e.trim(e("#addrCompanyName").val()),f=e.trim(e("#addrOfficeTel").val()),l=[{data:i,id:"addrName"},{data:s,id:"addrEmail"},{data:o,id:"addrMobileNo"},{data:a,id:"addrCompanyName"},{data:f,id:"addrOfficeTel"}];if(GO.util.isAllEmptySearchText(l)){alert(c["\uac80\uc0c9 \ud0a4\uc6cc\ub4dc\ub97c \uc785\ub825\ud558\uc138\uc694"]);return}if(!GO.util.isValidSearchTextForDetail(l))return;r=e.extend(r,{name:i,email:s,mobileNo:o,companyName:a,officeTel:f}),r["ownerType"]=="DEPARTMENT"&&(r.deptId=e("#deptList").val());var h={};Object.keys(r).forEach(function(e){r[e]!=""&&(h[e]=r[e])}),u.render(h)},_simpleSearch:function(t){t.preventDefault();var r=e(t.currentTarget),i=e.trim(e("#commonSearchInput").val());if(!GO.util.isValidSearchText(i))return;var s=r.attr("data-search")||"all",o={collectionType:"search",date:n.util.toISO8601(new Date),offset:"20",page:"0",property:"nameInitialConsonant",direction:"asc"},a=GO.router.getUrl().split("/")[1];a==="personal"?o.ownerType="user":a==="dept"?(o.ownerType="department",o.deptId=GO.router.getUrl().split("/")[2]):a==="company"&&(o.ownerType="company"),s=="all"?o=e.extend(o,{searchData:"all",name:i,keyword:i,email:i,mobileNo:i,companyName:i,officeTel:i,searchType:"or"}):(o[s]=i,o.searchType="and"),u.render(o)},_searchAddrType:function(t){var n=e(t.currentTarget);n.val()=="DEPARTMENT"?this.$el.find("#deptList").show():this.$el.find("#deptList").hide()}});return{render:function(e){return l=new h(e),l.render()}}})}).call(this);