define(function(require){var e=require("app"),t=require("hgn!contact/templates/tab_book/connector_group"),n=require("approval/views/apprform/admin_company_folder_tree"),r=require("contact/views/tab_book/detail/contact"),i=require("contact/views/tab_book/toolbar/initial_bar");require("jquery.jstree"),require("jquery.go-sdk");var s=Backbone.View.extend({type:"COMPANY",initialize:function(e){this.detailView=new r({type:this.type,mode:e.mode}),this.companySideView=new u,this.initialView=new i,this.initialView.on("click.initialWord",$.proxy(function(e){this.detailView.refresh({initial:e})},this)),this.companySideView.on("click.companySideView",$.proxy(function(e){this.detailView.refresh({groupId:e.groupId,type:this.type}),this.initialView.show(),this.initialView.reset()},this)),this.detailView.on("detail.search",$.proxy(function(){this.initialView.hide()},this))},render:function(){this.$el.html(t());var e=this.$el.find("#contactWrap");e.append(this.companySideView.el),e.append(this.detailView.el),this.$el.append(this.initialView.el),this.companySideView.render(),this.detailView.render(),this.initialView.render()},getSelectedGroup:function(){return this.companySideView.getSelectedGroup()},getSelectedUsers:function(){return this.detailView.getSelectedUsers()}}),o=n.extend({_getCommonUrl:function(){return e.contextRoot+"api/contact/companyfolder/manage"},_onSelectNode:function(e,t){var n=$(t.rslt.obj[0]),r=this.getSelectedNodeData(n);r&&r.readable&&_.isFunction(this.selectCallback)?this.selectCallback(r):n.find(".jstree-clicked").removeClass("jstree-clicked"),t.inst.toggle_node(t.rslt.obj[0])}}),u=Backbone.View.extend({className:"content_tab_wrap",template:"<div id='group-tree' style='height:350px' class='jstree jstree-default'><ul></ul></div>",initialize:function(){},render:function(){this.$el.html(this.template),this.renderTree()},renderTree:function(){this.treeView=new o({maxDepth:this.maxDepth,maxChildren:this.maxChildren,isAdmin:!1,dragable:!1,treeElementId:"group-tree",selectCallback:$.proxy(function(e){this.trigger("click.companySideView",{groupId:e.id})},this)}),this.treeView.render()},getSelectedGroup:function(){var e=this.$el.find("a.jstree-clicked").closest("li"),t=e.data("id"),n=e.data("name");if(!t)throw new Error("not select group");return{data:[{dataId:t,dataName:n}],groupType:"GROUP"}}});return s});