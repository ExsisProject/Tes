(function(){define(function(require){var e=require("jquery"),t=require("backbone"),n=require("app"),r=require("contact/collections/search_contact"),i=require("text!contact/templates/mobile/m_search_result.html"),s=require("text!contact/templates/mobile/m_search_result_item.html"),o=require("views/mobile/m_search_common_result"),u=require("i18n!nls/commons"),a=require("i18n!contact/nls/contact");require("GO.util");var f=null,l={"\uac80\uc0c9\uacb0\uacfc\uc5c6\uc74c":u["\uac80\uc0c9\uacb0\uacfc\uc5c6\uc74c"],"\uac80\uc0c9\uacb0\uacfc":u["\uac80\uc0c9\uacb0\uacfc"]},c=t.View.extend({el:"#searchResultWrap",events:{"vclick a[data-id]":"_getContact","vclick .telMobile":"_telMobile","vclick .smsMobile":"_smsMobile","vclick .sendMail":"_sendMail"},initialize:function(e){var t=this;this.options=e,this.$el.off(),this.collection=new r,this.lastPage=!1,this.listenTo(this.collection,"reset",this._renderContacts),o.set({collection:this.collection,searchOptions:this.options,renderListFunc:function(e){t._renderContacts(e)},renderListMoreFunc:function(e){t._moreList(e)}})},render:function(){return o.fetch({renderListFunc:this._renderContacts,renderMoreListFunc:this._moreList}),this.el},_renderContacts:function(t){var r=t.toJSON();this.$el.html(Hogan.compile(i).render({lang:l,data:r,resultCount:t.page.total,isAvailableMail:function(){return n.isAvailableApp("mail")?!0:!1}},{partial:s})),e("#detailSearchToggle").removeClass("on"),this._showResultWrap()},_moreList:function(e){var t=e.toJSON();this.$el.find("ul:first").append(Hogan.compile(s).render({lang:l,data:t,isAvailableMail:function(){return n.isAvailableApp("mail")?!0:!1}}))},_showResultWrap:function(){e("#simpleSearchWrap").hide(),e("#detailSearchWrap").hide(),e("#searchResultWrap").show()},_getContact:function(t){function u(e){var t=["contact"];return t.push("company"),t.push(e.getCompanyGroupId()),t.push("view"),t.push(e.getId()),t.join("/")}function a(e){var t=["contact"];return t.push("dept"),t.push(e.getDeptId()),t.push("view"),t.push(e.getId()),t.join("/")}function f(e){var t=["contact"];return t.push("view"),t.push(e.getId()),t.join("/")}t.preventDefault();var n=e(t.currentTarget),r=n.data("id"),i=this.collection.findById(r),s={COMPANY:u,USER:f,DEPARTMENT:a},o=s[i.getOwnerType()](i);GO.router.navigate(o,{trigger:!0,pushState:!0})},_telMobile:function(t){t.preventDefault(),t.stopPropagation(),window.location.href="tel:"+e(t.currentTarget).attr("data-mobile");return},_smsMobile:function(t){t.preventDefault(),t.stopPropagation(),GO.config("isMobileApp")?window.location.href="smsto:"+e(t.currentTarget).attr("data-mobile"):window.location.href="sms://"+e(t.currentTarget).attr("data-mobile");return},_sendMail:function(t){t.preventDefault();if(!n.isAvailableApp("mail"))return;var r=this;t.stopPropagation();if(confirm(a["\uba54\uc77c\uc744 \ubcf4\ub0b4\uc2dc\uaca0\uc2b5\ub2c8\uae4c?"])){var i=e(t.currentTarget).parent().siblings().attr("data-id"),s="",o="",u="",f="",l="";r.collection.toJSON().forEach(function(e){e.id==i&&(_.isEmpty(e.name)||(s=e.name),_.isEmpty(e.positionName)||(o="/"+e.positionName),_.isEmpty(e.departmentName)||(u="/"+e.departmentName),f=s+o+u,f.length>0&&(f='"'+f+'"'))}),l=encodeURI(f+"<"+e(t.currentTarget).attr("data-email")+">"),window.location.href="/app/mail?work=write&toAddr="+l}return}});return{render:function(e){return f=new c(e),f.render()}}})}).call(this);