(function(){define(function(require){var e=require("jquery"),t=require("backbone"),n=require("app"),r=require("views/mobile/header_toolbar"),i=require("contact/collections/contacts_pager"),s=require("hgn!contact/templates/mobile/m_home"),o=require("i18n!nls/commons"),u=require("i18n!contact/nls/contact");require("GO.util");var a=null,f={add_contact:u["\uc5f0\ub77d\ucc98 \ucd94\uac00"],return_home:o["\ud648\uc73c\ub85c \uc774\ub3d9"],not_contact:o["\uac80\uc0c9\uacb0\uacfc\uc5c6\uc74c"]},l=t.View.extend({el:"#content",events:{"vclick a[data-id]":"getContact",'vclick a[data-btn="paging"]':"goPaging","vclick .telMobile":"telMobile","vclick .smsMobile":"smsMobile","vclick .sendMail":"sendMail"},initialize:function(e){this.$el.off();var t=n.router.getSearch();this.collection=new i([],{keyword:t.keyword,collectionType:"search",searchType:"or"}),this.listenTo(this.collection,"reset",this.renderContacts)},render:function(){return this.titleRenderView(),this.collection.fetch(),this.el},titleRenderView:function(){var e={title:o["\uac80\uc0c9\uacb0\uacfc"],isClose:!0,isWriteBtn:!0,writeBtnCallback:function(){n.router.navigate("contact/create",{trigger:!0,pushState:!0})}};r.render(e)},goPaging:function(t){GO.EventEmitter.trigger("common","layout:scrollToTop",this),t.stopPropagation();var n=e(t.currentTarget).data("direction");n==="next"?this.collection.nextPage():this.collection.prevPage()},getContact:function(t){function u(e){var t=["contact"];return t.push("company"),t.push(e.getCompanyGroupId()),t.push("view"),t.push(e.getId()),t.join("/")}function a(e){var t=["contact"];return t.push("dept"),t.push(e.getDeptId()),t.push("view"),t.push(e.getId()),t.join("/")}function f(e){var t=["contact"];return t.push("view"),t.push(e.getId()),t.join("/")}var n=e(t.currentTarget),r=n.data("id"),i=this.collection.findById(r),s={COMPANY:u,USER:f,DEPARTMENT:a},o=s[i.getOwnerType()](i);GO.router.navigate(o,{trigger:!0,pushState:!0})},telMobile:function(t){t.stopPropagation(),window.location.href="tel:"+e(t.currentTarget).attr("data-mobile");return},smsMobile:function(t){t.stopPropagation(),GO.config("isMobileApp")?window.location.href="smsto:"+e(t.currentTarget).attr("data-mobile"):window.location.href="sms://"+e(t.currentTarget).attr("data-mobile");return},sendMail:function(t){if(!n.isAvailableApp("mail"))return;var r=this;t.stopPropagation();if(confirm(u["\uba54\uc77c\uc744 \ubcf4\ub0b4\uc2dc\uaca0\uc2b5\ub2c8\uae4c?"])){var i=e(t.currentTarget).parent().siblings().attr("data-id"),s="",o="",a="",f="",l="";r.collection.toJSON().forEach(function(e){e.id==i&&(_.isEmpty(e.name)||(s=e.name),_.isEmpty(e.positionName)||(o="/"+e.positionName),_.isEmpty(e.departmentName)||(a="/"+e.departmentName),f=s+o+a,f.length>0&&(f='"'+f+'"'))}),l=encodeURI(f+"<"+e(t.currentTarget).attr("data-email")+">"),window.location.href="/app/mail?work=write&toAddr="+l}return},renderContacts:function(){this.$el.html(s({lang:f,data:this.collection.toJSON(),isAvailableMail:function(){return n.isAvailableApp("mail")?!0:!1}}));var e=GO.util.mPaging(this.collection);this.$el.find(".paging").remove(),this.$el.append(e)}});return{render:function(e){return a=new l(e),a.render()}}})}).call(this);