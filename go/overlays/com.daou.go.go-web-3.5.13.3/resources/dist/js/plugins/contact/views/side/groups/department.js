define(function(require){function p(t,n){var r=t.closest("section"),i=t.parents("h1"),o=i.find(".ic_side");r.find("ul.side_depth").slideToggle("fast",function(){e(this).css("display")=="block"?(i.removeClass("folded"),o.attr("title",a["\uc811\uae30"])):(i.addClass("folded"),o.attr("title",a["\ud3bc\uce58\uae30"]));var t=!i.hasClass("folded");s.storeCategoryIsOpen(n,t)})}var e=require("jquery"),t=require("backbone"),n=require("app"),r=require("hgn!contact/templates/side_dept"),i=require("hgn!contact/templates/side_depts"),s=require("contact/helpers/local_storage"),o=require("contact/views/side/components/add_group"),u=require("contact/views/side/components/manage_popup"),a=require("i18n!nls/commons"),f=require("i18n!contact/nls/contact");require("jquery.go-popup"),require("jquery.go-validation");var l={USER:f["\uac1c\uc778 \uc8fc\uc18c\ub85d"],COMPANY:f["\uc804\uc0ac \uc8fc\uc18c\ub85d"],DEPARTMENT:f["\ubd80\uc11c \uc8fc\uc18c\ub85d"],contact_group:f["\uc8fc\uc18c\ub85d \uadf8\ub8f9"],group_add:f["\uc5f0\ub77d\ucc98 \uadf8\ub8f9 \ucd94\uac00"],contact_add:f["\uc5f0\ub77d\ucc98 \uc8fc\uc18c\ub85d \ucd94\uac00"],contact_all:f["\uc804\uccb4 \uc8fc\uc18c\ub85d"],contact_manage:f["\uc8fc\uc18c\ub85d \uad00\ub9ac"],group_manage:f["\uadf8\ub8f9\uad00\ub9ac"],fold:a["\uc811\uae30"],open:a["\ud3bc\uce58\uae30"],new_contact:f["\uc0c8 \uc5f0\ub77d\ucc98"],contact:f["\uc8fc\uc18c\ub85d"],delete_contact:f["\uc8fc\uc18c\ub85d \uc0ad\uc81c"]},c=t.View.extend({tagName:"section",className:"lnb",SIDE_STORE_KEY:n.session("loginId")+"-contact-dept-toggle",events:{"click .side_toggle":"sideToggle"},type:"DEPARTMENT",initialize:function(e){this.$el.attr("data-type","DEPARTMENT"),this.collection=e.collection},render:function(){this.$el.html(i({lang:l,isToggleOpen:s.getStoredCategoryIsOpen(this.SIDE_STORE_KEY)})),this.collection.each(e.proxy(function(e){var t=new h({deptName:e.get("deptName"),deptId:e.get("deptId"),collection:e.get("groups")});this.$el.find("ul.side_depth").append(t.el),t.render()},this))},sideToggle:function(t){var n=e(t.currentTarget);p(n,this.SIDE_STORE_KEY)}}),h=t.View.extend({tagName:"li",className:"org",events:{"click span.contactTag":"moveLink","click span.groupManage":"groupManage"},type:"DEPARTMENT",initialize:function(e){this.deptId=e.deptId,this.$el.attr("data-dept-id",this.deptId),this.collection=e.collection,this.deptName=e.deptName,this.addGroupView=new o({type:this.type,deptId:this.deptId})},render:function(){this.$el.html(r({lang:l,data:this.collection,deptName:this.deptName,hasContactCount:function(){return this.contactCount>0}})),this.$el.find("#dept_groups").append(this.addGroupView.el),this.addGroupView.render()},groupManage:function(){var e=this.$el.closest("section").find("p.on").closest("li"),t=new u({type:this.type,deptId:this.deptId,id:e.data("id")});t.render()},moveLink:function(t){function o(e){var t=[];return t.push("contact"),t.push("dept"),t.push(this.deptId),e&&(t.push("group"),t.push(e)),t.join("/")}var r=e(t.currentTarget),i=r.closest("li.group").data("id"),s=o.call(this,i);n.router.navigate(s,{trigger:!0,pushState:!0}),n.EventEmitter.trigger("contact","changed:sideGroups")}});return c});