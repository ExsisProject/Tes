define("store/views/iframe_view",function(require){var e=require("backbone"),t=require("app"),n=require("jquery"),r=require("store/models/store_admin"),i=require("system/models/linkplus_config"),s=require("hgn!store/templates/iframe");return e.View.extend({events:{"click #storeHome":"render"},initialize:function(){this.isAdmin=r.getInstance().isAdmin(),this.siteUrl=_.find(t.session().companies,function(e){return e.userId===t.session().id}).siteUrl,this.serviceConfig=i.get(!1)},render:function(){var e=this;return n.when(this.getLinkplusOauthConfig(this.serviceConfig.getServerHost())).done(function(t){var r=e.makeUrlParam(t.data),i="https://"+e.siteUrl+"/oauth-authorize?"+r;e.$el.html(s({remoteUrl:i}));var o=n("#storeIframe");o.load(function(){e.sendMessageIframe(this,t.data.state)}),e.resizeIframe(o),n(window).resize(function(){e.resizeWindow(e.resizeIframe,o)})}).fail(function(){n.goMessage("\uc694\uccad \ucc98\ub9ac \uc911 \uc624\ub958\uac00 \ubc1c\uc0dd\ud558\uc600\uc2b5\ub2c8\ub2e4.")}),n("body").hasClass("go_skin_advanced")||n("#organogram").hide(),e},sendMessageIframe:function(e,t){e.contentWindow.postMessage({state:t,siteUrl:this.siteUrl||null,isAppAdmin:this.isAdmin},this.serviceConfig.getClientHost())},getLinkplusOauthConfig:function(e){return n.ajax({type:"GET",url:e+"/oauth/config",async:!1})},makeUrlParam:function(e){var t={client_id:e.clientId,redirect_uri:e.redirectUri,state:e.state,response_type:"code"};return Object.keys(t).map(function(e){return e+"="+encodeURIComponent(t[e])}).join("&")},resizeIframe:function(e){var t=n(window).innerHeight(),r=t,i=n(".content_top").innerHeight();n(".go_body").css("min-height","inherit"),n("body").hasClass("go_skin_advanced")||(i+=n("#menu-container").innerHeight()),e.height(r-i-5)},resizeWindow:function(e){var t=0,n=0,r=Array.prototype.slice.call(arguments,1);if(!t){var i=++n;setTimeout(function(){i===n&&!t&&(t++,e.apply(undefined,r),t--)},200)}}})});