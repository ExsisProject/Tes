define("store/views/detail",function(require){var e=require("backbone"),t=require("app"),n=require("jquery"),r=require("store/models/product"),i=require("i18n!admin/nls/admin"),s=require("store/models/store_admin"),o=require("i18n!nls/commons"),u=require("i18n!store/nls/store"),a=require("store/views/sso_form"),f=require("store/models/terms_provided"),l=require("store/views/terms_provided"),c=e.View.extend({el:"#innerContent",events:{"click #register":"register","click #goToList ":"goToList","click #useService":"useService","click a[data-type='prev']":"bannerLeft","click a[data-type='next']":"bannerRight","click .list_accordion .subject":"toggleAccordion","click .serviceLink":"openServicePage"},initialize:function(e){this.isAdmin=s.getInstance().isAdmin(),this.tmpl=e.tmpl,this.code=e.code,this.product=new r({code:this.code}),this.initializeBanner()},render:function(){n(this.el).addClass("linkplus_detail");var e=this;this.product.fetch().done(n.proxy(function(){var n=e.product.attributes;e.$el.html(e.tmpl({storeLang:u,commonLang:o,isApply:e.isAdmin&&n.status==="REGISTRATION_APPLY",inUse:n.status==="REGISTRATION_COMPLETE",canUse:n.status==="REGISTRATION_COMPLETE"&&n.ssoFlag,canRegister:e.isAdmin&&n.status!=="REGISTRATION_COMPLETE",baseImgUrl:t.contextRoot+"resources/images/linkplus/"})),n.ssoFlag&&(e.ssoFormView=new a,e.$el.append(e.ssoFormView.render()))}))},useService:function(){var e=this,t=this.product.attributes,n=f.getInstance(t.id).isAgreed();if(!n){var r={btext:u["\uc0ac\uc6a9\ud558\uae30"],callback:function(t,n){e.saveTermsProvided(t,n)}},i=new l;i.popUpTermsProvided(t,r);return}this.useSSO(t)},useSSO:function(e){var r=this;n.ajax({type:"GET",url:t.contextRoot+"api/store/service/sso/data?storeProductId="+e.id,success:function(t){r.ssoFormView.postSSOForm(e,t.data)},error:function(e){n.goSlideMessage(i["\uc694\uccad \ucc98\ub9ac \uc911 \uc624\ub958\uac00 \ubc1c\uc0dd\ud558\uc600\uc2b5\ub2c8\ub2e4."],"caution")}})},saveTermsProvided:function(e,t){var n=this,r=new f(e.id);r.save(null,{url:r.getUrl()+"&agreed="+t,success:function(){n.useSSO(e)},error:function(){}})},register:function(){var e=this,t=this.product.attributes;if(t.regAdditionFlag){this.goToRegistration();return}if(t.termsProvided){this.postRegistration(t,t.termsProvided);return}var n={btext:o["\uc2e0\uccad\ud558\uae30"],callback:function(t,n){e.postRegistration(t,n)}},r=new l;r.popUpTermsProvided(t,n)},postRegistration:function(e,r){var i=this;n.ajax({type:"POST",dataType:"json",url:t.contextRoot+"api/store/service/registration",contentType:"application/json",data:JSON.stringify({storeProductId:e.id,termsProvided:r}),success:function(e){i.checkOpenUrl(e.data),t.router.navigate("store/"+i.code+"/detail",!0),n.goSlideMessage(u["\uc2e0\uccad\uc774 \uc644\ub8cc\ub418\uc5c8\uc2b5\ub2c8\ub2e4."])},error:function(e){n.goSlideMessage(e.responseJSON.message,"caution")}})},goToRegistration:function(){t.router.navigate("store/"+this.code+"/register",!0)},goToList:function(){n(this.el).removeClass(),t.router.navigate("store/all",!0)},initializeBanner:function(){this.BANNER_INDEX=0,this.BANNER_LEN=3,this.BANNER_WIDTH=801},bannerLeft:function(){var e=this.BANNER_INDEX-1;e<0&&(e=this.BANNER_LEN-1),this.showBannerAt(e)},bannerRight:function(){var e=this.BANNER_INDEX+1;e>=this.BANNER_LEN&&(e=0),this.showBannerAt(e)},showBannerAt:function(e){this.updateBannerIndex(e);if(e!==this.BANNER_INDEX){var t=-this.BANNER_WIDTH*e;n("#banner_wrapper").stop(),n("#banner_wrapper").animate({left:t},1e3),this.BANNER_INDEX=e}},updateBannerIndex:function(e){var t=this.$el.find(".banner_rolling_page span");t.removeClass("on"),n(t[e]).addClass("on")},toggleAccordion:function(e){n(e.currentTarget).siblings(".desc").toggleClass("on"),n(e.currentTarget).siblings(".desc")[0].classList.contains("on")?(n(e.currentTarget).find("div.optional").children("span").removeClass("arrow_d"),n(e.currentTarget).find("div.optional").children("span").addClass("arrow_t")):(n(e.currentTarget).find("div.optional").children("span").removeClass("arrow_t"),n(e.currentTarget).find("div.optional").children("span").addClass("arrow_d"))},checkOpenUrl:function(e){var t=e.openUrl;t&&t.trim()!==""&&window.open(t,"_blank")},openServicePage:function(e){var t=n(e.currentTarget).data("url");window.open(t,"_blank")}});return c});