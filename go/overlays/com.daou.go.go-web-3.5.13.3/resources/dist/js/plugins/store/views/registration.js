define("store/views/registration",function(require){var e=require("backbone"),t=require("app"),n=require("underscore"),r=require("jquery"),i=require("hgn!store/templates/registration"),s=require("store/models/product"),o=require("json!store/views/products.json"),u=require("i18n!admin/nls/admin"),a=require("i18n!nls/commons"),f=require("i18n!store/nls/store"),l=require("store/models/store_admin"),c=e.View.extend({el:".linkplus",events:{"click #register":"register","click #cancel":"goBack","click #popCollect":"popUpTermsCollect","click #popProvided":"popUpTermsProvided","click #popMarketing":"popUpTermsMarketing"},initialize:function(e){this.isAdmin=l.getInstance().isAdmin(),this.code=e,this.product=new s({code:this.code})},render:function(){if(!this.isAdmin){t.router.navigate("/store",!0);return}var e=this;this.product.fetch().done(r.proxy(function(){e.makeProductData(),e.$el.html(i({baseImgUrl:t.contextRoot+"resources/images/linkplus/",product:e.product,commonLang:a,storeLang:f,partnerName:e.product.partnerName}))}))},makeProductData:function(){var e=this,t=n.find(o,function(t){return t.code===e.code});this.product=r.extend({},this.product.attributes,t)},register:function(){var e=this;if(!this.validateForm())return!1;var n=this.getFormData();r.ajax({type:"POST",dataType:"json",url:t.contextRoot+"api/store/service/registration",contentType:"application/json",data:JSON.stringify(n),success:function(n){t.router.navigate("store/"+e.code+"/detail",!0),r.goSlideMessage(f["\uc2e0\uccad\uc774 \uc644\ub8cc\ub418\uc5c8\uc2b5\ub2c8\ub2e4."])},error:function(e){r.goSlideMessage(e.responseJSON.message,"caution")}})},getFormData:function(){var e=r("#regForm :input:not(:checkbox)"),i=t.util.serializeForm(e),s=r("#regForm :input[type=checkbox]");return n.each(s,function(e){i[e.name]=e.checked}),i.storeProductId=this.product.id,i.additionalService=this.product.name,i},validateForm:function(){var e=this.validateInputs(),t=this.validateCheckboxes();return e.value?t.value?!0:(r.goSlideMessage(t.message+"\uac00 \ud544\uc694\ud569\ub2c8\ub2e4"),!1):(r.goSlideMessage(e.message),!1)},validateInputs:function(){var e={value:!0,message:f["\ud544\uc218\ud56d\ubaa9\uc744 \ubaa8\ub450 \uc785\ub825\ud574\uc8fc\uc138\uc694."]},t=r("#regForm :input[type=text]");return n.find(t,function(t){if(t.value.trim()==="")return e.value=!1,!0;if(t.name==="additionalEmail"){var n=r.goValidation.isValidEmail(t.value);n||(e.value=!1,e.message=a["\uc774\uba54\uc77c \ud615\uc2dd\uc774 \uc62c\ubc14\ub974\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4."])}}),e},validateCheckboxes:function(){var e={value:!0,message:""},t=r("#regForm :input[type=checkbox]");return n.each(t,function(t){t.name!=="termsMarketing"&&!t.checked&&(e.value=!1,e.message=e.message===""?r("label[for='"+t.id+"'] > a").text():e.message)}),e},goBack:function(){return t.router.navigate("store/"+this.code+"/detail",!0)},popUpTermsCollect:function(){var e=r("#collectTmpl").html();r.goPopup({header:"\uac1c\uc778\uc815\ubcf4 \uc218\uc9d1 \ubc0f \ud65c\uc6a9 \ub3d9\uc758",modal:!0,pclass:"layer_normal layer_linkplus_apply",contents:e})},popUpTermsProvided:function(){var e=r("#providedTmpl").html();r.goPopup({header:"\uac1c\uc778\uc815\ubcf4 \uc81c3\uc790 \uc81c\uacf5 \ub3d9\uc758",modal:!0,pclass:"layer_normal layer_linkplus_apply",contents:e})},popUpTermsMarketing:function(){var e=r("#marketingTmpl").html();r.goPopup({header:"\ub9c8\ucf00\ud305 \uc218\uc2e0 \ub3d9\uc758",modal:!0,pclass:"layer_normal layer_linkplus_apply",contents:e})}});return c});