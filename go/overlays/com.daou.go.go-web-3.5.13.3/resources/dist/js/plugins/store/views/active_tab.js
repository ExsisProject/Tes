define("store/views/active_tab",function(require){var e=require("backbone"),t=require("app"),n=require("underscore"),r=require("jquery"),i=require("hgn!store/templates/active_tab"),s=require("store/collections/products"),o=require("json!store/views/products.json"),u=require("components/backdrop/backdrop"),a=require("store/models/store_admin"),f=require("i18n!admin/nls/admin"),l=require("i18n!store/nls/store"),c=require("store/views/sso_form"),h=require("store/views/terms_provided"),p=require("store/models/terms_provided"),d=e.View.extend({el:"#innerContent",events:{"click a.btn_more":"toggleMore","click li.cancelBtn":"cancelService","click #goToAllTabBtn":"goToAllTab","click a.useBtn":"useService","click .list_album_thum":"goToDetail","click #guide":"openGuide","click #banner":"openBanner","click #closeBanner":"closeBanner"},initialize:function(){this.isAdmin=a.getInstance().isAdmin();var e="my",t={statuses:["REGISTRATION_COMPLETE"]};this.isAdmin&&t.statuses.push("REGISTRATION_APPLY"),this.myProducts=new s(e,t)},getProductList:function(){this.productList=[];var e=this;n.each(o,function(t){var n=e.myProducts.getByProductCode(t.code);if(n){var i=r.extend({},t,n);e.productList.push(i)}}),this.productList=n.sortBy(this.productList,"sortOrder")},render:function(){var e=this;return this.ssoFormView=new c,this.myProducts.fetch().done(r.proxy(function(){this.bannerOpened=r.cookie("isStoreBannerClosed")!=="true",this.getProductList(),this.$el.html(i({showBanner:e.bannerOpened,baseImgUrl:t.contextRoot+"resources/images/linkplus/",lang:l,hasProducts:this.productList.length>0,products:this.productList,button:function(){if(this.status==="REGISTRATION_COMPLETE")return"button"},canCancel:function(){return this.status==="REGISTRATION_COMPLETE"&&e.isAdmin},canUse:function(){return this.status==="REGISTRATION_COMPLETE"&&this.ssoFlag},inUse:function(){return this.status==="REGISTRATION_COMPLETE"},inApplying:function(){return this.status==="REGISTRATION_APPLY"&&e.isAdmin}})),r(".linkplus_my").show(),r("#active").append(this.ssoFormView.render())},this)),this},toggleMore:function(e){this.backdropView=new u,this.backdropView.backdropToggleEl=r(e.currentTarget).children(".array_option"),this.backdropView.linkBackdrop(r("a[id="+e.currentTarget.id+"]"))},cancelService:function(e){var n=this,i=r(e.currentTarget).attr("data-id");r.ajax({type:"POST",dataType:"json",url:t.contextRoot+"api/store/service/cancel",contentType:"application/json",data:JSON.stringify({storeProductId:i}),success:function(e){n.checkOpenUrl(e.data),t.router.navigate("store/my",!0),r.goSlideMessage(l["\ud574\uc9c0 \uc2e0\uccad\uc774 \uc644\ub8cc\ub418\uc5c8\uc2b5\ub2c8\ub2e4."])},error:function(e){var t=e.responseJSON.message;t!=null?r.goSlideMessage(t,"caution"):r.goSlideMessage(f["\uc694\uccad \ucc98\ub9ac \uc911 \uc624\ub958\uac00 \ubc1c\uc0dd\ud558\uc600\uc2b5\ub2c8\ub2e4."],"caution")}})},useService:function(e){var t=this,n=r(e.currentTarget).attr("data-id"),i=this.myProducts.getByProductId(n),s=p.getInstance(i.id).isAgreed();if(!s){var o={btext:l["\uc0ac\uc6a9\ud558\uae30"],callback:function(e,n){t.saveTermsProvided(e,n)}},u=new h;u.popUpTermsProvided(i,o);return}this.useSSO(i)},saveTermsProvided:function(e,t){var n=this,r=new p(e.id);r.save(null,{url:r.getUrl()+"&agreed="+t,success:function(){n.useSSO(e)},error:function(){}})},useSSO:function(e){var n=this;r.ajax({type:"GET",url:t.contextRoot+"api/store/service/sso/data?storeProductId="+e.id,success:function(t){n.ssoFormView.postSSOForm(e,t.data)},error:function(e){r.goSlideMessage(f["\uc694\uccad \ucc98\ub9ac \uc911 \uc624\ub958\uac00 \ubc1c\uc0dd\ud558\uc600\uc2b5\ub2c8\ub2e4."],"caution")}})},goToAllTab:function(){t.router.navigate("store/all",!0)},goToDetail:function(e){var n=r(e.currentTarget).attr("data-code");return this.logDetailViewOpen(n),t.router.navigate("store/"+n+"/detail",!0)},checkOpenUrl:function(e){var t=e.openUrl;t&&t.trim()!==""&&window.open(t,"_blank")},logDetailViewOpen:function(e){r.ajax({type:"GET",url:t.contextRoot+"api/store/service/logging/detail/view?code="+e})},openGuide:function(){window.open("https://www.daouoffice.com/linkplus.jsp","guide")},openBanner:function(e){var n=r(e.currentTarget).attr("data-btype");r.ajax({type:"GET",url:t.contextRoot+"api/store/service/logging/banner?bannerType="+n}),window.open("https://daouoffice.com/cloud_guide/etc/LinkPlus.pdf","banner")},closeBanner:function(){r.cookie("isStoreBannerClosed",!0,{expires:1}),r("div .banner_s").remove()}});return d});