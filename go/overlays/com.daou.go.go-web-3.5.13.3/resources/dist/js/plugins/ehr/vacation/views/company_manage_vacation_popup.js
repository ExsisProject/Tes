define("vacation/views/company_manage_vacation_popup",function(require){var e=require("backbone"),t=require("app"),n=require("hgn!vacation/templates/company_manage_vacation_popup"),r=require("i18n!vacation/nls/vacation"),i=require("i18n!nls/commons"),s=require("underscore");require("jquery.inputmask");var o={"\uc774\ub984":r["\uc774\ub984"],"\uc785\uc0ac\uc77c":r["\uc785\uc0ac\uc77c"],"\uc794\uc5ec \uc5f0\ucc28":r["\uc794\uc5ec \uc5f0\ucc28"],"\ubc1c\uc0dd \uc5f0\ucc28":r["\ubc1c\uc0dd \uc5f0\ucc28"],"\uc870\uc815 \uc5f0\ucc28":r["\uc870\uc815 \uc5f0\ucc28"],"\uc870\uc815\uc5f0\ucc28":r["\uc870\uc815\uc5f0\ucc28"],"\uc6d4\ucc28":r["\uc6d4\ucc28"],"\uc120\ud0dd":r["\uc120\ud0dd"],"\uadfc\uc18d\uc5f0\ucc28":r["\uadfc\uc18d\uc5f0\ucc28"],"1\ub144 \ubbf8\ub9cc\uc790 \uc6d4\ucc28":r["1\ub144 \ubbf8\ub9cc\uc790 \uc6d4\ucc28"],"\uc5f0\ucc28 \uc218":r["\uc5f0\ucc28 \uc218"],"\ucd94\uac00":r["\ucd94\uac00"],"\uc81c\uc678":r["\uc81c\uc678"],"\uc0ac\uc6a9\uae30\ud55c":r["\uc0ac\uc6a9\uae30\ud55c"],"\ud68c\uacc4\uc5f0\ub3c4 \ub610\ub294 \uc785\uc0ac\uc77c \uae30\uc900\uc5d0 \ub530\ub77c \uc801\uc6a9\ub429\ub2c8\ub2e4":r["\ud68c\uacc4\uc5f0\ub3c4 \ub610\ub294 \uc785\uc0ac\uc77c \uae30\uc900\uc5d0 \ub530\ub77c \uc801\uc6a9\ub429\ub2c8\ub2e4."],"\ub0b4\uc6a9":r["\ub0b4\uc6a9"],"\uc5f0\ucc28\ub294 0.25 \ub2e8\uc704\ub85c \ub4f1\ub85d\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.":r["\uc5f0\ucc28\ub294 0.25 \ub2e8\uc704\ub85c \ub4f1\ub85d\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4."],"\uc7ac\uc9c11\ub144\uc774\uc0c1 \uc6d4\ucc28 \uc5d0\ub7ec\uba54\uc2dc\uc9c0":r["\uc7ac\uc9c11\ub144\uc774\uc0c1 \uc6d4\ucc28 \uc5d0\ub7ec\uba54\uc2dc\uc9c0"],"\uc5f0\ucc28 \uc790\ub3d9 \uc0dd\uc131":r["\uc5f0\ucc28 \uc790\ub3d9 \uc0dd\uc131"],"\uc124\uc815\uc77c":r["\uc124\uc815\uc77c"],"\ub2e8\uc77c \uc790\ub3d9 \uc0dd\uc131 \uc124\uba85":r["\ub2e8\uc77c \uc790\ub3d9 \uc0dd\uc131 \uc124\uba85"],"\uc785\uc0ac\uc77c \ubbf8\uc785\ub825":r["\uc785\uc0ac\uc77c \ubbf8\uc785\ub825"],"\ub2e4\uc911 \uc790\ub3d9 \uc0dd\uc131 \uc124\uba85":r["\ub2e4\uc911 \uc790\ub3d9 \uc0dd\uc131 \uc124\uba85"]},u={ALL:"ALL",SINGLE_SELECTED:"SINGLE_SELECTED",MULTI_SELECTED:"MULTI_SELECTED"},a=e.Model.extend({url:function(){return t.contextRoot+"api/ehr/vacation/manage/"+this.id},initialize:function(e,t){this.id=t.id}}),f=e.Model.extend({url:t.contextRoot+"api/ehr/vacation/company/points/all"}),l=e.Model.extend({url:function(){return t.contextRoot+"api/ehr/vacation/company/point/"+this.id},initialize:function(e,t){this.id=t.id}}),c=e.Model.extend({url:t.contextRoot+"api/ehr/vacation/company/points",initialize:function(e,t){this.ids=t.ids}}),h={ALL:f,SINGLE_SELECTED:l,MULTI_SELECTED:c,newInstance:function(e,t){var n=this[e];if(s.isUndefined(n))throw new Error("no found model type");return new this[e](null,t)}},p=e.View.extend({events:{"change [name='vacation_type']":"changeVacationType","change #operation":"togglePeriod","change #hire_date":"onChangeHireDate","click #autoCreateConfig":"changeAutoCreateConfig"},initialize:function(e,t){this.$el.off(),this.type=u[e],this.accountUseEhr=s.isUndefined(t)?!1:t.accountUseEhr,this.createHireDateTrial=!1;if(s.isUndefined(this.type))throw new Error("not found view type");this.options=t,this.model=h.newInstance(this.type,t),this.vacationType="YEAR",this.isSingleSelected()&&(this.queryModel=new a(null,t),this.queryModel.fetch({async:!1}))},render:function(){var e={lang:o,isUsePeriod:$.proxy(function(){return!this.isYearType()},this),isSingleSelected:this.isSingleSelected(),accountUseEhr:this.accountUseEhr};this.isSingleSelected()&&(e.data=this.queryModel.toJSON(),e.data.autoCreateActivateInfo=e.data&&e.data.autoCreateActivate?e.data.autoCreateActivate.toUpperCase():"",e.email=t.session("email")),this.$el.html(n(e)),this.$el.find("#point").inputmask("numeric",{groupSeparator:",",digits:2,allowMinus:!1,integerDigits:2});var r=t.util.customDate(t.util.now(),"YYYY-MM-DD");if(this.isSingleSelected()){var i=this.queryModel.get("hireDate");this.accountUseEhr||this.initDatePicker(i,this.$el.find("#hire_date"),!1)}var s=this.$el.find("#expired_date");return this.initDatePicker(r,s,!0),this},onChangeHireDate:function(e){var t=this.queryModel.get("hireDate"),n=this.$el.find("#hire_date").val()?this.$el.find("#hire_date").val():this.$el.find("#hire_date").text();!this.createHireDateTrial&&!t&&n&&($("#autoCreateConfig").attr("class","ic_control ic_ctrl_on"),$("#autoCreateConfig").data("value","on"),this.createHireDateTrial=!0),this.setMaxDate()},toggle:function(){var e=this.$el.find("#operation").val(),t=this.$el.find("#vacation_period"),n=this.$el.find("#vacation_year_desc");if(e=="MINUS"){n.hide(),t.hide();return}this.isYearType()?(t.hide(),n.show()):(t.show(),n.hide()),this.isSingleSelected()&&this.vacationType=="YEAR"?(this.$el.find("#restYearPoint").show(),this.$el.find("#restMonthPoint").hide(),this.$el.find("#restAdditionPoint").hide()):this.isSingleSelected()&&this.vacationType=="MONTH"?(this.$el.find("#restYearPoint").hide(),this.$el.find("#restMonthPoint").show(),this.$el.find("#restAdditionPoint").hide()):this.isSingleSelected()&&this.vacationType=="ETC"&&(this.$el.find("#restYearPoint").hide(),this.$el.find("#restMonthPoint").hide(),this.$el.find("#restAdditionPoint").show())},setMaxDate:function(){var e=this.$el.find("#expired_date"),n=this.$el.find("#hire_date").val()||t.util.customDate(t.util.now(),"YYYY-MM-DD"),r;this.isMonthType()?r=moment(n).add("years",1).subtract("days",1):this.isEtcType()&&(r=t.util.now().add("years",1)),e.datepicker("option","maxDate",t.util.customDate(r,"YYYY-MM-DD"))},togglePeriod:function(){this.toggle(),this.setMaxDate()},isSingleSelected:function(){return this.type==u.SINGLE_SELECTED},isMultiSelected:function(){return this.type==u.MULTI_SELECTED},isYearType:function(){return this.vacationType=="YEAR"},isMonthType:function(){return this.vacationType=="MONTH"},isEtcType:function(){return this.vacationType=="ETC"},isNotYearType:function(){return!this.isYearType()},changeVacationType:function(e){var t=$(e.currentTarget);this.vacationType=t.val(),this.togglePeriod()},getData:function(){var e={},t=this.$el;return this.isSingleSelected()&&(e.hireDate=t.find("#hire_date").val()?t.find("#hire_date").val():t.find("#hire_date").text()),e.point=t.find("#point").val(),e.operation=t.find("#operation").val(),e.operation=="MINUS"&&(e.point*=-1),e.type=t.find("[name='vacation_type']:checked").val(),this.isNotYearType()&&(e.expiredDate=t.find("#expired_date").val()),e.reason=t.find("#reason").val(),e.autoCreateActivate=t.find("#autoCreateConfig").data("value")=="on"?!0:!1,this.isMultiSelected()?{model:e,ids:this.options.ids}:e},save:function(){var e=this.getData();this.validate(e),t.EventEmitter.trigger("common","layout:setOverlay","\ub85c\ub529\uc911"),this.model.save(e,{method:"PUT"}).done($.proxy(function(){this.trigger("save.success")},this)).fail(function(e){e&&e.responseJSON&&e.responseJSON.message?$.goMessage(e.responseJSON.message):$.goMessage(i["\uad00\ub9ac \uc11c\ubc84\uc5d0 \uc624\ub958\uac00 \ubc1c\uc0dd\ud558\uc600\uc2b5\ub2c8\ub2e4"])}).always(function(){t.EventEmitter.trigger("common","layout:clearOverlay")})},validate:function(e){var n,r;this.isMultiSelected()?r=e.model.point:r=e.point;var i=moment(e.hireDate).add("years",1).subtract("days",1),s=t.util.isAfter(t.util.now(),i);this.isSingleSelected()&&e.autoCreateActivate&&!e.hireDate&&(n=o["\uc785\uc0ac\uc77c \ubbf8\uc785\ub825"]),e.type==="MONTH"&&!s&&(n=o["\uc7ac\uc9c11\ub144\uc774\uc0c1 \uc6d4\ucc28 \uc5d0\ub7ec\uba54\uc2dc\uc9c0"]),r%.25!=0&&(n=o["\uc5f0\ucc28\ub294 0.25 \ub2e8\uc704\ub85c \ub4f1\ub85d\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4."]);if(n)throw $.goError(n),new Error(n)},initDatePicker:function(e,n,r,i){$("#ui-datepicker-div").remove(),$.datepicker.setDefaults($.datepicker.regional[t.config("locale")]);var s={dateFormat:"yy-mm-dd",changeMonth:!0,changeYear:!0,yearSuffix:""};r&&(s.minDate=t.util.customDate(t.util.now(),"YYYY-MM-DD")),n.datepicker(s),n.val(e)},changeAutoCreateConfig:function(e){var t=$(e.currentTarget),n=t.data("value");n=="on"?(t.attr("class","ic_control ic_ctrl_off"),t.data("value","off")):(t.attr("class","ic_control ic_ctrl_on"),t.data("value","on"))}});return p});