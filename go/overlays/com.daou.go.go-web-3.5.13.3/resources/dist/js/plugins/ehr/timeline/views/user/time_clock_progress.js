define("timeline/views/user/time_clock_progress",function(require){var e=require("backbone"),t=require("hgn!timeline/templates/user/time_clock_progress"),n=require("timeline/views/user/history_popup"),r=require("timeline/models/timeline_group"),i=require("timeline/models/auth"),s=require("i18n!timeline/nls/timeline"),o=require("app"),u=e.View.extend({events:{"click span#clockIn":"showEditPopup","click span#clockOut":"showEditPopup"},className:"progress ",initialize:function(e,t){this.options=e,this.viewModel=t,this.authModel=new i(o.util.store.get("timeline.auth")),this.dayInfo=this.options.data.detailDay,this.hour=this.options.hour,this.targetUserId=this.options.targetUserId,this.min=0,this.group=this.options.group,this.timelineGroup=new r(this.group),this.sHistory=this.viewModel.startHistory,this.eHistory=this.viewModel.endHistory,this.inStatusName=this.sHistory?this.sHistory.timelineStatus.name:"",this.outStatusName=this.eHistory?this.eHistory.timelineStatus.name:"",this.restTime=this.timelineGroup.isRestTime(this.hour,this.min),this.workTime=this.timelineGroup.isWorkTime(this.hour,this.min),this.nightTime=this.timelineGroup.isNightTime(this.hour,this.min),this.startTail=this.viewModel.startTail,this.endTail=this.viewModel.endTail},render:function(){this.$el.html(t({first:!!this.sHistory,last:!!this.eHistory,tomorrow:this.viewModel.tomorrow,inStatusName:this.inStatusName,outStatusName:this.outStatusName,clockInTime:this.getDetailTimeInfo(this.sHistory),clockOutTime:this.getDetailTimeInfo(this.eHistory)}));var e=(new Date(this.viewModel.endDate)-new Date(this.viewModel.startDate))/6e4;this.sHistory&&(this.$el.addClass("start"),e<=30&&!this.viewModel.overTime&&this.$el.addClass("initial")),this.eHistory&&(e<=60&&this.$el.addClass("initial"),this.$el.addClass("close")),this.viewModel.overTime?this.$el.addClass("part_overtime"):this.$el.addClass("part_default"),this.authModel.isEditable()&&this.$el.find("span").css("cursor","pointer"),this.startTail?this.$el.addClass("day_tail_l"):this.endTail&&this.$el.addClass("day_tail_r"),this.$el.css("left",this.viewModel.startPoint+"%"),this.$el.css("width",+(this.viewModel.endPoint-this.viewModel.startPoint)+"%")},getDetailTimeInfo:function(e){var t="GMT +09:00";return e?e.timezoneInfo?moment(e.checkTime).zone(e.timezoneInfo).format("HH:mm"):moment(e.checkTime).zone(t).format("HH:mm"):""},showEditPopup:function(e){if(!this.authModel.isEditable())return;var t=$(e.currentTarget),r=t.attr("id"),i=r==="clockIn"?this.sHistory:this.eHistory,s=new n({targetUserId:this.targetUserId,dayInfo:this.dayInfo,data:i});s.render()}});return u});