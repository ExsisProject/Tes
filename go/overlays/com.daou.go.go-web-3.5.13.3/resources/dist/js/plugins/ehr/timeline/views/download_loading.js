define("timeline/views/download_loading",function(require){var e=require("jquery"),t=require("underscore"),n=require("backbone"),r=require("app"),i=require("i18n!nls/commons"),s=require("i18n!timeline/nls/timeline");require("jquery.cookie"),require("jquery.go-preloader");var o=!1,u=n.View.extend({initialize:function(e){this.$appendTarget=e.appendTarget,this.getDownloadURL=e.getDownloadURL,this.week=e.week},render:function(){var t=[];t.push('<div class="btn_submenu">'),t.push('<a class="btn_tool btn_tool_multi" id="downloadFile">'),t.push('    <span class="ic_toolbar download"></span>'),t.push('    <span class="txt">{{lang.\ub2e4\uc6b4\ub85c\ub4dc}}</span>'),t.push("</a>"),t.push('<span class="btn_func_more" id="submenuBtn" backdrop-toggle="true"  el-backdrop-link>'),t.push('<span class="ic ic_arrow_type3"></span>'),t.push("</span>"),t.push('<div class="array_option list_download" id="downloadSubMenu" style="display: none">'),t.push('<ul class="array_type">'),t.push('<li id="downloadFile_sub"><span>{{lang.\ud56d\ubaa9\ub2e4\uc6b4\ub85c\ub4dc}}</span></li>'),t.push('<li id="downloadFile_sub2"><span>{{lang.\ucd9c\ud1f4\uadfc\ub2e4\uc6b4\ub85c\ub4dc}}</span></li>'),t.push('<li id="downloadFile_sub3"><span>{{lang.\uc120\ud0dd\uc801\uadfc\ubb34\uc2dc\uac04\ub2e4\uc6b4\ub85c\ub4dc}}</span></li>'),t.push("</ul>"),t.push("</div>"),t.push('<a id="hiddenDownloadFile" data-role="button" href="" style="display:none"></a>'),t.push('<form id="download_file_form" method="GET" style="display: none">'),t.push('<div id="download_file_form_div"> </div>'),t.push('<input type="hidden" value="" name="downloadTokenId" id="downloadTokenId"/></form>'),t.push('<iframe name="ifm_download_file_form" id="ifm_download_file_form" style="border:0px;width:0px;height:0px;"></iframe>'),this.$appendTarget.append(Hogan.compile(t.join("")).render({lang:{"\ub2e4\uc6b4\ub85c\ub4dc":i["\ubaa9\ub85d \ub2e4\uc6b4\ub85c\ub4dc"],"\ud56d\ubaa9\ub2e4\uc6b4\ub85c\ub4dc":s["\uc804\uccb4 \ud56d\ubaa9 \ubaa8\ub450 \ub2e4\uc6b4\ub85c\ub4dc"],"\ucd9c\ud1f4\uadfc\ub2e4\uc6b4\ub85c\ub4dc":s["\uc804\uccb4 \ucd9c\ud1f4\uadfc \uc2dc\uac04 \ub2e4\uc6b4\ub85c\ub4dc"],"\uc120\ud0dd\uc801\uadfc\ubb34\uc2dc\uac04\ub2e4\uc6b4\ub85c\ub4dc":s["\uc120\ud0dd\uc801 \uadfc\ubb34\uc2dc\uac04 \ub2e4\uc6b4\ub85c\ub4dc"]}})),this.$appendTarget.find("a#downloadFile").bind("click",e.proxy(this.download,this)),this.$appendTarget.find("li#downloadFile_sub").bind("click",e.proxy(this.download,this)),this.$appendTarget.find("li#downloadFile_sub2").bind("click",e.proxy(this.downloadSub,this)),this.$appendTarget.find("li#downloadFile_sub3").bind("click",e.proxy(this.downloadSelective,this)),this.$appendTarget.find("span#submenuBtn").bind("click",e.proxy(this.submenuToogle,this)),this.subMenuBarToogle()},submenuToogle:function(){if(this.week)return;var e=this.$appendTarget.find("#downloadSubMenu");this.subMenuActive?e.css("display","none"):e.css("display","inline-block"),this.subMenuActive=!this.subMenuActive},subMenuBarToogle:function(){this.week?(this.$appendTarget.find("span#submenuBtn").css("display","none"),this.$appendTarget.find("#downloadSubMenu").css("display","none"),this.subMenuActive=!1):this.$appendTarget.find("span#submenuBtn").css("display","inline-block")},updateGetDownloadUrl:function(e,t){this.getDownloadURL=e,this.week=t,this.subMenuBarToogle()},remove:function(){this.$appendTarget.find("#downloadFile").remove()},download:function(e){return e.preventDefault(),this.downloadFile({key:"excelType",value:"NORMAL"}),!1},downloadSub:function(e){return e.preventDefault(),this.downloadFile({key:"excelType",value:"CLOCKIN_OUT"}),!1},downloadSelective:function(e){return e.preventDefault(),this.downloadFile({key:"excelType",value:"SELECTIVE"}),!1},downloadFile:function(n){this.$appendTarget.find("#downloadSubMenu").css("display","none"),this.subMenuActive=!1;var i=this,s=location.protocol+"//"+location.hostname+(location.port?":"+location.port:"")+r.contextRoot+this.getDownloadURL.split("?")[0];e("#download_file_form").attr("action",s);var o=(new Date).getTime();e("#downloadTokenId").val(o);var u=this.parseParams(this.getDownloadURL.split("?")[1]||"");e("#download_file_form_div").empty(),t.each(u,function(t,n){e("#download_file_form_div").append('<input type="hidden" name="'+n+'" value="'+t+'">')}),n&&e("#download_file_form_div").append('<input type="hidden" name="'+n.key+'" value="'+n.value+'">'),preloader=e.goPreloader(),this.fileDownloadCheckTimer=window.setInterval(function(){var t=e.cookie("downloadTokenId");t==o&&i.finishDownload()},1e3),e("#download_file_form").attr("target","ifm_download_file_form"),e("#download_file_form").submit()},finishDownload:function(){window.clearInterval(this.fileDownloadCheckTimer),preloader.release()},parseParams:function(e){return e.split("&").reduce(function(e,t){var n=t.split("=").map(function(e){return decodeURIComponent(e.replace(/\+/g," "))});return e[n[0]]=n[1],e},{})}});return u});