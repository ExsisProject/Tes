(function(){define(["backbone","app","hgn!welfare/templates/company_manage_list","welfare/views/company_manage_welfare_popup","welfare/views/company_manage_change_popup","i18n!welfare/nls/welfare","i18n!nls/commons","jquery.go-grid"],function(e,t,n,r,i,s,o){var u={"ID(\uacc4\uc815)":s["ID(\uacc4\uc815)"],"\uc774\ub984":o["\uc774\ub984"],"\ubd80\uc11c\uba85":o["\ubd80\uc11c\uba85"],"\uc785\uc0ac\uc77c":s["\uc785\uc0ac\uc77c"],"\ub144\uac04 Point":s["\ub144\uac04 Point"],"\uc870\uc815 Point":s["\uc870\uc815 Point"],"\uc0ac\uc6a9 Point":s["\uc0ac\uc6a9 Point"],"\ub0a8\uc740 Point":s["\ub0a8\uc740 Point"],"\uc0c1\ud0dc":s["\uc0c1\ud0dc"],"\ubaa9\ub85d \ub2e4\uc6b4\ub85c\ub4dc":o["\ubaa9\ub85d \ub2e4\uc6b4\ub85c\ub4dc"],"\uc120\ud0dd \ucd94\uac00":s["\uc120\ud0dd \ucd94\uac00"],"\uc804\uccb4 \ucd94\uac00":s["\uc804\uccb4 \ucd94\uac00"],"\ubcf5\uc9c0\ud3ec\uc778\ud2b8 \ub370\uc774\ud130 \uc5c6\uc74c":s["\ubcf5\uc9c0\ud3ec\uc778\ud2b8 \ub370\uc774\ud130 \uc5c6\uc74c"],"\uc774\uc804":o["\uc774\uc804"],"\ub2e4\uc74c":o["\ub2e4\uc74c"],"\uc624\ub298":o["\uc624\ub298"],"\ucd94\uac00":o["\ucd94\uac00"],"\ub0a0\uc9dc \uc774\ub3d9":s["\ub0a0\uc9dc \uc774\ub3d9"],"\uae30\uac04":o["\uae30\uac04"],"\uc120\ud0dd\ub41c \ud56d\ubaa9\uc774 \uc5c6\uc2b5\ub2c8\ub2e4.":o["\uc120\ud0dd\ub41c \ud56d\ubaa9\uc774 \uc5c6\uc2b5\ub2c8\ub2e4."],"\uac1c\uc778 \ubcf5\uc9c0\ud3ec\uc778\ud2b8 \uc218\uc815":s["\uac1c\uc778 \ubcf5\uc9c0\ud3ec\uc778\ud2b8 \uc218\uc815"],"\ud655\uc778":o["\ud655\uc778"],"\ucde8\uc18c":o["\ucde8\uc18c"],"\uc800\uc7a5\ub418\uc5c8\uc2b5\ub2c8\ub2e4.":o["\uc800\uc7a5\ub418\uc5c8\uc2b5\ub2c8\ub2e4."],"\uac80\uc0c9":o["\uac80\uc0c9"],"\uc804\uccb4":o["\uc804\uccb4"],"\uc815\uc0c1":o["\uc815\uc0c1"],"\uba54\uc77c\ud734\uba74":s["\uba54\uc77c\ud734\uba74"],"\uc911\uc9c0":o["\uc911\uc9c0"],"\uac1c\uc778 \ubcf5\uc9c0\ud3ec\uc778\ud2b8 \uc218\uc815":s["\uac1c\uc778 \ubcf5\uc9c0\ud3ec\uc778\ud2b8 \uc218\uc815"]},a=e.View.extend({events:{"click #preDate":"preDate","click #nextDate":"nextDate","click #calArea":"showCalendar","click #selected_change":"selectedChange","click #all_change":"allChange","keyup #searchKeyword":"enterSearch","click #searchBtn":"clickSearch","change #searchTypes":"searchTypeChange","click #hiredate_search_btn":"hireDateSearch","change #status_types":"changeStatus","click #xlsxDownBtn":"xlsxDownload"},initialize:function(){},render:function(){var e=t.util.toMoment().year();return this.$el.html(n({lang:u,preDate:e-1,searchDate:e,nextDate:e+1})),this.renderList(),this.initDatePicker(),this.initSearchDatePicker(),this},xlsxDownload:function(){var e=t.contextRoot+"api/ehr/welfare/company/list/download",n={offset:99999,page:0,property:"userName",direction:"asc",year:this.$el.find("#searchDate").attr("data-date")};window.location.href=e+"?"+$.param(n)},enterSearch:function(e){if(e.keyCode!="13")return;this.search()},clickSearch:function(){this.search()},selectedChange:function(){var e=this.list.tables.getCheckedIds();if(e.length<1){$.goMessage(o["\uc120\ud0dd\ub41c \ud56d\ubaa9\uc774 \uc5c6\uc2b5\ub2c8\ub2e4."]);return}var t={type:"selected",ids:e};this.callChangePopup(t)},allChange:function(){var e={type:"company",year:this.$el.find("#searchDate").attr("data-date")};this.callChangePopup(e)},callChangePopup:function(e){var t=this,n=e.type=="company"?u["\uc804\uccb4 \ucd94\uac00"]:u["\uc120\ud0dd \ucd94\uac00"],r=$.goPopup({header:n,width:400,title:"",modal:!0,contents:"<div id='manageChangePopup'></div>",buttons:[{btype:"confirm",btext:u["\ud655\uc778"],callback:function(){a.save(),a.on("save.success",function(){$.goMessage(o["\uc800\uc7a5\ub418\uc5c8\uc2b5\ub2c8\ub2e4."]),r.close(),t.list.tables.fnClearTable()})}},{btype:"normal",btext:u["\ucde8\uc18c"],callback:function(){r.close()}}]}),s=$.extend({el:"#manageChangePopup"},e),a=new i(s);a.render()},hireDateSearch:function(){var e={year:this.$el.find("#searchDate").attr("data-date"),startHireDate:this.$el.find("#searchStartDate").val(),endHireDate:this.$el.find("#searchEndDate").val()};this.reloadList(e)},changeDate:function(e){_.isUndefined(e)&&(e=$("#searchDate").attr("data-date"));var n=t.util.formatDatetime(t.util.calDate(e,"years",-1),null,"YYYY"),r=t.util.formatDatetime(e,null,"YYYY"),i=t.util.formatDatetime(t.util.calDate(e,"years",1),null,"YYYY");this.$el.find("#preDate").attr("data-date",n),this.$el.find("#searchDate").attr("data-date",r),this.$el.find("#searchDate").text(r),this.$el.find("#nextDate").attr("data-date",i);var s={year:r};this.reloadList(s)},reloadList:function(e){this.list.tables.customParams=e,this.list.tables.customParams.searchField=this.$el.find("#searchTypes").val(),this.list.tables.fnClearTable()},changeStatus:function(){var e={year:this.$el.find("#searchDate").attr("data-date"),keyword:this.$el.find("#status_types").val()};this.reloadList(e)},search:function(){var e={year:this.$el.find("#searchDate").attr("data-date"),keyword:this.$el.find("#searchKeyword").val()};if($.trim(e.keyword)==""){$.goMessage(o["\uac80\uc0c9\uc5b4\ub97c \uc785\ub825\ud558\uc138\uc694."]);return}this.reloadList(e)},searchTypeChange:function(e){var t=$(e.currentTarget).val(),n=this.$el;t=="user"||t=="dept"?(n.find("#keyword_section").show(),n.find("#hiredate_search").hide(),n.find("#status_types").hide()):t=="hiredate"?(n.find("#keyword_section").hide(),n.find("#hiredate_search").show(),n.find("#status_types").hide()):(n.find("#keyword_section").hide(),n.find("#hiredate_search").hide(),n.find("#status_types").show())},showCalendar:function(){this.$el.find("#calBtn").focus()},preDate:function(e){var t=$(e.currentTarget);this.changeDate(t.attr("data-date"))},nextDate:function(e){var t=$(e.currentTarget);this.changeDate(t.attr("data-date"))},renderList:function(){var e={year:this.$el.find("#searchDate").attr("data-date")},n=t.contextRoot+"api/ehr/welfare/company/list",r=this;this.list=$.goGrid({el:this.$el.find("#welfare_list"),method:"GET",destroy:!0,url:n,params:e,emptyMessage:"<p class='data_null'> <span class='ic_data_type ic_no_data'></span><span class='txt'>"+u["\ubcf5\uc9c0\ud3ec\uc778\ud2b8 \ub370\uc774\ud130 \uc5c6\uc74c"]+"</span>"+"</p>",defaultSorting:[[2,"asc"]],checkbox:!0,checkboxData:"id",columns:[{mData:null,sWidth:"100px",sClass:"loginId",bSortable:!1,fnRender:function(e){var t=e.aData;return"<span data-id='"+t.id+"'>"+t.loginId+"</span>"}},{mData:"userName",sWidth:"100px",sClass:"",bSortable:!0},{mData:"deptName",sWidth:"150px",sClass:"",bSortable:!1},{mData:"hireDate",sWidth:"80px",sClass:"",bSortable:!1},{mData:null,sWidth:"120px",sClass:"money",bSortable:!1,fnRender:function(e){return t.util.numberWithCommas(e.aData.totalPoint)}},{mData:null,sWidth:"120px",sClass:"money",bSortable:!1,fnRender:function(e){return t.util.numberWithCommas(e.aData.additionPoint)}},{mData:null,sWidth:"120px",sClass:"money",bSortable:!1,fnRender:function(e){return t.util.numberWithCommas(e.aData.usedPoint)}},{mData:null,sWidth:"120px",sClass:"money",bSortable:!1,fnRender:function(e){return t.util.numberWithCommas(e.aData.restPoint)}},{mData:"status",sWidth:"70px",sClass:"",bSortable:!1}],fnDrawCallback:function(e,t,n){$(window).scrollTop(0),$("div.tool_bar .custom_header").closest("div").addClass("calendar_tool_bar");var i=$($("div.tool_bar")[0]);i.prepend($("#excel_download_area").show()),i.append($("#all_change").show()),i.append($("#selected_change").show()),i.append($("#dateBtns").show()),r.list.tables.find("tbody .money").attr("style","text-align : right !important"),$("div.custom_bottom").css({height:"1px"}),r.$el.find("#welfare_list tbody td.loginId").css("cursor","pointer").click(function(e){var t=$(e.currentTarget),n=t.find("span").data("id");r.callUserWelfareUpdatePopup(n)})}})},callUserWelfareUpdatePopup:function(e){var t=this,n=$.goPopup({header:u["\uac1c\uc778 \ubcf5\uc9c0\ud3ec\uc778\ud2b8 \uc218\uc815"],width:400,title:"",modal:!0,contents:"<div id='manageWelfarePopup'></div>",buttons:[{btype:"confirm",btext:u["\ud655\uc778"],callback:function(){i.save(),i.on("save.success",function(){$.goMessage(o["\uc800\uc7a5\ub418\uc5c8\uc2b5\ub2c8\ub2e4."]),n.close(),t.list.tables.fnClearTable()})}},{btype:"normal",btext:u["\ucde8\uc18c"],callback:function(){n.close()}}]}),i=new r({el:"#manageWelfarePopup",welfareId:e});i.render()},initDatePicker:function(){var e=this.$el.find("#calBtn");$.datepicker.setDefaults($.datepicker.regional[t.config("locale")]),e.datepicker({dateFormat:"yy-mm-dd",changeMonth:!0,changeYear:!0,yearSuffix:"",onSelect:$.proxy(function(e){var n=t.util.toMoment(e).year();this.changeDate(n+"")},this)})},initSearchDatePicker:function(){var e=this.$el.find("#searchStartDate"),n=t.util.now().format("YYYY-MM-DD");e.val(n),$.datepicker.setDefaults($.datepicker.regional[t.config("locale")]),e.datepicker({dateFormat:"yy-mm-dd",changeMonth:!0,changeYear:!0,yearSuffix:"",onSelect:function(e){r.datepicker("option","minDate",e)}});var r=this.$el.find("#searchEndDate");r.val(n),r.datepicker({dateFormat:"yy-mm-dd",changeMonth:!0,changeYear:!0,yearSuffix:"",minDate:n})}});return a})})();