define("timeline/models/daily_stat",function(require){var e=require("backbone"),t=require("app"),n=require("i18n!timeline/nls/timeline"),r=require("timeline/models/history"),i=e.Model.extend({defaults:{},initialize:function(){this.user=this.get("user"),this.approvals=this.get("timelineApprovals"),this.historyModels=_.chain(this.get("timelineHistories")).map(function(e){return new r(e)}).value(),this.timelineGroup=this.get("timelineGroup"),this.detailDay=this.get("detailDay"),this.day=this.detailDay.day,this.timelineGroup&&(this.workingStartTime=this.timelineGroup.workingStartTime,this.workingEndTime=this.timelineGroup.workingEndTime,this.workingStartDate=Date.parse(this.day+" "+this.workingStartTime),this.workingEndDate=Date.parse(this.day+" "+this.workingEndTime),this.zeroPoint=Date.parse(this.day+" 00:00:00")),this.timelineViewModels=this.get("timelineViewModels")},isWorkingTime:function(e){if(!this.timelineGroup)return!0;var t=this.zeroPoint+e*60*60*1e3;return t<=this.workingEndDate&&t>=this.workingStartDate},getClockInTime:function(){var e=this.get("clockInTime");return e?e:""},getClockInGpsLink:function(){return this.get("clockInHistory").gpsLink},getClockOutGpsLink:function(){return this.get("clockOutHistory").gpsLink},getClockOutTime:function(){var e=this.get("clockOutTime");if(!e)return"";var t=this.get("clockOutHistory").checkTime;return moment(t).format("YYYY-MM-DD")!=this.get("detailDay").day&&(e+=" (+1)"),e},getPositioinName:function(){return this.user.name+" "+this.user.position},getTotalWorkingTime:function(){return this.get("workingTime").totalStr},convertMilliToHour:function(e){return(e/60/60/1e3).toFixed(1)},getNormalWorkingTime:function(){return this.get("workingTime").normalStr},getExtensionWorkingTime:function(){return this.get("workingTime").extensionStr},getNightWorkingTime:function(){return this.get("workingTime").nightStr},getApprovals:function(){var e=[];for(var t=0,r;r=this.approvals[t];t++){if(!r.name)continue;var i=r.timeType,s=n[r.approvalStatus],o;if(i)o=r.hours+"h";else{var u=r.simpleStartTime,a=r.simpleEndTime;o=u+" ~ "+a}var f=s+" ("+r.name+" "+o+")";e[e.length]={name:r.name,agree:r.agree,startTime:u,endTime:a,message:f}}return e},getTimelineHistories:function(){return this.get("timelineHistories")},getDayOfWeek:function(){return this.get("detailDay").timelineDayOfWeek},hasTotalWorkingTime:function(){return this.get("total")!=0?!0:!1},getWorkingTimeDetail:function(){return this.get("workingTime").workingDetailStr},isEditedWorkInTime:function(){return this.isEditedStatus("defaultClockIn")},isEditedWorkOutTime:function(){return this.isEditedStatus("defaultClockOut")},isEditedStatus:function(e){return _.chain(this.get("timelineHistories")).filter(function(t){return t["timelineStatus"]["timelineCode"]==e}).map(function(e){return e.editedCheckTime}).value()[0]},isToday:function(){return this.get("detailDay").today},findHistoriesByHour:function(e,t){return _.chain(this.historyModels).filter(function(n){return e.getTime()<=n.checkTime24()&&n.checkTime24()<t.getTime()}).value()},getTimelineHistoriesSortByCheckTime:function(){return _.sortBy(this.get("timelineHistories"),"checkTime")}});return i});