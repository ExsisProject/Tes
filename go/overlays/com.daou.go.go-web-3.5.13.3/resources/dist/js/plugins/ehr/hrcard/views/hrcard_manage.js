define(["jquery","backbone","app","file_upload","hrcard/models/hrcard_manage","hgn!hrcard/templates/hrcard_manage","i18n!hrcard/nls/hrcard","i18n!nls/commons","jquery.go-preloader"],function(e,t,n,r,i,s,o,u){var a={personnel_manag_info:o["\uc778\uc0ac\uc815\ubcf4 \uad00\ub9ac"],myself_modify:o["\ubcf8\uc778 \uc778\uc0ac\uc815\ubcf4 \uc218\uc815"],myself_modify_tool_tip:o["\ubcf8\uc778\uc778\uc0ac\uc815\ubcf4\uc218\uc815\uc548\ub0b4"],permit:o["\ud5c8\uc6a9"],no_permit:o["\ud5c8\uc6a9\ud558\uc9c0 \uc54a\uc74c"],headofthedepartment_public:o["\ubd80\uc11c\uc7a5 \uc778\uc0ac\uc815\ubcf4 \uacf5\uac1c"],headofthedepartment_public_tool_tip:o["\ubd80\uc11c\uc7a5\uc778\uc0ac\uc815\ubcf4\uacf5\uac1c\uc548\ub0b4"],personnel_info_all_enroll:o["\uc778\uc0ac\uc815\ubcf4 \uc77c\uad04 \ub4f1\ub85d"],sample_download:o["\uc0d8\ud50c \uc591\uc2dd \ub2e4\uc6b4\ub85c\ub4dc"],sample_download_guide:o["\uc0d8\ud50c \uc591\uc2dd \ub2e4\uc6b4\ub85c\ub4dc \uac00\uc774\ub4dc"],download:o["\ud604\uc7ac \uc124\uc815 \ub2e4\uc6b4\ub85c\ub4dc"],download_guide:o["\ud604\uc7ac \uc124\uc815 \ub2e4\uc6b4\ub85c\ub4dc \uac00\uc774\ub4dc"],file_search:o["\ud30c\uc77c \ucc3e\uae30"],file_attach:o["\ud30c\uc77c \ucca8\ubd80"],all_enroll:o["\uc77c\uad04 \ub4f1\ub85d"],personnel_info_file_enroll:o["\uc778\uc0ac\uc815\ubcf4 \ud30c\uc77c \ub4f1\ub85d"],all_enroll_desc:o["\uc77c\uad04\ub4f1\ub85d\uc8fc\uc758\uc0ac\ud56d"],personnel_info_manage:o["\uc778\uc0ac\uc815\ubcf4 \ud56d\ubaa9 \uad00\ub9ac"],personnel_info_manage_tool_tip:o["\uc778\uc0ac\uc815\ubcf4\ud56d\ubaa9\uad00\ub9ac\uc548\ub0b4"],basic_info:o["\uae30\ubcf8 \uc815\ubcf4"],entrance_date:o["\uc785\uc0ac\uc77c"],duty:o["\uc9c1\ubb34"],occupation:o["\uc9c1\uc885"],occupational_group:o["\uc9c1\uad70"],recruitment_division:o["\ucc44\uc6a9\uad6c\ubd84"],employee_division:o["\uc9c1\uc6d0\uad6c\ubd84"],salary_division:o["\uae09\uc5ec\uad6c\ubd84"],recommender:o["\ucd94\ucc9c\uc790"],state:o["\uc0c1\ud0dc"],birth:o["\uc0dd\ub144\uc6d4\uc77c"],gender:o["\uc131\ubcc4"],marital_status:o["\uacb0\ud63c\uc5ec\ubd80"],disability_status:o["\uc7a5\uc560\uc5ec\ubd80"],the_veterans:o["\ubcf4\ud6c8\uc5ec\ubd80"],resignation_date:o["\ud1f4\uc0ac\uc77c"],resignation_reason:o["\ud1f4\uc0ac\uc0ac\uc720"],personal_info:o["\uc2e0\uc0c1 \uc815\ubcf4"],hobby:o["\ucde8\ubbf8"],speciality:o["\ud2b9\uae30"],fax:o["\ud329\uc2a4"],job_route:o["\ucde8\uc5c5\ubc29\ubc95"],address:o["\uc8fc\uc18c"],home_number:o["\uc790\ud0dd\ubc88\ud638"],the_veterans_number:o["\ubcf4\ud6c8\ubc88\ud638"],the_veterans_family:o["\ubcf4\ud6c8\uac00\uc871"],the_veterans_division:o["\ubcf4\ud6c8\uad6c\ubd84"],disability_number:o["\uc7a5\uc560\ub4f1\ub85d\ubc88\ud638"],disability_division:o["\uc7a5\uc560\uad6c\ubd84"],disability_rating:o["\uc7a5\uc560\ub4f1\uae09"],disability_permit_division:o["\uc7a5\uc560\uc778\uc815\uad6c\ubd84"],account_type:o["\uacc4\uc88c\uc720\ud615"],bank:o["\uc740\ud589"],depositor:o["\uc608\uae08\uc8fc"],note:o["\ube44\uace0"],account_number:o["\uacc4\uc88c\ubc88\ud638"],start_date:o["\uc2dc\uc791\uc77c\uc790"],end_date:o["\uc885\ub8cc\uc77c\uc790"],duty_info:o["\uc9c1\ubb34 \uc815\ubcf4"],start_date2:o["\uc2dc\uc791\uc77c"],end_date2:o["\uc885\ub8cc\uc77c"],importance:o["\ube44\uc911"],assignment_task:o["\ub2f4\ub2f9\uc5c5\ubb34"],appointment_info:o["\ubc1c\ub839 \uc815\ubcf4"],appointment_date:o["\ubc1c\ub839\uc77c"],division:o["\uad6c\ubd84"],appointment_name:o["\ubc1c\ub839\uba85"],belong:o["\uc18c\uc18d"],salary_level:o["\uae09\uc5ec\ub2e8\uacc4"],job_title:o["\uc9c1\ucc45"],career_info:o["\uacbd\ub825 \uc815\ubcf4"],working_place:o["\uadfc\ubb34\ucc98"],position:o["\uc9c1\uc704"],long_service_period:o["\uadfc\uc18d\uae30\uac04"],retirement_reason:o["\ud1f4\uc9c1\uc0ac\uc720"],prize_disciplinary_info:o["\ud3ec\uc0c1/\uc9d5\uacc4 \uc815\ubcf4"],date:o["\uc77c\uc790"],contents:o["\ub0b4\uc6a9"],reason:o["\uc0ac\uc720"],etc:o["\uae30\ud0c0"],personnel_evaluation_info:o["\uc778\uc0ac\ud3c9\uac00 \uc815\ubcf4"],evaluation_year:o["\ud3c9\uac00\ub144\ub3c4"],capability:o["\uc5ed\ub7c9"],result:o["\uc131\uacfc"],evaluator:o["\ud3c9\uac00\uc790"],organization:o["\uc870\uc9c1"],educational_institution:o["\uad50\uc721\uae30\uad00"],educational_info:o["\uad50\uc721 \uc815\ubcf4"],curriculum:o["\uad50\uc721\uacfc\uc815"],educational_type:o["\uad50\uc721\uc720\ud615"],qualification_info:o["\uc790\uaca9 \uc815\ubcf4"],qualification_name:o["\uc790\uaca9\uba85"],qualification_number:o["\uc790\uaca9\ubc88\ud638"],qualification_rating:o["\uc790\uaca9\ub4f1\uae09"],institution_name:o["\uae30\uad00\uba85"],date_of_acquisition:o["\ucde8\ub4dd\uc77c"],date_of_halt:o["\uc815\uc9c0\uc77c"],language_info:o["\uc5b4\ud559 \uc815\ubcf4"],language_name:o["\uc5b4\ud559\uba85"],evaluation_date:o["\ud3c9\uac00\uc77c"],evaluation_institution:o["\ud3c9\uac00\uae30\uad00"],score:o["\uc810\uc218"],grade:o["\ub4f1\uae09"],military_info:o["\ubcd1\uc5ed \uc815\ubcf4"],military_clique:o["\uad70\ubc8c"],rank:o["\uacc4\uae09"],military_serial_number:o["\uad70\ubc88"],discharge_division:o["\uc804\uc5ed\uad6c\ubd84"],enlist_date:o["\uc785\ub300\uc77c"],discharge_date:o["\uc81c\ub300\uc77c"],etc_reason:o["\uae30\ud0c0 \uc0ac\uc720"],overseas_business_trip_info:o["\ud574\uc678\ucd9c\uc7a5 \uc815\ubcf4"],period_start:o["\uae30\uac04(\uc2dc\uc791)"],period_end:o["\uae30\uac04(\uc885\ub8cc)"],business_trip_country:o["\ucd9c\uc7a5\uad6d\uac00"],business_trip_place:o["\ucd9c\uc7a5\uc9c0"],business_trip_purpose:o["\ucd9c\uc7a5\ubaa9\uc801"],level_of_education_info:o["\ud559\ub825 \uc815\ubcf4"],school_name:o["\ud559\uad50\uba85"],admission_year:o["\uc785\ud559\ub144\ub3c4"],graduation_year:o["\uc878\uc5c5\ub144\ub3c4"],major:o["\uc804\uacf5"],minor:o["\ubd80\uc804\uacf5"],family_info:o["\uac00\uc871 \uc815\ubcf4"],family_name:o["\uac00\uc871\uc131\uba85"],family_relations:o["\uac00\uc871\uad00\uacc4"],academic_ability:o["\ud559\ub825"],job:o["\uc9c1\uc5c5"],register:u["\ub4f1\ub85d"],ok:u["\uc800\uc7a5"],cancel:u["\ucde8\uc18c"]},f=t.View.extend({events:{"click th.item_title input:checkbox":"checkbox","click #upload_ok":"excelupload","click #btn_delete":"exceldelete","click #downExcelSample":"downExcelHeader","click #downExcel":"downExcelByCompany","click table.tb_ehr_item span.btn_wrap .ic_classic":"tableToggle"},initialize:function(e){this.unbindEvent(),this.bindEvent()},unbindEvent:function(){this.$el.off("click","span#btn_ok"),this.$el.off("click","span#btn_cancel")},bindEvent:function(){this.$el.on("click","span#btn_ok",e.proxy(this.hrcardManageSave,this)),this.$el.on("click","span#btn_cancel",e.proxy(this.hrcardManageCancel,this))},tableToggle:function(t){var n=e(t.currentTarget),r=n.closest("table").find("tr:not(:first)");n.hasClass("ic_open")?(n.removeClass("ic_open").addClass("ic_close"),r.hide()):(n.removeClass("ic_close").addClass("ic_open"),r.show())},getCheckConfigModel:function(){var n=this,r=t.Model.extend({url:GO.contextRoot+"api/ehr/hrcard/config/manage"});this.checkConfigModel=new r,this.checkConfigModel.fetch({success:function(t,r){n.$el.html(s({lang:a,publicFlag_myself:n.model.get("hrCardMyselfModify"),publicFlag_headofthedepartment:n.model.get("hrCardHeadPublic")})),n.initFileUpload(),e.each(r.data,function(t,n){e.each(n,function(n,r){e("table#"+t).find("[data-name="+n+"]").attr("checked",r)})}),e("table.tb_ehr_item").each(function(t,n){var r=e(n).find("th input");r.attr("checked",!1),e(n).find("td input").is(":checked")&&r.attr("checked",!0)})}})},render:function(){var e=this;return this.model=new i,this.model.fetch({success:function(t,n){e.getCheckConfigModel()},statusCode:{403:function(){GO.util.error("403")},404:function(){GO.util.error("404",{msgCode:"400-common"})},500:function(){GO.util.error("500")}}}),this},checkbox:function(t){$targetEl=e(t.currentTarget),e(t.currentTarget).is(":checked")?(e(t.currentTarget).closest("table").find("td input").attr("disabled",!1),e(t.currentTarget).closest("table").find("td").find("input").attr("checked",!0)):(e(t.currentTarget).closest("table").find("td").find("input").attr("disabled",!0),e(t.currentTarget).closest("table").find("td").find("input").attr("checked",!1))},hrcardManageSave:function(n){$targetEl=e(n.currentTarget);var r=this.model,i=new t.Collection,s=new Array;_.each(e("table.form_hr table"),function(n,r){var s=new Array;s.tableName=e(n).attr("id"),_.each(e(n).find("td"),function(t,n){e(t).find("input").attr("data-name")!==undefined&&(s[e(t).find("input").attr("data-name")]=e(t).find("input").is(":checked"))});var o=new t.Model,u={};u[e(n).attr("id")]=s,o.set(s),i.add(o)});var o={};o.configMap=i;var a={hrCardMyselfModify:e("input[name=publicFlag_myself]:checked").val(),hrCardHeadPublic:e("input[name=publicFlag_headofthedepartment]:checked").val()};this.model.set(o),this.model.save(a,{success:function(t,n){n.code=="200"&&(e.goMessage(u["\uc800\uc7a5\ub418\uc5c8\uc2b5\ub2c8\ub2e4."]),e("body").scrollTop(0))},error:function(t,n){n.message?e.goAlert(n.message):e.goMessage(u["\uc2e4\ud328\ud588\uc2b5\ub2c8\ub2e4."])}})},hrcardManageCancel:function(t){var n=this;e.goCaution(u["\ucde8\uc18c"],u["\ubcc0\uacbd\ud55c \ub0b4\uc6a9\uc744 \ucde8\uc18c\ud569\ub2c8\ub2e4."],function(){n.initialize(),n.render(),e.goMessage(u["\ucde8\uc18c\ub418\uc5c8\uc2b5\ub2c8\ub2e4."])},u["\ud655\uc778"])},initFileUpload:function(){var t="\ud30c\uc77c \ucc3e\uae30",n=this,i={el:"#swfupload-control",context_root:GO.contextRoot,button_text:"<span class='buttonText'>"+a.file_search+"</span>",button_width:"132px",progressBarUse:!0,url:"api/file?GOSSOcookie="+e.cookie("GOSSOcookie")};(new r(i)).queue(function(e,t){}).start(function(t,n){var r=new RegExp("(.xls|.xlsx)","gi"),i=n.type.toLowerCase();if(!r.test(i))return e.goAlert(GO.i18n(u["{{extension}} \ud30c\uc77c\ub9cc \ub4f1\ub85d \uac00\ub2a5\ud569\ub2c8\ub2e4."],{extension:"exel"})),e("#progressbar").hide(),!1}).progress(function(e,t){}).success(function(t,n,r){if(GO.util.fileUploadErrorCheck(n))return e.goAlert(GO.util.serverMessage(n)),!1;if(GO.util.isFileSizeZero(n))return e.goAlert(GO.util.serverMessage(n)),!1;var i=n.data,s=i.fileName,o=i.filePath,u=i.hostId,f=GO.util.getHumanizedFileSize(i.fileSize),l=i.fileExt,c=GO.util.getFileIconStyle({extention:i.fileExt});fileTmpl="<li id='item_file'><span class='item_file' style='vertical-align:bottom'><span class='ic_file "+c+"'></span>"+"<span class='name'>"+s+"</span>"+"<span class='size'>("+f+")</span>"+"<span class='btn_wrap' id='btn_delete' title='\uc0ad\uc81c' style='margin-right:20px'>"+"<span class='ic_classic ic_del'></span>"+"</span>"+"<a id='upload_ok' data-bypass='' class='btn_minor_s' data-role='button' style=''><span class='txt'>"+a.register+"</span></a>"+"</span>"+"<input type='hidden' value='"+o+"' id='file_path'/>"+"<input type='hidden' value='"+s+"' id='file_name'/>"+"<input type='hidden' value='"+u+"' id='host_id'/>"+"<input type='hidden' value='"+l+"' id='file_ext'/>"+"</li>",e("#fileComplete").html(fileTmpl)}).complete(function(e,t){console.info(t)}).error(function(e,t){console.info("error"+t)})},excelupload:function(){var t=this;if(jQuery("#item_file").length<1)return;var n=GO.contextRoot+"api/ehr/hrcard/excelUpload";options={fileName:e("#file_name").val(),filePath:e("#file_path").val(),hostId:e("#host_id").val(),fileExt:e("#file_ext").val()},GO.EventEmitter.trigger("common","layout:setOverlay","\ub85c\ub529\uc911"),e.go(n,JSON.stringify(options),{qryType:"POST",timeout:0,contentType:"application/json",responseFn:function(n){n.code=="200"?(GO.EventEmitter.trigger("common","layout:clearOverlay"),e.goAlert(u["\uc800\uc7a5\ub418\uc5c8\uc2b5\ub2c8\ub2e4."])):t.displayUploadErrMsg(n)},error:function(t){clearInterval(this.interval),e.goAlert(t.responseJSON.message)}})},displayUploadErrMsg:function(t){var n=this.$el.find(".tool_bar .custom_header #uploadMsg");e(n).text(t.extParameter)},exceldelete:function(){e("#fileComplete").html("")},downExcelHeader:function(){window.location.href=GO.contextRoot+"api/ehr/hrcard/excelDownload"},downExcelByCompany:function(t){var n=this,r=GO.contextRoot+"api/ehr/hrcard/excelDownload/"+GO.session().companyId;e("#download_file_form").attr("action",r);var i=(new Date).getTime();e("#downloadTokenId").val(i),preloader=e.goPreloader(),this.fileDownloadCheckTimer=window.setInterval(function(){var t=e.cookie("downloadTokenId");t==i&&n.finishDownload()},1e3),e("#download_file_form").attr("target","ifm_download_file_form"),e("#download_file_form").submit()},finishDownload:function(){window.clearInterval(this.fileDownloadCheckTimer),preloader.release()}});return f});