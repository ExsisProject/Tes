define(["backbone","attendance/models/record"],function(e,t){var n=e.Collection.extend({model:t,initialize:function(e){this.options=e||{},this.logMonth=this.options.month||0,this.userid=this.options.userid},url:function(){return GO.contextRoot+"api/ehr/attnd/user/"+this.userid+"/record/month/"+this.logMonth.format("YYYY-MM")},get:function(e){return this.models[e]},getByLogDate:function(e){return this.find(function(t){return t.get("logDate")==e})},getRecords:function(){var e=this.logMonth,r=moment(e.format("YYYY-MM-DD")).startOf("month"),i=moment(e.format("YYYY-MM-DD")).endOf("month"),s=this.getHolidays(r.format("YYYY"));while(r<i){var o=!1;for(var u in s){var a=new moment(s[u].startTime);a.format("MM-DD")==r.format("MM-DD")&&(o=!0)}var f=new t({logDate:r.format("YYYY-MM-DD"),holiday:o}),l=this.getByLogDate(f.get("logDate"));l||this.add(f),r.add(1,"days")}var c=this.sortBy(function(e){return e.get("logDate")});return new n(c)},getLateCount:function(){var e=0;return this.each(function(t){t.isLate()&&e++}),e},sortByAttr:function(e,t){},getHolidays:function(e){var t={};return $.ajax({type:"GET",async:!1,dataType:"json",url:GO.config("contextRoot")+"api/calendar/event/holiday/"+e,success:function(e){t=e.data}}),t}});return n});