define("timeline/views/mobile/company_stat/company_stats",function(require){var e=require("backbone"),t=require("timeline/models/auth"),n=require("timeline/models/company_stat"),r=require("views/mobile/header_toolbar"),i=require("timeline/views/mobile/company_stat/week/company_week_stat_item"),s=require("timeline/views/mobile/company_stat/month/company_month_stat_item"),o=require("timeline/views/mobile/company_stat/stat_filter"),u=require("hgn!timeline/templates/mobile/company_stat/company_stats"),a=require("hgn!timeline/templates/mobile/company_stat/stat_page"),f=require("hgn!timeline/templates/mobile/company_stat/stat_empty"),l=require("i18n!timeline/nls/timeline"),c=require("i18n!nls/commons"),h=e.View.extend({bindEvent:function(){var e=this;$("#todayBtn").click(function(t){e.moveToday(t)}),$("#prevDate").click(function(t){e.prevDate(t)}),$("#nextDate").click(function(t){e.nextDate(t)}),$("#viewType").change(function(t){e.changeViewType(t)}),$("#prevPage").click(function(t){e.goPage(t)}),$("#nextPage").click(function(t){e.goPage(t)})},unbindEvent:function(){$("#todayBtn").unbind("click"),$("#prevDate").unbind("click"),$("#nextDate").unbind("click"),$("#viewType").unbind("change"),$("#prevPage").unbind("click"),$("#nextPage").unbind("click")},initialize:function(e){this.param=e,this.companyStat=new n(e),this.authModel=new t(GO.util.store.get("timeline.auth")),this.isCreatable=this.authModel.isCreatable()},render:function(){return $(".content_page").html(u({TimelineLang:l,CommonLang:c,weekType:this.companyStat.isWeekType(),monthType:!this.companyStat.isWeekType(),dateInfo:moment().format("YYYY-MM"),isCompany:this.param.range=="COMPANY",isDept:this.param.range=="DEPARTMENT"})),this.fetchAndRenderContent(),this},fetchAndRenderContent:function(){this.unbindEvent(),this.$el.empty(),this.renderTitleToolbar(),GO.EventEmitter.trigger("common","layout:setOverlay",""),this.companyStat.fetch({async:!0}).done(_.bind(function(){$(".date").html(this.companyStat.getDateInfo()),this.companyStat.initData(),this.renderData(),this.renderFilter(),this.renderPageSize(),$(window).scrollTop(0),this.bindEvent(),GO.EventEmitter.trigger("common","layout:clearOverlay",!0)},this))},renderPageSize:function(){this.refinePageInfo(),$(".paging").html(a({CommonLang:c,hasData:this.companyStat.hasData(),page:this.pageInfo}))},renderData:function(){$("#timeline_stat_content").empty(),this.companyStat.isWeekType()?this.renderWeekContent():this.renderMonthContent()},renderFilter:function(){this.filterView=new o({range:this.companyStat.range,options:this.filterObj}),this.$el.find("#filter_parent").append(this.filterView.$el),this.filterView.render(),this.filterView.bind("statFiltering",this.searchFilter,this)},renderWeekContent:function(){if(_.isEmpty(this.companyStat.weeks.models)){$("#timeline_stat_content").append(f({empty:c["\ub370\uc774\ud130\uac00 \uc5c6\uc2b5\ub2c8\ub2e4."]}));return}for(var e=0,t;t=this.companyStat.weeks.models[e];e++){var n=new i(t);$("#timeline_stat_content").append(n.$el),n.render()}},renderMonthContent:function(){if(_.isEmpty(this.companyStat.months.models)){$("#timeline_stat_content").append(f({empty:c["\ub370\uc774\ud130\uac00 \uc5c6\uc2b5\ub2c8\ub2e4."]}));return}for(var e=0,t;t=this.companyStat.months.models[e];e++){var n=new s(t);$("#timeline_stat_content").append(n.$el),n.render()}},moveToday:function(e){this.companyStat.moveToday(),this.fetchAndRenderContent()},prevDate:function(e){this.companyStat.prevDate(),this.fetchAndRenderContent()},nextDate:function(e){this.companyStat.nextDate(),this.fetchAndRenderContent()},changeViewType:function(e){var t=$(e.currentTarget).val();this.companyStat.updateType(t),this.fetchAndRenderContent()},goPage:function(e){var t=$(e.currentTarget),n=t.attr("data-value");this.companyStat.page=this.pageInfo.pageNo+parseInt(n),this.fetchAndRenderContent()},searchFilter:function(e){this.filterObj=e,this.companyStat.filterQuery=e.query,this.companyStat.page=0,this.fetchAndRenderContent()},refinePageInfo:function(){this.pageInfo=this.companyStat.isWeekType()?this.companyStat.weeks.pageInfo():this.companyStat.months.pageInfo(),this.pageInfo.isLastPage=this.pageInfo.pageNo==this.pageInfo.lastPageNo,this.pageInfo.firstIndex=this.pageInfo.pageNo*this.pageInfo.pageSize+1,this.pageInfo.lastIndex=this.pageInfo.isLastPage?this.pageInfo.total:(this.pageInfo.pageNo+1)*this.pageInfo.pageSize},renderTitleToolbar:function(){var e=this,t=e.options.range=="COMPANY"?l["\uc804\uc0ac \uadfc\ud0dc\ud604\ud669"]:l["\ubd80\uc11c \uadfc\ud0dc\ud604\ud669"],n={title:t,isList:!0,isSideMenu:!0,isHome:!0};this.headerToolbarView=r,this.headerToolbarView.render(n)}});return h});