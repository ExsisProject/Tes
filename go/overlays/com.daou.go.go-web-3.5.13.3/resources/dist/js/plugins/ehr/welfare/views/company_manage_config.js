(function(){define(["backbone","app","hgn!welfare/templates/company_manage_config","i18n!welfare/nls/welfare","i18n!nls/commons","file_upload"],function(e,t,n,r,i,s){var o={"\ubcf5\uc9c0\ud3ec\uc778\ud2b8 \uc124\uc815":r["\ubcf5\uc9c0\ud3ec\uc778\ud2b8 \uc124\uc815"],"\uc591\uc2dd \ub2e4\uc6b4\ub85c\ub4dc":r["\uc591\uc2dd \ub2e4\uc6b4\ub85c\ub4dc"],"\ubcf5\uc9c0\ud3ec\uc778\ud2b8 \ud30c\uc77c \ub4f1\ub85d":r["\ubcf5\uc9c0\ud3ec\uc778\ud2b8 \ud30c\uc77c \ub4f1\ub85d"]},u=e.View.extend({events:{"click #upload_ok":"excel_regist","click #btn_ok":"save","click #btn_cancel":"cancel","click #sample_download":"sample_download"},initialize:function(){},render:function(){return this.$el.html(n({lang:o})),setTimeout(this.initFileUpload,200),this},sample_download:function(){var e=t.contextRoot+"api/ehr/welfare/company/upload/sample";window.location.href=e},excel_regist:function(){var e=this;if(jQuery("ul.file_wrap li").length<1)return;var n=jQuery("ul.file_wrap li");if(n.length<1)return;var r=t.contextRoot+"api/ehr/welfare/excelUpload",s={fileName:n.attr("data-name"),filePath:n.attr("data-path"),fileExt:n.attr("data-ext"),hostId:n.attr("host-id")};t.EventEmitter.trigger("common","layout:setOverlay","\ub85c\ub529\uc911"),$.go(r,JSON.stringify(s),{qryType:"POST",timeout:0,contentType:"application/json",responseFn:function(n){n.code=="200"?(t.EventEmitter.trigger("common","layout:clearOverlay"),$.goAlert(i["\uc800\uc7a5\ub418\uc5c8\uc2b5\ub2c8\ub2e4."]),$("#fileComplete").empty()):e.displayUploadErrMsg(n)},error:function(e){clearInterval(this.interval),$.goAlert(e.responseJSON.message)}})},initFileUpload:function(){var e=this,n={el:"#file_upload",context_root:t.contextRoot,button_text:"<span class='buttonText'>"+o["\ubcf5\uc9c0\ud3ec\uc778\ud2b8 \ud30c\uc77c \ub4f1\ub85d"]+"</span>",button_width:"132px",progressBarUse:!0,url:"api/file?GOSSOcookie="+$.cookie("GOSSOcookie")};(new s(n)).queue(function(e,t){}).start(function(e,t){var n=new RegExp("(.xls|.xlsx)","gi"),r=t.type.toLowerCase();if(!n.test(r))return $.goAlert("Excel \ud30c\uc77c\ub9cc \ub4f1\ub85d \uac00\ub2a5\ud569\ub2c8\ub2e4."),$("#progressbar").hide(),!1}).progress(function(e,t){}).success(function(e,t,n){var r=$("#fileComplete"),i=$("<a id='upload_ok' data-bypass='' class='btn_minor_s' data-role='button' style=''><span class='txt'>\ub4f1\ub85d</span></a>");n.attr("data-ext",t.data.fileExt),n.find("span.ic_del").on("click",function(e){var t=$(e.currentTarget);t.closest("li").remove()}),n.find(".item_file").append(i),r.html(n)}).complete(function(e,t){console.info(t)}).error(function(e,t){console.info("error"+t)})}});return u})})();