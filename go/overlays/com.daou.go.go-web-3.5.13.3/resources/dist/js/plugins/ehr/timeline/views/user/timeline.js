define("timeline/views/user/timeline",function(require){var e=require("backbone"),t=require("hgn!timeline/templates/user/timeline"),n=require("timeline/views/user/timeline_item"),r=require("timeline/views/user/time_cell"),i=require("timeline/views/user/time_clock_progress"),s=require("timeline/views/user/time_approval_progress"),o=require("timeline/models/daily_stat"),u=require("timeline/collections/timeline_histories"),a=e.View.extend({className:"tb_attend_detail2",splitMinute:60,initialize:function(){this.model=new o(this.options.data),this.targetUserId=this.options.targetUserId,this.timelineHistories=new u(this.model.historyModels)},render:function(){this.$el.html(t({})),this.rowCount=0,this.renderHeader(),this.timezoneRender(this.$el.find("#time_wrapper")),this.clockInOutViewRender(),this.approvalViewRender(),this.renderHistory();var e=72+this.rowCount*32;this.$el.find("#time_wrapper").height(e+"px")},renderHistory:function(){var e=this,t=e.$el.find("#data_zone");_.forEach(this.timelineHistories.models,function(n){if(n.isRenderProgressBar())return;e.rowCount++,t.append('<div id="{id}" class="tb_row workingstate">'.replace("{id}","working_state_"+n.getId())),e.timezoneRender(e.$el.find("#working_state_"+n.getId()),n)})},timezoneRender:function(e,t){var n=new Date(864e5),i=this.splitMinute*1e3*60,s=n.getTime()/i;_.range(0,s).map(_.bind(function(n){var s=new Date(n*i),o=new Date((n+1)*i),u=GO.util.convertWithDataTimeZone(s),a=new r({targetUserId:this.targetUserId,dayInfo:this.options.data.detailDay,group:this.model.get("timelineGroup"),splitMin:this.splitMinute,hour:u.format("HH"),min:s.getMinutes(),history:t});e.append(a.$el),a.render()},this))},renderHeader:function(){var e=this;_.range(0,24).map(function(t){var n=e.model.isWorkingTime(t),r='<div class="tb_cell workinghours"> <span class="time">{hour}</span> </div>'.replace("{hour}",t<10?"0"+t:t);n||(r=r.replace(" workinghours","")),e.$el.find("#time_zone").append(r)})},approvalViewRender:function(){var e=this,t=this.model.approvals;if(!t||t.length<1)return;_.forEach(t,function(t){if(t.endPoint>100){var n=t.endPoint;t.endPoint=100;var r=new s(t);e.$el.find("#approval_progress").append(r.$el),r.render(),t.endPoint=n-100,t.startPoint=0;var r=new s(t);e.$el.find("#approval_progress").append(r.$el),r.render()}else{var r=new s(t);e.$el.find("#approval_progress").append(r.$el),r.render()}})},clockInOutViewRender:function(){var e=this,t=this.model.timelineViewModels;if(!t||t.length<1)return;_.forEach(t,function(t){var n=new i(e.options,t);e.$el.find("#clockinout_progress").append(n.$el),n.render()})}});return a});