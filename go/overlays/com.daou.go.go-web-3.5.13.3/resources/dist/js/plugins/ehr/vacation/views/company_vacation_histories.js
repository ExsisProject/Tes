define("vacation/views/company_vacation_histories",function(require){var e=require("backbone"),t=require("app"),n=require("views/profile_card"),r=require("hgn!vacation/templates/company_vacation_histories"),i=require("i18n!vacation/nls/vacation"),s=require("i18n!nls/commons"),o=require("vacation/views/title"),u=require("i18n!admin/nls/admin"),a=require("vacation/views/company_manage_vacation_popup"),f=require("vacation/views/company_manage_uploader");require("GO.util"),require("jquery.go-popup"),require("jquery.go-grid"),require("jquery.go-preloader");var l={"\uc804\uc0ac \uc5f0\ucc28\ud604\ud669":i["\uc804\uc0ac \uc5f0\ucc28\ud604\ud669"],"\uc774\ub984":s["\uc774\ub984"],"\ubd80\uc11c\uba85":s["\ubd80\uc11c\uba85"],"\uc785\uc0ac\uc77c":i["\uc785\uc0ac\uc77c"],"\ud1f4\uc0ac\uc77c":i["\ud1f4\uc0ac\uc77c"],"\uadfc\uc18d\uc5f0\uc218":i["\uadfc\uc18d\uc5f0\uc218"],"\ubc1c\uc0dd \uc5f0\ucc28":i["\ubc1c\uc0dd \uc5f0\ucc28"],"1\ub144 \ubbf8\ub9cc \ubc1c\uc0dd \uc6d4\ucc28":i["1\ub144 \ubbf8\ub9cc \ubc1c\uc0dd \uc6d4\ucc28"],"1\ub144 \ubbf8\ub9cc \uc774\uc6d4 \uc6d4\ucc28":i["1\ub144 \ubbf8\ub9cc \uc774\uc6d4 \uc6d4\ucc28"],"\uc870\uc815 \uc5f0\ucc28":i["\uc870\uc815 \uc5f0\ucc28"],"\ucd1d\uc5f0\ucc28":i["\ucd1d\uc5f0\ucc28"],"\uc0ac\uc6a9 \uc5f0\ucc28":i["\uc0ac\uc6a9 \uc5f0\ucc28"],"\uc794\uc5ec \uc5f0\ucc28":i["\uc794\uc5ec \uc5f0\ucc28"],"\uc0c1\ud0dc":s["\uc0c1\ud0dc"],"\ubaa9\ub85d \ub2e4\uc6b4\ub85c\ub4dc":s["\ubaa9\ub85d \ub2e4\uc6b4\ub85c\ub4dc"],"\uc5f0\ucc28 \ucd08\uae30 \uc124\uc815":i["\uc5f0\ucc28 \ucd08\uae30 \uc124\uc815"],"\uc5f0\ucc28 \uc870\uc815":i["\uc5f0\ucc28 \uc870\uc815"],"\uc5f0\ucc28 \uc77c\uad04 \uc870\uc815":i["\uc5f0\ucc28 \uc77c\uad04 \uc870\uc815"],"\uac80\uc0c9":s["\uac80\uc0c9"],"\ucd08\uae30\ud654":u["\ucd08\uae30\ud654"],"\uac80\uc0c9 \uc870\uac74":s["\uac80\uc0c9 \uc870\uac74"],"\uae30\uc900\uc77c":i["\uae30\uc900\uc77c"],"\uc0c1\ud0dc":s["\uc0c1\ud0dc"],"\uc804\uccb4":s["\uc804\uccb4"],"\uc815\uc0c1":s["\uc815\uc0c1"],"\uba54\uc77c\ud734\uba74":i["\uba54\uc77c\ud734\uba74"],"\uc911\uc9c0":s["\uc911\uc9c0"],"\uae30\uac04":s["\uae30\uac04"],"\ubd84\ub958":i["\ubd84\ub958"],"\ubaa9\ub85d\uc5c6\uc74c":u["\ubaa9\ub85d\uc5c6\uc74c"],"\uc120\ud0dd\ub41c \uc5f0\ucc28\uac00 \uc5c6\uc2b5\ub2c8\ub2e4.":i["\uc120\ud0dd\ub41c \uc5f0\ucc28\uac00 \uc5c6\uc2b5\ub2c8\ub2e4."],"\ud655\uc778":s["\ud655\uc778"],"\ucde8\uc18c":s["\ucde8\uc18c"],"\uc120\ud0dd\ub41c \uc0ac\uc6a9\uc790\uac00 \uc5c6\uc2b5\ub2c8\ub2e4.":i["\uc120\ud0dd\ub41c \uc0ac\uc6a9\uc790\uac00 \uc5c6\uc2b5\ub2c8\ub2e4."],"\uc5f0\ucc28 \ud604\ud669\uc744 \uc704\ud55c \uafc0\ud301 \uac00\uc774\ub4dc":i["\uc5f0\ucc28 \ud604\ud669\uc744 \uc704\ud55c \uafc0\ud301 \uac00\uc774\ub4dc"],"\uc5f0\ucc28 \ud604\ud669\uc744 \uc704\ud55c \uafc0\ud301 \uac00\uc774\ub4dc \uc124\uba85 1":i["\uc5f0\ucc28 \ud604\ud669\uc744 \uc704\ud55c \uafc0\ud301 \uac00\uc774\ub4dc \uc124\uba85 1"],"\uc5f0\ucc28 \ud604\ud669\uc744 \uc704\ud55c \uafc0\ud301 \uac00\uc774\ub4dc \uc124\uba85 2":i["\uc5f0\ucc28 \ud604\ud669\uc744 \uc704\ud55c \uafc0\ud301 \uac00\uc774\ub4dc \uc124\uba85 2"],"\uc5f0\ucc28 \ud604\ud669\uc744 \uc704\ud55c \uafc0\ud301 \uac00\uc774\ub4dc \uc124\uba85 3":i["\uc5f0\ucc28 \ud604\ud669\uc744 \uc704\ud55c \uafc0\ud301 \uac00\uc774\ub4dc \uc124\uba85 3"],"\uc5f0\ucc28 \ud604\ud669\uc744 \uc704\ud55c \uafc0\ud301 \uac00\uc774\ub4dc \uc124\uba85 4":i["\uc5f0\ucc28 \ud604\ud669\uc744 \uc704\ud55c \uafc0\ud301 \uac00\uc774\ub4dc \uc124\uba85 4"],"\uc5f0\ucc28 \ud604\ud669\uc744 \uc704\ud55c \uafc0\ud301 \uac00\uc774\ub4dc \uc124\uba85 5":i["\uc5f0\ucc28 \ud604\ud669\uc744 \uc704\ud55c \uafc0\ud301 \uac00\uc774\ub4dc \uc124\uba85 5"],"\ubc1c\uc0dd \uc6d4\ucc28":i["\ubc1c\uc0dd \uc6d4\ucc28"],"\uc774\uc6d4 \uc6d4\ucc28":i["\uc774\uc6d4 \uc6d4\ucc28"],"\uc870\uac74\ubcc4 \uc0c1\uc138\uac80\uc0c9":i["\uc870\uac74\ubcc4 \uc0c1\uc138\uac80\uc0c9"],"\uc5f0\ucc28 \ud604\ud669 \uafc0\ud301 \uac00\uc774\ub4dc":i["\uc5f0\ucc28 \ud604\ud669 \uafc0\ud301 \uac00\uc774\ub4dc"]},c=e.View.extend({events:{"click [data-profile]":"showProfile","click #baseDate":"showBaseCalendar","click #startHireDateCal":"showStartCalendar","click #endHireDateCal":"showEndCalendar","click #searchBtn":"search","click #resetSearchBtn":"resetSearch","click #vacationManage .showSelectedManagePopup":"showSelectedManagePopup","click #vacationManage .showAllManagePopup":"showAllManagePopup","click #downloadList":"downloadList","click #showUploadPopup":"showUploadPopup","click #vacation_description_icon":"showDescription",click:"hideDescription","click #preDate":"preDate","click #nextDate":"nextDate","click #mangeSubMenu":"showManageSubMenu","keyup #userName, #deptName":"enterSearch"},getDisplayBaseDate:function(){return moment(this.baseDate).format("YYYY.MM.DD")},showManageSubMenu:function(e){e.stopPropagation(),this.$el.find("#submenu").show()},preDate:function(){this.changeDate(-1)},nextDate:function(){this.changeDate(1)},changeDate:function(e){var t=this.$el.find("#baseDate"),n=t.text();this.baseDate=moment(n,"YYYY-MM-DD").add("days",e).format("YYYY-MM-DD"),t.text(this.getDisplayBaseDate()),t.data("basedate",this.baseDate),this.search()},hideDescription:function(){this.$el.find("#vacation_description").hide(),this.$el.find("#submenu").hide()},showDescription:function(e){e.stopPropagation(),this.$el.find("#vacation_description").toggle()},downloadList:function(){var e=this,n=this.getParam();n.direction=this.list.listParams.direction,n.property=this.list.listParams.property;var r=(new Date).getTime();n.downloadTokenId=r;var i=t.contextRoot+"api/ehr/vacation/stat/company/list/download",s=location.protocol+"//"+location.hostname+(location.port?":"+location.port:"")+i;return $("#download_vacation_form").attr("action",s),_.each(n,function(e,t){$("#download_vacation_form").append('<input type="hidden" name="'+t+'" value="'+e+'">')}),this.preloader=$.goPreloader(),this.fileDownloadCheckTimer=window.setInterval(function(){var t=$.cookie("downloadTokenId");t==r&&e.finishDownload()},1e3),$("#download_vacation_form").submit(),!1},finishDownload:function(){window.clearInterval(this.fileDownloadCheckTimer),$("#download_vacation_form").empty(),this.preloader.release()},showUploadPopup:function(){var e=new f(this.accountUseEhr),t=this,n=$.goPopup({header:l["\uc5f0\ucc28 \ucd08\uae30 \uc124\uc815"],width:500,title:"",modal:!0,pclass:"layer_normal layer_annualvacation_set",contents:e.$el,buttons:[{btype:"confirm",btext:l["\ud655\uc778"],callback:function(){e.submit(),n.close(),t.list.tables.fnClearTable()}}]});e.render(),n.reoffset()},showAllManagePopup:function(){var e=new a("ALL"),t=this,n=$.goPopup({header:l["\uc5f0\ucc28 \uc77c\uad04 \uc870\uc815"],width:500,title:"",modal:!0,pclass:"layer_normal layer_annualvacation_adjust",contents:e.$el,buttons:[{btype:"confirm",btext:l["\ud655\uc778"],callback:function(){e.save(),e.on("save.success",function(){$.goMessage(s["\uc800\uc7a5\ub418\uc5c8\uc2b5\ub2c8\ub2e4."]),t.search(),n.close()})}},{btype:"normal",btext:l["\ucde8\uc18c"],callback:function(){n.close()}}]});e.render(),n.reoffset()},showSelectedManagePopup:function(){var e=this.list.tables.getCheckedIds(),t,n;if(e.length==0){$.goError(l["\uc120\ud0dd\ub41c \uc0ac\uc6a9\uc790\uac00 \uc5c6\uc2b5\ub2c8\ub2e4."]);return}e.length>1?(t="MULTI_SELECTED",n={ids:e}):(t="SINGLE_SELECTED",n={id:e[0],accountUseEhr:this.accountUseEhr});var r=new a(t,n),i=this,o=$.goPopup({header:t=="MULTI_SELECTED"?l["\uc5f0\ucc28 \uc77c\uad04 \uc870\uc815"]:l["\uc5f0\ucc28 \uc870\uc815"],width:500,title:"",modal:!0,pclass:"layer_normal layer_annualvacation_adjust",contents:r.$el,buttons:[{btype:"confirm",btext:l["\ud655\uc778"],callback:function(){r.save(),r.on("save.success",function(){$.goMessage(s["\uc800\uc7a5\ub418\uc5c8\uc2b5\ub2c8\ub2e4."]),i.search(),o.close()})}},{btype:"normal",btext:l["\ucde8\uc18c"],callback:function(){o.close()}}]});r.render(),o.reoffset()},initialize:function(e){this.accountUseEhr=_.isUndefined(e)?!1:e,this.$el.off(),this.current=t.util.toMoment(),this.baseDate=t.util.customDate(this.current,"YYYY-MM-DD")},render:function(){return this.$el.html(r({lang:l,baseDate:this.baseDate,displayBaseDate:this.getDisplayBaseDate()})),this.$el.find("header.content_top").html((new o).render(l["\uc804\uc0ac \uc5f0\ucc28\ud604\ud669"]).el),this.renderList(),this.renderCustomButtons(),this.initDatePicker(),this},renderList:function(){var e=t.contextRoot+"api/ehr/vacation/stat/company/list",n=this;this.list=$.goGrid({el:this.$el.find("#vacation_list"),method:"GET",destroy:!0,url:e,params:{baseDate:this.baseDate},emptyMessage:"<p class='data_null'> <span class='ic_data_type ic_no_data'></span><span class='txt'>"+l["\ubaa9\ub85d\uc5c6\uc74c"]+"</span>"+"</p>",defaultSorting:[[1,"asc"]],checkbox:!0,checkboxData:"userId",columns:[{mData:"userName",sWidth:"",sClass:"",bSortable:!0,fnRender:function(e){return e.aData.userName?"<a data-profile data-id="+e.aData.userId+">"+e.aData.userName+" "+(e.aData.positionName?e.aData.positionName:"")+"</a>":""}},{mData:null,sWidth:"",sClass:"",bSortable:!1,fnRender:function(e){return e.aData.deptNames?e.aData.deptNames:""}},{mData:null,sWidth:"",sClass:"",bSortable:!1,fnRender:function(e){return e.aData.hireDate?e.aData.hireDate:"-"}},{mData:null,sWidth:"",sClass:"",bSortable:!1,fnRender:function(e){return e.aData.leaveDate?e.aData.leaveDate:"-"}},{mData:null,sWidth:"",sClass:"",bSortable:!1,fnRender:function(e){return e.aData.workingYear!=null&&e.aData.workingYear!=undefined?e.aData.workingYear:""}},{mData:null,sWidth:"",sClass:"",bSortable:!1,fnRender:function(e){return e.aData.workingYearPoint!=null&&e.aData.workingYearPoint!=undefined?e.aData.workingYearPoint:""}},{mData:null,sWidth:"",sClass:"",bSortable:!1,fnRender:function(e){return e.aData.publishedMonthPoint!=null&&e.aData.publishedMonthPoint!=undefined?e.aData.publishedMonthPoint:""}},{mData:null,sWidth:"",sClass:"",bSortable:!1,fnRender:function(e){return e.aData.carriedMonthPoint!=null&&e.aData.carriedMonthPoint!=undefined?e.aData.carriedMonthPoint:""}},{mData:null,sWidth:"",sClass:"",bSortable:!1,fnRender:function(e){return e.aData.modifiedPoint!=null&&e.aData.modifiedPoint!=undefined?e.aData.modifiedPoint:""}},{mData:null,sWidth:"",sClass:"",bSortable:!1,fnRender:function(e){return e.aData.sumPoint!=null&&e.aData.sumPoint!=undefined?e.aData.sumPoint:""}},{mData:null,sWidth:"",sClass:"",bSortable:!1,fnRender:function(e){return e.aData.usedPoint!=null&&e.aData.usedPoint!=undefined?e.aData.usedPoint:""}},{mData:null,sWidth:"",sClass:"",bSortable:!1,fnRender:function(e){return e.aData.restPoint!=null&&e.aData.restPoint!=undefined?e.aData.restPoint:""}},{mData:null,sWidth:"",sClass:"",bSortable:!1,fnRender:function(e){return e.aData.userStatus&&e.aData.userStatus!=undefined?e.aData.userStatus:""}}],fnDrawCallback:function(e,t,r){$(window).scrollTop(0),n.$el.find("#vacation_list tbody tr").click(function(e){var t=$(e.target);if(t.is("input:checkbox")||t.is("a")||t.closest("p").is(".data_null"))return;var n=t.closest("tr").find("input[name=userId]").val();window.open("/app/ehr/vacation/"+n,n,"scrollbars=yes,resizable=yes,width=1280,height=640")})}})},renderCustomButtons:function(){var e=['<div class="critical">','<a class="btn_tool" id="showUploadPopup" data-bypass><span class="ic_toolbar setting"></span><span class="txt">'+l["\uc5f0\ucc28 \ucd08\uae30 \uc124\uc815"]+"</span></a>",'<div class="wrap_tip_annual">','    <span class="text tit_tip"></span>','    <span class="btn_wrap" id="vacation_description_icon">','        <span class="ic ic_info" title="">','            <span class="layer_tail" id="vacation_description" style="display:none;">','                <i class="ic ic_tail"></i>','                <div class="wrap_help_guide_s">',l["\uc5f0\ucc28 \ud604\ud669 \uafc0\ud301 \uac00\uc774\ub4dc"],"                </div>","            </span>","        </span>","    </span>","</div>","</div>"].join(""),t=['<div class="optional">','<div class="btn_submenu" id="vacationManage">','    <a class="showSelectedManagePopup  btn_tool btn_tool_multi" data-role="button" evt-rol="toolbar" evt-act="toolbar-message-delete"><span class="ic_toolbar adjust"></span><span class="txt_caution ">'+l["\uc5f0\ucc28 \uc870\uc815"]+'</span></a><span id="mangeSubMenu" class="btn_func_more" evt-rol="toolbar" sub="on"><span class="ic ic_arrow_type3"></span></span>','    <div class="array_option delete" id="submenu" style="display:none;">','        <ul id="toolbar_delete" class="array_type">','            <li evt-rol="toolbar-message-delete" class="showSelectedManagePopup"><span>'+l["\uc5f0\ucc28 \uc870\uc815"]+"</span></li>",'            <li evt-rol="toolbar-message-erase" class="showAllManagePopup"><span>'+l["\uc5f0\ucc28 \uc77c\uad04 \uc870\uc815"]+"</span></li>","        </ul>","    </div>","</div>",'<a class="btn_tool" id="downloadList" data-bypass><span class="ic_toolbar download"></span><span class="txt">'+l["\ubaa9\ub85d \ub2e4\uc6b4\ub85c\ub4dc"]+"</span></a>\n",'<form id="download_vacation_form" method="POST" target="ifm_download_vacation_form" style="display: none;"></form>','<iframe name="ifm_download_vacation_form" id="ifm_download_vacation_form" style="border:0px;width:0px;height:0px;"></iframe>',"</div>"].join(""),n=this.$el.find("#middle_tool_bar");n.append(e),n.append(t),this.customGridView()},customGridView:function(){var e=this,t=this.$el.find("#vacation_list_length"),n=this.$el.find(".optional");t.appendTo(n);var r=t.find("select[name=vacation_list_length]");r.addClass("select_box");var i=this.$el.find("#vacation_list_wrapper").find(".tool_bar");for(var s=0,o;o=i[s];s++)$(o).hasClass("tool_absolute")||$(o).attr("style","display:none");this.$el.find("#ehr_checkbox1").click(function(t){e.$el.find("#vacation_list").find("input[type=checkbox]").not("[disabled]").attr("checked",$(t.currentTarget).is(":checked"))})},xlsxDownload:function(){var e=t.contextRoot+"api/ehr/vacation/histories/download",n=this.$el.find("#searchDate").attr("data-date"),r=t.util.toMoment(n).startOf("years").format("YYYY-MM-DD"),i=t.util.toMoment(n).endOf("years").format("YYYY-MM-DD"),s={property:"startDate",direction:"desc",startDate:r,endDate:i};window.location.href=e+"?"+$.param(s)},showProfile:function(e){e.stopPropagation();var t=e.currentTarget,r=$(t).attr("data-id");if(!r)return;n.render(r,t)},enterSearch:function(e){if(e.keyCode!="13")return;this.search()},search:function(){var e=this.getParam();this.reloadList(e)},reloadList:function(e){this.list.tables.customParams=e,this.list.tables.fnClearTable()},getParam:function(){var e={baseDate:this.$el.find("#baseDate").data("basedate"),startHireDate:this.$el.find("#startHireDate").val()?moment((new Date(this.$el.find("#startHireDate").val())).setHours(0)).format("YYYY-MM-DDTHH:mm:ss.SSSZ"):"",endHireDate:this.$el.find("#endHireDate").val()?moment((new Date(this.$el.find("#endHireDate").val())).setHours(0)).format("YYYY-MM-DDTHH:mm:ss.SSSZ"):"",deptName:this.$el.find("#deptName").val(),userName:this.$el.find("#userName").val(),userStatus:this.$el.find("#status").val()};return e},showBaseCalendar:function(){this.$el.find("#baseDatePicker").focus()},showStartCalendar:function(){this.$el.find("#startHireDatePicker").focus()},showEndCalendar:function(){this.$el.find("#endHireDatePicker").focus()},resetSearch:function(){this.$el.find("#baseDate").val(t.util.customDate(this.current,"YYYY-MM-DD")),this.$el.find("#startHireDate").val(""),this.$el.find("#endHireDate").val(""),this.$el.find("#deptName").val(""),this.$el.find("#userName").val(""),this.$el.find("input#all").prop("checked",!0)},initDatePicker:function(){var e=this.$el.find("#baseDatePicker");$.datepicker.setDefaults($.datepicker.regional[t.config("locale")]),e.datepicker({dateFormat:"yy.mm.dd",changeMonth:!0,changeYear:!0,yearSuffix:"",onSelect:$.proxy(function(e){this.baseDate=moment(e,"YYYY-MM-DD").format("YYYY-MM-DD");var t=this.$el.find("#baseDate");t.data("basedate",this.baseDate),t.text(this.getDisplayBaseDate()),this.search()},this)});var n=this.$el.find("#startHireDatePicker");$.datepicker.setDefaults($.datepicker.regional[t.config("locale")]),n.datepicker({dateFormat:"yy-mm-dd",changeMonth:!0,changeYear:!0,yearSuffix:"",onSelect:$.proxy(function(e){$("#startHireDate").val(e),r.datepicker("option","minDate",e)},this)});var r=this.$el.find("#endHireDatePicker");$.datepicker.setDefaults($.datepicker.regional[t.config("locale")]),r.datepicker({dateFormat:"yy-mm-dd",changeMonth:!0,changeYear:!0,yearSuffix:"",onSelect:$.proxy(function(e){$("#endHireDate").val(e)},this)})}});return c});