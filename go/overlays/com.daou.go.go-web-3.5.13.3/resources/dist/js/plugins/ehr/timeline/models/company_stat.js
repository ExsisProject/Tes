define("timeline/models/company_stat",function(require){var e=require("timeline/collections/weekly_stats"),t=require("timeline/collections/month_stats"),n=require("backbone"),r=require("app"),i=n.Model.extend({defaults:{},initialize:function(e){this.range=e.range,this.companyId=e.companyId,this.deptId=e.deptId,this.range==="COMPANY"?this.type="MONTH":this.type="WEEK",this.page=0,this.offSet=20,this.direction="desc",this.property="total",this.date=new Date,this.filterQuery=""},url:function(){return r.contextRoot+"api/ehr/timeline/company/stats"+this.getQueryParam()},initWeekData:function(){this.weekPage=this.get("weekPage"),this.pageInfo=this.weekPage.pageInfo,this.pageInfo.pageNo=this.pageInfo.page,this.weeks=new e(this.weekPage.content,this.pageInfo),this.days=this.get("days"),this.deptName=this.get("deptName")},initMonthData:function(){this.monthPage=this.get("monthPage"),this.pageInfo=this.monthPage.pageInfo,this.pageInfo.pageNo=this.pageInfo.page,this.weekList=this.get("weeks"),this.monthPage.content.page=this.pageInfo,this.deptName=this.get("deptName"),this.months=new t(this.monthPage.content,this.pageInfo)},initData:function(){this.type=="WEEK"?this.initWeekData():this.initMonthData()},updateType:function(e){this.type=e},toogleType:function(){this.type=this.type=="WEEK"?"MONTH":"WEEK"},isWeekType:function(){return this.type=="WEEK"},getQueryParam:function(){return"?"+$.param({range:this.range,type:this.type,page:this.page,offSet:this.offSet,direction:this.direction,property:this.property,day:r.util.customDate(this.date,"YYYY-MM-DD")})+this.getSelectKeyParam()+this.getFilterQuery()},getSelectKeyParam:function(){return this.companyId&&this.companyId>0?"&"+$.param({companyId:this.companyId}):this.deptId&&this.deptId>0?"&"+$.param({deptId:this.deptId}):""},getFilterQuery:function(){return this.filterQuery.length>0?"&"+this.filterQuery:""},setFilter:function(e,t){this.filter={key:t}},nextDate:function(){this.moveDate(!0)},prevDate:function(){this.moveDate(!1)},moveDate:function(e){this.isWeekType()?this.date.setDate(this.date.getDate()+(e?7:-7)):this.date.setMonth(this.date.getMonth()+(e?1:-1))},moveToday:function(){this.date=new Date},setDate:function(e){this.date=new Date(e)},hasData:function(){return this.isWeekType()?_.isEmpty(this.weeks.models)?!1:!0:_.isEmpty(this.months.models)?!1:!0},getDateInfo:function(){if(this.isWeekType()){var e=this.get("weekDayList").days;return e[0]+" ~ "+e[6]}return this.get("month")},toogleSort:function(){this.direction=this.direction=="desc"?"asc":"desc"},selectDepartment:function(e){this.deptId=e,this.companyId=null},selectCompany:function(e){this.companyId=e,this.deptId=null},parse:function(e){this.set(e.data),this.initData()}});return i});