define("vacation/views/dept_vacation_histories",function(require){var e=require("backbone"),t=require("app"),n=require("views/profile_card"),r=require("hgn!vacation/templates/dept_vacation_histories"),i=require("i18n!vacation/nls/vacation"),s=require("i18n!nls/commons"),o=require("i18n!admin/nls/admin"),u=require("vacation/views/title");require("GO.util"),require("jquery.go-grid");var a={"\ubd80\uc11c \uc5f0\ucc28\ud604\ud669":i["\ubd80\uc11c \uc5f0\ucc28\ud604\ud669"],"\uc774\ub984":s["\uc774\ub984"],"\ubd80\uc11c\uba85":s["\ubd80\uc11c\uba85"],"\uc785\uc0ac\uc77c":i["\uc785\uc0ac\uc77c"],"\ud1f4\uc0ac\uc77c":i["\ud1f4\uc0ac\uc77c"],"\uadfc\uc18d\uc5f0\uc218":i["\uadfc\uc18d\uc5f0\uc218"],"\ubc1c\uc0dd \uc5f0\ucc28":i["\ubc1c\uc0dd \uc5f0\ucc28"],"1\ub144 \ubbf8\ub9cc \ubc1c\uc0dd \uc6d4\ucc28":i["1\ub144 \ubbf8\ub9cc \ubc1c\uc0dd \uc6d4\ucc28"],"1\ub144 \ubbf8\ub9cc \uc774\uc6d4 \uc6d4\ucc28":i["1\ub144 \ubbf8\ub9cc \uc774\uc6d4 \uc6d4\ucc28"],"\uc870\uc815 \uc5f0\ucc28":i["\uc870\uc815 \uc5f0\ucc28"],"\ucd1d\uc5f0\ucc28":i["\ucd1d\uc5f0\ucc28"],"\uc0ac\uc6a9 \uc5f0\ucc28":i["\uc0ac\uc6a9 \uc5f0\ucc28"],"\uc794\uc5ec \uc5f0\ucc28":i["\uc794\uc5ec \uc5f0\ucc28"],"\uc0c1\ud0dc":s["\uc0c1\ud0dc"],"\ubaa9\ub85d \ub2e4\uc6b4\ub85c\ub4dc":s["\ubaa9\ub85d \ub2e4\uc6b4\ub85c\ub4dc"],"\ubaa9\ub85d\uc5c6\uc74c":o["\ubaa9\ub85d\uc5c6\uc74c"],"\ubc1c\uc0dd \uc6d4\ucc28":i["\ubc1c\uc0dd \uc6d4\ucc28"],"\uc774\uc6d4 \uc6d4\ucc28":i["\uc774\uc6d4 \uc6d4\ucc28"]},f=e.View.extend({events:{"click #downloadList":"downloadList","click [data-profile]":"showProfile","click #preDate":"preDate","click #nextDate":"nextDate","click #baseDate":"showCalendar"},initialize:function(e){this.deptId=e.deptId,this.baseDate=t.util.customDate(t.util.toMoment(),"YYYY-MM-DD")},getDisplayBaseDate:function(){return moment(this.baseDate).format("YYYY.MM.DD")},render:function(){return this.$el.html(r({displayBaseDate:this.getDisplayBaseDate(),baseDate:this.baseDate,lang:a})),this.$el.find("header.content_top").html((new u).render(a["\ubd80\uc11c \uc5f0\ucc28\ud604\ud669"]).el),this.renderList(),this.initDatePicker(),this},renderList:function(){var e=t.contextRoot+"api/ehr/vacation/stat/dept/"+this.deptId,n=this;this.list=$.goGrid({el:this.$el.find("#vacation_list"),method:"GET",pageUse:!1,sDomUse:!1,destroy:!0,displayLength:999,url:e,params:{baseDate:moment(this.baseDate).format("YYYY-MM-DD")},emptyMessage:"<p class='data_null'> <span class='ic_data_type ic_no_data'></span><span class='txt'>"+a["\ubaa9\ub85d\uc5c6\uc74c"]+"</span>"+"</p>",checkbox:!1,columns:[{mData:null,sWidth:"",sClass:"userName",bSortable:!0,fnRender:function(e){return e.aData.userName?"<a data-profile data-id="+e.aData.userId+">"+e.aData.userName+" "+(e.aData.positionName?e.aData.positionName:"")+"</a>":""}},{mData:null,sWidth:"",sClass:"",bSortable:!1,fnRender:function(e){return e.aData.hireDate?e.aData.hireDate:"-"}},{mData:null,sWidth:"",sClass:"",bSortable:!1,fnRender:function(e){return e.aData.workingYear!=null&&e.aData.workingYear!=undefined?e.aData.workingYear:""}},{mData:null,sWidth:"",sClass:"",bSortable:!1,fnRender:function(e){return e.aData.workingYearPoint!=null&&e.aData.workingYearPoint!=undefined?e.aData.workingYearPoint:""}},{mData:null,sWidth:"",sClass:"",bSortable:!1,fnRender:function(e){return e.aData.publishedMonthPoint!=null&&e.aData.publishedMonthPoint!=undefined?e.aData.publishedMonthPoint:""}},{mData:null,sWidth:"",sClass:"",bSortable:!1,fnRender:function(e){return e.aData.carriedMonthPoint!=null&&e.aData.carriedMonthPoint!=undefined?e.aData.carriedMonthPoint:""}},{mData:null,sWidth:"",sClass:"",bSortable:!1,fnRender:function(e){return e.aData.modifiedPoint!=null&&e.aData.modifiedPoint!=undefined?e.aData.modifiedPoint:""}},{mData:null,sWidth:"",sClass:"",bSortable:!1,fnRender:function(e){return e.aData.sumPoint!=null&&e.aData.sumPoint!=undefined?e.aData.sumPoint:""}},{mData:null,sWidth:"",sClass:"",bSortable:!1,fnRender:function(e){return e.aData.usedPoint!=null&&e.aData.usedPoint!=undefined?e.aData.usedPoint:""}},{mData:null,sWidth:"",sClass:"",bSortable:!1,fnRender:function(e){return e.aData.restPoint!=null&&e.aData.restPoint!=undefined?e.aData.restPoint:""}},{mData:null,sWidth:"",sClass:"",bSortable:!1,fnRender:function(e){return e.aData.userStatus&&e.aData.userStatus!=undefined?e.aData.userStatus:""}}],fnDrawCallback:function(e,t,r){$(window).scrollTop(0),n.$el.find("#vacation_list tbody tr").click(function(e){var t=$(e.target);if(t.is("a")||t.is("span.ic_no_data"))return;var n=t.closest("tr").find("a").attr("data-id");window.open("/app/ehr/vacation/"+n,n,"scrollbars=yes,resizable=yes,width=1280,height=640")})}})},downloadList:function(){window.location.href=t.contextRoot+"api/ehr/vacation/stat/dept/csv/"+this.deptId+"?baseDate="+this.baseDate},preDate:function(){this.changeDate(-1)},changeDate:function(e){var t=this.$el.find("#baseDate");this.baseDate=moment(t.data("date")).add("days",e).format("YYYY-MM-DD"),t.data("date",this.baseDate),t.text(this.getDisplayBaseDate()),this.refresh()},nextDate:function(e){this.changeDate(1)},refresh:function(){this.list.tables.customParams={baseDate:this.baseDate},this.list.tables.fnClearTable()},showCalendar:function(){this.$el.find("#baseDatePicker").focus()},initDatePicker:function(){var e=this.$el.find("#baseDatePicker");$.datepicker.setDefaults($.datepicker.regional[t.config("locale")]),e.datepicker({dateFormat:"yy.mm.dd",changeMonth:!0,changeYear:!0,yearSuffix:"",onSelect:$.proxy(function(e){this.baseDate=moment(e,"YYYY-MM-DD").format("YYYY-MM-DD"),this.$el.find("#baseDate").data("date",this.baseDate),this.$el.find("#baseDate").text(this.getDisplayBaseDate()),this.refresh()},this)})},showProfile:function(e){e.stopPropagation();var t=e.currentTarget,r=$(t).attr("data-id");if(!r)return;n.render(r,t)}});return f});