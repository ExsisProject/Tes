define("timeline/views/user/timeline_item",function(require){var e=require("backbone"),t=require("hgn!timeline/templates/user/timeline_item"),n=require("timeline/views/user/history_popup"),r=require("timeline/models/history"),i=require("timeline/models/timeline_group"),s=require("timeline/models/auth"),o=require("app"),u=e.Collection.extend({model:r,totalPx:100,initialize:function(e,t,n){this.dayInfo=t,this.splitMin=n,this.rate=this.splitMin/60,this.px=this.totalPx*this.rate},getData:function(){var e=this;return _.chain(this.models).map(function(t){return{id:t.get("id"),name:t.getStatusName(),time:t.checkTimeHourMinuteSecond(),timeZone:t.get("timezoneInfo"),content:t.getContent(),editedCheckTime:t.editedCheckTime,nextDayWork:function(){return e.dayInfo.day!=t.checkTimeDate()},leftPadding:function(){var n=t.checkTimeMinute(),r=n%e.splitMin,i=r/e.splitMin*e.px;return i}}}).value()}}),a=e.View.extend({events:{"click div.time_schedule":"showEditPopup",click:"showCreatePopup"},className:"tb_cell",initialize:function(){this.authModel=new s(o.util.store.get("timeline.auth")),this.authModel.isEditable()||this.$el.css("cursor","auto"),this.targetUserId=this.options.targetUserId,this.dayInfo=this.options.dayInfo,this.hour=this.options.hour,this.min=this.options.min,this.splitMin=this.options.splitMin,this.group=this.options.group,this.collection=new u(this.options.data,this.dayInfo,this.splitMin),this.timelineGroup=new i(this.group),this.restTime=this.timelineGroup.isRestTime(this.hour,this.min),this.workTime=this.timelineGroup.isWorkTime(this.hour,this.min),this.nightTime=this.timelineGroup.isNightTime(this.hour,this.min),this.dutyTime=this.timelineGroup.isDutyTime(this.hour,this.min)},getClassName:function(){return this.restTime?"restTime":this.nightTime?"nightTime":this.dutyTime?"dutyTime":this.workTime?"workTime":""},render:function(){var e=this,n=this.min<1;this.$el.html(t({hour:this.leftPaddingZero(this.hour),min:this.min,viewHour:n,data:this.collection.getData(),auth:this.authModel.toJSON(),cName:this.getClassName()}))},leftPaddingZero:function(e){return e.toString().length>1?e:"0"+e},showEditPopup:function(e){e.stopPropagation();if(!this.authModel.isEditable())return;var t=$(e.currentTarget),r=t.data("id"),i=new n({targetUserId:this.targetUserId,dayInfo:this.dayInfo,data:this.collection.findWhere({id:r}).toJSON()});i.render()},showCreatePopup:function(){if(!this.authModel.isCreatable())return;var e=o.util.toMoment(this.dayInfo.day).add("hours",this.hour).add("minutes",this.min).format(),t=new n({targetUserId:this.targetUserId,dayInfo:this.dayInfo,data:{checkTime:e}});t.render()}});return a});