define("timeline/views/dashboard/list/search_filter",function(require){var e=require("backbone"),t=require("hgn!timeline/templates/dashboard/list/search_filter"),n=require("i18n!timeline/nls/timeline"),r=require("i18n!nls/commons"),i=require("underscore"),s=e.View.extend({events:{"click input[type=checkbox]":"checkChanged","click #ck_main":"toogleCkbox","click .search_box":"toogleInputBox","click .cancel":"hidePopup","click .ic_close":"closeOpt","click #startDateInput":"viewStartDate","click #endDateInput":"viewEndDate","click #dateConfirm":"dateConfirm","click #deptConfirm":"deptConfirm","click #nameConfirm":"nameConfirm"},initialize:function(e){this.cb=e.cb,this.parent=e.self,this.data=e.data,this.baseDate=e.baseDate},render:function(){this.$el.html(t({TimelineLang:n,CommonLang:r}));var e=this;return $("body").on("click",function(t){var n=$(t.target).parents(".array_option").length>0,r=$(t.target).parents(".layer_a").length>0,i=$(t.target).parents(".search_box").length>0,s=$(t.target).parents(".ui-datepicker").length>0;!r&&!n&&!i&&!s&&e.hidePopup()}),this.initDatePicker(),this},viewStartDate:function(){$("#startDatePicker").trigger("focus")},viewEndDate:function(){$("#endDatePicker").trigger("focus")},deptConfirm:function(){this.deptName=this.$el.find("#dept-value").val(),this.$el.find("#dept-filter").text(this.deptName),this.hidePopup(),this.changedFilter()},nameConfirm:function(){this.name=this.$el.find("#name-value").val(),this.$el.find("#name-filter").text(this.name),this.hidePopup(),this.changedFilter()},dateConfirm:function(){this.startDate=this.$el.find("#start-date").val(),this.endDate=this.$el.find("#end-date").val(),this.$el.find("#dateRange").text(this.startDate+" ~ "+this.endDate),this.hidePopup(),this.changedFilter()},initDatePicker:function(){var e=this,t=new Date(this.baseDate),n=new Date(t.getFullYear(),t.getMonth()+1,0);this.startDate=moment(t).format("YYYY-MM-01"),this.endDate=moment(n).format("YYYY-MM-DD"),this.$el.find("#dateRange").text(this.startDate+" ~ "+this.endDate),e.$el.find("#start-date").val(this.startDate),e.$el.find("#end-date").val(this.endDate),this.$el.find("#startDatePicker").datepicker({dateFormat:"yy-mm-dd",changeMonth:!0,changeYear:!0,yearSuffix:"",minDate:this.startDate,maxDate:this.endDate,onSelect:function(t){e.$el.find("#start-date").val(t)}}),this.$el.find("#endDatePicker").datepicker({dateFormat:"yy-mm-dd",changeMonth:!0,changeYear:!0,yearSuffix:"",minDate:this.startDate,maxDate:this.endDate,onSelect:function(t){e.$el.find("#end-date").val(t)}})},checkChanged:function(){var e=this;i.forEach(this.$el.find("input[type=checkbox]"),function(t){var n=$(t).attr("id"),r=$(t).is(":checked"),i=n.replace("Ck","Opt");r?e.$el.find("#"+i).show():e.$el.find("#"+i).hide()})},toogleCkbox:function(){var e=this.$el.find(".fastSearch");e.css("display")==="none"?(this.$el.find(".array_option").hide(),e.show()):e.hide()},toogleInputBox:function(e){var t=$(e.target);if(t.parents(".array_option").length>0)return;t.hasClass("search_box")||(t=t.parents(".search_box"));var n=t.attr("id").replace("Opt","Input");this.$el.find(".array_option").hide(),this.$el.find("#"+n).show()},closeOpt:function(e){var t=$(e.target);t.parents(".search_box").hide();var n=t.parents(".search_box").attr("id");this.$el.find("#"+n.replace("Opt","Ck")).attr("checked",!1),this.$el.find("#"+n.replace("Opt","-filter")).text(""),this.changedFilter()},hidePopup:function(){var e=this;setTimeout(function(){e.$el.find(".array_option").hide()},50)},changedFilter:function(){var e=this,t=undefined,n=undefined,r=undefined,s=undefined;i.forEach(this.$el.find("input[type=checkbox]"),function(i){var o=$(i).attr("id"),u=$(i).is(":checked"),a=o.replace("Ck","");u&&(a==="name"?t=e.name:a==="dept"?n=e.deptName:a==="date"&&(r=e.startDate,s=e.endDate))});var o={name:t,deptName:n,startDate:r,endDate:s};this.cb(o,this.parent)}});return s});