(function(){define(["jquery","backbone","app","hgn!hrcard/templates/hrcard_list","hrcard/collections/position_list","i18n!nls/commons","i18n!hrcard/nls/hrcard","jquery.go-grid","jquery.go-popup","GO.util"],function(e,t,n,r,i,s,o){var u={status:o["\uacc4\uc815\uc0c1\ud0dc"],online:s["\uc815\uc0c1"],stop:s["\uc911\uc9c0"],dormant:s["\ud734\uba74"],mail:s["\uba54\uc77c"],noResult:o["\uc870\ud68c\ud560 \ubaa9\ub85d\uc774 \uc5c6\uc2b5\ub2c8\ub2e4."],totalCnt:o["\uc804\uccb4\uba85\uc218"],search:s["\uac80\uc0c9"],empno:o["\uc0ac\ubc88"],deptName:s["\uc18c\uc18d"],name:s["\uc774\ub984"],email:s["\uc774\uba54\uc77c"],directTel:o["\ub0b4\uc120\ubc88\ud638"],company:o["\uc804\uc0ac"],dept:o["\ubd80\uc11c"],position:o["\uc9c1\uc704"],subDeptInclude:o["\ud558\uc704\ubd80\uc11c \ud3ec\ud568"],hrcard:o["\uc778\uc0ac\uc815\ubcf4"]},a=t.View.extend({unbindEvent:function(){this.$el.off("change","#position"),this.$el.off("change","#status"),this.$el.off("click",".btn-search"),this.$el.off("keydown","div.search_wrap input"),this.$el.off("click","#includeSubDept input"),this.$el.off("click","#hrcardListSearch"),this.$el.off("click","#hrcardInfo")},bindEvent:function(){this.$el.on("change","#position",e.proxy(this.positionFilter,this)),this.$el.on("change","#status",e.proxy(this.statusFilter,this)),this.$el.on("click",".btn-search",e.proxy(this.search,this)),this.$el.on("keydown","div.search_wrap input",e.proxy(this.searchKeyboardEvent,this)),this.$el.on("click","#includeSubDept input",e.proxy(this.checkIncludeSubDept,this)),this.$el.on("click","#hrcardListSearch",e.proxy(this.search,this)),this.$el.on("click","#hrcardListDataTable tbody tr",e.proxy(this.hrcardInfo,this))},initialize:function(e){this.options=e||{},this.unbindEvent(),this.bindEvent(),this.range=this.options.range,this.deptId=this.options.deptId||"",this.positions=i.getCollection()},render:function(){var e=this;return this.positions.on("reset",function(t,n){e.$el.html(r({lang:u,positions:e.positions.toJSON()})),e.loadTable()}),this},checkIncludeSubDept:function(t){var n=e(t.currentTarget),r=GO.contextRoot+"api/ehr/hrcard/dept/"+this.deptId+"?"+e.param({includeSubDept:n.is(":checked")});this.dataTable.tables.fnSettings().sAjaxSource=r,this.dataTable.tables.fnClearTable()},getUrl:function(){var t="";return this.range=="all"?t=GO.contextRoot+"api/ehr/hrcard/all":t=GO.contextRoot+"api/ehr/hrcard/dept/"+this.deptId+"?"+e.param({includeSubDept:!1}),t},hrcardInfo:function(t){var n=e(t.currentTarget),r=n.find("td span").attr("data-id");GO.router.navigate("ehr/hrcard/detail/"+r,{trigger:!0})},loadTable:function(){var t=this;this.dataTable=e.goGrid({el:"#hrcardListDataTable",method:"GET",url:t.getUrl(),bDestroy:!0,emptyMessage:"<p class='data_null'> <span class='ic_data_type ic_no_data'></span><span class='txt'>"+u.noResult+"</span>"+"</p>",columns:[{mData:null,bSortable:!1,fnRender:function(e){return e.aData.employeeNumber!=null?e.aData.employeeNumber:"-"}},{mData:null,bSortable:!1,fnRender:function(e){return e.aData.deptName!=null?e.aData.deptName:"-"}},{mData:"name",bSortable:!0,fnRender:function(e){return'<span data-id="'+e.aData.id+'">'+e.aData.name+"</span>"}},{mData:null,bSortable:!1,fnRender:function(e){return e.aData.position!=null?e.aData.position:"-"}},{mData:"email",bSortable:!0},{mData:null,bSortable:!1,fnRender:function(e){return e.aData.directTel!=null?e.aData.directTel:"-"}},{mData:"status",sClass:"align_c",sWidth:"100px",bSortable:!1,fnRender:function(e){return e.aData.status=="ONLINE"?u.online:e.aData.status=="STOP"?u.stop:u.mail+" "+u.dormant}}],fnDrawCallback:function(r,i,s){var o=n.i18n(u.totalCnt,{arg1:i._iRecordsTotal});t.$el.find("#totalCnt").html(o),t.$el.find(".custom_header").append(t.$el.find("#listInfo").show()),t.range=="dept"&&e("#includeSubDept").show(),t.$el.find("tbody tr").css("cursor","pointer")}})},positionFilter:function(e){this.changeFilter(e,"positionFilter")},statusFilter:function(e){this.changeFilter(e,"statusFilter")},changeFilter:function(t,n){var r=e(t.currentTarget).val();typeof this.dataTable.tables.setParam=="function"&&this.dataTable.tables.setParam(n,r)},search:function(){var e=this.$el.find('.table_search input[type="text"]'),t=e.val();this.dataTable.tables.search(this.$el.find(".table_search select").val(),t,e)},searchKeyboardEvent:function(e){e.keyCode==13&&this.search()}});return a})})();