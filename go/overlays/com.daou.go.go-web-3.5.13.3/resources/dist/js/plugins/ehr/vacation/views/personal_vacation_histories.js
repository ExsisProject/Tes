define("vacation/views/personal_vacation_histories",function(require){var e=require("backbone"),t=require("app"),n=require("vacation/models/user_vacation"),r=require("vacation/collections/user_vacation_list"),i=require("hgn!vacation/templates/personal_vacation_histories"),s=require("i18n!vacation/nls/vacation"),o=require("i18n!nls/commons"),u=require("i18n!admin/nls/admin"),a=require("vacation/views/title"),f=require("models/profile_card");require("GO.util"),require("jquery.go-grid");var l={"\ub0b4 \uc5f0\ucc28 \ub0b4\uc5ed":s["\ub0b4 \uc5f0\ucc28 \ub0b4\uc5ed"],"\uc5f0\ucc28 \ub0b4\uc5ed":s["\uc5f0\ucc28 \ub0b4\uc5ed"],"\uc774\ub984":o["\uc774\ub984"],"\uc5f0\ucc28 \uc0ac\uc6a9\uae30\uac04":s["\uc5f0\ucc28 \uc0ac\uc6a9\uae30\uac04"],"\ubc1c\uc0dd \uc5f0\ucc28":s["\ubc1c\uc0dd \uc5f0\ucc28"],"1\ub144 \ubbf8\ub9cc \ubc1c\uc0dd \uc6d4\ucc28":s["1\ub144 \ubbf8\ub9cc \ubc1c\uc0dd \uc6d4\ucc28"],"1\ub144 \ubbf8\ub9cc \uc774\uc6d4 \uc6d4\ucc28":s["1\ub144 \ubbf8\ub9cc \uc774\uc6d4 \uc6d4\ucc28"],"\uc870\uc815 \uc5f0\ucc28":s["\uc870\uc815 \uc5f0\ucc28"],"\ucd1d\uc5f0\ucc28":s["\ucd1d\uc5f0\ucc28"],"\uc0ac\uc6a9 \uc5f0\ucc28":s["\uc0ac\uc6a9 \uc5f0\ucc28"],"\uc794\uc5ec \uc5f0\ucc28":s["\uc794\uc5ec \uc5f0\ucc28"],"\ubaa9\ub85d\uc5c6\uc74c":u["\ubaa9\ub85d\uc5c6\uc74c"],"\ubd80\uc11c\uba85":o["\ubd80\uc11c\uba85"],"\ub0b4\uc6a9":o["\ub0b4\uc6a9"],"\ub4f1\ub85d\uc77c":o["\ub4f1\ub85d\uc77c"],"\uc0ac\uc6a9 \uae30\uac04":u["\uc0ac\uc6a9 \uae30\uac04"],"\ubc1c\uc0dd\uc77c\uc218":s["\ubc1c\uc0dd\uc77c\uc218"],"\uc0ac\uc6a9\ub0b4\uc5ed":s["\uc0ac\uc6a9\ub0b4\uc5ed"],"\uc0dd\uc131\ub0b4\uc5ed":s["\uc0dd\uc131\ub0b4\uc5ed"],"\ud734\uac00\uc885\ub958":s["\ud734\uac00\uc885\ub958"],"\uc0dd\uc131\uc77c\uc218":s["\uc0dd\uc131\uc77c\uc218"],"\ubc1c\uc0dd \uc6d4\ucc28":s["\ubc1c\uc0dd \uc6d4\ucc28"],"\uc774\uc6d4 \uc6d4\ucc28":s["\uc774\uc6d4 \uc6d4\ucc28"]},c=e.View.extend({events:{"change #vacation_term_list":"changeVacation"},className:"annual_personal",initialize:function(e){var r=["<select>",'{{#dataset}}<option value="{{startDate}}">{{startDate}} ~ {{endDate}}</option>{{/dataset}}',"</select>"];this.hogan={tplVacationList:Hogan.compile(r.join(""))},e&&(this.userId=e.userId),this.baseDate=t.util.customDate(t.util.toMoment(),"YYYY-MM-DD"),this.vacation=new n(this.userId)},getDisplayBaseDate:function(){return moment(this.baseDate).format("YYYY.MM.DD")},getParam:function(){var e={baseDate:this.$el.find("#baseDate").data("basedate")};return e},changeVacation:function(e){var t={baseDate:e.target.value};this.reloadList(t)},render:function(){this.fetchVacation();var e=_.isUndefined(this.userId)?t.session().thumbnail:f.get(this.userId).get("thumbLarge");return this.$el.html(i({baseDate:this.baseDate,displayBaseDate:this.getDisplayBaseDate(),thumbnailUrl:e,lang:l,vacation:this.vacation.toJSON(),isEmpty:this.isEmpty})),this.renderList(),this.userId?(this.$el.find("header.content_top").html((new a).render(l["\uc5f0\ucc28 \ub0b4\uc5ed"]+" ("+this.vacation.attributes.userName+")").el),$("body").addClass("go_skin_ehr").html(this.el)):this.$el.find("header.content_top").html((new a).render(l["\ub0b4 \uc5f0\ucc28 \ub0b4\uc5ed"]).el),this.fetchVacationList(),this},fetchVacationList:function(){var e=r.getVacationList(this.userId).toJSON();e.length>0&&(e.forEach(function(e){e.startDate=moment(e.startDate,"YYYY-MM-DD").format("YYYY-MM-DD"),e.endDate=moment(e.endDate,"YYYY-MM-DD").format("YYYY-MM-DD")}),this.$el.find("#vacation_term_list").html(this.hogan.tplVacationList.render({dataset:e,selectId:"header_list",selectClass:"w_max"})).show())},fetchVacation:function(){_this=this,this.vacation.setBaseDate(this.baseDate),this.vacation.fetch({async:!1,success:function(e,t){_.isEmpty(t.data)?_this.isEmpty=!0:_this.isEmpty=!1}})},renderList:function(){this.renderHistoriesList(!0),this.renderIssuedList(!0)},reloadList:function(e){this.historiesList.tables.customParams=e,this.historiesList.tables.fnClearTable(),this.issuedList.tables.customParams=e,this.issuedList.tables.fnClearTable()},renderHistoriesList:function(e){if(this.userId)var n=t.contextRoot+"api/ehr/vacation/histories/"+this.userId;else var n=t.contextRoot+"api/ehr/vacation/my/histories";this.historiesList=$.goGrid({el:this.$el.find("#vacation_histories_list"),method:"GET",url:n,pageUse:!1,sDomUse:!1,destroy:!0,displayLength:999,sDomType:"admin",params:{baseDate:e?"":this.baseDate},emptyMessage:"<p class='data_null'> <span class='ic_data_type ic_no_data'></span><span class='txt'>"+l["\ubaa9\ub85d\uc5c6\uc74c"]+"</span>"+"</p>",columns:[{mData:null,sWidth:"",sClass:"",bSortable:!1,fnRender:function(e){return e.aData.userName?e.aData.userName+" "+(e.aData.positionName?e.aData.positionName:""):""}},{mData:null,sWidth:"",sClass:"",bSortable:!1,fnRender:function(e){return e.aData.deptName?e.aData.deptName:""}},{mData:null,sWidth:"",sClass:"",bSortable:!1,fnRender:function(e){return e.aData.title?e.aData.title:""}},{mData:null,sWidth:"",sClass:"",bSortable:!1,fnRender:function(e){return e.aData.startDate||e.aData.endDate?e.aData.startDate+" ~ "+e.aData.endDate:""}},{mData:null,sWidth:"",sClass:"",bSortable:!1,fnRender:function(e){return e.aData.usedPoint!=null&&e.aData.usedPoint!=undefined?e.aData.usedPoint:""}},{mData:null,sWidth:"",sClass:"",bSortable:!1,fnRender:function(e){return e.aData.description?e.aData.description:""}}],fnDrawCallback:function(e,t,n){$(window).scrollTop(0)}})},renderIssuedList:function(e){var n=t.contextRoot+"api/vacation/item"+(this.userId?"/"+this.userId:"");this.issuedList=$.goGrid({el:this.$el.find("#vacation_issued_list"),method:"GET",url:n,pageUse:!1,sDomUse:!1,destroy:!0,displayLength:999,sDomType:"admin",params:{baseDate:e?"":this.baseDate},emptyMessage:"<p class='data_null'> <span class='ic_data_type ic_no_data'></span><span class='txt'>"+l["\ubaa9\ub85d\uc5c6\uc74c"]+"</span>"+"</p>",columns:[{mData:null,sWidth:"",sClass:"",bSortable:!1,fnRender:function(e){return e.aData.publishedDate?e.aData.publishedDate:""}},{mData:null,sWidth:"",sClass:"",bSortable:!1,fnRender:function(e){return e.aData.expiredDate?e.aData.expiredDate:""}},{mData:null,sWidth:"",sClass:"",bSortable:!1,fnRender:function(e){return e.aData.point!=null&&e.aData.point!=undefined?e.aData.point:""}},{mData:null,sWidth:"",sClass:"",bSortable:!1,fnRender:function(e){return e.aData.reason?e.aData.reason:""}}],fnDrawCallback:function(e,t,n){$(window).scrollTop(0)}})},refresh:function(){this.render()}});return c});