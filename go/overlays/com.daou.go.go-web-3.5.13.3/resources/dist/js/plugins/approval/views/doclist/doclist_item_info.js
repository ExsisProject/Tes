define(["jquery","underscore","backbone","app","hgn!approval/templates/add_org_member","views/profile_card","approval/models/doclist_item","approval/models/appr_flow","approval/views/document/apprflow","approval/views/document/docinfo","approval/views/document/dochistory","approval/views/document/reader_history_list","approval/views/document/reception_document_list","approval/views/document/official_doc_receiver_list","approval/views/document/doc_type_select","approval/views/document/document_print","i18n!nls/commons","i18n!approval/nls/approval"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g){var y=n.Model.extend({initialize:function(e){this.docId=e.docId,t.isBoolean(e.isAdmin)&&(this.isAdmin=e.isAdmin)},url:function(){return this.isAdmin?["/ad/api/approval/document",this.docId,"approvalinfo"].join("/"):["/api/approval/document",this.docId,"approvalinfo"].join("/")}}),b=n.View.extend({initialize:function(e){this.docId=e.docId,this.isAdmin=!1,t.isBoolean(e.isAdmin)&&(this.isAdmin=e.isAdmin),this.model=new y({docId:this.docId,isAdmin:this.isAdmin}),this.model.fetch({async:!1})},render:function(){var t=e.goPopup({modal:!0,width:400,pclass:"layer_normal layer_reading",contents:this._makeContentHTML(),headerHtml:this._makeHeaderHTML(),closeIconVisible:!1,autoclose:!0,buttons:[{btype:"confirm",btext:m["\ud655\uc778"],callback:function(){}}]}),n=new a({el:"#tab1 div.reply_wrap",isAdmin:this.isAdmin,docId:this.docId,model:new u(this.model.get("apprFlow"))}),r=new f({el:"#tab2 div.reply_wrap",isAdmin:this.isAdmin,docId:this.model.get("document").documentId,docStatus:this.model.get("document").docStatus,docInfoModel:this.model.get("docInfo"),actionModel:this.model.get("actionCheck"),isComplete:this.model.get("document").docStatus=="COMPLETE"?!0:!1,isActivityUser:this.model.get("actionCheck").isActivityUser,isReader:this.model.get("actionCheck").isReader,isReceptionDocument:this.model.get("document").isReceptionDocument});r.bind("docTypeSelect",this.docTypeSelect,this),r.bind("readingDeleteItem",this.readingDeleteItem,this),r.bind("showReadingOrgSlider",this.showReadingOrgSlider,this),r.bind("showReceptionOrgSlider",this.showReceptionOrgSlider,this),r.bind("saveDocReaderAndReception",this.saveDocReaderAndReception,this);var i=new l({el:"#tab3 div.reply_wrap",model:this.model});i.bind("showApprChangeLog",this.showApprChangeLog,this);var s=new c({el:"#tab4 div.reply_wrap",isAdmin:this.isAdmin,docId:this.docId,collection:this.model.get("readingHistory")}),o=new h({el:"#tab5 div.reply_wrap",isAdmin:this.isAdmin,docId:this.docId,collection:this.model.get("receptionList")}),d=new p({el:"#tab6 div.item",isAdmin:this.isAdmin,docId:this.docId,docStatus:this.model.get("document").docStatus,dataList:this.model.get("docInfo").officialVersions});n.render(),n.show(),r.render(),i.render(),s.render(),o.render(),d.render();var v=t.find("li.docinfo_tab");v.click(function(t){v.removeClass("selected");var u=e(t.target);u.hasClass("docinfo_tab")||(u=u.parents("li.docinfo_tab")),u.addClass("selected"),n.hide(),r.hide(),i.hide(),s.hide(),o.hide(),d.hide();switch(u.find("a").attr("id")){case"docinfo_approval_status_tab":n.show();break;case"docinfo_approval_docinfo_tab":r.show();break;case"docinfo_approval_dochistory_tab":i.show();break;case"docinfo_approval_read_histories_tab":s.show();break;case"docinfo_approval_receivers_tab":o.show();break;default:d.show()}})},docTypeSelect:function(){var t=this,n=e.goPopup({pclass:"layer_normal layer_doc_type_select",header:g["\uc804\uc0ac\ubb38\uc11c\ud568 \uc120\ud0dd"],modal:!0,width:300,contents:"",buttons:[{btext:m["\ucd94\uac00"],autoclose:!1,btype:"confirm",callback:function(e){var n=r.doc_type_confirm();if(!n)return!1;t.docFolderSelect(!0)}},{btext:m["\ub2eb\uae30"],btype:"cancel"}]}),r=new d({});r.render(),n.reoffset()},showReadingOrgSlider:function(t){var n=this;return e.goOrgSlide({header:g["\uc5f4\ub78c\uc790 \uc120\ud0dd"],type:"list",contextRoot:r.contextRoot,callback:n.addReading,multiCompanyVisible:n.model.get("actionCheck").multiCompanySupporting})},showReceptionOrgSlider:function(t){var n=this;return e.goOrgSlide({header:g["\uc218\uc2e0\uc790 \uc120\ud0dd"],type:"list",contextRoot:r.contextRoot,callback:n.addReception})},addReading:function(t){var n=e("#addReading");t&&!n.find('li[data-id="'+t.id+'"]').length?n.find("li.creat").before(i(e.extend(t,{lang:lang}))):e.goMessage(g["\uc774\ubbf8 \uc120\ud0dd\ub418\uc5c8\uc2b5\ub2c8\ub2e4."])},addReception:function(t){var n=e("#addReceive");t&&!n.find('li[data-id="'+t.id+'"]').length?n.find("li.creat").before(i(e.extend(t,{lang:lang}))):e.goMessage(g["\uc774\ubbf8 \uc120\ud0dd\ub418\uc5c8\uc2b5\ub2c8\ub2e4."])},readingDeleteItem:function(t){e(t.currentTarget).parents("li").remove()},showApprChangeLog:function(t){var n=t.docBody,i=t.attaches,s=t.references,o=this.model.get("actionCheck");o.companyDocFolderUseFlag||(s=null);var u=e.goPopup({pclass:"layer_normal layer_approval_preview",header:g["\uacb0\uc7ac\ubb38\uc11c \ubcf4\uae30"],modal:!0,width:900,contents:"",buttons:[{btext:m["\uc778\uc1c4"],btype:"confirm",callback:function(){r.util.print(e("#printArea"))}},{btext:m["\ucde8\uc18c"],btype:"cancel"}]}),a=new v({docId:this.model.docId,popup:u,docBody:n,attaches:i,references:s});a.render(),u.reoffset()},_makeHeaderHTML:function(){return['<ul class="tab_type3 tab_type3_column6">','    <li class="docinfo_tab first selected">','        <a id="docinfo_approval_status_tab" onclick="return false">','            <span class="txt">'+g["\uacb0\uc7ac\uc120"]+"</span>","        </a>","    </li>",'    <li class="docinfo_tab">','        <a id="docinfo_approval_docinfo_tab" onclick="return false">','            <span class="txt">'+g["\ubb38\uc11c\uc815\ubcf4"]+"</span>","        </a>","    </li>",'    <li class="docinfo_tab">','        <a id="docinfo_approval_dochistory_tab" onclick="return false">','            <span class="txt">'+g["\ubcc0\uacbd\uc774\ub825"]+"</span>","        </a>","    </li>",'    <li class="docinfo_tab">','        <a id="docinfo_approval_read_histories_tab" onclick="return false">','            <span class="txt">'+g["\uc5f4\ub78c\uae30\ub85d"]+"</span>","        </a>","    </li>",'    <li class="docinfo_tab">','        <a id="docinfo_approval_receivers_tab" onclick="return false">','            <span class="txt">'+g["\uc218\uc2e0"]+"</span>","        </a>","    </li>",'    <li class="docinfo_tab last">','        <a id="docinfo_approval_officialreceivers_tab" onclick="return false">','            <span class="txt">'+g["\uacf5\ubb38\ubc1c\uc1a1"]+"</span>","        </a>","    </li>","</ul>"].join("\n")},_makeContentHTML:function(){return['<div class="wrap_tab_item div_scroll">','    <div id="tab1" class="tab_item">','        <div class="item">','            <div class="reply_wrap" style="display:none">',"            <!-- \uacb0\uc7ac\uc0c1\ud0dc -->","            </div>","        </div>","    </div>",'    <div id="tab2" class="tab_item">','        <div class="item">','            <div class="reply_wrap" style="display:none">',"            <!-- \ubb38\uc11c\uc815\ubcf4 -->","            </div>","        </div>","    </div>",'    <div id="tab3" class="tab_item">','        <div class="item">','            <div class="reply_wrap" style="display:none">',"            <!-- \ubcc0\uacbd\uc774\ub825 -->","            </div>","        </div>","    </div>",'    <div id="tab4" class="tab_item">','        <div class="item">','            <div class="reply_wrap" style="display:none">',"            <!-- \uc5f4\ub78c\uae30\ub85d -->","            </div>","        </div>","    </div>",'    <div id="tab5" class="tab_item">','        <div class="item">','            <div class="reply_wrap" style="display:none">',"            <!-- \uc218\uc2e0 -->","            </div>","        </div>","    </div>",'    <div id="tab6" class="tab_item">','        <div class="item" style="display:none">',"            <!-- \uacf5\ubb38\ubc1c\uc1a1 -->","        </div>","    </div>","</div>"].join("\n")}});return b});