(function(){define(["jquery","backbone","app","approval/models/appr_activity_group","approval/collections/activities"],function(e,t,n,r,i){var s=t.Collection.extend({model:r,validateAddPosition:function(e,t){var n=this.lastDisabledActivity();if(!n)return!0;var r=n.get("groupSeq");if(e<r)return!1;if(e==r){if(n.get("parallelAgreement")){var i=this.agreeActivityInfo(n.get("groupSeq"));if(!i.moveBeforMe&&t<=n.get("seq"))return!1;if(i.moveBeforMe)return!(t<=n.get("seq")-i.count)}if(t<n.get("seq"))return!1}return!0},lastDisabledActivity:function(){var e=this.map(function(e){return _.map(e.get("activities"),function(t){return _.extend(t,{groupSeq:e.get("seq")})})}),t=new i(_.flatten(e)),n=t.filter(function(e){return!e.isDeletable()&&!e.isPreviousReturn()});return _.last(n)},agreeActivityInfo:function(e){var t=new i(_.flatten(this.models[e].get("activities")),{comparator:function(e){return-e.get("seq")}}),n=!1,r=0;return t.each(function(e){if(!e.isDeletable()){if(e.attributes.status=="COMPLETE"&&e.attributes.parallelAgreement){n=!0;return}e.attributes.parallelAgreement&&(r+=1)}}),n?{moveBeforMe:!1}:{moveBeforMe:!0,count:r}}});return s})}).call(this);