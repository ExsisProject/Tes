define(["jquery","backbone","hgn!approval/templates/mobile/document/m_apprflow_sort","hgn!approval/templates/mobile/document/m_activity","i18n!nls/commons","i18n!approval/nls/approval","jquery.ui.touch-punch"],function(e,t,n,r,i,s){var o={activityAppendArea:".list_approvalLine",activityDeleteBtn:".btn_del",cancelViewBtn:"#cancel_btn",saveViewBtn:"#save_btn",activity:".activity",sortableItem:".item",sortableHandler:".btn_drag"},u={"\uc644\ub8cc":i["\uc644\ub8cc"],"\ucde8\uc18c":i["\ucde8\uc18c"],"\uacb0\uc7ac\uc120\ubcc0\uacbd":s["\uacb0\uc7ac\uc120 \ubcc0\uacbd"]},a=t.View.extend({initialize:function(e){this.options=e||{},this.data=this.options.data||{},this.saveCallBack=this.options.saveCallBack,this.cancelCallBack=this.options.cancelCallBack},render:function(){return this.$el.html(n({lang:u})),this.renderActivities(),this.bindEvents(),this.sortableArea(this.$el.find(o.activityAppendArea),o.sortableItem,o.sortableHandler),this},bindEvents:function(){this.$el.find(o.activityDeleteBtn).bind("click",this.onClickedDelBtn),this.$el.find(o.cancelViewBtn).bind("click",e.proxy(this.onClickedCancelBtn,this)),this.$el.find(o.saveViewBtn).bind("click",e.proxy(this.onClickedSaveBtn,this))},sortableArea:function(e,t,n){e.sortable({items:"> "+t,axis:"y",handle:n,opacity:.8,start:function(e,t){},stop:function(e,t){}})},renderActivities:function(){var t=this;e.each(this.data.activities,function(e,n){n=_.extend(n,{isDeletable:!n.isAssigned||t.data.isAssignedActivityDeletable}),t.$el.find(o.activityAppendArea).append(r(n))})},onClickedSaveBtn:function(t){var n=this.$el.find(o.activity),r=[];n.each(function(t,n){r.push({userId:e(n).attr("data-userid"),deptId:e(n).attr("data-deptid")})}),this.saveCallBack&&this.saveCallBack(r),this.$el.remove()},onClickedCancelBtn:function(e){this.cancelCallBack&&this.cancelCallBack(),this.$el.remove()},onClickedDelBtn:function(t){e(t.currentTarget.parentElement).remove()}});return a});