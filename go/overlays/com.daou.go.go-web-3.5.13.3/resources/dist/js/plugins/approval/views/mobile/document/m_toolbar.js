define(["jquery","backbone","hgn!approval/templates/mobile/document/m_toolbar","i18n!nls/commons","i18n!approval/nls/approval","views/layouts/m_action_bar_default","jquery.go-preloader"],function(e,t,n,r,i,s){var o={"\uc0ad\uc81c":{id:"deleted",name:"document_action",text:i["\uc0ad\uc81c"]},"\uacb0\uc7ac_Approved":{id:"approved",name:"document_action",text:i["\uacb0\uc7ac"]},"\uc0c1\uc2e0\ucde8\uc18c":{id:"actDraftWithdrawal",name:"document_action",text:i["\uc0c1\uc2e0\ucde8\uc18c"]},"\ud6c4\uacb0":{id:"actPostApproval",name:"document_action",text:i["\ud6c4\uacb0"]},"\ud6c4\uc5f4":{id:"actPostCheck",name:"document_action",text:i["\ud6c4\uc5f4"]},"\uacb0\uc7ac\ucde8\uc18c":{id:"actWithdrawal",name:"document_action",text:i["\uacb0\uc7ac\ucde8\uc18c"]},"\ud569\uc758":{id:"agreed",name:"document_action",text:i["\ud569\uc758"]},"\ubc18\ub300":{id:"disagreed",name:"document_action",text:i["\ubc18\ub300"]},"\ud655\uc778":{id:"checked",name:"document_action",text:i["\ud655\uc778"]},"\uacb0\uc7ac_Inspected":{id:"inspected",name:"document_action",text:i["\uacb0\uc7ac\ubaa8\ubc14\uc77c"]},"\ubc18\ub824":{id:"returned",name:"document_action",text:i["\ubc18\ub824"]},"\ubcf4\ub958":{id:"holded",name:"document_action",text:i["\ubcf4\ub958"],inMoreBtn:!0},"\uc120\uacb0\uc7ac":{id:"actAdvAppr",name:"document_action",text:i["\uc120\uacb0\uc7ac"]},"\uc811\uc218":{id:"actReceive",name:"document_action",text:i["\uc811\uc218"]},"\ubc18\uc1a1":{id:"returnReception",name:"document_action",text:i["\ubc18\uc1a1"],inMoreBtn:!0},"\uc7ac\uc811\uc218":{id:"actRereceive",name:"document_action",text:i["\uc7ac\uc811\uc218"]},"\uc811\uc218\ucde8\uc18c":{id:"cancelReception",name:"document_action",text:i["\uc811\uc218\ucde8\uc18c"]},"\uc811\uc218\ucde8\uc18c\ud6c4\ubc18\uc1a1":{id:"cancelAndReturnReception",name:"document_action",text:i["\uc811\uc218 \ucde8\uc18c \ud6c4 \ubc18\uc1a1"]},"\uc218\uc2e0\uc790\ucd94\uac00":{id:"actAddReceive",name:"document_action",text:i["\uc218\uc2e0\uc790 \ucd94\uac00"]},"\uc758\uacac":{id:"show_activity_comment_list",name:"show_activity_comment_list",text:i["\uc758\uacac"]},"\ub313\uae00":{id:"show_comment_list",name:"document_action",text:i["\ub313\uae00"]},"\ubcf8\ubb38":{id:"show_document",name:"document_action",text:i["\ubcf8\ubb38"],inMoreBtn:!0},"\uacb0\uc7ac\uc120":{id:"show_apprflow_list",name:"document_action",text:i["\uacb0\uc7ac\uc120"]},"\ubb38\uc11c\uc815\ubcf4":{id:"show_doc_info",name:"document_action",text:i["\ubb38\uc11c\uc815\ubcf4"],inMoreBtn:!0},"\uacb0\uc7ac\uc694\uccad":{id:"act_draft",name:"document_action",text:i["\uacb0\uc7ac\uc694\uccad"]},"\uc784\uc2dc\uc800\uc7a5":{id:"act_tempsave",name:"document_action",text:i["\uc784\uc2dc\uc800\uc7a5"]},"\uacb0\uc7ac\uc815\ubcf4":{id:"show_apprflow_list",name:"document_action",text:r["\uacb0\uc7ac\uc815\ubcf4"]},"\ub2f4\ub2f9\uc790\uc9c0\uc815":{id:"reassignReceiver",name:"document_action",text:i["\ub2f4\ub2f9\uc790 \uc9c0\uc815"]},"\ubbf8\ub9ac\ubcf4\uae30":{id:"approval_preview",name:"document_action",text:i["\ubbf8\ub9ac\ubcf4\uae30"]},"\uc7ac\uae30\uc548":{id:"act_reapply",name:"document_action",text:i["\uc7ac\uae30\uc548"]}},u=t.View.extend({initialize:function(t){this.options=t||{},_.bindAll(this,"render"),this.type=this.options.type,this.toolbarModel=this.options.toolbarModel,this.docStatus=this.options.docStatus,this.userId=this.options.userId,this.drafterId=this.options.drafterId,this.isReceptionDocument=this.options.isReceptionDocument,this.isDeletedDeptRcvDoc=this.options.isDeletedDeptRcvDoc,this.isAgreement=this.options.isAgreement,this.isPublic=this.options.isPublic,this.isDraftable=this.options.isDraftable,this.checkIsDeputyActivity=this.options.checkIsDeputyActivity,this.commentsCount=this.options.commentsCount,e(document).off("backdrop"),e(document).on("backdrop",e.proxy(function(e){this.closeMoreLayout(e)},this))},events:{},unbindEvent:function(){this.$el.off("change","#selectDocInfo"),this.$el.off("click","#show_document"),this.$el.off("click","#show_apprflow_list"),this.$el.off("click","#show_doc_info"),this.$el.off("click","[name=show_comment_list]"),this.$el.off("click","[name=show_activity_comment_list]"),this.$el.off("vclick","[name=document_action]"),this.$el.off("vclick","#act_list"),this.$el.off("vclick","#more_btn"),this.$el.off("click","#act_draft"),this.$el.off("click","#reassignReceiver"),this.$el.off("click","#act_tempsave"),this.$el.off("click","#act_reapply")},bindEvent:function(){this.$el.on("change","#selectDocInfo",e.proxy(this.selectDocInfo,this)),this.$el.on("vclick","#show_document",e.proxy(this.changeViewType,this)),this.$el.on("vclick","#show_apprflow_list",e.proxy(this.changeViewType,this)),this.$el.on("vclick","#show_doc_info",e.proxy(this.changeViewType,this)),this.$el.on("click","[name=show_comment_list]",e.proxy(this.show_comment_list,this)),this.$el.on("click","[name=show_activity_comment_list]",e.proxy(this.show_activity_comment_list,this)),this.$el.on("vclick","[name=document_action]",e.proxy(this.actApprAction,this)),this.$el.on("vclick","#act_list",e.proxy(this.actList,this)),this.$el.on("vclick","#more_btn",e.proxy(this.moreLayout,this)),this.$el.on("click","#act_draft",e.proxy(this.actDraft,this)),this.$el.on("click","#reassignReceiver",e.proxy(this.reassignReceiver,this)),this.$el.on("click","#act_tempsave",e.proxy(this.actTempSave,this)),this.$el.on("click","#act_reapply",e.proxy(this.actReapply,this))},render:function(){return this.unbindEvent(),this.bindEvent(),this.getUseMenus()},getUseMenus:function(){function i(){t.inHold||n.push(o.\ubcf4\ub958),s(o.\uacb0\uc7ac\uc815\ubcf4)}function s(t){n=_.without(n,t),n.push(e.extend(_.clone(t),{inMoreBtn:!0}))}var t=this.makeActionControll(),n=[];return t.isCreate||t.tempSave?(n.push(o.\ubbf8\ub9ac\ubcf4\uae30),n.push(o.\uacb0\uc7ac\uc815\ubcf4),this.isDraftable&&n.push(o.\uacb0\uc7ac\uc694\uccad),n.push(o.\ubcf8\ubb38),n.push(o.\ubb38\uc11c\uc815\ubcf4),n):(n.push(e.extend(o.\ub313\uae00,{commentsCount:this.commentsCount})),n.push(o.\uacb0\uc7ac\uc815\ubcf4),t.complete||(t.isActivityUser&&(t.tempSave&&(t.isReceptionDocument||n.push(o.\uc0ad\uc81c)),t.inApproval&&(n.push(o.\ubc18\ub824),n.push(o.\uacb0\uc7ac_Approved),i()),t.inDraft&&n.push(o.\uc0c1\uc2e0\ucde8\uc18c),t.inPostApproval&&n.push(o.\ud6c4\uacb0),t.inPostCheck&&n.push(o.\ud6c4\uc5f4),t.inRecovery&&(t.latestCompletedActionisApproval?n.push(o.\uacb0\uc7ac\ucde8\uc18c):n.push({id:"actWithdrawal",name:"document_action",text:t.latestCompletedActionName+r["\ucde8\uc18c"]})),t.inAgree&&(n.push(o.\ubc18\ub300),n.push(o.\ud569\uc758),i()),t.inCheck&&(n.push(o.\ubc18\ub824),n.push(o.\ud655\uc778),i()),t.inInspection&&(t.inInspectionReturn&&n.push(o.\ubc18\ub824),n.push(o.\uacb0\uc7ac_Inspected),i()),t.inAdvApproval&&n.push(o.\uc120\uacb0\uc7ac)),t.isReceivable&&(n.push(o.\ub2f4\ub2f9\uc790\uc9c0\uc815),n.push(o.\uc811\uc218),s(o.\uacb0\uc7ac\uc815\ubcf4),n.push(o.\ubc18\uc1a1)),t.isRereceivable&&(n.push(o.\uc7ac\uc811\uc218),n.push(o.\ubc18\uc1a1)),t.isReceived&&t.isAllowCancelReceive&&(t.isDeletedDeptRcvDoc?n.push(o.\uc811\uc218\ucde8\uc18c\ud6c4\ubc18\uc1a1):n.push(o.\uc811\uc218\ucde8\uc18c),n.push(o.\uacb0\uc7ac\uc694\uccad),s(o.\uacb0\uc7ac\uc815\ubcf4)),t.completeAddReceive&&(t.isReceptionDocument||n.push(o.\uc218\uc2e0\uc790\ucd94\uac00))),t.isActivityUser&&!t.isReceptionDocument&&this.isDraftable&&(t.completeDraft||t.returnDraft)&&n.push(o.\uc7ac\uae30\uc548),n.push(o.\ubcf8\ubb38),n.push(o.\ubb38\uc11c\uc815\ubcf4),n)},actApprAction:function(t){e(t.currentTarget).parents().find("#more_layout").hide(),this.trigger(e(t.currentTarget).attr("id"))},makeActionControll:function(){return{isCreate:this.getCreate(),tempSave:this.getTempSave(),isActivityUser:this.toolbarModel.isActivityUser,inApproval:this.getInApproval(),inHold:this.getInHold(),inDraft:this.getInApproval()?!1:this.getInDraft(),inAgree:this.getInAgree(),inCheck:this.getInCheck(),inInspection:this.getInInspection(),inInspectionReturn:this.getInInspectionReturn(),inRecovery:this.getInRecovery(),inAdvApproval:this.getInAdvApproval(),inPostCheck:this.getInPostCheck(),inPostApproval:this.getInPostApproval(),completeEtc:this.getCompleteEtc(),completeDraft:this.getCompleteDraft(),returnDraft:this.getReturnDraft(),isReceived:this.toolbarModel.isReceived,isReceivable:this.toolbarModel.isReceivable,isAllowCancelReceive:this.toolbarModel.isAllowCancelReceive,isReceptionDocument:this.isReceptionDocument,isDeletedDeptRcvDoc:this.isDeletedDeptRcvDoc,isRereceivable:this.toolbarModel.isRereceivable,completeAddReceive:this.getCompleteAddReceive(),completeRefer:!1,completeRead:!1,arbitraryDecision:this.toolbarModel.isArbitraryDecisionabled,arbitraryDecisionDocument:this.toolbarModel.isArbitraryDecisionDocument,inArbitraryDecisionDocument:this.getInArbitraryDecisionDocument(),lastActivityUser:this.toolbarModel.isLastActivityUser,isDocumentEditable:this.toolbarModel.isDocumentEditable,complete:this.getCheckComplete(),latestCompletedActionisApproval:this.toolbarModel.latestCompleteAction=="APPROVAL"?!0:!1,latestCompletedActionName:this.toolbarModel.latestCompleteActionName}},selectDocInfo:function(t){var n=e(t.currentTarget).find("option:selected").val();this.changeDocLayer(n)},changeDocLayer:function(t){var n=e("#selectDocInfo").find("option[value='"+t+"']").text();e("#selectDocInfo").closest("a").find("span.txt").text(n),e("#selectDocInfo").find('option[value="'+t+'"]').prop("selected",!0);switch(t){case"show_apprflow_list":this.trigger("show_apprflow_list");break;case"show_doc_info":this.trigger("show_doc_info");break;default:this.trigger("show_document")}},changeViewType:function(t){this.toggleMoreLayout(e(t.currentTarget).parents().find("div.array_option"));var n=e(t.currentTarget).attr("id");this.trigger(n)},show_comment_list:function(e){e.preventDefault(),e.stopPropagation(),this.trigger("show_comment_list")},show_activity_comment_list:function(e){e.preventDefault(),e.stopPropagation(),this.changeDocLayer("show_apprflow_list")},getCreate:function(){return this.docStatus=="CREATE"?!0:!1},getTempSave:function(){return this.docStatus=="TEMPSAVE"&&this.userId==this.drafterId?!0:!1},getInApproval:function(){return this.docStatus=="INPROGRESS"&&this.toolbarModel.isApprovalWaitingUser?!0:!1},getInHold:function(){return this.toolbarModel.useHold?this.docStatus=="INPROGRESS"&&this.toolbarModel.isActivityHoldingUser||this.toolbarModel.isApprovalDeputy||this.toolbarModel.isAgreementDeputy||this.toolbarModel.isCheckDeputy||this.toolbarModel.isInspectionDeputy?!0:!1:!0},getInAdvApproval:function(){return this.docStatus=="INPROGRESS"&&this.toolbarModel.isApprovalUpcommingUser&&this.toolbarModel.useAdvApproval?!0:!1},getInAgree:function(){return this.docStatus=="INPROGRESS"&&this.toolbarModel.isAgreementWaitingUser?!0:!1},getInCheck:function(){return this.docStatus=="INPROGRESS"&&this.toolbarModel.isCheckWaitingUser?!0:!1},getInInspection:function(){return this.docStatus=="INPROGRESS"&&this.toolbarModel.isInspectionWaitingUser?!0:!1},getInInspectionReturn:function(){return this.docStatus=="INPROGRESS"&&this.toolbarModel.isInspectionWaitingUser&&this.toolbarModel.useInspectionReturn?!0:!1},getCompleteEtc:function(){return this.docStatus=="COMPLETE"&&this.userId!=this.drafterId&&this.toolbarModel.isActivityUser?!0:!1},getCompleteDraft:function(){return this.docStatus=="COMPLETE"&&this.userId==this.drafterId?!0:!1},getReturnDraft:function(){return this.docStatus=="RETURN"&&this.userId==this.drafterId?!0:!1},getReturnAfterReception:function(){return this.docStatus=="RETURN"&&this.isReceptionDocument?!0:!1},getCompleteAddReceive:function(){return this.docStatus=="COMPLETE"&&this.toolbarModel.isReceiptAddReader?!0:!1},getInDraft:function(){return this.docStatus=="INPROGRESS"&&this.userId==this.drafterId&&this.toolbarModel.isJustBeforeApprovalUser?!0:!1},getInRecovery:function(){return this.docStatus=="INPROGRESS"&&this.toolbarModel.latestCompleteAction!="DRAFT"&&this.toolbarModel.isJustBeforeApprovalUser&&this.checkIsDeputyActivity?!0:this.docStatus=="INPROGRESS"&&this.toolbarModel.latestCompleteAction!="DRAFT"&&this.toolbarModel.isBeforeParallelAgreemntUser&&this.checkIsDeputyActivity?!0:!1},getInPostApproval:function(){if(this.toolbarModel.isPostApprovalUser)return!0;!1},getInPostCheck:function(){if(this.toolbarModel.isPostCheckUser)return!0;!1},getInArbitraryDecisionDocument:function(){return this.docStatus=="INPROGRESS"&&this.toolbarModel.isArbitraryDecisionDocument?!0:!1},actList:function(e){e.preventDefault(),e.stopPropagation(),this.trigger("actList",e)},actDraft:function(e){e.preventDefault(),e.stopPropagation(),this.trigger("actDraft",e)},reassignReceiver:function(e){e.preventDefault(),e.stopPropagation(),this.trigger("reassignReceiver",e)},actTempSave:function(e){e.preventDefault(),e.stopPropagation(),this.trigger("actTempSave",e)},actReapply:function(e){e.preventDefault(),e.stopPropagation(),this.trigger("actReapply",e)},moreLayout:function(t){t.preventDefault(),t.stopPropagation();var n=e(t.currentTarget).parent().find("div.array_option");this.toggleMoreLayout(n)},toggleMoreLayout:function(e){e.is(":visible")?e.hide():e.show()},closeMoreLayout:function(t){var n=e(t.currentTarget).find("#more_layout");n.is(":visible")&&n.hide()},getCheckComplete:function(){return this.docStatus=="COMPLETE"&&!this.toolbarModel.isPostCheckUser&&!this.toolbarModel.isPostApprovalUser?!0:!1}});return u});