define(["jquery","underscore","backbone","app","views/mobile/layer_toolbar","approval/views/mobile/m_reference_doclist_item","approval/views/mobile/document/m_appr_company_folder_tree","approval/collections/draft_doclist","approval/collections/appr_doc_list","approval/collections/viewer_doclist","approval/collections/reception_doclist","approval/collections/dept_folder_doclist","approval/collections/send_doclist","approval/collections/user_folder_doclist","approval/collections/share_folder_doclist","approval/collections/company_doc_list","approval/views/mobile/m_pagination","hgn!approval/templates/mobile/m_doclist_empty","hgn!approval/templates/mobile/document/m_related_document_attach","i18n!nls/commons","i18n!approval/nls/approval","jquery.jstree","jquery.go-preloader"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w){var E={"\uc774\ub984":b["\uc774\ub984"],"\ubd80\uc11c\uba85":b["\ubd80\uc11c\uba85"],"\uc774\uba54\uc77c":b["\uc774\uba54\uc77c"],"\uac80\uc0c9":b["\uac80\uc0c9"],"\uac1c\uc778 \ubb38\uc11c\ud568":w["\uac1c\uc778 \ubb38\uc11c\ud568"],"\uae30\uc548 \ubb38\uc11c\ud568":w["\uae30\uc548 \ubb38\uc11c\ud568"],"\uacb0\uc7ac \ubb38\uc11c\ud568":w["\uacb0\uc7ac \ubb38\uc11c\ud568"],"\ucc38\uc870/\uc5f4\ub78c \ubb38\uc11c\ud568":w["\ucc38\uc870/\uc5f4\ub78c \ubb38\uc11c\ud568"],"\uc218\uc2e0 \ubb38\uc11c\ud568":w["\uc218\uc2e0 \ubb38\uc11c\ud568"],"\uae30\uc548 \uc644\ub8cc\ud568":w["\uae30\uc548 \uc644\ub8cc\ud568"],"\ubd80\uc11c \ucc38\uc870\ud568":w["\ubd80\uc11c \ucc38\uc870\ud568"],"\ubd80\uc11c \uc218\uc2e0\ud568":w["\ubd80\uc11c \uc218\uc2e0\ud568"],"\ubd80\uc11c \ubb38\uc11c\ud568":w["\ubd80\uc11c \ubb38\uc11c\ud568"],"\ubb38\uc11c\ubc88\ud638":w["\ubb38\uc11c\ubc88\ud638"],"\uacb0\uc7ac\uc120":w["\uacb0\uc7ac\uc120"],company_docfolder:w["\uc804\uc0ac \ubb38\uc11c\ud568"],send_docfolder:w["\ubc1c\uc1a1 \ubb38\uc11c\ud568"],added_docfolder:w["\ucd94\uac00\ub41c \ubb38\uc11c\ud568"],shared_docfolder:w["\uacf5\uc720\ub41c \ubb38\uc11c\ud568"],base_docfolder:w["\uae30\ubcf8 \ubb38\uc11c\ud568"],"\uacb0\uc7ac \ubb38\uc11c \ucca8\ubd80":w["\uacb0\uc7ac \ubb38\uc11c \ucca8\ubd80"],"\uac80\uc0c9\uc5b4\ub97c \uc785\ub825\ud574\uc8fc\uc138\uc694":b["\uac80\uc0c9\uc5b4\ub97c \uc785\ub825\ud574\uc8fc\uc138\uc694."],"\uacb0\uc7ac\uc591\uc2dd":w["\uacb0\uc7ac\uc591\uc2dd"],"\uc81c\ubaa9":b["\uc81c\ubaa9"],"\uac1c":b["\uac1c"],"\uae30\uc548\uc790":w["\uae30\uc548\uc790"],search_result:b["\uac80\uc0c9\uacb0\uacfc"],select:b["\uc120\ud0dd"]},S=n.Model.extend({url:"/api/approval/side"}),x=s.extend({isReadable:!1,events:function(){return t.extend({},s.prototype.events,{"click input:checkbox":"checkReadable"})},checkReadable:function(t){var n=this,i=e(t.currentTarget);if(!n.isReadable){var s=this.model.get("documentId");e.ajax({type:"GET",url:r.contextRoot+"api/approval/document/"+s+"/readable",success:function(){n.isReadable=!0},error:function(t){var r=JSON.parse(t.responseText);alert(r.message),e(i).prop("checked",!1),n.isReadable=!1}})}}}),T=n.View.extend({searchTreeView:null,formListView:null,initialize:function(n){e("html").scrollTop(0),this.options=n||{},this.layerToolbarView=i,this.isCheckboxVisible=t.isBoolean(n.isCheckboxVisible)?n.isCheckboxVisible:!1,this.collection=new u,this.collection.setType("complete"),this.collection.bind("reset",this.resetList,this),this.collection.setSort("latestActivityCompletedAt","DESC"),this.collection.fetch({statusCode:{403:function(){r.util.error("403")},404:function(){r.util.error("404",{msgCode:"400-common"})},500:function(){r.util.error("500")}}}),this.docuName=E["\uac1c\uc778 \ubb38\uc11c\ud568"],this.apprSideModel=new S,this.apprSideModel.fetch({async:!1})},events:{"change #clickRefSide":"clickRefSide","vclick #search_icon":"search","keydown #search_title":"searchEnter","vclick .btn_del_type1":"reset"},reset:function(t){e("html").scrollTop(0),e("#search_title").val(""),this.collection=new u,this.collection.setType("complete"),this.collection.setSort("latestActivityCompletedAt","DESC"),this.collection.fetch({success:e.proxy(function(e){this.resetList(e)},this),error:function(e,t,n){preloader.release(),r.util.toastMessage(t.responseText)},statusCode:{403:function(){r.util.error("403")},404:function(){r.util.error("404",{msgCode:"400-common"})},500:function(){r.util.error("500")}}})},selectPage:function(t){this.collection.setPageNo(t);var n=e.goPreloader();this.collection.fetch({beforeSend:function(){n.render()},success:e.proxy(function(e){this.resetList(e)},this)}).done(function(){console.info("done!!"),n.release()})},render:function(){this.layerToolbarView.render(this.options.toolBarData);var t=!1;this.apprSideModel.get("userFolders")&&(t=this.apprSideModel.get("userFolders").length>0);var n=!1;this.apprSideModel.get("sharedFoldersToUser")&&(n=this.apprSideModel.get("sharedFoldersToUser").length>0);var r=this.deptFoldersData(this.apprSideModel.get("deptFolders")),i=this.apprSideModel.toJSON();e.each(i.sharedFoldersToUser,function(e,t){t.folderType=="USER"?t.isfolderTypeUser=!0:t.isfolderTypeUser=!1});var s=y({lang:E,addedFolder:t,sharedFolder:n,apprSideData:i,dataset:r,docu_name:this.docuName});this.$el.html(s),e(".tb_doc_attach > tbody").html(g({lang:{doclist_empty:w["\ubb38\uc11c\uac00 \uc5c6\uc2b5\ub2c8\ub2e4."]}})),this.dropDownCompanyDocRender()},renderPages:function(){this.pageView=new m({pageInfo:this.collection.pageInfo()});var e=this.pageView.render().el;this.$el.find("div.paging br_no").remove(),this.pageView.bind("paging",this.selectPage,this),this.$el.find(".list_box.list_apprChk").append(e)},deptFoldersData:function(t){return t.length&&e.each(t,function(t,n){n.addedDeptFolder=n.deptFolders.length>0,n.sharedDocFolders&&n.sharedDocFolders.length>0?(n.sharedDeptFolder=!0,e.each(n.sharedDocFolders,function(e,t){t.deptId=n.deptId,t.isfolderTypeUser=t.folderType=="USER"})):n.sharedDeptFolder=!1}),t},dropDownCompanyDocRender:function(){this.companyDocTreeView=new o({isAdmin:!1,disabledSelect:!1,apiCommonUrl:"api/docfolder/sidetree/all",treeElementId:"companyDocTree"}),this.companyDocTreeView.render()},clickRefSide:function(t){var n=e(t.currentTarget).find("option:selected"),r=n.closest("optgroup"),i=r.attr("id");i=="userReference"?this.clickUserRefSide(n):i=="deptReference"?this.clickDeptRefSide(n):i=="companyDocSide"&&this.clickCompanyRefSide(n)},clickUserRefSide:function(t){var n=t,i=n.attr("data-type"),s=n.attr("data-navi")=="shareuserdoc"?"userfolder":"deptfolder",o={draft:new u,sign:new a,cc:new f,inbox:new l,send:new h,userFolder:new p({folderId:n.attr("data-id")}),sharedFolder:new d({folderId:n.attr("data-id"),deptId:n.attr("data-deptid"),type:s,belong:n.attr("data-belong")})};this.collection=o[i],i!="sharedFolder"&&this.collection.setType("complete"),i=="cc"?this.collection.setSort("document.latestActivityCompletedAt","DESC"):this.collection.setSort("latestActivityCompletedAt","DESC");var c=e.goPreloader();c.render(),this.collection.bind("reset",this.resetList,this),this.collection.fetch({statusCode:{403:function(){r.util.error("403")},404:function(){r.util.error("404",{msgCode:"400-common"})},500:function(){r.util.error("500")}}}).done(function(){c.release()})},clickDeptRefSide:function(t){var n=t,i=n.attr("data-type"),s=n.attr("data-deptid"),o=n.attr("data-folderId"),u=n.attr("data-navi")=="shareuserdoc"?"userfolder":"deptfolder",a={draft:new c({deptId:s,type:"deptdraft"}),cc:new c({deptId:s,type:"deptreference",status:"complete"}),inbox:new l("complete",s),folder:new c({folderId:o,deptId:s,type:"deptfolder"}),sharedFolder:new d({folderId:o,deptId:s,type:u,belong:n.attr("data-belong")})};this.collection=a[i];var f=e.goPreloader();i=="cc"?this.collection.setSort("document.latestActivityCompletedAt","DESC"):this.collection.setSort("latestActivityCompletedAt","DESC"),this.collection.bind("reset",this.resetList,this),this.collection.fetch({beforeSend:function(){f.render()},statusCode:{403:function(){r.util.error("403")},404:function(){r.util.error("404",{msgCode:"400-common"})},500:function(){r.util.error("500")}}}).done(function(){console.info("done!!"),f.release()})},clickCompanyRefSide:function(t){var n=t,i=n.attr("data-id"),s=new v;s.setFolderId(i),this.collection=s,this.collection.setSort("latestActivityCompletedAt","DESC");var o=e.goPreloader();o.render(),this.collection.bind("reset",this.resetList,this),this.collection.fetch({statusCode:{403:function(){r.util.error("403")},404:function(){r.util.error("404",{msgCode:"400-common"})},500:function(){r.util.error("500")}}}).done(function(){o.release()})},resetList:function(t){e(".docu_list > ul").empty(),e(".docu_name").text(e("#clickRefSide option:selected").parent().attr("label"));var n=this.isCheckboxVisible;t.each(function(t){var r=new x({model:t,isShowUrl:!1,isCheckboxVisible:n,isRelateDocumentItem:!0});e(".docu_list > ul").append(r.render().el)}),t.length==0&&e(".docu_list > ul").html(g({lang:{doclist_empty:w["\ubb38\uc11c\uac00 \uc5c6\uc2b5\ub2c8\ub2e4."]}})),t.length!=0&&this.renderPages()},search:function(){var t=this.$el.find("#search_title"),n=this.$el.find("#referenceSearchType").val();this.collection.setSearch(n,t.val()),this.collection.fetch({success:e.proxy(function(e){this.resetList(e)},this)})},searchEnter:function(e){e.keyCode=="13"&&this.search()},release:function(){this.$el.off(),this.$el.empty()}});return T});