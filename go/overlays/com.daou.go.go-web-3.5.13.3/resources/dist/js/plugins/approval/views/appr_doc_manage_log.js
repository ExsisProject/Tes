define(["jquery","underscore","backbone","app","calendar/libs/util","collections/paginated_collection","approval/views/content_top","views/pagination","views/pagesize","approval/views/doclist/loglist_item","approval/models/loglist_item","hgn!approval/templates/doclist_search_null","hgn!approval/templates/appr_doc_manage_log","i18n!nls/commons","i18n!admin/nls/admin","i18n!approval/nls/approval","jquery.go-popup","jquery.ui"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v){var m=null,g={"\uac80\uc0c9 \uae30\uac04":v["\uac80\uc0c9 \uae30\uac04"],"\uad00\ub9ac\uc790":d["\uad00\ub9ac\uc790"],"\uae30\uc548\uc790":v["\uae30\uc548\uc790"],"\ubb38\uc11c\uba85":v["\ubb38\uc11c\uba85"],"\uc791\uc5c5\uad6c\ubd84":v["\uc791\uc5c5\uad6c\ubd84"],"\uc804\uccb4":v["\uc804\uccb4"],"\ubaa9\ub85d":v["\ubaa9\ub85d"],"\uc870\ud68c":v["\uc870\ud68c"],"\ub0b4\uc6a9 \uc218\uc815":v["\ub0b4\uc6a9 \uc218\uc815"],"\uacb0\uc7ac\uc120 \uc218\uc815":v["\uacb0\uc7ac\uc120 \uc218\uc815"],"\uac15\uc81c\ubc18\ub824":v["\uac15\uc81c\ubc18\ub824"],"\uc0ad\uc81c":v["\uc0ad\uc81c"],"\uc774\ub984":v["\uc774\ub984"],"\uc9c1\uc704":v["\uc9c1\uc704"],"\uac80\uc0c9":p["\uac80\uc0c9"],"\uac15\uc81c\ubc18\uc1a1":v["\uac15\uc81c\ubc18\uc1a1"],"\uc811\uc218\ucde8\uc18c":v["\uc811\uc218\ucde8\uc18c"]},y=s.extend({model:l,url:function(){return r.contextRoot+"api/approval/managelog"+"?"+e.param({startAt:this.startAt,endAt:this.endAt,accessUserName:this.accessUserName,accessTypes:this.accessTypes,page:this.pageNo,offset:this.pageSize,property:this.property,direction:this.direction})},fetch:function(n){typeof n!="undefined"||(n={});var r=this,i=n.beforeSend;t.isFunction(i)||(m=e.goPreloader(),m.render());var o=n.complete;return n.complete=function(e){m!=null&&m.release(),t.isFunction(o)&&o(r,e)},s.prototype.fetch.call(this,n)},setInit:function(e,t){this.startAt=r.util.toISO8601(r.util.toMoment(r.util.now().format("YYYY-MM-DD"))),this.endAt=r.util.toISO8601(r.util.searchEndDate(r.util.shortDate(r.util.now().format("YYYY-MM-DD")))),this.property=e,this.direction=t,this.pageNo=0},setSort:function(e,t){this.property=e,this.direction=t,this.pageNo=0},setSearch:function(e,t,n,r,i,s){this.startAt=e,this.endAt=t,this.accessUserName=n,this.accessTypes=r,this.property=i?i:this.property,this.direction=s?s:this.direction,this.pageNo=0},setListParam:function(){this.pageNo=sessionStorage.getItem("list-history-pageNo"),this.pageSize=sessionStorage.getItem("list-history-pageSize"),this.property=sessionStorage.getItem("list-history-property"),this.direction=sessionStorage.getItem("list-history-direction")},setAccessTypes:function(e){this.accessTypes=e}}),b=n.View.extend({el:"#content",columns:{"\uae30\uc548\uc790":v["\uc81c\ubaa9"],"\ubb38\uc11c\uba85":v["\ubb38\uc11c\uba85"],"\uc77c\uc2dc":v["\uc77c\uc2dc"],"\uc791\uc5c5\uad6c\ubd84":v["\uc791\uc5c5\uad6c\ubd84"],"\uc774\ub984":v["\uc774\ub984"],"\uae30\uc548\uc790":v["\uae30\uc548\uc790"],"\uacb0\uc7ac\uc591\uc2dd":v["\uacb0\uc7ac\uc591\uc2dd"],count:6},initialize:function(e){this.options=e||{},t.bindAll(this,"render","renderPageSize","renderPages"),this.contentTop=o.getInstance(),this.collection=new y,this.initProperty="accessAt",this.initDirection="desc";var n=sessionStorage.getItem("list-history-baseUrl");n&&n=="approval/managelog"?(this.initProperty=sessionStorage.getItem("list-history-property"),this.initDirection=sessionStorage.getItem("list-history-direction"),this.collection.setListParam()):this.collection.setInit(this.initProperty,this.initDirection),sessionStorage.clear(),this.collection.bind("reset",this.resetList,this)},events:{"click input:checkbox":"toggleCheckbox","click .sorting":"sort","click .sorting_desc":"sort","click .sorting_asc":"sort","click a#btn_search_manage_log":"docManageLogSearch"},_initDate:function(){e.datepicker.setDefaults(e.datepicker.regional[r.config("locale")]);var t=this.$el.find("#startDate"),n=this.$el.find("#endDate");return this.$el.find("#startDate").val(r.util.now().format("YYYY-MM-DD")),this.$el.find("#endDate").val(r.util.now().format("YYYY-MM-DD")),t.datepicker({dateFormat:"yy-mm-dd",changeMonth:!0,changeYear:!0,yearSuffix:"",onClose:function(e){n.datepicker("option","minDate",e)}}),n.datepicker({dateFormat:"yy-mm-dd",changeMonth:!0,changeYear:!0,yearSuffix:"",minDate:t.val()}),this},toggleCheckbox:function(t){if(e(t.currentTarget).attr("name")=="allCheck"){var n=this.$el.find("#allCheck").is(":checked");e('input[type="checkbox"][name="list"]').attr("checked",n),e('input[type="checkbox"][name="view"]').attr("checked",n),e('input[type="checkbox"][name="bodymodify"]').attr("checked",n),e('input[type="checkbox"][name="flowmodify"]').attr("checked",n),e('input[type="checkbox"][name="forcereturn"]').attr("checked",n),e('input[type="checkbox"][name="forcerecvreturned"]').attr("checked",n),e('input[type="checkbox"][name="withdraw"]').attr("checked",n),e('input[type="checkbox"][name="delete"]').attr("checked",n)}else{var n=e(t.currentTarget).is(":checked");e(t.currentTarget).attr("checked",n),n||this.$el.find("#allCheck").attr("checked",!1)}},render:function(t){return this.$el.empty(),this.$el.html(h({lang:g,columns:this.columns})),this._initDate(),this.contentTop.setTitle(v["\uad00\ub9ac\uc790 \uc791\uc5c5\uae30\ub85d"]),this.contentTop.render(),this.$el.find("header.content_top").replaceWith(this.contentTop.el),this.renderPageSize(),e(".list_manager_record > tbody").html(c({columns:this.columns,lang:{doclist_empty:v["\uac80\uc0c9\uc5b4 \uad6c\ubd84\uc744 \uc120\ud0dd\ud574\uc8fc\uc138\uc694."]}})),this.$el.find("#allCheck").attr("checked",!0),this.$el.find("#list").attr("checked",!0),this.$el.find("#view").attr("checked",!0),this.$el.find("#bodymodify").attr("checked",!0),this.$el.find("#flowmodify").attr("checked",!0),this.$el.find("#forcereturn").attr("checked",!0),this.$el.find("#forcerecvreturned").attr("checked",!0),this.$el.find("#withdraw").attr("checked",!0),this.$el.find("#delete").attr("checked",!0),this.collection.setAccessTypes(["LIST"]),this.$el},renderPageSize:function(){this.pageSizeView=new a({pageSize:this.collection.pageSize}),this.pageSizeView.render(),this.pageSizeView.bind("changePageSize",this.selectPageSize,this)},renderPages:function(){this.pageView=new u({pageInfo:this.collection.pageInfo()}),this.pageView.bind("paging",this.selectPage,this),this.$el.find("div.tool_absolute > div.dataTables_paginate").remove(),this.$el.find("div.tool_absolute").append(this.pageView.render().el)},resetList:function(t){var n=this.collection.url().replace("/api/",""),i=r.router.getUrl();i.indexOf("?")<0?r.router.navigate(n,{replace:!0}):i!=n&&r.router.navigate(n,{trigger:!1,pushState:!0}),e(".list_manager_record > tbody").empty();var s=this.columns,o="approval/managelog";t.each(function(t){var n=new f({model:t,listType:o,columns:s});e(".list_manager_record > tbody").append(n.render().el)}),t.length==0&&e(".list_manager_record > tbody").html(c({columns:this.columns,lang:{doclist_empty:v["\uac80\uc0c9 \ub41c \ubb38\uc11c\uac00 \uc5c6\uc2b5\ub2c8\ub2e4."]}})),this.renderPages()},selectPage:function(e){this.collection.setPageNo(e),this.collection.fetch()},selectPageSize:function(e){this.collection.setPageSize(e),this.collection.fetch()},setInitSort:function(t,n){var r=null,i=this.$el.find("th");i.each(function(){e(this).attr("sort-id")==t&&(r=e(this).attr("id")),e(this).hasClass("sorting_disabled")||(e(this).removeClass("sorting").addClass("sorting"),e(this).removeClass("sorting_desc").addClass("sorting"),e(this).removeClass("sorting_asc").addClass("sorting"))}),e("#"+r).removeClass("sorting").addClass("sorting_"+n)},sort:function(t){var n="#"+e(t.currentTarget).attr("id"),r=e(n).attr("sort-id"),i="desc",s="",o="";e(n).hasClass("sorting")&&(s="sorting",o="sorting_desc"),e(n).hasClass("sorting_desc")&&(s="sorting_desc",o="sorting_asc",i="asc"),e(n).hasClass("sorting_asc")&&(s="sorting_asc",o="sorting_desc"),e(n).removeClass(s).addClass(o);var u=this.$el.find("th");u.each(function(){!e(this).hasClass("sorting_disabled")&&"#"+e(this).attr("id")!=n&&(e(this).removeClass("sorting").addClass("sorting"),e(this).removeClass("sorting_desc").addClass("sorting"),e(this).removeClass("sorting_asc").addClass("sorting"))}),this.collection.setSort(r,i),this.collection.fetch()},docManageLogSearch:function(t){this.accessUserName=e.trim(e("#accessUserName").val());var n=r.util.toISO8601(r.util.toMoment(e("#startDate").val())),i=r.util.toISO8601(r.util.toMoment(e("#endDate").val()).add("days",1).subtract("seconds",1)),s=[],o=!1;e("input[type=checkbox]").each(function(){this.checked&&(o=!0)});if(!o){e.goError(v["\uc791\uc5c5 \uad6c\ubd84\uc744 \uc120\ud0dd\ud574\uc8fc\uc138\uc694."]);return}e("#list").attr("checked")&&s.push("LIST"),e("#view").attr("checked")&&s.push("VIEW"),e("#bodymodify").attr("checked")&&s.push("BODYMODIFY"),e("#flowmodify").attr("checked")&&s.push("FLOWMODIFY"),e("#forcereturn").attr("checked")&&s.push("FORCERETURN"),e("#forcerecvreturned").attr("checked")&&s.push("FORCERECVRETURNED"),e("#withdraw").attr("checked")&&s.push("WITHDRAW"),e("#delete").attr("checked")&&s.push("DELETE"),s.join(","),this.collection.setSearch(n,i,this.accessUserName,s,this.initProperty,this.initDirection),this.setInitSort(this.initProperty,this.initDirection),this.collection.fetch()},release:function(){this.$el.off(),this.$el.empty()}});return b});