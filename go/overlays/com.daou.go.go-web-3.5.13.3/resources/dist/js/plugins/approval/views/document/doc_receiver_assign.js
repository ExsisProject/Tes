define(["jquery","underscore","backbone","app","hgn!approval/templates/document/doc_receive","i18n!nls/commons","i18n!admin/nls/admin","i18n!approval/nls/approval","jquery.go-sdk","jquery.jstree","jquery.go-popup","jquery.go-grid","jquery.go-orgtab","jquery.go-validation","jquery.go-orgslide"],function(e,t,n,r,i,s,o,u){var a=n.Model.extend({defaults:{id:0,deptId:0},initialize:function(e){this.docId=e},url:function(){return"/api/approval/document/"+this.docId+"/receiver"}}),f=n.View.extend({el:".layer_normal .content",initialize:function(e){this.type=e.type?e.type:"normal",this.docIds=e.docIds,this.docId=e.docId,this.receivedDocOwnerDeptId=e.receivedDocOwnerDeptId,this.receiverDeptId=e.receiverDeptId,this.receiverDeptName=e.receiverDeptName,this.receiverUserId=e.receiverUserId,this.receiverUserName=e.receiverUserName,this.receiverUserPositionName=e.receiverUserPositionName},render:function(t,n){var r=this._makeTemplate(),i=this;t.find(n).html(r.render()),i.receiverUserId&&this.renderReceiverTag({displayName:i.receiverUserName+" "+i.receiverUserPositionName}),t.find("#addBtnReceiver").on("click",e.proxy(this.showOrgTree,this))},renderReceiverTag:function(t){var n=Hogan.compile(["                <li>",'                    <span class="btn_wrap">','                        <span class="txt">'+t.displayName+"</span>","                    </span>","                </li>"].join("\n"));e("#receiverPopupArea").find("ul.name_tag li").not(".creat").remove(),e("#receiverPopupArea").find("ul.name_tag li.creat span.txt").text(s["\ubcc0\uacbd"]),e("#receiverPopupArea").find("ul.name_tag").prepend(n.render())},assignReceiver:function(t,n){if(!this.receiverUserId||!this.receiverDeptId)return e.goMessage(u["\ub2f4\ub2f9\uc790\ub97c \uc9c0\uc815\ud574\uc8fc\uc138\uc694"]),!1;if(this.type=="normal"){var r=(new a(this.docId)).save({id:this.receiverUserId,deptId:this.receiverDeptId});r.done(t).fail(n),this.slide&&this.slide.close()}else{var i=this;e.ajax(GO.contextRoot+"api/approval/document/bulkreceiver",{type:"PUT",contentType:"application/json",dataType:"json",data:JSON.stringify({docIds:i.docIds,approverUser:{id:i.receiverUserId,deptId:i.receiverDeptId}})}).done(function(e,n,r){t(e)}).fail(function(e,t,r){n(e)}),this.slide&&this.slide.close()}},showOrgTree:function(t){var n=this;this.slide=e.goOrgSlide({header:u["\ub2f4\ub2f9\uc790 \uc9c0\uc815"],desc:"",loadId:n.receivedDocOwnerDeptId,isOnlyOneMember:!0,isCustomType:!0,hideOrg:!1,target:t,zIndex:200,contextRoot:GO.config("contextRoot"),callback:function(e){n.renderReceiverTag(e),n.receiverUserId=e.id,n.receiverDeptId=e.deptId}})},_makeTemplate:function(){var e=this.type=="normal"?u["\uc218\uc2e0 \ubb38\uc11c \uc811\uc218\uc790 \uc9c0\uc815 \uac00\uc774\ub4dc"]:u["\ub2f4\ub2f9\uc790 \uc77c\uad04\uc9c0\uc815 \ud31d\uc5c5\uc124\uba85"];return Hogan.compile(['<p class="desc">'+e+"</p>","<br>",'<div id="receiverPopupArea">',"    <dl>","        <dt>"+u["\ub2f4\ub2f9\uc790"]+"</dt>","        <dd>",'            <ul class="name_tag">','                <li class="creat">','                    <span class="btn_wrap" id="addBtnReceiver">','                        <span class="ic_form ic_addlist"></span>','                        <span class="txt">'+u["\uc9c0\uc815"]+"</span>","                    </span>","                </li>","            </ul>","        </dd>","    </dl>","</div>"].join("\n"))},release:function(){this.$el.off(),this.$el.empty()}});return f});