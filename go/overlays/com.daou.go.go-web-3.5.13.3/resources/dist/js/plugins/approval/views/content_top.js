define(["jquery","underscore","backbone","app","approval/views/detail_search_layer","dashboard/views/search/detail_search_popup","hgn!templates/content_top","i18n!nls/commons","jquery.go-popup","jquery.placeholder"],function(e,t,n,r,i,s,o,u){var a=r.util.now().format("YYYY-MM-DD"),f=64,l={search:u["\uac80\uc0c9"],power_search:u["\uc0c1\uc138\uac80\uc0c9"],app_search:u["\uc571\uac80\uc0c9"],unified_search:u["\ud1b5\ud569\uac80\uc0c9"],detail:u["\uc0c1\uc138"],"use_search?":!0};return n.View.extend({tagName:"header",className:"content_top",title:"",searchUrl:"",rendered:!1,unbindEvent:function(){this.$el.off("click","#btn-search"),this.$el.off("click","#btn_DetailSearch"),this.$el.off("keydown","#search-keyword")},bindEvent:function(){this.$el.on("click","#btn-search",e.proxy(this.simpleSearch,this)),this.$el.on("click","#btn_DetailSearch",e.proxy(this.showDetailSearch,this)),this.$el.on("keydown","#search-keyword",e.proxy(this.bindKeyboardEvent,this))},initialize:function(e){this.options=e||{},this.rendered=!1,this.options.title&&this.setTitle(this.options.title),this.options.hasOwnProperty("use_search")||(this.options.use_search=!0)},render:function(){this.unbindEvent(),this.bindEvent();var e=decodeURIComponent(r.router.getSearch("keyword")||"");return this.$el.html(o(t.defaults({keyword:"",maxlength:f,"has_keyword?":!!e,"use_search?":this.options.use_search},l))),this.$el.find("input[placeholder]").placeholder(),this.renderTitle(),this.rendered=!0,this.setAppSearchTitle(),this.el},setTitle:function(e){return this.title=e,this.rendered&&this.renderTitle(),this},setAppSearchTitle:function(){var e=r.router.getUrl().indexOf("docfolder");e==-1?this.$el.find('#searchType option[value="appSearch"]').html(u["\uc804\uc790\uacb0\uc7ac"]):this.$el.find('#searchType option[value="appSearch"]').html(u["\uc804\uc0ac \ubb38\uc11c\ud568"])},renderTitle:function(){var e=this.title;return typeof e=="object"?/\[object HTML[a-zA-Z\-_]+Element\]/.test(e.toString())?this.$el.find("h1").empty().append(e):"render"in e&&e[render].call(obj):typeof e=="string"&&this.$el.find("h1").empty().html(e),this},simpleSearch:function(){this.searchUrl="",this.type="";var t=r.router.getUrl().indexOf("docfolder"),n=this.$el.find("#searchType").val();n=="totalSearch"?this.searchUrl="unified/search":t==-1?(this.searchUrl="approval/search",this.type="approval"):(this.searchUrl="docfolder/search",this.type="docfolder");var i=r.util.toISO8601("1970/01/01"),s=r.util.searchEndDate(r.util.shortDate(a)),o=this.$el.find("#search-keyword"),u=o.val(),f=[this.searchUrl,"?",r.util.jsonToQueryString({stype:"simple",type:this.type,keyword:e.trim(u),fromDate:i,toDate:s})].join("");return this.validate(e.trim(u))&&(n=="totalSearch"&&(f+="&offset=5",f+="&searchTerm=all"),r.router.navigate(f,!0)),this},bindKeyboardEvent:function(e){return e.which===13&&this.simpleSearch(),this},validate:function(t){var n=this;return t?t.length<2||t.length>64?(e.goMessage(r.i18n(u["0\uc790\uc774\uc0c1 0\uc774\ud558 \uc785\ub825\ud574\uc57c\ud569\ub2c8\ub2e4."],{arg1:"2",arg2:"64"})),n.$el.find("#search-keyword").focus(),!1):e.goValidation.isInValidEmailChar(t)?(e.goMessage(u["\uba54\uc77c \uc0ac\uc6a9 \ubd88\uac00 \ubb38\uc790"]),!1):!0:(e.goError(u["\uac80\uc0c9\uc5b4\ub97c \uc785\ub825\ud558\uc138\uc694."]),n.$el.find("#search-keyword").focus(),!1)},showDetailSearch:function(t){t.preventDefault();var n=e("#searchType").val();if(n!="appSearch"){this.detailPopup(t);return}var r=e(t.currentTarget),s=r.offset();return new i({offset:{top:parseInt(s.top+30,10),right:7}}),!1},detailPopup:function(t){var n=new s,i=e(t.currentTarget).offset();this.searchPopup=e.goSearch({modal:!0,header:u["\uc0c1\uc138\uac80\uc0c9"],offset:{top:parseInt(i.top+30,10),right:7},callback:function(){if(n.validate()){var e=["unified/search","?",r.util.jsonToQueryString(n.getSearchParam())].join("");r.router.navigate(e,{trigger:!0,pushState:!0})}}}),this.searchPopup.find(".content").html(n.el),n.render()}},{__instance__:null,getInstance:function(){return this.__instance__===null&&(this.__instance__=new this.prototype.constructor),this.__instance__}})});