define(["jquery","underscore","backbone","approval/models/official_preview","hgn!approval/templates/official_doc_receiver_list","hgn!approval/templates/official_doc_receiver_list_item","i18n!nls/commons","i18n!approval/nls/approval","i18n!nls/user"],function(e,t,n,r,i,s,o,u,a){var f={"\uc774\ub984":o["\uc774\ub984"],"\uc774\uba54\uc77c":o["\uc774\uba54\uc77c"],"\ud68c\uc0ac":a["\ud68c\uc0ac"],remove:o["\uc0ad\uc81c"],dept:u["\ubd80\uc11c"],line:u["\ub77c\uc778"],status:u["\uc0c1\ud0dc"],empty_msg:"\ub4f1\ub85d\ub41c \uc2dc\ud589\ubb38\uc774 \uc5c6\uc2b5\ub2c8\ub2e4.","\uc120\ud0dd":o["\uc120\ud0dd"],activityType:u["\ud0c0\uc785"],add:o["\ucd94\uac00"],"delete":o["\uc0ad\uc81c"],confirm:o["\ud655\uc778"],cancel:o["\ucde8\uc18c"],msg_not_deletable_status_activity:u["\uc0ad\uc81c\ud560 \uc218 \uc5c6\ub294 \uc0c1\ud0dc\uc758 \uacb0\uc7ac\uc790 \uc785\ub2c8\ub2e4."],msg_not_deletable_assigned_activity:u["\uc9c0\uc815 \uacb0\uc7ac\uc790\ub294 \uc0ad\uc81c\ud560 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4."],msg_save_success:o["\uc800\uc7a5\ub418\uc5c8\uc2b5\ub2c8\ub2e4."],"\ubc1c\uc2e0 \uba85\uc758":u["\ubc1c\uc2e0 \uba85\uc758"],"\uc9c1\uc778":u["\uc9c1\uc778"],"\uc2dc\ud589\ubb38":u["\uc2dc\ud589\ubb38"],"\uc2dc\ud589\ubb38 \ubcf4\uae30":u["\uc2dc\ud589\ubb38 \ubcf4\uae30"],"\uc2e0\uaddc \ubc1c\uc1a1":u["\uc2e0\uaddc \ubc1c\uc1a1"],"\uc2b9\uc778 \ub300\uae30":u["\uc2b9\uc778 \ub300\uae30"],"\ubc1c\uc1a1 \ub300\uae30":u["\ubc1c\uc1a1 \ub300\uae30"],"\ubc1c\uc1a1 \uc2e4\ud328":u["\ubc1c\uc1a1 \uc2e4\ud328"],"\ubc1c\uc1a1 \uc644\ub8cc":u["\ubc1c\uc1a1 \uc644\ub8cc"],"\ubc1c\uc1a1 \ucde8\uc18c":u["\ubc1c\uc1a1 \ucde8\uc18c"],"\ubc1c\uc1a1 \ubc18\ub824":u["\ubc1c\uc1a1 \ubc18\ub824"],"\uacb0\uc7ac \ubc18\ub824":u["\uacb0\uc7ac \ubc18\ub824"],"\uc5f4\uae30":o["\uc5f4\uae30"],"\ub2eb\uae30":o["\ub2eb\uae30"],"\uc758\uacac":u["\uc758\uacac"],"\ubb38\uc11c \ubcf4\uae30":u["\ubb38\uc11c \ubcf4\uae30"],"\uacf5\ubb38 \ubc1c\uc1a1 \uc2e4\ud328 \uba54\uc138\uc9c0":u["\uacf5\ubb38 \ubc1c\uc1a1 \uc2e4\ud328 \uba54\uc138\uc9c0"],emptyOfficialDocReceivers:u["\uacf5\ubb38\uc218\uc2e0\ucc98\ub85c \uc9c0\uc815\ub41c \uacf3\uc774 \uc5c6\uc2b5\ub2c8\ub2e4."]},l=n.Collection.extend({url:function(){return this.isAdmin?["/ad/api/approval/manage/document",this.docId,"officialdocreceiver"].join("/"):["/api/approval/document",this.docId,"officialdocreceiver"].join("/")},initialize:function(e){this.docId=e.docId,this.isAdmin=e.isAdmin}}),c=n.View.extend({tagName:"div",className:"list_approval_line_wrap",initialize:function(e){this.options=e||{},this.model=this.options.model,this.type=this.options.type,this.isAdmin=this.options.isAdmin||!1},events:{"click span[evt-role='appr-official-toggle']":"toggleList","click .showOfficial":"showOfficial","click a[evt-role='showOfficialComment']":"showOfficialComment"},render:function(){var e=this.model,n=e.get("asignedForm"),r=e.get("asignedForm")&&e.get("asignedForm").id,i=r?!0:!1,o=e.get("asignedSender"),u=e.get("asignedSender")&&e.get("asignedSender").id,a=u?!0:!1,l=e.get("asignedSign"),c=e.get("asignedSign")&&e.get("asignedSign").id,h=c?!0:!1,p=i||a||h,d=e.get("state")==="APPROVE",v=e.get("sentAt")?GO.util.basicDate(e.get("sentAt")):"",m=t.map(e.get("receivers"),function(e){return{company:e.company,name:e.name,email:e.email}}),g=t.isEmpty(this.model.get("comment"))?!1:!0,y=!1;e.get("state")==="APPROVE"&&t.findWhere(e.get("receivers"),{isSent:!1})&&(y=!0);var b=this.getGroupName(e.get("state"),y);return this.$el.html(s({lang:f,isApproved:d,isAdmin:this.isAdmin,sentAt:v,receivers:m,hasComment:g,hasActivities:m.length>0?!0:!1,failSent:y,groupName:b,asignedForm:n,asignedSender:o,asignedSign:l,formVisible:i,senderVisible:a,signVisible:h,dockedVisible:p,isOfficial:this.type==="official"})),this},showOfficialComment:function(t){e.goPopup({pclass:"layer_normal layer_approval",header:f["\uc758\uacac"],modal:!0,draggable:!0,allowPrevPopup:!0,width:500,contents:GO.util.unescapeHtml(this.model.get("comment")),buttons:[{btext:o["\ub2eb\uae30"],btype:"cancel"}]})},showOfficial:function(e){var t=this.model.get("id"),n=window.location.protocol+"//"+window.location.host+GO.contextRoot+"app/approval/official/"+t+"/popup";window.open(n,"","location=no, directories=no,resizable=yes,status=no,toolbar=no,menubar=no, width=1280,height=650,left=0, top=0, scrollbars=yes")},toggleList:function(t){var n=e(t.currentTarget),r=n.hasClass("ic_open_s")?!0:!1;r?n.removeClass("ic_open_s").addClass("ic_close_s"):n.removeClass("ic_close_s").addClass("ic_open_s"),this.$(".approval_line").toggle(!r)},getGroupName:function(e,t){if(e=="CREATE")return f["\uc2e0\uaddc \ubc1c\uc1a1"];if(e=="WAIT")return f["\uc2b9\uc778 \ub300\uae30"];if(e=="APPROVE")return t?f["\ubc1c\uc1a1 \uc2e4\ud328"]:f["\ubc1c\uc1a1 \uc644\ub8cc"];if(e=="CANCEL")return f["\ubc1c\uc1a1 \ucde8\uc18c"];if(e=="RETURN")return f["\ubc1c\uc1a1 \ubc18\ub824"];if(e=="DOC_RETURN")return f["\uacb0\uc7ac \ubc18\ub824"]}}),h=n.View.extend({tagName:"div",className:"aside_wrapper_body",initialize:function(e){this.isAdmin=!1,this.type=e.type||"",t.isBoolean(e.isAdmin)&&(this.isAdmin=e.isAdmin),this.docStatus=e.docStatus||"",e.dataList?(this.collection=new l(e.dataList),this.collectionInjected=!0):(this.collection=new l({isAdmin:this.isAdmin,docId:e.docId}),this.collectionInjected=!1)},render:function(){var e=this;return this.collectionInjected?e._renderList(this.collection):this.collection.fetch({success:function(t){e._renderList(t)}}),this},_renderList:function(e){var n=[],r=!1;e.each(function(e){(!t.isEqual(e.get("state"),"CREATE")||t.isEqual(this.docStatus,"INPROGRESS"))&&n.push(e),e.get("receivers")&&e.get("receivers").length>0&&(r=!0)},this);if(n.length<1||!r){var s=[];s.push('<ul class="list_line list_officialDoc">'),s.push('    <li class="inactive last" style="margin-left: 10px">{{lang.emptyOfficialDocReceivers}}</li>'),s.push("</ul>"),this.$el.html(Hogan.compile(s.join("")).render({lang:f}))}else this.$el.html(i({lang:f})),t.each(n,function(e){var t=new c({model:e,isAdmin:this.isAdmin,type:this.type});this.$el.append(t.render().el)},this)},show:function(){this.$el.show()},hide:function(){this.$el.hide()}});return h});