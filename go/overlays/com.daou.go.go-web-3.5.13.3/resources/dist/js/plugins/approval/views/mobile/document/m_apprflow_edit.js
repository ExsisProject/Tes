define(["jquery","backbone","app","approval/models/activity","approval/models/appr_flow","approval/collections/activities","approval/collections/appr_activity_groups","approval/views/mobile/document/m_apprflow_activity_groups","approval/views/mobile/document/m_apprflow_readers","views/mobile/layer_toolbar","hgn!approval/templates/mobile/document/m_apprflow_edit","i18n!nls/commons","i18n!approval/nls/approval"],function(e,t,n,r,i,s,o,u,a,f,l,c,h){var p={"\uacb0\uc7ac\uc120":h["\uacb0\uc7ac\uc120"],"\ucc38\uc870\uc790":h["\ucc38\uc870\uc790"],"\uc218\uc2e0\uc790":h["\uc218\uc2e0\uc790"],"\uc5f4\ub78c\uc790":h["\uc5f4\ub78c\uc790"]},d=t.View.extend({events:{"click #saveApprFlow":"saveApprFlow","click li[data-tabid]":"changeTab"},initialize:function(e){this.options=e||{},this.release(),this.docId=this.options.docId,this.toolBarData=this.options.toolBarData,this.model=this.options.model,this.docStatus=this.model.get("document").docStatus,this.actionCheck=this.model.get("actionCheck"),this.includeAgreement=this.model.get("docInfo").includeAgreement,this.isArbitraryCheckVisible=this.model.getActionCheck("isArbitraryCheckVisible"),this.isPermissibleArbitraryDecision=this.model.getActionCheck("isPermissibleArbitraryDecision"),this.apprAllowType="ALL",this.observer=_.extend({},t.Events),this.viewerType="",e.hasOwnProperty("viewerType")&&(this.viewerType=e.viewerType),e.hasOwnProperty("masterAuthModel")&&(this.masterAuthModel=e.masterAuthModel),_.isNull(this.model)&&(this.isNullGroup=!0),this.__disabled__=!this.editable()},render:function(){var t=this,n=function(){return typeof this.status!="undefined"&&this.status=="WAIT"&&!this.postCheck?!0:!1},r=this.status?!0:!1;this.layerToolbarView=f,this.layerToolbarView.render(this.toolBarData),this.activityGroups=this.getActivityGroups();var i=l({lang:p,actionCheck:this.actionCheck});this.$el.html(i);var s=new u({model:this.model,activityGroups:this.activityGroups,actionCheck:this.actionCheck,isArbitraryCheckVisible:this.isArbitraryCheckVisible,isPermissibleArbitraryDecision:this.isPermissibleArbitraryDecision,disable:this.__disabled__,includeAgreement:this.includeAgreement,apprAllowType:this.apprAllowType,isReceiveDoc:this.isReceiveDoc(),docStatus:this.docStatus,observer:this.observer});s.render(),e("#apprline").append(s.$el);if(this.actionCheck.referenceActive){var o=new a({readerCollection:"docReferenceReaders",model:this.model,observer:this.observer});e("#referer").append(o.render().$el)}if(this.actionCheck.receptionActive){var c=new a({readerCollection:"docReceptionReaders",model:this.model,observer:this.observer});e("#receiver").append(c.render().$el)}if(this.actionCheck.readerActive){var h=new a({readerCollection:"docReadingReaders",model:this.model,observer:this.observer});e("#reader").append(h.render().$el)}return this},saveApprFlow:function(){this.observer.trigger("saveApprFlowActivityGroups"),this.observer.trigger("saveApprFlowReaders"),this.model.trigger("sync"),this.model.trigger("add")},changeTab:function(t){var n=e(t.currentTarget),r=n.attr("data-tabid");n.closest("ul").find("li").removeClass("on"),n.addClass("on");var i=e("div.tab_content div.form_table");i.hide(),e("#"+r).show()},editable:function(){if(this.model.isStatusComplete()||this.model.isStatusReturned())return!1;var e=this.viewerType==="docmaster"||this.viewerType==="formadmin",t=this.masterAuthModel&&this.masterAuthModel.authWrite(),n=e&&t;return n||this.model.Permission.canEditApprLine()},isReceiveDoc:function(){var e=this.model.get("document");return e["apprStatus"]=="TEMPSAVE"&&e["docStatus"]=="RECEIVED"&&e["docType"]=="RECEIVE"},getActivityGroups:function(){return new o(this.model.apprFlowModel.get("activityGroups"))},getCurrentActivity:function(){return this.model.getCurrentActivity()},release:function(){this.$el.off(),this.$el.empty()}});return d});