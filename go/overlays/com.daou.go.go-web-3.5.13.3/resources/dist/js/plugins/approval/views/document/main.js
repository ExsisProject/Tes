define(["backbone","app","hgn!approval/templates/document/main","hgn!approval/templates/document/action_document","hgn!approval/templates/document/actcopy","hgn!approval/templates/add_org_member","approval/models/document","approval/models/appr_flow","approval/collections/appr_flows","approval/views/content_top","approval/views/doc_file_download","approval/views/document/toolbar","approval/views/document/document","approval/views/document/apprflow_editor","approval/views/document/apprflow","approval/views/document/doc_receive","approval/views/document/doc_receiver_assign","approval/views/document/doc_reception_dept_assign","approval/views/document/doc_foldertype","approval/views/document/docinfo","approval/views/document/dochistory","approval/views/document/reader_history_list","approval/views/document/reception_document_list","approval/views/document/official_doc_receiver_list","approval/views/document/doc_type_select","approval/views/document/dept_folder","approval/views/document/document_print","approval/views/document/post_regist","approval/views/side","approval/models/document_mail","approval/models/user_appr_config","approval/components/appr_form_integrator","i18n!nls/commons","i18n!approval/nls/approval","email_send_layer","when","formeditor","jquery.inputmask"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M,D,P,H,B){var j=1280,F=760,I=e.Model.extend({initialize:function(e){this.docId=e},url:function(){var e=["/api/approval/document",this.docId,"draft"].join("/");return e}}),q=o.extend({initialize:function(e,t){this.options=t||{},t.formId&&(this.formId=t.formId),t.deptId&&(this.deptId=t.deptId),t.deptFolderId&&(this.deptFolderId=t.deptFolderId),o.prototype.initialize.apply(this,arguments)},url:function(){var e={formId:this.formId,deptId:this.deptId};$.isNumeric(this.deptFolderId)&&(e.deptFolderId=this.deptFolderId);var t="/api/approval/document/new?"+$.param(e);return t},getShowUrl:function(){var e=this.deptId.split("?")[0],t=this.formId.split("?")[0];return"/approval/document/new/"+e+"/"+t},getFullShowUrl:function(){return window.location.protocol+"//"+window.location.host+GO.contextRoot+"app"+this.getShowUrl()}},{create:function(e,t,n){return new q({},{formId:e,deptId:t,deptFolderId:n})}}),R=o.extend({initialize:function(e,t){this.options=t||{},this.docId=this.options.docId,o.prototype.initialize.apply(this,arguments)},url:function(){var e="/api/approval/document/"+this.docId+"/reapply";return e},getShowUrl:function(){var e=this.docId.split("?")[0];return"/approval/document/"+e+"/reapply"},getFullShowUrl:function(){return window.location.protocol+"//"+window.location.host+GO.contextRoot+"app"+this.getShowUrl()}},{create:function(e){return new R({},{docId:e})}}),U=o.extend({initialize:function(e,t){this.options=t||{},this.docId=this.options.docId,this.refDocId=this.options.refDocId,o.prototype.initialize.apply(this,arguments)},url:function(){return["/api/approval/document",this.docId,"reference",this.refDocId].join("/")},getShowUrl:function(){return"/approval/document/"+this.refDocId},getFullShowUrl:function(){return window.location.protocol+"//"+window.location.host+GO.contextRoot+"app"+this.getShowUrl()}},{create:function(e,t){return new U({},{docId:e,refDocId:t})}}),z=o.extend({initialize:function(e,t){this.options=t||{},this.docId=this.options.docId,o.prototype.initialize.apply(this,arguments)},url:function(){var e="/api/approval/document/"+this.docId;return e},getShowUrl:function(){var e=typeof this.docId=="string"?this.docId.split("?")[0]:this.docId;return"/approval/document/"+e},getFullShowUrl:function(){return window.location.protocol+"//"+window.location.host+GO.contextRoot+"app"+this.getShowUrl()}},{create:function(e){return new z({},{docId:e})}}),W=e.Model.extend({url:function(){var e=["/api/approval/deptfolder/"+this.folderId+"/document"+"/add"].join("/");return e},setFolderId:function(e){this.folderId=e}}),X=e.Model.extend({initialize:function(e){this.docId=e},url:function(){var e=["/api/approval/document",this.docId].join("/");return e}}),V=e.Model.extend({initialize:function(e){this.docId=e},url:function(){var e=["/api/approval/document",this.docId,"approval"].join("/");return e}}),J=e.Model.extend({initialize:function(e){this.docId=e},url:function(){var e=["/api/approval/document",this.docId,"viewer"].join("/");return e}}),K=e.Model.extend({initialize:function(e,t){this.docId=e,this.deptId=t},url:function(){var e=["/api/approval/document",this.docId,"receptionreader",this.deptId].join("/");return e}}),Q=e.Model.extend({initialize:function(e){this.docId=e},url:function(){var e=["/api/approval/document",this.docId,"folder"].join("/");return e}}),G=e.Model.extend({validTypes:["receive","cancel","return","rereceive","receptioncancelandreturn"],initialize:function(e,t){_.contains(this.validTypes,t)?this.type=t:this.type="receive",this.docId=e},url:function(){var e="reception";switch(this.type){case"cancel":e="receptioncancel";break;case"return":e="receptionreturn";break;case"rereceive":e="rereception";break;case"receptioncancelandreturn":e="receptioncancelandreturn";break;default:}return["/api/approval/document",this.docId,e].join("/")}}),Y={"\uacb0\uc7ac\ubb38\uc11c\uba85":P["\uacb0\uc7ac\ubb38\uc11c\uba85"],"\uae30\uc548\uc790":P["\uae30\uc548\uc790"],"\uacb0\uc7ac\uc790":P["\uacb0\uc7ac\uc790"],"\uae30\uc548\uc758\uacac":P["\uae30\uc548\uc758\uacac"],"\uacb0\uc7ac\uc758\uacac":P["\uacb0\uc7ac\uc758\uacac"],"\uacb0\uc7ac\ube44\ubc00\ubc88\ud638":P["\uacb0\uc7ac\ube44\ubc00\ubc88\ud638"],"\uc804\uacb0":P["\uc804\uacb0"],"\uc804\uacb0\uc124\uba85":P["\uc804\uacb0\uc124\uba85"],"\uacb0\uc7ac\uc635\uc158":P["\uacb0\uc7ac\uc635\uc158"],"\uacb0\uc7ac\uc120":P["\uacb0\uc7ac\uc120"],"\ubb38\uc11c\uc815\ubcf4":P["\ubb38\uc11c\uc815\ubcf4"],"\ubcc0\uacbd\uc774\ub825":P["\ubcc0\uacbd\uc774\ub825"],"\uacf5\ubb38\ubc1c\uc1a1":P["\uacf5\ubb38\ubc1c\uc1a1"],"\uc5f4\ub78c\uc790 \ucd94\uac00":P["\uc5f4\ub78c\uc790 \ucd94\uac00"],"\uc758\uacac\uc744 \uc791\uc131\ud574 \uc8fc\uc138\uc694":P["\uc758\uacac\uc744 \uc791\uc131\ud574 \uc8fc\uc138\uc694"],"\ubaa9\ub85d\uc73c\ub85c \uc774\ub3d9\ud569\ub2c8\ub2e4":P["\ubaa9\ub85d\uc73c\ub85c \uc774\ub3d9\ud569\ub2c8\ub2e4"],"\ub2f4\ub2f9\uc790\ub97c \uc9c0\uc815\ud574\uc8fc\uc138\uc694":P["\ub2f4\ub2f9\uc790\ub97c \uc9c0\uc815\ud574\uc8fc\uc138\uc694"],"\ub2f4\ub2f9\uc790\uac00 \uc9c0\uc815\ub418\uc5c8\uc2b5\ub2c8\ub2e4":P["\ub2f4\ub2f9\uc790\uac00 \uc9c0\uc815\ub418\uc5c8\uc2b5\ub2c8\ub2e4"],"\ub2f4\ub2f9\uc790\ub97c \uc9c0\uc815\ud560 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4":P["\ub2f4\ub2f9\uc790\ub97c \uc9c0\uc815\ud560 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4"],"\ub2e4\uc74c\ubb38\uc11c\ub85c\uc774\ub3d9":P["\ub2e4\uc74c\ubb38\uc11c\ub85c\uc774\ub3d9"],"\ub2e4\uc74c\ubb38\uc11c\ub85c\uc774\ub3d9\uc124\uba85":P["\ub2e4\uc74c\ubb38\uc11c\ub85c\uc774\ub3d9\uc124\uba85"],"\ubc18\ub824\uc635\uc158":P["\ubc18\ub824\uc635\uc158"],"\ubc18\ub824\uc635\uc158\uc124\uba85":P["\ubc18\ub824\uc635\uc158\uc124\uba85"],"\uae34\uae09":P["\uae34\uae09"],"\uae34\uae09\ubb38\uc11c":P["\uae34\uae09\ubb38\uc11c"],"\uae34\uae09\ubb38\uc11c\uc124\uba85":P["\uae34\uae09\ubb38\uc11c\uc124\uba85"],"1\uc778 \uacb0\uc7ac \uc548\ub0b4\ubb38\uad6c":P["1\uc778 \uacb0\uc7ac \uc548\ub0b4\ubb38\uad6c"],"\uae30\uacb0\uc7ac\uc790\ud1b5\uacfc":P["\uae30\uacb0\uc7ac\uc790\ud1b5\uacfc"],"\uae30\uacb0\uc7ac\uc790\ud1b5\uacfc\uc124\uba85":P["\uae30\uacb0\uc7ac\uc790\ud1b5\uacfc\uc124\uba85"],"\uc5f4\ub78c\uae30\ub85d":P["\uc5f4\ub78c\uae30\ub85d"],"\uc218\uc2e0":P["\uc218\uc2e0"],"\uc218\uc2e0\ucc98 \uc9c0\uc815 \ud544\uc218 \uba54\uc138\uc9c0":P["\uc218\uc2e0\ucc98 \uc9c0\uc815 \ud544\uc218 \uba54\uc138\uc9c0"],"\uc218\uc2e0\ucc98 \uc9c0\uc815\ud558\uae30":P["\uc218\uc2e0\ucc98 \uc9c0\uc815\ud558\uae30"],"\uc774\uc804":D["\uc774\uc804"],"\ub2e4\uc74c":D["\ub2e4\uc74c"],"\uacb0\uc7ac\ubc29\uc804\uacb0\uc124\uba85":P["\uacb0\uc7ac\ubc29\uc804\uacb0\uc124\uba85"],"\uc804\uacb0\ucc38\uc870\uc790\ucd94\uac00":P["\uc804\uacb0\ucc38\uc870\uc790\ucd94\uac00"],"\ubc18\ub824 \uacb0\uc7ac \uc758\uacac \uc785\ub825\uc740 \ud544\uc218\uc785\ub2c8\ub2e4":P["\ubc18\ub824 \uacb0\uc7ac \uc758\uacac \uc785\ub825\uc740 \ud544\uc218\uc785\ub2c8\ub2e4"],"\ubc18\uc1a1 \uacb0\uc7ac \uc758\uacac \uc785\ub825\uc740 \ud544\uc218\uc785\ub2c8\ub2e4":P["\ubc18\uc1a1 \uacb0\uc7ac \uc758\uacac \uc785\ub825\uc740 \ud544\uc218\uc785\ub2c8\ub2e4"],"\ubc18\ub824\uacb0\uc7ac\uc758\uacac":P["\ubc18\ub824\uacb0\uc7ac\uc758\uacac"],"\ubc18\uc1a1\uacb0\uc7ac\uc758\uacac":P["\ubc18\uc1a1\uacb0\uc7ac\uc758\uacac"]},Z=!1,et=e.View.extend({el:"#content",initialize:function(e){this.options=e||{},this.formId=this.options.formId,this.deptId=this.options.deptId,this.deptFolderId=GO.util.getQueryParam("deptFolderId"),this.docId=this.options.docId,this.refDocId=this.options.refDocId,this.docType=this.options.docType,this.type=_.isUndefined(this.options.type)?"DOCUMENT":this.options.type,this.allowAction=!0,this.documentInit()},docInitError:function(e,t){var n=this,r=function(){n.options.isPopup?window.close():n.navigateToBackList()};$.goAlert(P["\uacb0\uc7ac\ubb38\uc11c\ub97c \uc5f4\ub78c\ud560 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4."],e,null,D["\ub2eb\uae30"],r)},showErrorAlert:function(e,t,n){var r=this,i=function(){r.options.isPopup?window.close():r.navigateToBackList()};$.goAlert(e,t,null,D["\ub2eb\uae30"],_.isFunction(n)?n:i)},documentInit:function(){var e=this;this.formIntegrator=new M,this.apprDocumentMailModel=new A({docId:this.docId}),this.type=="CREATE"?this.model=q.create(this.formId,this.deptId,this.deptFolderId):this.type=="REAPPLY"?this.model=R.create(this.docId):this.refDocId?this.model=U.create(this.docId,this.refDocId):this.model=z.create(this.docId),this.model.fetch({async:!1,success:function(t,n){e.title=_.escape(_.isUndefined(t.get("document").title)?t.get("document").formName:t.get("document").title),e.initDocument()},error:function(t,n){var r=D["500 \uc624\ub958\ud398\uc774\uc9c0 \ub0b4\uc6a9"];$.parseJSON(n.responseText).message&&(r=$.parseJSON(n.responseText).message),n.status==400&&e.docInitError(r),n.status==403&&e.docInitError(P["\uc870\ud68c\uad8c\ud55c\uc5c6\uc74c"]),n.status==404&&e.docInitError(r),n.status==500&&e.docInitError(r),n.status!=400&&n.status!=403&&n.status!=404&&n.status!=500&&e.docInitError(r)},reset:!0})},initDocument:function(){this.docId=this.model.get("document").documentId,this.isPublic=this.model.get("docInfo").isPublic,this.useHelp=this.model.get("docInfo").useHelp,this.formId=this.model.get("docInfo").formId,this.docType=this.model.get("document").docType,this.formIntegrator.setDocVariables(this.model.get("document").variables),this.formIntegrator.setStatus(this.type=="REAPPLY"?this.type:this.model.get("document").docStatus);var e=this.checkIsDeputyActivity();this.listenTo(this.model,"change",this.changeApprFlowAndDocInfo,this),this.usePassword=this.model.get("actionCheck").usePassword,this.autoSaveTime=this.model.get("userApprSetting").autoSaveTime,this.toolbarView=new c({type:this.type,toolbarModel:this.model.get("actionCheck"),docStatus:this.model.get("document").docStatus,userId:GO.session().id,drafterId:this.model.get("document").drafterId,isAgreement:this.checkIsAgreement(),isReceptionDocument:this.model.get("document").isReceptionDocument,isDeletedDeptRcvDoc:this.model.get("document").isDeletedDeptRcvDoc,isPublic:this.isPublic,checkIsDeputyActivity:e,isPopup:this.options.isPopup,useHelp:this.useHelp,formId:this.formId,docId:this.model.get("document").documentId,autoSaveTime:this.autoSaveTime}),this.toolbarView.bind("saved",this.saveDocument,this),this.toolbarView.bind("canceled",this.cancelEdit,this),this.toolbarView.bind("drafted",this.draftDocument,this),this.toolbarView.bind("deleted",this.deleteDocument,this),this.toolbarView.bind("tempSaved",this.tempSaveDocument,this),this.toolbarView.bind("tempAutoSaved",this.tempAutoSaveDocument,this),this.toolbarView.bind("storeAutoSaveTime",this.storeAutoSaveTime,this),this.toolbarView.bind("draftCanceled",this.cancelDraft,this),this.toolbarView.bind("approved",this.doApprove,this),this.toolbarView.bind("holded",this.doHold,this),this.toolbarView.bind("returned",this.doReturn,this),this.toolbarView.bind("agreed",this.doAgree,this),this.toolbarView.bind("disagreed",this.doDisagree,this),this.toolbarView.bind("checked",this.doCheck,this),this.toolbarView.bind("inspected",this.doInspection,this),this.toolbarView.bind("actAdvAppr",this.doAdvAppr,this),this.toolbarView.bind("actWithdrawal",this.actWithdrawal,this),this.toolbarView.bind("actDraftWithdrawal",this.actDraftWithdrawal,this),this.toolbarView.bind("actDraftWithdrawalInprogress",this.actDraftWithdrawalInprogress,this),this.toolbarView.bind("actDraftWithdrawalDraft",this.actDraftWithdrawalDraft,this),this.toolbarView.bind("actDraftWithdrawalCancelDraft",this.actDraftWithdrawalCancelDraft,this),this.toolbarView.bind("actReceive",this.actReceive,this),this.toolbarView.bind("actRereceive",this.actRereceive,this),this.toolbarView.bind("reassignReceiver",this.reassignReceiver,this),this.toolbarView.bind("cancelReception",this.cancelReception,this),this.toolbarView.bind("returnReception",this.returnReception,this),this.toolbarView.bind("deptFolderCopy",this.deptFolderCopy,this),this.toolbarView.bind("editApprFlow",this.editApprFlow,this),this.toolbarView.bind("edit",this.editDocument,this),this.toolbarView.bind("actPostCheck",this.actPostCheck,this),this.toolbarView.bind("actPostApproval",this.actPostApproval,this),this.toolbarView.bind("actAddFolder",this.actAddFolder,this),this.toolbarView.bind("generateActCopy",this.generateActCopy,this),this.toolbarView.bind("docPrint",this.docPrint,this),this.toolbarView.bind("downloadDocument",this.downloadDocument,this),this.toolbarView.bind("actReapply",this.reapplyDocument,this),this.toolbarView.bind("actList",this.navigateToBackList,this),this.toolbarView.bind("showSendMailLayer",this.showSendMailLayer,this),this.toolbarView.bind("showPostRegistLayer",this.showPostRegistLayer,this),this.toolbarView.bind("showPopup",this.showPopup,this),this.toolbarView.bind("documentPreview",this.documentPreview,this),this.toolbarView.bind("cancelAndReturnReception",this.cancelAndReturnReception,this),this.toolbarView.bind("reassignDept",this.reassignDept,this),this.documentView=new h({type:this.type,docId:this.model.get("document").documentId,model:this.model.get("document"),infoData:this.model.get("docInfo"),actionModel:this.model.get("actionCheck"),formIntegrator:this.formIntegrator,userApprSettingModel:this.model.get("userApprSetting"),isPopup:this.options.isPopup,isPreview:this.options.isPreview,originalDocId:this.model.docId,refDocId:this.model.refDocId}),this.apprFlowView=new d({type:this.type,docId:this.model.get("document").documentId,model:new u(this.model.get("apprFlow"))}),this.isReaderExist=this.model.get("docInfo").docReadingReaders.length>0?!0:!1,this.docInfoView=new b({type:this.type,docId:this.model.get("document").documentId,docStatus:this.model.get("document").docStatus,docInfoModel:this.model.get("docInfo"),actionModel:this.model.get("actionCheck"),isComplete:this.model.get("document").docStatus=="COMPLETE"?!0:!1,isActivityUser:this.model.get("actionCheck").isActivityUser,isReader:this.model.get("actionCheck").isReader,isReceptionDocument:this.model.get("document").isReceptionDocument,isPopup:this.options.isPopup}),this.docInfoView.bind("docTypeSelect",this.docTypeSelect,this),this.docInfoView.bind("docFolderSelect",this.docFolderSelect,this),this.docInfoView.bind("securityLevelSelect",this.securityLevelSelect,this),this.docInfoView.bind("docYearSelect",this.docYearSelect,this),this.docInfoView.bind("docReferenceSelect",this.docReferenceSelect,this),this.docInfoView.bind("docReceiveSelect",this.docReceiveSelect,this),this.docInfoView.bind("readingDeleteItem",this.readingDeleteItem,this),this.docInfoView.bind("showReadingOrgSlider",this.showReadingOrgSlider,this),this.docInfoView.bind("showReceptionOrgSlider",this.showReceptionOrgSlider,this),this.docInfoView.bind("saveDocReaderAndReception",this.saveDocReaderAndReception,this),this.docInfoView.bind("tempsavechangedept",this.tempSaveChangeDept,this),this.docHistoryView=new w({type:this.type,model:this.model}),this.docHistoryView.bind("showApprChangeLog",this.showApprChangeLog,this),this.readHistoryView=new E({docId:this.model.get("document").documentId,collection:this.model.get("readingHistory")}),this.receptionView=new S({docId:this.model.get("document").documentId,collection:this.model.get("receptionList")}),this.officialDocReceiverView=new x({dataList:this.model.get("docInfo").officialVersions,docStatus:this.model.get("document").docStatus,isAdmin:!1}),this.contentTop=f.getInstance();var t=['<span class="txt single_tit" title="',this.title,'">',this.title,"</span>"];this.type=="DOCUMENT"&&(t.push('<span class="meta">'),t.push('<span class="from">&nbsp;in '+this.model.get("document").formName+"</span>"),t.push("</span>"));if(this.model.get("document").docStatus=="CREATE"||this.model.get("document").docStatus=="TEMPSAVE"||this.model.get("document").docStatus=="POPUP")t.push('<span class="meta">'),t.push('<span id="processMessageWrap" class="num" style="display:none;">'),t.push('<strong id="processMessageContent"></strong>'),t.push("</span>"),t.push("</span>");this.contentTop.setTitle(t.join("")),GO.router.getPackageName()==="approval"&&this.docId!==sessionStorage.getItem("list-history-doc-id")&&(sessionStorage.getItem("list-history-baseUrl")=="approval/todoviewer/all"&&L.reload(),L.apprSelectSideMenu(sessionStorage.getItem("list-history-baseUrl")))},checkIsAgreement:function(){var e=null,t=this.model.get("apprFlow").activityGroups;for(var n=0;n<t.length;n++){var r=t[n].activities;for(var i=0;i<r.length;i++)r[i].actorId==GO.session().id&&(e=r[i].type)}return e=="AGREEMENT"?!0:!1},checkIsDeputyActivity:function(){var e=this.model.get("apprFlow").activityGroups;for(var t=0;t<e.length;t++){var n=e[t].activities;for(var r=0;r<n.length;r++)if(n[r].actorId==GO.session().id&&n[r].deputyActivity)return!1}return!0},events:{"click .tab_nav > li":"selectTab","click #prev":"_agoSlide","click #next":"_nxtSlide"},render:function(){this.setSlideConfig(),this.allowAction=!0;var e=this.model.get("document");if(e==null)return;var t=this.model.get("actionCheck");!t.isMatchDeptment&&e.docStatus=="TEMPSAVE"&&this.showErrorAlert(P["\uae30\uc548\uc790\uc640 \ud574\ub2f9 \ubb38\uc11c\uc758 \uae30\uc548 \ubd80\uc11c \uc815\ubcf4\uac00 \uc77c\uce58\ud558\uc9c0 \uc54a\uc544 \uae30\uc548(\uc811\uc218)\uc774 \ubd88\uac00\ub2a5\ud569\ub2c8\ub2e4"],P["\uacb0\uc7ac\ubb38\uc11c\ub97c \uc0c8\ub85c \uc791\uc131\ud574 \uc8fc\uc138\uc694."],function(){});if(t.isActCopy){var r=i({lang:{"\ubc1c\uc1a1":P["\ubc1c\uc1a1"],"\uc811\uc218":P["\uc811\uc218"],"\ucde8\uc18c":D["\ucde8\uc18c"],"\uc218\uc2e0\uc790 \ucd94\uac00":P["\uc218\uc2e0\uc790 \ucd94\uac00"],"\ubaa9\ub85d":D["\ubaa9\ub85d"],"\uc778\uc1c4":D["\uc778\uc1c4"],"\uc218\uc2e0\ucc98":P["\uc218\uc2e0\ucc98"],"\uc218\uc2e0\ucc98 \ucd94\uac00":P["\uc218\uc2e0\ucc98 \ucd94\uac00"],"\ubb38\uc11c\uc815\ubcf4":P["\ubb38\uc11c\uc815\ubcf4"],"\uc2dc\ud589\ubb38 \ubc1c\uc1a1":P["\uc2dc\ud589\ubb38 \ubc1c\uc1a1"],"\ubc1c\uc2e0\uc790":P["\ubc1c\uc2e0\uc790"],"\uc2dc\ud589\ubb38 \uc81c\ubaa9":P["\uc2dc\ud589\ubb38 \uc81c\ubaa9"],"\uc218\uc2e0\ucc98\ub97c \uc9c0\uc815\ud574\uc8fc\uc138\uc694":P["\uc218\uc2e0\ucc98\ub97c \uc9c0\uc815\ud574\uc8fc\uc138\uc694"],"\ubb38\uc11c\uc5f4\ub78c":P["\ubb38\uc11c\uc5f4\ub78c"],"\uc5f4\ub78c\uc790 \ucd94\uac00":P["\uc5f4\ub78c\uc790 \ucd94\uac00"],"\ubb38\uc11c\uc5f4\ub78c \uc800\uc7a5":P["\ubb38\uc11c\uc5f4\ub78c \uc800\uc7a5"],"\ubb38\uc11c\uc815\ubcf4 \uc800\uc7a5":P["\ubb38\uc11c\uc815\ubcf4 \uc800\uc7a5"]},dataset:e,infoData:this.model.get("docInfo"),action:t,isCompleteAddReceive:this.toolbarView.getCompleteAddReceive(),isActivityUser:this.model.get("actionCheck").isActivityUser,sender:this.getSender(this.model.get("apprFlow").activityGroups)});this.$el.html(r),this.$el.on("click","#act_receive",$.proxy(this.actReceive,this)),this.$el.on("click","#reassign_receiver",$.proxy(this.reassignReceiver,this)),this.$el.on("click","#cancelReception",$.proxy(this.cancelReception,this)),this.$el.on("click","#returnReception",$.proxy(this.returnReception,this)),this.$el.on("click","#reading",$.proxy(this.showReadingOrgSlider,this)),this.$el.on("click","#reception",$.proxy(this.showReceptionOrgSlider,this)),this.$el.on("click",".btnPrint",$.proxy(this.docPrint,this)),this.$el.on("click",".btnList",$.proxy(this.navigateToBackList,this)),this.contentTop.setTitle(e.title)}else{this.$el.html(n({lang:Y})),this.assign(this.toolbarView,"div.tool_bar"),this.assign(this.documentView,"div.approval_type"),this.append(this.apprFlowView,"div.doc-meta-container"),this.append(this.docInfoView,"div.doc-meta-container"),this.append(this.docHistoryView,"div.doc-meta-container"),this.append(this.readHistoryView,"div.doc-meta-container"),this.append(this.receptionView,"div.doc-meta-container"),this.append(this.officialDocReceiverView,"div.doc-meta-container"),this.type=="CREATE"||this.type=="REAPPLY"||this.type=="INTEGRATION"?($(".tab_nav > li").removeClass("on"),$(this.el).find("li#tab_apprflow").addClass("on"),$(this.el).find("li#tab_docinfo").addClass("last"),$(this.el).find("li#tab_dochistory").hide(),$(this.el).find("li#tab_readerhistory").hide(),$(this.el).find("li#tab_receptiondocument").hide(),$(this.el).find("li#tab_officialdocreceiver").hide(),this.displaySlideNavStyle(),this.showApprFlow(),this.documentView.setNewFormMode(),this.apprFlowView.makeApprFlow(this.model.get("apprFlow").activityGroups),this.setDocNum(""),this.docReceiveSelect(),this.docReferenceSelect(),this.docFolderSelect(this.isPublic)):(this.showApprFlow(),$(".tab_nav > li").removeClass("on"),$("#tab_apprflow").addClass("on")),this.useAutoApprFlow()&&(this.bindAutoFlowComponentEvent(),this.type=="CREATE"||this.type=="INTEGRATION"||this.type=="DOCUMENT"&&e.docStatus=="CREATE"?this.reSetApprFlowView():e.docStatus=="TEMPSAVE"&&e.docType=="DRAFT"&&GO.util.store.get("autoSetAppr")&&(this.reSetApprFlowView(),GO.util.store.set("autoSetAppr",null,{type:"session"}),this.tempSaveReload()));var s={preserveDuration:$("#docYear option:selected").text()||this.showPreserveYears(this.model.get("docInfo").docYear),securityLevel:$("#infoSecurityLevel option:selected").text()||this.model.get("docInfo").securityLevelName};this.documentView.setApprovalData(s),e.isDeletedDeptRcvDoc&&e.docStatus=="RECEIVED"&&$.goAlert(P["\ubb38\uc11c \uc218\uc2e0 \ubd80\uc11c\uac00 \uc0ad\uc81c \uc548\ub0b4"],"","",D["\ub2eb\uae30"],"")}if(!this.options.isPopup)this.contentTop.render(),this.$el.find("header.content_top").replaceWith(this.contentTop.el),t.companyDocFolderUseFlag||($("#companyDocFolderUse").hide(),$("#act_addFolder").hide());else if(this.options.isPreview){var o=window.opener.$("#document_content").data("instance");this.$el.find("header.content_top").remove();var u='<header id="toolbar" class="header_print">	<h1>'+D["\ubbf8\ub9ac\ubcf4\uae30"]+'		<span class="btn_wrap">'+'			<span class="btn_minor_s" id="printDoc" title="'+D["\uc778\uc1c4"]+'">'+'				<span class="ic_print"></span><span class="txt">'+D["\uc778\uc1c4"]+"</span>"+"			</span>"+"		</span>"+"	</h1>"+"</header>";this.$el.prepend(u),this.$("#printDoc").on("click",$.proxy(this.printDoc,this));var a=this;$.ajax({type:"POST",url:"/api/approval/document/contentpreview/preview",data:{docBodyContent:o.getDocBodyContentData()},success:function(e){a.documentView.setPreviewMode(e.data.docBodyContent)}}),this.$el.find("section.aside_wrapper").remove(),this.$el.find("#attachView").remove(),this.$el.find("#editView").remove();var f='<footer class="btn_layer_wrap">	<span class="btn_minor_s" data-role="button" onclick="window.close();">		<span class="txt">'+D["\ub2eb\uae30"]+"</span>"+"	</span>"+"</footer>";this.$el.find("section.tool_bar").replaceWith(f)}else this.contentTop.render(),this.$el.find("header.content_top").replaceWith(this.contentTop.el),this.$el.find("header.content_top .combine_search").remove(),GO.router.getUrl().indexOf("preview/reference")>0&&(this.$el.find("div.tool_bar div.critical").remove(),t.isDocReadAuthority||this.$el.find(".btn_print").remove());GO.util.store.set("autoSetAppr",null,{type:"session"}),(new l({getDownloadURL:"api/approval/document/"+this.docId+"/download",appendTarget:this.$el.find(".tool_bar > div.critical"),showDownloadBtn:this.toolbarView.getShowDownloadBtn()||!1,hideWhenDeletedDeptRcvDoc:this.toolbarView.getHideWhenDeletedDeptRcvDoc()||!1})).render()},setSlideConfig:function(){this.slideConfig={slideStop:77,slidePage:1,shownBlockCount:3,HProc:!0}},_agoSlide:function(){var e=this;e.slideConfig.HProc&&!e.$("#prev").hasClass("tab_disabled")&&e.slideConfig.slidePage>1&&(e.slideConfig.slidePage=e.slideConfig.slidePage-1,HProc=!1,$("#slideLayer").animate({left:"-"+String((e.slideConfig.slidePage-1)*e.slideConfig.slideStop)+"px"},250,function(){e.slideConfig.HProc=!0,e.displaySlideNavStyle()}))},_nxtSlide:function(){var e=this;e.slideConfig.HProc&&!e.$("#next").hasClass("tab_disabled")&&e.slideConfig.slidePage<$("#slideLayer li:visible").length-(e.slideConfig.shownBlockCount-1)&&(e.slideConfig.slidePage=e.slideConfig.slidePage+1,HProc=!1,$("#slideLayer").animate({left:"-"+String((e.slideConfig.slidePage-1)*e.slideConfig.slideStop)+"px"},250,function(){e.slideConfig.HProc=!0,e.displaySlideNavStyle()}))},displaySlideNavStyle:function(){var e=this;$("#slideLayer li:visible").length>3?(this.$("#prev").removeClass("tab_disabled"),this.$("#next").removeClass("tab_disabled"),e.slideConfig.slidePage==1?this.$("#prev").addClass("tab_disabled"):e.slideConfig.slidePage==$("#slideLayer li:visible").length-(e.slideConfig.shownBlockCount-1)&&this.$("#next").addClass("tab_disabled")):(this.$("#prev").addClass("tab_disabled"),this.$("#next").addClass("tab_disabled"))},printDoc:function(){GO.util.print(this.$el)},useAutoApprFlow:function(){return this.model.get("useAutoApprFlow")&&(this.type=="REAPPLY"||this.type=="CREATE"||this.model.get("document").docStatus=="TEMPSAVE"||this.type=="INTEGRATION"||this.type=="DOCUMENT"&&this.model.get("document").docStatus=="CREATE")},reSetApprFlowView:function(){if(this.options.isPreview)return;var e=this.getTargetAutoApprFlowModel();if(!e){this.appliedAutoApprErrorMessage();return}var t=_.first(e.get("activityGroups"));if(!t){this.appliedAutoApprErrorMessage();return}var n=!1;_.each(t.activities,function(e){if(!_.isUndefined(e.moreAmount)||!_.isUndefined(e.underAmount))n=e.type=="DRAFT"?!1:!0},this);if(t.activities.length>0){var r=this.hasDupleDraftActivities(t);t=this.getAvailableActivities(t,n);var i=t.requireArbitaryDesision;n?e.set("activityGroups",[this.removeDupleActivityGroup(this.getActivitiesByAmount(t,i,r))]):e.set("activityGroups",[this.removeDupleActivityGroup(t)])}var s=this.model.get("apprFlow"),o=s.activityGroups,a=_.findIndex(o,function(e){return e.useApprLineRule});o[a]=_.first(e.get("activityGroups")),this.model.set("apprFlow",s),this.apprFlowView.remove(),this.apprFlowView=new d({type:this.type,docId:this.model.get("document").documentId,model:new u(this.model.get("apprFlow"))}),this.append(this.apprFlowView,"div.doc-meta-container"),this.changeActivityGroups(this.model.get("apprFlow").activityGroups)},hasAutoFlowOptionComponent:function(){return this.documentView.$el.find('[name="apprLineRuleOption"]').length>0},hasAutoFlowAmountComponent:function(){return this.documentView.$el.find('[name="apprLineRuleAmount"]').length>0},getAvailableActivities:function(e,t){var n=_.clone(e),r=_.first(n.activities).userId,i=[],s=this.hasDupleDraftActivities(n);if(s){var o=0;_.each(n.activities,function(e,t){e.userId==r&&(o=t)});var u=n.activities.slice(0,1),a;a=n.activities.slice(o+1),t?a=n.activities.slice(o):a=n.activities.slice(o+1),n.activities=u.concat(a)}return n},removeDupleActivityGroup:function(e){var t=this.model.get("document").drafterId,n=e.activities,r=[];return _.each(n,function(e,i){e.userId==t?r.push(e):_.findWhere(n.slice(i+1),{userId:e.userId})||r.push(e)},this),e.activities=r,e},hasDupleDraftActivities:function(e){var t=_.first(e.activities).userId;return _.where(e.activities,{userId:t}).length>1},getTargetAutoApprFlowModel:function(){var e=new u(this.model.get("autoApprFlow")),t=new a(e.get("autoApprFlows")),n=this.documentView.$el.find('[name="apprLineRuleOption"]'),r,i,s,o=0,f;return this.hasAutoFlowOptionComponent()?"select"==n.prop("tagName").toLowerCase()?(f=n.find("option:selected"),o=n.find("option").index(f)):"radio"==n.eq(0).prop("type").toLowerCase()&&(f=this.documentView.$el.find('[name="apprLineRuleOption"]:checked'),o=n.index(f)):o=0,t.at(o)},bindAutoFlowComponentEvent:function(){if(this.options.isPreview)return;this.hasAutoFlowOptionComponent()&&(this.documentView.$el.find('[name="apprLineRuleOption"]').not('[data-dsl*="cSel"]').off("change"),this.documentView.$el.find('[name="apprLineRuleOption"]').on("change",_.bind(this.reSetApprFlowView,this)));var e=this.getTargetAutoApprFlowModel(),t=_.first(e.get("activityGroups"));if(!t){this.appliedAutoApprErrorMessage();return}var n=!1;_.each(t.activities,function(e){if(!_.isUndefined(e.moreAmount)||!_.isUndefined(e.underAmount))n=e.type=="DRAFT"?!1:!0}),n&&this.hasAutoFlowAmountComponent()&&(this.documentView.$el.find('[name="apprLineRuleAmount"]').off("change"),this.documentView.$el.find('[name="apprLineRuleAmount"]').on("change",_.bind(this.reSetApprFlowView,this)))},getActivitiesByAmount:function(e,t,n){var r=this,i=_.clone(e),s=[],o=this.documentView.$el.find('[name="apprLineRuleAmount"]'),u=!0,a=null;if(r.hasAutoFlowAmountComponent()){var f=parseFloat(o.inputmask("unmaskedvalue"))||0;_.each(i.activities,function(e){var t=e.moreAmount!=null?e.moreAmount:null,n=e.underAmount!=null?e.underAmount:null;e.type!="DRAFT"&&!a&&(a=e),f>=t&&f<n?(s.push(e),u=!1):t!=null&&f>=t&&n==null?(s.push(e),u=!1):e.type=="DRAFT"&&s.push(e)})}return i.requireArbitaryDesision&&u&&a!=null&&s.push(a),i.activities=s,i},showPreserveYears:function(e){return e==0?P["\uc601\uad6c"]:e+P["\ub144"]},showReadingOrgSlider:function(e){var t=this;return $.goOrgSlide({header:P["\uc5f4\ub78c\uc790 \uc120\ud0dd"],type:"list",contextRoot:GO.contextRoot,callback:t.addReading,multiCompanyVisible:t.model.get("actionCheck").multiCompanySupporting})},showReceptionOrgSlider:function(e){var t=this;return $.goOrgSlide({header:P["\uc218\uc2e0\uc790 \uc120\ud0dd"],type:"list",contextRoot:GO.contextRoot,callback:t.addReception})},addReading:function(e){var t=$("#addReading");e&&!t.find('li[data-id="'+e.id+'"]').length?t.find("li.creat").before(s($.extend(e,{lang:Y}))):$.goMessage(P["\uc774\ubbf8 \uc120\ud0dd\ub418\uc5c8\uc2b5\ub2c8\ub2e4."])},addReception:function(e){var t=$("#addReceive");e&&!t.find('li[data-id="'+e.id+'"]').length?t.find("li.creat").before(s($.extend(e,{lang:Y}))):$.goMessage(P["\uc774\ubbf8 \uc120\ud0dd\ub418\uc5c8\uc2b5\ub2c8\ub2e4."])},readingDeleteItem:function(e){$(e.currentTarget).parents("li").remove()},getSender:function(e){var t=[];return $.each(e,function(e,n){$.each(n.activities,function(e,n){n.type=="DRAFT"&&t.push({deptId:n.deptId,deptName:n.deptName,userId:n.userId,userName:n.userName,userPosition:n.userPosition})})}),t},generateActCopy:function(){this.documentView.actCopy()},selectTab:function(e){$(".tab_nav > li").removeClass("on"),$(e.currentTarget).addClass("on");switch($(e.currentTarget).attr("id")){case"tab_apprflow":this.showApprFlow();break;case"tab_docinfo":this.showDocInfo();break;case"tab_dochistory":this.showDocHistory();break;case"tab_readerhistory":this.showReaderHistory();break;case"tab_receptiondocument":this.showReceptionDocument();break;case"tab_officialdocreceiver":this.showOfficialDocReceiver()}},allTabHide:function(){$(this.apprFlowView.el).hide(),$(this.docInfoView.el).hide(),$(this.docHistoryView.el).hide(),$(this.readHistoryView.el).hide(),$(this.receptionView.el).hide(),$(this.officialDocReceiverView.el).hide()},showApprFlow:function(){this.allTabHide(),$(this.apprFlowView.el).show()},showDocInfo:function(){this.allTabHide(),$(this.docInfoView.el).show()},showDocHistory:function(){this.allTabHide(),$(this.docHistoryView.el).show()},showReaderHistory:function(){this.allTabHide(),$(this.readHistoryView.el).show()},showReceptionDocument:function(){this.allTabHide(),$(this.receptionView.el).show()},showOfficialDocReceiver:function(){this.allTabHide(),$(this.officialDocReceiverView.el).show()},changeApprFlowAndDocInfo:function(){var e=this,t=this.model.get("apprFlow"),n=this.model.isReceptionDocument();if(Z)return;this.model.availableUpdateDocMetaInfo(this.type)?(_.isUndefined(this.model.get("document").apprFlowVersionId)||(t.apprFlowVersionId=this.model.get("document").apprFlowVersionId),this.model.Request.updateDocMetainfo(null,{beforeSend:function(){Z=!0},success:function(t){e.model.isStatusTempSaved()?(e.changeActivityGroups(t.get("apprFlow").activityGroups,n),e.changeReferrenceReaders(t.get("docInfo").docReferenceReaders),e.changeDocInfo(t.get("docInfo"))):(e.documentInit(),e.render())},error:function(e,t){var n=JSON.parse(t.responseText),r=n.message;r?$.goError(r):$.goError(D["\uc2e4\ud328\ud588\uc2b5\ub2c8\ub2e4."])},complete:function(){Z=!1}})):(e.changeActivityGroups(t.activityGroups,n),e.changeReferrenceReaders(this.model.get("docInfo").docReferenceReaders),e.changeDocInfo(this.model.get("docInfo"),n))},changeReferrenceReaders:function(e){this.documentView.changeReferrenceReaders(e)},changeActivityGroups:function(e,t){this.documentView.changeActivityGroups(e,t),this.apprFlowView.makeApprFlow(e)},changeDocInfo:function(e,t){this.docInfoView.updateDocInfo(e);var n=[],r;if(t)return!1;$.each(e.docReceptionReaders,function(e,t){r=t.reader.name,t.reader.position&&t.reader.position!=""&&(r+=" "+t.reader.position),n.push(r)});var i=[];$.each(e.docReferenceReaders,function(e,t){r=t.reader.name,t.reader.position&&t.reader.position!=""&&(r+=" "+t.reader.position),i.push(r)});var s=[];$.each(e.officialVersions,function(e,t){t.receivers&&$.each(t.receivers,function(e,t){var n=_.isEmpty(t.company)?"":t.company;s.push(n+" "+t.name)})});var o={recipient:n,docReference:i,officialDocReceiver:s};this.documentView.setApprovalData(o)},changeActivity:function(e){this.documentView.changeActivity(e)},setDocNum:function(e){this.documentView.setDocNum(e)},getActDocument:function(e){e=$.extend({inDraft:!1,inCancel:!1,useArbitrary:!1,arbtDecisionType:!0,defaulCheckArbitrary:!1,nextApproval:!0,isEmergency:!1,showPreviousReturn:!1},e);var t=this.getTitle(),n=$("#apprflow").find("div[data-userId="+GO.session().id+"]"),i=$(n).attr("data-userName")+" "+$(n).attr("data-userPosition"),s=$(n).attr("data-userDeptName");$(n).attr("data-userName")||(n=this.model.get("apprFlow").currentUserId,i=this.model.get("apprFlow").currentUserName+" "+this.model.get("apprFlow").currentUserPositionName,s=this.model.get("apprFlow").currentUserDeptName);if(e.inDraft&&$("#apprflow").find("div[data-userid]").length<2)var o=P["1\uc778\uacb0\uc7ac\uacbd\uace0"];var u=this.model.get("userApprSetting").useNextApproval,a=$("#emergency").is(":checked"),f=this.model.get("document").isReceptionDocument,l=GO.i18n(P["{{arg1}}\uc804\uacb0\uc124\uba85"],{arg1:this.model.get("docInfo").currentApprGroupName}),c=Y["\uc758\uacac\uc744 \uc791\uc131\ud574 \uc8fc\uc138\uc694"],h=Y["\uacb0\uc7ac\uc758\uacac"];e.isReturn?(c=Y["\ubc18\ub824 \uacb0\uc7ac \uc758\uacac \uc785\ub825\uc740 \ud544\uc218\uc785\ub2c8\ub2e4"],h=Y["\ubc18\ub824\uacb0\uc7ac\uc758\uacac"]):e.isRecvReturned&&(c=Y["\ubc18\uc1a1 \uacb0\uc7ac \uc758\uacac \uc785\ub825\uc740 \ud544\uc218\uc785\ub2c8\ub2e4"],h=Y["\ubc18\uc1a1\uacb0\uc7ac\uc758\uacac"]);var p=$(r({lang:Y,arbtDescLang:l,message:o,documentTitle:t,userName:i,userDept:s,usePassword:e.usePassword!=undefined?e.usePassword:this.usePassword,useArbitrary:e.useArbitrary,arbtDecisionType:e.arbtDecisionType,defaultCheckArbitrary:e.defaultCheckArbitrary,showPreviousReturn:e.showPreviousReturn,inDraft:e.inDraft,inCancel:e.inCancel,useNextApproval:u,isEmergency:a,isReceptionDocument:f,nextApproval:e.nextApproval,placeholder:c,comment:h}));return this.usePassword&&p.delegate("#apprPassword","keyup",function(t){if(t.keyCode!=13)return;var n=$(t.currentTarget),r=e.saveActionTarget?$(e.saveActionTarget):n.closest("div.go_popup").find("footer a.btn_major_s");r.trigger("click")}),p},getTitle:function(){var e=this.model.get("document").formName,t=this.documentView.getTitle(),n=this.model.get("document").title?t?t:this.model.get("document").title:t?t:e;return n},saveDocument:function(){var e=this;if(!e.checkCompleteForm())return!1;if(!this.formIntegrator.validate())return!1;$.goConfirm(P["\uc800\uc7a5\ud558\uc2dc\uaca0\uc2b5\ub2c8\uae4c?"],"",function(){if(!e.allowAction)return;e.formIntegrator.beforeSave(),e.allowAction=!1;var t=e.model.get("document").documentId,n=e.model.get("apprFlow"),r=new X(t),i=e.model.get("document").docVersionId;r.set({document:e.getDocumentData(t),docInfo:e.getDocInfoData(t),apprFlow:n,docVersionId:i},{silent:!0});var s=$.goPreloader();r.save({},{type:"PUT",beforeSend:function(){s.render()},success:function(t,n){e.allowAction=!0,n.code==200&&(e.documentInit(),e.render(),$.goMessage(P["\uc800\uc7a5\uc774 \uc644\ub8cc\ub418\uc5c8\uc2b5\ub2c8\ub2e4."]),e.formIntegrator.afterSave())},error:function(t,n){e.allowAction=!0;var r=n.responseJSON;return!_.isUndefined(r)&&r.message?($.goError(r.message),!1):($.goError(D["\uc800\uc7a5\uc5d0 \uc2e4\ud328 \ud558\uc600\uc2b5\ub2c8\ub2e4."]),!1)},complete:function(){s.release()}})})},cancelEdit:function(){var e=this;$.goConfirm(P["\ucde8\uc18c\ud558\uc2dc\uaca0\uc2b5\ub2c8\uae4c?"],"",function(){e.documentInit(),e.render(),$.goMessage(P["\ucde8\uc18c \ub418\uc5c8\uc2b5\ub2c8\ub2e4."])})},draftDocument:function(){var e=this;if(this.model.get("isDeletedDraftDept")){this.showErrorAlert(P["\uc0ad\uc81c\ub41c \uae30\uc548\ubd80\uc11c\ub85c \ubb38\uc11c\uae30\uc548 \ubd88\uac00 \uc548\ub0b4 \uba54\uc2dc\uc9c0"],P["\uacb0\uc7ac\ubb38\uc11c\ub97c \uc0c8\ub85c \uc791\uc131\ud574 \uc8fc\uc138\uc694."]);return}if(e.model.get("docInfo").requiredReceiver&&e.model.get("docInfo").docReceptionReaders.length==0&&this.model.get("document").docType!="RECEIVE"){var t=['<p class="q">'+Y["\uc218\uc2e0\ucc98 \uc9c0\uc815 \ud544\uc218 \uba54\uc138\uc9c0"]+"</p>",'<p class="q"><a id="callEditApprFlow">['+Y["\uc218\uc2e0\ucc98 \uc9c0\uc815\ud558\uae30"]+"]</a></p>"].join(""),n=$.goPopup({pclass:"layer_normal layer_approval",header:P["\uacb0\uc7ac\uc694\uccad"],modal:!0,draggable:!0,width:500,contents:t,buttons:[{btext:D["\ub2eb\uae30"],btype:"cancel"}]});return $(n).find("#callEditApprFlow").off("click"),$(n).find("#callEditApprFlow").on("click",_.bind(e.editApprFlow,e,"receiver")),!1}B(this.checkSelfApproval()).then(function(){if(!e.formIntegrator.validate())return!1;if(!e.checkCompleteForm())return!1;$.goPopup({pclass:"layer_normal layer_approval",header:P["\uacb0\uc7ac\uc694\uccad"],modal:!0,draggable:!0,width:500,contents:e.getActDocument({inDraft:!0,nextApproval:!1}),buttons:[{btext:P["\uacb0\uc7ac\uc694\uccad"],btype:"confirm",autoclose:!1,callback:function(t){e.saveDraftDocument(t)}},{btext:D["\ucde8\uc18c"],btype:"cancel"}]})}).otherwise(function(t){console.log(t.stack)})},saveDraftDocument:function(e){if(!this.allowAction)return;var t=this,n=$("#apprPassword").val(),r=$("#textarea-desc").val();if(!this.actionApprValidate("#apprPassword","#textarea-desc",e))return!1;$("#isEmergency").is(":checked")?$("#emergency").attr("checked",!0):$("#emergency").attr("checked",!1),this.formIntegrator.beforeSave();var i=t.model.get("document").documentId,s=t.model.get("apprFlow");_.isUndefined(t.model.get("document").apprFlowVersionId)||(s.apprFlowVersionId=t.model.get("document").apprFlowVersionId);var o=s.activityGroups[0].activities[0].id,u={activityId:o,apprAction:"DRAFT",comment:$("#textarea-desc").val(),apprPassword:n},a=new I(i);this.allowAction=!1,a.set({apprAction:u,document:t.getDocumentData(i),docInfo:t.getDocInfoData(i),apprFlow:s},{silent:!0});var f=$.goPreloader();a.save({},{type:"PUT",beforeSend:function(){f.render()},success:function(n,r){t.allowAction=!0,r.code==200&&(e.close(),t.formIntegrator.afterSave(),$.goMessage(P["\uacb0\uc7ac \uc694\uccad\uc744 \uc644\ub8cc\ud558\uc600\uc2b5\ub2c8\ub2e4."]),t.navigateToDocShow(r.data.document.id))},error:function(e,n){t.allowAction=!0;var r=JSON.parse(n.responseText);return!_.isUndefined(r)&&r.message?(t.usePassword?($.goError(r.message,$("#apprPassword")),$("#apprPassword").addClass("enter error").focus()):$.goError(r.message),!1):($.goError(P["\uae30\uc548\uc5d0 \uc2e4\ud328 \ud558\uc600\uc2b5\ub2c8\ub2e4."]),!1)},complete:function(){f.release()}})},showSendMailLayer:function(){var e=this.documentView.getTitle(),t=this.model.get("document").title?e?e:this.model.get("document").title:e?e:this.model.get("document").formName;this.mailTitle=t,B(this.apprDocumentMailModel.fetch({async:!1,statusCode:{400:function(){$.goError(D["500 \uc624\ub958\ud398\uc774\uc9c0 \ud0c0\uc774\ud2c0"])},403:function(){$.goError(D["403 \uc624\ub958\ud398\uc774\uc9c0 \ud0c0\uc774\ud2c0"])},500:function(){$.goError(D["500 \uc624\ub958\ud398\uc774\uc9c0 \ud0c0\uc774\ud2c0"])}}})).then(_.bind(function(){var e=this.apprDocumentMailModel.toJSON();if(e.attlists.length<1)$.goError(D["500 \uc624\ub958\ud398\uc774\uc9c0 \ud0c0\uc774\ud2c0"]);else{var t=_.map(e.attlists,function(e){var t=e.path+":"+e.name+":"+e.size+":"+e.id+"\n";return t});this.openEmailPopup(t,this.mailTitle)}},this)).otherwise(function(t){console.log(t.stack)})},openEmailPopup:function(e,t){var n=Math.floor(Math.random()*1e4),r="scrollbars=yes,resizable=yes,width="+j+",height= "+F;window.open("",n,r);var i=document.createElement("form"),s=document.createElement("input");s.type="hidden",s.name="data";var o={};o.subject=t;var u=[];_.each(e,function(e){u.push(e)}),o.attachFiles=u,s.value=JSON.stringify(o),i.appendChild(s),i.action=GO.contextRoot+"app/mail/popup/process",i.method="post",i.target=n,document.body.appendChild(i),i.submit(),document.body.removeChild(i)},showPostRegistLayer:function(){var e=new k({model:this.model}),t=$.goPopup({pclass:"layer_normal send_mail",header:P["\uacb0\uc7ac\ubb38\uc11c \uac8c\uc2dc\ud558\uae30"],modal:!0,allowPrevPopup:!0,contents:"",buttons:[{btype:"confirm",btext:P["\uac8c\uc2dc\ud558\uae30"],autoclose:!1,callback:function(t,n){e.submit().done(function(){t.close()}).fail()}},{btype:"cancel",btext:D["\ucde8\uc18c"],autoclose:!1,callback:function(e,t){e.close("",t)}}]});t.find(".content").html(e.el),e.render(),t.reoffset()},showPopup:function(){var e=this.model.getFullShowUrl()+"/popup";window.open(e,"","location=no, directories=no,resizable=yes,status=no,toolbar=no,menubar=no, width=1280,height=650,left=0, top=0, scrollbars=yes")},reapplyDocument:function(){var e=this;if(this.model.docInfoModel.attributes.integrationActive){this.showErrorAlert(P["\uc2dc\uc2a4\ud15c\uacfc \uc5f0\ub3d9\ub41c \ubb38\uc11c\ub294 \uc7ac\uae30\uc548\uc774 \ubd88\uac00\ub2a5\ud569\ub2c8\ub2e4."],P["\uacb0\uc7ac\ubb38\uc11c\ub97c \uc0c8\ub85c \uc791\uc131\ud574 \uc8fc\uc138\uc694."]);return}var t=new O;t.fetch({success:function(t,n){e.options.isPopup?GO.router.navigate("/approval/document/"+e.docId+"/reapply/popup",{trigger:!0}):t.get("writeMode")=="POPUP"?(url=GO.contextRoot+"app"+"/approval/document/"+e.docId+"/reapply/popup",window.open(url,"","location=no, directories=no,resizable=yes,status=no,toolbar=no,menubar=no, width=1280,height=650,left=0, top=0, scrollbars=yes")):GO.router.navigate("/approval/document/"+e.docId+"/reapply",{trigger:!0})},error:function(t,n){var r=D["500 \uc624\ub958\ud398\uc774\uc9c0 \ub0b4\uc6a9"];$.parseJSON(n.responseText).message&&(r=$.parseJSON(n.responseText).message),e.docInitError(r)}})},actionApprValidate:function(e,t,n,r){var i=!0;$(e).removeClass("enter error"),$(t).removeClass("enter error"),n.find("span.go_error").remove();var s=$(e).val(),o=$(t).val();return this.usePassword&&(s||($.goError(P["\uacb0\uc7ac \ube44\ubc00\ubc88\ud638\ub97c \uc785\ub825\ud558\uc138\uc694."],$(e)),$(e).addClass("enter error").focus(),i=!1)),(r=="RETURN"||r=="RECV_RETURNED")&&$.trim(o)==""&&($.goError(P["\uc758\uacac\uc744 \uc791\uc131\ud574 \uc8fc\uc138\uc694"],$(t)),$(t).addClass("enter error").select(),i=!1),o&&o.length>1e3&&($.goError(GO.i18n(P["{{max}}\uc790 \uc774\ud558\ub85c \uc785\ub825\ud574 \uc8fc\uc2ed\uc2dc\uc624"],{max:1e3}),$(t)),$(t).addClass("enter error").select(),i=!1),i},getDocumentData:function(e,t){return{id:e,documentId:e,docStatus:t,attachCount:0,attaches:this.getAttachData(),comments:this.getCommentsData(),references:this.getReferencesData(),docBodyContent:this.getDocBodyContentData(),title:this.getTitle(),variables:this.getDocVariables(),reDraft:this.documentView.docModel.reDraft,updatedAt:this.model.get("document").updatedAt}},getDocVariables:function(){var e={},t=this.model.get("docInfo").integrationActive||!1,n=!_.isEmpty(this.model.get("docInfo").externalScript);if(t||n)e=this.formIntegrator.getDocVariables()||this.documentView.getDocVariables();return e},getAttachData:function(){var e=$("#attachPart").find("li[data-tmpname]:not(.attachError)"),t=[];return e.each(function(){var e={};$(this).attr("data-tmpname")&&(e.path=$(this).attr("data-tmpname")),$(this).attr("data-name")&&(e.name=$(this).attr("data-name")),$(this).attr("data-id")&&(e.id=$(this).attr("data-id")),t.push(e)}),t},getCommentsData:function(){var e=[];return e},getReferencesData:function(){var e=[],t=$("#refDocPart").find("li[data-id]"),n=$("#receptionOriginDocPart").find("li[data-id]");return t.each(function(){e.push({id:$(this).data("id")})}),n.each(function(){e.push({id:$(this).data("id")})}),e},getDocBodyContentData:function(){return this.documentView.getDocBodyContents()},getDocInfoData:function(e){var t=this,n=t.model.get("docInfo"),r=_.isEmpty(n.deptDocFolders)?"":n.deptDocFolders[0].id;return{id:e,securityLevelId:$("#infoSecurityLevel").val(),docYear:$("#docYear").val(),docFolders:t.getDocFolderData(),docReceptionReaders:n.docReceptionReaders||[],docReferenceReaders:n.docReferenceReaders||[],docReadingReaders:n.docReadingReaders||[],officialVersions:n.officialVersions||[],isPublic:$(':radio[name="openType"]:checked').val(),isEmergency:$("#emergency").is(":checked"),drafterDeptFolderId:_.isUndefined($("#drafter_deptFolderId").val())?r:$("#drafter_deptFolderId").val()}},getDocFolderData:function(){var e=$("#addFolder").find("li[data-id]"),t=[];return e.each(function(){$(this).attr("data-Type")=="true"&&t.push({id:$(this).attr("data-id")})}),t},getDocReceptionReadersData:function(){var e=[],t=$("#addReceive").find("li[data-id]");return t.each(function(){e.push({id:$(this).attr("data-sid"),assigned:$(this).attr("data-assigned")?!0:!1,reader:{id:$(this).attr("data-userId"),name:$(this).attr("data-userName"),position:$(this).attr("data-userPosition"),deptId:$(this).attr("data-userDeptId"),deptType:$(this).attr("data-deptType")}})}),e},getDocReferenceReadersData:function(){var e=[],t=$("#addReference").find("li[data-id]");return t.each(function(){e.push({id:$(this).attr("data-sid"),reader:{id:$(this).attr("data-userId"),name:$(this).attr("data-userName"),position:$(this).attr("data-userPosition"),deptType:$(this).attr("data-deptType")}})}),e},deleteDocument:function(){var e=this;$.goConfirm(D["\uc0ad\uc81c\ud558\uc2dc\uaca0\uc2b5\ub2c8\uae4c?"],"",function(){var t=[GO.config("contextRoot")+"api/approval/document",e.docId,"delete"].join("/");$.ajax(t,{type:"PUT",contentType:"application/json",dataType:"json"}).done(function(t){e.options.isPopup?$.goAlert("",P["\uc120\ud0dd\ud55c \ud56d\ubaa9\uc774 \uc0ad\uc81c\ub418\uc5c8\uc2b5\ub2c8\ub2e4"],function(){window.close()}):($.goMessage(P["\uc120\ud0dd\ud55c \ud56d\ubaa9\uc774 \uc0ad\uc81c\ub418\uc5c8\uc2b5\ub2c8\ub2e4"]),e.navigateToBackList())})})},tempSaveReload:function(){if(!this.allowAction)return;var e=this,t=[GO.config("contextRoot")+"api/approval/document",e.docId,"tempsave"].join("/"),n=e.model.get("document").documentId,r=e.model.get("apprFlow"),i={type:"PUT",contentType:"application/json",dataType:"json",beforeSend:function(){e.allowAction=!1},data:JSON.stringify({document:e.getDocumentData(n),docInfo:e.getDocInfoData(n),apprFlow:r})},s=function(t){e.allowAction=!0};$.ajax(t,i).done($.proxy(s,this)).fail(function(t){e.allowAction=!0;var n=JSON.parse(t.responseText)})},tempSaveChangeDept:function(e){if(!this.allowAction){$.goError(P["\uc218\uc815\uc694\uccad \uc9c4\ud589\uc911 \uba54\uc138\uc9c0"]),this.docInfoView.setDefaultDraterDeptId();return}var t=this,n=[GO.config("contextRoot")+"api/approval/document",t.docId,"tempsave",e].join("/"),r=t.model.get("document").documentId,i=t.model.get("apprFlow"),s={type:"PUT",contentType:"application/json",dataType:"json",beforeSend:function(){t.allowAction=!1},data:JSON.stringify({document:t.getDocumentData(r),docInfo:t.getDocInfoData(r),apprFlow:i})},o=function(e){GO.util.store.set("autoSetAppr",!0,{type:"session"}),t.allowAction=!0,t.navigateToDocShow(r)};$.ajax(n,s).done($.proxy(o,this)).fail(function(e){var n=JSON.parse(e.responseText);t.allowAction=!0,$.goError(n.message)})},tempSaveDocument:function(){if(!this.allowAction)return;var e=this;$.goConfirm(P["\uc784\uc2dc\uc800\uc7a5 \ud558\uc2dc\uaca0\uc2b5\ub2c8\uae4c?"],"",function(){var t=[GO.config("contextRoot")+"api/approval/document",e.docId,"tempsave"].join("/"),n=e.model.get("document").documentId,r=e.model.get("apprFlow"),i={type:"PUT",contentType:"application/json",beforeSend:function(){e.allowAction=!1},dataType:"json",data:JSON.stringify({document:e.getDocumentData(n),docInfo:e.getDocInfoData(n),apprFlow:r})},s=function(t){e.navigateToDocShow(n),e.allowAction=!0,$.goMessage(P["\uc784\uc2dc\uc800\uc7a5\ub418\uc5c8\uc2b5\ub2c8\ub2e4."])};$.ajax(t,i).done($.proxy(s,this)).fail(function(t){var n=JSON.parse(t.responseText);$.goError(n.message),e.allowAction=!0})})},tempAutoSaveDocument:function(){if(!this.allowAction)return;var e=this,t=[GO.config("contextRoot")+"api/approval/document",e.docId,"tempsave"].join("/"),n=e.model.get("document").documentId,r=e.model.get("apprFlow"),i={type:"PUT",contentType:"application/json",dataType:"json",beforeSend:function(){e.allowAction=!1},data:JSON.stringify({document:e.getDocumentData(n),docInfo:e.getDocInfoData(n),apprFlow:r})},s=function(t){e.allowAction=!0,e.toolbarView.processAutoSaveMessage("saveTerm"),e.documentView._reloadAttachArea(t);var n=$(t.data.document.docBodyContent).find('span[data-dsl*="editor"]'),r=$(e.getDocBodyContentData()).find("img[data-inline]"),i=!1;$.each(r,function(e,t){$(t).attr("data-id")||(i=!0)}),i&&$.each(n,function(e,t){$.goFormEditor.putContent($(t).attr("data-id"),$(t).html())}),e.model.set(t.data)};$.ajax(t,i).done($.proxy(s,this)).fail(function(t){e.allowAction=!0;var n;t.responseText?(n=JSON.parse(t.responseText),$.goError(n.message)):$.goError(D["\uad00\ub9ac \uc11c\ubc84\uc5d0 \uc624\ub958\uac00 \ubc1c\uc0dd\ud558\uc600\uc2b5\ub2c8\ub2e4"])})},storeAutoSaveTime:function(){var e=this,t=GO.config("contextRoot")+"api/approval/usersetting/autosavetime",n={type:"PUT",contentType:"application/json",dataType:"json",data:JSON.stringify({autoSaveTime:this.toolbarView.$("#autoSaveSelect").val()})};$.ajax(t,n)},cancelDraft:function(){var e=this;$.goConfirm(D["\ucde8\uc18c\ud558\uc2dc\uaca0\uc2b5\ub2c8\uae4c?"],"",function(){e.options.isPopup?window.close():e.navigateToDraftList()})},actDraftWithdrawalDraft:function(){var e=this;$.goConfirm(P["\uacb0\uc7ac\uc694\uccad \uc548\ub0b4 \uba54\uc138\uc9c0"],"",function(){$.goPopup({pclass:"layer_normal layer_approval",header:P["\uacb0\uc7ac\uc694\uccad"],modal:!0,draggable:!0,width:500,contents:e.getActDocument({inCancel:!0,nextApproval:!1}),buttons:[{btext:D["\ud655\uc778"],btype:"confirm",autoclose:!1,callback:function(t){e.saveApprAction(t,"DRAFTWITHDRAWDRAFT")}},{btext:D["\ucde8\uc18c"],btype:"cancel"}]})})},actDraftWithdrawalCancelDraft:function(){var e=this;$.goConfirm(P["\uc0c1\uc2e0\ucde8\uc18c \uc548\ub0b4 \uba54\uc138\uc9c0"],"",function(){$.goPopup({pclass:"layer_normal layer_approval",header:P["\uacb0\uc7ac\ucde8\uc18c"],modal:!0,draggable:!0,width:500,contents:e.getActDocument({inCancel:!0,nextApproval:!1}),buttons:[{btext:D["\ud655\uc778"],btype:"confirm",autoclose:!1,callback:function(t){e.saveApprAction(t,"DRAFTWITHDRAWCANCELDRAFT")}},{btext:D["\ucde8\uc18c"],btype:"cancel"}]})})},doApprove:function(){var e=this,t=[];t.push({btext:P["\uc2b9\uc778"],btype:"confirm",autoclose:!1,callback:function(t){e.saveApprAction(t,"APPROVAL")}}),t.push({btext:D["\ucde8\uc18c"],btype:"cancel"});var n=this.model.get("actionCheck").isArbitraryDecisionabled,r=this.model.get("docInfo").arbtDecisionType=="DOCUMENT"?!0:!1,i=this.apprFlowView.getCurrentActivity(),s=!1;typeof i!="undefined"&&(s=i.arbitrary);var o=$.goPopup({pclass:"layer_normal layer_approval",header:P["\uacb0\uc7ac\ud558\uae30"],modal:!0,draggable:!0,width:500,contents:e.getActDocument({useArbitrary:n,arbtDecisionType:r,defaultCheckArbitrary:s}),buttons:t});$(o).find("#arbitrary").off("click"),$(o).find("#arbitrary").on("click",function(e){$("#arbtAddReferrerDetail").toggle($("#arbitrary").is(":checked"))})},getPageNo:function(){var e=sessionStorage.getItem("list-history-pageNo"),t=sessionStorage.getItem("list-total-count");if(!e||!t||e==0)return 0;var n=sessionStorage.getItem("list-history-pageSize");return t<=n*e+1&&(e=e-1>=0?e-1:0),e},saveApprAction:function(e,t){function w(e){if(e.apprAction=="ADVAPPROVAL")return n.model.get("apprFlow").advActivityId;if(e.apprAction=="APPROVAL"||e.apprAction=="RETURN"){var t=n.model.get("actionCheck").isPostApprovalUser||n.model.get("actionCheck").isPostCheckUser,r=n.model.get("apprFlow").currentActivityId,i=n.model.get("apprFlow").approvalActivityId;return t&&i?i:r}return n.model.get("apprFlow").currentActivityId}var n=this;if(!this.allowAction)return;var r="document.draftedAt",i="desc",s=sessionStorage.getItem("list-history-searchtype"),o=sessionStorage.getItem("list-history-keyword")&&sessionStorage.getItem("list-history-keyword").replace(/\+/gi," "),u="all",a="",f="",l=n.model.get("document").documentId,c=new V(l);t=="RECV_RETURNED"&&(c=new G(l,"return"),r="createdAt"),sessionStorage.getItem("list-history-keyword")&&sessionStorage.getItem("list-history-property")!=""&&(r=sessionStorage.getItem("list-history-property")),sessionStorage.getItem("list-history-direction")&&sessionStorage.getItem("list-history-direction")!=""&&(i=sessionStorage.getItem("list-history-direction")),sessionStorage.getItem("list-history-duration")&&sessionStorage.getItem("list-history-duration")!=""&&(u=sessionStorage.getItem("list-history-duration")),u=="period"&&sessionStorage.getItem("list-history-fromDate")&&sessionStorage.getItem("list-history-fromDate")!=""&&(a=sessionStorage.getItem("list-history-fromDate"),f=sessionStorage.getItem("list-history-toDate"));var h=$("#apprPassword").val();if(!this.actionApprValidate("#apprPassword","#textarea-desc",e,t))return!1;var p=w({apprAction:t}),d=n.model.get("document").docVersionId,v=n.model.get("document").apprFlowVersionId;this.allowAction=!1;var m=!1;$("#arbitrary").is(":checked")&&(t="ARBITRARY",n.model.get("docInfo").arbtDecisionType=="APPRGROUP"&&(t="GROUPARBITRARY"),$("#arbtAddReferrer").is(":checked")&&(m=!0));var g=!1,y=!0;$("#nextApproval")?$("#nextApproval").is(":checked")&&(g=!0):(y=!1,g=this.model.get("userApprSetting").useNextApproval),$("#isPreviousReturn").is(":checked")&&(t="PREVIOUSRETURN"),c.set({activityId:p,apprAction:t,comment:$("#textarea-desc").val(),apprPassword:h,docVersionId:d,apprFlowVersionId:v,arbtAddReferrer:m,userApprSetting:{useNextApproval:g,property:r,direction:i,searchtype:s,keyword:o,duration:u,fromDate:a,toDate:f}},{silent:!0});var b=$.goPreloader();c.save({},{type:"PUT",beforeSend:function(){b.render()},success:function(r,i){n.allowAction=!0;if(i.code==200){n.tempActivityGroups=i.data.apprFlow.activityGroups,e.close();var s=[];s.push("APPROVAL"),s.push("RETURN"),s.push("ARBITRARY"),s.push("GROUPARBITRARY"),s.push("AGREEMENT"),s.push("OPPOSITION"),s.push("CHECK"),s.push("POSTCHECK"),s.push("HOLD"),s.push("PREVIOUSRETURN"),_.contains(s,t)?(sessionStorage.setItem("list-history-pageNo",n.getPageNo()),g&&y?l==i["data"]["document"]["id"]?n.navigateToTodoList(r.get("document").id):n.navigateToDocShow(i.data.document.id):n.navigateToTodoList(r.get("document").id)):n.navigateToDocShow(i.data.document.id)}},error:function(e,t){n.allowAction=!0;var r=t.responseJSON;return!_.isUndefined(r)&&r.message?(r.name=="not.authorized.canceldraft.read"||r.name=="invalid.activity.status"?$.goAlert(P["\uacb0\uc7ac\ud560 \ubb38\uc11c\uac00 \uc5c6\uc2b5\ub2c8\ub2e4."],r.message,null,D["\ub2eb\uae30"],function(){n.options.isPopup?window.close():n.navigateToBackList()}):n.usePassword?($.goError(r.message,$("#apprPassword")),$("#apprPassword").addClass("enter error").focus()):$.goError(r.message),!1):($.goError(P["\uc800\uc7a5\uc5d0 \uc2e4\ud328 \ud558\uc600\uc2b5\ub2c8\ub2e4."]),!1)},complete:function(){b.release()}})},doHold:function(){var e=this;$.goPopup({pclass:"layer_normal layer_approval",header:P["\ubcf4\ub958\ud558\uae30"],modal:!0,draggable:!0,width:500,contents:e.getActDocument(),buttons:[{btext:P["\ubcf4\ub958"],btype:"confirm",autoclose:!1,callback:function(t){e.saveApprAction(t,"HOLD")}},{btext:D["\ucde8\uc18c"],btype:"cancel"}]})},doReturn:function(){var e=this,t=e.model.get("actionCheck").latestCompleteAction=="DRAFT"?!0:!1,n=e.model.get("actionCheck").usePreviousReturn;$.goPopup({pclass:"layer_normal layer_approval",header:P["\ubc18\ub824\ud558\uae30"],modal:!0,draggable:!0,width:500,contents:e.getActDocument({showPreviousReturn:!t&&n,isReturn:!0}),buttons:[{btext:P["\ubc18\ub824"],btype:"confirm",autoclose:!1,callback:function(t){e.saveApprAction(t,"RETURN")}},{btext:D["\ucde8\uc18c"],btype:"cancel"}]})},doAgree:function(){var e=this;$.goPopup({pclass:"layer_normal layer_approval",header:P["\ud569\uc758\ud558\uae30"],modal:!0,draggable:!0,width:500,contents:e.getActDocument(),buttons:[{btext:P["\ud569\uc758"],btype:"confirm",autoclose:!1,callback:function(t){e.saveApprAction(t,"AGREEMENT")}},{btext:D["\ucde8\uc18c"],btype:"cancel"}]})},doDisagree:function(){var e=this;$.goPopup({pclass:"layer_normal layer_approval",header:P["\ubc18\ub300\ud558\uae30"],modal:!0,draggable:!0,width:500,contents:e.getActDocument(!1),buttons:[{btext:P["\ubc18\ub300"],btype:"confirm",autoclose:!1,callback:function(t){e.saveApprAction(t,"OPPOSITION")}},{btext:D["\ucde8\uc18c"],btype:"cancel"}]})},doCheck:function(){var e=this;$.goPopup({pclass:"layer_normal layer_approval",header:P["\ud655\uc778\ud558\uae30"],modal:!0,draggable:!0,width:500,contents:e.getActDocument(),buttons:[{btext:P["\ud655\uc778"],btype:"confirm",autoclose:!1,callback:function(t){e.saveApprAction(t,"APPROVAL")}},{btext:D["\ucde8\uc18c"],btype:"cancel"}]})},doInspection:function(){var e=this;$.goPopup({pclass:"layer_normal layer_approval",header:P["\uacb0\uc7ac\ud558\uae30"],modal:!0,draggable:!0,width:500,contents:e.getActDocument(),buttons:[{btext:P["\uc2b9\uc778"],btype:"confirm",autoclose:!1,callback:function(t){e.saveApprAction(t,"APPROVAL")}},{btext:D["\ucde8\uc18c"],btype:"cancel"}]})},doAdvAppr:function(){var e=this,t=[{btext:P["\uc2b9\uc778"],btype:"confirm",autoclose:!1,callback:function(t){e.saveApprAction(t,"ADVAPPROVAL")}},{btext:D["\ucde8\uc18c"],btype:"cancel"}];$.goPopup({pclass:"layer_normal layer_approval",header:P["\uacb0\uc7ac\ud558\uae30"],modal:!0,draggable:!0,width:500,contents:e.getActDocument({nextApproval:!1}),buttons:t})},actWithdrawal:function(){var e=this;$.goPopup({pclass:"layer_normal layer_approval",header:P["\uacb0\uc7ac\ucde8\uc18c"],modal:!0,draggable:!0,width:500,contents:e.getActDocument({inCancel:!0}),buttons:[{btext:D["\ud655\uc778"],btype:"confirm",autoclose:!1,callback:function(t){e.saveApprAction(t,"WITHDRAW")}},{btext:D["\ucde8\uc18c"],btype:"cancel"}]})},actDraftWithdrawal:function(){var e=this;$.goPopup({pclass:"layer_normal layer_approval",header:P["\uc0c1\uc2e0\ucde8\uc18c"],modal:!0,draggable:!0,width:300,contents:e.getActDocument({inCancel:!0,nextApproval:!1}),buttons:[{btext:D["\ud655\uc778"],btype:"confirm",autoclose:!1,callback:function(t){e.saveApprAction(t,"CANCELDRAFT")}},{btext:D["\ucde8\uc18c"],btype:"cancel"}]})},actDraftWithdrawalInprogress:function(){var e=this;if(this.model.docInfoModel.attributes.integrationActive){this.showErrorAlert(P["\uc2dc\uc2a4\ud15c\uacfc \uc5f0\ub3d9\ub41c \ubb38\uc11c\ub294 \ubb38\uc11c \ud68c\uc218\uac00 \ubd88\uac00\ub2a5\ud569\ub2c8\ub2e4."],P["\ubc18\ub824\ub97c \uc694\uccad\ud558\uc2dc\uac70\ub098 \ubb38\uc11c \ub2f4\ub2f9\uc790\uc5d0\uac8c \ubb38\uc758\ud574 \uc8fc\uc138\uc694."]);return}$.goPopup({pclass:"layer_normal layer_approval",header:P["\uc0c1\uc2e0\ucde8\uc18c"],modal:!0,draggable:!0,width:300,contents:e.getActDocument({inCancel:!0,nextApproval:!1}),buttons:[{btext:D["\ud655\uc778"],btype:"confirm",autoclose:!1,callback:function(t){e.saveApprAction(t,"DRAFTWITHDRAW")}},{btext:D["\ucde8\uc18c"],btype:"cancel"}]})},actReceive:function(){var e=this,t=e.model.get("document").documentId,n=new G(t,"receive");$.goConfirm(P["\uc811\uc218 \ud558\uc2dc\uaca0\uc2b5\ub2c8\uae4c?"],"",function(){var r=n.save({},{type:"PUT"});r.done(function(n,r){e.navigateToDocShow(t)}),r.fail(function(e,t){return $.goError(P["\uc811\uc218\uac00 \uc2e4\ud328 \ud558\uc600\uc2b5\ub2c8\ub2e4."]),!1})})},actRereceive:function(){var e=this,t=e.model.get("document").documentId,n=new G(t,"rereceive");$.goConfirm(P["\uc7ac\uc811\uc218 \ud558\uc2dc\uaca0\uc2b5\ub2c8\uae4c?"],"",function(){var r=n.save({},{type:"PUT"});r.done(function(n,r){e.navigateToDocShow(t)}),r.fail(function(e,t){return $.goError(P["\uc7ac\uc811\uc218\uac00 \uc2e4\ud328 \ud558\uc600\uc2b5\ub2c8\ub2e4."]),!1})})},cancelReception:function(){var e=this,t=e.model.get("document").documentId,n=new G(t,"cancel");$.goConfirm(P["\uc811\uc218\ub97c \ucde8\uc18c\ud558\uc2dc\uaca0\uc2b5\ub2c8\uae4c?"],"",function(){var r=n.save({},{type:"PUT"});r.done(function(n,r){e.navigateToDocShow(t)}),r.fail(function(e,t){return $.goError(P["\uc811\uc218\ucde8\uc18c\uac00 \uc2e4\ud328 \ud558\uc600\uc2b5\ub2c8\ub2e4."]),!1})})},returnReception:function(){var e=this,t=e.model.get("document").documentId,n=new G(t,"return");$.goPopup({pclass:"layer_normal layer_approval",header:P["\ubc18\uc1a1\ud558\uae30"],modal:!0,draggable:!0,width:500,contents:e.getActDocument({isRecvReturned:!0}),buttons:[{btext:P["\ubc18\uc1a1"],btype:"confirm",autoclose:!1,callback:function(t){e.saveApprAction(t,"RECV_RETURNED")}},{btext:D["\ucde8\uc18c"],btype:"cancel"}]})},cancelAndReturnReception:function(){var e=this,t=e.model.get("document").documentId,n=new G(t,"receptioncancelandreturn");$.goConfirm(P["\ubc18\uc1a1\ud558\uc2dc\uaca0\uc2b5\ub2c8\uae4c?"],"",function(){var t=n.save({},{type:"PUT"});t.done(function(t,n){e.navigateToBackList()}),t.fail(function(e,t){return $.goError(P["\ubc18\uc1a1\uc774 \uc2e4\ud328 \ud558\uc600\uc2b5\ub2c8\ub2e4."]),!1})})},reassignReceiver:function(){var e=this,t=this.model.get("document"),n=new m({docId:this.docId,receivedDocOwnerDeptId:t.receivedDocOwnerDeptId,receiverDeptId:t.receiverDeptId,receiverDeptName:t.receiverDeptName,receiverUserId:t.receiverUserId,receiverUserName:t.receiverUserName,receiverUserPositionName:t.receiverUserPositionName}),r=$.goPopup({pclass:"layer_normal layer_item_move",header:P["\ub2f4\ub2f9\uc790 \uc9c0\uc815"],modal:!0,width:320,allowPrevPopup:!0,contents:"",buttons:[{btext:P["\ub2f4\ub2f9\uc790 \uc9c0\uc815"],btype:"confirm",autoclose:!1,callback:function(t){n.assignReceiver(function(){t.close(),e.navigateToBackList(),$.goMessage(Y["\ub2f4\ub2f9\uc790\uac00 \uc9c0\uc815\ub418\uc5c8\uc2b5\ub2c8\ub2e4"])},function(){$.goMessage(Y["\ub2f4\ub2f9\uc790\ub97c \uc9c0\uc815\ud560 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4"])})}},{btext:D["\ucde8\uc18c"],btype:"cancel",callback:function(){n.slide&&n.slide.close()}}]});n.render(r,"div.content")},deptFolderCopy:function(){var e=this,t=this.docId,n=new W;if(t!="")var r=$.goPopup({pclass:"layer_normal layer_doc_type_select",header:P["\ubb38\uc11c \ubcf5\uc0ac"],modal:!0,width:300,contents:"",buttons:[{btext:D["\ud655\uc778"],btype:"confirm",autoclose:!1,callback:function(e){var r=e.find(".on span[data-folderid]").attr("data-folderid");if(!r)return $.goError(P["\uc774\ub3d9\ud558\uc2e4 \ubb38\uc11c\ud568\uc744 \uc120\ud0dd\ud574\uc8fc\uc2ed\uc2dc\uc694."],$(".list_wrap ")),!1;t&&(n.setFolderId(r),n.save({documentId:t},{silent:!0,type:"PUT",success:function(t,n){$.goMessage(P["\uc120\ud0dd\ud55c \ud56d\ubaa9\uc774 \ubcf5\uc0ac\ub418\uc5c8\uc2b5\ub2c8\ub2e4"]),e.close()},error:function(e,t){var n=t.responseJSON;return!_.isUndefined(n)&&n.message?($.goError(n.message),!1):($.goError(D["\uc800\uc7a5\uc5d0 \uc2e4\ud328 \ud558\uc600\uc2b5\ub2c8\ub2e4."]),!1)}}))}},{btext:D["\ucde8\uc18c"],btype:"cancel"}]});else $.goError(P["\uc120\ud0dd\ub41c \ud56d\ubaa9\uc774 \uc5c6\uc2b5\ub2c8\ub2e4."]);var i=new N({});i.render(),t!=""&&r.reoffset()},editApprFlow:function(e){var t=this.documentView.getDocBodyContents(),n=this.getTitle();this.model.set({currentDocBodyContent:t,currentTitle:n},{silent:!0});var r=e||null,i=new p({apprDocumentModel:this.model,saveCallback:$.proxy(function(e){this.model.set({apprFlow:e.get("apprFlow"),docInfo:e.get("docInfo")}),this.model.trigger("sync")},this),defaultActiveTab:r});i.render(),r&&$(i)[0].$el.find(".maintab li[data-tabid="+r+"]").click()},editDocument:function(){this.toolbarView.showEditType(),this.documentView.setEditMode(),this.$(".aside_wrapper .reply_wrap .tb_doc_info").remove(),this.$("section.aside_wrapper").append(this.docInfoView.edit().el),this.formIntegrator.onEditDocument()},checkSelfApproval:function(){var e=B.defer();if(!this.model.get("actionCheck").useSelfApproval&&!this.checkActivity())e.reject();else{var t=new u(this.model.get("apprFlow"));t.getAllActivities().length<2?$.goConfirm(P["1\uc778 \uacb0\uc7ac \uc548\ub0b4\ubb38\uad6c"],"",function(){e.resolve()},function(){e.reject()}):e.resolve()}return e.promise},checkActivity:function(){var e=new u(this.model.get("apprFlow"));return e.getAllActivities().length<2?($.goMessage(P["\uacb0\uc7ac\uc120\uc744 \uc9c0\uc815\ud574 \uc8fc\uc138\uc694."]),!1):!0},checkCompleteForm:function(){if(!this.documentView.isCompleteRequiredForm())return $.goMessage(D["\ud544\uc218\ud56d\ubaa9\uc744 \uc785\ub825\ud558\uc9c0 \uc54a\uc558\uc2b5\ub2c8\ub2e4."]),!1;var e=this.documentView.getMaxLengthCheck();return e.result?this.documentView.getTitle().length>255?($.goMessage(GO.i18n(P["\uc120\ud0dd\ub41c \ud56d\ubaa9\uc740 0\uc790 \uc774\ud558\ub85c \uc785\ub825\ud574\uc57c\ud569\ub2c8\ub2e4."],{arg1:255})),this.documentView.setDocFocus("subject"),!1):!0:($.goMessage(GO.i18n(P["\uc120\ud0dd\ub41c \ud56d\ubaa9\uc740 0\uc790 \uc774\ud558\ub85c \uc785\ub825\ud574\uc57c\ud569\ub2c8\ub2e4."],{arg1:e.maxlength})),this.documentView.setDocFocus(e.errorId),!1)},actPostCheck:function(){var e=this,t=[{btext:P["\uc2b9\uc778"],btype:"confirm",autoclose:!1,callback:function(t){e.saveApprAction(t,"POSTCHECK")}},{btext:D["\ucde8\uc18c"],btype:"cancel"}];$.goPopup({pclass:"layer_normal layer_approval",header:P["\uacb0\uc7ac\ud558\uae30"],modal:!0,draggable:!0,width:500,contents:e.getActDocument(),buttons:t})},actPostApproval:function(){var e=this,t=[{btext:P["\uc2b9\uc778"],btype:"confirm",autoclose:!1,callback:function(t){e.saveApprAction(t,"POSTAPPROVAL")}},{btext:D["\ucde8\uc18c"],btype:"cancel"}];$.goPopup({pclass:"layer_normal layer_approval",header:P["\uacb0\uc7ac\ud558\uae30"],modal:!0,draggable:!0,width:500,contents:e.getActDocument(),buttons:t})},saveDocReceive:function(e){var t=this,n=t.model.get("document").documentId,r=t.model.get("actionCheck").receptAddDeptId,i=new K(n,r.join(",")),s=this.docReceiveView.getReaders();if(!t.isExist&&s.length==0)return $.goMessage(P["\uc120\ud0dd\ub41c \ub300\uc0c1\uc774 \uc5c6\uc2b5\ub2c8\ub2e4."]),!1;var o={id:n,docReadingReaders:s};i.set(o,{silent:!0}),i.save({},{type:"PUT",success:function(n,r){r.code==200&&(e.close(),t.isExist&&s.length==0?$.goMessage(P["\uc218\uc2e0\uc790\uac00 \uc0ad\uc81c \ub418\uc5c8\uc2b5\ub2c8\ub2e4."]):$.goMessage(P["\uc218\uc2e0\uc790\uac00 \ucd94\uac00 \ub418\uc5c8\uc2b5\ub2c8\ub2e4."]))},error:function(e,t){var n=t.responseJSON;return!_.isUndefined(n)&&n.message?($.goError(n.message),!1):($.goError(P["\uc218\uc2e0\uc790\ucd94\uac00\uc5d0 \uc2e4\ud328 \ud558\uc600\uc2b5\ub2c8\ub2e4."]),!1)}})},addReader:function(e){var t=$("#addReceive");e&&!t.find('li[data-id="'+e.id+'"]').length?t.find("li.creat").before(s($.extend(e,{lang:Y}))):$.goMessage(P["\uc774\ubbf8 \uc120\ud0dd\ub418\uc5c8\uc2b5\ub2c8\ub2e4."])},actAddFolder:function(){var e=this,t=$.goPopup({pclass:"layer_normal detail_search_wrap layer_approval_reader",header:P["\ubb38\uc11c\ubd84\ub958 \ucd94\uac00"],modal:!0,width:300,contents:"",buttons:[{btext:D["\ud655\uc778"],btype:"confirm",autoclose:!1,callback:function(t){e.saveDocFolder(t)}},{btext:D["\ucde8\uc18c"],btype:"cancel"}]});this.docFolderTypeView=new y({defaultFolder:this.model.get("docInfo").defaultFolder,docId:this.docId}),this.docFolderTypeView.render(),t.reoffset()},saveDocFolder:function(e){var t=new Q(this.model.get("document").documentId),n=this.docFolderTypeView.getFolderIds();if(n.length==0)return $.goMessage(P["\uc120\ud0dd\ub41c \ub300\uc0c1\uc774 \uc5c6\uc2b5\ub2c8\ub2e4."]),!1;t.set({ids:n},{silent:!0}),t.save({},{type:"PUT",success:function(t,n){n.code==200&&(e.close(),$.goMessage(P["\ubb38\uc11c\ud568\uc774 \ucd94\uac00\ub418\uc5c8\uc2b5\ub2c8\ub2e4."]))},error:function(e,t){var n=t.responseJSON;return!_.isUndefined(n)&&n.message?($.goError(n.message),!1):($.goError(P["\ubb38\uc11c\ud568 \ucd94\uac00\uc5d0 \uc2e4\ud328\ud558\uc600\uc2b5\ub2c8\ub2e4."]),!1)}})},showApprChangeLog:function(e){var t=e.docBody,n=e.attaches,r=e.references,i=this.model.get("actionCheck");i.companyDocFolderUseFlag||(r=null);var s="font-size:12px; font-family:\ub3cb\uc6c0,dotum,AppleGothic,arial,Helvetica,sans-serif; color:#3b3b3b; line-height:1.5",o=[{btext:D["\uc778\uc1c4"],btype:"confirm",callback:function(){GO.util.print($("#printArea"))}},{btext:D["\ucde8\uc18c"],btype:"cancel"}];i.isDocReadAuthority||(o=[{btext:D["\ucde8\uc18c"],btype:"cancel"}]);var u=$.goPopup({pclass:"layer_normal layer_approval_preview",header:P["\uacb0\uc7ac\ubb38\uc11c \ubcf4\uae30"],modal:!0,width:900,contents:"",buttons:o}),a=new C({docId:this.model.docId,popup:u,docBody:t,attaches:n,references:r});a.render(),u.reoffset()},convertSelect:function(e){$.each(e.find("select"),function(e,t){var n=$(t).parent("span"),r=n.attr("data-selecttext");$(t).remove(),n.text(r)})},docPrint:function(){var e=this.model.getFullShowUrl()+"/popup/print";window.open(e,"","location=no, directories=no,resizable=yes,status=no,toolbar=no,menubar=no, width=1280,height=650,left=0, top=0, scrollbars=yes")},downloadDocument:function(){window.location.href=GO.contextRoot+"api/approval/document/"+this.docId+"/download"},documentPreview:function(){this.$el.find("#document_content").data("instance",this);var e=window.location.protocol+"//"+window.location.host+GO.contextRoot+"app/approval/document/"+this.docId+"/preview";window.open(e,"docPreview","location=no, directories=no,resizable=yes,status=no,toolbar=no,menubar=no, width=1280,height=650,left=0, top=0, scrollbars=yes")},reassignDept:function(){var e=this,t=this.model.get("document"),n=new g({docId:this.docId,receiverDeptId:t.receiverDeptId,receiverUserId:t.receiverUserId}),r=$.goPopup({pclass:"layer_normal layer_item_move",header:P["\ub2f4\ub2f9\uc790 \ubd80\uc11c \uc9c0\uc815"],modal:!0,width:320,allowPrevPopup:!0,contents:"",buttons:[{btext:D["\ud655\uc778"],btype:"confirm",autoclose:!1,callback:function(t){n.assignReceiver(function(){t.close(),e.navigateToBackList(),$.goMessage(Y["\ub2f4\ub2f9\uc790\uac00 \uc9c0\uc815\ub418\uc5c8\uc2b5\ub2c8\ub2e4"])},function(){$.goMessage(Y["\ub2f4\ub2f9\uc790\ub97c \uc9c0\uc815\ud560 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4"])})}},{btext:D["\ucde8\uc18c"],btype:"cancel",callback:function(){}}]});n.render(r,"div.content")},docTypeSelect:function(){var e=this,t=$.goPopup({pclass:"layer_normal layer_doc_type_select layer_depth",header:P["\uc804\uc0ac\ubb38\uc11c\ud568 \uc120\ud0dd"],modal:!0,width:300,contents:"",buttons:[{btext:D["\ucd94\uac00"],autoclose:!1,btype:"confirm",callback:function(t){var r=n.doc_type_confirm();if(!r)return!1;e.docFolderSelect(!0)}},{btext:D["\ub2eb\uae30"],btype:"cancel"}]}),n=new T({});n.render(),t.reoffset()},docFolderSelect:function(e){var t=this.model.get("document").isReceptionDocument;if(t)return;var n=[],r=$("#addFolder").find("li[data-id]");r.each(function(){n.push({id:$(this).attr("data-id"),parentName:$(this).attr("data-folderName")})},this),this.model.get("docInfo").docFolders=n,this.documentView.setDocClassification(_.pluck(n,"parentName"))},securityLevelSelect:function(){var e=this.model.get("document").isReceptionDocument;if(e)return;this.documentView.setSecurityLevel($("#infoSecurityLevel option:selected").text())},docYearSelect:function(){var e=this.model.get("document").isReceptionDocument;if(e)return;this.documentView.setPreserveDuration($("#docYear option:selected").text())},docReferenceSelect:function(){var e=this.model.get("document").isReceptionDocument;if(e)return;var t=[],n=$("#addReference").find("li[data-id]");n.each(function(){t.push($(this).attr("data-username")+" "+$(this).attr("data-userposition"))}),this.documentView.setDocReference(t)},docReceiveSelect:function(){var e=this.model.get("document").isReceptionDocument;if(e)return;var t=[],n=$("#addReceive").find("li[data-id]");n.each(function(){t.push($(this).attr("data-username")+" "+$(this).attr("data-userposition"))}),this.documentView.setRecipient(t)},release:function(){this.$el.off(),this.$el.empty()},assign:function(e,t){e.setElement(this.$(t)).render()},append:function(e,t){this.$(t).append(e.render().el)},navigateToTodoList:function(e){this.options.isPopup?GO.router.navigate("/approval/document/"+e+"/popup",{trigger:!0}):GO.router.navigate("/approval/todo/all",{trigger:!0})},navigateToDraftList:function(){this.options.isPopup?console.info("navigateToDraftList"):this.model.get("document").docStatus=="TEMPSAVE"?GO.router.navigate("/approval/doclist/tempsave/all",{trigger:!0}):GO.router.navigate("/approval/doclist/draft/all",{trigger:!0})},navigateToDocShow:function(e){this.options.isPopup?GO.router.navigate("/approval/document/"+e+"/popup",{trigger:!0}):GO.router.navigate("/approval/document/"+e,{trigger:!0})},navigateToHome:function(){GO.router.navigate("/approval",{trigger:!0})},navigateToBackList:function(){var e=sessionStorage.getItem("list-history-baseUrl");if(e){var t=$.param(GO.router.getSearch()),n=t?"?"+t:"";GO.router.navigate(e+n,{trigger:!0})}else GO.router.navigate("approval",{trigger:!0})},appliedAutoApprErrorMessage:function(){$.goMessage(P["\uc790\ub3d9\uacb0\uc7ac\uc120 \uc801\uc6a9\ubd80\uc11c \uc624\ub958"])}});return et});