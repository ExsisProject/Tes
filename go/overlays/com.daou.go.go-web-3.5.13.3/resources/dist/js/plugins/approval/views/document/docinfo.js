define(["jquery","underscore","backbone","hgn!approval/templates/document/docinfo","hgn!approval/templates/document/docinfo_view","hgn!approval/templates/add_org_member","i18n!nls/commons","i18n!approval/nls/approval","jquery.go-sdk","jquery.jstree","jquery.go-popup","jquery.go-grid","jquery.go-orgtab","jquery.go-orgslide","jquery.go-validation"],function(e,t,n,r,i,s,o,u){var a={"\ubb38\uc11c\ubc88\ud638":u["\ubb38\uc11c\ubc88\ud638"],"\ubcf4\uc548\ub4f1\uae09":u["\ubcf4\uc548\ub4f1\uae09"],"\ubcf4\uc874\uc5f0\ud55c":u["\ubcf4\uc874\uc5f0\ud55c"],"\uc804\uc0ac\ubb38\uc11c\ud568":u["\uc804\uc0ac\ubb38\uc11c\ud568"],"\ubb38\uc11c\ucc38\uc870":u["\ubb38\uc11c\ucc38\uc870"],"\ubb38\uc11c\uc218\uc2e0":u["\ubb38\uc11c\uc218\uc2e0"],"\uc804\uc0ac\ubb38\uc11c\ud568 \ucd94\uac00":u["\uc804\uc0ac\ubb38\uc11c\ud568 \ucd94\uac00"],"\ucc38\uc870\uc790 \ucd94\uac00":u["\ucc38\uc870\uc790 \ucd94\uac00"],"\uc218\uc2e0\ucc98 \ucd94\uac00":u["\uc218\uc2e0\ucc98 \ucd94\uac00"],"\uc218\uc815\ud558\uae30":u["\uc218\uc815\ud558\uae30"],"\uc0ad\uc81c\ud558\uae30":u["\uc0ad\uc81c\ud558\uae30"],"\uc601\uad6c":u["\uc601\uad6c"],"\ub144":u["\ub144"],"\ub4f1\uae09":u["\ub4f1\uae09"],"\ubbf8\uc9c0\uc815":u["\ubbf8\uc9c0\uc815"],"\uacf5\uac1c\uc5ec\ubd80":u["\uacf5\uac1c\uc5ec\ubd80"],"\uacf5\uac1c":u["\uacf5\uac1c"],"\ube44\uacf5\uac1c":u["\ube44\uacf5\uac1c"],"\ubb38\uc11c\uc5f4\ub78c":u["\ubb38\uc11c\uc5f4\ub78c"],"\uc5f4\ub78c\uc790 \ucd94\uac00":u["\uc5f4\ub78c\uc790 \ucd94\uac00"],"\uc218\uc2e0\uc790 \ucd94\uac00":u["\uc218\uc2e0\uc790 \ucd94\uac00"],"\ubb38\uc11c\uc5f4\ub78c \uc800\uc7a5":u["\ubb38\uc11c\uc5f4\ub78c \uc800\uc7a5"],"\ubb38\uc11c\uc815\ubcf4 \uc800\uc7a5":u["\ubb38\uc11c\uc815\ubcf4 \uc800\uc7a5"],"\uacf5\ubb38\ubc1c\uc1a1":u["\uacf5\ubb38\ubc1c\uc1a1"],"\uae34\uae09":u["\uae34\uae09"],"\uae34\uae09\ubb38\uc11c":u["\uae34\uae09\ubb38\uc11c"],"\uae34\uae09\ubb38\uc11c\uc124\uba85":u["\uae34\uae09\ubb38\uc11c\uc124\uba85"],"\uae30\uc548\ubd80\uc11c":u["\uae30\uc548\ubd80\uc11c"],"\ubd80\uc11c\ubb38\uc11c\ud568":u["\ubd80\uc11c\ubb38\uc11c\ud568"],"\ubbf8\uc9c0\uc815":u["\ubbf8\uc9c0\uc815"],"\uc791\uc131\uc911\ubd80\uc11c\ubcc0\uacbd":u["\uc791\uc131\uc911\ubd80\uc11c\ubcc0\uacbd"]},f=n.Collection.extend({model:n.Model.extend(),initialize:function(e){this.docId=null,e.docId&&(this.docId=e.docId),t.isBoolean(e.isAdmin)&&(this.isAdmin=e.isAdmin)},url:function(){var e="/api/approval/securitylevel";return this.isAdmin&&(e="/ad/api/approval/securitylevel"),this.docId&&(e+="?docId="+this.docId),e}}),l=n.Model.extend({defaults:{preserveDurationInYear:5}},{PRESERVE_YEARS:[1,3,5,10,0]}),c=n.View.extend({tagName:"div",className:"aside_wrapper_body",initialize:function(e){this.options=e||{},this.type=this.options.type,this.isPopup=this.options.isPopup,this.docStatus=this.options.docStatus,this.docInfoModel=this.options.docInfoModel,this.actionModel=this.options.actionModel,this.isComplete=this.options.isComplete,this.isActivityUser=this.options.isActivityUser,this.isReader=this.options.isReader,this.isReceptionDocument=this.options.isReceptionDocument,t.isBoolean(this.options.isAdmin)&&(this.isAdmin=this.options.isAdmin),this.gradeList=new f({docId:e.docId,isAdmin:this.isAdmin?this.isAdmin:!1}),this.isReceivedDoc=!1,this.isReceiveWating=!1,this.gradeList.fetch({async:!1})},events:{'click input[name="openType"]':"docOpenSelect","click #doctype":"docTypeSelect","click #reference":"reference","click #addFolder span.ic_del":"folderDeleteItem","change #infoSecurityLevel":"securityLevelSelect","change #docYear":"docYearSelect","change #emergency":"emergencyChange","change #drafter_draftDeptId":"changeDept","change #drafter_deptFolderId":"changeDeptFolder"},render:function(){var e=this,t=null;return this.docStatus=="CREATE"||this.docStatus=="TEMPSAVE"?t=r:this.docStatus=="RECEIVED"?(t=r,e.isReceivedDoc=!0):this.docStatus=="RECV_WAITING"?(t=r,e.isReceiveWating=!0,e.isReceivedDoc=!0):t=i,e.makeDocInfo(t)},edit:function(e){var t=this;return t.makeDocInfo(r,e)},changeDept:function(){var t=this,n=e("#drafter_draftDeptId").val(),r="";e.goConfirm(u["\uc791\uc131\uc911\ubd80\uc11c\ubcc0\uacbd"],"",function(){var n=e("#drafter_draftDeptId").val(),i=e("#drafter_deptFolderId").val();t.isReceivedDoc?(r="/approval/document/"+options.docId,t.isPopup&&(r+="/popup"),GO.router.navigate(r,{trigger:!0})):t.docStatus=="TEMPSAVE"?t.trigger("tempsavechangedept",n):(r="/approval/document/new/"+n+"/"+t.docInfoModel.formId,t.isPopup&&(r+="/popup"),e.isNumeric(i)&&(r+="?deptFolderId="+i),GO.router.navigate(r,{trigger:!0}))},function(){t.setDefaultDraterDeptId()})},setDefaultDraterDeptId:function(){this.$("#drafter_draftDeptId").val(this.docInfoModel.drafterDeptId)},changeDeptFolder:function(t){this.docInfoModel.drafterDeptFolderId=e(t.currentTarget).find("option:selected").val()},makeDocInfo:function(n,r){var i=this.docInfoModel.securityLevelId,s=this.docInfoModel.docYear;this.yearsModel=new l;var o=t.map(l.PRESERVE_YEARS,function(e){return{value:e,label:e==0?u["\uc601\uad6c"]:e+u["\ub144"],isSelected:this.yearsModel.get("preserveDurationInYear")*1==e*1?!0:!1}},this),f=t.map(this.docInfoModel.drafterDeptFolders,function(e,t){return{value:e.deptId,label:e.deptName,isSelected:e.deptId==this.docInfoModel.drafterDeptId?!0:!1}},this),c=t.findWhere(this.docInfoModel.drafterDeptFolders,{deptId:this.docInfoModel.drafterDeptId}),h=[];c&&(h=t.map(c.deptFolders,function(e,t){return{value:e.folderId,label:e.folderName,isSelected:e.folderId==this.docInfoModel.drafterDeptFolderId?!0:!1}},this));var p=function(){return i==this.id?!0:!1},d=function(){return s==this.value?!0:!1},v=this.docInfoModel.defaultFolder;return v&&e.each(this.docInfoModel.docFolders,function(e,t){t.id==v.id&&(t.isDefault=!0)}),this.$el.html(n({lang:a,docInfo:this.docInfoModel,action:this.actionModel,grade:this.gradeList.toJSON(),isSelectedGrade:p,preserveYears:o,isSelecteYear:d,isComplete:this.isComplete,isReaderModifable:this.isReader||this.isActivityUser,isActivityUser:this.isActivityUser,isReceptionDocument:this.isReceptionDocument,isEmergency:this.docInfoModel.isEmergency,isReceivedDoc:this.isReceivedDoc,isReceiveWating:this.isReceiveWating,draferDepts:f,deptDocFolders:h,isApprDocManager:!!r,isInprogressDoc:this.docStatus=="INPROGRESS"})),this},reference:function(t){var n=this,r=e.goPopup({pclass:"layer_normal",header:u["\ucc38\uc870\uc790 \ucd94\uac00"],modal:!0,width:310,contents:'<form></form><div id="orgtab"></div>',buttons:[{btext:u["\ucd94\uac00"],btype:"confirm",autoclose:!1,callback:function(e){n.addReference(e)}},{btext:o["\ub2eb\uae30"],btype:"cancel"}]});this.orgTab=e.goOrgTab({multiCompanyVisible:n.actionModel.multiCompanySupporting,elId:"orgtab",css:{minHeight:310,maxHeight:310}}),r.find("#orgTree").css({height:"100%"}),r.reoffset()},addReference:function(t){var n=this.orgTab.getSelectedData();if(!n.id)return e.goMessage(u["\uc120\ud0dd\ub41c \ub300\uc0c1\uc774 \uc5c6\uc2b5\ub2c8\ub2e4."]),!1;var r=e("#addReference"),i=n.type==="org"?"true":"false";n&&!r.find('li[data-id="'+n.id+'"][data-deptType="'+i+'"]').length?(r.find("li.creat").before(s(e.extend(n,{lang:a,deptType:i}))),this.trigger("docReferenceSelect")):e.goMessage(u["\uc774\ubbf8 \uc120\ud0dd\ub418\uc5c8\uc2b5\ub2c8\ub2e4."])},receive:function(t){var n=this,r=e.goPopup({pclass:"layer_normal",header:u["\uc218\uc2e0\ucc98 \ucd94\uac00"],modal:!0,width:310,contents:'<form></form><div id="orgtab" style="height:100%"></div>',buttons:[{btext:u["\ucd94\uac00"],btype:"confirm",autoclose:!1,callback:function(e){n.addReceive(e)}},{btext:o["\ub2eb\uae30"],btype:"cancel"}]});this.orgTab=e.goOrgTab({elId:"orgtab",css:{minHeight:310,maxHeight:310}}),r.find("#orgTree").css({height:"100%"}),r.reoffset()},addReceive:function(t){var n=this.orgTab.getSelectedData();if(!n.id)return e.goMessage(u["\uc120\ud0dd\ub41c \ub300\uc0c1\uc774 \uc5c6\uc2b5\ub2c8\ub2e4."]),!1;var r=e("#addReceive"),i=n.type==="org"?"true":"false";n&&!r.find('li[data-id="'+n.id+'"][data-deptType="'+i+'"]').length?(r.find("li.creat").before(s(e.extend(n,{lang:a,deptType:i}))),this.trigger("docReceiveSelect")):e.goMessage(u["\uc774\ubbf8 \uc120\ud0dd\ub418\uc5c8\uc2b5\ub2c8\ub2e4."])},docOpenSelect:function(t){var n=e(t.currentTarget).val();this.docInfoModel.isPublic=n=="true"?!0:!1,this.trigger("docFolderSelect",!0)},emergencyChange:function(t){var n=e(t.currentTarget).is(":checked");this.docInfoModel.isEmergency=n},docTypeSelect:function(){this.trigger("docTypeSelect")},securityLevelSelect:function(){this.trigger("securityLevelSelect")},docYearSelect:function(t){this.docInfoModel.docYear=e(t.currentTarget).find("option:selected").val(),this.trigger("docYearSelect")},docInfoSave:function(){this.trigger("docInfoSave")},docInfoCancel:function(){this.trigger("docInfoCancel")},folderDeleteItem:function(t){e(t.currentTarget).parents("li").remove(),this.trigger("docFolderSelect",!0)},show:function(){this.$el.show()},hide:function(){this.$el.hide()},updateDocInfo:function(e){t.isObject(e)&&(this.docInfoModel=e,this.render())}});return c});