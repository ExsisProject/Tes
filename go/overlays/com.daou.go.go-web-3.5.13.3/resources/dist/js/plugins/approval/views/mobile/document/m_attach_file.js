(function(){define(["jquery","underscore","backbone","i18n!nls/commons","i18n!approval/nls/approval","app","hgn!approval/templates/mobile/document/m_attach_file","GO.m.util"],function(e,t,n,r,i,s,o){var u=null,a={attach_file:i["\ucca8\ubd80\ud30c\uc77c"],save:r["\uc800\uc7a5"],preview:r["\ubbf8\ub9ac\ubcf4\uae30"],download:r["\ub2e4\uc6b4\ub85c\ub4dc"]},f=n.View.extend({initialize:function(e){this.options=e||{},this.options.el||(this.tagName="div",this.className="add_file"),this.attaches=this.options.attaches,this.images=[],this.files=[]},events:{"vclick ul.feed_img a.imageview":"showImages","vclick ul.file_wrap a.filedown":"showFiles","vclick ul.file_wrap span.ic_file_download":"showFiles","vclick ul.file_wrap span.name a":"showFiles","vclick li a.preview":"preview","vclick li a.wrap_ic_file_preview":"preview"},render:function(){var n=this,r="length_",i=0;return e.each(this.attaches,function(e,r){var i=t.clone(r);i.byteSize=i.size,i.size=GO.util.getHumanizedFileSize(i.size),i.thumbSmall&&GO_config.__config__.mobileConfig.useMobilePreview?n.images.push(i):(GO.util.fileExtentionCheck(i.extention)||(i.extention="def"),n.files.push(i))}),this.$el.html(o({lang:a,hasFiles:this.files.length?!0:!1,files:this.files,docId:this.options.docId,useMobilePreview:GO_config.__config__.mobileConfig.useMobilePreview,useMobileSecurity:GO_config.__config__.mobileConfig.useMobileSecurity,isMobileApp:GO_config.__config__.isMobileApp,contextRoot:GO.contextRoot,hasImages:this.images.length?!0:!1,getImageClass:function(){return n.images.length<=4?r+n.images.length:n.images.length==5?r+3:n.images.length==6?r+3:r+4},midImageSize:function(){return n.images.length==1?!0:!1},smallImageSize:function(){return n.images.length>1?!0:!1},isGif:function(){return this.extention.toLowerCase()=="gif"?!0:!1},reoffsetImg:function(){return n.images.length==1?!1:"if($(this).parents('li').height() > this.height) { this.style.marginTop = ($(this).parents('li').height()-this.height)/2 + 'px'; } "},images:this.images,isMobile:GO.util.isMobile()})),this.$el.html()},showFiles:function(t){var n=e(t.currentTarget),r=location.protocol+"//"+window.location.host,i=GO.contextRoot+"api/approval/document/"+this.options.docId+"/download/"+n.attr("data-id"),s=n.attr("title"),o=n.attr("data-size");return GO.util.attachFiles(r+i,s,o),!1},preview:function(t){var n=e(t.currentTarget);return GO.util.preview(n.attr("data-id")),!1},showImages:function(t){var n=this.options.docId,r=[],i=0;$eTarget=e(t.currentTarget),selectedId=$eTarget.attr("data-id"),dataGroup=$eTarget.attr("data-group");if(dataGroup){var s=$eTarget.parents("ul.feed_img").find('a[data-group="'+dataGroup+'"]');e.each(s,function(t,s){var o=e(s);r.push({fileName:o.attr("title"),url:GO.contextRoot+"api/approval/document/"+n+"/download/"+o.attr("data-id")}),o.attr("data-id")==selectedId&&(i=t)})}else r.push({fileName:$eTarget.attr("title"),url:GO.contextRoot+"api/approval/document/"+n+"/download/"+$eTarget.attr("data-id")});return GO.util.attachImages(r,i),!1},resize:function(t){if(!t)return!1;var n=e.Deferred(),r=t.find(".feed_img >li[data-resize!=true]"),i=r.length;return i&&e(r).each(function(t,n){var r=e(n),s=r.find("img");s.attr("src",s.attr("data-src")),i>1&&r.height(r.width()).attr("data-resize",!0)}),n.resolveWith(this,[this]),n}});return{render:function(e){return u=new f(e),u.render()},resize:function(e){u&&u.resize(e)},initImageView:function(t){t&&u&&(this.resize(t),t.off("click","ul.feed_img a.imageview"),t.off("click","ul.file_wrap a.filedown"),t.off("click","li a.preview"),t.on("click","ul.feed_img a.imageview",e.proxy(u.showImages,this)),t.on("click","ul.file_wrap a.filedown",e.proxy(u.showFiles,this)),t.on("click","li a.preview",e.proxy(u.preview,this)))}}})}).call(this);