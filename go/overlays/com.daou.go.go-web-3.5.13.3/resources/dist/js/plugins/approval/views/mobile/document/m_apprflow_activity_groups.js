define(["backbone","approval/models/activity","approval/models/activity_groups_setter","approval/collections/activities","approval/collections/appr_lines","hgn!approval/templates/mobile/document/m_apprflow_activity_groups","hgn!approval/templates/mobile/document/m_apprflow_my_lines","approval/views/mobile/document/m_apprflow_activity_group","i18n!nls/commons","i18n!approval/nls/approval","jquery.go-popup"],function(e,t,n,r,i,s,o,u,a,f){var l={my_lines:f["\ub098\uc758\uacb0\uc7ac\uc120"],agreement_type:f["\ud569\uc758\ubc29\uc2dd"],agreement_linear:f["\uc21c\ucc28\ud569\uc758"],agreement_parallel:f["\ubcd1\ub82c\ud569\uc758"],msg_empty_my_lines:f["\uac1c\uc778 \uacb0\uc7ac\uc120\uc774 \uc5c6\uc2b5\ub2c8\ub2e4."],my_save:f["\ub0b4\uac00 \uc800\uc7a5\ud55c \uacb0\uc7ac\uc120 \ubaa9\ub85d"],only_pc_modify:f["\uc218\uc815\uc740 \uc624\uc9c1 PC"]},c=e.View.extend({actionCheck:null,index:null,isNullGroup:!1,isArbitraryCheckVisible:!1,__disabled__:!1,events:{"click #myApprFlowButton":"_myApprFlowButton","click #myApprFlowList li a[data-id]":"_selectApprFlow"},initialize:function(e){e=e||{},this.observer=e.observer,this.activityGroups=e.activityGroups,this.actionCheck=e.actionCheck,this.isArbitraryCheckVisible=e.isArbitraryCheckVisible,this.isPermissibleArbitraryDecision=e.isPermissibleArbitraryDecision,this.disable=e.disable,this.includeAgreement=e.includeAgreement,this.apprAllowType=e.apprAllowType,this.isReceiveDoc=e.isReceiveDoc||!1,this.docStatus=e.docStatus,this.__disabled__=!1,_.isNull(this.model)&&(this.isNullGroup=!0),this.observer.bind("saveApprFlowActivityGroups",this.saveApprFlowActivityGroups,this),this.listenTo(this.activityGroups,"change add remove",_.bind(function(){this.activityGruopsTemp=this.activityGroups.toJSON(),this.model.set("apprFlowChanged",!0)},this))},render:function(){var e=s({lang:l,useParallelAgreement:this.model.get("apprFlow").useParallelAgreement});return this.$el.html(e),this._renderMyApprovalList(),this._renderGroups(),this._judgeDisabledAgreement(),this},_judgeDisabledAgreement:function(){var e=this.$el.find("input[name=useParallelAgreement]");if(this.docStatus=="INPROGRESS"){e.attr("disabled",!0);return}this.disable?e.attr("disabled",!0):e.attr("disabled",!1)},_renderMyApprovalList:function(){this.disable?this.$el.find("div.box.my").hide():(this.apprLineCollection=new i,this.apprLineCollection.fetch({success:$.proxy(this._renderMyLineList,this)}))},_renderGroups:function(){var e=this;this.$el.find("#activityGroupsWrap").html(""),this.activityGroups.forEach(function(t,n){var r=new u({model:t,observer:e.observer,actionCheck:e.actionCheck,isArbitraryCheckVisible:e.isArbitraryCheckVisible,isPermissibleArbitraryDecision:e.isPermissibleArbitraryDecision,index:n,disable:e.disable,includeAgreement:e.includeAgreement,apprAllowType:e.apprAllowType,isReceiveDoc:e.isReceiveDoc,docStatus:e.docStatus});r.render(),e.$el.find("#activityGroupsWrap").append(r.$el)})},_myApprFlowButton:function(e){var t=$(e.currentTarget);t.toggleClass("on"),t.hasClass("on")?$("#myApprFlowList").slideDown(300):$("#myApprFlowList").slideUp(300)},_renderMyLineList:function(e,t,n){var r=this.docStatus=="CREATE"||this.docStatus=="TEMPSAVE";$("#myApprFlowList").html(o({lang:l,hasMyLines:!e.isEmpty(),myLines:e.map(function(e){var t=0;return $.each(e.get("activityGroups"),function(){t+=this.activities.length}),{id:e.get("id"),title:e.get("title"),groupCount:t}})}))},_selectApprFlow:function(e){e.preventDefault();var t=$(e.currentTarget),n=this.apprLineCollection.get(t.attr("data-id"));this._replaceActivityGroupsByMyLine(n.get("activityGroups"),n.get("useParallelAgreement")),this._renderGroups()},_replaceActivityGroupsByMyLine:function(e,t){var r=new n(null,{assignedActivityDeletable:this.actionCheck.assignedActivityDeletable,actionCheck:this.actionCheck,original:this.activityGroups.toJSON(),includeAgreement:this.includeAgreement,apprAllowType:this.apprAllowType});try{var i=r.makeData(e);this.activityGruopsTemp=i,$("input[name=useParallelAgreement][value="+t+"]").prop("checked",!0),this.activityGroups.reset(i)}catch(s){console.log(s),alert(s.message)}},saveApprFlowActivityGroups:function(){var e=this.model.get("apprFlow");this.activityGruopsTemp&&(e.activityGroups=this.activityGruopsTemp),e.useParallelAgreement=$("input[name=useParallelAgreement]:checked").val()==="true"},disable:function(){this.__disabled__=!0},isDisabled:function(){return this.__disabled__}});return c});