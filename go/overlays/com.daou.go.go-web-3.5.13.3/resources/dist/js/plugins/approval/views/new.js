(function(){define(["jquery","underscore","backbone","app","approval/views/form_detail","approval/views/apprform/appr_form_searchTree","hgn!approval/templates/new_layer","i18n!nls/commons","i18n!approval/nls/approval","jquery.jstree"],function(e,t,n,r,i,s,o,u,a){var f=null,l,c={"\uc790\uc8fc\uc4f0\ub294 \uc591\uc2dd\uc73c\ub85c \ucd94\uac00":a["\uc790\uc8fc\uc4f0\ub294 \uc591\uc2dd\uc73c\ub85c \ucd94\uac00"],"\uc591\uc2dd\uba85":a["\uc591\uc2dd\uba85"],"\uc0c1\uc138\uc815\ubcf4":a["\uc0c1\uc138\uc815\ubcf4"],"\uac80\uc0c9":u["\uac80\uc0c9"]},h=n.Model.extend({model:n.Model.extend(),url:function(){return"/api/approval/favorite"}}),p=n.View.extend({searchTreeView:null,formListView:null,saveFavoriteCallBack:null,el:".go_popup .content",events:{"click a#addFavorite":"addFavorite"},initialize:function(e){this.options=e||{},this.deptFolderInfos=this.options.deptFolderInfos,this.drafterDeptFolderInfos=this.options.drafterDeptFolderInfos,t.isFunction(this.options.saveFavoriteCallBack)&&(this.saveFavoriteCallBack=this.options.saveFavoriteCallBack)},render:function(){var n=o({lang:c});this.$el.html(n),this.searchTreeView=new s({isAdmin:!1,elId:"appr_form_searchTree",treeElId:"formTree",inputMaxLength:20,searchInputId:"searchInput",searchResultElId:"searchResult",selectCallback:e.proxy(function(e){var t=this.$el.find("#form_detail_tbody");t.length>0&&t.remove(),e["type"]==["FORM"]?this.formDetailView.formDetail(e.id):this.formDetailView.emptyDetail()},this)}),this.formDetailView=new i({deptFolderInfos:this.deptFolderInfos,drafterDeptFolderInfos:this.drafterDeptFolderInfos}),this.searchTreeView.render(),this.formDetailView.render().emptyDetail();if(!e.isArray(this.drafterDeptFolderInfos)||e.isEmptyObject(this.drafterDeptFolderInfos)||t.isEmpty(this.drafterDeptFolderInfos))e("#favorite_form").hide(),e("a.btn_major_s").hide()},addFavorite:function(){var t=this,n=new h,r=e("#draftDeptId").val();this.formId=e("#form_title").attr("data-formId");var i=this.formId;if(!i)return e.goError(a["\uc591\uc2dd\uc744 \uc120\ud0dd\ud574 \uc8fc\uc138\uc694."]),!1;n.set({deptId:r,formId:i},{silent:!0}),n.save({},{async:!1,type:"POST",success:function(){t.saveFavoriteCallBack(!0)},error:function(){return!r||!i?(e.goError(a["\uc591\uc2dd\uc744 \uc120\ud0dd\ud574 \uc8fc\uc138\uc694."]),!1):(e.goError(a["\uc774\ubbf8 \ucd94\uac00\ud55c \ud3fc\uc785\ub2c8\ub2e4."]),!1)}})},release:function(){this.$el.off(),this.$el.empty()}});return p})}).call(this);