define(["jquery","underscore","backbone","app","approval/views/content_top","approval/views/doclist/folderlist_item","approval/views/doclist/doclist_item","approval/views/doclist/dept_folder_doclist","approval/views/doclist/dept_reception_doclist","views/pagination","views/pagesize","approval/models/folderlist_item","approval/collections/dept_folder_doclist","approval/collections/dept_doc_folders","collections/dept_descendants","hgn!approval/templates/doclist_empty","hgn!approval/templates/child_dept_folderlist","i18n!nls/commons","i18n!approval/nls/approval"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y){return n.View.extend({el:"#content",columns:{"\ubd80\uc11c\uba85":y.\ubd80\uc11c\uba85,"\ubb38\uc11c\ud568":y.\ubb38\uc11c\ud568,"\ubb38\uc11c\uc218":y.\ubb38\uc11c\uc218,"\uc0dd\uc131\uc77c":y.\uc0dd\uc131\uc77c,count:4},events:{"change select#childDeptSelect":"onDeptSelected","click td.sub_dept_folder_name":"onFolderClicked"},initialize:function(e){this.deptId=e,this.contentTop=i.getInstance(),this.deptDescendantCollection=new d,this.docCollection=null},render:function(){this._renderBasic(),this._renderDeptDescendants(),this.deptId?this._renderFolders(this.deptId):this._renderEmptyFolders()},_renderBasic:function(){this.$el.html(m({columns:this.columns})),this.contentTop.setTitle(y["\ud558\uc704 \ubd80\uc11c \ubb38\uc11c\ud568"]),this.contentTop.render(),this.$el.find("header.content_top").replaceWith(this.contentTop.el),this.$tbody=this.$el.find("table.list_approval > tbody"),this.$deptSelect=this.$el.find("div.critical:first")},_renderDeptDescendants:function(){var e=this.$deptSelect,n=this.deptId,r=function(r){var i=[];i.push('<select id="childDeptSelect" style="margin-top:2px">'),i.push("{{#hasDeptList}}"),i.push('    <option style="display:none" selected="selected">{{lang.selectDescendant}}</option>'),i.push("    {{#deptList}}"),i.push("    <option value={{id}}>{{name}}</option>"),i.push("    {{/deptList}}"),i.push("{{/hasDeptList}}"),i.push("{{^hasDeptList}}"),i.push("    <option>{{lang.noDescendants}}</option>"),i.push("{{/hasDeptList}}"),i.push("</select>"),e.html(Hogan.compile(i.join("")).render({deptList:r,hasDeptList:!t.isEmpty(r),lang:{noDescendants:g["\ud558\uc704 \ubd80\uc11c\uac00 \uc5c6\uc2b5\ub2c8\ub2e4."],selectDescendant:g["\ud558\uc704 \ubd80\uc11c \uc120\ud0dd"]}})),n&&e.children().eq(0).val(n)};this.deptDescendantCollection.fetch({success:function(e){r(e.toJSON())},error:function(){r([])}})},onDeptSelected:function(t){var n=e(t.currentTarget),i=n.val();r.router.navigate("approval/deptfolder/subfolder/"+i,{trigger:!0,pushState:!0})},_renderEmptyFolders:function(){var e=[];e.push('<tr><td valign="top" class="dataTables_empty align_c" colspan="4">'),e.push('    <p class="data_null">'),e.push('        <span class="ic_data_type ic_no_contents"></span>'),e.push('        <span class="txt">{{lang.selectDept}}</span>'),e.push("        <br>"),e.push("    </p>"),e.push("</td></tr>"),this.$tbody.html(Hogan.compile(e.join("")).render({lang:{selectDept:y["\ud558\uc704 \ubd80\uc11c \uc120\ud0dd \uc548\ub0b4 \uba54\uc2dc\uc9c0"]}}))},_renderFolders:function(n){var i=this.$tbody,s=function(e){var t=[];t.push("{{#folders}}"),t.push('<tr data-id="{{id}}" data-type="{{folderType}}" data-deptid="{{deptId}}">'),t.push('    <td class="first"><span class="txt">{{deptName}}</span></td>'),t.push('    <td class="sub_dept_folder_name"><a><span class="txt">{{folderName}}</span></a></td>'),t.push('    <td class=""><span class="txt">{{createdAt}}</span></td>'),t.push('    <td class=""><span class="txt">{{docCount}}</span></td>'),t.push("</tr>"),t.push("{{/folders}}"),i.html(Hogan.compile(t.join("")).render({folders:e}))};(new p(n,!0)).fetch({success:e.proxy(function(e){s(t.map(e.toJSON(),function(e){return t.extend(e,{createdAt:r.util.shortDate(e.createdAt)})}))},this),error:function(){e.goMessage(g["500 \uc624\ub958\ud398\uc774\uc9c0 \ud0c0\uc774\ud2c0"])}})},onFolderClicked:function(t){var n=e(t.target),i=n.parents("tr[data-id]"),s=i.attr("data-type"),o=i.attr("data-id"),u=i.attr("data-deptid"),a="";switch(s){case"DRAFT":a="approval/deptfolder/draft/"+u;break;case"RECEPTION":a="approval/deptfolder/receive/"+u+"/all";break;case"REFERENCE":a="approval/deptfolder/reference/"+u;break;case"OFFICIAL":a="approval/deptfolder/official/"+u;break;default:a="approval/deptfolder/"+o+"/documents"}r.router.navigate(a,{trigger:!0,pushState:!0})},release:function(){this.$el.off(),this.$el.empty()}})});