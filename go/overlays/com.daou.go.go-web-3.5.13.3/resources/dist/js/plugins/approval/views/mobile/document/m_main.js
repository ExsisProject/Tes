(function(){define(["jquery","backbone","hogan","app","approval/models/doclist_item","approval/models/appr_flow","approval/models/document","approval/models/user_appr_config","approval/collections/appr_flows","approval/views/mobile/document/m_apprflow","approval/views/mobile/document/m_apprflow_line","views/mobile/header_toolbar","views/mobile/m_font_resize","approval/views/mobile/document/m_toolbar","approval/components/appr_form_integrator","approval/views/mobile/document/m_create_docinfo","approval/views/mobile/document/m_document","approval/views/mobile/document/m_appr_attach_file","approval/views/mobile/document/m_docinfo","approval/views/mobile/document/m_action_document","approval/views/mobile/document/m_doc_receive","approval/views/mobile/document/m_apprflow_edit","approval/views/mobile/document/m_appr_receiver_popup","approval/views/mobile/document/m_preview","hgn!approval/templates/mobile/document/m_main","hgn!approval/templates/mobile/document/m_create_draft","i18n!nls/commons","i18n!approval/nls/approval","jquery.go-validation","GO.util","iscroll"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k){function I(e,t,n){e.changeActivityGroups(t.apprFlow.activityGroups,n)}var L={approval:k["\uc804\uc790\uacb0\uc7ac"],move_to_home:C["\ud648\uc73c\ub85c \uc774\ub3d9"]},A=t.Model.extend({initialize:function(e){this.docId=e},url:function(){var e=["/api/approval/document",this.docId,"approval"].join("/");return e}}),O=o.extend({initialize:function(e){this.options=e||{},_.isEmpty(this.options.docId)||(this.docId=this.options.docId),o.prototype.initialize.apply(this,arguments)},url:function(){return this.docId?"/api/approval/document/"+this.docId:"/api/approval/document/"},setId:function(e){this.docId=e}}),M=t.Model.extend({initialize:function(e,t){this.docId=e,this.deptId=t},url:function(){var e=["/api/approval/document",this.docId,"receptionreader",this.deptId].join("/");return e}}),D=t.Model.extend({validTypes:["receive","cancel","return","rereceive","receptioncancelandreturn"],initialize:function(e,t){_.contains(this.validTypes,t)?this.type=t:this.type="receive",this.docId=e},url:function(){var e="reception";switch(this.type){case"cancel":e="receptioncancel";break;case"return":e="receptionreturn";break;case"rereceive":e="rereception";break;case"receptioncancelandreturn":e="receptioncancelandreturn";break;default:}return["/api/approval/document",this.docId,e].join("/")}}),P=t.Model.extend({initialize:function(e){this.docId=e},url:function(){var e=["/api/approval/document",this.docId,"draft"].join("/");return e}}),H=o.extend({initialize:function(e,t){this.options=t||{},t.formId&&(this.formId=t.formId),t.deptId&&(this.deptId=t.deptId),t.deptFolderId&&(this.deptFolderId=t.deptFolderId),o.prototype.initialize.apply(this,arguments)},url:function(){var t={formId:this.formId,deptId:this.deptId};e.isNumeric(this.deptFolderId)&&(t.deptFolderId=this.deptFolderId);var n="/api/approval/document/new?"+e.param(t);return n},getShowUrl:function(){var e=this.deptId.split("?")[0],t=this.formId.split("?")[0];return"/approval/document/new/"+e+"/"+t},getFullShowUrl:function(){return window.location.protocol+"//"+window.location.host+r.contextRoot+"app"+this.getShowUrl()}},{create:function(e,t,n){return new H({},{formId:e,deptId:t,deptFolderId:n})}}),B=o.extend({initialize:function(e,t){this.options=t||{},this.docId=this.options.docId,o.prototype.initialize.apply(this,arguments)},url:function(){var e="/api/approval/document/"+this.docId+"/reapply";return e},getShowUrl:function(){var e=this.docId.split("?")[0];return"/approval/document/"+e+"/reapply"},getFullShowUrl:function(){return window.location.protocol+"//"+window.location.host+r.contextRoot+"app"+this.getShowUrl()}},{create:function(e){return new B({},{docId:e})}}),j=t.Collection.extend({url:function(){return"/api/approval/apprform/tree/mobile"},isInclude:function(e){var t=this;return t.isIncludeForm=!1,this.toJSON().forEach(function(n){n.metadata.id==e&&(t.isIncludeForm=!0)}),t.isIncludeForm}}),F=t.View.extend({el:"#content",initialize:function(e){var t=this;this.allowAction=!0,r.util.appLoading(!0),this.options=e||{},this.formId=this.options.formId,this.deptId=this.options.deptId,this.deptFolderId=r.util.getQueryParam("deptFolderId"),this.docId=this.options.docId,this.refDocId=this.options.refDocId,this.docType=this.options.docType,this.type=_.isUndefined(this.options.type)?"DOCUMENT":this.options.type,this.formIntegrator=new d,this.mobileDraftableFormCollection=new j,this.mobileDraftableFormCollection.fetch({async:!1}),this.type=="CREATE"?this.model=H.create(this.formId,this.deptId,null):this.type=="REAPPLY"?this.model=B.create(this.docId):this.model=new O({docId:this.options.docId}),this.documentModelFetch()},documentModelFetch:function(){var e=this;this.model.fetch({async:!1,success:function(t,n){e.initDocument()},error:function(e,t){r.util.linkToErrorPage(t)},reset:!0})},initDocument:function(){this.docId=this.model.get("document").documentId,this.isPublic=this.model.get("docInfo").isPublic,this.isPassword=this.model.get("actionCheck").usePassword,this.formIntegrator.setDocVariables(this.model.get("document").variables),this.formIntegrator.setStatus(this.type=="REAPPLY"?this.type:this.model.get("document").docStatus);var t=this.model.get("document").docStatus;this.listenTo(this.model,"add",this.changeApprFlowAndDocInfo,this),this.headerToolbarView=c,this.toolBarData={actionMenu:this.getActionMenu()},t=="CREATE"||t=="TEMPSAVE"?(this.toolBarData.isClose=!0,this.toolBarData.closeCallback=e.proxy(this.tempSaveDocument,this)):this.toolBarData.isPrev=!0,this.initWindowEvent(),this.toolbarBindEvent(),this.documentView=new m({type:this.type,title:this.title,docId:this.model.get("document").documentId,model:this.model.get("document"),infoData:this.model.get("docInfo"),actionModel:this.model.get("actionCheck"),formIntegrator:this.formIntegrator}),this.documentView.bind("docPreview",this.docPreview,this),this.createApprFlowView(),this.docInfoView=new y({type:this.type,docId:this.model.get("document").documentId,docStatus:this.model.get("document").docStatus,docInfoModel:this.model.get("docInfo"),actionModel:this.model.get("actionCheck"),isComplete:this.model.get("document").docStatus=="COMPLETE"?!0:!1,isActivityUser:this.model.get("actionCheck").isActivityUser,isReader:this.model.get("actionCheck").isReader,isReceptionDocument:this.model.get("document").isReceptionDocument}),this.apprAttachFileView=new g({docModel:this.model.get("document"),toolBarData:this.toolBarData,mode:this.isTempsaveOrReapply()?"edit":"read"})},render:function(){this.type=="CREATE"||this.type=="INTEGRATION"?this.renderDraft():this.renderView(),this.useAutoApprFlow()&&(this.bindAutoFlowComponentEvent(),this.reSetApprFlowView())},useAutoApprFlow:function(){return this.model.get("useAutoApprFlow")&&(this.isTempsaveOrReapply()||this.type=="CREATE"||this.type=="INTEGRATION"||this.type=="DOCUMENT"&&this.model.get("document").docStatus=="CREATE")},hasAutoFlowOptionComponent:function(){return this.documentView.$el.find('[name="apprLineRuleOption"]').length>0},hasAutoFlowAmountComponent:function(){return this.documentView.$el.find('[name="apprLineRuleAmount"]').length>0},getTargetAutoApprFlowModel:function(){var e=new s(this.model.get("autoApprFlow")),t=new a(e.get("autoApprFlows")),n=this.documentView.$el.find('[name="apprLineRuleOption"]'),r,i,o,u=0,f;return this.hasAutoFlowOptionComponent()?"select"==n.prop("tagName").toLowerCase()?(f=n.find("option:selected"),u=n.find("option").index(f)):"radio"==n.eq(0).prop("type").toLowerCase()&&(f=this.documentView.$el.find('[name="apprLineRuleOption"]:checked'),u=n.index(f)):u=0,t.at(u)},hasDupleDraftActivities:function(e){var t=_.first(e.activities).userId;return _.where(e.activities,{userId:t}).length>1},bindAutoFlowComponentEvent:function(){this.hasAutoFlowOptionComponent()&&(this.documentView.$el.find('[name="apprLineRuleOption"]').off("change"),this.documentView.$el.find('[name="apprLineRuleOption"]').on("change",_.bind(this.reSetApprFlowView,this)));var e=this.getTargetAutoApprFlowModel(),t=_.first(e.get("activityGroups")),n=!1;_.each(t.activities,function(e){if(!_.isUndefined(e.moreAmount)||!_.isUndefined(e.underAmount))n=e.type=="DRAFT"?!1:!0}),n&&this.hasAutoFlowAmountComponent()&&(this.documentView.$el.find('[name="apprLineRuleAmount"]').off("change"),this.documentView.$el.find('[name="apprLineRuleAmount"]').on("change",_.bind(this.reSetApprFlowView,this)))},getActivitiesByAmount:function(e,t,n){var r=this,i=_.clone(e),s=[],o=this.documentView.$el.find('[name="apprLineRuleAmount"]'),u=!0,a=null;if(r.hasAutoFlowAmountComponent()){var f=parseFloat(o.inputmask("unmaskedvalue"))||0;_.each(i.activities,function(e){var t=e.moreAmount!=null?e.moreAmount:null,n=e.underAmount!=null?e.underAmount:null;e.type!="DRAFT"&&!a&&(a=e),f>=t&&f<n?(s.push(e),u=!1):t!=null&&f>=t&&n==null?(s.push(e),u=!1):e.type=="DRAFT"&&s.push(e)})}return i.requireArbitaryDesision&&u&&a!=null&&s.push(a),i.activities=s,i},getAvailableActivities:function(e,t){var n=_.clone(e),r=_.first(n.activities).userId,i=[],s=this.hasDupleDraftActivities(n);if(s){var o=0;_.each(n.activities,function(e,t){e.userId==r&&(o=t)});var u=n.activities.slice(0,1),a;a=n.activities.slice(o+1),t?a=n.activities.slice(o):a=n.activities.slice(o+1),n.activities=u.concat(a)}return n},removeDupleActivityGroup:function(e){var t=_.first(e.activities).userId,n=e.activities,r=[];return _.each(n,function(e,i){e.userId==t?r.push(e):_.findWhere(n.slice(i+1),{userId:e.userId})||r.push(e)},this),e.activities=r,e},reSetApprFlowView:function(){var e=this.getTargetAutoApprFlowModel(),t=_.first(e.get("activityGroups")),n=!1;_.each(t.activities,function(e){if(!_.isUndefined(e.moreAmount)||!_.isUndefined(e.underAmount))n=e.type=="DRAFT"?!1:!0},this);if(t.activities.length>0){var r=this.hasDupleDraftActivities(t);t=this.getAvailableActivities(t,n);var i=t.requireArbitaryDesision;n?e.set("activityGroups",[this.removeDupleActivityGroup(this.getActivitiesByAmount(t,i,r))]):e.set("activityGroups",[this.removeDupleActivityGroup(t)])}var s=this.model.get("apprFlow"),o=s.activityGroups,u=_.findIndex(o,function(e){return e.useApprLineRule});o[u]=_.first(e.get("activityGroups")),this.model.set("apprFlow",s),this.syncApprFlowLine(),this.syncApprFlowView()},renderDraft:function(){this.createDocInfo=new v({isCreate:!0,documentModel:this.model.get("document"),drafterDeptFolderInfos:this.drafterDeptFolderInfos,mobileDraftableFormCollection:this.mobileDraftableFormCollection,formId:this.formId,deptId:this.deptId,docInfo:this.model.get("docInfo"),apprLineModel:this.model.get("apprFlow")}),this.$el.html(N()),this.headerToolbarView.render(this.toolBarData),this.assign(this.toolbarView,"div.tool_bar"),this.documentView.setElement(this.$("#document_view")).render().then().otherwise(function(){alert(k["\uc5f0\ub3d9 \uc591\uc2dd \uc2a4\ud06c\ub9bd\ud2b8 \uacbd\ub85c\uac00 \uc720\ud6a8\ud558\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4."])}),this.append(this.docInfoView,"#docinfo_section"),this.assign(this.createDocInfo,"#doc_header"),this.append(this.apprAttachFileView,"#draft_appr_attach_body"),this.apprAttachFileView.attachFileUploader(),this.formId&&e("#formSelect").val(this.formId),this.docInfoView.$el.hide(),this.documentView.$el.parent().show(),this.contentViewEvent(),r.util.appLoading(!1)},renderView:function(){var t=this;this.allowAction=!0,e('div[data-role="layer"]').length&&e('div[data-role="layer"]').remove(),this.createDocInfo=new v({isCreate:!1,mobileDraftableFormCollection:this.mobileDraftableFormCollection,documentModel:this.model.get("document"),docInfo:this.model.get("docInfo"),formId:this.formId,apprLineModel:this.model.get("apprFlow")}),this.$el.html(T()),this.headerToolbarView.render(this.toolBarData),e("#headerToolbar").removeClass("check_nav"),this.assign(this.toolbarView,"div.tool_bar"),this.append(this.docInfoView,"#docinfo_section"),this.assign(this.createDocInfo,"#doc_header"),this.documentView.setElement(this.$("#document_view")).render().then(function(){t.isTempsaveOrReapply()||t.fontResizeLayerAdd()}).otherwise(function(){alert(k["\uc5f0\ub3d9 \uc591\uc2dd \uc2a4\ud06c\ub9bd\ud2b8 \uacbd\ub85c\uac00 \uc720\ud6a8\ud558\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4."])}),this.isTempsaveOrReapply()&&(this.append(this.apprAttachFileView,"#draft_appr_attach_body"),this.mobileDraftableFormCollection.isInclude(this.model.get("docInfo").formId)||alert(k["\ubaa8\ubc14\uc77c \uae30\uc548 \ud5c8\uc6a9 \ubb38\uc11c\uac00 \uc544\ub2d9\ub2c8\ub2e4"])),this.apprAttachFileView.attachFileUploader(),this.contentViewEvent(),this.show_document(),this.$el.find("#activityCommentCount").text(this.getActivityCommentCount(this.model.get("apprFlow").activityGroups)),r.util.appLoading(!1),this.model.get("document").isDeletedDeptRcvDoc&&this.model.get("document").docStatus=="RECEIVED"&&alert(k["\ubb38\uc11c \uc218\uc2e0 \ubd80\uc11c\uac00 \uc0ad\uc81c \uc548\ub0b4"])},fontResizeLayerAdd:function(){h.render({el:"#fontResizeWrap",targetContentEl:"#document_content"})},getActionMenu:function(){var e=this.checkIsDeputyActivity();return this.toolbarView=new p({type:this.type,toolbarModel:this.model.get("actionCheck"),docStatus:this.model.get("document").docStatus,userId:r.session().id,drafterId:this.model.get("document").drafterId,isDraftable:this.mobileDraftableFormCollection.isInclude(this.model.get("docInfo").formId)||this.type=="INTEGRATION",isAgreement:this.checkIsAgreement(),isReceptionDocument:this.model.get("document").isReceptionDocument,isDeletedDeptRcvDoc:this.model.get("document").isDeletedDeptRcvDoc,isPublic:this.isPublic,checkIsDeputyActivity:e,commentsCount:this.model.get("document").commentCount}),this.toolbarView.render()},changeApprFlowAndDocInfo:function(){var e=this.model.get("apprFlow");this.model.availableUpdateDocMetaInfo(this.type)&&(_.isUndefined(this.model.get("document").apprFlowVersionId)||(e.apprFlowVersionId=this.model.get("document").apprFlowVersionId),this.model.Request.updateDocMetainfo(null,{success:function(e){},error:function(e,t){var n=JSON.parse(t.responseText),r=n.message;r?alert(r):alert(C["\uc2e4\ud328\ud588\uc2b5\ub2c8\ub2e4."])}})),this.docInfoView.updateDocInfo(this.model.get("docInfo"))},contentViewEvent:function(){var t=this;e("div").on("click","#contentViewBtn",function(){t.show_document();var n=e("#selectDocInfo").find("option[value='show_document']"),r=n.text();e("#selectDocInfo").closest("a").find("span.txt").text(r),n.prop("selected",!0)})},getActivityCommentCount:function(e){var t=0;return e.forEach(function(e){var n=e.activities;n.forEach(function(e){e.comment&&t++})}),t},initWindowEvent:function(){e(window).off("scroll"),this.orientationWindowEvent={name:"orientation",event:function(){if(this.type=="CREATE"||this.type=="DOCUMENT")return;this.$el.empty(),this.render()}},this.setTimeoutToWindowEventHandler(this.orientationWindowEvent)},setTimeoutToWindowEventHandler:function(t){var n=this;e(window).on(t.name,function(){this.timeout&&clearTimeout(this.timeout),this.timeout=setTimeout(e.proxy(t.event,n),200)})},unbindWindowEvent:function(t){e(window).off(t)},toolbarBindEvent:function(){r.EventEmitter.off("approval"),r.EventEmitter.on("approval","act_draft",this.draftDocument,this),r.EventEmitter.on("approval","act_tempsave",this.tempSaveDocument,this),r.EventEmitter.on("approval","act_reapply",this.reapplyDocument,this),r.EventEmitter.on("approval","show_apprflow_list",this.showApprFlowList,this),r.EventEmitter.on("approval","approval_preview",this.doPreview,this),r.EventEmitter.on("approval","draftCanceled",this.cancelDraft,this),r.EventEmitter.on("approval","approved",this.doApprove,this),r.EventEmitter.on("approval","returned",this.doReturn,this),r.EventEmitter.on("approval","holded",this.doHold,this),r.EventEmitter.on("approval","agreed",this.doAgree,this),r.EventEmitter.on("approval","disagreed",this.doDisagree,this),r.EventEmitter.on("approval","checked",this.doCheck,this),r.EventEmitter.on("approval","inspected",this.doInspection,this),r.EventEmitter.on("approval","actAdvAppr",this.doAdvAppr,this),r.EventEmitter.on("approval","actWithdrawal",this.actWithdrawal,this),r.EventEmitter.on("approval","actDraftWithdrawal",this.actDraftWithdrawal,this),r.EventEmitter.on("approval","actReceive",this.actReceive,this),r.EventEmitter.on("approval","actRereceive",this.actRereceive,this),r.EventEmitter.on("approval","cancelReception",this.cancelReception,this),r.EventEmitter.on("approval","returnReception",this.returnReception,this),r.EventEmitter.on("approval","deptFolderCopy",this.deptFolderCopy,this),r.EventEmitter.on("approval","actPostCheck",this.actPostCheck,this),r.EventEmitter.on("approval","actPostApproval",this.actPostApproval,this),r.EventEmitter.on("approval","actAddReader",this.actAddReader,this),r.EventEmitter.on("approval","actAddFolder",this.actAddFolder,this),r.EventEmitter.on("approval","actAddReceive",this.actAddReceive,this),r.EventEmitter.on("approval","generateActCopy",this.generateActCopy,this),r.EventEmitter.on("approval","show_apprflow_list",this.show_apprflow_list,this),r.EventEmitter.on("approval","show_doc_info",this.show_doc_info,this),r.EventEmitter.on("approval","show_comment_list",this.show_comment_list,this),r.EventEmitter.on("approval","show_document",this.show_document,this),r.EventEmitter.on("approval","actList",this.actList,this),r.EventEmitter.on("approval","deleted",this.deleteDocument,this),r.EventEmitter.on("approval","cancelAndReturnReception",this.cancelAndReturnReception,this),r.EventEmitter.on("approval","reassignReceiver",this.reassignReceiver,this)},assign:function(e,t){e.setElement(this.$(t)).render()},append:function(e,t){this.$(t).append(e.render().el)},show_apprflow_list:function(){this.apprFlowView.$el.show(),this.docInfoView.$el.hide(),e("#contentViewBtn").show(),e("#goBody").css("minHeight",e("#document_iscroll").height())},show_doc_info:function(){console.log("show_doc_info"),this.documentView.$el.closest("#document_iscroll").hide(),this.docInfoView.$el.show(),e("#contentViewBtn").show(),e("#goBody").css("minHeight",e("#document_iscroll").height())},show_comment_list:function(){var e="/approval/reply/"+this.model.get("document").documentId;r.router.navigate(e,!0)},resizeBody:function(){e("#goBody").css("minHeight",e("#document_iscroll").height())},show_document:function(){this.docInfoView.$el.hide(),this.documentView.$el.closest("#document_iscroll").show(),this.docInfoView.docStatus!="TEMPSAVE"&&this.decideIscrollInit(),this.resizeBody(),e("#contentViewBtn").hide()},decideIscrollInit:function(){e(document).width()<this.documentView.$el.width()&&(e("#document_view").css("visibility","hidden"),r.util.initDetailiScroll("document_iscroll","document_hscroll","document_view"))},isTempsaveOrReapply:function(){return this.model.get("document").docStatus=="TEMPSAVE"||this.type==="REAPPLY"},checkIsAgreement:function(){var e=null,t=this.model.get("apprFlow").activityGroups;for(var n=0;n<t.length;n++){var i=t[n].activities;for(var s=0;s<i.length;s++)i[s].actorId==r.session().id&&(e=i[s].type)}return e=="AGREEMENT"?!0:!1},checkIsDeputyActivity:function(){var e=this.model.get("apprFlow").activityGroups;for(var t=0;t<e.length;t++){var n=e[t].activities;for(var i=0;i<n.length;i++)if(n[i].actorId==r.session().id&&n[i].deputyActivity)return!1}return!0},tempSaveDocument:function(){if(!this.allowAction)return;var t=this;if(confirm(k["\uc784\uc2dc\uc800\uc7a5 \ud558\uc2dc\uaca0\uc2b5\ub2c8\uae4c?"])){var n=[r.config("contextRoot")+"api/approval/document",t.docId,"tempsave"].join("/"),i=this.model.get("document").documentId,s=this.model.get("apprFlow"),o={type:"PUT",contentType:"application/json",beforeSend:function(){t.allowAction=!1},dataType:"json",data:JSON.stringify({document:this.getDocumentData(i),docInfo:this.getDocInfoDataByDraft(i),apprFlow:s})},u=function(e){console.log("ajaxCallback"),r.util.toastMessage(k["\uc784\uc2dc\uc800\uc7a5\ub418\uc5c8\uc2b5\ub2c8\ub2e4."]),t.allowAction=!0,r.router.navigate("/approval/todo/all",{trigger:!0})};e.ajax(n,o).done(e.proxy(u,this)).fail(function(e){var n=JSON.parse(e.responseText);r.util.toastMessage(n.message),t.allowAction=!0})}else window.history.length==1?r.util.goHome():r.router.navigate("/approval/todo/all",{trigger:!0})},reapplyDocument:function(){var t=this;if(this.model.docInfoModel.attributes.integrationActive){alert(k["\uc2dc\uc2a4\ud15c\uacfc \uc5f0\ub3d9\ub41c \ubb38\uc11c\ub294 \uc7ac\uae30\uc548\uc774 \ubd88\uac00\ub2a5\ud569\ub2c8\ub2e4."]+"\n"+k["\uacb0\uc7ac\ubb38\uc11c\ub97c \uc0c8\ub85c \uc791\uc131\ud574 \uc8fc\uc138\uc694."]);return}var n=new u;n.fetch({success:function(e,n){r.router.navigate("/approval/document/"+t.docId+"/reapply",{trigger:!0})},error:function(t,n){var r=C["500 \uc624\ub958\ud398\uc774\uc9c0 \ub0b4\uc6a9"];e.parseJSON(n.responseText).message&&(r=e.parseJSON(n.responseText).message),alert(r)}})},draftDocument:function(){var e=this;if(this.model.get("docInfo").requiredReceiver&&this.model.get("docInfo").docReceptionReaders.length==0&&this.model.get("document").docType!="RECEIVE"){r.util.toastMessage(k["\uc218\uc2e0\ucc98 \uc9c0\uc815 \ud544\uc218 \uba54\uc138\uc9c0"]);return}this.checkSelfApproval().then(function(){e.popDraft()})},checkSelfApproval:function(){var t=e.Deferred();if(!this.model.get("actionCheck").useSelfApproval&&!this.checkActivity())t.reject();else{var n=new s(this.model.get("apprFlow"));if(n.getAllActivities().length<2){var r=confirm(k["1\uc778 \uacb0\uc7ac \uc548\ub0b4\ubb38\uad6c"].replace(/<br>/gi,"\n"));r?t.resolve():t.reject()}else t.resolve()}return t},checkActivity:function(){var e=new s(this.model.get("apprFlow"));return e.getAllActivities().length<2?(r.util.toastMessage(k["\uacb0\uc7ac\uc120\uc744 \uc9c0\uc815\ud574 \uc8fc\uc138\uc694."]),!1):!0},popDraft:function(){if(!this.formIntegrator.validate())return!1;if(!this.checkCompleteForm())return!1;var t={title:k["\uacb0\uc7ac\uc694\uccad"],rightButton:{text:k["\ud655\uc778"],callback:e.proxy(function(e){this.saveDraftDocument(e)},this)},cancelButton:{callback:e.proxy(function(){this.docActionRelease()},this)}};this.documentAction=new b({isDraft:!0,toolBarData:t,isPassword:this.isPassword,isEmergency:e("#emergency").is(":checked")}),this.$el.find("#document_main").hide(),this.$el.find("#document_action").show(),this.assign(this.documentAction,"#document_action")},checkCompleteForm:function(){if(!this.documentView.isCompleteRequiredForm())return r.util.toastMessage(C["\ud544\uc218\ud56d\ubaa9\uc744 \uc785\ub825\ud558\uc9c0 \uc54a\uc558\uc2b5\ub2c8\ub2e4."]),!1;var e=this.documentView.getMaxLengthCheck();return e.result?this.documentView.getTitle().length>255?(r.util.toastMessage(r.i18n(k["\uc120\ud0dd\ub41c \ud56d\ubaa9\uc740 0\uc790 \uc774\ud558\ub85c \uc785\ub825\ud574\uc57c\ud569\ub2c8\ub2e4."],{arg1:255})),this.documentView.setDocFocus("subject"),!1):!0:(r.util.toastMessage(r.i18n(k["\uc120\ud0dd\ub41c \ud56d\ubaa9\uc740 0\uc790 \uc774\ud558\ub85c \uc785\ub825\ud574\uc57c\ud569\ub2c8\ub2e4."],{arg1:e.maxlength})),this.documentView.setDocFocus(e.errorId),!1)},saveDraftDocument:function(t){if(!this.allowAction)return;var n=this,i=e("#apprPassword").val(),s=e("#textarea-desc").val();if(!this.actionApprValidate("#apprPassword","#textarea-desc","DRAFT"))return!1;e("#isEmergency").is(":checked")?e("#emergency").attr("checked",!0):e("#emergency").attr("checked",!1),this.formIntegrator.beforeSave();var o=this.model.get("document").documentId,u=this.model.get("apprFlow");_.isUndefined(this.model.get("document").apprFlowVersionId)||(u.apprFlowVersionId=this.model.get("document").apprFlowVersionId);var a=u.activityGroups[0].activities[0].id,f={activityId:a,apprAction:"DRAFT",comment:s,apprPassword:i},l=new P(o);this.allowAction=!1,l.set({apprAction:f,document:this.getDocumentData(o),docInfo:this.getDocInfoDataByDraft(o),apprFlow:u},{silent:!0});var c=e.goPreloader();l.save({},{type:"PUT",beforeSend:function(){c.render()},success:function(e,t){n.allowAction=!0,t.code==200&&(n.formIntegrator.afterSave(),r.util.toastMessage(k["\uacb0\uc7ac \uc694\uccad\uc744 \uc644\ub8cc\ud558\uc600\uc2b5\ub2c8\ub2e4."]),r.router.navigate("/approval/document/"+t.data.document.id,{trigger:!0}))},error:function(t,i){n.allowAction=!0;var s=JSON.parse(i.responseText);return!_.isUndefined(s)&&s.message?(n.usePassword?(r.util.toastMessage(s.message,e("#apprPassword")),e("#apprPassword").addClass("enter error").focus()):r.util.toastMessage(s.message),!1):(r.util.toastMessage(k["\uae30\uc548\uc5d0 \uc2e4\ud328 \ud558\uc600\uc2b5\ub2c8\ub2e4."]),!1)},complete:function(){c.release()}})},doPreview:function(){var t=this;this.preView=new x({title:C["\ubbf8\ub9ac\ubcf4\uae30"],docBody:this.getDocBodyContentData(),attaches:"",references:"",callback:function(e){return this.$el.remove(),e&&e.stopPropagation(),t.$el.find(".approval_header").hide(),!1}}),this.preView.render(),e("html").scrollTop(0)},showApprFlowList:function(){var t={name:k["\uacb0\uc7ac \uc815\ubcf4"],isIscroll:!1,isPrev:!0,rightButton:{text:k["\ud655\uc778"],callback:e.proxy(function(){this.documentAction.saveApprFlow(),this.syncApprFlowLine(),this.docActionRelease()},this)},cancelButton:{callback:e.proxy(function(){this.docActionRelease()},this)}};this.documentAction=new E({type:this.type,docId:this.model.get("document").documentId,toolBarData:t,model:this.model}),this.$el.find("#document_main").hide(),this.$el.find("#document_action").show(),this.assign(this.documentAction,"#document_action")},syncApprFlowLine:function(){var e=l.render({apprLineModel:this.model.get("apprFlow")});this.$el.find("#apprflowline").html(e.$el.html())},syncApprFlowView:function(){this.apprFlowView.remove(),this.createApprFlowView(),this.changeActivityGroups(this.model.get("apprFlow").activityGroups)},createApprFlowView:function(){this.apprFlowView=new f({type:this.type,docId:this.model.get("document").documentId,model:new s(this.model.get("apprFlow"))})},doApprove:function(){var t;this.model.get("actionCheck").isArbitraryDecisionabled?t={title:k["\uacb0\uc7ac\ud558\uae30"],isArbitraryDecisionabled:!0,rightButton:{text:k["\uacb0\uc7ac"],callback:e.proxy(function(){confirm(r.i18n(C["{{arg1}} \uc9c4\ud589\ud558\uc2dc\uaca0\uc2b5\ub2c8\uae4c?"],{arg1:k["\uacb0\uc7ac"]}))&&(e("table.form_type").find("#arbitrary").is(":checked")?this.saveApprAction("ARBITRARY"):this.saveApprAction("APPROVAL"))},this)},cancelButton:{callback:e.proxy(function(){this.docActionRelease()},this)}}:t={title:k["\uacb0\uc7ac\ud558\uae30"],rightButton:{text:k["\uacb0\uc7ac"],callback:e.proxy(function(){this.saveApprAction("APPROVAL")},this)},cancelButton:{callback:e.proxy(function(){this.docActionRelease()},this)}};var n=this.model.get("userApprSetting").useNextApproval;this.documentAction=new b({toolBarData:t,isPassword:this.isPassword,headerModel:this.makeHeaderModel(),nextApproval:!0,useNextApproval:n}),this.$el.find("#document_main").hide(),this.$el.find("#document_action").show(),this.assign(this.documentAction,"#document_action");if(t.isArbitraryDecisionabled){var i=this.apprFlowView.getCurrentActivity(),s=!1;typeof i!="undefined"&&(s=i.arbitrary);var o=this.model.get("docInfo").arbtDecisionType=="DOCUMENT"?k["\uc804\uacb0\uc124\uba85"]:r.i18n(k["{{arg1}}\uc804\uacb0\uc124\uba85"],{arg1:this.model.get("docInfo").currentApprGroupName});s?e("#tblFormType").append('<tr><td><div class="ipt_wrap"><span class="option_wrap"><input id="arbitrary" type="checkbox" checked><label for="arbitrary" class="txt">'+k["\uc804\uacb0"]+"("+o+")</label></span></div></td></tr>"):e("#tblFormType").append('<tr><td><div class="ipt_wrap"><span class="option_wrap"><input id="arbitrary" type="checkbox" ><label for="arbitrary" class="txt">'+k["\uc804\uacb0"]+"("+o+")</label></span></div></td></tr>"),e("#tblFormType").append('<tr style="display:none;" id="arbtAddReferrerDetail"><td><div class="ipt_wrap"><span class="option_wrap"><input type="checkbox" id="arbtAddReferrer"><label for="arbtAddReferrer" class="txt">'+k["\uc804\uacb0\ucc38\uc870\uc790\ucd94\uac00"]+"</label></span></div></td></tr>"),e("#arbitrary").off("click"),e("#arbitrary").on("click",function(t){e("#arbtAddReferrerDetail").toggle(e("#arbitrary").is(":checked"))})}},doHold:function(){var t={title:k["\ubcf4\ub958\ud558\uae30"],rightButton:{text:k["\ubcf4\ub958"],callback:e.proxy(function(){this.saveApprAction("HOLD")},this)},cancelButton:{callback:e.proxy(function(){this.docActionRelease()},this)}},n=this.model.get("userApprSetting").useNextApproval;this.documentAction=new b({toolBarData:t,isPassword:this.isPassword,headerModel:this.makeHeaderModel(),nextApproval:!0,useNextApproval:n}),this.$el.find("#document_main").hide(),this.$el.find("#document_action").show(),this.assign(this.documentAction,"#document_action")},actDraftWithdrawal:function(){var t={title:k["\uc0c1\uc2e0\ucde8\uc18c"],rightButton:{text:C["\ud655\uc778"],callback:e.proxy(function(){this.saveApprAction("CANCELDRAFT")},this)},cancelButton:{callback:e.proxy(function(){this.docActionRelease()},this)}},n=this.model.get("userApprSetting").useNextApproval;this.documentAction=new b({toolBarData:t,isCancel:!0,isPassword:this.isPassword,headerModel:this.makeHeaderModel(),nextApproval:!1,useNextApproval:n}),this.$el.find("#document_main").hide(),this.$el.find("#document_action").show(),this.assign(this.documentAction,"#document_action")},doReturn:function(){var t={title:k["\ubc18\ub824\ud558\uae30"],rightButton:{text:k["\ubc18\ub824"],callback:e.proxy(function(){this.saveApprAction("RETURN")},this)},cancelButton:{callback:e.proxy(function(){this.docActionRelease()},this)}},n=this.model.get("userApprSetting").useNextApproval,r=this.model.get("actionCheck").latestCompleteAction=="DRAFT"?!0:!1,i=this.model.get("actionCheck").usePreviousReturn;this.documentAction=new b({toolBarData:t,isPassword:this.isPassword,headerModel:this.makeHeaderModel(),nextApproval:!0,useNextApproval:n,showPreviousReturn:!r&&i}),this.$el.find("#document_main").hide(),this.$el.find("#document_action").show(),this.assign(this.documentAction,"#document_action")},doAgree:function(){var t={title:k["\ud569\uc758\ud558\uae30"],rightButton:{text:k["\ud569\uc758"],callback:e.proxy(function(){this.saveApprAction("AGREEMENT")},this)},cancelButton:{callback:e.proxy(function(){this.docActionRelease()},this)}},n=this.model.get("userApprSetting").useNextApproval;this.documentAction=new b({toolBarData:t,isPassword:this.isPassword,headerModel:this.makeHeaderModel(),nextApproval:!0,useNextApproval:n}),this.$el.find("#document_main").hide(),this.$el.find("#document_action").show(),this.assign(this.documentAction,"#document_action")},doDisagree:function(){var t={title:k["\ubc18\ub300\ud558\uae30"],rightButton:{text:k["\ubc18\ub300"],callback:e.proxy(function(){this.saveApprAction("OPPOSITION")},this)},cancelButton:{callback:e.proxy(function(){this.docActionRelease()},this)}},n=this.model.get("userApprSetting").useNextApproval;this.documentAction=new b({toolBarData:t,isPassword:this.isPassword,headerModel:this.makeHeaderModel(),nextApproval:!0,useNextApproval:n}),this.$el.find("#document_main").hide(),this.$el.find("#document_action").show(),this.assign(this.documentAction,"#document_action")},doCheck:function(){var t={title:k["\ud655\uc778\ud558\uae30"],rightButton:{text:k["\ud655\uc778"],callback:e.proxy(function(){this.saveApprAction("APPROVAL")},this)},cancelButton:{callback:e.proxy(function(){this.docActionRelease()},this)}},n=this.model.get("userApprSetting").useNextApproval;this.documentAction=new b({toolBarData:t,isPassword:this.isPassword,headerModel:this.makeHeaderModel(),nextApproval:!0,useNextApproval:n}),this.$el.find("#document_main").hide(),this.$el.find("#document_action").show(),this.assign(this.documentAction,"#document_action")},doInspection:function(){var t={title:k["\uacb0\uc7ac\ud558\uae30"],rightButton:{text:k["\uacb0\uc7ac"],callback:e.proxy(function(){this.saveApprAction("APPROVAL")},this)},cancelButton:{callback:e.proxy(function(){this.docActionRelease()},this)}},n=this.model.get("userApprSetting").useNextApproval;this.documentAction=new b({toolBarData:t,isPassword:this.isPassword,headerModel:this.makeHeaderModel(),nextApproval:!0,useNextApproval:n}),this.$el.find("#document_main").hide(),this.$el.find("#document_action").show(),this.assign(this.documentAction,"#document_action")},doAdvAppr:function(){var t={title:k["\uacb0\uc7ac\ud558\uae30"],rightButton:{text:k["\uacb0\uc7ac"],callback:e.proxy(function(){this.saveApprAction("ADVAPPROVAL")},this)},cancelButton:{callback:e.proxy(function(){this.docActionRelease()},this)}},n=this.model.get("userApprSetting").useNextApproval;this.documentAction=new b({toolBarData:t,isPassword:this.isPassword,headerModel:this.makeHeaderModel(),nextApproval:!0,useNextApproval:n}),this.$el.find("#document_main").hide(),this.$el.find("#document_action").show(),this.assign(this.documentAction,"#document_action")},docPreview:function(){var t={title:k["\ubbf8\ub9ac\ubcf4\uae30"],rightButton:{text:k["\ubc18\ub300"],callback:e.proxy(function(){this.saveApprAction("OPPOSITION")},this)},cancelButton:{callback:e.proxy(function(){this.docActionRelease()},this)}},n=this.model.get("userApprSetting").useNextApproval;this.documentAction=new b({toolBarData:t,isPassword:this.isPassword,headerModel:this.makeHeaderModel(),nextApproval:!0,useNextApproval:n}),this.$el.find("#document_main").hide(),this.$el.find("#document_action").show(),this.assign(this.documentAction,"#document_action")},deleteDocument:function(){var t=this;if(confirm(k["\uc120\ud0dd\ud55c \ud56d\ubaa9\uc744 \uc0ad\uc81c\ud558\uc2dc\uaca0\uc2b5\ub2c8\uae4c?"])){var n=[r.config("contextRoot")+"api/approval/document",t.docId,"delete"].join("/");e.ajax(n,{type:"PUT",contentType:"application/json",dataType:"json"}).done(function(e){alert(k["\uc120\ud0dd\ud55c \ud56d\ubaa9\uc774 \uc0ad\uc81c\ub418\uc5c8\uc2b5\ub2c8\ub2e4"]),t.actList()})}else _.delay(function(){t.toolbarView.$("#selectAction").val("")},100)},actPostCheck:function(){var t={title:k["\ud6c4\uc5f4\ud558\uae30"],rightButton:{text:k["\ud6c4\uc5f4"],callback:e.proxy(function(){this.saveApprAction("POSTCHECK")},this)},cancelButton:{callback:e.proxy(function(){this.docActionRelease()},this)}},n=this.model.get("userApprSetting").useNextApproval;this.documentAction=new b({toolBarData:t,isPassword:this.isPassword,headerModel:this.makeHeaderModel(),nextApproval:!0,useNextApproval:n}),this.$el.find("#document_main").hide(),this.$el.find("#document_action").show(),this.assign(this.documentAction,"#document_action")},actPostApproval:function(){var t={title:k["\ud6c4\uacb0\ud558\uae30"],rightButton:{text:k["\ud6c4\uacb0"],callback:e.proxy(function(){this.saveApprAction("POSTAPPROVAL")},this)},cancelButton:{callback:e.proxy(function(){this.docActionRelease()},this)}},n=this.model.get("userApprSetting").useNextApproval;this.documentAction=new b({toolBarData:t,isPassword:this.isPassword,headerModel:this.makeHeaderModel(),nextApproval:!0,useNextApproval:n}),this.$el.find("#document_main").hide(),this.$el.find("#document_action").show(),this.assign(this.documentAction,"#document_action")},actAddReceive:function(e){var t=this;r.router.navigate(r.router.getUrl()+"#org",{trigger:!1,pushState:!0}),this.docReceiveView=new w({receptAddDeptId:t.model.get("actionCheck").receptAddDeptId,title:k["\uc218\uc2e0\uc790 \ucd94\uac00"],docId:t.docId,callback:function(e){t.saveDocReceive(e)}}),this.docReceiveView.render()},actWithdrawal:function(){var t={title:k["\uacb0\uc7ac\ucde8\uc18c"],rightButton:{text:C["\ud655\uc778"],callback:e.proxy(function(){this.saveApprAction("WITHDRAW")},this)},cancelButton:{callback:e.proxy(function(){this.docActionRelease()},this)}},n=this.model.get("userApprSetting").useNextApproval;this.documentAction=new b({toolBarData:t,isCancel:!0,isPassword:this.isPassword,headerModel:this.makeHeaderModel(),nextApproval:!0,useNextApproval:n}),this.$el.find("#document_main").hide(),this.$el.find("#document_action").show(),this.assign(this.documentAction,"#document_action")},actList:function(e){var t=sessionStorage.getItem("list-history-baseUrl");t?t.indexOf("search")>-1?window.history.back():r.router.navigate(t,{trigger:!0}):r.router.navigate("approval",{trigger:!0})},actReceive:function(){var e=this;if(confirm(k["\uc811\uc218 \ud558\uc2dc\uaca0\uc2b5\ub2c8\uae4c?"])){var t=e.model.get("document").documentId,n=new D(t,"receive");n.save({},{type:"PUT",success:function(e,n){n.code==200&&r.router.navigate("/approval/document/"+t,{trigger:!0})},error:function(e,t){var n=JSON.parse(t.responseText);return n.message?(alert(n.message),!1):(alert(k["\uc811\uc218\uac00 \uc2e4\ud328 \ud558\uc600\uc2b5\ub2c8\ub2e4."]),!1)}})}else _.delay(function(){e.toolbarView.$("#selectAction").val("")},100)},actRereceive:function(){var e=this;if(confirm(k["\uc7ac\uc811\uc218 \ud558\uc2dc\uaca0\uc2b5\ub2c8\uae4c?"])){var t=e.model.get("document").documentId,n=new D(t,"rereceive");n.save({},{type:"PUT",success:function(e,n){n.code==200&&r.router.navigate("/approval/document/"+t,{trigger:!0})},error:function(e,t){var n=JSON.parse(t.responseText);return n.message?(alert(n.message),!1):(alert(k["\uc7ac\uc811\uc218\uac00 \uc2e4\ud328 \ud558\uc600\uc2b5\ub2c8\ub2e4."]),!1)}})}else _.delay(function(){e.toolbarView.$("#selectAction").val("")},100)},cancelReception:function(){var e=this;if(confirm(k["\uc811\uc218\ub97c \ucde8\uc18c\ud558\uc2dc\uaca0\uc2b5\ub2c8\uae4c?"])){var t=e.model.get("document").documentId,n=new D(t,"cancel");n.save({},{type:"PUT",success:function(e,n){n.code==200&&r.router.navigate("/approval/document/"+t,{trigger:!0})},error:function(e,t){var n=JSON.parse(t.responseText);return n.message?(alert(n.message),!1):(alert(k["\uc811\uc218\ucde8\uc18c\uac00 \uc2e4\ud328 \ud558\uc600\uc2b5\ub2c8\ub2e4."]),!1)}})}else _.delay(function(){e.toolbarView.$("#selectAction").val("")},100)},returnReception:function(){var t=this,n={title:k["\ubc18\uc1a1"],rightButton:{text:k["\ubc18\uc1a1"],callback:function(){var n=t.model.get("document").documentId,r=new D(n,"return"),i=e("#textarea-desc").val();if(e.trim(i)=="")return alert(k["\uc758\uacac\uc744 \uc791\uc131\ud574 \uc8fc\uc138\uc694"],e("#textarea-desc")),e("#textarea-desc").addClass("enter error").select(),!1;var s=r.save({str:e("#textarea-desc").val()},{type:"PUT"});s.done(function(e,n){t.actList()}),s.fail(function(e,t){return alert(k["\ubc18\uc1a1\uc774 \uc2e4\ud328 \ud558\uc600\uc2b5\ub2c8\ub2e4."]),!1})}},cancelButton:{callback:e.proxy(function(){this.docActionRelease()},this)}},r=this.model.get("userApprSetting").useNextApproval;this.documentAction=new b({toolBarData:n,isPassword:t.isPassword,headerModel:this.makeHeaderModel(),nextApproval:!0,useNextApproval:r}),this.$el.find("#document_main").hide(),this.$el.find("#document_action").show(),this.assign(this.documentAction,"#document_action")},cancelAndReturnReception:function(){var e=this;if(confirm(k["\ubc18\uc1a1\ud558\uc2dc\uaca0\uc2b5\ub2c8\uae4c?"])){var t=e.model.get("document").documentId,n=new D(t,"receptioncancelandreturn");n.save({},{type:"PUT",success:function(t,n){n.code==200&&e.actList()},error:function(e,t){var n=JSON.parse(t.responseText);return n.message?(alert(n.message),!1):(alert(k["\ubc18\uc1a1\uc774 \uc2e4\ud328 \ud558\uc600\uc2b5\ub2c8\ub2e4."]),!1)}})}else _.delay(function(){e.toolbarView.$("#selectAction").val("")},100)},reassignReceiver:function(){var t=this.model.get("document");this.apprReceiverPopup=new S({docId:this.docId,receivedDocOwnerDeptId:t.receivedDocOwnerDeptId,receiverDeptId:t.receiverDeptId,receiverDeptName:t.receiverDeptName,receiverUserId:t.receiverUserId,receiverUserName:t.receiverUserName,receiverUserPositionName:t.receiverUserPositionName}),e("div.go_body").next("div.overlay_scroll").remove(),e("div.go_body").after(this.apprReceiverPopup.$el),this.apprReceiverPopup.render(),this.apprReceiverPopup.$el.find(".layer_type_bottom").animate({bottom:0},150)},makeHeaderModel:function(){var e=this.model.get("document"),t=e.title||"",n=e.drafterName||"",i=r.util.basicDate(e.draftedAt)||"",s=e.drafterPosionName||"";return{title:t,drafterName:n,drafterPositionName:s,draftedAt:i}},saveDocReceive:function(t){var n=this.model.get("document").documentId,r=this.model.get("actionCheck").receptAddDeptId,i=new M(n,r.join(",")),s=[];e(t).each(function(e,t){s.push({id:"",reader:{id:t.userid,deptId:r[0],deptType:!1}})});var o={id:n,docReadingReaders:s};i.set(o,{silent:!0}),i.save({},{type:"PUT",success:function(e,t){t.code==200&&alert(C["\uc800\uc7a5\ub418\uc5c8\uc2b5\ub2c8\ub2e4."])},error:function(e,t){var n=JSON.parse(t.responseText);return n.message?(alert(n.message),!1):(alert(k["\uc218\uc2e0\uc790\ucd94\uac00\uc5d0 \uc2e4\ud328 \ud558\uc600\uc2b5\ub2c8\ub2e4."]),!1)}})},docActionRelease:function(){this.toolBarData={isPrev:!0,actionMenu:this.getActionMenu()},this.toolbarBindEvent(),this.headerToolbarView.render(this.toolBarData),this.$el.find("#document_main").show(),this.$el.find("#document_action").hide(),this.$el.find("#selectAction").val(""),this.documentAction.release()},changeApprFlow:function(){var t=this,n=this.model.get("apprFlow");if(this.type=="DOCUMENT"){var i=[r.config("contextRoot")+"api/approval/document",t.docId,"apprflow"].join("/");e.ajax(i,{type:"PUT",contentType:"application/json",dataType:"json",data:JSON.stringify({document:t.getDocumentData(t.docId),apprFlow:n})}).done(function(e){onApprFlowUpdated(t,e.data)})}else{var s=this.model.get("document").isReceptionDocument;t.changeActivityGroups(n.activityGroups,s)}},changeActivityGroups:function(e,t){this.documentView.changeActivityGroups(e,t),this.type!="DOCUMENT"&&this.apprFlowView.makeApprFlow(e)},setDocNum:function(e){this.documentView.setDocNum(e)},getDocumentData:function(e,t){var n=this.documentView.getTitle(),r=!n||0===n.length?this.model.get("document").formName:n,i=this.getDocVariables();this.model.isStatusReceived()&&h.restore();var s=this.getDocBodyContentData();return{id:e,documentId:e,docStatus:t,attachCount:0,attaches:this.getAttachData(),references:this.getReferencesData(),docBodyContent:s,title:r,variables:i}},getDocVariables:function(){var e={},t=this.model.get("docInfo").integrationActive||!1,n=!_.isEmpty(this.model.get("docInfo").externalScript);if(t||n)e=this.formIntegrator.getDocVariables()||this.documentView.getDocVariables();return e},getAttachData:function(){var t=[],n=e("#attachPart").find("li[data-name]:not(.attachError):not(.refDoc)");this.model.isStatusReceived()&&(n=e("#attachView").find("li[data-name]:not(.attachError):not(.refDoc)"));var r=function(){var n={};e(this).attr("data-path")&&(n.path=e(this).attr("data-path")),e(this).attr("data-name")&&(n.name=e(this).attr("data-name")),e(this).attr("data-id")&&(n.id=e(this).attr("data-id")),t.push(n)};return n.each(r),t},getReferencesData:function(){var t=[],n=e("li[data-id].refDoc");n.each(function(){t.push({id:e(this).attr("data-id")})});var r=e("li[data-id].receptionOriginDoc");return r.each(function(){t.push({id:e(this).data("id")})}),t},getDocBodyContentData:function(){return this.documentView.getDocBodyContents()},getDocInfoData:function(t){var n=this;return docInfoData={id:t,securityLevelId:e("#infoSecurityLevel").val(),docYear:e("#docYear").val(),docFolders:n.getDocFolderData(),docReceptionReaders:n.getDocReceptionReadersData(),docReferenceReaders:n.getDocReferenceReadersData(),isPublic:e("#openType:checked").val()}},getDocInfoDataByDraft:function(t){var n=this.model.get("docInfo");return{id:t,securityLevelId:e("#infoSecurityLevel").val(),docYear:e("#docYear").val(),docFolders:this.getDocFolderData(),docReceptionReaders:n.docReceptionReaders||[],docReferenceReaders:n.docReferenceReaders||[],docReadingReaders:n.docReadingReaders||[],officialVersions:n.officialVersions||[],isPublic:e('input:radio[name="openType"]:checked').val(),isEmergency:e("#emergency").is(":checked"),drafterDeptFolderId:e("#deptFolderId").val(),drafterDeptId:e("#draftDeptId").val()}},getDocFolderData:function(){var t=e("#openType:checked").val(),n=[],r=e("#addFolder").find("li[data-id]");return t=="true"&&r.each(function(){e(this).attr("data-Type")=="true"&&n.push({id:e(this).attr("data-id")})}),n},getDocReceptionReadersData:function(){var t=[],n=e("#addReceive").find("li[data-id]");return n.each(function(){t.push({id:e(this).attr("data-sid"),reader:{id:e(this).attr("data-userId"),name:e(this).attr("data-userName"),position:e(this).attr("data-userPosition"),deptType:e(this).attr("data-deptType")}})}),t},getDocReferenceReadersData:function(){var t=[],n=e("#addReference").find("li[data-id]");return n.each(function(){t.push({id:e(this).attr("data-sid"),reader:{id:e(this).attr("data-userId"),name:e(this).attr("data-userName"),position:e(this).attr("data-userPosition"),deptType:e(this).attr("data-deptType")}})}),t},actionApprValidate:function(t,n,i){var s=e(t).val(),o=e(n).val();return this.isPassword&&!s?(setTimeout(function(){alert(k["\uacb0\uc7ac \ube44\ubc00\ubc88\ud638\ub97c \uc785\ub825\ud558\uc138\uc694."])},10),!1):i!="RETURN"&&i!="RECV_RETURNED"||e.trim(o)!=""?o&&o.length>1e3?(setTimeout(function(){alert(r.i18n(k["{{max}}\uc790 \uc774\ud558\ub85c \uc785\ub825\ud574 \uc8fc\uc2ed\uc2dc\uc624"],{max:1e3}))},10),!1):!0:(setTimeout(function(){alert(k["\uc758\uacac\uc744 \uc791\uc131\ud574 \uc8fc\uc138\uc694"])},10),!1)},getPageNo:function(){var e=sessionStorage.getItem("list-history-pageNo"),t=sessionStorage.getItem("list-total-count");if(!e||!t||e==0)return 0;var n=sessionStorage.getItem("list-history-pageSize");return t<=n*e+1&&(e=e-1>=0?e-1:0),e},saveApprAction:function(t){function S(e){if(e.apprAction=="ADVAPPROVAL")return n.model.get("apprFlow").advActivityId;if(e.apprAction=="APPROVAL"||e.apprAction=="RETURN"){var t=n.model.get("actionCheck").isPostApprovalUser||n.model.get("actionCheck").isPostCheckUser,r=n.model.get("apprFlow").currentActivityId,i=n.model.get("apprFlow").approvalActivityId;return t&&i?i:r}return n.model.get("apprFlow").currentActivityId}if(!this.allowAction)return;this.allowAction=!1;var n=this,i=e("#apprPassword").val();if(!this.actionApprValidate("#apprPassword","#textarea-desc",t))return this.allowAction=!0,!1;var s=n.model.get("document").isReception,o=S({apprAction:t});t=="ARBITRARY"&&n.model.get("docInfo").arbtDecisionType=="APPRGROUP"&&(t="GROUPARBITRARY");var u=!1;e("table.form_type").find("#arbtAddReferrer").is(":checked")&&(u=!0);var a=n.model.get("document").documentId,f=new A(a),l=n.model.get("document").docVersionId,c=n.model.get("document").apprFlowVersionId,h="document.draftedAt",p="desc",d=sessionStorage.getItem("list-history-searchtype"),v=sessionStorage.getItem("list-history-keyword")&&sessionStorage.getItem("list-history-keyword").replace(/\+/gi," "),m="all",g="",y="";t=="RECV_RETURNED"&&(f=new D(a,"return"),h="createdAt"),sessionStorage.getItem("list-history-duration")&&sessionStorage.getItem("list-history-duration")!=""&&(m=sessionStorage.getItem("list-history-duration")),m=="period"&&sessionStorage.getItem("list-history-fromDate")&&sessionStorage.getItem("list-history-fromDate")!=""&&(g=sessionStorage.getItem("list-history-fromDate"),y=sessionStorage.getItem("list-history-toDate"));var b=!1,w=!0;e("#nextApproval")?e("#nextApproval").is(":checked")&&(b=!0):(w=!1,b=this.model.get("userApprSetting").useNextApproval),e("#isPreviousReturn").is(":checked")&&(t="PREVIOUSRETURN"),f.set({activityId:o,apprAction:t,comment:e("#textarea-desc").val(),apprPassword:i,docVersionId:l,apprFlowVersionId:c,arbtAddReferrer:u,userApprSetting:{useNextApproval:b,property:h,direction:p,searchtype:d,keyword:v,duration:m,fromDate:g,toDate:y}},{silent:!0});var E=f.save({},{type:"PUT",success:function(e,i){n.allowAction=!0;if(i.code==200){I(n,i.data,s);var o="/approval/todo/all",u="/approval/todoreception/all",f="/approval/document/"+i.data.document.id,l;t=="APPROVAL"||t=="RETURN"||t=="ARBITRARY"||t=="GROUPARBITRARY"||t=="AGREEMENT"||t=="OPPOSITION"||t=="POSTCHECK"||t=="HOLD"||t=="PREVIOUSRETURN"?(sessionStorage.setItem("list-history-pageNo",n.getPageNo()),b&&w?(l=a==i.data.document.id?o:f,r.router.navigate(l,{trigger:!0})):r.router.navigate(o,{trigger:!0})):t=="WITHDRAW"||t=="CANCELDRAFT"?r.router.navigate(f,{trigger:!0}):t=="RECV_RETURNED"?b&&w?(l=a==i.data.document.id?u:f,r.router.navigate(l,{trigger:!0})):r.router.navigate(u,{trigger:!0}):r.router.navigate("/approval/doclist/draft/all",{trigger:!0})}},error:function(t,i){n.allowAction=!0;var s=JSON.parse(i.responseText);if(s.message){var o=s.message.replace(/<br\/\>/gi,"\n");return alert(o),s.name=="not.authorized.canceldraft.read"||s.name=="invalid.activity.status"?r.router.navigate("/approval",{trigger:!0}):s.name=="pwd.not.match"&&e("#apprPassword").focus(),!1}return alert(k["\uc800\uc7a5\uc5d0 \uc2e4\ud328 \ud558\uc600\uc2b5\ub2c8\ub2e4."]),!1}});r.util.preloader(E)}},{__instance__:null,create:function(){return this.__instance__=new this.prototype.constructor({el:e("#content")}),this.__instance__},render:function(){var e=this.create(),t=arguments.length>0?Array.prototype.slice.call(arguments):[];return this.prototype.render.apply(e,t)}});return F})}).call(this);