define(["jquery","underscore","backbone","app","approval/models/doclist_item","views/profile_card","approval/views/doclist/doclist_item_info","approval/views/document/apprflow","approval/views/document_attach","hgn!approval/templates/doclist_item","hgn!approval/templates/doc_manager_list_item","i18n!nls/commons","i18n!approval/nls/approval"],function(e,t,n,r,i,s,o,u,a,f,l,c,h){var p=n.View.extend({tagName:"tr",events:{"click a#attach":"showAttach","click span.read":"showDocInfo","click span.notyet":"showDocInfo","click span.finish":"showDocInfo","click span.temp":"showDocInfo","click span.defer":"showDocInfo","click span.wait":"showDocInfo","click .writer span.txt":"showUserProfile","click .drafter span.txt":"showOriginUserProfile","click td.subject a:not([class])":"showUrl","click a.popup":"showPopup"},initialize:function(e){this.options=e||{},t.bindAll(this,"render","showDocInfo","showAttach","showUserProfile"),this.total=this.options.total,this.columns=this.options.columns,this.deptId=this.options.deptId,this.listType=this.options.listType,this.isManager=!!this.options.isManager,this.isCheckboxVisible=t.isBoolean(this.options.isCheckboxVisible)?this.options.isCheckboxVisible:!1,this.isShowUrl=t.isBoolean(this.options.isShowUrl)?this.options.isShowUrl:!0,this.isReception=t.isBoolean(this.options.isReception)?this.options.isReception:!1,this.useDocInfo=t.isBoolean(this.options.useDocInfo)?this.options.useDocInfo:!0},render:function(){var t="",n=this.listType;this.model.setListType(n);var r={id:this.model.getDocumentId(),versionId:this.model.getVersionId(),receptionOriginId:this.model.getReceptionOriginId(),draftedAt:this.model.getDraftedAt(),receptionOriginDraftedAt:this.model.getOriginDraftedAt(),createdAt:this.model.getCreatedAt(),sentAt:this.model.getSentAt(),updatedAt:this.model.getUpdatedAt(),arrivedAt:this.model.getArrivedAt(),receivedAt:this.model.getReceivedAt(),createdAt:this.model.getCreatedAt(),formName:this.model.get("formName"),title:this.model.get("title"),hasAttach:this.model.hasAttach(),isReceive:this.model.isReceive(),isReadable:this.model.isReadable(),attachCount:this.model.get("attachCount"),commentCount:this.model.get("commentCount"),replyCount:this.model.get("replyCount"),drafterId:this.model.get("drafterId"),drafterName:this.isReception?this.model.get("receptionOriginDrafterName"):this.model.get("drafterName"),receptionOriginDrafterId:this.model.get("receptionOriginDrafterId"),docStatus:this.model.getDocStatusName(),docTypeName:this.model.getDocType(),statusClass:this.model.getDocStatusClass(),completedAt:this.model.getCompletedAt(),receptionOriginCompletedAt:this.model.getReceptionOriginCompletedAt(),docNum:this.model.get("docNum"),receptionOriginDocNum:this.model.get("receptionOriginDocNum"),isNew:this.model.get("isNew"),isCompleted:this.model.isCompleted(),receiverUserId:this.model.get("receiverUserId"),receiverUserName:this.model.getReceiverUserName(),receiverDeptName:this.model.getReceiverDeptName(),receivedDocOwnerDeptId:this.model.get("receivedDocOwnerDeptId"),receptionOriginDrafterDeptName:this.model.getReceptionOriginDrafterDeptName(),receivedDocOwnerDeptName:this.model.getReceivedDocOwnerDeptName(),receiveStatusName:this.model.getReceiveStatusName(),deptFolderName:this.model.get("deptFolderName"),userFolderName:this.model.get("userFolderName"),showUrl:this.model.getShowUrl(),isEmergency:this.model.get("isEmergency"),isReception:this.isReception,isTempsave:this.model.isTempsave(),holdStatusName:this.model.getHoldStatusName(),holdStatusClass:this.model.getHoldStatusClass(),currentActivityUsers:this.model.get("currentActivityUsers"),finalActivityUsers:this.model.get("finalActivityUsers"),officialApprovalName:this.model.get("approverName"),officialStateName:this.model.getOfficialStateName(),officialStateClass:this.model.getOfficialStateClass(),drafterDeptName:this.isReception?this.model.get("receptionOriginDrafterDeptName"):this.model.get("drafterDeptName"),officialFormName:this.model.get("officialFormName"),officialSenderName:this.model.get("officialSenderName"),officialSignName:this.model.get("officialSignName"),useSelfApproval:this.model.get("useSelfApproval"),receptionOriginCompanyId:this.model.get("receptionOriginCompanyId"),useIntegration:this.model.getIntegration(),hasAdditionalInfo:this.model.get("commentCount")||this.model.get("replyCount"),isDelay:this.model.get("isDelay")},i=e.extend(h,{"\ud31d\uc5c5\ubcf4\uae30":c["\ud31d\uc5c5\ubcf4\uae30"]});this.$el.addClass(r.isNew?"read_no":"");var s=!1;return this.listType=="sendDoc"&&(s=!0),this.isManager?t=l({lang:i,doc:r,isCheckboxVisible:this.isCheckboxVisible,columns:this.columns,deptId:this.deptId,isSendDoc:s,useDocInfo:this.useDocInfo,isActivePopup:this.isActivePopup()}):t=f({doc:r,isCheckboxVisible:this.isCheckboxVisible,isShowUrl:this.isShowUrl,columns:this.columns,deptId:this.deptId,isSendDoc:s,lang:i,useDocInfo:this.useDocInfo}),this.$el.html(t),this},isActivePopup:function(){return this.model.get("docStatus")=="DRAFT_WAITING"||this.model.get("docStatus")=="RECV_RETURNED"||this.model.get("docStatus")=="RECV_WAITING"||this.model.get("docStatus")=="TEMPSAVE"&&this.model.get("apprStatus")=="CANCEL"?!1:!0},showAttach:function(e){e.stopPropagation();if(!this.model.isReadable())return;var t=new a({docId:this.listType=="sendDoc"?this.model.getReceptionOriginId():this.model.getDocumentId()});t.render()},showDocInfo:function(e){e.stopPropagation(),e.preventDefault();if(!this.model.isReadable()||!this.useDocInfo||!this.isActivePopup())return;var t=new o({docId:this.model.getDocumentId()});t.render()},showUserProfile:function(e){e.stopPropagation(),e.preventDefault();if(!this.model.isReadable())return;var t=this.model.get("drafterId")?this.model.get("drafterId"):this.model.get("receiverUserId");t&&s.render(t,e.currentTarget)},showOriginUserProfile:function(e){e.stopPropagation(),e.preventDefault();if(!this.model.isReadable())return;this.model.get("receptionOriginDrafterId")&&s.render(this.model.get("receptionOriginDrafterId"),e.currentTarget)},showUrl:function(t){var n=this.model.getShowUrl(),i=r.router.getUrl(),s=i.substring(0,i.indexOf("?"));sessionStorage.setItem("list-history-baseUrl",s),sessionStorage.setItem("list-total-count",this.total),sessionStorage.setItem("list-history-doc-id",this.listType=="sendDoc"?this.model.getReceptionOriginId():this.model.getDocumentId()),sessionStorage.setItem("list-history-pageNo",r.router.getSearch().page?r.router.getSearch().page:0),sessionStorage.setItem("list-history-pageSize",r.router.getSearch().offset?r.router.getSearch().offset:20),sessionStorage.setItem("list-history-property",r.router.getSearch().property?r.router.getSearch().property:""),sessionStorage.setItem("list-history-direction",r.router.getSearch().direction?r.router.getSearch().direction:""),sessionStorage.setItem("list-history-searchtype",r.router.getSearch().searchtype?r.router.getSearch().searchtype:""),sessionStorage.setItem("list-history-keyword",r.router.getSearch().keyword?r.router.getSearch().keyword:""),sessionStorage.setItem("list-history-duration",r.router.getSearch().duration?r.router.getSearch().duration:""),sessionStorage.setItem("list-history-fromDate",r.router.getSearch().fromDate?r.router.getSearch().fromDate:""),sessionStorage.setItem("list-history-toDate",r.router.getSearch().toDate?r.router.getSearch().toDate:"");var o=e.param(r.router.getSearch()),u=n+(o?"?"+o:"");r.router.navigate(u,!0)},showPopup:function(e){var t=this.model.getFullShowUrl()+"/popup";window.open(t,"","location=no, directories=no,resizable=yes,status=no,toolbar=no,menubar=no, width=1280,height=650,left=0, top=0, scrollbars=yes")}});return p});