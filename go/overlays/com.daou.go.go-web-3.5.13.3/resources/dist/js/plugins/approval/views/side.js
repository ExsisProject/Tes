(function(){define(["jquery","backbone","app","when","approval/models/todocount","approval/models/upcomingcount","approval/models/receptioncount","approval/models/todoviewercount","approval/models/favoriteform","approval/models/officialtodocount","approval/views/favorite_list","approval/views/new","hgn!approval/templates/side","hgn!approval/templates/side_dept_folder","i18n!nls/commons","i18n!approval/nls/approval","i18n!board/nls/board","amplify","GO.util"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g){var y=t.Collection.extend({model:a,url:"/api/approval/favorite"}),b=t.Collection.extend({url:"/api/approval/deptfolder"}),w=t.Collection.extend({url:"/api/approval/drafterdeptfolder"}),i=t.Model.extend({url:"/api/approval/todo/count"}),s=t.Model.extend({url:"/api/approval/upcoming/count"}),o=t.Model.extend({url:"/api/approval/todoreception/count"}),u=t.Model.extend({url:"/api/approval/todoviewer/count"}),E=t.Model.extend({url:"/api/approval/side"}),S=t.Model.extend({url:"/api/approval/apprconfig"}),x=GO.session("loginId")+"-appr-favorite-toggle",T=GO.session("loginId")+"-appr-approval-toggle",N=GO.session("loginId")+"-appr-user-toggle",C=GO.session("loginId")+"-appr-dept-toggle",k={new_approval:v["\uc0c8 \uacb0\uc7ac \uc9c4\ud589"],approval:v["\uacb0\uc7ac\ud558\uae30"],"\uc804\uc790\uacb0\uc7ac":v["\uc804\uc790\uacb0\uc7ac"],base_docfolder:v["\uae30\ubcf8 \ubb38\uc11c\ud568"],added_docfolder:v["\ucd94\uac00\ub41c \ubb38\uc11c\ud568"],user_docfolder:v["\uac1c\uc778 \ubb38\uc11c\ud568"],appr_wait_doc:v["\uacb0\uc7ac \ub300\uae30 \ubb38\uc11c"],appr_wait_reception_doc:v["\uacb0\uc7ac \uc218\uc2e0 \ubb38\uc11c"],appr_sched_doc:v["\uacb0\uc7ac \uc608\uc815 \ubb38\uc11c"],draft_docfolder:v["\uae30\uc548 \ubb38\uc11c\ud568"],tempsave_docfolder:v["\uc784\uc2dc \uc800\uc7a5\ud568"],appr_docfolder:v["\uacb0\uc7ac \ubb38\uc11c\ud568"],viewer_docfolder:v["\ucc38\uc870/\uc5f4\ub78c \ubb38\uc11c\ud568"],reception_docfolder:v["\uc218\uc2e0 \ubb38\uc11c\ud568"],admin_dept_folder:v["\ubd80\uc11c \ubb38\uc11c\ud568 \uad00\ub9ac"],dept_folder:v["\ubd80\uc11c \ubb38\uc11c\ud568"],sub_dept_folder:v["\ud558\uc704 \ubd80\uc11c \ubb38\uc11c\ud568"],dept_draft:v["\uae30\uc548 \uc644\ub8cc\ud568"],dept_ref:v["\ubd80\uc11c \ucc38\uc870\ud568"],dept_rcpt:v["\ubd80\uc11c \uc218\uc2e0\ud568"],dept_official:v["\uacf5\ubb38 \ubc1c\uc1a1\ud568"],favorite_title:d["\uc990\uaca8\ucc3e\uae30"],no_dept_folder:v["\ubd80\uc11c \ubb38\uc11c\ud568\uc774 \uc874\uc7ac\ud558\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4."],no_dept:v["\uc18c\uc18d\ub41c \ubd80\uc11c\uac00 \uc5c6\uc2b5\ub2c8\ub2e4. \uad00\ub9ac\uc790\uc5d0\uac8c \ubb38\uc758\ud558\uc138\uc694."],doc_admin:v["\uc804\uc790\uacb0\uc7ac \ubb38\uc11c\uad00\ub9ac"],appr_form_admin:v["\uc591\uc2dd\ubcc4 \ubb38\uc11c \uc870\ud68c"],appr_doc_admin:v["\uc591\uc2dd\ubcc4 \ubb38\uc11c \uc870\ud68c"],appr_doc_admin_log:v["\uad00\ub9ac\uc790 \uc791\uc5c5\uae30\ub85d"],company_official:v["\uc804\uc0ac \uacf5\ubb38 \ubc1c\uc1a1\ud568"],user_config:v["\uc804\uc790\uacb0\uc7ac \ud658\uacbd\uc124\uc815"],confirm:d["\ud655\uc778"],cancel:d["\ucde8\uc18c"],collapse:d["\uc811\uae30"],expand:d["\ud3bc\uce58\uae30"],alert_check_editor:m["\ud604\uc7ac \uc791\uc131\uc911\uc778 \ub0b4\uc6a9\uc774 \uc788\uc2b5\ub2c8\ub2e4.<br>\ud654\uba74 \uc774\ub3d9 \uc2dc \uc791\uc131 \uc911\uc778 \ub0b4\uc6a9\uc740 \uc0ac\ub77c\uc9d1\ub2c8\ub2e4.<br>\uc774\ub3d9\ud558\uc2dc\uaca0\uc2b5\ub2c8\uae4c?"],send_docfolder:v["\ubc1c\uc1a1 \ubb38\uc11c\ud568"],audit:v["\uac10\uc0ac"],shared_docfolder:v["\uacf5\uc720\ub41c \ubb38\uc11c\ud568"],user_official_docfolder:v["\uacf5\ubb38 \ubb38\uc11c\ud568"],official_todo_doc:v["\uacf5\ubb38 \ub300\uae30 \ubb38\uc11c"],appr_todoviewer_doc:v["\ucc38\uc870/\uc5f4\ub78c \ub300\uae30 \ubb38\uc11c"]},L=t.View.extend({favoriteFormCollection:null,sideDeptFolderCollection:null,sideDrafterDeptFolderCollection:null,todoCountModel:null,upcomingCountModel:null,todoReceptionCountModel:null,officialTodoCountModel:null,todoViewerCountModel:null,el:"#side",events:{"click a.go_boards[data-navi]":"goDocList","click a#writeBtn":"sideWriteBtnAction","click section.lnb span.ic_side[data-slide]":"slideToggle","click section.lnb a.txt":"slideToggle","click #favoriteSide li span.ic_list_del":"favoriteItemDelete","click span#reorderSave":"favoriteReorderSave","click span[btn-type='deptAdmin']":"deptFolderAdmin","click span[btn-type='userAdmin']":"userFolderAdmin","click #apprHome":"apprHome"},initialize:function(e){this.$el.off(),this.options=e||{},this.deleteFavoriteIds=[],this.favoriteFormCollection=new y,this.sideDeptFolderCollection=new b,this.sideDrafterDeptFolderCollection=new w,this.sideFavoriteFormListView=l,this.model=new E,this.model.fetch({async:!1}),this.configModel=new S(this.model.get("apprConfig")),this.favoriteFormCollection.set(this.model.get("favorites")),this.sideDeptFolderCollection.set(this.model.get("deptFolders")),this.sideDrafterDeptFolderCollection.set(this.model.get("drafterDeptFolders")),this.countFlag=!0,GO.config("excludeExtension",this.configModel.get("excludeExtension")?this.configModel.get("excludeExtension"):"")},render:function(t){t&&(this.model.fetch({async:!1}),this.favoriteFormCollection.set(this.model.get("favorites")),this.sideDeptFolderCollection.set(this.model.get("deptFolders")),this.sideDrafterDeptFolderCollection.set(this.model.get("drafterDeptFolders")),this.configModel=new S(this.model.get("apprConfig")));var r=!1;this.model.get("userFolders")&&(r=this.model.get("userFolders").length>0?!0:!1);var i=!1;this.model.get("sharedFoldersToUser")&&(i=this.model.get("sharedFoldersToUser").length>0?!0:!1);var s=_.extend(this.model.toJSON(),{isDocAdminSideAccessible:this.model.get("isApprDocMaster")||this.model.get("isApprFormAdmin")||this.model.get("isOfficialMaster"),isApprDocumentAccessible:this.model.get("isApprDocMaster")||this.model.get("isApprFormAdmin"),isOfficialDocMaster:this.model.get("isOfficialMaster"),useOfficialConfirm:this.configModel.get("useOfficialConfirm"),isApprDocMaster:this.model.get("isApprDocMaster"),addedFolder:r,sharedFolder:i});e.each(s.sharedFoldersToUser,function(e,t){t.folderType=="USER"?t.isfolderTypeUser=!0:t.isfolderTypeUser=!1});var o=h({lang:k,data:s,isApprovalOpen:this.getStoredCategoryIsOpen(T),isUserOpen:this.getStoredCategoryIsOpen(N),isDeptOpen:this.getStoredCategoryIsOpen(C),appName:GO.util.getAppName("approval")});this.$el.html(o),this.favoriteFormRender(),this.sideDeptFolderRender(),this.drawListCount(),this.selectSideMenu(n.router.getUrl()),this.undelegateEvents(),this.delegateEvents(),this.openWriteLayout(),e("body").trigger("approval.sideRender")},openWriteLayout:function(){GO.router.getSearch("openWriteLayout")=="true"&&e("a#writeBtn",this.$el).trigger("click")},deptFolderAdmin:function(t){var r=e(t.currentTarget),i=r.attr("data-deptid"),s=function(){n.router.navigate("approval/deptfolder/"+i+"/manage",!0)};GO.util.editorConfirm(s)},userFolderAdmin:function(t){var r=e(t.currentTarget),i=function(){n.router.navigate("approval/userfolder/manage",!0)};GO.util.editorConfirm(i)},sideDeptManager:function(){return this.sideDeptFolderCollection.toJSON()},sideDeptFolderRender:function(t){t&&(this.sideDeptFolderCollection=new b,this.sideDeptFolderCollection.fetch({async:!1}),this.sideDrafterDeptFolderCollection=new w,this.sideDrafterDeptFolderCollection.fetch({async:!1}));var n=this.sideDeptFolderCollection.toJSON(),r=!1,i=!1,s=!1;!!n.length&&!!GO.session("useOrg")&&e.each(n,function(t,n){n.deptFolders.length>0?n.addedFolder=!0:n.addedFolder=!1,n.sharedDocFolders&&n.sharedDocFolders.length>0?(n.sharedFolder=!0,e.each(n.sharedDocFolders,function(e,t){t.deptId=n.deptId,t.folderType=="USER"?t.isfolderTypeUser=!0:t.isfolderTypeUser=!1})):n.sharedFolder=!1,n.managable&&n.containsSubDept&&(r=!0)}),this.$el.find("#deptDocfolderSide>ul").html(p({contextRoot:GO.contextRoot,dataset:n,containsSubDept:r,lang:k}))},drawListCount:function(){var e=this;this.todoCountModel=new i,this.todoCountModel.fetch({success:function(){e.todoCount=e.todoCountModel.toJSON().docCount;var t=e.$el.find('ul.side_depth li a[data-navi="todo"] .num');e.todoCount>0?t.text(e.todoCount):t.text("")}}),this.officialTodoCountModel=new f,this.officialTodoCountModel.fetch({success:function(){e.officialTodoCount=e.officialTodoCountModel.toJSON().docCount;var t=e.$el.find('ul.side_depth li a[data-navi="officialtodo"] .num');e.officialTodoCount>0?t.text(e.officialTodoCount):t.text("")}}),this.upcomingCountModel=new s,this.upcomingCountModel.fetch({success:function(){e.upcomingCount=e.upcomingCountModel.toJSON().docCount;var t=e.$el.find('ul.side_depth li a[data-navi="upcoming"] .num');e.upcomingCount>0?t.text(e.upcomingCount):t.text("")}}),this.todoReceptionCountModel=new o,this.todoReceptionCountModel.fetch({success:function(){e.todoReceptionCount=e.todoReceptionCountModel.toJSON().docCount;var t=e.$el.find('ul.side_depth li a[data-navi="todoreception"] .num');e.todoReceptionCount>0?t.text(e.todoReceptionCount):t.text("")}}),this.todoViewerCountModel=new u,this.todoViewerCountModel.fetch({success:function(){e.todoViewerCount=e.todoViewerCountModel.toJSON().docCount;var t=e.$el.find('ul.side_depth li a[data-navi="todoviewer"] .num');e.todoViewerCount>0?t.text(e.todoViewerCount):t.text("")}})},documentSideMenu:function(e){var t=this.selectSideMenu(n.router.getUrl());!t&&e&&this.selectSideMenu(e)},selectSideMenu:function(e){var t=null,n=e.split("?")[0].split("/"),r=n[1],i="",s="",o="",u="";this.$el.find(".on").removeClass("on"),r!=null&&r.indexOf("?")>=0&&(r=r.substr(0,r.indexOf("?")));if(r!=null)if(_.contains(["todo","todoreception","todoviewer","officialtodo","upcoming","usersetting","manage","managelog","manageform","company"],r))i=n[1],i!=null&&i.indexOf("?")>=0&&(i=i.substr(0,i.indexOf("?"))),t=this.$el.find('ul.side_depth li a[data-navi="'+i+'"]');else if(r=="doclist")i=n[2],i!=null&&i.indexOf("?")>=0&&(i=i.substr(0,i.indexOf("?"))),t=this.$el.find('ul.side_depth li a[data-navi="'+i+'"]');else if(r=="document"&&n[2]=="new")i="favorite",o=n[3],s=n[4],t=this.$el.find('ul.side_depth li a[data-navi="'+i+'"][data-deptid="'+o+'"][data-formid = "'+s+'"]');else if(r=="userfolder"){var u=n[2];if(n[3]=="documents"){var i="userdoc";t=this.$el.find('ul.side_depth li a[data-navi="'+i+'"][data-id = "'+u+'"]')}else if(n[3]=="share"){var i="shareuserdoc",a=n[4];if(a=="indept"){var o=n[5];t=this.$el.find('ul.side_depth li a[data-navi="'+i+'"][data-id = "'+u+'"][data-belong = "'+a+'"][data-deptid = "'+o+'"]')}else t=this.$el.find('ul.side_depth li a[data-navi="'+i+'"][data-id = "'+u+'"][data-belong = "'+a+'"]')}}else if(r=="deptfolder")if(_.contains(["draft","receive","reference","official"],n[2])){var i="dept"+n[2],u=n[3];t=this.$el.find('ul.side_depth li a[data-navi="'+i+'"][data-deptid = "'+u+'"]')}else{var u=n[2];if(u=="subfolder")t=this.$el.find("ul.side_depth li.assigned a");else if(n[3]=="documents"){var i="deptdoc";t=this.$el.find('ul.side_depth li a[data-navi="'+i+'"][data-id = "'+u+'"]')}else if(n[3]=="share"){var i="sharedeptdoc",a=n[4],o=n[5];t=this.$el.find('ul.side_depth li a[data-navi="'+i+'"][data-id = "'+u+'"][data-belong = "'+a+'"][data-deptid = "'+o+'"]')}}return _.isNull(t)?!1:(t.parents("p:eq(0)").addClass("on"),!0)},favoriteFormRender:function(t){this.deleteFavoriteIds=[],t&&(this.favoriteFormCollection=new y,this.favoriteFormCollection.fetch({async:!1}));var n=e(this.favoriteFormCollection.toJSON()).map(function(e,t){return{formName:t.formName,formId:t.formId,deptId:t.deptId,id:t.id}});this.sideFavoriteFormListView.render({data:n.get(),isOpen:this.getStoredCategoryIsOpen(x)})},favoriteItemDelete:function(t){var n=e(t.currentTarget).parents("li");this.deleteFavoriteIds.push(n.attr("data-id")),n.remove()},favoriteReorderSave:function(t){var n=this,r=this.sideFavoriteFormListView.getReorderIds();this.favoriteModel||(this.favoriteModel=new a),this.deleteFavoriteIds.length&&e.ajax({url:GO.config("contextRoot")+"api/approval/favorite",contentType:"application/json",dataType:"json",data:JSON.stringify({ids:this.deleteFavoriteIds}),type:"DELETE",success:function(){n.favoriteFormRender(!0)}}),this.sideFavoriteFormListView.destroySortable(),r&&(this.favoriteModel.set("id","",{silent:!0}),this.favoriteModel.save({ids:r},{type:"PUT",success:function(e,t){t.code==200&&n.favoriteFormRender(!0)}}))},goDocListNavi:function(t){var n=e(t.currentTarget),r="/approval/",i=!1;switch(n.attr("data-navi")){case"todo":r+=n.attr("data-navi")+"/all";break;case"upcoming":r+=n.attr("data-navi");break;case"todoreception":r+=n.attr("data-navi")+"/waiting";break;case"officialtodo":r+=n.attr("data-navi");break;case"todoviewer":r+=n.attr("data-navi")+"/all";break;case"deptdraft":r+="deptfolder/draft/"+n.attr("data-deptid");break;case"deptreceive":r+="deptfolder/receive/"+n.attr("data-deptid")+"/waiting";break;case"deptreference":r+="deptfolder/reference/"+n.attr("data-deptid");break;case"deptofficial":r+="deptfolder/official/"+n.attr("data-deptid")+"/all";break;case"userdoc":r+="userfolder/"+n.attr("data-id")+"/documents";break;case"deptdoc":r+="deptfolder/"+n.attr("data-id")+"/documents";break;case"shareuserdoc":n.attr("data-belong")=="indept"?r+="userfolder/"+n.attr("data-id")+"/share/"+n.attr("data-belong")+"/"+n.attr("data-deptid"):r+="userfolder/"+n.attr("data-id")+"/share/"+n.attr("data-belong");break;case"sharedeptdoc":r+="deptfolder/"+n.attr("data-id")+"/share/"+n.attr("data-belong")+"/"+n.attr("data-deptid");break;case"usersetting":r+="usersetting/userconfig";break;case"manageform":r+="manageform";break;case"manage":r+="manage";break;case"company":r+="company/official";break;case"managelog":r+="managelog";break;case"favorite":this.model.get("writeMode")=="POPUP"?(i=!0,r=GO.contextRoot+"app/approval/document/new/popup/"+n.attr("data-deptId")+"/"+n.attr("data-formId")):r+="document/new/"+n.attr("data-deptId")+"/"+n.attr("data-formId");break;case"reception":r+="doclist/reception/waiting";break;case"send":r+="doclist/send/all";break;case"userofficial":r+="doclist/userofficial/all";break;default:r+="doclist/"+n.attr("data-navi")+"/all"}i?window.open(r,"","location=no, directories=no,resizable=yes,status=no,toolbar=no,menubar=no, width=1280,height=650,left=0, top=0, scrollbars=yes"):(this.$el.find(".on").removeClass("on"),n.parent().addClass("on"),GO.router.navigate(r,{trigger:!0}),e("html, body").animate({scrollTop:0}))},approvalWirtePageMovePopup:function(t,n){var r=this;e.goPopup({title:"",message:k.alert_check_editor,modal:!0,buttons:[{btext:k.confirm,btype:"confirm",callback:function(){n=="goDocListNavi"?r.goDocListNavi(t):n=="sideWriteBtnNavi"&&r.sideWriteBtnNavi(t)}},{btext:k.cancel,btype:"normal",callback:function(){}}]})},goDocList:function(e){GO.util.hasActiveEditor()?GO.util.isEditorWriting()?this.approvalWirtePageMovePopup(e,"goDocListNavi"):this.goDocListNavi(e):this.goDocListNavi(e)},slideToggle:function(t){var n=e(t.currentTarget),r=n.parents("h1:first"),i=r.find(".ic_side"),s=this;r.next("ul").slideToggle("fast",function(){e(this).css("display")=="block"?(r.removeClass("folded"),i.attr("title",k.collapse)):(r.addClass("folded"),i.attr("title",k.expand));var t=r.hasClass("approval"),n=r.hasClass("user"),o=r.hasClass("org"),u=r.hasClass("star"),a=!r.hasClass("folded");t?s.storeCategoryIsOpen(T,a):n?s.storeCategoryIsOpen(N,a):o?s.storeCategoryIsOpen(C,a):u&&s.storeCategoryIsOpen(x,a)})},sideWriteBtnNavi:function(t){var r=function(t){this.formId=e("#form_title").attr("data-formId");if(!this.formId)return e.goError(v["\uc591\uc2dd\uc744 \uc120\ud0dd\ud574 \uc8fc\uc138\uc694."]),!1;var r=e("#draftDeptId").val(),i=e("#deptFolderId").val(),s="/approval/document/new/",o=this.model.get("writeMode");o=="POPUP"&&(s=GO.contextRoot+"app"+s+"popup/"),s=s+r+"/"+this.formId,e.isNumeric(i)&&(s+="?deptFolderId="+i),console.log(s),o=="POPUP"?window.open(s,"","location=no, directories=no,resizable=yes,status=no,toolbar=no,menubar=no, width=1280,height=650,left=0, top=0, scrollbars=yes"):(n.router.navigate(s,{trigger:!0}),e("html, body").animate({scrollTop:0})),t.close()},i=e.goPopup({pclass:"layer_normal layer_doc_choice",header:v["\uacb0\uc7ac\uc591\uc2dd \uc120\ud0dd"],modal:!0,width:700,contents:"",buttons:[{btext:d["\ud655\uc778"],btype:"confirm",autoclose:!1,callback:e.proxy(r,this)},{btext:d["\ucde8\uc18c"],btype:"cancel"}]}),s=new c({deptFolderInfos:this.sideDeptFolderCollection.toJSON(),drafterDeptFolderInfos:this.sideDrafterDeptFolderCollection.toJSON(),saveFavoriteCallBack:e.proxy(this.favoriteFormRender,this)});s.render(),i.reoffset()},sideWriteBtnAction:function(e){GO.util.hasActiveEditor()?GO.util.isEditorWriting()?this.approvalWirtePageMovePopup(e,"sideWriteBtnNavi"):this.sideWriteBtnNavi(e):this.sideWriteBtnNavi(e)},release:function(){this.$el.off(),this.$el.empty()},getStoredCategoryIsOpen:function(e){var t=GO.util.store.get(e);return t==null&&(t=!0),t},storeCategoryIsOpen:function(e,t){GO.util.store.set(e,t)},apprHome:function(){var e=function(){n.router.navigate(GO.contextRoot+"approval",!0)};GO.util.editorConfirm(e)}},{__instance__:null,getInstance:function(){return this.__instance__=new this.prototype.constructor,this.__instance__},getManageble:function(){return this.__instance__===null&&(this.__instance__=new this.prototype.constructor),this.__instance__.sideDeptManager()},renderDeptFolder:function(e){this.__instance__===null&&(this.__instance__=new this.prototype.constructor),this.__instance__.sideDeptFolderRender(e)},reload:function(e){this.__instance__===null&&(this.__instance__=new this.prototype.constructor),this.__instance__.render(e)},apprSelectSideMenu:function(e){this.__instance__===null&&(this.__instance__=new this.prototype.constructor),this.__instance__.documentSideMenu(e)},getStoredCategoryIsOpen:function(e){var t=GO.util.store.get(e);return t==null&&(t=!0),t},storeCategoryIsOpen:function(e,t){GO.util.store.set(e,t)}});return L})}).call(this);