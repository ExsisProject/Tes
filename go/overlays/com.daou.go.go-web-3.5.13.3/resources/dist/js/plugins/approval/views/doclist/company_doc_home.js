define(["jquery","underscore","backbone","app","approval/views/content_top","views/pagination","views/pagesize","approval/views/doclist/doclist_item","approval/views/doclist/doclist_csv_download","approval/models/doclist_item","collections/paginated_collection","hgn!approval/templates/doclist_empty","hgn!approval/templates/company_home_doclist","i18n!nls/commons","i18n!approval/nls/approval"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d){var v=null,m=l.extend({model:f.extend({idAttribute:"_id"}),url:function(){return this._makeURL(!1)},getCsvURL:function(){return this._makeURL(!0)},_makeURL:function(t){var n="/api/docfolder";return t&&(n+="/csv"),n+"?"+e.param({page:this.pageNo,offset:this.pageSize,property:this.property,direction:this.direction,searchtype:this.searchtype,keyword:this.keyword})},setSort:function(e,t){this.property=e,this.direction=t,this.pageNo=0},setSearch:function(e,t){this.searchtype=e,this.keyword=t,this.pageNo=0},fetch:function(n){typeof n!="undefined"||(n={});var r=this,i=n.beforeSend;t.isFunction(i)||(v=e.goPreloader(),v.render());var s=n.complete;return n.complete=function(e){v!=null&&v.release(),t.isFunction(s)&&s(r,e)},l.prototype.fetch.call(this,n)},setListParam:function(){this.pageNo=sessionStorage.getItem("list-history-pageNo"),this.pageSize=sessionStorage.getItem("list-history-pageSize"),this.property=sessionStorage.getItem("list-history-property"),this.direction=sessionStorage.getItem("list-history-direction"),this.searchtype=sessionStorage.getItem("list-history-searchtype"),this.keyword=sessionStorage.getItem("list-history-keyword").replace(/\+/gi," ")}}),g=n.View.extend({columns:{"\uacb0\uc7ac\uc77c":d.\uacb0\uc7ac\uc77c,"\uacb0\uc7ac\uc591\uc2dd":d.\uacb0\uc7ac\uc591\uc2dd,"\uc81c\ubaa9":p.\uc81c\ubaa9,"\ucca8\ubd80":d.\ucca8\ubd80,"\uae30\uc548\uc790":d.\uae30\uc548\uc790,"\ubb38\uc11c\ubc88\ud638":d.\ubb38\uc11c\ubc88\ud638,count:6},el:"#content",initialize:function(e){this.options=e||{},t.bindAll(this,"render","renderPageSize","renderPages"),this.contentTop=i.getInstance(),this.collection=new m,this.initProperty="completedAt",this.initDirection="desc",this.ckeyword="";var n=sessionStorage.getItem("list-history-baseUrl");n&&n=="docfolder"?(this.initProperty=sessionStorage.getItem("list-history-property"),this.initDirection=sessionStorage.getItem("list-history-direction"),this.ckeyword=sessionStorage.getItem("list-history-keyword").replace(/\+/gi," "),this.collection.setListParam()):this.collection.setSort(this.initProperty,this.initDirection),sessionStorage.clear(),this.collection.bind("reset",this.resetList,this),this.collection.fetch({statusCode:{403:function(){r.util.error("403")},404:function(){r.util.error("404",{msgCode:"400-common"})},500:function(){r.util.error("500")}}})},events:{"click .sorting":"sort","click .sorting_desc":"sort","click .sorting_asc":"sort","click .btn_search2":"search","keypress input#keyword":"searchByEnter"},render:function(){var t={"\uc81c\ubaa9":p["\uc81c\ubaa9"],"\uae30\uc548\uc790":d["\uae30\uc548\uc790"],"\uac80\uc0c9":p["\uac80\uc0c9"],"\uacb0\uc7ac\uc591\uc2dd":d["\uacb0\uc7ac\uc591\uc2dd"],placeholder_search:p["\ud50c\ub808\uc774\uc2a4\ud640\ub354\uac80\uc0c9"]};this.$el.html(h({lang:t,columns:this.columns})),this.setInitSort(this.initProperty,this.initDirection),this.contentTop.setTitle(d["\ucd5c\uadfc\ub4f1\ub85d\ubb38\uc11c"]),this.contentTop.render(),this.$el.find("header.content_top").replaceWith(this.contentTop.el),this.$el.find("input[placeholder]").placeholder(),this.renderPageSize(),(new a({getDownloadURL:e.proxy(this.collection.getCsvURL,this.collection),appendTarget:this.$el.find("#docToolbar > div.critical")})).render()},renderPageSize:function(){this.pageSizeView=new o({pageSize:this.collection.pageSize}),this.pageSizeView.render(),this.pageSizeView.bind("changePageSize",this.selectPageSize,this)},renderPages:function(){this.pageView=new s({pageInfo:this.collection.pageInfo()}),this.pageView.bind("paging",this.selectPage,this),this.$el.find("div.tool_absolute > div.dataTables_paginate").remove(),this.$el.find("div.tool_absolute").append(this.pageView.render().el)},resetList:function(t){var n=this.collection.url().replace("/api/",""),i=r.router.getUrl().replace("#","");i.indexOf("?")<0?r.router.navigate(n,{replace:!0}):i!=n&&r.router.navigate(n,{trigger:!1,pushState:!0}),e(".list_approval > tbody").empty();var s=this.columns,o="docfolder";t.each(function(t){var n=new u({model:t,listType:o,columns:s});e(".list_approval > tbody").append(n.render().el)}),t.length==0&&e(".list_approval > tbody").html(c({columns:this.columns,lang:{doclist_empty:d["\ubb38\uc11c\uac00 \uc5c6\uc2b5\ub2c8\ub2e4."]}})),this.renderPages()},selectPage:function(e){this.collection.setPageNo(e),this.collection.fetch()},selectPageSize:function(e){this.collection.setPageSize(e),this.collection.fetch()},setInitSort:function(t,n){var r=null,i=this.$el.find("th");i.each(function(){e(this).attr("sort-id")==t&&(r=e(this).attr("id")),e(this).hasClass("sorting_disabled")||(e(this).removeClass("sorting").addClass("sorting"),e(this).removeClass("sorting_desc").addClass("sorting"),e(this).removeClass("sorting_asc").addClass("sorting"))}),e("#"+r).removeClass("sorting").addClass("sorting_"+n),e("#keyword").val(this.ckeyword)},sort:function(t){var n="#"+e(t.currentTarget).attr("id"),r=e(n).attr("sort-id"),i="desc",s="",o="";e(n).hasClass("sorting")&&(s="sorting",o="sorting_desc"),e(n).hasClass("sorting_desc")&&(s="sorting_desc",o="sorting_asc",i="asc"),e(n).hasClass("sorting_asc")&&(s="sorting_asc",o="sorting_desc"),e(n).removeClass(s).addClass(o);var u=this.$el.find("th");u.each(function(){!e(this).hasClass("sorting_disabled")&&"#"+e(this).attr("id")!=n&&(e(this).removeClass("sorting").addClass("sorting"),e(this).removeClass("sorting_desc").addClass("sorting"),e(this).removeClass("sorting_asc").addClass("sorting"))}),this.collection.setSort(r,i),this.collection.fetch()},search:function(){var t=e("#searchtype").val(),n=e.trim(e("#keyword").val());e("input#keyword").attr("placeholder")===this.$el.find("input#keyword").val()&&(n="");if(!n)return e.goMessage(d["\uac80\uc0c9\uc5b4\ub97c \uc785\ub825\ud558\uc138\uc694."]),e("#keyword").focus(),!1;if(!e.goValidation.isCheckLength(2,64,n))return e.goMessage(r.i18n(d["0\uc790\uc774\uc0c1 0\uc774\ud558 \uc785\ub825\ud574\uc57c\ud569\ub2c8\ub2e4."],{arg1:"2",arg2:"64"})),e("#keyword").focus(),!1;this.collection.setSearch(t,n),this.collection.fetch()},searchByEnter:function(t){if(t.keyCode!=13)return;t&&t.preventDefault(),e(t.currentTarget).focusout().blur(),this.search()},release:function(){this.$el.off(),this.$el.empty()}});return g});