define(["jquery","underscore","backbone","app","approval/views/doclist/doclist_item","approval/views/doclist/base_doclist","approval/views/content_top","views/pagination","views/pagesize","approval/collections/todo_viewer_doclist","approval/models/doclist_item","hgn!approval/templates/todo_viewer_doclist","hgn!approval/templates/doclist_empty","i18n!nls/commons","i18n!approval/nls/approval"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d){var v={"\uc81c\ubaa9":p["\uc81c\ubaa9"],"\uae30\uc548\uc790":d["\uae30\uc548\uc790"],"\uacb0\uc7ac\uc120":d["\uacb0\uc7ac\uc120"],"\uae30\uc548\ubd80\uc11c":d["\uae30\uc548\ubd80\uc11c"],"\ubb38\uc11c\ubc88\ud638":d["\ubb38\uc11c\ubc88\ud638"],"\uac80\uc0c9":p["\uac80\uc0c9"],"\uacb0\uc7ac\uc591\uc2dd":d["\uacb0\uc7ac\uc591\uc2dd"],placeholder_search:p["\ud50c\ub808\uc774\uc2a4\ud640\ub354\uac80\uc0c9"],"\uc804\uccb4":d["\uc804\uccb4"],"\ucc38\uc870":d["\ucc38\uc870"],"\uc5f4\ub78c":d["\uc5f4\ub78c"],"\uc77c\uad04 \ud655\uc778":d["\uc77c\uad04 \ud655\uc778"],"\uc815\ub9d0\ub85c \uc77c\uad04 \ud655\uc778 \ud558\uc2dc\uaca0\uc2b5\ub2c8\uae4c?":d["\uc815\ub9d0\ub85c \uc77c\uad04 \ud655\uc778 \ud558\uc2dc\uaca0\uc2b5\ub2c8\uae4c?"]},m=n.Model.extend({url:"/api/approval/todoviewer/count"}),g=s.extend({columns:{"\uc811\uc218\uc77c":d["\uc811\uc218\uc77c"],"\uacb0\uc7ac\uc591\uc2dd":d["\uacb0\uc7ac\uc591\uc2dd"],"\uae34\uae09":d["\uae34\uae09"],"\uc81c\ubaa9":p["\uc81c\ubaa9"],"\ucca8\ubd80":d["\ucca8\ubd80"],"\uae30\uc548\uc790":d["\uae30\uc548\uc790"],"\ub2f4\ub2f9\uc790":d["\ub2f4\ub2f9\uc790"],"\uacb0\uc7ac\uc0c1\ud0dc":d["\uacb0\uc7ac\uc0c1\ud0dc"],"\uc6d0\ubb38\ubc88\ud638":d["\uc6d0\ubb38\ubc88\ud638"],"\uc218\uc2e0\ubd80\uc11c":d["\uc218\uc2e0\ubd80\uc11c"],count:10},el:"#content",docFolderType:"todo_ref",usePeriod:!0,events:{"click input:checkbox":"toggleCheckbox","click .tab_nav > li":"selectTab","click .sorting":"sort","click .sorting_desc":"sort","click .sorting_asc":"sort","click .btn_search2":"search","keypress input#keyword":"searchByEnter","click a#bulkRead":"onBulkReadClicked"},initialize:function(e){this.options=e||{},this.type=this.options.type,t.contains(this.type,"?")&&(this.type=this.type.substr(0,this.type.indexOf("?"))),this.contentTop=o.getInstance(),this.collection=new f(this.type),this.initProperty="document.draftedAt",this.initDirection="desc",this.initPage=20,this.ckeyword="",t.bindAll(this,"render","renderPageSize","renderPages"),this.todoViewerCountModel=new m;var n=sessionStorage.getItem("list-history-baseUrl");n&&(n=n.replace(/#/gi,"")),n&&n=="approval/todoviewer/all"?(this.initProperty=sessionStorage.getItem("list-history-property"),this.initDirection=sessionStorage.getItem("list-history-direction"),this.initSearchtype=sessionStorage.getItem("list-history-searchtype"),this.ckeyword=sessionStorage.getItem("list-history-keyword").replace(/\+/gi," "),this.collection.setListParam()):(this.collection.pageSize=this.initPage,this.collection.setSort(this.initProperty,this.initDirection)),sessionStorage.clear(),this.checkboxColumn={id:"checkedAllDeptDoc",name:"checkedAllDeptDoc"},this.collection.bind("reset",this.resetList,this),s.prototype.initialize.call(this,e)},renderLayout:function(){this.$el.html(c({buttons:this.buttons,lang:v})),this.type.indexOf("?")>=0&&(this.type=this.type.substr(0,this.type.indexOf("?"))),e("#tab_"+this.type).addClass("on");var t=d["\ucc38\uc870/\uc5f4\ub78c \ub300\uae30 \ubb38\uc11c"];this.contentTop.setTitle(t),this.contentTop.render(),this.$el.find("header.content_top").replaceWith(this.contentTop.el),this.renderPageSize()},toggleCheckbox:function(t){var n=e(t.currentTarget),r=e("input#checkedAllDeptDoc"),i=n.is(":checked");n.attr("id")==r.attr("id")&&e('input[type="checkbox"][name="checkbox"]').attr("checked",i),n.hasClass("doclist_item_checkbox")&&(i||r.attr("checked",i))},renderTitle:function(e){this.contentTop.setTitle(e),this.contentTop.render()},renderPageSize:function(){this.pageSizeView=new a({pageSize:this.collection.pageSize}),this.pageSizeView.render(),this.pageSizeView.bind("changePageSize",this.selectPageSize,this)},renderPages:function(){this.pageView=new u({pageInfo:this.collection.pageInfo()}),this.pageView.bind("paging",this.selectPage,this),this.$el.find("div.tool_absolute > div.dataTables_paginate").remove(),this.$el.find("div.tool_absolute").append(this.pageView.render().el),this.$el.find("#checkedAllDeptDoc").attr("checked",!1)},resetList:function(t){var n=this.collection.url().replace("/api/",""),s=r.router.getUrl().replace("#","");s.indexOf("?")<0?r.router.navigate(n,{replace:!0}):s!=n&&r.router.navigate(n,{trigger:!1,pushState:!0}),e(".list_approval > tbody").empty();var o=this.columns,u="approval";t.each(function(t){var n=new i({model:t,isCheckboxVisible:!0,listType:u,columns:o,isReception:!1});e(".list_approval > tbody").append(n.render().el)}),t.length==0&&e(".list_approval > tbody").html(h({columns:this.columns,lang:{doclist_empty:d["\ubb38\uc11c\uac00 \uc5c6\uc2b5\ub2c8\ub2e4."]}})),this.renderPages()},selectTab:function(t){this.collection.setPageNo(0),e(".tab_nav > li").removeClass("on"),e(t.currentTarget).addClass("on");var n=e(t.currentTarget).attr("id");n=="tab_all"?this.collection.setType("all"):n=="tab_reference"?this.collection.setType("reference"):n=="tab_reading"&&this.collection.setType("reading"),this.collection.fetch()},selectPage:function(e){this.collection.setPageNo(e),this.collection.fetch()},selectPageSize:function(e){this.collection.setPageSize(e),this.collection.fetch()},onBulkReadClicked:function(){var n=e("input.doclist_item_checkbox:checked"),i=this,s=[],o=[];if(n.length<1){e.goAlert(d["\uc120\ud0dd\ub41c \ud56d\ubaa9\uc774 \uc5c6\uc2b5\ub2c8\ub2e4."]);return}var u=[];u.push('<p class="q">'+v["\uc815\ub9d0\ub85c \uc77c\uad04 \ud655\uc778 \ud558\uc2dc\uaca0\uc2b5\ub2c8\uae4c?"]+"</p>"),e.goConfirm(u.join(""),"",function(){var s=t.map(n,function(t){return parseInt(e(t).attr("data-id"))});r.EventEmitter.trigger("common","layout:setOverlay",""),i.bulkRead(s).done(function(t,n,i){e.goAlert(r.i18n(d["{{arg1}}\uac1c\uc758 \ud655\uc778\uc774 \uc644\ub8cc\ub418\uc5c8\uc2b5\ub2c8\ub2e4."],{arg1:s.length}))}).fail(function(t,n,r){t.responseJSON.name=="pwd.not.match"?e.goAlert(t.responseJSON.message):e.goAlert(p["500 \uc624\ub958\ud398\uc774\uc9c0 \ud0c0\uc774\ud2c0"])}).complete(function(){i.collection.fetch(),r.EventEmitter.trigger("common","layout:clearOverlay",!0),i.todoViewerCountModel.fetch({success:function(t){e('#apprSide a[data-navi="todoviewer"] span.num').text(t.get("docCount")||"")}})})})},bulkRead:function(t){return e.ajax({url:r.contextRoot+"api/approval/document/bulkread",type:"PUT",dataType:"json",contentType:"application/json",data:JSON.stringify({docIds:t})})},release:function(){this.$el.off(),this.$el.empty()}});return g});