define(["jquery","backbone","app","approval/models/activity","approval/collections/activities","i18n!approval/nls/approval"],function(e,t,n,r,i,s){var o={APPROVAL:s["\uacb0\uc7ac"],AGREEMENT:s["\ud569\uc758"],CHECK:s["\ud655\uc778"],INSPECTION:s["\uac10\uc0ac"]};return t.Model.extend({defaults:{seq:0,name:"",maxApprovalCount:5,activities:null,useApproval:!0},initialize:function(){_.isArray(this.get("activities"))||this.set("activities",[])},addActivity:function(e,t){var n=new i(this.get("activities")),s=new r(e);s.get("name")||s.set("name",o[s.get("type").toUpperCase()],{silent:!0});if(n.isExistActivity(s))return!1;_.isNumber(t)?n.add(s.clone(),{at:t,merge:!0}):n.add(s.clone()),this.set("activities",n.toJSON())},isExceedMaxApprovalCount:function(){var e=new i(this.get("activities"));return e.getApprovalAndDraftActivities().length>this.get("maxApprovalCount")},isFullMaxApprovalCount:function(){var e=new i(this.get("activities"));return e.getApprovalAndDraftActivities().length>=this.get("maxApprovalCount")},isFullMaxApprovalAndAgreementCount:function(){var e=new i(this.get("activities"));return e.getApprovalAndAgreementAndDraftActivities().length>=this.get("maxApprovalCount")},getMaxApprovalCount:function(){return this.get("maxApprovalCount")},isExistActivity:function(e){var t=new r(e),n=new i(this.get("activities"));return n.isExistActivity(t)},setActivityType:function(e,t,n,r){var i=this.getActivityCollection(),s=i.getByUserIdAndDeptId(e,t);s.setType(n,r),this.set("activities",i.toJSON())},setArbitrarilyDecidable:function(e,t,n){var r=this.getActivityCollection(),i=r.getByUserIdAndDeptId(e,t);i.setArbitrarilyDecidable(n),this.set("activities",r.toJSON())},getActivityCollection:function(){return new i(this.get("activities"))},getApprovalAndDraftActivities:function(){var e=new i(this.get("activities"));return e.getApprovalAndDraftActivities()},getApprovalAndAgreementAndDraftActivities:function(){var e=new i(this.get("activities"));return e.getApprovalAndAgreementAndDraftActivities()},canUseApproval:function(e){return this.get("useApproval")},canUseAgreement:function(e){return e.useAgreement?this.get("useAgreement"):!1},canUseCheck:function(e){return e.useCheckActivity?this.get("useCheck"):!1},canUseInspection:function(e){return e.useInspectionActivity?this.get("useInspection"):!1},isAllApprovalTypeBlock:function(e){return!this.canUseApproval(e)&&!this.canUseAgreement(e)&&!this.canUseCheck(e)&&!this.canUseInspection(e)},getAvailableApprovalType:function(e){var t=[];return this.canUseApproval(e)&&t.push({type:"APPROVAL",name:o.APPROVAL}),this.canUseAgreement(e)&&t.push({type:"AGREEMENT",name:o.AGREEMENT}),this.canUseCheck(e)&&t.push({type:"CHECK",name:o.CHECK}),this.canUseInspection(e)&&t.push({type:"INSPECTION",name:o.INSPECTION}),t},onlyCanAgreement:function(e){var t=this.getAvailableApprovalType(e);return t.length==1&&_.first(t)["type"]=="AGREEMENT"},agreementAllowTypeValidate:function(e,t){return e=="USER"&&!t||e=="DEPARTMENT"&&t||e=="ALL"},getValidApprovalType:function(e,t){var n=this.getAvailableApprovalType(e);return t.isDept?_.findWhere(n,{type:"AGREEMENT"}):_.findWhere(n,{type:t.type})||_.first(n)},removeActivityByUserIdAndDeptId:function(e,t){var n=new i(this.get("activities"));n.removeByUserIdAndDeptId(e,t),this.set("activities",n.toJSON())},sortActivitiesByUserIdAndDeptId:function(e){var t=new i(this.get("activities")),n=new i;_.each(e,function(e){var i={userId:e.userId,deptId:e.deptId};i.userId==""&&(i.userId=null),i.deptId==""&&(i.deptId=null);var s=new r(i);t.each(function(e){e.equals(s)&&n.add(e)})}),this.set("activities",n.toJSON())}})});