define(["jquery","underscore","backbone","app","hgn!approval/templates/document/main","hgn!approval/templates/document/action_document","hgn!approval/templates/document/force_return_document","hgn!approval/templates/document/actcopy","hgn!approval/templates/add_org_member","approval/models/appr_flow","approval/models/document","approval/models/document_reader","approval/models/document_manage","approval/models/appr_master_auth","approval/views/content_top","approval/views/document_manage_toolbar","approval/views/document/document","approval/views/document/apprflow_editor","approval/views/document/apprflow","approval/views/document/doc_receive","approval/views/document/doc_receiver_assign","approval/views/document/doc_foldertype","approval/views/document/docinfo","approval/views/document/dochistory","approval/views/document/reader_history_list","approval/views/document/reception_document_list","approval/views/document/official_doc_receiver_list","approval/views/document/doc_type_select","approval/views/document/dept_folder","approval/views/document/document_print","approval/views/side","approval/components/appr_form_integrator","i18n!nls/commons","i18n!approval/nls/approval"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M,_,D){function j(e){e.documentInit(),e.render()}var P={"\uacb0\uc7ac\ubb38\uc11c\uba85":D["\uacb0\uc7ac\ubb38\uc11c\uba85"],"\uae30\uc548\uc790":D["\uae30\uc548\uc790"],"\uae30\uc548\ubd80\uc11c":D["\uae30\uc548\ubd80\uc11c"],"\uacb0\uc7ac\uc790":D["\uacb0\uc7ac\uc790"],"\ubc18\ub824\uc790":D["\ubc18\ub824\uc790"],"\uae30\uc548\uc758\uacac":D["\uae30\uc548\uc758\uacac"],"\uacb0\uc7ac\uc758\uacac":D["\uacb0\uc7ac\uc758\uacac"],"\ubc18\ub824\ub313\uae00":D["\ubc18\ub824\ub313\uae00"],"\uacb0\uc7ac\ube44\ubc00\ubc88\ud638":D["\uacb0\uc7ac\ube44\ubc00\ubc88\ud638"],"\uacb0\uc7ac\uc635\uc158":D["\uacb0\uc7ac\uc635\uc158"],"\uacb0\uc7ac\uc120":D["\uacb0\uc7ac\uc120"],"\ubb38\uc11c\uc815\ubcf4":D["\ubb38\uc11c\uc815\ubcf4"],"\ubcc0\uacbd\uc774\ub825":D["\ubcc0\uacbd\uc774\ub825"],"\uacf5\ubb38\ubc1c\uc1a1":D["\uacf5\ubb38\ubc1c\uc1a1"],"\ubc18\ub824\ud558\uae30":D["\ubc18\ub824\ud558\uae30"],"\uc5f4\ub78c\uc790 \ucd94\uac00":D["\uc5f4\ub78c\uc790 \ucd94\uac00"],"\uc758\uacac\uc744 \uc791\uc131\ud574 \uc8fc\uc138\uc694":D["\uc758\uacac\uc744 \uc791\uc131\ud574 \uc8fc\uc138\uc694"],"\uc785\ub825\ud55c \ub0b4\uc6a9\uc740 \ud574\ub2f9 \uacb0\uc7ac\ubb38\uc11c\uc758 \ub313\uae00\uc5d0 \uae30\ub85d\ub429\ub2c8\ub2e4":D["\uc785\ub825\ud55c \ub0b4\uc6a9\uc740 \ud574\ub2f9 \uacb0\uc7ac\ubb38\uc11c\uc758 \ub313\uae00\uc5d0 \uae30\ub85d\ub429\ub2c8\ub2e4"],"\ub2e4\uc74c\ubb38\uc11c\ub85c\uc774\ub3d9":D["\ub2e4\uc74c\ubb38\uc11c\ub85c\uc774\ub3d9"],"\ub2e4\uc74c\ubb38\uc11c\ub85c\uc774\ub3d9\uc124\uba85":D["\ub2e4\uc74c\ubb38\uc11c\ub85c\uc774\ub3d9\uc124\uba85"],"\uc5f4\ub78c\uae30\ub85d":D["\uc5f4\ub78c\uae30\ub85d"],"\uc218\uc2e0":D["\uc218\uc2e0"],"\ubc18\uc1a1\ud558\uae30":D["\ubc18\uc1a1\ud558\uae30"],"\ubc18\uc1a1\uc790":D["\ubc18\uc1a1\uc790"],"\ubc18\uc1a1\ub313\uae00":D["\ubc18\uc1a1\ub313\uae00"],"\uac15\uc81c \ubc18\uc1a1 \uc2dc \ub313\uae00\uc744 \ud544\uc218\ub85c \uc785\ub825\ud574\uc57c \ud558\uba70 \ud574\ub2f9 \uc218\uc2e0\ubb38\uc11c\uc758 \ub313\uae00\uc5d0 \uae30\ub85d\ub429\ub2c8\ub2e4":D["\uac15\uc81c \ubc18\uc1a1 \uc2dc \ub313\uae00\uc744 \ud544\uc218\ub85c \uc785\ub825\ud574\uc57c \ud558\uba70 \ud574\ub2f9 \uc218\uc2e0\ubb38\uc11c\uc758 \ub313\uae00\uc5d0 \uae30\ub85d\ub429\ub2c8\ub2e4"],"\uac15\uc81c \ubc18\ub824 \uc2dc \ub313\uae00\uc744 \ud544\uc218\ub85c \uc785\ub825\ud574\uc57c \ud558\uba70 \ud574\ub2f9 \uacb0\uc7ac\ubb38\uc11c\uc758 \ub313\uae00\uc5d0 \uae30\ub85d\ub429\ub2c8\ub2e4":D["\uac15\uc81c \ubc18\ub824 \uc2dc \ub313\uae00\uc744 \ud544\uc218\ub85c \uc785\ub825\ud574\uc57c \ud558\uba70 \ud574\ub2f9 \uacb0\uc7ac\ubb38\uc11c\uc758 \ub313\uae00\uc5d0 \uae30\ub85d\ub429\ub2c8\ub2e4"]},H=!1,B=n.View.extend({viewerTypes:["docmaster","formadmin","officialdocmaster"],el:"#content",masterAuthModel:null,events:{"click .tab_nav > li":"selectTab","click #addReading span.ic_del":"readingDeleteItem","click #prev":"_agoSlide","click #next":"_nxtSlide"},initialize:function(e){this.options=e||{},this.docId=this.options.docId,this.type="DOCUMENT",this.viewerType=this.options.viewerType;if(!t.contains(this.viewerTypes,this.viewerType))throw new Error("\uc9c0\uc6d0\ud558\uc9c0 \uc54a\ub294 \ud0c0\uc785\uc785\ub2c8\ub2e4.");this.documentInit()},documentInit:function(){this.formIntegrator=new M,this.model=h.create(this.docId,this.viewerType),this.model.fetch({async:!1,statusCode:{403:function(){GO.util.error("403")},404:function(){GO.util.error("404",{msgCode:"400-common"})},500:function(){GO.util.error("500")}},reset:!0}),this.masterAuthModel=new p({docId:this.docId}),this.masterAuthModel.fetch({async:!1,statusCode:{403:function(){GO.util.error("403")},404:function(){GO.util.error("404",{msgCode:"400-common"})},500:function(){GO.util.error("500")}}}),this.title='<span class="txt single_tit" title="'+this.model.get("document").title+'">'+this.model.get("document").title+"</span>",this.docId=this.model.get("document").documentId,this.formIntegrator.setDocVariables(this.model.get("document").variables),this.formIntegrator.setStatus(this.type=="REAPPLY"?this.type:this.model.get("document").docStatus),this.listenTo(this.model,"change",this.changeApprFlowAndDocInfo,this),this.isPassword=this.model.get("actionCheck").usePassword,this.isManageable=this.viewerType=="docmaster"||this.viewerType=="formadmin",this.toolbarView=new v({isManageable:this.isManageable,docStatus:this.model.get("document").docStatus,actionCheck:this.model.get("actionCheck"),masterAuthModel:this.masterAuthModel}),this.isManageable?(this.masterAuthModel.authRead()&&this.toolbarView.bind("editApprFlow",this.editApprFlow,this),this.masterAuthModel.authWrite()&&(this.toolbarView.bind("saved",this.saveDocument,this),this.toolbarView.bind("canceled",this.cancelEdit,this),this.toolbarView.bind("edit",this.editDocument,this),this.toolbarView.bind("forceReturn",this.actForceReturn,this),this.toolbarView.bind("forceRecvReturned",this.actForceRecvReturned,this),this.toolbarView.bind("cancelReception",this.actCancelReception,this),this.toolbarView.bind("reassignReceiver",this.actReassignReceiver,this)),this.masterAuthModel.authRemove()&&this.toolbarView.bind("deleted",this.deleteDocument,this)):this.toolbarView.bind("editApprFlow",this.editApprFlow,this),this.toolbarView.bind("docPrint",this.docPrint,this),this.toolbarView.bind("actList",this.actList,this),this.documentView=new m({type:this.type,docId:this.model.get("document").documentId,model:this.model.get("document"),infoData:this.model.get("docInfo"),actionModel:this.model.get("actionCheck"),formIntegrator:this.formIntegrator}),this.apprFlowView=new y({type:this.type,docId:this.model.get("document").documentId,model:new f(this.model.get("apprFlow"))}),this.isReaderExist=this.model.get("docInfo").docReadingReaders.length>0?!0:!1,this.docInfoView=new S({type:this.type,docId:this.model.get("document").documentId,docStatus:this.model.get("document").docStatus,docInfoModel:this.model.get("docInfo"),actionModel:this.model.get("actionCheck"),isComplete:this.model.get("document").docStatus=="COMPLETE"?!0:!1,isActivityUser:this.model.get("actionCheck").isActivityUser,isReader:this.model.get("actionCheck").isReader,isReceptionDocument:this.model.get("document").isReceptionDocument}),this.docInfoView.bind("docTypeSelect",this.docTypeSelect,this),this.docInfoView.bind("docFolderSelect",this.docFolderSelect,this),this.docInfoView.bind("securityLevelSelect",this.securityLevelSelect,this),this.docInfoView.bind("docYearSelect",this.docYearSelect,this),this.docInfoView.bind("docReferenceSelect",this.docReferenceSelect,this),this.docInfoView.bind("docReceiveSelect",this.docReceiveSelect,this),this.docInfoView.bind("showOrgSlider",this.showOrgSlider,this),this.isManageable&&this.docInfoView.bind("saveDocReader",this.saveDocReader,this),this.docHistoryView=new x({model:this.model}),this.docHistoryView.bind("showApprChangeLog",this.showApprChangeLog,this),this.readHistoryView=new T({docId:this.model.get("document").documentId,collection:this.model.get("readingHistory")}),this.receptionView=new N({docId:this.model.get("document").documentId,collection:this.model.get("receptionList")}),this.officialDocReceiverView=new C({dataList:this.model.get("docInfo").officialVersions,docStatus:this.model.get("document").docStatus,isAdmin:!1}),this.contentTop=d.getInstance(),this.contentTop.setTitle(this.title),O.apprSelectSideMenu(sessionStorage.getItem("list-history-baseUrl"));var t=this.model.get("actionCheck");t.companyDocFolderUseFlag||(e("#refDocPart").hide(),e("#companyDocFolderUse").hide(),e("#act_addFolder").hide())},showPreserveYears:function(e){return e==0?D["\uc601\uad6c"]:e+D["\ub144"]},showOrgSlider:function(t){var n=this;return e.goOrgSlide({header:D["\uc5f4\ub78c\uc790 \uc120\ud0dd"],type:"list",contextRoot:GO.contextRoot,callback:n.addReading})},addReading:function(t){var n=e("#addReading");t&&!n.find('li[data-id="'+t.id+'"]').length?n.find("li.creat").before(a(e.extend(t,{lang:P}))):e.goMessage(D["\uc774\ubbf8 \uc120\ud0dd\ub418\uc5c8\uc2b5\ub2c8\ub2e4."])},readingDeleteItem:function(t){e(t.currentTarget).parents("li").remove()},render:function(){this.setSlideConfig(),this.$el.html(i({lang:P})),this.assign(this.toolbarView,"div.tool_bar"),this.assign(this.documentView,"div.approval_type"),this.append(this.apprFlowView,"div.doc-meta-container"),this.append(this.docInfoView,"div.doc-meta-container"),this.append(this.docHistoryView,"div.doc-meta-container"),this.append(this.readHistoryView,"div.doc-meta-container"),this.append(this.receptionView,"div.doc-meta-container"),this.append(this.officialDocReceiverView,"div.doc-meta-container"),this.showApprFlow();var t={preserveDuration:e("#docYear option:selected").text()||this.showPreserveYears(this.model.get("docInfo").docYear)};this.documentView.setApprovalData(t),e(".tab_nav > li").removeClass("on"),e(".tab_nav > li > span").removeClass("txt_b"),e("#tab_apprflow").addClass("on"),this.contentTop.render(),this.$el.find("header.content_top").replaceWith(this.contentTop.el)},selectTab:function(t){e(".tab_nav > li").removeClass("on"),e(t.currentTarget).addClass("on");switch(e(t.currentTarget).attr("id")){case"tab_apprflow":this.showApprFlow();break;case"tab_docinfo":this.showDocInfo();break;case"tab_dochistory":this.showDocHistory();break;case"tab_readerhistory":this.showReaderHistory();break;case"tab_receptiondocument":this.showReceptionDocument();break;case"tab_officialdocreceiver":this.showOfficialDocReceiver()}},setSlideConfig:function(){this.slideConfig={slideStop:77,slidePage:1,shownBlockCount:3,HProc:!0}},_agoSlide:function(){var t=this;t.slideConfig.HProc&&!t.$("#prev").hasClass("tab_disabled")&&t.slideConfig.slidePage>1&&(t.slideConfig.slidePage=t.slideConfig.slidePage-1,HProc=!1,e("#slideLayer").animate({left:"-"+String((t.slideConfig.slidePage-1)*t.slideConfig.slideStop)+"px"},250,function(){t.slideConfig.HProc=!0,t.displaySlideNavStyle()}))},_nxtSlide:function(){var t=this;t.slideConfig.HProc&&!t.$("#next").hasClass("tab_disabled")&&t.slideConfig.slidePage<e("#slideLayer li:visible").length-(t.slideConfig.shownBlockCount-1)&&(t.slideConfig.slidePage=t.slideConfig.slidePage+1,HProc=!1,e("#slideLayer").animate({left:"-"+String((t.slideConfig.slidePage-1)*t.slideConfig.slideStop)+"px"},250,function(){t.slideConfig.HProc=!0,t.displaySlideNavStyle()}))},displaySlideNavStyle:function(){var t=this;e("#slideLayer li:visible").length>3?(this.$("#prev").removeClass("tab_disabled"),this.$("#next").removeClass("tab_disabled"),t.slideConfig.slidePage==1?this.$("#prev").addClass("tab_disabled"):t.slideConfig.slidePage==e("#slideLayer li:visible").length-(t.slideConfig.shownBlockCount-1)&&this.$("#next").addClass("tab_disabled")):(this.$("#prev").addClass("tab_disabled"),this.$("#next").addClass("tab_disabled"))},allTabHide:function(){e(this.apprFlowView.el).hide(),e(this.docInfoView.el).hide(),e(this.docHistoryView.el).hide(),e(this.readHistoryView.el).hide(),e(this.receptionView.el).hide(),e(this.officialDocReceiverView.el).hide()},showApprFlow:function(){this.allTabHide(),e(this.apprFlowView.el).show()},showDocInfo:function(){this.allTabHide(),e(this.docInfoView.el).show()},showDocHistory:function(){this.allTabHide(),e(this.docHistoryView.el).show()},showReaderHistory:function(){this.allTabHide(),e(this.readHistoryView.el).show()},showReceptionDocument:function(){this.allTabHide(),e(this.receptionView.el).show()},showOfficialDocReceiver:function(){this.allTabHide(),e(this.officialDocReceiverView.el).show()},changeApprFlowAndDocInfo:function(){var n=this,r=this.model.get("apprFlow"),i=this.model.get("document").isReceptionDocument,s=this.model.get("document").apprFlowVersionId;if(H)return;t.isUndefined(this.model.get("document").apprFlowVersionId)||(r.apprFlowVersionId=this.model.get("document").apprFlowVersionId),this.model.Request.updateDocMetainfo({masterChange:!0},{beforeSend:function(){H=!0,GO.EventEmitter.trigger("common","layout:setOverlay","")},success:function(e){j(n)},error:function(t,n){var r=JSON.parse(n.responseText),i=r.message;e.goError(i)},complete:function(){GO.EventEmitter.trigger("common","layout:clearOverlay",!0),H=!1}})},changeActivityGroups:function(e,t){this.documentView.changeActivityGroups(e,t),this.apprFlowView.makeApprFlow(e)},getActDocument:function(t,n){var r=this.model.get("document").formName,i=this.documentView.getTitle(),o=this.model.get("document").title?i?i:this.model.get("document").title:i?i:r,u=e("#apprflow").find("div[data-userId="+GO.session().id+"]"),a=e(u).attr("data-userName")+" "+e(u).attr("data-userPosition"),f=e(u).attr("data-userDeptName"),l=e("#emergency").is(":checked");return e(u).attr("data-userName")||(u=this.model.get("apprFlow").currentUserId,a=this.model.get("apprFlow").currentUserName+" "+this.model.get("apprFlow").currentUserPositionName,f=this.model.get("apprFlow").currentUserDeptName),contents=s({isPassword:this.isPassword,lang:P,isDraft:t,documentTitle:o,userName:a,userDept:f,isEmergency:l,isCancel:n?!0:!1})},getForceReturnContents:function(e){var t=this.documentView.getTitle(),n=this.model.get("document").title?t?t:this.model.get("document").title:t?t:this.model.get("document").formName,r=GO.session().name+" "+GO.session().position,i="";return o({lang:P,documentTitle:n,userName:r,userDept:i,useForceReturn:e.useForceReturn,useForceRecvReturned:e.useForceRecvReturned})},saveDocument:function(){var t=this;if(!t.checkActivity())return!1;if(!t.checkCompleteForm())return!1;if(!this.formIntegrator.validate())return!1;e.goConfirm(D["\uc800\uc7a5\ud558\uc2dc\uaca0\uc2b5\ub2c8\uae4c?"],"",function(){var n=t.model.get("document").documentId,r=t.model.get("apprFlow"),i=l.create(n),s=t.model.get("document").docVersionId;t.formIntegrator.beforeSave(),i.set({document:t.getDocumentData(n),docInfo:t.getDocInfoData(n),apprFlow:r,docVersionId:s,masterChange:!0},{silent:!0}),i.save({},{type:"PUT",success:function(n,r){r.code==200&&(t.documentInit(),t.render(),e.goMessage(D["\uc800\uc7a5\uc774 \uc644\ub8cc\ub418\uc5c8\uc2b5\ub2c8\ub2e4."]),t.formIntegrator.afterSave())},error:function(t,n){var r=JSON.parse(n.responseText);return r.message?(e.goError(r.message),!1):(e.goError(_["\uc800\uc7a5\uc5d0 \uc2e4\ud328 \ud558\uc600\uc2b5\ub2c8\ub2e4."]),!1)}})})},cancelEdit:function(){var t=this;e.goConfirm(D["\ucde8\uc18c\ud558\uc2dc\uaca0\uc2b5\ub2c8\uae4c?"],"",function(){t.documentInit(),t.render(),e.goMessage(D["\ucde8\uc18c \ub418\uc5c8\uc2b5\ub2c8\ub2e4."])})},getDocumentData:function(e,t){var n=this.documentView.getTitle(),r=this.model.get("document").title?n?n:this.model.get("document").title:n?n:this.model.get("document").formName,i=this.formIntegrator.getDocVariables()||this.documentView.getDocVariables();return documentData={id:e,documentId:e,docStatus:t,attachCount:0,attaches:this.getAttachData(),comments:this.getCommentsData(),references:this.getReferencesData(),docBodyContent:this.getDocBodyContentData(),title:r,variables:i,updatedAt:this.model.get("document").updatedAt}},getAttachData:function(){var t=[],n=e("#attachPart").find("li[data-tmpname]:not(.attachError)");return n.each(function(){attachOpt={},e(this).attr("data-tmpname")&&(attachOpt.path=e(this).attr("data-tmpname")),e(this).attr("data-name")&&(attachOpt.name=e(this).attr("data-name")),e(this).attr("data-id")&&(attachOpt.id=e(this).attr("data-id")),t.push(attachOpt)}),t},getCommentsData:function(){var e=[];return e},getReferencesData:function(){var t=[],n=e("#refDocPart").find("li[data-id]"),r=e("#receptionOriginDocPart").find("li[data-id]");return n.each(function(){t.push({id:e(this).data("id")})}),r.each(function(){t.push({id:e(this).data("id")})}),t},getDocBodyContentData:function(){return this.documentView.getDocBodyContents()},getDocInfoData:function(t){var n=this;return docInfoData={id:t,securityLevelId:e("#infoSecurityLevel").val(),docYear:e("#docYear").val(),docFolders:n.getDocFolderData(),docReceptionReaders:n.getDocReceptionReadersData(),docReferenceReaders:n.getDocReferenceReadersData(),docReadingReaders:n.getDocReadingReadersData(),isPublic:e(':radio[name="openType"]:checked').val(),isEmergency:e("#emergency").is(":checked")}},getDocFolderData:function(){var t=[],n=e("#addFolder").find("li[data-id]");return n.each(function(){e(this).attr("data-Type")=="true"&&t.push({id:e(this).attr("data-id")})}),t},getDocReceptionReadersData:function(){var t=[],n=e("#addReceive").find("li[data-id]");return n.each(function(){t.push({id:e(this).attr("data-sid"),reader:{id:e(this).attr("data-userId"),name:e(this).attr("data-userName"),position:e(this).attr("data-userPosition"),deptType:e(this).attr("data-deptType")}})}),t},getDocReferenceReadersData:function(){var t=[],n=e("#addReference").find("li[data-id]");return n.each(function(){t.push({id:e(this).attr("data-sid"),reader:{id:e(this).attr("data-userId"),name:e(this).attr("data-userName"),position:e(this).attr("data-userPosition"),deptType:e(this).attr("data-deptType")}})}),t},getDocReadingReadersData:function(){var t=[],n=e("#addReading").find("li[data-id]");return n.each(function(){t.push({id:e(this).attr("data-sid"),reader:{id:e(this).attr("data-userId"),name:e(this).attr("data-userName"),position:e(this).attr("data-userPosition"),deptType:e(this).attr("data-deptType")}})}),t},getTitle:function(){var e=this.model.get("document").formName,t=this.documentView.getTitle(),n=this.model.get("document").title?t?t:this.model.get("document").title:t?t:e;return n},editApprFlow:function(){var n=this.documentView.getDocBodyContents(),r=this.getTitle();this.model.set({currentDocBodyContent:n,currentTitle:r},{silent:!0});var i=new g({apprDocumentModel:this.model,viewerType:this.viewerType,masterAuthModel:this.masterAuthModel,saveCallback:e.proxy(function(e){var n=this.model.getWaitActivites();this.model.set({apprFlow:t.extend(e.get("apprFlow"),{prevWaitActivityIds:n}),docInfo:e.get("docInfo")}),this.model.trigger("sync")},this)});i.render()},changeDocInfo:function(e){this.docInfoView.updateDocInfo(e)},actForceReturn:function(){var e=this,t=D["\ubc18\ub824\ud558\uae30"],n=D["\ubc18\ub824"],r={useForceReturn:!0,useForceRecvReturned:!1},i=e.getForceReturnContents(r),s=function(t){e.forceReturn(t,r)};e.actForce(t,n,i,s)},actForceRecvReturned:function(){var e=this,t=D["\ubc18\uc1a1\ud558\uae30"],n=D["\ubc18\uc1a1"],r={useForceReturn:!1,useForceRecvReturned:!0},i=e.getForceReturnContents(r),s=function(t){e.forceReturn(t,r)};e.actForce(t,n,i,s)},actForce:function(t,n,r,i){e.goPopup({pclass:"layer_normal",header:t,modal:!0,width:500,contents:r,buttons:[{btext:n,btype:"confirm",autoclose:!1,callback:i},{btext:_["\ucde8\uc18c"],btype:"cancel"}]})},actCancelReception:function(){var n=this,r=n.model.get("document").documentId,i=[GO.config("contextRoot")+"api/approval/document",r,"receptioncancel"].join("/");e.goConfirm(D["\uc811\uc218\ub97c \ucde8\uc18c\ud558\uc2dc\uaca0\uc2b5\ub2c8\uae4c?"],"",function(){e.ajax(i,{type:"PUT",contentType:"application/json",dataType:"json"}).done(function(e){n.documentInit(),n.render()}).fail(function(n){var r=JSON.parse(n.responseText);return!t.isUndefined(r)&&r.message?(e.goError(r.message),!1):(e.goError(_["500 \uc624\ub958\ud398\uc774\uc9c0 \ud0c0\uc774\ud2c0"]),!1)})})},actReassignReceiver:function(){var t=this,n=this.model.get("document"),r=new w({docId:this.docId,receivedDocOwnerDeptId:n.receivedDocOwnerDeptId,receiverDeptId:n.receiverDeptId,receiverDeptName:n.receiverDeptName,receiverUserId:n.receiverUserId,receiverUserName:n.receiverUserName,receiverUserPositionName:n.receiverUserPositionName}),i=e.goPopup({pclass:"layer_normal layer_item_move",header:D["\ub2f4\ub2f9\uc790 \uc9c0\uc815"],modal:!0,width:320,allowPrevPopup:!0,contents:"",buttons:[{btext:D["\ub2f4\ub2f9\uc790 \uc9c0\uc815"],btype:"confirm",autoclose:!1,callback:function(n){r.assignReceiver(function(){n.close(),t.navigateToBackList(),e.goMessage(D["\ub2f4\ub2f9\uc790\uac00 \uc9c0\uc815\ub418\uc5c8\uc2b5\ub2c8\ub2e4"])},function(){e.goMessage(D["\ub2f4\ub2f9\uc790\ub97c \uc9c0\uc815\ud560 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4"])})}},{btext:_["\ucde8\uc18c"],btype:"cancel",callback:function(){r.slide&&r.slide.close()}}]});r.render(i,"div.content")},_editDocument:function(){var e=!0;this.toolbarView.showEditType(),this.documentView.setEditMode(),this.$(".aside_wrapper .reply_wrap .tb_doc_info").remove(),this.$("section.aside_wrapper").append(this.docInfoView.edit(e).el),this.formIntegrator.onEditDocument()},editDocument:function(){var n=this,r=t.includes(this.model.get("docInfo").externalScript,"vacation-sample");if(!r){this._editDocument();return}var i=D["\uc5f0\ucc28\uc5f0\ub3d9\ubb38\uc11c \uc218\uc815 \uacbd\uace0 \uba54\uc138\uc9c0"],s={btext:_["\uc218\uc815"],btype:"confirm",callback:function(){n._editDocument()}},o={btext:_["\ucde8\uc18c"],btype:"normal"},u=[s,o];e.goPopup({width:400,closeIconVisible:!1,pclass:"layer_normal",contents:i,buttons:u})},checkActivity:function(){return e("#apprflow").find("div[data-userid]").length<1?(e.goMessage(D["\uacb0\uc7ac\uc120\uc744 \uc9c0\uc815\ud574 \uc8fc\uc138\uc694."]),!1):!0},checkCompleteForm:function(){if(!this.documentView.isCompleteRequiredForm())return e.goMessage(_["\ud544\uc218\ud56d\ubaa9\uc744 \uc785\ub825\ud558\uc9c0 \uc54a\uc558\uc2b5\ub2c8\ub2e4."]),!1;var t=this.documentView.getMaxLengthCheck();return t.result?!0:(e.goMessage(GO.i18n(D["\uc120\ud0dd\ub41c \ud56d\ubaa9\uc740 0\uc790 \uc774\ud558\ub85c \uc785\ub825\ud574\uc57c\ud569\ub2c8\ub2e4."],{arg1:t.maxlength})),this.documentView.setDocFocus(t.errorId),!1)},forceReturn:function(n,r){var i=this,s=i.model.get("document").documentId,o=e("#textarea-desc").val();if(e.trim(o)=="")return e.goError(D["\uc758\uacac\uc744 \uc791\uc131\ud574 \uc8fc\uc138\uc694"],e("#textarea-desc")),e("#textarea-desc").addClass("enter error").select(),!1;var u="forcereturn",a={comment:"["+D["\uac15\uc81c\ubc18\ub824"]+"] "+o};r.useForceRecvReturned&&(u="forcereturnreception",a={comment:"["+D["\uac15\uc81c\ubc18\uc1a1"]+"] "+o});var f=[GO.config("contextRoot")+"api/approval/document",s,u].join("/");e.ajax(f,{type:"PUT",contentType:"application/json",dataType:"json",data:JSON.stringify(a)}).done(function(e){n.close(),i.documentInit(),i.render()}).fail(function(n){var r=JSON.parse(n.responseText);return!t.isUndefined(r)&&r.message?(e.goError(r.message),!1):(e.goError(_["500 \uc624\ub958\ud398\uc774\uc9c0 \ud0c0\uc774\ud2c0"]),!1)})},saveDocReader:function(){var t=this,n=t.model.get("document").documentId,r=new c(n),i=[],s=e("#addReading").find("li[data-id]");if(!t.isReaderExist&&s.length==0)return e.goMessage(D["\uc120\ud0dd\ub41c \ub300\uc0c1\uc774 \uc5c6\uc2b5\ub2c8\ub2e4."]),!1;s.each(function(){i.push({id:e(this).attr("data-sid"),reader:{id:e(this).attr("data-userId"),name:e(this).attr("data-userName"),position:e(this).attr("data-userPosition"),deptId:e(this).attr("data-userDeptId"),deptType:!1}})});var o={id:n,docReadingReaders:i};r.set(o,{silent:!0}),r.save({},{type:"PUT",success:function(n,r){r.code==200&&(t.isReaderExist&&s.length==0?(t.isReaderExist=!1,e.goMessage(D["\uc5f4\ub78c\uc790\uac00 \uc0ad\uc81c \ub418\uc5c8\uc2b5\ub2c8\ub2e4."])):(t.isReaderExist=!0,e.goMessage(D["\uc5f4\ub78c\uc790\uac00 \ucd94\uac00 \ub418\uc5c8\uc2b5\ub2c8\ub2e4."])))},error:function(t,n){var r=JSON.parse(n.responseText);return r.message?(e.goError(r.message),!1):(e.goError(D["\uc5f4\ub78c\uc790\ucd94\uac00\uc5d0 \uc2e4\ud328 \ud558\uc600\uc2b5\ub2c8\ub2e4."]),!1)}})},showApprChangeLog:function(t){var n=t.docBody,r=t.attaches,i=t.references,s=e.goPopup({pclass:"layer_normal layer_approval_preview",header:D["\uacb0\uc7ac\ubb38\uc11c \ubcf4\uae30"],modal:!0,width:900,contents:"",buttons:[{btext:_["\uc778\uc1c4"],btype:"confirm",callback:function(){GO.util.print(e("#printArea"))}},{btext:_["\ucde8\uc18c"],btype:"cancel"}]}),o=new A({docId:this.model.docId,popup:s,docBody:n,attaches:r,references:i});o.render(),s.reoffset()},actList:function(){var t=sessionStorage.getItem("list-history-baseUrl");t?GO.router.navigate(t+"?"+e.param(GO.router.getSearch()),{trigger:!0}):GO.router.navigate("approval",{trigger:!0})},convertSelect:function(t){e.each(t.find("select"),function(t,n){var r=e(n).parent("span"),i=r.attr("data-selecttext");e(n).remove(),r.text(i)})},docPrint:function(){var e=this.model.getFullShowUrl()+"/popup/print";window.open(e,"","location=no, directories=no,resizable=yes,status=no,toolbar=no,menubar=no, width=1280,height=650,left=0, top=0, scrollbars=yes")},docTypeSelect:function(){var t=this,n=e.goPopup({pclass:"layer_normal layer_doc_type_select",header:D["\ubb38\uc11c \ubd84\ub958 \uc120\ud0dd"],modal:!0,width:300,contents:"",buttons:[{btext:_["\ucd94\uac00"],autoclose:!1,btype:"confirm",callback:function(e){var n=r.doc_type_confirm();if(!n)return!1;t.docFolderSelect(!0)}},{btext:_["\ub2eb\uae30"],btype:"cancel"}]}),r=new k;r.render(),n.reoffset()},docFolderSelect:function(t){var n=this.model.get("document").isReceptionDocument;if(n)return;var r=[],i=e("#addFolder").find("li[data-id]");i.each(function(){r.push(e(this).attr("data-folderName"))}),this.documentView.setDocClassification(r)},securityLevelSelect:function(){var t=this.model.get("document").isReceptionDocument;if(t)return;this.documentView.setSecurityLevel(e("#infoSecurityLevel option:selected").text())},docYearSelect:function(){var t=this.model.get("document").isReceptionDocument;if(t)return;this.documentView.setPreserveDuration(e("#docYear option:selected").text())},docReferenceSelect:function(){var t=this.model.get("document").isReceptionDocument;if(t)return;var n=[],r=e("#addReference").find("li[data-id]");r.each(function(){n.push(e(this).attr("data-username")+" "+e(this).attr("data-userposition"))}),this.documentView.setDocReference(n)},docReceiveSelect:function(){var t=this.model.get("document").isReceptionDocument;if(t)return;var n=[],r=e("#addReceive").find("li[data-id]");r.each(function(){n.push(e(this).attr("data-username")+" "+e(this).attr("data-userposition"))}),this.documentView.setRecipient(n)},deleteDocument:function(){var t=this,n=t.model.get("document"),r=n.docStatus,i=n.receptionOrigin!=undefined?n.receptionOrigin.id:undefined,s=D[t.formIntegrator.getDeleteMessageKey()],o={btext:D["\uc0ad\uc81c \ud6c4 \uc6d0\ubb38\uc11c\ub85c \uc774\ub3d9"],btype:"confirm",autoclose:!1,callback:function(){t._deleteDocument(r,i)}},u={btext:_["\uc0ad\uc81c"],btype:"confirm",autoclose:!1,callback:function(){t._deleteDocument()}},a={btext:_["\ucde8\uc18c"],btype:"normal"},f=[u,a];r=="RECV_RETURNED"&&(s=D["\ubc18\uc1a1\ubb38\uc11c\uc0ad\uc81c\uacbd\uace0"],f=[o,u,a]),e.goPopup({width:400,closeIconVisible:!1,pclass:"layer_normal",contents:s,buttons:f})},_deleteDocument:function(n,r){var i=this,s=[GO.config("contextRoot")+"api/approval/manage/document",i.docId].join("/");e.ajax(s,{type:"DELETE",contentType:"application/json",dataType:"json"}).done(function(t){i.options.isPopup?e.goAlert("",D["\uc120\ud0dd\ud55c \ud56d\ubaa9\uc774 \uc0ad\uc81c\ub418\uc5c8\uc2b5\ub2c8\ub2e4"],function(){window.close()}):(i.navigateToBackList(n,r),e.goMessage(D["\uc120\ud0dd\ud55c \ud56d\ubaa9\uc774 \uc0ad\uc81c\ub418\uc5c8\uc2b5\ub2c8\ub2e4"]))}).fail(function(n){var r=JSON.parse(n.responseText);return!t.isUndefined(r)&&r.message?(e.goError(r.message),!1):(e.goError(_["500 \uc624\ub958\ud398\uc774\uc9c0 \ud0c0\uc774\ud2c0"]),!1)})},navigateToBackList:function(t,n){var r,i=sessionStorage.getItem("list-history-baseUrl");if(i){t=="RECV_RETURNED"&&(n?i=i+"/"+n:e.goMessage(D["\uc120\ud0dd\ud55c \ud56d\ubaa9\uc774 \uc0ad\uc81c\ub418\uc5c8\uc2b5\ub2c8\ub2e4"]+" "+D["\uc6d0\ubb38\uc11c\uac00 \uc874\uc7ac\ud558\uc9c0 \uc54a\uc544 \ubaa9\ub85d\uc73c\ub85c \uc774\ub3d9"]));var s=e.param(GO.router.getSearch()),o=s?"?"+s:"";r=i+o}else r="approval";GO.router.navigate(r,{trigger:!0})},release:function(){this.$el.off(),this.$el.empty()},assign:function(e,t){e.setElement(this.$(t)).render()},append:function(e,t){this.$(t).append(e.render().el)}});return B});