define(["jquery","underscore","backbone","app","approval/views/content_top","views/pagination","views/pagesize","approval/views/doclist/doclist_item","approval/views/doclist/doclist_csv_download","approval/collections/company_doc_list","approval/views/doclist/company_doc_folder","approval/views/side_company_doc","hgn!approval/templates/doclist_empty","hgn!approval/templates/company_doclist","i18n!nls/commons","i18n!approval/nls/approval"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v){var m=n.Model.extend({url:function(){return"/api/approval/companyfolder/"+this.folderId+"/document/move"},setFolderId:function(e){this.folderId=e}}),g=n.Model.extend({url:function(){return"/api/approval/companyfolder/"+this.folderId+"/document/remove"},setFolderId:function(e){this.folderId=e}}),y=n.View.extend({columns:{"\uae30\uc548\uc77c":v["\uae30\uc548\uc77c"],"\uae30\uc548\uc790":v["\uae30\uc548\uc790"],"\uacb0\uc7ac\uc591\uc2dd":v["\uacb0\uc7ac\uc591\uc2dd"],"\uc81c\ubaa9":d["\uc81c\ubaa9"],"\ucca8\ubd80":v["\ucca8\ubd80"],"\uacb0\uc7ac\uc77c":v["\uacb0\uc7ac\uc77c"],"\ubb38\uc11c\ubc88\ud638":v["\ubb38\uc11c\ubc88\ud638"],count:7},el:"#content",initialize:function(e){this.options=e||{},t.bindAll(this,"render","renderPageSize","renderPages");var n=this;this.contentTop=i.getInstance(),this.folderId=this.options.folderId,this.collection=new f,this.collection.setFolderId(this.folderId),this.initProperty="completedAt",this.initDirection="desc",this.ckeyword="";var s=sessionStorage.getItem("list-history-baseUrl");s&&(s=s.replace(/#/gi,"")),s&&s=="docfolder/"+this.folderId+"/documents"?(this.initProperty=sessionStorage.getItem("list-history-property"),this.initDirection=sessionStorage.getItem("list-history-direction"),this.initSearchtype=sessionStorage.getItem("list-history-searchtype"),this.ckeyword=sessionStorage.getItem("list-history-keyword").replace(/\+/gi," "),this.collection.setListParam()):this.collection.setSort(this.initProperty,this.initDirection),sessionStorage.clear(),this.collection.bind("reset",this.resetList,this),this.collection.fetch({statusCode:{403:function(){r.util.error("403")},404:function(){r.util.error("404",{msgCode:"400-common"})},500:function(){r.util.error("500")}}}),this.compAdmin=c.getCompanyDocManageble(),this.compAdmin&&(this.columns={"\uc120\ud0dd":d["\uc120\ud0dd"],"\uae30\uc548\uc77c":v["\uae30\uc548\uc77c"],"\uae30\uc548\uc790":v["\uae30\uc548\uc790"],"\uacb0\uc7ac\uc591\uc2dd":v["\uacb0\uc7ac\uc591\uc2dd"],"\uc81c\ubaa9":d["\uc81c\ubaa9"],"\ucca8\ubd80":v["\ucca8\ubd80"],"\uacb0\uc7ac\uc77c":v["\uacb0\uc7ac\uc77c"],"\ubb38\uc11c\ubc88\ud638":v["\ubb38\uc11c\ubc88\ud638"],count:8})},events:{"click input:checkbox":"toggleCheckbox","click #companyDocMove":"companyDocMove","click #companyDocDelete":"companyDocDelete","click .sorting":"sort","click .sorting_desc":"sort","click .sorting_asc":"sort","click .btn_search2":"search","keypress input#keyword":"searchByEnter"},toggleCheckbox:function(t){var n=e(t.currentTarget),r=this.$el.find("#checkedAllCompanyDoc");n.attr("id")==r.attr("id")?this.$el.find('input[type="checkbox"][name="checkbox"]').prop("checked",n.is(":checked")):n.is(":checked")||r.prop("checked",!1)},companyDocMove:function(){var t=this,n=[],r=e("input[name=checkbox]:checked");r.each(function(){n.push(e(this).attr("data-id"))});var i=this.deptId,s=this.folderId,o=new m;o.setFolderId(s);if(n!="")var u=e.goPopup({pclass:"layer_normal layer_doc_type_select layer_depth",header:v["\ubb38\uc11c \uc774\ub3d9"],modal:!0,width:300,contents:"",buttons:[{btext:d["\ud655\uc778"],btype:"confirm",autoclose:!1,callback:function(r){var i=r.find(".on").closest("li[data-id]").attr("data-id");if(!i)return e.goError(v["\uc774\ub3d9\ud558\uc2e4 \ubb38\uc11c\ud568\uc744 \uc120\ud0dd\ud574\uc8fc\uc2ed\uc2dc\uc694."]),e("#companyFolderError").addClass("enter error").focus(),!1;if(i==s)return e.goError(v["\ub3d9\uc77c\ud55c \ubb38\uc11c\ud568\uc785\ub2c8\ub2e4."]),e("#companyFolderError").addClass("enter error").focus(),!1;n&&(o.set({folderId:i}),o.save({ids:n},{silent:!0,type:"PUT",success:function(){e.goMessage(v["\uc120\ud0dd\ud55c \ud56d\ubaa9\uc774 \uc774\ub3d9\ub418\uc5c8\uc2b5\ub2c8\ub2e4"]),r.close(),t.$el.find("#checkedAllDeptDoc").attr("checked",!1),t.collection.fetch()},error:function(t,n){var r=JSON.parse(n.responseText);return r.message?(e.goError(r.message),!1):(e.goError(d["\uc800\uc7a5\uc5d0 \uc2e4\ud328 \ud558\uc600\uc2b5\ub2c8\ub2e4."]),!1)}}))}},{btext:d["\ucde8\uc18c"],btype:"cancel"}]});else e.goError(v["\uc120\ud0dd\ub41c \ud56d\ubaa9\uc774 \uc5c6\uc2b5\ub2c8\ub2e4."]);var a=new l({docIds:n,folderId:this.folderId});a.render(),n!=""&&u.reoffset()},companyDocDelete:function(){var t=this,n=[],r=this.folderId,i=e("input[name=checkbox]:checked");i.each(function(){n.push(e(this).attr("data-id"))});var s=new g;s.setFolderId(r),n!=""?e.goConfirm(v["\uc120\ud0dd\ud55c \ud56d\ubaa9\uc744 \uc0ad\uc81c\ud558\uc2dc\uaca0\uc2b5\ub2c8\uae4c?"],"",function(){s.set({folderId:r,ids:n}),s.save({},{silent:!0,type:"PUT",success:function(){e.goMessage(v["\uc120\ud0dd\ud55c \ud56d\ubaa9\uc774 \uc0ad\uc81c\ub418\uc5c8\uc2b5\ub2c8\ub2e4"]),t.$el.find("#checkedAllCompanyDoc").attr("checked",!1),t.collection.fetch()},error:function(){e.goError(d["\uc800\uc7a5\uc5d0 \uc2e4\ud328 \ud558\uc600\uc2b5\ub2c8\ub2e4."])}})}):e.goError(v["\uc120\ud0dd\ub41c \ud56d\ubaa9\uc774 \uc5c6\uc2b5\ub2c8\ub2e4."])},render:function(){var t={"\uc81c\ubaa9":d["\uc81c\ubaa9"],"\uae30\uc548\uc790":v["\uae30\uc548\uc790"],"\uac80\uc0c9":d["\uac80\uc0c9"],"\uc774\ub3d9":d["\uc774\ub3d9"],"\uc0ad\uc81c":d["\uc0ad\uc81c"],"\uacb0\uc7ac\uc591\uc2dd":v["\uacb0\uc7ac\uc591\uc2dd"],placeholder_search:d["\ud50c\ub808\uc774\uc2a4\ud640\ub354\uac80\uc0c9"]};this.$el.html(p({lang:t,columns:this.columns})),this.setInitSort(this.initProperty,this.initDirection),this.$el.find("header.content_top").replaceWith(this.contentTop.el),this.compAdmin||(e("#companyDocMove").hide(),e("#companyDocDelete").hide()),this.$el.find("input[placeholder]").placeholder(),this.renderPageSize(),(new a({getDownloadURL:e.proxy(this.collection.getCsvURL,this.collection),appendTarget:this.$el.find("#docToolbar > div.critical")})).render()},renderTitle:function(e){this.contentTop.setTitle(e),this.contentTop.render()},renderPageSize:function(){this.pageSizeView=new o({pageSize:this.collection.pageSize}),this.pageSizeView.render(),this.pageSizeView.bind("changePageSize",this.selectPageSize,this)},renderPages:function(){this.pageView=new s({pageInfo:this.collection.pageInfo()}),this.pageView.bind("paging",this.selectPage,this),this.$el.find("div.tool_absolute > div.dataTables_paginate").remove(),this.$el.find("div.tool_absolute").append(this.pageView.render().el)},resetList:function(t){var n=this.collection.url().replace("/api/",""),i=r.router.getUrl().replace("#","");i.indexOf("?")<0?r.router.navigate(n,{replace:!0}):i!=n&&r.router.navigate(n,{trigger:!1,pushState:!0}),this.renderTitle(this.collection.extData.name),e(".list_approval > tbody").empty();var s=this.columns,o="docfolder",a=this.compAdmin;t.each(function(t){var n=new u({model:t,isCheckboxVisible:a,listType:o,columns:s});e(".list_approval > tbody").append(n.render().el)}),t.length==0&&e(".list_approval > tbody").html(h({columns:this.columns,lang:{doclist_empty:v["\ubb38\uc11c\uac00 \uc5c6\uc2b5\ub2c8\ub2e4."]}})),this.renderPages()},selectPage:function(e){this.collection.setPageNo(e),this.collection.fetch()},selectPageSize:function(e){this.collection.setPageSize(e),this.collection.fetch()},setInitSort:function(t,n){var r=null,i=this.$el.find("th");i.each(function(){e(this).attr("sort-id")==t&&(r=e(this).attr("id")),e(this).hasClass("sorting_disabled")||(e(this).removeClass("sorting").addClass("sorting"),e(this).removeClass("sorting_desc").addClass("sorting"),e(this).removeClass("sorting_asc").addClass("sorting"))}),e("#"+r).removeClass("sorting").addClass("sorting_"+n),e("#keyword").val(this.ckeyword),this.initSearchtype&&this.$("#searchtype").val(this.initSearchtype)},sort:function(t){var n="#"+e(t.currentTarget).attr("id"),r=e(n).attr("sort-id"),i="desc",s="",o="";e(n).hasClass("sorting")&&(s="sorting",o="sorting_desc"),e(n).hasClass("sorting_desc")&&(s="sorting_desc",o="sorting_asc",i="asc"),e(n).hasClass("sorting_asc")&&(s="sorting_asc",o="sorting_desc"),e(n).removeClass(s).addClass(o);var u=this.$el.find("th");u.each(function(){!e(this).hasClass("sorting_disabled")&&"#"+e(this).attr("id")!=n&&(e(this).removeClass("sorting").addClass("sorting"),e(this).removeClass("sorting_desc").addClass("sorting"),e(this).removeClass("sorting_asc").addClass("sorting"))}),this.collection.setSort(r,i),this.collection.fetch()},search:function(){var t=e("#searchtype").val(),n=e.trim(e("#keyword").val());e("input#keyword").attr("placeholder")===this.$el.find("input#keyword").val()&&(n="");if(!n)return e.goMessage(v["\uac80\uc0c9\uc5b4\ub97c \uc785\ub825\ud558\uc138\uc694."]),e("#keyword").focus(),!1;if(!e.goValidation.isCheckLength(2,64,n))return e.goMessage(r.i18n(v["0\uc790\uc774\uc0c1 0\uc774\ud558 \uc785\ub825\ud574\uc57c\ud569\ub2c8\ub2e4."],{arg1:"2",arg2:"64"})),e("#keyword").focus(),!1;this.collection.setSearch(t,n),this.collection.fetch()},searchByEnter:function(t){if(t.keyCode!=13)return;t&&t.preventDefault(),e(t.currentTarget).focusout().blur(),this.search()},release:function(){this.$el.off(),this.$el.empty()}});return y});