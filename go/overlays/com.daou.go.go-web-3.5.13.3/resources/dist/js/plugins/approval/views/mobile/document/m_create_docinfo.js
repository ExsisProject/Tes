define(["jquery","underscore","backbone","app","approval/models/doclist_item","approval/views/mobile/document/m_apprflow_line","hgn!approval/templates/mobile/document/m_create_docinfo","i18n!nls/commons","i18n!approval/nls/approval"],function(e,t,n,r,i,s,o,u,a){var f={"\ubb38\uc11c\ubc88\ud638":a["\ubb38\uc11c\ubc88\ud638"],"\ubcf8\ubb38\ubcf4\uae30":a["\ubcf8\ubb38\ubcf4\uae30"],"\uae30\uc548\uc790":a["\uae30\uc548\uc790"],"\uae30\uc548\uc77c":a["\uae30\uc548\uc77c"],"\uae30\uc548\ubd80\uc11c":a["\uae30\uc548\ubd80\uc11c"],"\ubb38\uc11c\ud568":a["\ubb38\uc11c\ud568"],"\uc18c\uc18d\ub41c \ubd80\uc11c\uac00 \uc5c6\uc2b5\ub2c8\ub2e4":a["\uc18c\uc18d\ub41c \ubd80\uc11c\uac00 \uc5c6\uc2b5\ub2c8\ub2e4"],"\ubbf8\uc9c0\uc815":a["\ubbf8\uc9c0\uc815"],"\uc811\uae30":u["\uc811\uae30"],"\ud3bc\uce58\uae30":u["\ud3bc\uce58\uae30"]},l=n.Collection.extend({url:function(){return"/api/approval/drafterdeptfolder"}}),c=n.View.extend({events:{"change #draftDeptId":"changeDept","vclick #docInfoFoldedBtn":"docInfoToggle","change #formSelect":"changeForm","vclick #copyUrl":"copyUrl"},initialize:function(e){this.options=e||{},this.documentModel=this.options.documentModel,this.mobileDraftableFormCollection=this.options.mobileDraftableFormCollection,this.isCreate=this.options.isCreate,this.docInfo=this.options.docInfo,this.formId=this.options.formId,this.deptId=this.options.deptId,this.apprLineModel=this.options.apprLineModel},isEdit:function(){return this.isCreate||this.documentModel.docStatus=="TEMPSAVE"},render:function(){var e=this;return this.isEdit()&&(this.drafterDeptFolderInfos=new l,this.drafterDeptFolderInfos.fetch({async:!1,success:function(t){e.drafterDeptFolderInfos=t.toJSON()}})),this.renderInfo(),this},renderInfo:function(){var t=new i;t.set(this.documentModel);var n={draftedAt:t.getBasicDateDraftedAt(),title:t.get("title"),drafterName:t.get("drafterName")?t.get("drafterName")+" "+t.get("drafterPosionName"):"-",docStatus:t.getDocStatusName(),statusClass:t.getDocStatusClass(),drafterDeptName:t.get("drafterDeptName")};return this.$el.html(o({isEdit:this.isEdit(),isCreate:this.isCreate,lang:f,document:this.documentModel,forms:this.mobileDraftableFormCollection?this.mobileDraftableFormCollection.toJSON():"",docNum:this.docInfo.docNum?this.docInfo.docNum:"",formId:this.docInfo.formId?this.docInfo.formId:"",drafterDept:this.drafterDeptFolderInfos,emptyDept:e.isEmptyObject(this.drafterDeptFolderInfos),draftDate:GO.util.formatDatetime(GO.util.toISO8601(new Date),null,"YYYY-MM-DD(ddd)"),doc:n,isFolded:this.isApprLineFold()})),this.isEdit()&&(e("#formSelect").val(this.docInfo.formId),e("#draftDeptId").val(this.documentModel.drafterDeptId),this.setDeptFolder()),this.renderApprLine(),this},isApprLineFold:function(){if(!this.isEdit()){var e=localStorage.getItem("apprline-fold");if("true"==e)return!0}return!1},renderApprLine:function(){var e=s.render({apprLineModel:this.apprLineModel});this.$el.find("#apprflowline").html(e.$el.html())},changeForm:function(t){var n=e(t.currentTarget).val(),r=e("#draftDeptId").val();GO.util.appLoading(!0),GO.router.navigate("approval/document/new/"+r+"/"+n,!0)},changeDept:function(t){var n=e(t.currentTarget).val(),r=e("#formSelect").val();GO.util.appLoading(!0),GO.router.navigate("approval/document/new/"+n+"/"+r,!0)},setDeptFolder:function(){var t=this,n=e("#draftDeptId").val();e.each(this.drafterDeptFolderInfos,function(e,r){r.deptId==n&&t.resetDeptDocFolders(r)}),this.docInfo.deptDocFolders.length>0&&e("#deptFolderId").val(this.docInfo.deptDocFolders[0].id)},resetDeptDocFolders:function(t){e("#deptFolderId").find("option").remove(),e("#deptFolderId").append('<option value="">'+a["\ubbf8\uc9c0\uc815"]+"</option>"),e.each(t.deptFolders,function(t,n){e("#deptFolderId").append('<option value="'+n.folderId+'">'+n.folderName+"</option>")})},docInfoToggle:function(t){return e("#document_view").css("visibility","hidden"),e("#apprflowline").is(":visible")?this.closeInfoWrap():this.openInfoWrap(),e(document).width()<e("#document_view").width()?GO.util.initDetailiScroll("document_iscroll","document_hscroll","document_view"):e("#document_view").css("visibility","visible"),e("#goBody").css("minHeight",e("#document_iscroll").height()),!1},openInfoWrap:function(){e("#apprflowline").show(),e("#docInfoFoldedBtn span.ic_cmm").addClass("ic_dropdown_large_up").removeClass("ic_dropdown_large_down"),localStorage.setItem("apprline-fold",!1)},closeInfoWrap:function(){e("#apprflowline").hide(),e("#docInfoFoldedBtn span.ic_cmm").addClass("ic_dropdown_large_down").removeClass("ic_dropdown_large_up"),localStorage.setItem("apprline-fold",!0)},copyUrl:function(e){GO.util.copyUrl(e)}});return c});