define(["jquery","underscore","backbone","app","approval/collections/share_folder_doclist","approval/views/content_top","views/pagination","views/pagesize","approval/views/doclist/base_doclist","approval/views/doclist/doclist_item","approval/views/doclist/doclist_csv_download","approval/views/doclist/share_doc_folder","approval/views/side","hgn!approval/templates/doclist_empty","hgn!approval/templates/share_folder_doclist","i18n!nls/commons","i18n!approval/nls/approval"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m){var g={"\uc81c\ubaa9":v["\uc81c\ubaa9"],"\uae30\uc548\uc790":m["\uae30\uc548\uc790"],"\uac80\uc0c9":v["\uac80\uc0c9"],"\uc774\ub3d9":v["\uc774\ub3d9"],"\uc0ad\uc81c":v["\uc0ad\uc81c"],"\uacb0\uc7ac\uc591\uc2dd":m["\uacb0\uc7ac\uc591\uc2dd"],"\uacb0\uc7ac\uc120":m["\uacb0\uc7ac\uc120"],"\uae30\uc548\ubd80\uc11c":m["\uae30\uc548\ubd80\uc11c"],"\ubb38\uc11c\ubc88\ud638":m["\ubb38\uc11c\ubc88\ud638"],placeholder_search:v["\ud50c\ub808\uc774\uc2a4\ud640\ub354\uac80\uc0c9"]},y=a.extend({docFolderType:null,shareFolderCols:{"\uc120\ud0dd":v["\uc120\ud0dd"],"\uae30\uc548\uc77c":m["\uae30\uc548\uc77c"],"\uae30\uc548\uc790":m["\uae30\uc548\uc790"],"\uacb0\uc7ac\uc591\uc2dd":m["\uacb0\uc7ac\uc591\uc2dd"],"\uae34\uae09":m["\uae34\uae09"],"\uc81c\ubaa9":v["\uc81c\ubaa9"],"\ucca8\ubd80":m["\ucca8\ubd80"],"\ubb38\uc11c\ubc88\ud638":m["\ubb38\uc11c\ubc88\ud638"],count:8},el:"#content",initialize:function(e){this.options=e||{},t.bindAll(this,"render","renderPageSize","renderPages"),this.contentTop=s.getInstance(),this.isRef=!1,this.docFolderType="custom_add",this.usePeriod=!0,this.type=this.options.type,this.folderId=this.options.folderId,this.belong=this.options.belong,this.options.belong&&(this.options.belong.indexOf("?")>=0?this.belong=this.options.belong.substr(0,this.options.belong.indexOf("?")):this.belong=this.options.belong),this.options.deptId&&(this.options.deptId.indexOf("?")>=0?this.deptId=this.options.deptId.substr(0,this.options.deptId.indexOf("?")):this.deptId=this.options.deptId),this.collection=new i({folderId:this.folderId,type:this.type,deptId:this.deptId,belong:this.belong}),this.initProperty="draftedAt",this.initDirection="desc",this.ckeyword="";var n=sessionStorage.getItem("list-history-baseUrl");n&&(n=n.replace(/#/gi,""));var r="/api/approval/userfolder/"+this.folderId+"/share/"+this.belong;this.type=="userfolder"?this.belong=="indept"?r="/api/approval/userfolder/"+this.folderId+"/share/"+this.belong+"/"+this.deptId:r="/api/approval/userfolder/"+this.folderId+"/share/"+this.belong:this.type=="deptfolder"&&(r="/api/approval/deptfolder/"+this.folderId+"/share/"+this.belong+"/"+this.deptId),n&&n==r?(this.initProperty=sessionStorage.getItem("list-history-property"),this.initDirection=sessionStorage.getItem("list-history-direction"),this.initSearchtype=sessionStorage.getItem("list-history-searchtype"),this.ckeyword=sessionStorage.getItem("list-history-keyword").replace(/\+/gi," "),this.usePeriod&&(this.duration=sessionStorage.getItem("list-history-duration"),this.fromDate=sessionStorage.getItem("list-history-fromDate"),this.toDate=sessionStorage.getItem("list-history-toDate")),this.collection.setListParam()):(this.usePeriod&&this.collection.setDuration(),this.collection.setSort(this.initProperty,this.initDirection)),sessionStorage.clear(),this.collection.bind("reset",this.resetList,this),this.collection.usePeriod=this.usePeriod,a.prototype.initialize.call(this,e)},events:function(){return t.extend({},a.prototype.events,{"click input:checkbox":"toggleCheckbox","click .sorting":"sort","click .sorting_desc":"sort","click .sorting_asc":"sort"})},renderLayout:function(){this.$el.html(d({lang:g,isRef:this.isRef})),this.contentTop.setTitle(""),this.$el.find("header.content_top").replaceWith(this.contentTop.el),this.renderPageSize(),(new l({getDownloadURL:e.proxy(this.collection.getCsvURL,this.collection),appendTarget:this.$el.find("#docToolbar > div.critical")})).render()},toggleCheckbox:function(t){var n=e(t.currentTarget),r=e("input#checkedAllDeptDoc"),i=n.is(":checked");n.attr("id")==r.attr("id")&&e('input[type="checkbox"][name="checkbox"]').attr("checked",i),n.hasClass("doclist_item_checkbox")&&(i||r.attr("checked",i))},renderTitle:function(e){this.contentTop.setTitle(e),this.contentTop.render()},renderPageSize:function(){this.pageSizeView=new u({pageSize:this.collection.pageSize}),this.pageSizeView.render(),this.pageSizeView.bind("changePageSize",this.selectPageSize,this)},renderPages:function(){this.pageView=new o({pageInfo:this.collection.pageInfo()}),this.pageView.bind("paging",this.selectPage,this),this.$el.find("div.tool_absolute > div.dataTables_paginate").remove(),this.$el.find("div.tool_absolute").append(this.pageView.render().el),this.$el.find("#checkedAllDeptDoc").attr("checked",!1)},resetList:function(t){if(this.collection.extData!=null){var n=this.collection.extData.folderName;this.collection.extData.userName?n+=' <span class="meta">in '+this.collection.extData.userName+"</span>":this.collection.extData.deptName&&(n+=' <span class="meta">in '+this.collection.extData.deptName+"</span>"),this.renderTitle(n)}var i=this.collection.url().replace("/api/",""),s=r.router.getUrl().replace("#","");s.indexOf("?")<0?r.router.navigate(i,{replace:!0}):s!=i&&r.router.navigate(i,{trigger:!1,pushState:!0}),e(".list_approval > tbody").empty();var o=this.columns,u="approval";t.each(function(t){var n=new f({model:t,listType:u,columns:o});e(".list_approval > tbody").append(n.render().el)}),t.length==0&&e(".list_approval > tbody").html(p({columns:this.columns,lang:{doclist_empty:m["\ubb38\uc11c\uac00 \uc5c6\uc2b5\ub2c8\ub2e4."]}})),this.renderPages()},selectPage:function(e){this.collection.setPageNo(e),this.collection.fetch()},selectPageSize:function(e){this.collection.setPageSize(e),this.collection.fetch()},release:function(){this.$el.off(),this.$el.empty()}});return y});