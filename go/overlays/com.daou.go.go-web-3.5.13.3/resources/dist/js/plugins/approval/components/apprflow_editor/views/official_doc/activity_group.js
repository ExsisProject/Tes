define("approval/components/apprflow_editor/views/official_doc/activity_group",["backbone","approval/collections/appr_receiver","approval/models/official_preview","hgn!approval/components/apprflow_editor/templates/official_doc/activity_group","i18n!nls/commons","i18n!approval/nls/approval","jquery.go-popup"],function(e,t,n,r,i,s){var o={header:s["\uacb0\uc7ac \uc815\ubcf4"],save_as_my_line:s["\uac1c\uc778 \uacb0\uc7ac\uc120\uc73c\ub85c \uc800\uc7a5"],delete_as_my_line:s["\uac1c\uc778 \uacb0\uc7ac\uc120 \uc0ad\uc81c"],empty_msg:"\ub4f1\ub85d\ub41c \uc2dc\ud589\ubb38\uc774 \uc5c6\uc2b5\ub2c8\ub2e4.",my_line_name:s["\uacb0\uc7ac\uc120 \uc774\ub984"],normal:s["\uc77c\ubc18"],my_lines:s["\ub098\uc758\uacb0\uc7ac\uc120"],draft:s["\uae30\uc548"],name:i["\uc774\ub984"],dept:s["\ubd80\uc11c"],line:s["\ub77c\uc778"],status:s["\uc0c1\ud0dc"],"\uc120\ud0dd":i["\uc120\ud0dd"],approval:s["\uacb0\uc7ac"],agreement:s["\ud569\uc758"],check:s["\ud655\uc778"],agreement_type:s["\ud569\uc758\ubc29\uc2dd"],agreement_linear:s["\uc21c\ucc28\ud569\uc758"],agreement_parallel:s["\ubcd1\ub82c\ud569\uc758"],activityType:s["\ud0c0\uc785"],add:i["\ucd94\uac00"],"delete":i["\uc0ad\uc81c"],confirm:i["\ud655\uc778"],cancel:i["\ucde8\uc18c"],add_activity:s["\ub4dc\ub798\uadf8\ud558\uc5ec \uacb0\uc7ac\uc120\uc744 \ucd94\uac00\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4."],msg_duplicate_activity:s["\uc911\ubcf5\ub41c \ub300\uc0c1\uc785\ub2c8\ub2e4."],msg_max_approval_count_exceed:s["\uacb0\uc7ac\uc790 \uc218\uac00 \ucd5c\ub300 \uacb0\uc7ac\uc790 \uc218\ub97c \ub118\uc744 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4."],msg_not_selected:s["\uc120\ud0dd\ub41c \ub300\uc0c1\uc774 \uc5c6\uc2b5\ub2c8\ub2e4."],msg_not_deletable_status_activity:s["\uc0ad\uc81c\ud560 \uc218 \uc5c6\ub294 \uc0c1\ud0dc\uc758 \uacb0\uc7ac\uc790 \uc785\ub2c8\ub2e4."],msg_not_deletable_assigned_activity:s["\uc9c0\uc815 \uacb0\uc7ac\uc790\ub294 \uc0ad\uc81c\ud560 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4."],msg_save_success:i["\uc800\uc7a5\ub418\uc5c8\uc2b5\ub2c8\ub2e4."],msg_not_addable_position:s["\uc644\ub8cc\ub41c \uacb0\uc7ac \uc55e\uc5d0 \uacb0\uc7ac\uc790\ub97c \ucd94\uac00\ud560 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4."],msg_duplicated_my_line_title:s["\uc911\ubcf5\ub41c \uc774\ub984\uc744 \uc0ac\uc6a9\ud560 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4."],msg_my_line_set_error_maxCount:s["\uacb0\uc7ac\uc790\ub97c \ucd5c\ub300\uce58\ubcf4\ub2e4 \ub118\uac8c \ud560\ub2f9\ud560 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4."],msg_my_line_set_error_assigned_deleted:s["\uc9c0\uc815 \uacb0\uc7ac\uc790\ub294 \uaf2d \ud3ec\ud568\ub418\uc5b4\uc57c \ud569\ub2c8\ub2e4."],msg_my_line_set_error_not_matching_group_count:s["\uacb0\uc7ac\uc120\uc758 \uac2f\uc218\uac00 \uc77c\uce58\ud558\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4."],msg_parallel_agreement_should_has_2_more_agreement:s["\ubcd1\ub82c\ud569\uc758\ub294 \uc5f0\uc18d\ub41c \ub458 \uc774\uc0c1\uc758 \ud569\uc758\uac00 \ud544\uc694\ud569\ub2c8\ub2e4."],msg_not_belong_to_department_user:s["\ubd80\uc11c\uac00 \uc5c6\ub294 \uc0ac\uc6a9\uc790\ub294 \ucd94\uac00\ud560 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4."],notAddable:s["\uc774 \uacb0\uc7ac\uce78\uc5d0\ub294 \uacb0\uc7ac\uc790\ub97c \ucd94\uac00\ud560 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4"],msg_not_addable_item:s["\ud56d\ubaa9\uc744 \ucd94\uac00\ud560 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4"],not_allowed_apprgroup:s["\uc120\ud0dd\ud55c \ub300\uc0c1\uc740 \uc774 \uacb0\uc7ac\uadf8\ub8f9\uc5d0 \uc0ac\uc6a9\ud560 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4"],"\uacf5\ubb38 \ubc1c\uc1a1 \uc2e4\ud328 \uba54\uc138\uc9c0":s["\uacf5\ubb38 \ubc1c\uc1a1 \uc2e4\ud328 \uba54\uc138\uc9c0"],"\ubc1c\uc2e0 \uba85\uc758":s["\ubc1c\uc2e0 \uba85\uc758"],"\uc9c1\uc778":s["\uc9c1\uc778"],"\uc2dc\ud589\ubb38":s["\uc2dc\ud589\ubb38"],"\uc2dc\ud589\ubb38 \ubcf4\uae30":s["\uc2dc\ud589\ubb38 \ubcf4\uae30"],"\uc2e0\uaddc \ubc1c\uc1a1":s["\uc2e0\uaddc \ubc1c\uc1a1"],"\uc2b9\uc778 \ub300\uae30":s["\uc2b9\uc778 \ub300\uae30"],"\ubc1c\uc1a1 \ub300\uae30":s["\ubc1c\uc1a1 \ub300\uae30"],"\ubc1c\uc1a1 \uc2e4\ud328":s["\ubc1c\uc1a1 \uc2e4\ud328"],"\ubc1c\uc1a1 \uc644\ub8cc":s["\ubc1c\uc1a1 \uc644\ub8cc"],"\ubc1c\uc1a1 \ucde8\uc18c":s["\ubc1c\uc1a1 \ucde8\uc18c"],"\ubc1c\uc1a1 \ubc18\ub824":s["\ubc1c\uc1a1 \ubc18\ub824"],"\uacb0\uc7ac \ubc18\ub824":s["\uacb0\uc7ac \ubc18\ub824"],"\uc5f4\uae30":i["\uc5f4\uae30"],"\ub2eb\uae30":i["\ub2eb\uae30"],"\uc758\uacac":s["\uc758\uacac"],"\ubb38\uc11c \ubcf4\uae30":s["\ubb38\uc11c \ubcf4\uae30"]},u=e.View.extend({tagName:"div",className:"activity_group",observer:null,actionCheck:null,index:null,isNullGroup:!1,__disabled__:!1,events:{"click .add_activity":"_onAddArrowClicked","click .delete_activity":"_onRemoveButtonClicked","change select":"_onTypeOptionChanged","click .showOfficialFormPreview":"showOfficialFormPreview","click .showOfficial":"showOfficial","click span[evt-role='appr-official-toggle']":"toggleList","click a[evt-role='showOfficialComment']":"showOfficialComment"},toggleList:function(e){var t=$(e.currentTarget),n=t.hasClass("ic_open_s")?!0:!1;n?t.removeClass("ic_open_s").addClass("ic_close_s"):t.removeClass("ic_close_s").addClass("ic_open_s"),this.$(".approval_line").toggle(!n)},initialize:function(e){e=e||{},this.index=e.index,this.observer=e.observer,this.documentEditModel=e.documentEditModel,this.actionCheck=e.actionCheck,this.viewerType=e.viewerType,_.isNull(this.model)&&(this.isNullGroup=!0),this.__disabled__=!1,e.disable&&this.disable()},render:function(){var e={"isNullGroup?":this.isNullGroup,lang:o,disabled:this.isDisabled()};return this.isNullGroup||(e=_.extend(this._convertToTmplData(this.model),e)),this.$el.html(r(e)),this.isNullGroup?this.$el.addClass("hidden_and_empty_group"):(this.$el.attr("data-index",this.index),this.observer.trigger("activateDNDDroppable"),this.observer.trigger("resize")),this.$el.data("data-view",this),this},addActivity:function(e,t){if(_.isNull(e)||_.isUndefined(e)||_.isEmpty(e))return $.goMessage(o.msg_not_selected),!1;if(_.isEmpty(e))return!1;if(this.isDisabled())return!1;if(e.type==="normal")return!1;if(e.email===""||e.email===undefined)return $.goError(i["\uc798\ubabb\ub41c \uc774\uba54\uc77c \uc8fc\uc18c\uc785\ub2c8\ub2e4."]),!1;var n=_.findWhere(this.model.get("receivers"),{email:e.email});return n?($.goMessage(s["\uc911\ubcf5\ub41c \ub300\uc0c1\uc785\ub2c8\ub2e4."]),!1):(_.isEmpty(e.companyName)||(e.company=e.companyName),this.model.addReceiver(e,t),this.render(),!0)},clearDragDropLineCss:function(){this.$el.find("tr.activity > td").attr("style","")},showOfficialFormPreview:function(e){var t=this.model.get("asignedForm"),r=t&&t.html;if(r){var i=!_.isUndefined(this.documentEditModel.get("currentDocBodyContent")),s=new n(this.documentEditModel.toJSON());s.get("docInfo").officialVersions=[this.model.toJSON()],i?(s.get("document").docBodyContent=this.documentEditModel.get("currentDocBodyContent"),s.get("document").title=this.documentEditModel.get("currentTitle")):s.get("document").docBodyContent=this.model.get("docBody"),GO.util.store.set("official-preview-data",s.toJSON());var u=s.getFullShowUrl();window.open(u,"","location=no, directories=no,resizable=yes,status=no,toolbar=no,menubar=no, width=1280,height=650,left=0, top=0, scrollbars=yes")}else $.goSlideMessage(o.empty_msg,"caution")},showOfficial:function(e){var t=this.model.get("id"),n=window.location.protocol+"//"+window.location.host+GO.contextRoot+"app/approval/official/"+t+"/popup";window.open(n,"","location=no, directories=no,resizable=yes,status=no,toolbar=no,menubar=no, width=1280,height=650,left=0, top=0, scrollbars=yes")},_getHtmlTemplate:function(e){var t=$("#"+e+"_template_storage").contents(),n=t.clone().show().html();return n},showOfficialComment:function(e){$.goPopup({pclass:"layer_normal layer_approval",header:o["\uc758\uacac"],modal:!0,draggable:!0,allowPrevPopup:!0,width:500,contents:GO.util.unescapeHtml(this.model.get("comment")),buttons:[{btext:i["\ub2eb\uae30"],btype:"cancel"}]})},_convertToTmplData:function(e){var n=new t(e.getReceiver())||[],r=this.viewerType==="official_document"||e.get("state")!=="CREATE",i=this.viewerType!=="official_document",s=e.get("state")==="CREATE",o=e.get("asignedForm"),u=e.get("asignedForm")&&e.get("asignedForm").id,a=!1,f=e.get("asignedSender"),l=e.get("asignedSender")&&e.get("asignedSender").id,c=e.get("asignedSign"),h=e.get("asignedSign")&&e.get("asignedSign").id,p=!0;if(r)u||(p=!1);else if(e.get("forms").length<1||!e.get("officialFormEditable")&&!u)p=!1;var d=e.get("officialFormEditable")&&!this.isDisabled(),v=!0;if(r)l||(v=!1);else if(e.get("senders").length<1||!e.get("officialSenderEditable")&&!l)v=!1;var m=e.get("officialSenderEditable")&&!this.isDisabled(),g=!0;if(r){if(!h||!v)g=!1}else if(e.get("signs").length<1||!e.get("officialSignEditable")&&!h)g=!1;var y=e.get("officialSignEditable")&&!this.isDisabled(),b=e.get("officialSignPreviewEditable")&&!this.isDisabled(),w=_.isEmpty(this.model.get("comment"))?!1:!0,E=p||v||g,S=e.get("state")==="APPROVE",x=e.get("sentAt")?GO.util.basicDate(e.get("sentAt")):"",T=!1;return e.get("state")==="APPROVE"&&n.findWhere({isSent:!1})&&(T=!0),{isApproved:S,sentAt:x,failSent:T,groupName:this.getGroupName(e.get("state"),T),isOnlyView:r,hasActivities:n.length>0,receivers:n.map(function(e,t){return{name:e.get("name"),email:e.get("email"),company:e.get("company"),isLast:t+1===n.length?!0:!1,removable:!e.get("isSent")}}),forms:_.map(e.get("forms"),function(e){return{id:e.id,name:e.name,isSelected:e.id==u}},this),asignedForm:o,formVisible:p,formEditable:d,senders:_.map(e.get("senders"),function(e){return{id:e.id,name:e.name,isSelected:e.id==l}},this),asignedSender:f,senderVisible:v,senderEditable:m,signs:_.map(e.get("signs"),function(e){return{id:e.id,name:e.name,isSelected:e.id==h}},this),asignedSign:c,signVisible:g,signEditable:y,signPreviewEditable:b,dockedVisible:E,hasComment:w,isCreate:s,showBtn:i,isEnabled:!this.isDisabled()}},getGroupName:function(e,t){if(e=="CREATE")return o["\uc2e0\uaddc \ubc1c\uc1a1"];if(e=="WAIT")return o["\uc2b9\uc778 \ub300\uae30"];if(e=="APPROVE")return t?o["\ubc1c\uc1a1 \uc2e4\ud328"]:o["\ubc1c\uc1a1 \uc644\ub8cc"];if(e=="CANCEL")return o["\ubc1c\uc1a1 \ucde8\uc18c"];if(e=="RETURN")return o["\ubc1c\uc1a1 \ubc18\ub824"];if(e=="DOC_RETURN")return o["\uacb0\uc7ac \ubc18\ub824"]},_onTypeOptionChanged:function(e){var t=$(e.currentTarget).attr("name"),n,r=$(e.currentTarget).val();_.isString(r)&&(r=parseInt(r)),t=="formSelect"?(n=_.findWhere(this.model.get("forms"),{id:r}),this.model.set("asignedForm",n)):t=="senderSelect"?(n=_.findWhere(this.model.get("senders"),{id:r}),this.model.set("asignedSender",n)):t=="signSelect"&&(n=_.findWhere(this.model.get("signs"),{id:r}),this.model.set("asignedSign",n)),this.render()},drawDragDropLineCss:function(e){var t;e=="last"?t=this.$el.find("tr.activity:last"):t=this.$el.find("tr.activity:eq("+e+")");var n=10;setTimeout(function(){t.find("td").each(function(){$(this).css({"border-bottom":"2px solid black"})})},n)},disable:function(){this.__disabled__=!0},isDisabled:function(){return this.__disabled__},_onAddArrowClicked:function(e){if(this.isDisabled())return;this.observer.trigger("addActivity",$.proxy(this.addActivity,this),this)},_onRemoveButtonClicked:function(e){var n=$(e.currentTarget).hasClass("delete_activity")?$(e.currentTarget):$(e.currentTarget).hasClass("delete_activity").parent(),r=n.parent().parent(),i=r.attr("data-id"),s=new t(this.model.get("receivers")),o=s.get(i);return s.remove(o),this.model.set("receivers",s.toJSON()),this.render(),!0}});return u});