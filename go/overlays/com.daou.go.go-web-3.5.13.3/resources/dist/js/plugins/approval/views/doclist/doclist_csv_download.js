define(["jquery","underscore","backbone","app","i18n!nls/commons","i18n!admin/nls/admin","i18n!approval/nls/approval","jquery.cookie"],function(e,t,n,r,i,s,o){return n.View.extend({initialize:function(e){this.$appendTarget=e.appendTarget,this.getDownloadURL=e.getDownloadURL},render:function(){var t=[];t.push('<a id="downloadListCsv" class="btn_tool" data-role="button">'),t.push('  <span class="ic_toolbar download"></span>  <span class="txt">{{lang.\ubaa9\ub85d \ub2e4\uc6b4\ub85c\ub4dc}}</span>'),t.push("</a>"),t.push('<a id="hiddenDownloadListCsv" type="text/csv" data-role="button" href="" style="display:none"></a>'),t.push('<form id="download_csv_form" method="POST"><input type="hidden" value="" name="downloadTokenId" id="downloadTokenId"/></form>'),t.push('<iframe name="ifm_download_csv_form" id="ifm_download_csv_form" style="border:0px;width:0px;height:0px;"></iframe>'),this.$appendTarget.append(Hogan.compile(t.join("")).render({lang:{"\ubaa9\ub85d \ub2e4\uc6b4\ub85c\ub4dc":s["\ubaa9\ub85d \ub2e4\uc6b4\ub85c\ub4dc"]}})),this.$appendTarget.find("a#downloadListCsv").bind("click",e.proxy(this.download,this))},remove:function(){this.$appendTarget.find("#downloadListCsv").remove()},download:function(t){var n=this;t.preventDefault(),e("#download_csv_form").attr("action",location.protocol+"//"+location.hostname+(location.port?":"+location.port:"")+this.getDownloadURL());var r=(new Date).getTime();return e("#downloadTokenId").val(r),this.preloader=e.goPreloader(),this.fileDownloadCheckTimer=window.setInterval(function(){var t=e.cookie("downloadTokenId");t==r&&n.finishDownload()},1e3),e("#download_csv_form").attr("target","ifm_download_csv_form"),e("#download_csv_form").submit(),!1},finishDownload:function(){window.clearInterval(this.fileDownloadCheckTimer),this.preloader.release()}})});