(function(){define(["jquery","underscore","backbone","app","approval/views/content_top","hgn!approval/templates/add_org_member","hgn!approval/templates/regist_deputy_form","i18n!nls/commons","i18n!approval/nls/approval","jquery.go-orgslide","jquery.go-popup","jquery.ui","jquery.go-validation"],function(e,t,n,r,i,s,o,u,a){var f=n.Model.extend({url:function(){return"/api/approval/usersetting/deputy"},validate:function(n,r){if(t.isEmpty(e.trim(n.absenceContent)))return a["\ubd80\uc7ac\uc0ac\uc720\ub97c \uc785\ub825\ud574\uc8fc\uc138\uc694"];if(t.isUndefined(n.deputyUserId))return a["\ub300\uacb0\uc790\ub97c \uc120\ud0dd\ud574\uc8fc\uc138\uc694"]}}),l=n.View.extend({el:"#content",events:{"click li.creat":"_showOrgSlider","click ul.name_tag li span.ic_del":"_deleteMember","click #btn-confirm":"_saveDeputy","click #btn-cancel":"_cancel"},initialize:function(){this.release(),this.contentTop=i.getInstance(),this.model=new f},render:function(){var e={"\uc885\uc77c":a["\uc885\uc77c"],"\uc18c\uc18d \ubd80\uc11c":a["\uc18c\uc18d \ubd80\uc11c"],"\ub300\uacb0\uc790":a["\ub300\uacb0\uc790"],"\ubd80\uc7ac \uc0ac\uc720":a["\ubd80\uc7ac \uc0ac\uc720"],"\ubd80\uc7ac \uae30\uac04":a["\ubd80\uc7ac \uae30\uac04"],"\ub300\uacb0\uc790 \uc120\ud0dd":a["\ub300\uacb0\uc790 \uc120\ud0dd"],"\ud655\uc778":u["\ud655\uc778"],"\ucde8\uc18c":u["\ucde8\uc18c"]},t=o({lang:e});this.$el.html(t),this.contentTop.setTitle(a["\ubd80\uc7ac \ucd94\uac00"]),this.contentTop.render(),this.$el.find("header.content_top").replaceWith(this.contentTop.el),this._initDate()},_initDate:function(){var t=this;e.datepicker.setDefaults(e.datepicker.regional[GO.config("locale")]);var n=this.$el.find("#startDate"),r=this.$el.find("#endDate");this.$el.find("#startDate").val(GO.util.now().format("YYYY-MM-DD")),this.$el.find("#endDate").val(GO.util.now().format("YYYY-MM-DD")),n.datepicker({dateFormat:"yy-mm-dd",changeMonth:!0,changeYear:!0,yearSuffix:"",minDate:GO.util.now().format("YYYY-MM-DD"),onClose:function(e){t._changeEndDateHandler(e)}}),r.datepicker({dateFormat:"yy-mm-dd",changeMonth:!0,changeYear:!0,yearSuffix:"",minDate:GO.util.now().format("YYYY-MM-DD"),onClose:function(e){t._changeStartDateHandler(e)}})},_changeStartDateHandler:function(e){var t=this.$el.find("#startDate"),n=this.$el.find("#endDate");isAfter=GO.util.isAfter(t.val(),n.val()),isAfter==0&&t.val(n.val())},_changeEndDateHandler:function(e){var t=this.$el.find("#startDate"),n=this.$el.find("#endDate");isAfter=GO.util.isAfter(t.val(),n.val()),isAfter==0&&n.val(t.val())},addMember:function(t){var n=e("#addMembers");if(r.session("id")==t.id){e.goError(a["\ud604\uc7ac \uc0ac\uc6a9\uc790 \uc785\ub2c8\ub2e4."]);return}n.find("li").not(".creat").length>=1&&n.find("li").not(".creat").remove(),t&&!n.find('li[data-id="'+t.id+'"]').length&&n.find("li.creat").before(s(t))},_deleteMember:function(t){e(t.currentTarget).parents("li").remove()},_cancel:function(e){GO.router.navigate("approval/usersetting/deputy",{trigger:!0})},_saveDeputy:function(){var t=this,n=e("#addMembers").find("li").not(".creat").attr("data-id"),i=e("#textarea-desc").val(),s=r.util.toISO8601(e("#startDate").val()),o=r.util.toISO8601(r.util.toMoment(e("#endDate").val()).add("days",1).subtract("seconds",1));if(!e.goValidation.isCheckLength(1,200,i)){e.goSlideMessage(r.i18n(a["{{arg1}}\uc790\uc774\uc0c1 {{arg2}}\uc774\ud558 \uc785\ub825\ud574\uc57c\ud569\ub2c8\ub2e4."],{arg1:"1",arg2:"200"}),"caution");return}this.model.set({deputyUserId:n,absenceContent:i,title:GO.i18n(a["{{name}}\ub2d8\uc758 \ubd80\uc7ac\uc815\ubcf4 \uc785\ub2c8\ub2e4."],{name:r.session("name")}),startAt:s,endAt:o},{silent:!0});if(!this.model.isValid())return e.goError(this.model.validationError),!1;e.goConfirm(a["\ubd80\uc7ac\uc124\uc815\uc744 \uc800\uc7a5\ud558\uc2dc\uaca0\uc2b5\ub2c8\uae4c?"],"",function(){t.model.save({},{type:"POST",success:function(t,n){n.code=="200"&&(e.goMessage(u["\uc800\uc7a5\ub418\uc5c8\uc2b5\ub2c8\ub2e4."]),GO.router.navigate("approval/usersetting/deputy",{trigger:!0}))},error:function(t,n){var r=JSON.parse(n.responseText);return r.message?(e.goError(r.message),!1):(e.goError(u["\uc800\uc7a5\uc5d0 \uc2e4\ud328 \ud558\uc600\uc2b5\ub2c8\ub2e4."]),!1)}})})},_showOrgSlider:function(t){var n=this;return e.goOrgSlide({header:a["\ub300\uacb0\uc790 \uc120\ud0dd"],type:"list",contextRoot:GO.contextRoot,callback:n.addMember})},release:function(){this.$el.off(),this.$el.empty()}});return l})}).call(this);