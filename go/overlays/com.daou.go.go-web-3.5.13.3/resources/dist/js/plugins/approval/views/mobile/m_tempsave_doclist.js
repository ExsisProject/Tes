(function(){define(["jquery","backbone","when","hogan","app","approval/models/doclist_item","collections/paginated_collection","approval/views/mobile/m_pagination","approval/views/mobile/m_doclist_item","views/mobile/header_toolbar","approval/views/mobile/document/m_appr_form_select","hgn!approval/templates/mobile/m_doclist_empty","hgn!approval/templates/mobile/m_doclist_item","i18n!nls/commons","i18n!approval/nls/approval","jquery.go-validation","GO.util"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d){var v=t.Model.extend({url:"/api/approval/apprconfig"}),m={approval:d["\uc804\uc790\uacb0\uc7ac"],"\uc784\uc2dc \uc800\uc7a5\ud568":d["\uc784\uc2dc \uc800\uc7a5\ud568"],move_to_home:p["\ud648\uc73c\ub85c \uc774\ub3d9"],"\uc0c8\uacb0\uc7ac":d["\uc0c8\uacb0\uc7ac"],"\uc591\uc2dd\uc120\ud0dd":d["\uacb0\uc7ac\uc591\uc2dd \uc120\ud0dd"]},g=o.extend({initialize:function(e){o.prototype.initialize.call(this,e),_.extend(this.options,e||{})},model:s,url:function(){return"/api/approval/doclist/tempsave/all"}}),y=t.View.extend({el:"#content",initialize:function(e){i.util.appLoading(!0);var t=this;this.offset=i.config("mobileListOffset")||20,i.EventEmitter.off("common","appendRenderAboveList"),i.EventEmitter.on("common","appendRenderAboveList",this.appendRenderAboveList,this),this.options=e||{},_.bindAll(this,"render","renderPages"),this.collection=new g;var n=this.collection.url().replace("/api/",""),r=i.router.getUrl();r.indexOf("?")<0?i.router.navigate(n,{replace:!0}):r!=n&&i.router.navigate(n,{trigger:!1,pushState:!0}),this.headerToolbarView=f,this.toolBarData={title:m["\uc784\uc2dc \uc800\uc7a5\ud568"],isList:!0,isSideMenu:!0,isHome:!0,isSearch:!0,isWriteBtn:!0,writeBtnCallback:function(){var e={title:m["\uc591\uc2dd\uc120\ud0dd"],isClose:!0,closeCallback:function(){t.headerToolbarView.render(t.toolBarData),t.documentAction.release(),t.$el.find("#document_action").hide(),t.$el.find("#document_todo").show()}};t.documentAction=new l({toolBarData:e}),t.documentAction.release(),t.$el.find("#document_todo").hide(),t.$el.find("#document_action").show(),t.assign(t.documentAction,"#document_action")}},this.properties=_.isNull(sessionStorage.getItem(i.constant("navigator","PROPERTY")))?null:sessionStorage.getItem(i.constant("navigator","PROPERTY")),this.pageNo=_.isNull(sessionStorage.getItem(i.constant("navigator","PAGE-NO")))?0:sessionStorage.getItem(i.constant("navigator","PAGE-NO")),sessionStorage.clear()},assign:function(e,t){e.setElement(this.$(t)).render()},renderPages:function(){this.$el.find("div.paging br_no").remove()},render:function(){n(this.fetchConfig.call(this)).then(_.bind(function(){this.$el.html(h({ulWrapperId:"document_todo",documentAction:!0})),this.headerToolbarView.render(this.toolBarData);var e=this;if(this.pageNo>=0){for(var t=0;t<=this.pageNo;t++){this.collection.fetch({async:!1,data:{page:t,offset:this.offset},success:function(t){e.renderList(t)}});if(t===0&&this.collection.length===0){this.$el.find("ul.list_box").append(c({lang:{doclist_empty:d["\ubb38\uc11c\uac00 \uc5c6\uc2b5\ub2c8\ub2e4."]}}));return}}this.scrollToEl()}i.util.appLoading(!1)},this)).then(_.bind(this.fetchCollection,this)).otherwise(function(t){console.log(t.stack)}),setTimeout(function(){i.util.pageDone()},500)},fetchConfig:function(){var e=this,t=n.defer();return this.configModel=new v,this.useHold=!0,this.configModel.fetch({success:function(n){e.useHold=n.get("useHold"),t.resolve()},error:t.reject}),t.promise},fetchCollection:function(){var e=n.defer();return this.collection.fetch({success:function(){e.resolve()},error:e.reject}),e.promise},renderList:function(e){var t=this,n="approval",r=this.useHold;e.each(function(e){var i=new a({model:e,listType:n,isTodoList:r});t.$el.find("ul.list_box").append(i.render().el)})},scrollToEl:function(){if(_.isNull(this.properties))return!1;var t=JSON.parse(this.properties),n=e("a[data-docid="+t.docid+"]"),r=n.offset().top,i=n.height(),s=e(window).height(),o;i<s?o=r-(s/2-i/2):o=r,e("html").animate({scrollTop:o})},appendRenderAboveList:function(){var e=this,t=this.collection.pageInfo();if(!t.next)return;var n=t.pageNo+1;return this.collection.fetch({async:!1,data:{page:n,offset:this.offset},success:function(t){e.renderList(t)}}),!1}},{__instance__:null,create:function(){return this.__instance__=new this.prototype.constructor({el:e("#content")}),this.__instance__},render:function(){var e=this.create(),t=arguments.length>0?Array.prototype.slice.call(arguments):[];return this.prototype.render.apply(e,t)}});return y})}).call(this);