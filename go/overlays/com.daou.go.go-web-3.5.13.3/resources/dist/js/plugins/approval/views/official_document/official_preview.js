define(["backbone","app","when","approval/models/official_preview","i18n!nls/commons","i18n!approval/nls/approval","hgn!approval/templates/official_document/official_preview","formutil","jquery.fancybox","jquery.go-popup","jquery.ui","json","json2","jquery.placeholder"],function(e,t,n,r,i,s,o){var u={"\uc778\uc1c4 \ubbf8\ub9ac\ubcf4\uae30":i["\uc778\uc1c4 \ubbf8\ub9ac\ubcf4\uae30"],"\uc778\uc1c4":i["\uc778\uc1c4"]},a=['<div id="toolbar" class="header_print">','<h1 class="approval_print_title">{{lang.\uc778\uc1c4 \ubbf8\ub9ac\ubcf4\uae30}}','<span class="btn_wrap">','<span class="btn_minor_s" id="printDoc" title="{{lang.\uc778\uc1c4}}">','<span class="ic_print"></span><span class="txt">{{lang.\uc778\uc1c4}}</span>',"</span>","</span>","</h1>","</div>"].join(""),f=e.View.extend({el:"#content",htmlContent:null,initialize:function(e){this.options=e||{},this.docId=this.options.docId,GO.util.store.get("official-preview-data")||(GO.util.store.set("official-preview-data",window.opener.GO.util.store.get("official-preview-data")),window.opener.GO.util.store.set("official-preview-data",null)),this.model=new r(GO.util.store.get("official-preview-data"))},render:function(){n(this.fetchModel()).then(_.bind(function(){this.$el.html(o({lang:u})),this.$el.prepend(Hogan.compile(a).render({lang:u})),this.docContents=$("#document_content");var t=GO.util.escapeXssFromHtml(this.htmlContent);this.docContents.html(t),this.showPreserveYears(),$("body").addClass("print"),GO.util.isIE8()&&$("body").css("min-width","300px"),this.unbindEvent(),this.bindEvent()},this)).otherwise(function(t){console.log(t.stack)})},unbindEvent:function(){this.$el.parent().off("click","#printDoc")},bindEvent:function(){this.$el.parent().on("click","#printDoc",$.proxy(this.printDoc,this))},printDoc:function(){GO.util.print(this.$el)},prepend:function(e,t){this.$(t).prepend(e.render().el)},setContent:function(e){this.htmlContent=e},showPreserveYears:function(){var e="",t=$(content).find("span[data-id=preserveDuration]");return t.text()=="0\ub144"?e=t.text("\uc601\uad6c"):e=t.text(),e},showPreserveYears:function(){var e="",t=$(content).find("span[data-id=preserveDuration]");return t.text()=="0\ub144"?e=t.text("\uc601\uad6c"):e=t.text(),e},fetchModel:function(){var e=this,t=n.defer();return $.go(this.model.url(),JSON.stringify(this.model.toJSON()),{qryType:"PUT",contentType:"application/json",responseFn:function(n){n.code==200?(e.setContent(n.data),t.resolve()):t.reject()},error:function(e){var n=JSON.parse(e.responseText);n.message&&$.goError(n.message),t.reject()}}),t.promise}});return f});