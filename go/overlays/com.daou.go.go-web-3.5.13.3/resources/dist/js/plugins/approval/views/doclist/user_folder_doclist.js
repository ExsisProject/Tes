define(["jquery","underscore","backbone","app","approval/collections/user_folder_doclist","approval/views/content_top","views/pagination","views/pagesize","approval/views/doclist/base_doclist","approval/views/doclist/doclist_item","approval/views/doclist/doclist_csv_download","approval/views/doclist/user_doc_folder","approval/views/side","hgn!approval/templates/doclist_empty","hgn!approval/templates/user_folder_doclist","approval/models/all_documents_action","i18n!nls/commons","i18n!approval/nls/approval"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g){var y={"\uc81c\ubaa9":m["\uc81c\ubaa9"],"\uae30\uc548\uc790":g["\uae30\uc548\uc790"],"\uac80\uc0c9":m["\uac80\uc0c9"],"\uc774\ub3d9":m["\uc774\ub3d9"],"\uc0ad\uc81c":m["\uc0ad\uc81c"],"\uacb0\uc7ac\uc591\uc2dd":g["\uacb0\uc7ac\uc591\uc2dd"],"\uacb0\uc7ac\uc120":g["\uacb0\uc7ac\uc120"],"\uae30\uc548\ubd80\uc11c":g["\uae30\uc548\ubd80\uc11c"],"\ubb38\uc11c\ubc88\ud638":g["\ubb38\uc11c\ubc88\ud638"],placeholder_search:m["\ud50c\ub808\uc774\uc2a4\ud640\ub354\uac80\uc0c9"]},b=n.Model.extend({url:function(){var e=["/api/approval/userfolder/"+this.folderId+"/document/move"].join("/");return e},setFolderId:function(e){this.folderId=e}}),w=n.Model.extend({url:function(){var e=["/api/approval/userfolder/"+this.folderId+"/document/remove"].join("/");return e},setFolderId:function(e){this.folderId=e}}),E=a.extend({docFolderType:null,userFolderCols:{"\uc120\ud0dd":m["\uc120\ud0dd"],"\uae30\uc548\uc77c":g["\uae30\uc548\uc77c"],"\uae30\uc548\uc790":g["\uae30\uc548\uc790"],"\uacb0\uc7ac\uc591\uc2dd":g["\uacb0\uc7ac\uc591\uc2dd"],"\uae34\uae09":g["\uae34\uae09"],"\uc81c\ubaa9":m["\uc81c\ubaa9"],"\ucca8\ubd80":g["\ucca8\ubd80"],"\ubb38\uc11c\ubc88\ud638":g["\ubb38\uc11c\ubc88\ud638"],count:8},buttons:{},el:"#content",initialize:function(e){this.options=e||{},t.bindAll(this,"render","renderPageSize","renderPages"),this.contentTop=s.getInstance(),this.type=this.options.type,this.isRef=!1,this.buttons.move=!0,this.buttons.remove=!0,this.docFolderType="custom_add",this.checkboxColumn={id:"checkedAllDeptDoc",name:"checkedAllDeptDoc"},this.usePeriod=!0,this.folderId=this.options.folderId,this.userId=r.session("id"),this.collection=new i({folderId:this.folderId,userId:this.userId,type:this.type}),this.initProperty="draftedAt",this.initDirection="desc",this.ckeyword="";var n=sessionStorage.getItem("list-history-baseUrl");n&&(n=n.replace(/#/gi,""));var o="approval/userfolder/"+this.folderId+"/documents";n&&n==o?(this.initProperty=sessionStorage.getItem("list-history-property"),this.initDirection=sessionStorage.getItem("list-history-direction"),this.initSearchtype=sessionStorage.getItem("list-history-searchtype"),this.ckeyword=sessionStorage.getItem("list-history-keyword").replace(/\+/gi," "),this.usePeriod&&(this.duration=sessionStorage.getItem("list-history-duration"),this.fromDate=sessionStorage.getItem("list-history-fromDate"),this.toDate=sessionStorage.getItem("list-history-toDate")),this.collection.setListParam()):(this.usePeriod&&this.collection.setDuration(),this.collection.setSort(this.initProperty,this.initDirection)),sessionStorage.clear(),this.collection.bind("reset",this.resetList,this),this.collection.usePeriod=this.usePeriod,a.prototype.initialize.call(this,e)},events:function(){return t.extend({},a.prototype.events,{"click input:checkbox":"toggleCheckbox","click #userDocMove":"userDocMove","click #userDocDelete":"userDocDelete","click .sorting":"sort","click .sorting_desc":"sort","click .sorting_asc":"sort","click #checkedAllDeptDoc":"checkedAllDoc"})},userDocMove:function(){var n=this,i=[],s=e("input[name=checkbox]:checked");s.each(function(){i.push(e(this).attr("data-id"))});if(e.isEmptyObject(i)){e.goError(g["\uc120\ud0dd\ub41c \ud56d\ubaa9\uc774 \uc5c6\uc2b5\ub2c8\ub2e4."]);return}var o=this.userName,u=this.userId,a=this.folderId,f,l=e.goPopup({pclass:"layer_normal layer_doc_type_select",header:g["\ubb38\uc11c \uc774\ub3d9"],modal:!0,width:300,contents:"",buttons:[{btext:m["\ud655\uc778"],btype:"confirm",autoclose:!1,callback:function(s){var o=s.find(".on span[data-folderid]").attr("data-folderid");if(!o)return e.goError(g["\uc774\ub3d9\ud558\uc2e4 \ubb38\uc11c\ud568\uc744 \uc120\ud0dd\ud574\uc8fc\uc2ed\uc2dc\uc694."]),e("#userFolderError").addClass("enter error").focus(),!1;if(o==a)return e.goError(g["\ub3d9\uc77c\ud55c \ubb38\uc11c\ud568\uc785\ub2c8\ub2e4."]),e("#userFolderError").addClass("enter error").focus(),!1;var u=e.goPreloader();s.parent().find("#allSelectTr").is(":visible")&&s.parent().find("#allSelectMsg3").attr("data-value")=="folder"?(f=new v({folderType:"userfolder",action:"move"}),!t.isUndefined(n.collection.keyword)&&n.collection.keyword.trim().length>0&&(f.setSearch(n.collection.searchtype,n.collection.keyword),n.collection.duration=="period"&&f.setDuration({duration:n.collection.duration,fromDate:r.util.toISO8601(n.collection.fromDate),toDate:r.util.searchEndDate(n.collection.toDate)}))):f=new b({ids:i}),f.set({folderId:o}),f.setFolderId(a),f.save({},{silent:!0,type:"PUT",beforeSend:function(){u.render()},success:function(){e.goMessage(g["\uc120\ud0dd\ud55c \ud56d\ubaa9\uc774 \uc774\ub3d9\ub418\uc5c8\uc2b5\ub2c8\ub2e4"]),s.close(),n.$el.find("#checkedAllDeptDoc").attr("checked",!1),n.collection.fetch()},error:function(t,n){var r=JSON.parse(n.responseText);e.goError(r.message)},complete:function(){u.release()}})}},{btext:m["\ucde8\uc18c"],btype:"cancel"}]}),h=new c({docIds:i,userId:u});h.render(),i!=""&&l.reoffset()},userDocDelete:function(){var n=this,i=[],s=this.folderId,o=e("input[name=checkbox]:checked");o.each(function(){i.push(e(this).attr("data-id"))});if(e.isEmptyObject(i)){e.goError(g["\uc120\ud0dd\ub41c \ud56d\ubaa9\uc774 \uc5c6\uc2b5\ub2c8\ub2e4."]);return}var u;e.goConfirm(g["\uc120\ud0dd\ud55c \ud56d\ubaa9\uc744 \uc0ad\uc81c\ud558\uc2dc\uaca0\uc2b5\ub2c8\uae4c?"],"",function(o){var a=e.goPreloader();o.parent().find("#allSelectTr").is(":visible")&&o.parent().find("#allSelectMsg3").attr("data-value")=="folder"?(u=new v({folderType:"userfolder",action:"remove"}),!t.isUndefined(n.collection.keyword)&&n.collection.keyword.trim().length>0&&(u.setSearch(n.collection.searchtype,n.collection.keyword),n.collection.duration=="period"&&u.setDuration({duration:n.collection.duration,fromDate:r.util.toISO8601(n.collection.fromDate),toDate:r.util.searchEndDate(n.collection.toDate)}))):u=new w({ids:i}),u.setFolderId(s),u.save({},{silent:!0,type:"PUT",beforeSend:function(){a.render()},success:function(){e.goMessage(g["\uc120\ud0dd\ud55c \ud56d\ubaa9\uc774 \uc0ad\uc81c\ub418\uc5c8\uc2b5\ub2c8\ub2e4"]),n.$el.find("#checkedAllDeptDoc").attr("checked",!1),n.collection.fetch()},error:function(){e.goError(m["\uc800\uc7a5\uc5d0 \uc2e4\ud328 \ud558\uc600\uc2b5\ub2c8\ub2e4."])},complete:function(){a.release()}})})},renderLayout:function(){this.$el.html(d({lang:y,buttons:this.buttons,isRef:this.isRef})),this.contentTop.setTitle(""),this.$el.find("header.content_top").replaceWith(this.contentTop.el),this.renderPageSize(),(new l({getDownloadURL:e.proxy(this.collection.getCsvURL,this.collection),appendTarget:this.$el.find("#docToolbar > div.critical")})).render()},toggleCheckbox:function(t){e(t.currentTarget).is(":checked")?(e(t.currentTarget).attr("checked",!0),e("td.check :checkbox:checked").length==this.collection.pageSize&&(this.$el.find("#checkedAllDeptDoc").attr("checked",!0),this.toggleSelectAllTpl(!0))):(this.$el.find("#checkedAllDeptDoc").attr("checked",!1),e(t.currentTarget).attr("checked",!1),this.toggleSelectAllTpl(!1))},renderTitle:function(e){this.contentTop.setTitle(e),this.contentTop.render()},renderPageSize:function(){this.pageSizeView=new u({pageSize:this.collection.pageSize}),this.pageSizeView.render(),this.pageSizeView.bind("changePageSize",this.selectPageSize,this)},renderPages:function(){this.pageView=new o({pageInfo:this.collection.pageInfo()}),this.pageView.bind("paging",this.selectPage,this),this.$el.find("div.tool_absolute > div.dataTables_paginate").remove(),this.$el.find("div.tool_absolute").append(this.pageView.render().el),this.$el.find("#checkedAllDeptDoc").attr("checked",!1)},resetList:function(t){this.collection.extData!=null&&this.renderTitle(this.collection.extData.folderName);var n=this.collection.url().replace("/api/",""),i=r.router.getUrl().replace("#","");i.indexOf("?")<0?r.router.navigate(n,{replace:!0}):i!=n&&r.router.navigate(n,{trigger:!1,pushState:!0}),e(".list_approval > tbody").empty(),this.completeDocumentTotal=this.collection.total,this.renderSelectAllTpl();var s=this.columns,o="approval";t.each(function(t){var n=new f({model:t,isCheckboxVisible:t.isCompleted(),listType:o,columns:s});e(".list_approval > tbody").append(n.render().el)}),t.length==0&&e(".list_approval > tbody").html(p({columns:this.columns,lang:{doclist_empty:g["\ubb38\uc11c\uac00 \uc5c6\uc2b5\ub2c8\ub2e4."]}})),this.renderPages()},selectPage:function(e){this.collection.setPageNo(e),this.collection.fetch()},selectPageSize:function(e){this.collection.setPageSize(e),this.collection.fetch()},release:function(){this.$el.off(),this.$el.empty()},checkedAllDoc:function(){e("#checkedAllDeptDoc").is(":checked")?e("td.check :checkbox:not(checked)").attr("checked",!0):e("td.check :checkbox:checked").attr("checked",!1),this.toggleSelectAllTpl(e("#checkedAllDeptDoc").is(":checked"))},toggleSelectAllTpl:function(t){var n=this.completeDocumentTotal>this.collection.pageSize;t&&n?e("#allSelectTr").show():e("#allSelectTr").hide()}});return E});