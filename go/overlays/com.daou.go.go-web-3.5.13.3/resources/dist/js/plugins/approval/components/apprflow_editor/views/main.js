define("approval/components/apprflow_editor/views/main",["backbone","app","approval/components/apprflow_editor/views/base_tab","hgn!approval/components/apprflow_editor/templates/main","approval/components/apprflow_editor/views/side","approval/components/apprflow_editor/views/side/org_tree","approval/components/apprflow_editor/views/side/my_appr_line","approval/components/apprflow_editor/views/side/my_subscriber","approval/components/apprflow_editor/views/side/contact","approval/collections/appr_activity_groups","approval/collections/appr_official_version","approval/models/document","approval/models/appr_line","i18n!nls/commons","i18n!approval/nls/approval","jquery.go-popup"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d){function S(){this.$el.html(x.call(this))}function x(){return r(T.call(this))}function T(){return _.extend({lang:m,isAdmin:this.isAdmin,isArbitraryCheckVisible:this.isArbitraryCheckVisible},this.apprLineModel.toJSON())}function N(e){e.apprDocumentModel?this.model=e.apprDocumentModel.clone():this.model=new c,_.isFunction(e.saveCallback)&&(this.onConfirmed=e.saveCallback),_.isFunction(e.onConfirmed)&&(this.onConfirmed=e.onConfirmed),this.apprLineModel=new h(this.model.get("apprFlow")),this.actionCheck=this.model.get("actionCheck"),this.documentModel=this.model.get("document"),this.docStatus=this.documentModel.docStatus,this.isAdmin=!1,_.isBoolean(e.isAdmin)&&(this.isAdmin=e.isAdmin),this.viewerType="",_.isString(e.viewerType)&&(this.viewerType=e.viewerType),e.masterAuthModel&&(this.masterAuthModel=e.masterAuthModel),this.isArbitraryCheckVisible=!1,_.isBoolean(this.actionCheck.isArbitraryCheckVisible)&&(this.isArbitraryCheckVisible=this.actionCheck.isArbitraryCheckVisible);if(_.isNull(this.apprLineModel))throw new g("No 'apprLineModel' is set.");if(_.isNull(this.actionCheck))throw new g("No 'actionCheck' is set.")}function C(){_.each(E.__tabViewKlassList__,function(e,t){var n=new e({model:this.model,isAdmin:this.isAdmin,masterAuthModel:this.masterAuthModel,viewerType:this.viewerType,observer:this.observer});this.options.defaultActiveTab===n.getTabId()&&n.activate(),this.addItemView(n)},this),this.listenTo(this.observer,"changedTabItem",function(e){this.getTabElement(e).addClass("selectable"),this.$(".alert-modified").show()})}function k(){var e=this,t=$.goPopup({pclass:"layer_normal detail_search_wrap layer_approval_line",header:m.header,modal:!0,width:"900px",buttons:[{btext:m.confirm,btype:"confirm",autoclose:!1,callback:_.bind(M,this)},{btext:m.cancel,btype:"cancel",callback:function(){e.remove()}}]});return t.find(".content").replaceWith(this.el),t.reoffset(),t}function L(){this.sideView=new i({el:this.$el.find(".aside-apprline"),observer:this.observer}),this.orgTreeSideView=new s({docStatus:this.model.getDocStatus(),dndDropTarget:".appr-activity",isDndActive:!0,observer:this.observer,multiCompanySupporting:this.model.get("actionCheck").multiCompanySupporting,isAdmin:this.isAdmin,active:!0,draggables:O.call(this),useDisableNodeStyle:!1,useApprReception:!1,useApprReference:!1}),this.rcvOrgTreeDeptSideView=new b({docStatus:this.model.getDocStatus(),dndDropTarget:".appr-activity",isDndActive:!0,observer:this.observer,multiCompanySupporting:this.model.get("actionCheck").multiCompanySupporting,isAdmin:this.isAdmin,active:!0,draggables:O.call(this),useDisableNodeStyle:!0,useApprReception:!0,useApprReference:!1}),this.rcvOrgTreeSideView=new y({docStatus:this.model.getDocStatus(),dndDropTarget:".appr-activity",isDndActive:!0,observer:this.observer,multiCompanySupporting:this.model.get("actionCheck").multiCompanySupporting,receiveAllowType:this.model.getReceiveAllowType(),isAdmin:this.isAdmin,draggables:O.call(this),useDisableNodeStyle:!0,useApprReception:!0,useApprReference:!1}),this.refOrgTreeSideView=new w({docStatus:this.model.getDocStatus(),dndDropTarget:".appr-activity",isDndActive:!0,observer:this.observer,multiCompanySupporting:this.model.get("actionCheck").multiCompanySupporting,receiveAllowType:"ALL",isAdmin:this.isAdmin,draggables:O.call(this),useDisableNodeStyle:!0,useApprReception:!1,useApprReference:!0}),this.contactSideView=new a({docStatus:this.model.getDocStatus(),dndDropTarget:".appr-activity",isDndActive:!0,observer:this.observer,isAdmin:this.isAdmin,disabled:!0}),this.myApprSubscriberSideView=new u({docStatus:this.model.getDocStatus(),observer:this.observer}),this.sideView.addItemView(this.orgTreeSideView),this.sideView.addItemView(this.rcvOrgTreeDeptSideView),this.sideView.addItemView(this.rcvOrgTreeSideView),this.sideView.addItemView(this.refOrgTreeSideView),this.sideView.addItemView(new o({docStatus:this.model.getDocStatus(),observer:this.observer})),this.sideView.addItemView(this.myApprSubscriberSideView),this.sideView.addItemView(this.contactSideView)}function A(){this.sideView.render()}function O(){return'a[nodeState != "DISABLE"][rel], ul.department_list > li > a[nodeState != "DISABLE"], ul.member_list > li > a[nodeState != "DISABLE"]'}function M(e){var t=!0;if(this.viewerType==="official_document"){if(this.model.get("docInfoChanged")){var n=new l(this.model.docInfoModel.get("officialVersions"));if(n.isEmptyReceiver())return $.goMessage(m.msg_receiver_add),!1}this.remove(),e.close(),this.onConfirmed(this.model)}else this.activityGroups=new f(this.model.apprFlowModel.get("activityGroups")),this.activityGroups.each(function(e){e.isExceedMaxApprovalCount()&&($.goMessage(m.msg_max_approval_count_exceed),t=!1)}),t&&(this.remove(),e.close(),this.onConfirmed(this.model))}function D(){var e=this.getActiveTabItemView(),t=this.$el.find(".set_wrap");if(e.editable()){this.sideView.show(),t.removeClass("no_column");switch(e.getTabId()){case"apprline":this.sideView.enableTab("orgtree"),this.sideView.disableTab("depttree"),this.sideView.disableTab("rcvorgtree"),this.sideView.disableTab("reforgtree"),this.sideView.enableTab("myapprline"),this.sideView.disableTab("contact"),this.sideView.disableTab("mysubscriber"),this.orgTreeSideView.selected();break;case"referer":this.sideView.disableTab("orgtree"),this.sideView.disableTab("depttree"),this.sideView.disableTab("rcvorgtree"),this.sideView.enableTab("reforgtree"),this.sideView.disableTab("myapprline"),this.sideView.disableTab("contact"),this.sideView.enableTab("mysubscriber"),this.myApprSubscriberSideView.deselectSubscriber(),this.sideView.activateTab("reforgtree"),this.refOrgTreeSideView.selected();break;case"reader":this.sideView.enableTab("orgtree"),this.sideView.disableTab("depttree"),this.sideView.disableTab("rcvorgtree"),this.sideView.disableTab("reforgtree"),this.sideView.disableTab("myapprline"),this.sideView.disableTab("contact"),this.sideView.enableTab("mysubscriber"),this.myApprSubscriberSideView.deselectSubscriber(),this.sideView.activateTab("orgtree"),this.orgTreeSideView.selected();break;case"receiver":var n=this.model.getReceiveAllowType();n=="DEPARTMENT"?(this.sideView.disableTab("orgtree"),this.sideView.enableTab("depttree"),this.sideView.disableTab("rcvorgtree"),this.sideView.activateTab("depttree"),this.rcvOrgTreeDeptSideView.selected()):(this.sideView.disableTab("orgtree"),this.sideView.disableTab("depttree"),this.sideView.enableTab("rcvorgtree"),this.sideView.activateTab("rcvorgtree"),this.rcvOrgTreeSideView.selected()),this.sideView.disableTab("reforgtree"),this.sideView.disableTab("myapprline"),this.sideView.disableTab("contact"),this.sideView.enableTab("mysubscriber"),this.myApprSubscriberSideView.deselectSubscriber();break;case"officialdoc":this.sideView.disableTab("orgtree"),this.sideView.disableTab("depttree"),this.sideView.disableTab("rcvorgtree"),this.sideView.disableTab("reforgtree"),this.sideView.disableTab("myapprline"),this.sideView.enableTab("contact"),this.sideView.disableTab("mysubscriber"),this.sideView.activateTab("contact"),this.contactSideView.selected()}}else this.sideView.hide(),t.addClass("no_column")}function P(){var e=this.getActiveTabItemView(),t=e.getTabId(),n="wrap_approval_agree",r=this.$el.find(".set_wrap");t==="apprline"||t==="receiver"||t==="referer"||t==="reader"?r.addClass(n):r.removeClass(n)}var v="900px",m={header:d["\uacb0\uc7ac \uc815\ubcf4"],save_as_my_line:d["\uac1c\uc778 \uacb0\uc7ac\uc120\uc73c\ub85c \uc800\uc7a5"],normal:d["\uc77c\ubc18"],my_lines:d["\ub098\uc758\uacb0\uc7ac\uc120"],activityType:d["\ud0c0\uc785"],name:p["\uc774\ub984"],dept:d["\ubd80\uc11c"],state:d["\uc0c1\ud0dc"],arbitrary:d["\uc804\uacb0"],"delete":p["\uc0ad\uc81c"],agreement_type:d["\ud569\uc758\ubc29\uc2dd"],agreement_linear:d["\uc21c\ucc28\ud569\uc758"],agreement_parallel:d["\ubcd1\ub82c\ud569\uc758"],confirm:p["\ud655\uc778"],cancel:p["\ucde8\uc18c"],msg_max_approval_count_exceed:d["\uacb0\uc7ac\uc790 \uc218\uac00 \ucd5c\ub300 \uacb0\uc7ac\uc790 \uc218\ub97c \ub118\uc744 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4."],msg_parallel_agreement_should_has_2_more_agreement:d["\ubcd1\ub82c\ud569\uc758\ub294 \uc5f0\uc18d\ub41c \ub458 \uc774\uc0c1\uc758 \ud569\uc758\uac00 \ud544\uc694\ud569\ub2c8\ub2e4."],msg_save_success:p["\uc800\uc7a5\ub418\uc5c8\uc2b5\ub2c8\ub2e4."],msg_duplicated_my_line_title:d["\uc911\ubcf5\ub41c \uc774\ub984\uc744 \uc0ac\uc6a9\ud560 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4."],my_line_name:d["\uacb0\uc7ac\uc120 \uc774\ub984"],alert_modified:d["\uc800\uc7a5\ub418\uc9c0 \uc54a\uc740 \uc815\ubcf4\uac00 \uc788\uc2b5\ub2c8\ub2e4"],msg_receiver_add:"\uacf5\ubb38\uc11c \uc218\uc2e0\ucc98\ub97c \ud55c \uacf3 \uc774\uc0c1 \uc9c0\uc815\ud574 \uc8fc\uc138\uc694."},g=function(e){this.message=e,this.name="ApprFlowEditorException"},y=s.extend({id:"aside-receiver-orgtree",tabId:"rcvorgtree"}),b=y.extend({id:"aside-dept-orgtree",tabId:"depttree",type:"department"}),w=s.extend({id:"aside-referer-orgtree",tabId:"reforgtree"}),E=n.extend({className:"content apprflow-editor",tabEl:".maintab",tabItemEl:".maintab-item",itemTemplate:'<li><span class="ic_txt_change">*</span><span class="txt">{{tabName}}</span></li>',saveCallback:function(){},apprLineModel:null,isArbitraryCheckVisible:!1,isAdmin:!1,sideView:null,observer:null,viewerType:"",masterAuthModel:null,initialize:function(t){t=t||{},this.observer=_.extend({},e.Events),n.prototype.initialize.apply(this,arguments),N.call(this,t),S.call(this),L.call(this),C.call(this)},render:function(){n.prototype.render.apply(this,arguments),k.call(this),A.call(this)},remove:function(){n.prototype.remove.apply(this,arguments)},onConfirmed:function(){return!0},onCanceled:function(){return!0},activateTab:function(e){n.prototype.activateTab.apply(this,arguments),D.call(this),P.call(this)}},{__tabViewKlassList__:[],addTabView:function(e){this.__tabViewKlassList__.push(e)}});return E});