(function(){define(["jquery","underscore","app","hgn!approval/templates/detail_search_layer","i18n!nls/commons","i18n!approval/nls/approval","jquery.ui","jquery.go-popup","jquery.go-validation"],function(e,t,n,r,i,s){var o=GO.util.now().format("YYYY-MM-DD"),u={maxlength:200,label:{"\uc804\uc790\uacb0\uc81c \uc0c1\uc138 \uac80\uc0c9":i["\uc0c1\uc138\uac80\uc0c9"],"\uc804\uc0ac \ubb38\uc11c\ud568 \uc0c1\uc138 \uac80\uc0c9":i["\uc0c1\uc138\uac80\uc0c9"],"\ub300\uc0c1 \ubb38\uc11c\ud568":s["\ub300\uc0c1 \ubb38\uc11c\ud568"],"\uac80\uc0c9 \uae30\uac04":s["\uac80\uc0c9 \uae30\uac04"],"\uae30\uc548\uc77c":s["\uae30\uc548\uc77c"],"\uae30\uc548\uc790":s["\uae30\uc548\uc790"],"\uae30\uc548\ubd80\uc11c":s["\uae30\uc548\ubd80\uc11c"],"\uacb0\uc7ac\uc120":s["\uacb0\uc7ac\uc120"],"\uc644\ub8cc\uc77c":s["\uacb0\uc7ac\uc77c"],"\uc804\uccb4":s["\uc804\uccb4"],"\uc624\ub298":i["\uc624\ub298"],"\uc77c":s["\uc77c"],"\uc8fc\uc77c":s["\uc8fc\uc77c"],"\uac1c\uc6d4":s["\uac1c\uc6d4"],"\ub144":s["\ub144"],"\uc9c1\uc811\uc120\ud0dd":s["\uc9c1\uc811\uc120\ud0dd"],"\uc591\uc2dd\uc744 \uc120\ud0dd\ud558\uc138\uc694":s["\uc591\uc2dd\uc744 \uc120\ud0dd\ud558\uc138\uc694"],"\uc791\uc131\uc790":i["\uc791\uc131\uc790"],"\uac80\uc0c9\uc5b4":i["\uac80\uc0c9\uc5b4"],"\uc591\uc2dd\uc81c\ubaa9":s["\uc591\uc2dd\uc81c\ubaa9"],"\uc81c\ubaa9":i["\uc81c\ubaa9"],"\ub0b4\uc6a9":i["\ubcf8\ubb38"],"\ucca8\ubd80\ud30c\uc77c\uba85":s["\ucca8\ubd80\ud30c\uc77c\uba85"],"\ucca8\ubd80\ud30c\uc77c\ub0b4\uc6a9":i["\ucca8\ubd80\ud30c\uc77c \ub0b4\uc6a9"],"\uac80\uc0c9":i["\uac80\uc0c9"],"\ub2eb\uae30":i["\ub2eb\uae30"],"\ubaa8\ub450 \ub9cc\uc871":i["\ubaa8\ub450 \ub9cc\uc871"],"\ud558\ub098\ub9cc \ub9cc\uc871":i["\ud558\ub098\ub9cc \ub9cc\uc871"],"\uc124\uc815\ub41c \uae30\uac04\uc5d0\ub9cc \uac80\uc0c9":i["\uc124\uc815\ub41c \uae30\uac04\uc5d0\ub9cc \uac80\uc0c9"],"\uac80\uc0c9 \uc870\uac74":i["\uac80\uc0c9 \uc870\uac74"],"\ubb38\uc11c\ubc88\ud638":s["\ubb38\uc11c\ubc88\ud638"]}},a=function(){var a=function(e){this.template=r(t.extend({fromDate:GO.util.shortDate(o),toDate:GO.util.shortDate(o)},u)),this.render(e),this.delegateEvents(),this.$el.find("#termAll").trigger("click")};return a.prototype={render:function(t){var n="";this.setSearchType()?n=i["\uc0c1\uc138\uac80\uc0c9"]:n=i["\uc0c1\uc138\uac80\uc0c9"];var r={width:-1,modal:!0,header:n,pclass:"layer_approval_search",contents:this.template,closeCallback:e.proxy(this._release,this),callback:e.proxy(this.saveAction,this)};return"offset"in t&&(r.offset=t.offset),this.el=e.goSearch(r),this.$el=e(this.el),this._prepareDatepicker(),this},delegateEvents:function(){this.undelegateEvents(),this.$el.on("keydown.approval-detail-search","input.enable_enter",e.proxy(this._bindKeyboardEvent,this)),this.$el.on("click.period","span.btn_minor_s",e.proxy(this.selectTerm,this)),this.$el.on("click.listName","li>span[data-list]",e.proxy(this.changeList,this)),this.$el.on("click",".btn_select",e.proxy(this.toggleSelect,this))},undelegateEvents:function(){this.$el.off(".approval-detail-search"),this.$el.off(".period"),this.$el.off(".listName")},selectTerm:function(t){var n=GO.util.shortDate(GO.util.searchEndDate(o)),r=e(t.currentTarget).data("term");e(t.currentTarget).parent().find(".btn_minor_s").removeClass("btn_minor_s_selected"),e(t.currentTarget).addClass("btn_minor_s_selected"),r=="today"?(this.$el.find("#term_select").hide(),e("#detailFromDate").val(n),e("#detailToDate").val(n)):r=="specify"?(e("#detailFromDate").val()==""&&e("#detailFromDate").val(n),e("#detailToDate").val()==""&&e("#detailToDate").val(n),this.$el.find("#term_select").show()):r=="all"?(this.$el.find("#term_select").hide(),e("#detailFromDate").val(""),e("#detailToDate").val(n)):(this.$el.find("#term_select").hide(),e("#detailFromDate").val(GO.util.shortDate(GO.util.calDate(o,r,-1))),e("#detailToDate").val(n))},changeList:function(t){var n=e(t.currentTarget);e("#dateType").val(n.text()),e("#dateType").attr("data-name",n.text()),e("#dateType").attr("data-list",t.currentTarget.id),e("ul.select_list").hide()},toggleSelect:function(){e("ul.select_list").css("display")!="none"?e("ul.select_list").hide():e("ul.select_list").show()},setSearchType:function(e){var t=GO.router.getUrl().indexOf("docfolder");return t==-1?!0:!1},close:function(){this.el.close(e.proxy(this._release,this))},saveAction:function(t){var r=GO.util.shortDate(new Date),o="/approval/search",u="approval";this.setSearchType()||(u="docfolder");var a=e.trim(e("#formName").val()),f=e.trim(e("#drafterName").val()),l=e.trim(e("#drafterDeptName").val()),c=e.trim(e("#activityUserNames").val()),h=e.trim(e("#docNum").val()),p=e.trim(e("#detailFromDate").val()),d=e.trim(e("#detailToDate").val()),v=e.trim(e("#stext").val()),m=e.trim(e("input[name='searchOption']:checked").val());if(a==""&&f==""&&l==""&&c==""&&h==""&&v==""&&p==""&&d==""){e.goMessage(i["\uac80\uc0c9\uc5b4\ub97c \uc785\ub825\ud558\uc138\uc694."]);return}e.goError("",e("#searchMessage"),!0);var g=[a,f,l,c,h,v];for(var y=0;y<g.length;y++)if(g[y]!=""){if(!e.goValidation.isCheckLength(2,64,g[y])){e.goError(n.i18n(i["0\uc790\uc774\uc0c1 0\uc774\ud558 \uc785\ub825\ud574\uc57c\ud569\ub2c8\ub2e4."],{arg1:"2",arg2:"64"}));return}if(e.goValidation.isInValidEmailChar(g[y])){e.goMessage(i["\uba54\uc77c \uc0ac\uc6a9 \ubd88\uac00 \ubb38\uc790"]);return}}var b=!1;e("input[type=checkbox]").each(function(){this.checked&&(b=!0)});if(v&&!b){e.goError(s["\uac80\uc0c9\uc5b4 \uad6c\ubd84\uc744 \uc120\ud0dd\ud574\uc8fc\uc138\uc694."]);return}var w=e("input#dateType[data-list]").attr("data-list"),E,S=0;p?E=GO.util.toISO8601(e("#detailFromDate").val()):E=GO.util.toISO8601("1970/01/01"),d?S=GO.util.searchEndDate(e("#detailToDate").val()):S=GO.util.searchEndDate(r),GO.EventEmitter.trigger("common","layout:setOverlay",!0);var x={type:u,formName:a,drafterName:f,drafterDeptName:l,activityUserNames:c,docNum:h,dateType:w,title:e("#title").attr("checked")?v:"",docBody:e("#docBody").attr("checked")?v:"",searchTerm:this.$el.find(".btn_minor_s_selected").data("term"),attachFileNames:e("#attachFileNames").attr("checked")?v:"",attachFileContents:e("#attachFileContents").attr("checked")?v:"",fromDate:E,toDate:S,stype:"detail",searchOption:m};u=="docfolder"&&(o="/docfolder/search"),n.router.navigate(o+"?"+this._serializeObj(x),!0)},_serializeObj:function(e){var t=[];for(var n in e)t.push(encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t.join("&")},_bindKeyboardEvent:function(e){return e.which===13&&this._requestSearch(),this},_prepareDatepicker:function(){var e=this.$el.find("#detailFromDate"),t=this.$el.find("#detailToDate");return e.datepicker({dateFormat:"yy-mm-dd",changeMonth:!0,changeYear:!0,yearSuffix:"",onClose:function(e){t.datepicker("option","minDate",e)}}),t.datepicker({dateFormat:"yy-mm-dd",changeMonth:!0,changeYear:!0,yearSuffix:"",minDate:e.val()}),this},validate:function(n){var r=this,o=!0;return t.map(n,function(e,t){t!=="s_type"&&!!e&&(o&=!1),t==="fromDate"&&e&&(n[t]=GO.util.toISO8601(GO.util.toMoment(e).startOf("day"))),t==="toDate"&&e&&(n[t]=GO.util.toISO8601(GO.util.toMoment(e).endOf("day")))}),o?(e.goMessage(i["\uac80\uc0c9\uc5b4\ub97c \uc785\ub825\ud558\uc138\uc694."]),!1):n.summary>200?(e.goMessage(GO.i18n(s["{{max}}\uc790 \uc774\ud558\ub85c \uc785\ub825\ud574 \uc8fc\uc2ed\uc2dc\uc624"],{max:200})),this.$el.find("#detail_keyword").focus(),!1):!0},_release:function(){this.undelegateEvents()},_showDatepicker:function(t){var n=e(t.currentTarget);return n.val()==="custom"?this.$el.find("#datepicker").show():this.$el.find("#datepicker").hide(),this}},a}();return a})}).call(this);