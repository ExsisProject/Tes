function chgAttachMod(e){var t=jQuery("#att_btn_ocx"),n=jQuery("#ocx_chage"),r=jQuery("#att_ocx_area"),i=jQuery("#att_ocx_quota_info"),s=jQuery("#att_btn_simple"),o=jQuery("#simple_chage"),u=jQuery("#att_simple_area"),a=jQuery("#att_simple_quota_info"),f=jQuery("#simpleFileInit");try{if(e=="ocx"){if(!isOcxUploadDownModule){makeNormalUploadOcx("ocxCompL",LOCALE);try{if(isMsie){var l=document.uploadForm.powerupload;l.SetUrlData("UPFIELD","theFile"),isOcxUploadDownModule=!0}}catch(c){isOcxUploadDownModule=!1}}if(isOcxUploadDownModule){ocx_init();var l=document.uploadForm.powerupload;t.show(),r.show(),i.show(),n.show(),s.hide(),u.hide(),a.hide(),o.hide(),f.hide(),isOcxUpload=!0,basicAttachUploadControl.emptyFileList()}}else{var h=hasFlashPlayer();t.hide(),r.hide(),i.hide(),n.hide();if(h)f.hide(),jQuery("#basicUploadControl").show(),s.show();else{jQuery("#basicUploadControl").hide(),f.show(),s.hide();var p=jQuery("#webfolderFilePopup"),d=null;p.unbind(),jQuery("#mailSimpleFileUpload").fileupload({url:"/api/webfolder/file/upload",formData:{uploadType:"flash",uploadApp:"webfolder",maxAttachFileSize:MAX_ATTACH_SIZE},dataType:"json",pasteZone:null,dropZone:p,done:function(e,t){var n=t.result,r=n.fileSize;n.uploadResult=="success"?addlist(n.fileName,n.fileSize,n.filePath,n.hostId,""):r=="0"?jQuery.goAlert(mailMsg.comn_upload_title,mailMsg.file_size_zero):jQuery.goAlert(mailMsg.comn_upload_title,mailMsg.error_fileupload)}}),p.bind("dragleave",function(e){clearTimeout(d),d=setTimeout(function(){p.removeClass("drag_file")},100)}),p.bind("dragover",function(e){e.preventDefault(),e.stopPropagation(),e.originalEvent.dataTransfer.dropEffect="move",jQuery(this).addClass("drag_file"),clearTimeout(d)}),p.bind("drop",function(e){e.preventDefault(),e.stopPropagation(),jQuery(this).removeClass("drag_file")})}u.show(),a.show(),o.show(),isOcxUpload=!1,basic_init(),(!isMsie||!activeXMake)&&jQuery("#crtBtnPower").hide()}}catch(c){alert(c.message)}}function deletefile(){if(!isOcxUpload){var e=basicAttachUploadControl.getCheckAttachFileIds();if(e.length>0){for(var t=0;t<e.length;t++){if(e[t]=="basicAttachChkAll")continue;basicAttachUploadControl.deleteAttachList(e[t])}var n=basicAttachUploadControl.getAttachQuotaInfo();MAX_QUOTA_SIZE>n.normalUse&&(jQuery("#quotaMax").hide(),jQuery("#webfolderFilePopup .btn_major_s").show()),updateAttachQuota(null,n.normalUse),jQuery("#basicAttachChkAll").attr("checked",!1)}}else{var r=document.uploadForm.powerupload;r.DetachFile(-1)}}function getAttachString(){var e="";if(isOcxUpload){var t=document.uploadForm.powerupload,n=t.GetAttachedFileCount();for(var r=0;r<n;r++){var i=t.GetAttachedFileAttr(r,"TYPE");if(i!="normal")continue;e+=t.GetAttachedFileAttr(r,"UPKEY")+"	"+Base64TMS.decode(t.GetAttachedFileAttr(r,"FILENAME2"))+"	"+t.GetAttachedFileAttr(r,"SIZE")+"	"+t.GetAttachedFileAttr(r,"HOSTID")+"	"+t.GetAttachedFileAttr(r,"UID")+"\n"}}else{var s=basicAttachUploadControl.getFileList("normal");for(var r=0;r<s.length;r++){if(isInValidExtension(s[r].name))return"invalidExtension";e+=s[r].path+"	"+s[r].name+"	"+s[r].size+"	"+s[r].hostId+"	"+s[r].uid+"\n"}}return e}function isInValidExtension(e){var t=e.lastIndexOf(".");if(t==-1)return!0;var n=e.substr(t+1).toLowerCase();if(_.contains(EXCLUDE_EXTENSION,n))return!0}function writeInit(e){isOcxUpload&&ocx_init()}function ocx_file(){var e=document.uploadForm.powerupload;e.AttachFile()}function ocx_init(){var e=document.uploadForm.powerupload;jQuery("#ocx_normal_size").innerHTML=printSize(0),e.SetAttachMaxSize("NORMAL",1048576*MAX_ATTACH_SIZE),e.SetUrlData("UPLOAD",goHostInfo+"/api/webfolder/file/upload"),e.SetUrlData("UPFIELD","theFile")}function deleteOcxFileAll(){var e=document.uploadForm.powerupload,t=e.GetAttachedFileCount();for(var n=0;n<t;n++)e.DetachFile(0)}function ocx_upload(){var e=document.uploadForm.powerupload;return e.SetUploadParam("type","ocx"),e.SetUploadParam("writeFile","true"),e.SetUploadParam("upldtype","upld"),e.SetUploadParam("attfile","true"),e.SetUploadParam("userId","mailadm"),e.SetUploadParam("queryValue","Successful"),e.SetUploadParam("text","text"),e.SetUploadParam("uploadType","power"),e.SetUploadParam("uploadApp","webfolder"),e.SetUploadParam("regdate",today.getTime()),e.UploadFiles()}function deletefileById(e){if(!isOcxUpload){var t=[],n=basicAttachUploadControl.getFileList("huge");if(n)for(var r=0;r<n.length;r++)if(e==n[r].id){t.push(n[r].uid);break}basicAttachUploadControl.deleteAttachList(e),t.length>0&&deleteBigAttachFile(t);var i=basicAttachUploadControl.getAttachQuotaInfo();MAX_QUOTA_SIZE>i.normalUse&&(jQuery("#quotaMax").hide(),jQuery("#webfolderFilePopup .btn_major_s").show()),updateAttachQuota(null,i.normalUse),jQuery("#basicAttachChkAll").attr("checked",!1)}else{var s=document.uploadForm.powerupload;s.DetachFile(-1)}}function ocx_info(){return""}function updateAttachQuota(e,t){jQuery("#basic_normal_size").text(printSize(t)),basicAttachUploadControl.setAttachSize("normalUse",t),MAX_QUOTA_SIZE<t&&(jQuery("#quotaMax").show(),jQuery("#webfolderFilePopup .btn_major_s").hide())}function basic_init(){basicAttachUploadControl.init(),basicAttachUploadControl.makeBtnControl(),basicAttachUploadControl.makeListWebFolderControl(),basicAttachUploadControl.setAttachSize("normalMax",MAX_ATTACH_SIZE*1024*1024),updateAttachQuota(null,0)}function startUploadAttach(){if(!isOcxUpload)if(hasFlashPlayer()){var e=basicAttachUploadControl.getUploadQueueFile();uploadAttachFilesError=!1,uploadAttachFilesComplete=!1;if(!(e.length>0))return jQuery.goMessage(mailMsg.alert_noupload),!1;basicAttachUploadControl.startUpload()}else{var t=getAttachString();if(t=="")return jQuery.goMessage(mailMsg.alert_noupload),!1;if(t=="invalidExtension")return jQuery.goMessage(msgArgsReplace(mailMsg.alert_invalid_extension,[EXCLUDE_EXTENSION])),!1;webfolderControl.fileUpload(t)}else{var n=ocx_upload();if(!n||uploadAttachFilesError){n||(jQuery.goMessage(mailMsg.error_fileupload),deleteOcxFileAll(),ocx_init()),uploadAttachFilesError=!1;return}var r=getAttachString();if(typeof r=="undefined"&&isOcxUpload){setTimeout("resetUploader()",1e3);return}webfolderControl.fileUpload(r)}}function resetUploader(){var e=document.uploadForm.powerupload,t=e.GetAttachedFileCount();if(t&&t>0)for(i=0;i<t;i++)e.DetachFile(0)}function addlist(e,t,n,r,i,s){var o="normal",u,a=parseInt(t);if(o=="normal"){if(isOcxUpload){var f=document.uploadForm.powerupload;u=f.GetAttachedSize("NORMAL")}else u=basicAttachUploadControl.getAttachSize("normalUse");a=u+parseInt(t);if(a>MAX_ATTACH_SIZE*1024*1024)return jQuery.goAlert(mailMsg.comn_upload_title,MAX_ATTACH_SIZE+"MB "+mailMsg.ocx_upalert_size),!1}if(jQuery.browser.msie&&isOcxUpload)try{var f=document.uploadForm.powerupload,l=f.AddAttachedFile(e,t,o);f.SetAttachedFileAttr2(l,"FILEPATH",n),f.SetAttachedFileAttr2(l,"UPKEY",n),f.SetAttachedFileAttr2(l,"FILENAME2",Base64TMS.encode(e)),f.SetAttachedFileAttr2(l,"SIZE",t),f.SetAttachedFileAttr2(l,"HOSTID",i),f.SetAttachedFileAttr2(l,"TYPE",o),f.SetAttachedFileAttr2(l,"RESULT","OK"),jQuery("#ocx_normal_size").html(printSize(a))}catch(c){}else{var h={path:n,size:t,name:e,uid:r,hostId:i,type:o,notChage:!0,id:"SWFUpload_0_a"+makeRandom()};basicAttachUploadControl.addAttachWebfolderList(h),updateAttachQuota(null,a)}return!0}var progressBarOpt={boxImage:"/resources/images/progressbar.gif",barImage:"/resources/images/progressbg_green_50.gif",width:100},MAX_ATTACH_SIZE,MAX_QUOTA_SIZE,EXCLUDE_EXTENSION,today=new Date(1234227867105),expiredate=new Date(today.getTime()+6048e5),quotausage=0,userquota=0,uploadAttachFilesError=!1,uploadAttachFilesComplete=!1,basicUploadListeners={swfuploadLoaded:function(e){},fileQueued:function(e,t){var n=t.size,r=basicAttachUploadControl.getAttachQuotaInfo();if(n>r.normalMax){jQuery.goMessage(msgArgsReplace(mailMsg.error_upload_over,[MAX_ATTACH_SIZE])),jQuery("#basicUploadControl").swfupload("cancelUpload",t.id);return}jQuery("#basicUploadControl").swfupload("addFileParam",t.id,"attachtype","normal"),updateAttachQuota(null,n+r.normalUse),basicAttachUploadControl.addAttachWebfolderList(t),basicAttachUploadControl.addUploadQueueFile(t)},fileQueueError:function(e,t,n,r){n=="-120"?jQuery.goMessage(mailMsg.ocx_virtxt_failquest):jQuery.goMessage(mailMsg.error_fileupload+"["+n+"]")},fileDialogStart:function(e){},fileDialogComplete:function(e,t,n){},uploadStart:function(e,t){jQuery("#progress_"+t.id).progressBar(0,progressBarOpt)},uploadProgress:function(e,t,n){var r=t.size,i=Math.ceil(n/r*100);i=i>=100?100:i,jQuery("#progress_"+t.id).hide(),jQuery("#progress_"+t.id).progressBar(i,progressBarOpt),jQuery("#progress_"+t.id).show(),i==100&&jQuery("#progress_"+t.id).html("<img src=''>")},uploadSuccess:function(event,file,serverData){var data=eval("("+serverData+")");data.uploadResult=="success"&&parseInt(data.uid,10)>-1?(basicAttachUploadControl.setUploadCompleteFile(file.id,data),jQuery("#progress_"+file.id).html('<span class="ic state_complete"></span>')):(uploadAttachFilesError||jQuery.goAlert("",mailMsg.error_fileupload),jQuery("#"+file.id).attr("checked",!0),deletefile())},uploadComplete:function(e,t){if(!basicAttachUploadControl.isNextUploadQueue(t.id)){uploadAttachFilesComplete=!0;var n=getAttachString();webfolderControl.fileUpload(n)}},uploadError:function(e,t,n,r){n!=SWFUpload.UPLOAD_ERROR.FILE_CANCELLED&&(jQuery("#attachUploadProgress").jQpopup("close"),uploadAttachFilesError||(jQuery.goMessage(mailMsg.error_fileupload),basic_init(),uploadAttachFilesError=!0))}};