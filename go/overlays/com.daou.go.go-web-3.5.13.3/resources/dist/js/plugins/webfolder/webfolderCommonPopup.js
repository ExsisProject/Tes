var webfolderPopupControl,WebfolderPopupControl=function(){this.listFolderDataAction="/api/webfolder/folder/tree",this.viewFolderAction="/api/webfolder/folder/list",this.listParam={},this.attachSizeMax,this.currentPage,this.pageCount,this.loader,this.quotaInfo,this.groupSelect,this.currentFolder,this.auth,this.sharedUserList,this.sharedFolderUid,this.type;var e=this;this.loadWebfolderList=function(){ActionLoader.getGoLoadAction(e.listFolderDataAction,{type:"user"},e.printWebfolderList,"json")},this.loadShareWebfolderList=function(){ActionLoader.getGoLoadAction(e.listFolderDataAction,{type:"share"},e.printShareWebfolderList,"json")},this.loadPublicWebfolderList=function(){ActionLoader.getGoLoadAction(e.listFolderDataAction,{type:"public"},e.printPublicWebfolderList,"json")},this.printWebfolderList=function(e){jQuery("#webFolderList").handlebars("webfoler_left_tmpl",e)},this.printPublicWebfolderList=function(e){jQuery("#publicWebFolderList").handlebars("webfoler_left_tmpl",e)},this.printShareWebfolderList=function(e){jQuery("#webShareFolderList").handlebars("webfoler_share_left_tmpl",e)},this.loadViewWebFolder=function(t){t||(t={path:"/",fullPath:"/"}),e.listParam=t,ActionLoader.getGoLoadAction(e.viewFolderAction,t,e.printViewfolder,"json")},this.titleOn=function(e){if(!e.isRoot||e.type!="user"){jQuery("#webfolderLeft p").removeClass("on");var t=e.type+replaceAll(e.realPath,".","-");jQuery(document.getElementById(t)).addClass("on")}else jQuery("#webfolderLeft p").removeClass("on")},this.printViewfolder=function(t){e.currentFolder=t.path,e.type=t.type,e.titleOn(t),jQuery("#viewFolder").handlebars("webfoler_view_popup_tmpl",t),jQuery("#viewFolderBody").append(getHandlebarsTemplate("webfoler_view_popup_page_tmpl",t)),e.movePage(t)},this.movePage=function(t){e.currentPage=t.currentPage,e.pageCount=t.pageCount;for(var n=1;n<e.pageCount;n++){var r=e.listParam;e.currentPage=e.currentPage+1,r.currentPage=e.currentPage,ActionLoader.getGoLoadAction(e.viewFolderAction,r,e.printWebfolderListPage,"json")}},this.printWebfolderListPage=function(e){jQuery("#viewFolderBody").append(getHandlebarsTemplate("webfoler_view_popup_page_tmpl",e)),jQuery("#memberListFooter").waypoint({offset:"100%"}),jQuery.waypoints("refresh")},this.makeLeftEvent=function(){jQuery("#webfolderLeft").on("click","a,span",function(e){e.preventDefault();var t=jQuery(this).attr("evt-rol");if(t=="viewFolderLeft"){var n={},r=jQuery(this).attr("real-path"),t=jQuery(this).attr("type");if(t=="share"){var i=jQuery(this).attr("user-seq"),s=jQuery(this).attr("sroot");n.sroot=s,n.userSeq=i}n.fullPath=r,n.type=t,goFolder(n)}else t=="toggleFolder"&&toggleWebfolderList(jQuery(this).attr("type"))})},this.makeContentEvent=function(){jQuery("#webFolderContent").on("click","a,span",function(t){t.preventDefault();var n=jQuery(this).attr("evt-rol");if(n=="viewFolder"){var r={},i=jQuery(this).parent().parent().attr("real-path"),s=jQuery(this).parent().parent().attr("node-number"),n=jQuery(this).parent().parent().attr("type");if(n=="share"){var o=jQuery(this).parent().parent().attr("user-seq"),u=jQuery(this).parent().parent().attr("sroot");r.sroot=u,r.userSeq=o}r.fullPath=i,r.nodeNum=s,r.type=n,goFolder(r)}else if(n=="preFolder"){var a=jQuery(this).attr("ppath"),f=jQuery(this).attr("node-num"),n=jQuery(this).attr("type"),r={};f.length>1&&(f=f.substr(0,f.lastIndexOf("|")),f=f.substr(0,f.lastIndexOf("|")+1));if(n=="share"){var o=jQuery(this).attr("user-seq"),u=jQuery(this).attr("sroot");r.sroot=u,r.userSeq=o}r.fullPath=a,r.nodeNum=f,r.type=n,goFolder(r)}else if(n=="sortFolderList"){var l=jQuery(this).attr("sort-data"),r=e.listParam;r.sortby=l;var c=jQuery(this).parent().attr("class"),h;c.indexOf("asc")>-1?h="desc":h="asc",r.sortDir=h,goFolder(r)}else if(n=="movePage"){var p=jQuery(this).attr("page");e.listParam.currentPage=p,goFolder(e.listParam)}}),jQuery("#webFolderContent").on("click","input ",function(t){var n=jQuery(this).attr("evt-rol");if(n=="list-select-all"){var r=jQuery(this).attr("checked"),i=jQuery("#viewFolder input:checkbox");r?i.attr("checked",!0):i.attr("checked",!1);var s=jQuery("#viewFolder input:checkbox:checked").map(function(){var e=jQuery(this).parent().parent().attr("fid");if(!e)return;return e}).get(),o=jQuery("#viewFolder input:checkbox:checked").map(function(){var e=jQuery(this).parent().parent().attr("uid");if(!e)return;return e}).get();jQuery("#toolbar a").each(function(){var e=jQuery(this).attr("evt-rol");if(e=="createFolderView")return;jQuery(this).addClass("disable")}),s.length>0&&o.length==0?jQuery("#toolbar a").each(function(){var t=jQuery(this).attr("evt-rol");e.auth=="W"&&(t=="removeFolder"||t=="copyFolder"||t=="moveFolder")&&jQuery(this).removeClass("disable"),t=="copyFolder"&&jQuery(this).removeClass("disable")}):s.length==0&&o.length>0?jQuery("#toolbar a").each(function(){var t=jQuery(this).attr("evt-rol");e.auth=="W"&&(t=="removeFolder"||t=="moveFolder")&&jQuery(this).removeClass("disable"),(t=="downloadFolderList"||t=="sendMail"||t=="copyFolder")&&jQuery(this).removeClass("disable")}):s.length>0&&o.length>0&&jQuery("#toolbar a").each(function(){var t=jQuery(this).attr("evt-rol");e.auth=="W"&&(t=="removeFolder"||t=="copyFolder"||t=="moveFolder")&&jQuery(this).removeClass("disable"),t=="copyFolder"&&jQuery(this).removeClass("disable")})}else if(n=="list-select"){var s=jQuery("#viewFolder input:checkbox:checked").map(function(){var e=jQuery(this).parent().parent().attr("fid");if(!e)return;return e}).get(),o=jQuery("#viewFolder input:checkbox:checked").map(function(){var e=jQuery(this).parent().parent().attr("uid");if(!e)return;return e}).get();jQuery("#toolbar a").each(function(){var e=jQuery(this).attr("evt-rol");if(e=="createFolderView")return;jQuery(this).addClass("disable")}),s.length>0&&o.length==0?jQuery("#toolbar a").each(function(){var t=jQuery(this).attr("evt-rol");e.auth=="W"&&(t=="removeFolder"||t=="copyFolder"||t=="moveFolder")&&jQuery(this).removeClass("disable"),t=="copyFolder"&&jQuery(this).removeClass("disable")}):s.length==0&&o.length>0?jQuery("#toolbar a").each(function(){var t=jQuery(this).attr("evt-rol");e.auth=="W"&&(t=="removeFolder"||t=="moveFolder")&&jQuery(this).removeClass("disable"),(t=="downloadFolderList"||t=="sendMail"||t=="copyFolder")&&jQuery(this).removeClass("disable")}):s.length>0&&o.length>0&&jQuery("#toolbar a").each(function(){var t=jQuery(this).attr("evt-rol");e.auth=="W"&&(t=="removeFolder"||t=="copyFolder"||t=="moveFolder")&&jQuery(this).removeClass("disable"),t=="copyFolder"&&jQuery(this).removeClass("disable")})}})}};