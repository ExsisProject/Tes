function searchGoUser(){if(!validateInputValue(jQuery("#webfolderSharePopup .search"),1,60,"onlyBack"))return;var e={page:"0",offset:"30",keyword:jQuery("#webfolderSharePopup .search").val()};jQuery.ajax({url:webfolderControl.searchUserAction,type:"get",contentType:"application/json",data:e}).done(function(e){var t=getSearchUserList(e),n=0;while(n<t.length)t[n].nodeType=="department"?t.splice(n,1):n++;if(t&&t.length){var r=getHandlebarsTemplate("webfolder_shared_user_search_result_tmpl",t);jQuery("#webfolderSharePopup #searchUserList").html(r)}else jQuery("#webfolderSharePopup #searchUserList").html("<li>"+mailMsg.webfolder_nosearch+"</li>")})}function getSearchUserList(e){if(!e.data||!e.data.length)return!1;var t=[];for(var n=0;n<e.data.length;n++)e.data[n].nodeType!=="Department"&&t.push(e.data[n]);return t}function getPopupData(){return POPUPDATA}var webfolderControl,historyControl,currentMenu,isOcxUploadDownModule=!1,isOcxUpload=!1,POPUPDATA={},basicAttachUploadControl,WebfolderControl=function(){this.listFolderDataAction="/api/webfolder/folder/tree",this.viewFolderAction="/api/webfolder/folder/list",this.createFolderAction="/api/webfolder/folder/create",this.renameFolderAction="/api/webfolder/folder/rename",this.deleteFolderAction="/api/webfolder/folder/delete",this.copyAndMoveFolderAction="/api/webfolder/folder/copymove",this.uploadFileAction="/api/webfolder/file/create",this.searchUserAction="/api/user/sort/list",this.sharedFolderAction="/api/webfolder/folder/share",this.isMailAttachSearchAction="/api/system/mailattachsearch",this.downloadFileAction="/api/webfolder/file/download",this.listParam={},this.attachSizeMax,this.currentPage,this.pageCount,this.loader,this.quotaInfo,this.groupSelect,this.currentFolder,this.auth,this.sharedUserList,this.sharedFolderUid,this.type,this.ESC_KEY=27,this.ENTER_KEY=13;var e=this;this.loadWebfolderList=function(){ActionLoader.getSyncGoLoadAction(e.listFolderDataAction,{type:"user"},function(t){e.printWebfolderList(t)},"json")},this.loadShareWebfolderList=function(){ActionLoader.getSyncGoLoadAction(e.listFolderDataAction,{type:"share"},function(t){e.printShareWebfolderList(t)},"json")},this.loadPublicWebfolderList=function(){ActionLoader.getSyncGoLoadAction(e.listFolderDataAction,{type:"public"},function(t){e.printPublicWebfolderList(t)},"json")},this.printHeaderTitle=function(e){e.useOrg=useOrg,jQuery("#headerTitle").handlebars("webfoler_header_title_tmpl",e)},this.makeNavigation=function(e){jQuery("#webfolderListFooter").html(""),e.pageInfo.out=!0,e.total>e.pageBase&&jQuery("#webfolderListFooter").handlebars("webfolder_navi_tmpl",e)},this.printWebfolderList=function(t){t.resultType=="removeFolder"?e.groupSelect=getHandlebarsTemplate("webfoler_select_folder_popup_tmpl",t):(e.groupSelect=getHandlebarsTemplate("webfoler_select_folder_popup_tmpl",t),jQuery("#webFolderList").handlebars("webfoler_left_tmpl",t),jQuery("#webFolderList").find("ul").hide())},this.printPublicWebfolderList=function(t){t.resultType=="removeFolder"?e.groupSelect+=getHandlebarsTemplate("webfoler_select_folder_popup_tmpl",t):(e.groupSelect+=getHandlebarsTemplate("webfoler_select_folder_popup_tmpl",t),jQuery("#publicWebFolderList").handlebars("webfoler_left_tmpl",t),jQuery("#publicWebFolderList").find("ul").hide())},this.printShareWebfolderList=function(t){t.resultType=="removeFolder"?t.webfolder!=null&&(e.groupSelect+=getHandlebarsTemplate("webfoler_select_folder_share_popup_tmpl",t)):(t.webfolder!=null&&(e.groupSelect+=getHandlebarsTemplate("webfoler_select_folder_share_popup_tmpl",t)),jQuery("#webShareFolderList").handlebars("webfoler_share_left_tmpl",t),jQuery("#webShareFolderList").find("ul").hide())},this.loadViewWebFolder=function(t){function i(e){var t=jQuery("#totalDownload"),n=jQuery("#currentDownload");t.removeAttr("fullPath path sroot type userSeq sharedUserSeq"),n.removeAttr("fullPath path sroot type userSeq sharedUserSeq"),t.attr("fullPath",e.fullPath),t.attr("path",e.path),t.attr("sroot",e.sroot),t.attr("type",e.type),t.attr("userSeq",e.userSeq),t.attr("sharedUserSeq",e.userSeq),n.attr("fullPath",e.fullPath),n.attr("path",e.path),n.attr("sroot",e.sroot),n.attr("type",e.type),n.attr("userSeq",e.userSeq),n.attr("sharedUserSeq",e.userSeq)}if(!t){var n=jQuery("#webfolder_list_offset option:selected").val();t={path:"/",fullPath:"/",currentPage:"1",offset:n}}i(t),e.listParam=t;var r=jQuery("#searchType").val();r==="appSearch"&&(ActionLoader.getGoLoadAction(e.viewFolderAction,e.listParam,e.printViewfolder,"json"),google.sendPageView(e.viewFolderAction)),r==="totalSearch"&&(window.top.window.location="/app/"+(isMsie8?"#":"")+"unified/search?stype=simple&searchTerm=all&offset=5&page=0&keyword="+encodeURIComponent(t.keyWord),jQuery("#searchType").val("appSearch"),jQuery("#webfolderInput").val(""))},this.printPage=function(e){jQuery("#webfolderPaging").handlebars("webfoler_tail_paging_tmpl",e)},this.titleOn=function(e){if(!e.isRoot||e.type!="user"){jQuery("#webfolderLeft p").removeClass("on");var t=e.type+replaceAll(e.realPath,".","-");jQuery(document.getElementById(t)).addClass("on")}else jQuery("#webfolderLeft p").removeClass("on")},this.setSharedUserInfo=function(t){t.sharedUserCount&&t.sharedUserCount>0?(e.sharedUserList=t.sharedUserList,e.sharedFolderUid=t.fid):e.sharedUserList="",e.sharedUserSeq=t.userSeq},this.authCheck=function(t){e.auth=t.folderAuth;var n=jQuery("#toolbar a");e.auth=="W"&&(n.removeClass("disable"),n.each(function(){jQuery(this).show()})),e.auth==="R"&&(t.type==="share"||t.type==="public")&&e.showDefaultMenus()},this.printViewfolder=function(t){e.titleOn(t),e.setSharedUserInfo(t),e.currentFolder=t.path,e.quotaInfoTitle(t),e.printHeaderTitle(t),e.makeNavigation(t),e.attachSizeMax=t.attachMaxSize,e.authCheck(t),e.type=t.type,t.useOrg=useOrg,e.printWebfolderListPage(t),EXCLUDE_EXTENSION=t.excludeExtension},this.movePage=function(t){var n=jQuery("#webfolder_list_offset option:selected").val(),r=e.listParam;r.offset=n,e.currentPage=t,r.currentPage=e.currentPage,ActionLoader.getGoLoadAction(e.viewFolderAction,r,function(t){e.makeNavigation(t),e.printWebfolderListPage(t)},"json")},this.printWebfolderListPage=function(e){jQuery("#viewFolder").handlebars("webfoler_view_tmpl",e)},this.quotaInfoTitle=function(t){e.quotaInfo=t.quotaInfo,MAX_QUOTA_SIZE=t.quotaInfo.max,t.quotaUsagePercent>100&&(t.quotaUsagePercent=100),jQuery("#quotaInfo").handlebars("webfoler_left_quot_tmpl",t)},this.getQuotaInfo=function(t){e.quotaInfo=t.quotaInfo,jQuery("#webfolderFilePopup #quotaWrap").html(getHandlebarsTemplate("webfolder_file_popup_tmpl",e.quotaInfo))},this.createFolder=function(t){ActionLoader.postGoJsonLoadAction(e.createFolderAction,t,function(t){jQuery.goSlideMessage(mailMsg.webfolder_create_info),e.successResult(),jQuery("#createFolderWrap").hide(),jQuery("#folderNameError").hide(),jQuery("#fNameInput").val("")},"json",function(e){jQuery("#folderNameError").show()})},this.editFolder=function(t){ActionLoader.postSyncGoJsonLoadAction(e.renameFolderAction,t,function(t){jQuery.goSlideMessage(mailMsg.save_ok),e.successResult()},"json",function(t){e.failResult(t)})},this.removeFolder=function(t){ActionLoader.postSyncGoJsonLoadAction(e.deleteFolderAction,t,function(t){jQuery.goSlideMessage(mailMsg.del_ok),e.successResult("removeFolder")},"json",function(t){e.failResult(t)})},this.successResult=function(t){t==="removeFolder"?(e.loadWebfolderList("removeFolder"),e.loadShareWebfolderList("removeFolder"),e.loadPublicWebfolderList("removeFolder")):(e.loadWebfolderList(),e.loadShareWebfolderList(),e.loadPublicWebfolderList()),e.listParam&&(e.listParam.currentPage=1),e.loadViewWebFolder(e.listParam)},this.failResult=function(e){var t=mailMsg.webfolder_move_and_copy_fail_title;e.message&&(t=e.message),jQuery.goSlideMessage(t,"caution")},this.isMailAttachSearch=function(){var e=!1;return ActionLoader.getSyncGoLoadAction(this.isMailAttachSearchAction,null,function(t){e=t},"json"),e},this.uploadResult=function(t){jQuery.goSlideMessage(mailMsg.webfolder_create_info),removeProcessLoader(),e.loadWebfolderList(),e.loadShareWebfolderList(),e.loadPublicWebfolderList(),e.listParam&&(e.listParam.currentPage=1),e.loadViewWebFolder(e.listParam)},this.fileUpload=function(t){var n={},r=jQuery("#selectFolderListAll :selected"),i=r.attr("type"),s=r.attr("sroot"),o=r.attr("user-seq"),u=r.attr("real-path");o&&(n.sharedUserSeq=o),s&&(n.sroot=s),n.type=i,n.path=u,n.attachList=t,basicAttachUploadControl&&(basicAttachUploadControl.stopUpload(),basicAttachUploadControl.cancelUpload(),basicAttachUploadControl.destroy()),isOcxUploadDownModule&&(deleteOcxFileAll(),isOcxUploadDownModule=!1),jQuery("#webfolderFilePopup").off("click","a,span"),jQuery("#webfolderFilePopup").remove(),makeProcessLoader(),ActionLoader.postGoJsonLoadAction(e.uploadFileAction,n,e.uploadResult,"json",function(e){removeProcessLoader(),jQuery.goSlideMessage(e.message,"caution")}),google.sendPageView(e.uploadFileAction)},this.makeLeftEvent=function(){jQuery("#webfolderLeft").on("click","a,span",function(t){t.preventDefault();var n=jQuery(this).attr("evt-rol");if(n=="webfolder-home")window.top.window.location="/app/webfolder";else if(n=="viewFolderLeft"){var r={},i=jQuery(this).attr("real-path"),s=jQuery(this).attr("type");jQuery("#createFolderWrap").hide();if(s=="share"){var o=jQuery(this).attr("user-seq"),u=jQuery(this).attr("sroot");r.sroot=u,r.userSeq=o}r.fullPath=i,r.type=s,goFolder(r)}else if(n=="toggleFolder")toggleWebfolderList(jQuery(this).attr("type"));else if(n=="uploadFileView"){var a=e.quotaInfo.max;if(a<=0){jQuery.goAlert(mailMsg.error_fullquota);return}jQuery("body").append(getHandlebarsTemplate("file_upload")),jQuery("#webfolderFilePopup #quotaWrap").html(getHandlebarsTemplate("webfolder_file_popup_tmpl",e.quotaInfo)),jQuery("#webfolderFilePopup #selectFolderListAll").append(e.groupSelect);var f=e.listParam.type?e.listParam.type:"user",l=e.listParam.fullPath,c=!1;jQuery("#selectFolderListAll ."+f).each(function(){var e=jQuery(this).attr("real-path");l==e&&(jQuery(this).attr("selected",!0),c=!0)}),jQuery("#webfolderFilePopup #selectFolderListAll").change(function(){var t={};t.type=jQuery(this).children("option:selected").attr("type"),t.fullPath=jQuery(this).children("option:selected").attr("real-path"),t.sroot=jQuery(this).children("option:selected").attr("sroot"),t.userSeq=jQuery(this).children("option:selected").attr("user-seq"),ActionLoader.getGoLoadAction(e.viewFolderAction,t,e.getQuotaInfo,"json")}),c||jQuery("#selectFolderListAll ."+f+":eq(0)").attr("selected",!0),MAX_ATTACH_SIZE=e.attachSizeMax;var h={controlType:"normal",btnId:"basicUploadControl",btnCid:"basicUploadBtn",formName:"theFile",param:{uploadApp:"webfolder",uploadType:"flash",email:USEREMAIL},url:"/api/webfolder/file/upload",maxFileSize:e.attachSizeMax*1024*1024,fileType:"*.*",locale:LOCALE,btnText:mailMsg.button_upload,debug:!1,autoStart:!1,handler:basicUploadListeners,listId:"basicUploadAttachList",startUploadFunc:startUploadAttach,webfolder:!0,width:LOCALE=="jp"?80:73,btnStyle:".buttonText { color:#656565;font-size:12px;}"};hasFlashPlayer()?basicAttachUploadControl=new UploadBasicControl(h):basicAttachUploadControl=new UploadSimpleBasicControl(h),isMsie&&!isMsie9&&jQuery("#chgAttachModeWrap").show(),isMsie9?chgAttachMod("ocx"):chgAttachMod("simple"),jQuery("#webfolderFilePopup").on("click","a,span",function(e){var t=jQuery(this).attr("evt-rol");if(t=="selectSendFile"){t==null;return}e.preventDefault();if(t=="removeAttachFileList")deletefile();else if(t=="closeUploadFileWrap")basicAttachUploadControl&&(basicAttachUploadControl.stopUpload(),basicAttachUploadControl.cancelUpload(),basicAttachUploadControl.destroy()),jQuery("#webfolderFilePopup").off("click","a,span"),removeProcessLoader(),isOcxUploadDownModule&&(deleteOcxFileAll(),isOcxUploadDownModule=!1),jQuery("#webfolderFilePopup").remove();else if(t=="sendFile"){var n=jQuery("#selectFolderListAll :selected");if(!n.attr("real-path")){jQuery.goAlert(mailMsg.alert_notargetfolder);return}if(n.attr("auth")=="R"){jQuery.goAlert(mailMsg.no_right_folder_message);return}if(!startUploadAttach())return;jQuery("#webfolderFilePopup .btn_major_s .txt").text(mailMsg.file_upload_send_progress_title)}}),makeProcessLoader("mask"),jQuery("#webfolderFilePopup").draggable()}else if(n=="toggle-webfolder"){var p=jQuery(this).attr("status"),d=jQuery(this).closest("li").attr("depth");d=parseInt(d,10);var v=jQuery(this).closest("li").find("ul[depth='"+(d+1)+"']");p=="open"?(v.hide(),jQuery(this).removeClass("close").addClass("open").attr({status:"close",title:mailMsg.comn_open})):(v.show(),jQuery(this).removeClass("open").addClass("close").attr({status:"open",title:mailMsg.comn_close}))}})},this.makeContentEvent=function(){function t(t){jQuery.fileDownload(e.downloadFileAction,{httpMethod:"GET",data:t,prepareCallback:function(){makeProcessLoader()},successCallback:function(){removeProcessLoader()},failCallback:function(){removeProcessLoader()}})}var n=jQuery("#webFolderContent");n.on("change","#webfolder_list_offset",function(t){e.listParam.offset=jQuery("#webfolder_list_offset option:selected").val(),e.listParam.currentPage=1,ActionLoader.getGoLoadAction(e.viewFolderAction,e.listParam,e.printViewfolder,"json")}),n.on("click","#pageNaviWrap a",function(t){var n=jQuery(t.target).attr("page");e.movePage(n)}),n.on("click","a,span,li",function(n){var r=jQuery(this).attr("evt-rol");if(r===undefined||!r)return;n.stopPropagation?n.stopPropagation():n.cancelBubble=!0,n.preventDefault();if(r=="downloadFile"){var i={uids:[jQuery(this).closest("tr").attr("uid")],type:jQuery(this).closest("tr").attr("type"),path:jQuery(this).closest("tr").attr("path"),sroot:jQuery(this).closest("tr").attr("sroot"),sharedUserSeq:jQuery(this).closest("tr").attr("userSeq")};t(i),google.sendPageView(e.downloadFileAction)}else if(r=="previewFile"){var s={};s.uid=jQuery(this).closest("tr").attr("uid"),s.type=jQuery(this).closest("tr").attr("type"),s.path=jQuery(this).closest("tr").attr("path"),s.sroot=jQuery(this).closest("tr").attr("sroot"),s.sharedUserSeq=jQuery(this).closest("tr").attr("userSeq"),previewFile(s)}else if(r=="viewFolder"){var s={},o=jQuery(this).parent().parent().attr("type");o=="share"&&(s.sroot=jQuery(this).parent().parent().attr("sroot"),s.userSeq=jQuery(this).parent().parent().attr("user-seq")),s.fullPath=jQuery(this).parent().parent().attr("real-path"),s.nodeNum=jQuery(this).parent().parent().attr("node-number"),s.type=o,s.offset=jQuery("#webfolder_list_offset option:selected").val(),goFolder(s)}else if(r=="preFolder"){var u=jQuery(this).attr("node-num");u.length>1&&(u=u.substr(0,u.lastIndexOf("|")),u=u.substr(0,u.lastIndexOf("|")+1));var s={};s.type=jQuery(this).attr("type"),s.type=="share"&&(s.sroot=jQuery(this).attr("sroot"),s.userSeq=jQuery(this).attr("user-seq")),s.fullPath=jQuery(this).attr("ppath"),s.nodeNum=jQuery(this).attr("node-num"),s.offset=jQuery("#webfolder_list_offset option:selected").val(),goFolder(s)}else if(r=="createFolderView"){if(jQuery(this).hasClass("disable"))return;jQuery("#createFolderWrap").show()}else if(r=="cancelCreateFolder")jQuery("#createFolderWrap").hide(),jQuery("#folderNameError").hide(),jQuery("#fNameInput").val("");else if(r=="createFolder"){var s=clone(e.listParam),a=s.fullPath.split(".");if(a.length>=6){jQuery.goMessage(mailMsg.alert_maxdepth);return}if(!validateInputValue(jQuery("#fNameInput"),2,32,"folderName"))return;s.path=s.fullPath,s.folderName=jQuery("#fNameInput").val(),e.createFolder(s)}else if(r=="editFolderView"){var f=jQuery(this).prev().text(),l={folderName:f};jQuery(this).parent().html(getHandlebarsTemplate("webfoler_edit_folder_tmpl",l)),jQuery("#rfName").keydown(function(t){t.which==e.ENTER_KEY&&(e.editFolderInput(jQuery(this)),t.preventDefault()),t.which==e.ESC_KEY&&(e.editFolderCancel(jQuery(this)),t.preventDefault())})}else if(r==="editFolder")e.editFolderInput(jQuery(this));else if(r==="editFolderViewCancel")e.editFolderCancel(jQuery(this));else if(r==="removeFolder"){if(jQuery(this).hasClass("disable"))return;var s=e.listParam,c,h,p,d=jQuery("#viewFolder input:checkbox:checked").map(function(){var e=jQuery(this).parent().parent().attr("fid");if(!e)return;return e}).get();jQuery("#viewFolder input:checkbox:checked").each(function(){jQuery(this).parent().parent().attr("isChild")=="true"&&(c=!0),jQuery(this).parent().parent().attr("isShare")=="true"&&(h=!0)});if(c){jQuery.goMessage(mailMsg.share_alert_003);return}if(h){jQuery.goMessage(mailMsg.share_alert_004);return}var v=jQuery("#viewFolder input:checkbox:checked").map(function(){var e=jQuery(this).parent().parent().attr("uid");if(!e)return;return e}).get();if(d.length==0&&v.length==0){jQuery.goMessage(mailMsg.no_select);return}s.fids=d,s.uids=v,jQuery.goConfirm(mailMsg.webfolder_delete,mailMsg.alert_remove,function(){e.removeFolder(s),jQuery(".title.on").parent().find("li p a[title="+d+"]").parent().parent().parent().remove(),jQuery(".title.on").parent().find("ul").length==0&&jQuery(".title.on span.close").remove()})}else if(r=="copyFolder"){if(jQuery(this).hasClass("disable"))return;var m=jQuery("#viewFolder input:checkbox:checked"),g=_.any(m,function(e){return jQuery(e).parent().attr("type")=="share"});if(g){jQuery.goMessage(mailMsg.webfolder_no_action_info);return}var s={},d=jQuery("#viewFolder input:checkbox:checked").map(function(){var e=jQuery(this).parent().parent().attr("fid");if(!e)return;return e}).get(),v=jQuery("#viewFolder input:checkbox:checked").map(function(){var e=jQuery(this).parent().parent().attr("uid");if(!e)return;return e}).get();if(d.length==0&&v.length==0){jQuery.goMessage(mailMsg.no_select);return}e.showSelectFolderPopup("copy")}else if(r=="moveFolder"){if(jQuery(this).hasClass("disable"))return;var y=jQuery("#viewFolder input:checkbox:checked");if(w(y,"isChild","true")){jQuery.goMessage(mailMsg.share_alert_003);return}if(w(y,"isShare","true")){jQuery.goMessage(mailMsg.share_alert_004);return}if(w(y,"type","share")){jQuery.goMessage(mailMsg.webfolder_no_action_info);return}var d=y.map(function(){var e=jQuery(this).parent().parent().attr("fid");if(!e)return;return e}).get(),v=y.map(function(){var e=jQuery(this).parent().parent().attr("uid");if(!e)return;return e}).get();if(b(d,v)){jQuery.goMessage(mailMsg.no_select);return}e.showSelectFolderPopup("move");function b(e,t){return e.length==0&&t.length==0}function w(e,t,n){return _.any(e,function(e){return jQuery(e).parent().attr(t)===n})}}else if(r=="sendMail"){if(jQuery(this).hasClass("disable"))return;var d=jQuery("#viewFolder input:checkbox:checked").map(function(){var e=jQuery(this).parent().parent().attr("fid");if(!e)return;return e}).get(),v=jQuery("#viewFolder input:checkbox:checked").map(function(){var e=jQuery(this).parent().parent().attr("uid");if(!e)return;return e+"|"}).get().join("");if(d.length==0&&v.length==0){jQuery.goMessage(mailMsg.no_select);return}if(d.length>0&&v.length>=0){jQuery.goMessage(mailMsg.not_only_select_file);return}var s={};s.wtype="webfolder",s.folder=e.currentFolder,s.wfolderType=e.type,s.wuid=v,s.wfolderShareSeq=e.sharedUserSeq||0,s.work="write";var E={dataType:"sendMailForWebfolder"},S=BASEURL+"app/mail/popup/process?"+jQuery.param(s)+"&data="+encodeURIComponent(JSON.stringify(E));window.open(S,"webfolderWrite","scrollbars=yes,resizable=yes,width=1280,height=790")}else if(r=="sortFolderList"){var s=e.listParam;s.currentPage!=1&&(s.currentPage=1),s.sortby=jQuery(this).attr("sort-data");var x=jQuery(this).parent().attr("class");s.sortDir=x.indexOf("asc")>-1?"desc":"asc",goFolder(s)}else if(r=="downloadFolderList"){if(jQuery(this).hasClass("disable"))return;var y=jQuery("#viewFolder input:checkbox:checked");_.forEach(y,function(t){var n=jQuery(t);if(_.isUndefined(n.attr("folder-type")))return;var r={};r.fullPath=n.attr("real-path"),r.path=r.fullPath.substring(14),r.type=n.attr("folder-type"),r.nodeNum=n.attr("nodeNum"),ActionLoader.getGoLoadAction(e.viewFolderAction,r,e.downloadFolders,"json")});var v=y.map(function(){var e=jQuery(this).parent().parent().attr("uid");if(!e)return;return e}).get(),T={uids:v,type:jQuery(this).attr("type")||e.listParam.type||"user",path:jQuery(this).attr("path")||e.listParam.path||"/",sroot:e.listParam.sroot||"",sharedUserSeq:e.listParam.userSeq||0};t(T),google.sendPageView(e.downloadFileAction)}else if(r=="movePage")e.listParam.currentPage=jQuery(this).attr("page"),goFolder(e.listParam);else if(r=="showShareFolderList"){var s={};s.fullPath=jQuery(this).parent().parent().attr("real-path"),s.nodeNum=jQuery(this).parent().parent().attr("node-number"),s.type=jQuery(this).parent().parent().attr("type"),s.fullPath&&(s.path=s.fullPath.substring(14)),ActionLoader.getGoLoadAction(e.viewFolderAction,s,e.setSharedValue,"json")}else if(r==="listDownload")jQuery("#list_download").toggle("fast");else if(r==="currentDownload"){jQuery("#list_download").toggle("fast");var N=jQuery("input[evt-rol='list-select']"),C=jQuery(this),E={},a=_.map(N,function(e){var t=jQuery(e);if(_.isUndefined(t.attr("folder-type")))return;var n={};return n.fullPath=t.attr("real-path"),n.path=n.fullPath.substring(14),n.type=t.attr("folder-type"),n.nodeNum=t.attr("nodeNum"),n});E.folders=_.filter(a,function(e){return!_.isUndefined(e)});var v=_.map(N,function(e){var t=jQuery(e),n=t.parent().parent().attr("uid");if(!n)return;return{id:n}});v=_.filter(v,function(e){return!_.isUndefined(e)}),E.messages=v,E.type=C.attr("type"),E.fullpath=C.attr("fullpath"),E.path=C.attr("path"),E.sroot=C.attr("sroot"),E.useseq=C.attr("userseq"),E.sharedUserSeq=C.attr("sharedUserSeq"),e.downloadFolders(E)}else if(r==="totalDownload"){jQuery("#list_download").toggle("fast"),s={path:"/",fullPath:"/",currentPage:"1",offset:"99999"};var k=jQuery("#totalDownload");s.fullpath=k.attr("fullPath"),s.path=k.attr("path"),s.sroot=k.attr("sroot"),s.type=k.attr("type"),s.userSeq=k.attr("userSeq"),s.sharedUserSeq=k.attr("sharedUserSeq"),ActionLoader.getGoLoadAction(e.viewFolderAction,s,e.downloadFolders,"json")}}),n.on("click","input",function(t){var n=jQuery(this).attr("evt-rol");if(n=="list-select-all"){var r=jQuery(this).attr("checked"),i=jQuery("#viewFolder input:checkbox");r?i.attr("checked",!0):i.attr("checked",!1)}jQuery("#toolbar a").each(function(){var e=jQuery(this).attr("evt-rol");if(e=="createFolderView")return;jQuery(this).removeClass("disable"),jQuery(this).hide()}),e.showDefaultMenus()}),jQuery("#headerTitle").on("click","a[evt-rol='showShareFolderList']",function(t){t.preventDefault();var n={},r=jQuery(this).attr("real-path"),i=jQuery(this).parent().parent().attr("type");n.fullPath=r,n.type=i,n.fullPath&&(n.path=n.fullPath.substring(14)),ActionLoader.getGoLoadAction(e.viewFolderAction,n,e.setSharedValue,"json")}),jQuery("#createFolderWrap").on("keypress","input[evt-rol='fNameInput']",function(t){var n=jQuery("#fNameInput");t.keyCode===e.ESC_KEY&&(jQuery("#createFolderWrap").hide(),jQuery("#folderNameError").hide(),n.val(""),t.preventDefault());if(t.keyCode===e.ENTER_KEY){var r=clone(e.listParam),i=r.fullPath.split(".");if(i.length>=6){jQuery.goMessage(mailMsg.alert_maxdepth);return}if(!validateInputValue(n,2,32,"folderName"))return;r.path=r.fullPath,r.folderName=n.val(),e.createFolder(r),t.preventDefault()}})},this.downloadFolders=function(t){t.messages.length>0&&e.downloadFiles(t);if(t.folders.length<=0)return;var n=t.folders,r=t.type;for(var i=0;i<n.length;i++){var s=n[i].realPath||n[i].fullPath,o=s.substring(14),u=n[i].nodeNum,a={};a.fullPath=s,a.path=o,a.type=r,a.nodeNum=u}ActionLoader.getGoLoadAction(e.viewFolderAction,a,e.downloadFolders,"json")},this.showDefaultMenus=function(){jQuery("#toolbar a").each(function(){var t=jQuery(this).attr("evt-rol");jQuery(this).hide();var n=jQuery("#viewFolder input:checkbox:checked").map(function(){var e=jQuery(this).attr("folder-type");if(!e)return;return e}).get();if(n.length>0){if(t==="downloadFolderList"||t==="sendMail"||t==="copyFolder"||t==="listDownload")jQuery(this).show(),jQuery("#sendMailButton").addClass("disabled")}else if(t==="downloadFolderList"||t==="sendMail"||t==="copyFolder"||t==="listDownload")jQuery(this).show(),jQuery("#sendMailButton").removeClass("disabled");e.auth=="W"&&jQuery(this).show()})},this.editFolderCancel=function(e){var t=jQuery("#rfName").attr("folder-name"),n=e.closest("td"),r=n.attr("type"),i=n.attr("real-path"),s=n.attr("node-number"),o=n.attr("shared-user-count"),u={};u.folderName=t,u.type=r,u.realPath=i,u.nodeNumber=s,u.useOrg=useOrg,u.sharedUserCount=o;var a=getHandlebarsTemplate("webfolder_edit_tmpl",u);n.html(a)},this.editFolderInput=function(t){var n=e.listParam,r=jQuery("#rfName");if(!validateInputValue(r,2,32,"folderName"))return;if(r.val()===r.attr("folder-name")){e.editFolderCancel(t);return}n.folderName=r.attr("folder-name"),n.rfName=r.val(),e.editFolder(n)},this.makeSearchEvent=function(){var t=jQuery("#webfolderSearch");t.on("keypress","input[evt-rol='webfolderInput']",function(t){if(t.keyCode==e.ENTER_KEY){var n=jQuery("#webfolderInput");if(jQuery("#webfolderInput").hasClass("placeholder")||jQuery.trim(jQuery("#webfolderInput").val())==""){jQuery.goMessage(mailMsg.alert_search_empty_keyword);return}if(!validateInputValue(n,2,64,"searchMail"))return;var r=e.listParam;r.keyWord=n.val(),goFolder(r),t.preventDefault()}}),t.on("click","a,:button,ins",function(e){var t=jQuery(this).attr("evt-rol");if(!t)return;t=="file-detail-search"&&toggleDetailSearchLayer()}),t.on("change","select[evt-rol='file-search-select']",function(e){toggleSearchType()}),t.on("click","input[evt-rol='webfoderSearchSubmit']",function(t){var n=jQuery("#webfolderInput");if(jQuery("#webfolderInput").hasClass("placeholder")||jQuery.trim(jQuery("#webfolderInput").val())==""){jQuery.goMessage(mailMsg.alert_search_empty_keyword);return}if(!validateInputValue(n,2,64,"searchMail"))return;var r=e.listParam;r.keyWord=n.val(),goFolder(r)});var n=jQuery("#webfolderInput");n.focus(function(){jQuery(this).parent().addClass("search_focus")}),n.blur(function(){jQuery(this).parent().removeClass("search_focus")})},this.setSharedValue=function(t){t.fid>0?(e.sharedUserList=t.sharedUserList,e.sharedFolderUid=t.fid):(e.sharedUserList="",e.sharedFolderUid=""),e.currentFolder=t.path,e.showSharedPopup()},this.downloadFiles=function(t){var n=_.map(t.messages,function(e){return e.id});jQuery.fileDownload(e.downloadFileAction,{httpMethod:"GET",data:{uids:n,type:t.type||"user",path:t.path||"/",sroot:t.sroot||"",sharedUserSeq:t.sharedUserSeq||0},prepareCallback:function(){makeProcessLoader()},successCallback:function(){removeProcessLoader()},failCallback:function(){removeProcessLoader()}})},this.showSharedPopup=function(){jQuery.goPopup({id:"webfolderSharePopup",width:"420px",header:mailMsg.webfolder_share,pclass:"layer_normal layer_folder_share",contents:getHandlebarsTemplate("webfolder_shared_popup_tmpl",{folder:e.currentFolder}),openCallback:function(){jQuery("#searchUserInput").placeholder(),e.sharedUserList&&e.sharedUserList.length>0&&jQuery("#webfolderSharePopup #sharedUserList").html(getHandlebarsTemplate("webfolder_shared_user_list_tmpl",e.sharedUserList)),jQuery("#webfolderSharePopup").on("click","span",function(e){e.preventDefault();var t=jQuery(this).attr("evt-rol");if(t=="addShareUser"){var n=jQuery(this).attr("data-type");n=="add"?(jQuery("#webfolderSharePopup .share_user").after(getHandlebarsTemplate("webfolder_shared_user_search_popup_tmpl",{})),jQuery("#webfolderSharePopup").width("900px"),jQuery(this).attr("data-type","hide"),jQuery(this).text(mailMsg.common_menu_hide),jQuery("#webfolderSharePopup").css("left","25%")):(jQuery("#webfolderSharePopup .move_wrap").remove(),jQuery("#webfolderSharePopup .user_search_wrap").remove(),jQuery("#webfolderSharePopup").width("420px"),jQuery(this).attr("data-type","add"),jQuery(this).text(mailMsg.webfolder_searchadd),jQuery("#webfolderSharePopup").css("left","50%"))}else if(t=="shareUserAdd"){var r=jQuery("#searchUserList input:checked");if(r.length==0){jQuery.goSlideMessage(mailMsg.error_noselect);return}var i=jQuery("#webfolderSharePopup #sharedUserList li").map(function(){return jQuery(this).attr("data-id")}).get(),s=r.map(function(){var e={},t=jQuery(this).attr("data-id"),n=jQuery(this).attr("data-email");if(USERID==n.substring(0,n.indexOf("@")))return;for(var r=0;r<i.length;r++)if(t==i[r])return;return e.goUserSeq=t,e.userName=jQuery(this).attr("data-name"),e.position=jQuery(this).attr("data-position"),e.dept=jQuery(this).attr("data-dept"),e.email=jQuery(this).attr("data-email"),e}).get();jQuery("#webfolderSharePopup #sharedUserList").append(getHandlebarsTemplate("webfolder_shared_user_list_tmpl",s))}else if(t=="removeShareUser")jQuery(this).parent().remove();else if(t=="writePermission"){var o=jQuery(this).parent().attr("data-permission");o==""||o=="R"?(jQuery(this).find(".btn_fn7").text(mailMsg.webfolder_write),jQuery(this).parent().attr("data-permission","W")):(jQuery(this).find(".btn_fn7").text(mailMsg.webfolder_read),jQuery(this).parent().attr("data-permission","R"))}}),jQuery("#webfolderSharePopup").on("click",".btn_search",function(e){var t=jQuery(this).attr("evt-rol");t=="searchUser"&&searchGoUser()}),jQuery("#webfolderSharePopup").on("keypress",".search",function(t){var n=jQuery(this).attr("evt-rol");n=="searchUser"&&t.keyCode==e.ENTER_KEY&&searchGoUser()})},closeCallback:function(){jQuery("#webfolderSharePopup").off()},buttons:[{btext:mailMsg.button_ok,btype:"confirm",autoclose:!1,callback:function(){var t={};t.folderPath=e.currentFolder,t.readAuthBox=jQuery("#webfolderSharePopup #sharedUserList li").map(function(){var e=jQuery(this).attr("data-permission");if(e!="W")return jQuery(this).attr("data-id");return}).get(),t.rwAuthBox=jQuery("#webfolderSharePopup #sharedUserList li").map(function(){var e=jQuery(this).attr("data-permission");if(e=="W")return jQuery(this).attr("data-id");return}).get(),e.sharedFolderUid&&(t.fuid=e.sharedFolderUid),jQuery.goPopup.close(),ActionLoader.postGoJsonLoadAction(e.sharedFolderAction,t,function(t){jQuery.goSlideMessage(mailMsg.save_ok),e.loadViewWebFolder(e.listParam)},"json")}},{btext:mailMsg.button_cancel,btype:"normal",autoclose:!0}]})},this.showSelectFolderPopup=function(t){var n=!1;t==="move"&&jQuery("#viewFolder input:checkbox:checked").each(function(){if(jQuery(this).parent().parent().attr("fid"))return n=!0,!1}),jQuery.goPopup({id:"webfolderPopup",header:mailMsg.webfolder_select,pclass:"layer_normal layer_select",contents:getHandlebarsTemplate("webfolder_list_popup_wrap_tmpl"),openCallback:function(){(!n||e.type!="public")&&ActionLoader.getSyncGoLoadAction(e.listFolderDataAction,{type:"user"},function(e){jQuery("#userFolderArea").handlebars("webfolder_list_popup_tmpl",e)},"json"),ActionLoader.getSyncGoLoadAction(e.listFolderDataAction,{type:"share"},function(e){jQuery("#privateWebfolderList").append(getHandlebarsTemplate("webfolder_list_share_popup_tmpl",e))},"json"),(!n||e.type!="user")&&ActionLoader.getSyncGoLoadAction(e.listFolderDataAction,{type:"public"},function(e){jQuery("#companyFolderArea").handlebars("webfolder_list_public_popup_tmpl",e)},"json"),jQuery("#webfolderListWrap ul.side_depth").on("click","span ",function(e){e.preventDefault(),jQuery("#webfolderListWrap p").removeClass("on"),jQuery(this).closest("p").addClass("on")})},buttons:[{btext:mailMsg.button_ok,btype:"confirm",autoclose:!1,callback:function(){var n=jQuery("#webfolderListWrap p.on"),r=n.attr("real-path"),i=clone(e.listParam);i.path=i.fullPath,i.targetPath=r;var s=n.attr("sroot"),o=n.attr("user-seq"),u=n.attr("type"),a=n.attr("auth");s&&(i.sroot=s),o&&(i.userSeq=o,i.targetUserSeq=o),u&&(i.targetType=u);if(a=="R"){jQuery.goMessage(mailMsg.no_right_folder_message);return}var f=jQuery("#viewFolder input:checkbox:checked").map(function(){var e=jQuery(this).parent().parent().attr("fid");if(!e)return;return e}).get(),l=jQuery("#viewFolder input:checkbox:checked").map(function(){var e=jQuery(this).parent().parent().attr("uid");if(!e)return;return e}).get(),c=i.targetPath.split(".");if(f.length>0&&c.length>=6){jQuery.goMessage(mailMsg.alert_maxdepth);return}var h=!1;jQuery.each(f,function(e,t){var n=i.fullPath;i.fullPath==="/"&&(n="WEBFOLDERROOT"),n=n+"."+t,n===r&&(h=!0)});if(h){jQuery.goMessage(mailMsg.same_folder_copymove_error);return}i.fids=f,i.uids=l,i.cmType=t,jQuery.goPopup.close(),ActionLoader.postGoJsonLoadAction(e.copyAndMoveFolderAction,i,function(t){jQuery.goSlideMessage(mailMsg.common_job_success),e.loadWebfolderList(),e.loadPublicWebfolderList(),e.loadViewWebFolder(e.listParam)},"json",function(t){e.failResult(t)})}},{btext:mailMsg.button_cancel,btype:"normal",autoclose:!0}]})},this.getUnifiedSearchFolderList=function(){jQuery("#detailSearchLayerWrap").handlebars("file_unified_detail_search_tmpl",{}),jQuery("#fromDate").datepicker({dateFormat:"yy-mm-dd",changeMonth:!0,changeYear:!0,yearSuffix:""}),jQuery("#toDate").datepicker({dateFormat:"yy-mm-dd",changeMonth:!0,changeYear:!0,yearSuffix:""}),ocxUploadVisible(!1),jQuery("#detailSearchLayerWrap").show()}};Handlebars.registerHelper("replaceEmail",function(e,t){var n=e.substring(0,e.indexOf("@"));return new Handlebars.SafeString(n)}),Handlebars.registerHelper("deptParse",function(e,t){var n=e.join(",");return new Handlebars.SafeString(n)}),Handlebars.registerHelper("notEmptyArray",function(e,t){return e=e.length,e>0?t.fn(this):t.inverse(this)});