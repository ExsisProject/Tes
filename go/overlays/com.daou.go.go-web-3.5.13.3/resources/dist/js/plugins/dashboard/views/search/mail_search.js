(function(){define(["jquery","backbone","hogan","app","hgn!dashboard/templates/search/mail_search","views/pagination","dashboard/views/search/search_form","dashboard/views/search/no_search_result","i18n!nls/commons","jquery.go-sdk"],function(e,t,n,r,i,s,o,u,a){var f={empty_search_results:a["\uac80\uc0c9\uacb0\uacfc\uc5c6\uc74c"],more:a["\ub354\ubcf4\uae30"],mail:a["\uba54\uc77c"]},l=o.extend({events:{"click #btn_more":"showMore","click #mailTitle":"showMailReadPopup"},initialize:function(){this.$el.off(),this.mailResources=null,this.param=GO.router.getSearch(),_.extend(this.param,{folder:"all",keyWord:this.param.keyword,fromaddr:this.param.keyword,toaddr:this.param.keyword,operation:"or",sharedFlag:"user",sharedUserSeq:0,sharedFolderName:"",page:parseInt(this.param.page)+1||1,offset:this.param.offset,category:this.param.searchAttachContents=="true"?"sbafab":"sbaf",sdate:this.param.fromDate?moment(this.convertTime(this.param.fromDate)+"-00-00-00","YYYY-MM-DD-HH-mm-ss").utc().format():"",edate:this.param.toDate?moment(this.convertTime(this.param.toDate)+"-23-59-59","YYYY-MM-DD-HH-mm-ss").utc().format():"",adv:"on"})},render:function(){this.mailResources=this.getMailResources(this.param);if(this.param.appName!=undefined){var e='<div class="cs_mail_wrap"></div><div class="tool_bar tool_absolute"><div class="dataTables_length"></div></div>';this.$el.append(e)}return this.resetList(this.mailResources),this},getMailResources:function(t){var n=GO.contextRoot+"api/mail/message/list",r="";return e.go(n,JSON.stringify(t),{qryType:"POST",contentType:"application/json",async:!1,responseFn:function(e){r=e.data},error:function(e){}}),r},showMailReadPopup:function(t){var n=e(t.currentTarget).attr("data-folder"),r=e(t.currentTarget).attr("data-id"),i={};i.folderType="all",i.folder=n,i.uid=r,i.keyWord=this.param.keyWord,i.page=this.param.page,i.adv=this.param.adv,i.category=this.param.category,this.param.fromDate&&this.param.fromDate!=""&&(i.sdate=this.param.sdate),this.param.toDate&&this.param.toDate!=""&&(i.edate=this.param.edate),i.action="read",POPUPDATA=i;var s="popupRead"+(Math.floor(Math.random()*1e6)+1);POPUPDATA.wname=s,window.open(GO.contextRoot+"app/mail/popup",s,"scrollbars=yes,resizable=yes,width=800,height=640")},showMore:function(e){this.param.appName="mail",this.param.page=0,this.showAppSearchMore(this.param)},removeMoreBtn:function(){if(this.param.appName!=undefined)return;if(this.mailResources.pageInfo.nextPage<=this.mailResources.pageInfo.page)return;this.$el.find("#btn_more").css("display","")},getSearchTotalCount:function(){return this.pageInfo().total},renderPages:function(){this.pageView=new s({pageInfo:this.collection.pageInfo()}),this.pageView.bind("paging",this.selectPage,this),this.$el.find("div.tool_absolute > div.dataTables_paginate").remove(),this.$el.find("div.tool_absolute").append(this.pageView.render().el)},selectPage:function(e){this.collection.setPageNo(e),this.collection.fetch()},pageInfo:function(){if(!this.mailResources)return{total:0};var e={total:this.mailResources.pageInfo.total,pageNo:this.mailResources.pageInfo.page-1,pageSize:this.param.offset,lastPageNo:Math.ceil(this.mailResources.pageInfo.total/this.param.offset),pages:[],prev:!1,next:!1},t=Math.floor(e.pageNo/10)*10,n=Math.ceil((e.pageNo+1)/10)*10;t==e.lastPageNo&&e.lastPageNo==0&&e.pages.push(0);for(var r=t;r<n;r++){if(r>=e.lastPageNo)break;e.pages.push(r)}return this.param.page-1>0&&(e.prev=!0),this.param.page<e.lastPageNo&&(e.next=!0),e},resetList:function(e){if(this.param.appName!=undefined){if(this.pageInfo().total==0){var t=new u({appName:a["\uba54\uc77c"]});this.$el.find("div.cs_mail_wrap").html(t.render().el);return}this.$el.find("div.cs_mail_wrap").html(i({lang:f,dataset:e.messageList,createAt:function(){return GO.util.snsDate(this.dateUtc,GO.lang)}})),this.renderPages()}else{if(this.pageInfo().total==0)return;this.$el.html(i({lang:f,dataset:e.messageList,createAt:function(){return GO.util.snsDate(this.dateUtc,GO.lang)}}))}this.removeMoreBtn()},emptyMessage:function(){if(this.pageInfo().total==0)return" "+a["\uba54\uc77c"]},renderPages:function(){this.pageView=new s({pageInfo:this.pageInfo()}),this.pageView.bind("paging",this.selectPage,this),this.$el.find("div.tool_absolute > div.dataTables_paginate").remove(),this.$el.find("div.tool_absolute").append(this.pageView.render().el)},selectPage:function(e){this.param.page=e,r.router.navigate("unified/app/search?"+this.serializeObj(this.param),!0)},convertTime:function(e){if(e==null||e==""||e==undefined)return"";var t=e.split("T");return t[0]}});return l})}).call(this);