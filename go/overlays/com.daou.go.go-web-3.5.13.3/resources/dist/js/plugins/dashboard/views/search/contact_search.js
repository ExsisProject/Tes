(function(){define(["backbone","hogan","app","hgn!dashboard/templates/search/contact_search","collections/paginated_collection","contact/models/contact","dashboard/views/search/search_form","dashboard/views/search/no_search_result","i18n!nls/commons","i18n!contact/nls/contact"],function(e,t,n,r,i,s,o,u,a,f){var l={empty_search_results:a["\uac80\uc0c9\uacb0\uacfc\uc5c6\uc74c"],more:a["\ub354\ubcf4\uae30"],contact:a["\uc8fc\uc18c\ub85d"],mobileNo:f["\ud734\ub300\ud3f0"],companyname:f["\ud68c\uc0ac"],officeTel:f["\ud68c\uc0ac\uc804\ud654"]},c=i.extend({model:s,url:function(){var e="/api/contact/search",t=$.param({stype:this.stype,keyword:this.keyword,fromDate:this.fromDate,toDate:this.toDate,page:this.pageNo,offset:this.pageSize,searchType:this.searchType});return this.stype=="detail"&&(t=$.param({stype:this.stype,keyword:this.keyword,fromDate:this.fromDate,toDate:this.toDate,page:this.pageNo,offset:this.pageSize,searchType:this.searchType})),e+"?"+t},setListParam:function(){var e=GO.router.getSearch();this.stype=e.stype,this.keyword=e.keyword?e.keyword.replace(/\+/gi," "):"",this.fromDate=e.fromDate,this.toDate=e.toDate,this.pageNo=e.page?e.page:0,this.pageSize=e.offset?e.offset:20,this.searchType="or",sessionStorage.clear()},findById:function(e){var t=this.find(function(t){return _.isEqual(t.get("id"),e)});return t}}),h=o.extend({events:{"click #btn_more":"showMore","click #name":"moveContactDetail","click #email":"moveMailPopup"},initialize:function(){this.$el.off(),this.param=GO.router.getSearch(),this.collection=new c,this.collection.setListParam(),this.collection.bind("reset",this.resetList,this),this.collection.fetch({statusCode:{403:function(){GO.util.error("403")},404:function(){GO.util.error("404",{msgCode:"400-common"})},500:function(){GO.util.error("500")}}})},render:function(){if(this.param.appName!=undefined){var e='<div class="cs_contact_wrap"></div><div class="tool_bar tool_absolute"><div class="dataTables_length"></div></div>';this.$el.append(e)}return this},moveContactDetail:function(e){function s(e){var t=["contact"];return t.push("company"),t.push(e.getCompanyGroupId()),t.push("modify"),t.push(e.getId()),t.join("/")}function o(e){var t=["contact"];return t.push("dept"),t.push(e.getDeptId()),t.push("modify"),t.push(e.getId()),t.join("/")}function u(e){var t=["contact"];return t.push(e.getId()),t.join("/")}var t=$(e.currentTarget).data("id"),n=this.collection.findById(t),r={COMPANY:s,USER:u,DEPARTMENT:o},i=r[n.getOwnerType()](n);window.open("/app/"+i,"_blank","scrollbars=yes,resizable=yes,width=1280,height=760")},moveMailPopup:function(e){if(!GO.isAvailableApp("mail"))return;var t=$(e.currentTarget).attr("data-name"),n=$(e.currentTarget).attr("data-email"),r={to:'"'+t+'"'+" <"+n+">"};window.open(GO.contextRoot+"app/mail/popup/process?data="+encodeURIComponent(JSON.stringify(r)),"popupRead"+Math.floor(Math.random()*1e6)+1,"scrollbars=yes,resizable=yes,width=1280,height=760")},showMore:function(e){this.param.appName="contact",this.showAppSearchMore(this.param)},getSearchTotalCount:function(){return 0},resetList:function(){function t(e){return!_.isUndefined(e)}function n(e,t){return r({lang:t,dataset:e.toJSON()})}if(t(this.param.appName)){if(this.collection.isEmpty()){var e=new u({appName:a["\uc8fc\uc18c\ub85d"]});this.$el.find("div.cs_contact_wrap").html(e.render().el);return}this.$el.find("div.cs_contact_wrap").html(n(this.collection,l)),this.renderPages()}else{if(this.collection.isEmpty()){$("#contactEmptyMessage").show();return}this.$el.html(n(this.collection,l))}this.removeMoreBtn()}});return h})}).call(this);