function fontResizeEventBind(){var e=this;jQuery("#fontResizeLayer ul.list_fs").on("touchmove",function(e){var t=e.originalEvent.touches[0],n=document.elementFromPoint(t.pageX,t.pageY);try{jQuery(n)[0].nodeName&&jQuery(n)[0].nodeName=="INPUT"&&jQuery(n).trigger("click")}catch(e){return}}),jQuery("#fontResizeLayer input[name=inpFont]").on("change",function(e){var t=jQuery(e.currentTarget),n=t.val();resizeFontSize(parseInt(n)),setLocalStorage("lastFontSize_"+USERSESSION.id,n)})}function resizeFontSize(e){jQuery("#mailContentWrapper").find("span[data-font-resize]").each(function(){var t=jQuery(this).attr("data-origin-fontsize"),n=jQuery(this).attr("data-origin-lineheight"),r=parseFloat(t)+parseFloat(t*e*.01),i=parseFloat(n)+parseFloat(n*e*.01);jQuery(this).css({"font-size":r.toFixed(3)+"px","line-height":i.toFixed(3)+"px"})}),this.Iscroll&&this.Iscroll.refresh()}function closeToolbarMenu(){jQuery("#mailHomeToolbarWrap").show(),jQuery("#mailListToolbarWrap").hide(),jQuery("#mail_list_area input[name=msgId], #mail_mdn_list_area input[name=msgId]").each(function(){jQuery(this).attr("checked",!1),checkMailListCheckbox(jQuery(this))}),jQuery("#mail_toolbar_list_selectall").data("checked",!1),jQuery("#mail_toolbar_list_selectall").find("span.txt").text(mailMsg.mail_select_all),changeStatusBarColor(!1)}function isSearchResult(){var e=jQuery("#goSearch").find("li input:checked").length;return e>0}function closeMoreToolbarLayer(){var e=jQuery("#toolbar_wrap");isSearchResult()&&(e=jQuery("#searchResultNav")),e.find("div.array_option").hide()}function closeSearchLayer(e){jQuery("#goSearch input").blur(),jQuery("#goSearch").hide(),jQuery("#commonSearchInput").val(""),jQuery("body").removeClass("scroll_fix"),initSearhResultLayer(e)}function initSearhResultLayer(e){console.log("initSearchResultLayer"),jQuery("#searchNav").show(),jQuery("#searchResultNav").hide(),e||jQuery("#searchResultWrap").html(""),jQuery("#mail_toolbar_search_selectall").data("checked",!1),jQuery("#mail_toolbar_search_selectall").find("span.txt").text(mailMsg.mail_select_all)}function judgmentCheckList(e){var t=jQuery("#main_content").find("li input:checked").length;t?(jQuery("#mailHomeToolbarWrap").hide(),jQuery("#mailListToolbarWrap").show(),changeStatusBarColor(!0)):(jQuery("#mailHomeToolbarWrap").show(),jQuery("#mailListToolbarWrap").hide(),changeStatusBarColor(!1)),e=="mdn"?(jQuery("#mailListToolbarWrap div.btn_submenu").hide(),jQuery("#mailListToolbarWrap span.wrap_btn_m_more").hide()):(jQuery("#mailListToolbarWrap div.btn_submenu").show(),jQuery("#mailListToolbarWrap span.wrap_btn_m_more").show())}function judgmentSearchCheckList(){var e=jQuery("#searchResultWrap").find("li input:checked").length;e?(jQuery("#searchNav").hide(),jQuery("#searchResultNav").show()):(jQuery("#searchNav").show(),jQuery("#searchResultNav").hide(),jQuery("#searchResultNav div.array_option").hide())}function judgmentWebFolderCheckList(){var e=jQuery("#webfolder_content").find("li input:checked").length;e?jQuery("#mailWebFolderSelectToolbarWrap").show():jQuery("#mailWebFolderSelectToolbarWrap").hide(),jQuery("#mailWebFolderSelectToolbarWrap span.count").text(msgArgsReplace(mailMsg.folder_select_number.replace("{number}","0"),[e]))}function closeMoreLayout(e){return e==undefined&&(e=jQuery("#more_layout")),e.is(":visible")?(e.hide(),!0):!1}function getPopupData(){return POPUPDATA}function initMailFunction(){folderControl=new FolderControl,mailControl=new MailControl,historyControl=new HistoryControl(mailHistoryCallBack),folderControl.makeMailEvent(),mailControl.makeMailEvent()}function mailHistoryCallBack(e){var t=historyControl.getHistoryIndex(),n=e.data;if(n&&n.param&&t-1>n.state){if(n.type!="empty"&&!checkEscapeWriteMode()){history.forward();return}switch(n.type){case"list":mailControl.loadMessageList(n.param,!0);break;case"read":mailControl.readMessage(n.param,!0);break;case"mdnlist":mailControl.loadMdnList(n.param,!0);break;case"mdnread":mailControl.loadMdnRead(n.param,!0);break;case"empty":currentMenu=="addr"&&changeMailWriteMode();break;case"move":gotoHistoryBack();break;case"tag":gotoHistoryBack()}}else if(!n||!n.type){var r=e.url;if(r.indexOf("app/mail?work=")>0){if(!checkEscapeWriteMode()){history.forward();return}gotoHistoryBack()}}}function changeMailContainer(e){var t=jQuery("#main_content");e=="addr"||e=="moveFolder"||e=="tag"||e=="webFolder"?(jQuery("#go_content").hide(),e=="addr"?(jQuery("#addr_content").show(),t.removeClass("write")):e=="tag"?jQuery("#tag_message_page").show():e=="moveFolder"?jQuery("#move_folder_page").show():jQuery("#webfolder_content").show()):(jQuery("#addr_content").hide(),jQuery("#webfolder_content").hide(),jQuery("#move_folder_page").hide(),jQuery("#tag_message_page").hide(),jQuery("#go_content").show(),e=="write"?t.hasClass("write")||t.addClass("write"):t.removeClass("write"))}function getTagInfo(e){var t=folderControl.getTagData();if(t&&t.length>0)for(var n=0;n<t.length;n++)if(t[n].id==e)return t[n];return null}function isContainedTrashMail(){return jQuery("li[folder=Trash] input:checked").length>0}function getMailListCheckedObj(){var e;if(currentMenu=="read")e=jQuery("#messageListId");else{var t=jQuery("#main_content");isSearchResult()&&(t=jQuery("#searchResultWrap")),e=t.find("input[name=msgId]:checked")}return e}function getMailListCheckedCount(){return getMailListCheckedObj().length}function getMailListCheckedIdArray(){var e=new Array;return currentMenu=="read"?e.push(getMailListCheckedObj().val()):getMailListCheckedObj().each(function(){e.push(jQuery(this).closest("li").attr("id"))}),e}function getListProcessParams(e){var t=[],n=[];for(var r=0;r<e.length;r++){var i=e[r].lastIndexOf("_"),s=e[r].substring(0,i),o=e[r].substring(i+1);t[t.length]=o,isAllFolder?n[n.length]=s:n[0]=s}return{uids:t,fnames:n}}function checkSuccess(e){return e&&e.isSuccess?!0:(e&&e.failMsg&&alert(e.failMsg),!1)}function checkMailListCheckbox(e){var t=jQuery(e).closest("li");e.attr("checked")?t.hasClass("choice")||t.addClass("choice"):t.hasClass("choice")&&t.removeClass("choice")}function checkEscapeWriteMode(){if(currentMenu=="write"||currentMenu=="addr")isWriteModify()&&confirm(mailMsg.mail_draft_save)&&doDraftSave(),hideAutoComplate();return!0}function escapewriteAndGoHome(){currentMenu=="write"||currentMenu=="addr"?isWriteModify()?setTimeout(function(){confirm(mailMsg.confirm_mobile_escapewrite)&&(hideAutoComplate(),window.location="/app/home")},200):(hideAutoComplate(),window.location="/app/home"):window.location="/app/home"}function isWriteModify(){var e=getRcptFormCount();if(e>0)return!0;var t=jQuery.trim(jQuery("#subject").val());if(t!="")return!0;var n=jQuery.trim(jQuery("#content").val());if(n!="")return!0;var r=jQuery("#file_wrap li").length;return r+=jQuery("#img_wrap li").length,r>0?!0:!1}function mailWriteInit(e){makeInputAddresskeyEvt("to"),makeInputAddresskeyEvt("cc"),makeInputAddresskeyEvt("bcc");var t={autoResizeWidth:!1,makeFormat:!0,multiple:!1,matchCase:!0,notContact:USE_CONTACT==1?"F":"T"};jQuery("#to").autocomplete(mailControl.searchAddressAction,t),jQuery("#cc").autocomplete(mailControl.searchAddressAction,t),jQuery("#bcc").autocomplete(mailControl.searchAddressAction,t),makeInputAddressFormat("to",e.to),makeInputAddressFormat("cc",e.cc),makeInputAddressFormat("bcc",e.bcc),isSendInfoCheckUse=e.sendCheckConfig.sendCheckApply,isSendEmailCheckUse=e.sendCheckConfig.sendEmailCheck,isSendAttachCheckUse=e.sendCheckConfig.sendAttachCheck,sendAttachData=e.sendCheckConfig.sendAttachData,isSendKeywordCheckUse=e.sendCheckConfig.sendKeywordCheck,sendKeywordData=e.sendCheckConfig.sendKeywordData,MAX_ATTACH_SIZE=e.attachConfig.maxAttachSize,checkCcBccRcptArea(),mailControl.getSignList(),jQuery("#content").css("min-height",jQuery("#content").height()),jQuery("#content").on("keyup paste change",function(){jQuery(this).height(1),jQuery(this).height(jQuery(this).prop("scrollHeight")+12)})}function resizeTextFrame(e,t){document.getElementById("messageContentFrame").style.height=e+25+"px",document.getElementById("messageContentFrame").style.width=t+"px"}function getMessageText(){return document.getElementById("messageText").value}function makeInputAddressFormat(e,t){if(!t)return;t=jQuery.trim(t),addressArray=t.split(",");for(var n=0;n<addressArray.length;n++)makeAddressUnitFormat(e,addressArray[n])}function makeAddressUnitFormat(e,t){var n=!1;if(jQuery.trim(t)=="")return;_.each(jQuery("#"+e+"AddrWrap span.name"),function(e){if(e.title.indexOf(t.substring(t.indexOf("<")))>-1){n=!0;return}});if(n)return;var r=jQuery("#"+e),i=jQuery('<span class="name"></span>').attr("title",t).data("email",t).text(getFormatName(t,MAIL_EXPOSURE==0,LOCAL_DOMAIN)),s=jQuery('<span class="ic ic_del"></span>');s.click(function(){jQuery(this).closest("a.adr").remove(),r.focus()});var o=jQuery('<span class="btn_wrap" style="display:inline-block;"></span>').append(s),u=jQuery("<li evt-rol='write-addr-select'></li>");u.append(i).append(o),r.closest("li").before(u),r.val(""),r.focus()}function deleteAddressUnitFormat(e,t){jQuery(t).remove(),jQuery("#"+e).focus()}function deleteAddressUnitFormatAll(e){jQuery("#"+e+"AddrWrap ul.name_tag li:not(.creat)").remove()}function makeInputAddresskeyEvt(e){jQuery("#"+e).blur(function(t){t.preventDefault();var n=jQuery.trim(jQuery(this).val()),r=jQuery("#"+e+"_actb");r.length==0||r.css("display")=="none"?makeInputAddressFormat(e,n):setTimeout(function(){jQuery("div.layer_auto_complete").hasClass("hover_effect")?(jQuery(this).val(""),jQuery("div.layer_auto_complete").removeClass("hover_effect")):makeInputAddressFormat(e,n)},200)}),jQuery("#"+e+"AddrWrap ul.name_tag").click(function(t){jQuery("#"+e).focus()})}function getRcptFormCount(){var e=["to","cc","bcc"],t=0;for(var n=0;n<e.length;n++)jQuery("#"+e[n]+"AddrWrap li span.name").each(function(){t++});return t}function makeRcptForm(e){e||(e={});var t=["to","cc","bcc"],n=[];for(var r=0;r<t.length;r++)jQuery("#"+t[r]+"AddrWrap li span.name").each(function(){n.push(jQuery(this).data("email"))}),t[r]=="to"?e.to=n.join(","):t[r]=="cc"?e.cc=n.join(","):t[r]=="bcc"&&(e.bcc=n.join(",")),n=[];return e}function checkCcBccRcptArea(){var e=["cc","bcc"],t=0;for(var n=0;n<e.length;n++)jQuery("#"+e[n]+"AddrWrap li span.name").each(function(){t++});t>0&&(jQuery("#mail_write_table tr.ccbccWrap").show(),jQuery("#toggle_ccbcc_link").data("toggle","open"))}function hideAutoComplate(){jQuery("#to").unautocomplete(),jQuery("#cc").unautocomplete(),jQuery("#bcc").unautocomplete()}function getFileSizeWithUnit(e,t){var n=parseInt(e)||0,r={K:1024,M:1048576,G:10737e5,T:10995e8},i=0,s="B";return n>r.T?(i=r.T,s="T"+s):n>r.G?(i=r.G,s="G"+s):n>r.M?(i=r.M,s="M"+s):(i=r.K,s="K"+s),(n/i).toFixed(t)+" "+s}function getFileIconStyle(e){var t=e.toLowerCase(),n=new RegExp("(zip|doc|docx|ppt|pptx|xls|xlsx|hwp|pdf|txt|html|htm|jpg|jpeg|png|gif|tif|tiff|bmp|exe|avi|mp3|mp4|mov|mpg|mpeg|lzh|xml|log|csv|eml)","gi");return"ic_"+(n.test(t)?t:"def")}function isImage(e){var t=new RegExp("(jpeg|jpg|gif|png|bmp|tiff|tif)","gi");return t.test(e)?!0:!1}function recurrenceParser(e){var t=e.split(";"),n={};for(var r=0;r<t.length;r++){var i=t[r].split("=");n[i[0]]=i[1]}var s=humanizeFrequency(n),o=humanizeIntervalOption(n),u=humanizeUntil(n),a=humanizeCount(n);return s+" "+o+" "+u+" "+a}function humanizeFrequency(e){var t="";switch(e.FREQ){case"DAILY":e.hasOwnProperty("INTERVAL")?t=msgArgsReplace(mailMsg.mail_calendar_recur_day,[e.INTERVAL]):t=mailMsg.mail_calendar_allday;break;case"WEEKLY":e.hasOwnProperty("INTERVAL")?t=msgArgsReplace(mailMsg.mail_calendar_recur_week,[e.INTERVAL]):t=mailMsg.mail_calendar_allweek;break;case"MONTHLY":e.hasOwnProperty("INTERVAL")?t=msgArgsReplace(mailMsg.mail_calendar_recur_month,[e.INTERVAL]):t=mailMsg.mail_calendar_allmonth;break;case"YEARLY":e.hasOwnProperty("INTERVAL")?t=msgArgsReplace(mailMsg.mail_calendar_recur_year,[e.INTERVAL]):t=mailMsg.mail_calendar_allyear}return t}function humanizeIntervalOption(e){var t="";if(e.hasOwnProperty("BYDAY")){var n=e.BYDAY.split(","),r={SU:mailMsg.mail_calendar_sunday,MO:mailMsg.mail_calendar_monday,TU:mailMsg.mail_calendar_tuesday,WE:mailMsg.mail_calendar_wednesday,TH:mailMsg.mail_calendar_thursday,FR:mailMsg.mail_calendar_friday,SA:mailMsg.mail_calendar_saturday};for(var i=0;i<n.length;i++){var s=/([0-9]*)(SU|MO|TU|WE|TH|FR|SA)?$/.exec(n[i]),o=s[1]?s[1]:undefined,u=r[s[2]];e.hasOwnProperty("BYSETPOS")&&(o=e.BYSETPOS),o==null?t+=u:t+=msgArgsReplace(mailMsg.mail_calendar_recur_number,[o,u]),n.length!=i+1&&(t+=", ")}}if(e.hasOwnProperty("BYMONTHDAY")){var n=e.BYMONTHDAY.split(",");for(var i=0;i<n.length;i++)t+=msgArgsReplace(mailMsg.mail_calendar_recur_day,[n[i]]),n.length!=i+1&&(t+=", ")}if(e.hasOwnProperty("BYMONTH")){var n=e.BYMONTHDAY.split(",");for(var i=0;i<n.length;i++)t+=msgArgsReplace(mailMsg.mail_calendar_recur_day,[n[i]]),n.length!=i+1&&(t+=", ")}return t}function humanizeUntil(e){var t="";if(e.hasOwnProperty("UNTIL")){var n=moment(e.UNTIL,"YYYYMMDD");t=msgArgsReplace(mailMsg.mail_calendar_recur_to,[n.format("YYYY-MM-DD")])}return t}function humanizeCount(e){var t="";return e.hasOwnProperty("COUNT")&&(t=msgArgsReplace(mailMsg.mail_calendar_recur_count,[e.COUNT])),t}var mailToolbarRuleMap=new HashMap;mailToolbarRuleMap.put("normal",{remove:!0,reply:!0,forward:!0,seen:!0,copy:!0,move:!0,resend:!1}),mailToolbarRuleMap.put("inbox",{remove:!0,reply:!0,forward:!0,seen:!0,copy:!0,move:!0,resend:!1}),mailToolbarRuleMap.put("sent",{remove:!0,reply:!0,forward:!0,seen:!0,copy:!0,move:!0,resend:!0}),mailToolbarRuleMap.put("drafts",{remove:!0,reply:!1,forward:!1,seen:!1,copy:!0,move:!0,resend:!1}),mailToolbarRuleMap.put("reserved",{remove:!0,reply:!1,forward:!1,seen:!1,copy:!1,move:!1,resend:!1}),mailToolbarRuleMap.put("spam",{remove:!0,reply:!0,forward:!0,seen:!0,copy:!0,move:!0,resend:!1}),mailToolbarRuleMap.put("trash",{remove:!0,reply:!0,forward:!0,seen:!0,copy:!0,move:!0,resend:!1}),mailToolbarRuleMap.put("all",{remove:!0,reply:!0,forward:!0,seen:!0,copy:!0,move:!0,resend:!1}),mailToolbarRuleMap.put("shared",{remove:!1,reply:!0,forward:!0,seen:!1,copy:!0,move:!1,resend:!1}),mailToolbarRuleMap.put("quotaviolate",{remove:!1,reply:!0,forward:!0,seen:!1,copy:!0,move:!1,resend:!1});var mailControl,folderControl,historyControl,currentFolderType,currentFolderName,currentFolderViewName,currentFolderEncName,isAllfolder,currentMenu,isBookmark=!1,listType="mail",bookmarkType="mail",bookmarkSeq=0,bookmarkName="",bookmarkValue="",isCallPreviewAttach=!1,isMaxSendMailCountUse=!1,maxSendMailCount=0,isFirstLoad=!1,sendConfirm="",LOCAL_DOMAIN="",toolBarMenus={"\uc804\uccb4\uc120\ud0dd":{id:"mail_toolbar_list_selectall",action:"mail-select-all",ignore:"on",text:mailMsg.mail_select_all},"\uc804\uccb4\uc120\ud0dd_search":{id:"mail_toolbar_search_selectall",action:"mail-select-all",ignore:"on",text:mailMsg.mail_select_all},"\uc0ad\uc81c_list":{id:"mail_toolbar_list_delete",action:"mail-delete",text:mailMsg.menu_delete},"\uc0ad\uc81c_read":{id:"mail_toolbar_read_delete",action:"mail-delete",text:mailMsg.menu_delete},"\uc77d\uc74c":{selectId:"toolbar_seen_flag",menu:"seen",role:"change-flag-seen",text:mailMsg.menu_flag_read},"\uc548\uc77d\uc74c":{selectId:"toolbar_seen_flag",menu:"seen",role:"change-flag-unseen",text:mailMsg.menu_flag_unread},"\uc774\ub3d9":{id:"mail_toolbar_list_move",action:"move-message-page",text:mailMsg.menu_move},"\ud0dc\uadf8":{id:"mail_toolbar_list_tag",action:"tag-message-page",text:mailMsg.folder_tag},"\uc804\uccb4\ub2f5\uc7a5_read":{title:mailMsg.mail_thismessage,id:"mail_toolbar_read_replyall",action:"mail-reply-all",text:mailMsg.menu_replyall,inMoreBtn:!0},"\uc2a4\ud338\uc774\ub3d9":{id:"mail_toolbar_spam_move",action:"mail_spam_move",text:mailMsg.menu_conf_spam+mailMsg.comn_move,inMoreBtn:!0},"\uc774\ub3d9_read":{title:mailMsg.mail_thismessage,id:"mail_toolbar_read_move",action:"move-message-page",text:mailMsg.mail_folder_move,inMoreBtn:!0},"\ud0dc\uadf8_read":{title:mailMsg.mail_thismessage,id:"mail_toolbar_read_tag",action:"tag-message-page",text:mailMsg.folder_tag,inMoreBtn:!0},"\uc548\uc77d\uc74c_read":{title:mailMsg.mail_thismessage,action:"change-flag-unseen",text:mailMsg.menu_flag_unread,inMoreBtn:!0},"\uc774\uc804":{id:"read_pre_message_btn",action:"read-pre-message",text:mailMsg.comn_page_up,inMoreBtn:!0},"\ub2e4\uc74c":{id:"read_next_message_btn",action:"read-next-message",text:mailMsg.comn_page_down,inMoreBtn:!0},"\ub2f5\uc7a5":{id:"mail_toolbar_read_reply",action:"mail-reply",text:mailMsg.menu_reply},"\uc804\ub2ec":{id:"mail_toolbar_read_forward",action:"mail-forward",text:mailMsg.menu_forward}};jQuery(document).ready(function(){initLayoutSize(),initMailFunction(),isFirstLoad=!0,makeTopMenuTitle(MAIL_APP_NAME);if(workAction=="error")return;var e=!1;if(workAction=="write"){jQuery("#mailHomeToolbarWrap").hide(),e=!0;var t={};writeToList&&(t.to=unescape_tag_title(writeToList)),t.init=!0,goWrieLoad(t)}else workAction=="read"&&(isNotFoundError=="true"&&(alert(mailMsg.mail_sid_not_found_alert),gotoMailHome(!0)),workFolder&&workFolder!=""&&workUid&&Number(workUid)>0&&(e=!0,readMessage(unescape_tag_title(workFolder),workUid)));e||gotoMailHome(!0),folderControl.getFolderAllInfo(),folderControl.getBookmarkInfo(),pageDone(),changeStatusBarColor(!1),displayHomeIcon()}),window.moveTab=function(){isMoveTabReturn(),checkEscapeWriteMode()&&isMoveTab()};var FolderControl=function(){var e=this;this.folderInfoAction="/api/mail/folder/info",this.folderAllInfoAction="/api/mail/folder/all",this.emptyFolderAction="/api/mail/folder/empty",this.bookmarkListAction="/api/mail/bookmark/list",this.defaultFolders=[],this.userFolderList=[],this.tagData=[],this.Iscroll=null,this.getFolderAllInfo=function(){var t={};ActionLoader.getGoLoadAction(this.folderAllInfoAction,t,function(t){e.printFolderAllInfo(t)},"json")},this.printFolderAllInfo=function(t){e.printFolderInfo(t),e.makeTagList(t.userTags),e.makeSharedFolderList(t.userSharedFolderList)},this.printFolderInfo=function(t){e.makeDefaultFolder(t.defaultFolders),e.makeUserFolder(t.userFolders),e.printFolderCountUpdateBookmark(t.defaultFolders),e.printFolderCountUpdateBookmark(t.userFolders),e.quotaInfo=t.quotaInfo},this.makeDefaultFolder=function(e){this.defaultFolders=e;var t=!1;if(e&&e.length>0)for(var n=0;n<e.length;n++){var r=e[n];r.fullName=="Quotaviolate"&&(t=!0);var i=jQuery("#"+r.id+"_num");i.empty(),r.fullName!="Sent"&&r.unseenCnt>0&&i.text(r.unseenCnt)}t?jQuery("#folder_quotaviolate").show():jQuery("#folder_quotaviolate").hide()},this.makeUserFolder=function(e){this.userFolderList=e,e.isInbox=!0,jQuery("#inbox_folder_area").handlebars("mail_user_folder_tmpl",e),e.isInbox=!1,jQuery("#uf_folder_area").handlebars("mail_user_folder_tmpl",e),jQuery("#uf_smart_area").handlebars("mail_smart_folder_tmpl",e),jQuery("#uf_smart_area li").length>0?jQuery("#smart_menu").show():jQuery("#smart_menu").hide()},this.makeSharedFolderList=function(e){e&&e.length>0?jQuery("#shared_folder_title").show():jQuery("#shared_folder_title").hide(),jQuery("#shared_folder_wrap").handlebars("shared_folder_tmpl",e)},this.makeTagList=function(t){e.tagData=t,jQuery("#mail_tag_list_area").handlebars("mail_tag_tmpl",t)},this.getBookmarkInfo=function(){ActionLoader.getGoLoadAction(this.bookmarkListAction,null,function(e){jQuery("#mail_bookmark_list").handlebars("mail_bookmark_tmpl",e)},"json")},this.updateFolderCountInfo=function(){var t={};ActionLoader.getGoLoadAction(this.folderInfoAction,t,function(t){e.printFolderCountUpdate(t),e.printFolderCountUpdateBookmark(t)},"json")},this.printFolderCountUpdate=function(t){var n=t;if(n&&n.length>0)for(var r=0;r<n.length;r++){var i=n[r],s=jQuery("#"+i.id+"_num");s.empty(),i.fullName!="Sent"&&i.unseenCnt>0&&s.text(i.unseenCnt),i.child&&i.child.length>0&&e.printFolderCountUpdate(i.child)}},this.printFolderCountUpdateBookmark=function(t){if(t&&t.length>0)for(var n=0;n<t.length;n++){var r=t[n];jQuery("#mail_bookmark_list li").each(function(){var e=jQuery(this).attr("query"),t=jQuery(this).attr("seq");if(e==r.fullName){var n=jQuery("#bookmark_num_"+t);n.empty(),r.unseenCnt>0&&n.text(r.unseenCnt)}}),r.child&&r.child.length>0&&e.printFolderCountUpdateBookmark(r.child)}},this.emptyMailFolder=function(e){ActionLoader.postGoLoadAction(this.emptyFolderAction,e,function(t){e.folderName==currentFolderName?mailControl.reloadMessageList():executeFolderInfo()},"json")},this.getQuotaInfo=function(){return this.quotaInfo},this.getTagData=function(){return this.tagData},this.getDefaultFolderList=function(){return this.defaultFolders},this.getUserFolderList=function(){return this.userFolderList},this.makeMailEvent=function(){jQuery("#mail_folder_side").on("tap","a",function(e){var t=jQuery(this).attr("evt-rol");if(!t)return;e.stopPropagation?e.stopPropagation():e.cancelBubble=!0,e.preventDefault();if(t=="folder"){var n=jQuery(this).attr("fname");goFolder(n)}else if(t=="empty-spam-folder")emptyFolder("Spam");else if(t=="empty-trash-folder")emptyFolder("Trash");else if(t=="tag-message"){var r={folder:"all",listType:"tag",tagId:jQuery(this).attr("val")};goMailList(r)}else if(t=="bookmark-execute"){var i=jQuery(this).closest("li"),s=i.attr("type"),o=i.attr("query"),u=i.attr("seq");bookmarkExecute(u,s,o)}else if(t=="folder-execute"){var a=jQuery(this).attr("type");folderExecute(a)}else if(t=="receive-noti-list")loadMdnList();else if(t=="shared-folder"){var n=jQuery(this).attr("fname"),f=jQuery(this).attr("seq");goSharedFolder(n,f)}else if(t=="move-security-center"){var l=jQuery(this).attr("evt-data-url");executeExtUrl(l)}}),jQuery(window).on("orientationchange",function(){window.orientationChangeListener()}),window.orientationChangeListener=function(){console&&console.log("orientationchange"),setTimeout(function(){var e=jQuery("#mail_folder_side").css("display")==="none"?!1:!0;folderControl.setBodyHeight(e),folderControl.setSideHeight(),folderControl.Iscroll&&folderControl.Iscroll.refresh()},1e3)}},this.setSideHeight=function(){var e=jQuery("#mail_folder_side"),t=jQuery("header div.nav"),n=jQuery(window).height(),r=n-t.height();e.css({height:r})},this.setBodyHeight=function(e){var t=jQuery("#go_body");e?t.height(jQuery(window).height()-jQuery("header").height()):t.height("auto")},this.makeLeftMenuIscroll=function(){this.Iscroll?this.Iscroll.refresh():this.Iscroll=new IScroll("#mail_folder_side",{bounce:!0,scrollbars:!0})}},MailControl=function(){var e=this;this.offset=20,this.listAction="/api/mail/message/list",this.readAction="/api/mail/message/read",this.writeAction="/api/mail/message/write",this.sendAction="/api/mail/message/send",this.mdnListAction="/api/mail/message/mdn/list",this.mdnReadAction="/api/mail/message/mdn/read",this.deleteMdnAction="/api/mail/message/mdn/delete",this.recallMessageAction="/api/mail/message/mdn/recall",this.sendMdnResponseAction="/api/mail/message/mdn/send",this.deleteMessageAction="/api/mail/message/delete",this.switchFlagAction="/api/mail/message/flag",this.searchAddressAction="/api/mail/address/search/name",this.copyMessageAction="/api/mail/message/copy",this.moveMessageAction="/api/mail/message/move",this.writeAddrSelectAction="/api/contact/contacts",this.writeAddrSearchAction="/api/contact/search",this.deptSelectAction="/api/department/list/joined",this.companySelectAction="/api/contact/companyfolder/manage",this.writeAttachAction="/api/file",this.signListAction="/api/mail/setting/sign/list",this.taggingMessageAction="/api/mail/message/tag",this.isMailAttachSearchAction="/api/system/mailattachsearch",this.viewFolderAction="/api/webfolder/folder/list",this.webfolderAttachWriteAction="/api/webfolder/mail/attach/write",this.viewShareFolderAction="/api/webfolder/folder/tree?type=share",this.listMode="mail",this.listParam={},this.readParam={},this.writeParam={},this.writeData={},this.sendData={},this.addrParam={},this.sharedFlag=!1,this.currentFolder="Inbox",this.nextPage=1,this.addrNextPage=1,this.lastPage=1,this.preNavi={},this.nextNavi={},this.Iscroll=null,this.selectedMailId=null,this.pageNo=null,this.dataSet={},this.searchInfo={},this.depts=[],this.users=[],this.selectedNodes=[],this.isMultiSite=!1,this.webFolderParamHistoryList=[],this.currentWebFolderInfo={},this.isMailAttachSearch=function(){var e=!1;return ActionLoader.getSyncGoLoadAction(this.isMailAttachSearchAction,null,function(t){e=t},"json"),e},this.getSearchList=function(t,n){e.searchInfo.param=t,ActionLoader.postSyncGoJsonLoadAction(this.listAction,t,function(t){e.searchInfo.pageInfo=t.pageInfo,typeof n=="function"&&n(t)},"json")},this.initSearchInfo=function(){this.searchInfo={}},this.preventBodyScroll=function(){jQuery("body").addClass("scroll_fix")},this.searchResultSetHeight=function(){var e=jQuery(window).height()-jQuery("#searchNav").outerHeight(!0);jQuery("#searchDetail").css("height",e+"px")},this.searchLayerInitScroll=function(){jQuery("#searchDetail").off("scroll.searchLayer"),jQuery("#searchDetail").on("scroll.searchLayer",jQuery.proxy(this.detectSearchScroll,this))},this.detectSearchScroll=function(t){var n=jQuery(window).height(),r=jQuery("#searchResultWrap").height(),i=jQuery(t.currentTarget).scrollTop(),s=r-n-10,o=i-s>=jQuery("#searchNav").outerHeight(!0);if(o){if(e.searchInfo.pageInfo.lastPage)return;moreSearchList(e.searchInfo)}},this.detectScroll=function(t){var n=jQuery(t.currentTarget).scrollTop(),r=parseInt(n)>=jQuery(document).height()-jQuery(window).height()-60,i=e.lastPage!==1;i&&r&&this.appendRenderAboveList();if(n===0){jQuery("#main_content").empty();if(this.pageNo===0)return!1;this.selectedMailId=null,this.pageNo=1,this.dataFetch(this.pageNo),jQuery("#mailHomeToolbarWrap").show(),jQuery("#mailListToolbarWrap").hide()}},this.getSharedFolderList=function(){ActionLoader.getSyncGoLoadAction(this.viewShareFolderAction,{},function(e){jQuery("#webFolderDirectory option[data-type=share]").remove(),_.each(e.webfolder,function(e){jQuery("#webFolderDirectory").append("<option data-type='share' data-sroot='"+e.sroot+"' data-full-path='"+e.fullName+"' data-userseq='"+e.mailUserSeq+"' >"+e.name+"</option>")})},"json")},this.fetchWebFolderList=function(t){var n=e.currentWebFolderInfo.pageInfo;if(!_.isUndefined(n)){if(n.lastPage)return;t=_.extend(t,{currentPage:n.page+1})}ActionLoader.getSyncGoLoadAction(this.viewFolderAction,t,function(t){e.currentWebFolderInfo.pageInfo=t.pageInfo,e.renderWebFolderList(t),e.renderWebFolderHeader(t)},"json")},this.renderWebFolderHeader=function(e){jQuery("div.webFolderHeader:visible").attr({"data-path":e.path,"data-userseq":e.userSeq,"data-sroot":e.sroot,"data-type":e.type})},this.renderWebFolderList=function(t){e.currentWebFolderInfo.pageInfo.firstPage?jQuery("#webfolder_list").empty():t.folders=[];if(t.total===0&&t.folders.length===0){var n='<li class="creat data_null"><span class="txt">'+mailMsg.webfolder_file_empty_title+"</span></li>";jQuery("#webfolder_list").append(n)}jQuery("#webfolder_list").append(getHandlebarsTemplate("webfolder_content_tmpl",t)),jQuery("#webfolder_content").show()},this.detectWebFolderListScroll=function(t){var n=jQuery(t.currentTarget).height(),r=jQuery(".go_wrap").height(),i=jQuery(t.currentTarget).scrollTop(),s=r-n;i-s>-1&&e.fetchWebFolderList(e.currentWebFolderInfo.param)},this.resetCheckedWebFolder=function(e){jQuery("#mailWebFolderSelectToolbarWrap").hide(),jQuery("#webfolder_list input[type=checkbox]").prop("checked",!1),jQuery("#select-all").text(mailMsg.mail_select_all)},this.loadMessageList=function(t,n,r){progressAction({action:!0}),t?(t.folder&&t.folder!=""&&(this.currentFolder=t.folder),t.sharedFlag&&t.sharedFlag=="shared"?this.sharedFlag=!0:this.sharedFlag=!1):t={},this.listParam=t,t.init=r,this.dataSet=t,ActionLoader.postSyncGoJsonLoadAction(this.listAction,t,e.printMessageList,"json"),jQuery(window).off("scroll.renderNewPage"),jQuery(window).on("scroll.renderNewPage",jQuery.proxy(this.detectScroll,this)),google.sendPageView(this.listAction),n||historyControl.setHistory({type:"list",param:t})},this.printMessageList=function(t){e.selectedMailId=_.isNull(sessionStorage.getItem("SELECTED-DOC-ID"))?null:sessionStorage.getItem("SELECTED-DOC-ID"),e.pageNo=_.isNull(sessionStorage.getItem("PAGE-NO"))?1:parseInt(sessionStorage.getItem("PAGE-NO")),sessionStorage.removeItem("SELECTED-DOC-ID"),sessionStorage.removeItem("PAGE-NO"),e.dataSet.folder=e.listParam.folder,e.dataSet.init=e.listParam.init,changeMailContainer("list"),e.lastPage=t.total<=20?1:Math.ceil(t.total/20),e.listMode="mail",currentMenu="list",e.nextPage=1,currentFolderType=t.folderType,currentFolderName=t.folderFullName,currentFolderViewName=t.folderName,currentFolderEncName=t.folderEncName,isAllFolder=currentFolderType=="all"?!0:!1,isBookmark=t.bookmark,listType=t.listType,bookmarkSeq=t.bookmarkSeq,bookmarkType=t.bookmarkType,bookmarkName=currentFolderViewName,bookmarkValue=currentFolderName,t.extFolder=="on"&&(bookmarkType=t.extType,bookmarkValue=bookmarkType);var n={};n.isList=!0,n.search=t.search,n.name=t.folderName,n.bookmarkSeq=t.bookmarkSeq,n.bookmarkType=bookmarkType,n.bookmarkValue=bookmarkValue,n.isBookmark=isBookmark,n.isAllFolder=isAllFolder,n.flag=t.flag,n.extFolder=t.extFolder,n.extType=t.extType,n.folderType=t.folderType;if(listType=="tag"){bookmarkValue=t.tagId;var r=getTagInfo(bookmarkValue);n.type="tag",n.tagInfo=r}jQuery("#main_content").empty(),e.pageNo>=2?(e.dataSet.offset=e.offset*parseInt(e.pageNo),e.pageNo=1,e.dataFetch(e.pageNo)):(e.dataSet.offset=e.offset,e.makeMailListContent(t)),e.scrollToEl(),progressAction({action:!1}),e.makeListToolbar(n),isFirstLoad||executeFolderInfo(),isFirstLoad=!1,changeStatusBarColor(!1),e.isBiggerStyle()&&jQuery("#main_content").removeClass("content_detail")},this.scrollToEl=function(){if(e.selectedMailId==null)return!1;var t=JSON.parse(this.selectedMailId),n=jQuery("li").find('a[data-list-id="'+t.listId+'"]').closest("li");if(n.length==0)return;var r=n.offset().top-jQuery("#mailHomeToolbarWrap").outerHeight(!0);jQuery("html").animate({scrollTop:r},10)},this.appendRenderAboveList=function(){e.dataSet.offset>e.offset&&(e.pageNo=e.dataSet.offset/e.offset,e.dataSet.offset=e.offset);if(e.lastPage===e.pageNo)return;e.pageNo=e.pageNo+1,e.dataFetch(e.pageNo)},this.dataFetch=function(t){e.dataSet.page=t,this.listMode==="mail"?ActionLoader.postSyncGoJsonLoadAction(this.listAction,this.dataSet,e.makeMailListContent,"json"):ActionLoader.postSyncGoLoadAction(this.mdnListAction,this.dataSet,e.makeMailMdnListContent,"json")},this.makeListHeader=function(e){jQuery("#mail_header .mailHeaderWrap").hide(),jQuery("#mail_list_header").show(),jQuery("#search_back_btn").hide(),jQuery("#toggle_folder_side_btn").show(),jQuery("#mail_refresh_btn").show();if(e.bookmarkSeq>0){var t=e.type,n=e.bookmarkType;if(t=="tag")jQuery("#header_title_wrap").hide(),jQuery("#header_tag_color").removeClass().addClass("ic_tag "+e.tagInfo.color),jQuery("#header_tag_name").text(e.tagInfo.name),jQuery("#header_tag_title_wrap").show();else{jQuery("#header_tag_title_wrap").hide();var r=mailBookmarkName(n,e.name);jQuery("#header_title_wrap").text(r).show()}}else if(e.type=="tag")jQuery("#header_title_wrap").hide(),jQuery("#header_tag_color").removeClass().addClass("ic_tag "+e.tagInfo.color),jQuery("#header_tag_name").text(e.tagInfo.name),jQuery("#header_tag_title_wrap").show();else{jQuery("#header_tag_title_wrap").hide();var r="";e.isAllFolder?e.search?(r=mailMsg.mail_search_result,jQuery("#mail_refresh_btn").hide(),jQuery("#search_back_btn").show()):e.extFolder=="on"&&(r=mailBookmarkName(e.extType,"")):r=e.name,jQuery("#header_title_wrap").text(r).show()}},this.makeMenuItemTemplate=function(e,t){var n=[];return this.isSelectType(t)?n=this._makeSelectTemplate(e,n,t):n=this._makeButtonTemplate(n,t),n.join("")},this.isSelectType=function(e){return e.selectId!=undefined},this._makeSelectTemplate=function(e,t,n){var r=e.find("#"+n.selectId);return r.length>0?r.append('<li><a href="javascript:;" evt-act="'+n.role+'" evt-rol="toolbar"><span>'+n.text+"</span></a></li>"):(t.push('<li><div class="btn_submenu">'),t.push('<a href="javascript:;" class="btn_tool" data-role="button" evt-rol="toolbar" sub="on" menu="'+n.menu+'">'),t.push("\n"),n.title==undefined?t.push('<span class="txt">'+n.text+"</span>"):t.push('<span class="txt">'+n.title+"</span>"),t.push("\n"),t.push('<span class="ic_cmm ic_dropdown_small"></span>'),t.push("</a>"),t.push('<div class="array_option" style="width:110px;display:none;">'),t.push('<ul id="'+n.selectId+'" class="array_type">'),t.push('<li><a href="javascript:;" evt-act="'+n.role+'" evt-rol="toolbar"><span>'+n.text+"</span>"),t.push("</a></li>"),t.push("</div></li>")),t},this._makeButtonTemplate=function(e,t){var n="",r=t.role==undefined?"toolbar":t.role;return t.ignore=="on"?e.push('<li><a href="javascript:;" class="'+n+'" data-role="button" id="'+t.id+'" evt-rol="'+r+'" evt-act="'+t.action+'" ignore="on">'):e.push('<li><a href="javascript:;" class="'+n+'" data-role="button" id="'+t.id+'" evt-rol="'+r+'" evt-act="'+t.action+'">'),e.push('<span class="txt">'+t.text+"</span>"),e.push("</a></li>"),e},this.makeMoreMenuItemTemplate=function(e){var t=[],n=e.role==undefined?"toolbar":e.role;return t.push("<li>"),t.push('<a href="javascript:;" data-role="button" id="'+e.id+'" evt-rol="'+n+'" evt-act="'+e.action+'">'),t.push('<span class="txt">'+e.text+"</span>"),t.push("</a></li>"),t.join("")},this.menuBarAllowWidthPolicy=function(e,t){var n=34;return t-e.outerWidth()+n>0},this.makeListToolbar=function(e){jQuery("#mailHomeToolbarWrap").show(),jQuery("#mailHomeToolbarWrap div.optional").show(),jQuery("#mailWriteToolbarWrap").hide(),jQuery("#mailReadToolbarWrap").hide(),jQuery("#mailListToolbarWrap").hide(),jQuery("#mailWriteBtn").show();var t=jQuery("#mailListToolbarWrap"),n=jQuery("#searchResultNav");t.find("li").not(".moreItemLi").remove(),n.find("li").not(".moreItemLi").remove();var r=mailToolbarRuleMap.get(e.folderType),i=[];i.push(toolBarMenus.\uc804\uccb4\uc120\ud0dd),r.remove&&i.push(toolBarMenus.\uc0ad\uc81c_list),r.seen&&(i.push(toolBarMenus.\uc77d\uc74c),i.push(toolBarMenus.\uc548\uc77d\uc74c)),r.move&&i.push(toolBarMenus.\uc774\ub3d9),i.push(toolBarMenus.\ud0dc\uadf8),jQuery("#toolbar_wrap").show(),this._renderListTitle(e),this._renderHeaderToolBar(t,i),i.splice(0,1,toolBarMenus.\uc804\uccb4\uc120\ud0dd_search),this._renderHeaderToolBar(n,i)},this._renderListTitle=function(e){var t=mailMsg.mail_title;if(e.bookmarkSeq>0){var n=e.type,r=e.bookmarkType;n=="tag"?t=e.tagInfo.name:t=mailBookmarkName(r,e.name)}else e.type=="tag"?t=e.tagInfo.name:e.isAllFolder?e.extFolder=="on"&&(t=mailBookmarkName(e.extType,"")):t=e.name;jQuery("#top_menu_title").text(t)},this._renderHeaderToolBar=function(e,t){if(!t)return;var n=!1,r=this;t.forEach(function(t){var i=jQuery(r.makeMenuItemTemplate(e,t));t.inMoreBtn?(e.find(".moreMenuItem").append(i,"\n"),n=!0):e.find(".moreItemLi").before(i,"\n"),n&&e.find(".moreItemLi").show()}),n&&e.find(".moreItemLi").show(),displayHomeIcon()},this._renderToolBar=function(e,t){var n=18,r=!1,i=this;t.forEach(function(t){var s=jQuery(i.makeMenuItemTemplate(e,t));e.find(".critical").append(s,"\n"),n+=s.outerWidth()>0?s.outerWidth()+2:s.outerWidth();if(s.find(".array_option").length>0)n+=20;else if(s.find(".ic_arrow3_t").length>0||s.find(".ic_arrow3_d").length>0)n+=10;i.menuBarAllowWidthPolicy(e,n)&&(s.attr("data-more","Y"),e.find("[data-id=more_list]").append(i.makeMoreMenuItemTemplate(t)),r=!0)}),e.find("[data-more]").remove(),r?e.find("#more_btn").show():e.find("#more_btn").hide()},this.makeMailListContent=function(e){jQuery("#main_content").append(getHandlebarsTemplate("mail_list_content_tmpl",e))},this.readMessage=function(t,n){this.readParam=clone(this.listParam),this.readParam.folder=t.folder,this.readParam.uid=t.uid,this.readParam.viewImg=!0,this.readParam=this.getSharedFolderParam(this.readParam),progressAction({action:!0}),ActionLoader.postSyncGoJsonLoadAction(this.readAction,this.readParam,e.printReadMessage,"json"),jQuery(window).off("scroll.renderNewPage"),google.sendPageView(this.readAction),n||historyControl.setHistory({type:"read",param:t})},this.reloadReadMessage=function(){var t=e.readParam;e.readMessage(t,!0)},this.printReadMessage=function(t){changeMailContainer("read"),e.listMode="mail",currentMenu="read",isAllFolder=!1,e.preNavi=t.preNavi,e.nextNavi=t.nextNavi;var n={isRead:!0};moment.lang("kr"),t.msgContent.date=moment(t.msgContent.dateUtc).format("YYYY/MM/DD dddd a HH:mm:ss");var r="on"==getCookie("rcpt_show");t.isRcptShow=r,progressAction({action:!1}),e.makeReadToolbar(t),e.makeMailReadContent(t).done(jQuery.proxy(function(){window.Iscroll=e.makeReadIscroll({isInitRendering:!0})},e)),jQuery.mobile.silentScroll(0);var i=t.msgContent;if(i.mdnCheck&&confirm(mailMsg.mail_mdn_response_confirm)){var s={folderName:i.folderEncName,uid:i.uid};s=e.getSharedFolderParam(s),e.sendMdnResponse(s)}executeFolderInfo();var o=e.readParam;o&&(o.page=t.page,e.readParam=o);var u=e.listParam;u&&(u.page=t.page,e.listParam=u)},this.makeReadToolbar=function(e){jQuery("#mailHomeToolbarWrap").hide(),jQuery("#mailWriteToolbarWrap").hide(),jQuery("#mailListToolbarWrap").hide(),jQuery("#mailWriteBtn").show();var t=jQuery("#mailReadToolbarWrap");t.show(),t.find("li").not(".moreItemLi").remove(),t.find("div.optional").show();var n=mailToolbarRuleMap.get(e.folderType),r=[];n.reply&&r.push(toolBarMenus.\ub2f5\uc7a5),n.forward?(r.push(toolBarMenus.\uc804\ub2ec),jQuery("#mail_bottom_toolbar_read_forward").show()):jQuery("#mail_bottom_toolbar_read_forward").hide(),n.remove?(r.push(toolBarMenus.\uc0ad\uc81c_read),jQuery("#mail_bottom_toolbar_read_delete").show()):jQuery("#mail_bottom_toolbar_read_delete").hide(),n.reply?(r.push(toolBarMenus.\uc804\uccb4\ub2f5\uc7a5_read),jQuery("#mail_bottom_toolbar_read_reply").show(),jQuery("#mail_bottom_toolbar_read_replyall").show()):(jQuery("#mail_bottom_toolbar_read_reply").hide(),jQuery("#mail_bottom_toolbar_read_replyall").hide()),r.push(toolBarMenus.\uc2a4\ud338\uc774\ub3d9),n.move?(r.push(toolBarMenus.\uc774\ub3d9_read),jQuery("#mail_bottom_toolbar_read_move").show()):jQuery("#mail_bottom_toolbar_read_move").hide(),r.push(toolBarMenus.\ud0dc\uadf8_read),r.push(toolBarMenus.\uc548\uc77d\uc74c_read),e.preNavi&&r.push(toolBarMenus.\uc774\uc804),e.nextNavi&&r.push(toolBarMenus.\ub2e4\uc74c),jQuery("#toolbar_wrap").show(),this._renderHeaderToolBar(t,r)},this.makeMailReadContent=function(t){var n=jQuery.Deferred(),r=jQuery(window).width()-30;t.msgContent.htmlContent=e.convertIcalTemplate(t.msgContent.icalList)+t.msgContent.htmlContent,jQuery("#main_content").handlebars("mail_read_content_tmpl",t),jQuery("#fontResizeLayer li input[value="+this.getFontSize()+"]").prop("checked",!0);var i=t.tagIdList,s=jQuery("#readTagWrap");if(i&&i.length>0){var o=folderControl.getTagData();for(var u=0;u<i.length;u++)for(var a=0;a<o.length;a++)if(i[u]==o[a].id){s.append(getHandlebarsTemplate("mail_read_tag_tmpl",o[a]));break}}jQuery("#message_view_table a[href],area[href]").each(function(){MOBILE_WEB||jQuery(this).attr("evt-rol","ext-url")});var f=jQuery("#message_view_table").find("img:not([src*=mdnData])"),l=f.length;l||n.resolve();var c=0;return f.load(function(){c++,l==c&&n.resolve()}),n},this.makeReadIscroll=function(e){var t=e.isInitRendering,n=this,r=jQuery(window).height(),i=jQuery("#mailContentWrapper").outerWidth(!0),s=jQuery(window).width();s>i&&(i=s),t&&(this.contentsParsingForFontSizeResizing(),resizeFontSize(this.getFontSize())),jQuery("#message_view_table").css("width",i+"px");var o=jQuery("#mailReadToolbarWrap").outerHeight(!0),u=jQuery("header.article_header").outerHeight(!0);jQuery("#article_view").height(r-u-o),this.isBiggerStyle()&&jQuery("#main_content").addClass("content_detail"),this.Iscroll&&this.Iscroll.destroy();var a=1/(i/s);return n.Iscroll=new IScroll("#article_view",{bounce:!1,zoom:!0,zoomMin:a,disablePointer:!0,disableTouch:!1,disableMouse:!1,preventDefault:!1}),n.Iscroll.on("zoomStart",function(e){jQuery("#article_view").css("overflow-x","").css("overflow-y","")}),n.Iscroll.on("zoomEnd",function(e){jQuery("#article_view").css("overflow-x","scroll").css("overflow-y","hidden")}),setTimeout(function(){i>s&&(n.Iscroll.zoom(0,0,a),n.Iscroll.scrollTo(0,0)),n.Iscroll.refresh()},400),n.Iscroll},this.getFontSize=function(){var e=getLocalStorage("lastFontSize_"+USERSESSION.id);return e?e:40},this.isBiggerStyle=function(){return document.getElementById("systemBigStyle").disabled==1||document.getElementById("systemBiggerStyle").disabled==1?!0:!1},this.contentsParsingForFontSizeResizing=function(){jQuery("#fontResizeWrap").show(),jQuery("#mailContentWrapper").wrapInner("<div></div>").find("*").contents().filter(function(){return this.nodeType==3&&jQuery.trim(this.nodeValue)}).each(function(e,t){var n=getComputedStyle(this.parentNode),r=n.fontSize.replace("px",""),i=n.lineHeight.replace("px","");jQuery(this).wrap('<span data-font-resize data-origin-fontsize="'+r+'" '+'data-origin-lineheight="'+i+'" '+'style="font-size:'+r+"px;line-height:"+i+'px" />')})},this.makeReadSwipeEvent=function(){var t=jQuery("#leftHandle"),n=jQuery("#rightHandle");jQuery("#mailViewContentWrap").swipe({swipeLeft:function(t,n,r,i,s){if(!(e.nextUid>0)){alert(mailMsg.mail_last_message);return}readMessage(e.nextNavi.folderName,e.nextNavi.uid)},swipeRight:function(t,n,r,i,s){if(!e.preNavi){alert(mailMsg.mail_first_message);return}readMessage(e.preNavi.folderName,e.preNavi.uid)},swipeStatus:function(e,r,i,s,o,u){r=="start"?(t.css("right","-50px").hide(),n.css("left","-50px").hide()):r=="move"?i=="left"?(n.css("left","-50px").hide(),t.show(),s<=50&&t.css("right",-50+s+"px")):i=="right"&&(t.css("right","-50px").hide(),n.show(),s<=50&&n.css("left",-50+s+"px")):r=="end"&&(t.css("right","-50px").hide(),n.css("left","-50px").hide())},threshold:100})},this.convertIcalTemplate=function(e){if(!e||e.length==0)return"";for(var t=0;t<e.length;t++){var n=e[t].icalRecurrence;e[t].icalRecurrenceMsg="",n!=""&&n!=null&&(e[t].icalRecurrenceMsg=recurrenceParser(e[t].icalRecurrence),e[t].icalStartDate="");var r=jQuery.trim(e[t].icalSubject);if(r==""||r==null)e[t].icalSubject=mailMsg.header_nosubject}return getHandlebarsTemplate("mail_icalendar_tmpl",e)},this.writeMessage=function(t,n){t.init||progressAction({action:!0}),t.init=null,this.writeParam=t,ActionLoader.postGoJsonLoadAction(this.writeAction,t,e.printWriteMessage,"json"),jQuery(window).off("scroll.renderNewPage"),google.sendPageView(this.writeAction),n||historyControl.setHistory({type:"empty",param:t})},this.printWriteMessage=function(t){LOCAL_DOMAIN=t.localDomain?t.localDomain:"",changeMailContainer("write"),e.listMode="mail",currentMenu="write",notiMode=t.notiMode,sendConfirm=t.sendConfirm;var n={isWrite:!0};t.isMobileWeb=MOBILE_WEB,e.makeMailWriteContent(t),progressAction({action:!1}),e.makeMailWriteHeader(n),e.makeMailWriteToolbar(t),e.writeData=t,e.convertSendData(t),mailWriteInit(t),isMaxSendMailCountUse=t.sendMailCount.maxSendMailCountUse,maxSendMailCount=t.sendMailCount.maxSendMailCount},this.convertSendData=function(e){this.sendData={},this.sendData.senderEmail=e.senderEmail,this.sendData.senderName=e.senderName,this.sendData.sendType=e.writeType,this.sendData.sendFlag=e.sendFlag,this.sendData.charset=e.encoding,this.sendData.folderName=e.folderName,this.sendData.uids=e.uids,this.sendData.orgMessageId=e.orgMsgId,this.sendData.draftMessageId=e.draftMsgId},this.makeMailWriteHeader=function(e){jQuery("#mail_header .mailHeaderWrap").hide(),jQuery("#mail_write_header").show()},this.makeMailWriteToolbar=function(e){jQuery("#mailHomeToolbarWrap").hide(),jQuery("#mailListToolbarWrap").hide(),jQuery("#mailReadToolbarWrap").hide(),jQuery("#mailWriteToolbarWrap").show(),jQuery("#mailWriteBtn").hide(),USE_CONTACT||jQuery("#contactButton").hide(),jQuery("#toolbar_wrap").show()},this.makeMailWriteContent=function(e){jQuery("#main_content").handlebars("mail_write_content_tmpl",jQuery.extend({},e,{isAndroidApp:isAndroidApp(),isWebFolderUsable:USE_WEBFOLDER}))},this.getSignList=function(e){ActionLoader.getGoLoadAction(this.signListAction,null,function(e){if(e&&e.length>0){var t=jQuery("#signListWrap").data("attach");e.useAttach=t,jQuery("#signListWrap").html(getHandlebarsTemplate("mail_layer_sign_tmpl",e)),jQuery("#signWrap").show()}},"json")},this.loadMdnList=function(t,n){t=t?t:{},this.listParam=t,this.dataSet={},progressAction({action:!0}),ActionLoader.postGoLoadAction(this.mdnListAction,t,e.printMdnList,"json"),jQuery(window).off("scroll.renderNewPage"),jQuery(window).on("scroll.renderNewPage",jQuery.proxy(this.detectScroll,this)),google.sendPageView(this.mdnListAction),n||historyControl.setHistory({type:"mdnlist",param:t})},this.printMdnList=function(t){e.selectedMailId=_.isNull(sessionStorage.getItem("SELECTED-DOC-ID"))?null:sessionStorage.getItem("SELECTED-DOC-ID"),e.pageNo=_.isNull(sessionStorage.getItem("PAGE-NO"))?1:parseInt(sessionStorage.getItem("PAGE-NO")),sessionStorage.removeItem("SELECTED-DOC-ID"),sessionStorage.removeItem("PAGE-NO"),e.nextPage=1,e.lastPage=t.pageInfo.pages.length,e.listMode="mdnlist",currentMenu="list",changeMailContainer("list");var n={isMdnList:!0};jQuery("#main_content").empty();if(e.pageNo>=2){var r=e.pageNo;for(var i=1;i<=r;i++)e.pageNo=i,e.dataFetch(i)}else e.makeMailMdnListContent(t);e.scrollToEl(),e.makeMailMdnListToolbar(t),changeStatusBarColor(!1),progressAction({action:!1})},this.makeMailMdnListToolbar=function(e){jQuery("#mailHomeToolbarWrap").show(),jQuery("#mailHomeToolbarWrap div.optional").hide(),jQuery("#mailWriteToolbarWrap").hide(),jQuery("#mailReadToolbarWrap").hide(),jQuery("#toolbar_wrap").show(),jQuery("#top_menu_title").text(mailMsg.menu_receivenoti)},this.makeMailMdnListContent=function(e){jQuery("#main_content").append(getHandlebarsTemplate("mail_mdn_list_content_tmpl",e))},this.loadMdnRead=function(t,n){this.readParam=t,progressAction({action:!0}),ActionLoader.postGoLoadAction(this.mdnReadAction,t,e.printMdnRead,"json"),jQuery(window).off("scroll.renderNewPage"),google.sendPageView(this.mdnReadAction),n||historyControl.setHistory({type:"mdnread",param:t})},this.printMdnRead=function(t){e.nextPage=1,e.listMode="mdnread",currentMenu="list",changeMailContainer("list");var n={isMdnRead:!0};t.subject=e.readParam.subject,t.dateUtc=e.readParam.dateUtc,e.makeMailMdnReadToolbar(t),e.makeMailMdnReadContent(t),progressAction({action:!1})},this.makeMailMdnReadToolbar=function(e){jQuery("#mailHomeToolbarWrap").hide(),jQuery("#mailWriteToolbarWrap").hide(),jQuery("#mailListToolbarWrap").hide(),jQuery("#mailWriteBtn").show();var t=jQuery("#mailReadToolbarWrap");t.show(),t.find("li").not(".moreItemLi").remove(),t.find("div.optional").hide();var n=[];this._renderHeaderToolBar(t,n)},this.makeMailMdnReadContent=function(e){jQuery("#main_content").handlebars("mail_mdn_read_tmpl",e)},this.deleteMdn=function(t){ActionLoader.postGoLoadAction(this.deleteMdnAction,t,function(t){e.reloadMessageList()},"json")},this.recallMessage=function(t){ActionLoader.postGoLoadAction(this.recallMessageAction,t,function(t){e.reloadMessageList()},"json")},this.sendMdnResponse=function(e){ActionLoader.postGoJsonLoadAction(this.sendMdnResponseAction,e,function(e){alert(mailMsg.mail_send_success)},"json")},this.searchMessage=function(e){this.loadMessageList(e)},this.copyMessage=function(t){t=this.getSharedFolderParam(t),ActionLoader.postGoJsonLoadAction(this.copyMessageAction,t,function(t){e.reloadMessageList()},"json",function(e){alert(e.message)})},this.moveMessage=function(t){t=this.getSharedFolderParam(t),ActionLoader.postGoJsonLoadAction(this.moveMessageAction,t,function(t){e.reloadMessageList()},"json",function(e){alert(e.message)})},this.taggingMessage=function(t){ActionLoader.postGoJsonLoadAction(this.taggingMessageAction,t,function(t){currentMenu=="read"?e.reloadReadMessage():e.reloadMessageList()},"json")},this.writeDeptAddrInfo=function(e){ActionLoader.getLoadAction(this.deptSelectAction,{},function(t){jQuery("#writeDeptAddrSelect").handlebars("addr_dept_select_tmpl",t),jQuery("#writeDeptAddrLink span.txt").text(jQuery("#writeDeptAddrSelect option:first").text()),e&&e()},"json")},this.writeAddrSelect=function(t){var n=sessionStorage.getItem("GO-Agent-mail");jQuery("#mailWriteToolbarWrap").hide(),jQuery(".list_employee_new").length===0&&(e.selectedNodes=[]),jQuery("#companyText").nextAll().andSelf().remove(),jQuery("#companySelect").nextAll().andSelf().remove(),jQuery("#addr_dept_list").empty(),jQuery("#addr_member_list").empty(),t=t?t:{},this.addrParam=t;var r=this.writeAddrSelectAction,i=t.name,s=this.makeWriteAddrListContent;t.ownerType=="company"&&!t.isReadable&&(s=this.makeNotReadableListContent),t.ownerType=="department"&&(t.deptId=t.deptId?t.deptId:jQuery("select.dept_addr_select").val(),this.addrParam.deptId=t.deptId),t.ownerType=="emp"?n==="BROWSER"?i=t.keyword:(jQuery("#mailWriteToolbarWrap").show(),setCookie("ContactViewTypeMobile","user",365),isIphoneApp()?window.location="gomobile://callOrgDept?&addReceiverSuccess&addReceiverFail":isAndroidApp()&&window.GOMobile.callOrgDept("addReceiverSuccess","addReceiverFail")):t.keyword?r=this.writeAddrSearchAction:t={page:t.page||0,offset:20,property:"nameInitialConsonant",direction:"asc",keyword:"",type:t.ownerType.toUpperCase()||"",groupId:t.groupId||"",deptId:t.deptId||jQuery("select.dept_addr_select").val()},currentMenu="addr",changeMailContainer("addr"),makeTopMenuTitle(mailMsg.addr_list_write_select),e.addrNextPage=1,t.ownerType=="emp"?(jQuery("#users_list_title").text(mailMsg.common_org_dept_staff),jQuery("#dept_list_title").show(),n==="BROWSER"&&(jQuery.trim(i)!=""||!_.isUndefined(i)?e.fetchOrgMemberBySearch(i):(jQuery(".list_employee_new").remove(),e.fetchOrgMember("",function(t){e.setHeaderCrumbList(t),e.setOrgMemberByCompany(t)})))):(jQuery("#users_list_title").text(mailMsg.addr_user),jQuery("#dept_list_title").hide(),jQuery(".list_employee_new").remove(),ActionLoader.getLoadAction(r,t,function(e){i&&jQuery.trim(i)!=""&&(e.search=!0),e.search||s(e)},"json")),jQuery(window).off("scroll.renderNewPage"),google.sendPageView(r),t.isInit&&historyControl.setHistory({type:"addr",param:t})},this.makeNotReadableListContent=function(e){jQuery("#addr_member_list").handlebars("addr_no_readable_mail_tmpl")},this.makeWriteAddrListContent=function(e){var t=e.page,n=t.page+1,r={};r.firstPage=n==1,r.prePage=n-1,r.page=n,r.pageSize=t.offset,r.total=t.total,r.lastPage=t.lastPage,r.nextPage=n+1;var i={};i.data=e.data,i.pageInfo=r,jQuery("#addr_member_list").handlebars("addr_write_mail_tmpl",i)},this.setHeaderCrumbList=function(t){var n=[],r=e.getCompanyList(t);_.each(r,function(e){n.push(e.data.title)});if(jQuery("select[name=companySelect]").text()===n.join(""))return;if(r.length>=2){e.isMultiSite=!0;var i='<select id="companySelect" name="companySelect"></select>';jQuery("#userCheckedScroll").append(i),_.each(r,function(e){jQuery("select[name=companySelect]").text().indexOf(e.data.title)===-1&&jQuery("#companySelect").append('<option value="'+e.data.id+'">'+e.data.title+"</option>")})}else{var i='<a id="companyText">'+mailMsg.mail_search_all+"</a>";jQuery("#userCheckedScroll").append(i)}},this.getCompanyList=function(e){var t=[];return _.each(e,function(e){e.data.id.indexOf("company")!==-1&&t.push(e)}),t},this.getFetchOrgUrl=function(e){var t="/api/organization/multi/list",n;return _.isEmpty(e)?n=t+"?type=mydept":n=t+"?deptid="+e+"&type=child",n},this.fetchOrgMember=function(t,n){jQuery.ajax({method:"GET",reset:!0,url:e.getFetchOrgUrl(t),success:function(t){e.depts=[],e.users=[],n(t),e.drawOrgMember()}})},this.setOrgMemberByCompany=function(t){var n=jQuery("#companyText").length>=1,r=jQuery("#companySelect").length!==0&&jQuery("#companySelect").children.length>=2;if(n)e.setOrgMemberByPosition(t[0].children);else if(r){var i=jQuery("select[name=companySelect]").val();_.any(t,function(t){if(t.data.id===i)return e.setOrgMemberByPosition(t.children),!0})}else e.setOrgMemberByPosition(t)},this.setOrgMemberByPosition=function(t){_.each(t,function(t){if(t.data.id.includes("org")){var n=t.metadata.childrenCount>0||t.metadata.memberCount>0;e.depts.push({title:t.data.title,id:t.metadata.id,email:t.metadata.email,originalEmail:t.metadata.email,name:t.metadata.name,type:t.data.id.split("_")[0],includedSubDept:!1,code:t.metadata.code,useReception:t.metadata.useReception,useReference:t.metadata.useReference,hasDeptChildren:n})}else _.contains(["MASTER","MODERATOR","MEMBER"],t.data.id.split("_")[0])&&e.users.push({nodeId:t.attr.nodeId,id:t.metadata.id,companyName:t.metadata.companyName,email:t.metadata.email,originalEmail:t.metadata.email,name:t.metadata.name,type:t.data.id.split("_")[0],duty:t.metadata.duty,deptId:t.metadata.deptId,departments:t.metadata.deptName,position:t.metadata.position,displayName:t.metadata.name+t.metadata.position,thumbnail:t.metadata.thumbnail,employeeNumber:t.metadata.employeeNumber,loginId:t.metadata.loginId})})},this.fetchOrgMemberBySearch=function(t){jQuery.ajax({method:"GET",reset:!0,async:!1,url:"/api/org/user/sort/list?nodeType=org&page=0&keyword="+encodeURIComponent(t),success:function(t){e.depts=[],e.users=[],e.setOrgMemberBySearch(t.data),e.drawOrgMember()}})},this.setOrgMemberBySearch=function(t){if(t.length<1)return;var n=[];_.each(t,function(t){n.indexOf(t.id)===-1&&(n.push(t.id),t.nodeType=="user"?e.users.push({nodeId:t.employeeNumber,id:t.id,companyName:t.companyName,email:t.email,originalEmail:t.originalEmail,name:t.name,type:"user",duty:t.duties[0],deptId:t.departmentIds[0],departments:t.departments,position:t.position,displayName:t.name+t.position,thumbnail:t.thumbnail,employeeNumber:t.employeeNumber,loginId:t.loginId,isMultiCompany:e.isMultiSite}):t.nodeType=="department"&&e.depts.push({title:t.name,id:t.id,email:t.email,originalEmail:t.email,name:t.name,type:"org",includedSubDept:!1,userReception:t.useReception,useReference:t.useReference,isMultiCompany:e.isMultiSite,companyName:t.companyName}))})},this.removeOrgList=function(){jQuery("#companySelect").nextAll().remove(),jQuery("#addr_dept_list").empty(),jQuery("#addr_member_list").empty()},this.drawOrgMember=function(t){var n={},r={};n.mailExposure=MAIL_EXPOSURE,r.mailExposure=MAIL_EXPOSURE,r.data=e.depts,n.data=e.users,jQuery("#addr_dept_list").handlebars("mail_org_dept_tmpl",r),jQuery("#addr_member_list").handlebars("mail_org_member_tmpl",n),jQuery("select[name=companySelect]").off(),jQuery("select[name=companySelect]").on("change",function(t){e.removeOrgList(),e.fetchOrgMember("",e.setOrgMemberByCompany)}),jQuery("select[name=companySelect]").on("vclick",function(t){e.removeOrgList(),e.fetchOrgMember("",e.setOrgMemberByCompany)}),jQuery("#companyText").off(),jQuery("#companyText").on("vclick",function(t){jQuery("#companyText").nextAll().remove(),e.fetchOrgMember("",e.setOrgMemberByCompany)}),jQuery(".dept_info").off(),jQuery(".dept_info").on("vclick",function(t){var n=jQuery(t.currentTarget);n.prop("disabled",!0);if(n.find(".ic.ic_arrow4").length===0)return;var r=n.attr("data-id").split("_")[1],i=n.text();jQuery("#userCheckedScroll").append('<a id="sub_dept" class="orgDepthspan" data-id="'+r+'">'+i+"</a>"),e.fetchOrgMember(r,e.setOrgMemberByPosition)}),jQuery(".orgDepthspan").off(),jQuery(".orgDepthspan").on("vclick",function(t){var n=jQuery(t.currentTarget);n.nextAll().remove();var r=n.attr("data-id");e.fetchOrgMember(r,e.setOrgMemberByPosition)}),jQuery(".btn.btn_plus").off(),jQuery(".btn.btn_plus").on("vclick",function(t){t.preventDefault();var n=jQuery.extend({},e.depts),r=jQuery.extend({},e.users),i=jQuery(t.currentTarget).attr("value"),s=i.split("_")[0],o=i.split("_")[1],u=_.find(n,function(e){return e.type===s&&e.id==o}),a=_.find(r,function(e){return e.type==s&&e.id==o});if(_.isUndefined(u)&&_.isUndefined(a)){alert(mailMsg.error_noselect);return}var f=_.isUndefined(u)?a:u;f.dataId=i,s=="org"&&(f.includedSubDept=confirm(mailMsg.mail_subdept_include));var l=_.some(e.selectedNodes,function(e){return e.dataId===i});if(l){alert(mailMsg.alert_same);return}e.selectedNodes.push(f);if(jQuery("div.list_employee_new").length<1){var c='<div class="list_employee_new"><ul class="name_tag" id="activeBar"></ul></div>';jQuery("div.docu_search").before(c)}if(f.includedSubDept){var h=[],p="/api/organization/dept/tree?deptid="+o+"&scope=subdept";jQuery.ajax({method:"GET",reset:!0,async:!1,url:p,success:function(t){h=t,e.setOrgMemberByPosition(t),_.each(t,function(t){var n=t.attr.id,r=_.any(e.selectedNodes,function(e){return e.dataId===n});if(!r){var i=mailMsg.mail_search_name_department,s=t.attr.title,o='<a value="'+n+'" class="nameTagItem"><li><div class="depart"><span class="txt">'+i+'</span></div><span class="name">'+s+'</span><span class="btn_wrap" id="btn_del" value="'+n+'"><span class="btn btn_del_type2"></span></span></li></a>';jQuery("#activeBar").append(o);if(f.dataId!==n){var u=n.split("_")[0],a=n.split("_")[1],l=_.find(e.depts,function(e){return e.type===u&&e.id==a});l.dataId=n,e.selectedNodes.push(l)}}})}})}var d=null;if(s!="org")d='<a value="'+f.dataId+'" class="nameTagItem"><li><div class="photo"><img src="'+f.thumbnail+'"></div><span class="name">'+f.name+'</span><span class="btn_wrap" id="btn_del"  value="'+f.dataId+'"><span class="btn btn_del_type2"></span></span></li></a>';else{var i=f.dataId,v=mailMsg.mail_search_name_department,m=f.name;d='<a value="'+i+'" class="nameTagItem"><li><div class="depart"><span class="txt">'+v+'</span></div><span class="name">'+m+'</span><span class="btn_wrap" id="btn_del"  value="'+i+'"><span class="btn btn_del_type2"></span></span></li></a>'}jQuery("#activeBar").append(d),jQuery(".nameTagItem").on("vclick",function(t){t.preventDefault();var n=jQuery(t.currentTarget).attr("value"),r=0;_.any(e.selectedNodes,function(e){if(e.dataId===n)return!0;r++}),e.selectedNodes.length!==r&&e.selectedNodes.splice(r,1),_.isEmpty(e.selectedNodes)&&jQuery("div.list_employee_new").remove(),jQuery(".name_tag").find("a[value="+n+"]").remove()})})},this.moveAddrPage=function(t){t-=1,this.addrParam.page=t,e.writeAddrSelect(this.addrParam)},this.reloadWriteAddrSelect=function(){e.writeAddrSelect(this.addrParam)},this.makeDeptSelectOptions=function(e){jQuery(".addr_select").val("user"),jQuery(".dept_addr_select").hide(),addrAction=this.deptSelectAction,addrResultFunc=this.makeDeptSelectOptions;var t=jQuery("#addr_content select.dept_addr_select");ActionLoader.getLoadAction(addrAction,{},function(e){jQuery("#addr_content select.dept_addr_select").handlebars("addr_dept_select_tmpl",e),t.closest("a").find("span.txt").text(t.find("option:first").text())},"json")},this.deleteMessages=function(t){ActionLoader.postGoJsonLoadAction(this.deleteMessageAction,t,function(t){e.reloadMessageList(!0)},"json")},this.switchMessagesFlags=function(t,n,r,i,s){var o={};o=this.getSharedFolderParam(o),o.folderNames=n,o.uids=t,o.flagType=r,o.used=i,ActionLoader.postGoJsonLoadAction(this.switchFlagAction,o,function(t){s?changeFlagReadView(i,r):r=="F"?changeFlagView(i,r,t):e.reloadMessageListWithUseHistory()},"json")},this.movePage=function(e){var t=this.listParam;this.listMode=="mdnread"&&(t=this.readParam),t==null&&(t={}),t.page=e,this.listParam=t,this.listMode=="mail"?this.loadMessageList(t):this.listMode=="mdnlist"?this.loadMdnList(t):this.listMode=="mdnread"&&this.loadMdnRead(t)},this.reloadMessageListWithUseHistory=function(){this.reloadMessageList(!0)},this.reloadMessageList=function(e){ignoreHistory=e?!1:!0,this.listMode=="mail"?this.loadMessageList(this.listParam,ignoreHistory):this.listMode=="mdnlist"?this.loadMdnList(this.listParam,ignoreHistory):this.listMode=="mdnread"&&this.loadMdnRead(this.readParam,ignoreHistory)},this.reloadWriteMessage=function(){this.writeMessage(this.writeParam)},this.sendMessage=function(t){progressAction({action:!0}),ActionLoader.postGoJsonLoadAction(this.sendAction,t,function(n){if(t.sendType=="draft"){if(!n.isError){alert(mailMsg.mail_drafts_success),progressAction({action:!1});var r=mailControl.getSendData();r.draftMessageId=n.messageId}}else e.sendMessageResult(n),progressAction({action:!1});!n.isError&&(isAndroidApp()||isIphoneApp())&&(mailSendComplete(),isAndroidApp()&&progressAction({action:!1}))},"json"),t.sendType!="draft"&&(jQuery(window).off("scroll.renderNewPage"),google.sendPageView(this.sendAction))},this.sendMessageResult=function(t){currentMenu="send",changeMailContainer("send");var n={isSend:!0};e.makeMailSendHeader(n),e.makeMailSendToolbar(t),e.makeMailSendContent(t),executeFolderInfo()},this.makeMailSendHeader=function(e){jQuery("#mail_header .mailHeaderWrap").hide(),jQuery("#mail_send_header").show()},this.makeMailSendToolbar=function(e){jQuery("#toolbar_wrap").hide()},this.makeMailSendContent=function(e){jQuery("#main_content").handlebars("mail_send_content_tmpl",e)},this.makeSubToolbar=function(e,t){var n=e.closest("li"),r=n.find("div.array_option");if(r.css("display")=="none"){var i=jQuery("#toolbar_wrap");isSearchResult()&&(i=jQuery("#searchResultNav")),i.find("div.array_option").hide(),r.show();var s;e.bind("mouseover",function(){s&&clearTimeout(s)}),e.bind("mouseout",function(){s=setTimeout(function(){r.hide()},500)}),n.bind("mouseout",function(){s=setTimeout(function(){r.hide()},500)}),n.bind("mouseover",function(){s&&clearTimeout(s)}),t=="move"&&r.bind("mouseover",function(){s&&clearTimeout(s)})}else e.unbind(),r.hide()},this.getCurrentFolder=function(){return this.currentFolder},this.getSendData=function(){return this.sendData},this.setSendData=function(e){this.sendData=e},this.getListMode=function(){return this.listMode},this.getAddrParam=function(){return this.addrParam},this.getSharedFolderParam=function(e){return this.sharedFlag?(e.sharedFlag="shared",e.sharedUserSeq=this.listParam.sharedUserSeq,e.sharedFolderName=this.listParam.sharedFolderName):(e.sharedFlag="user",e.sharedUserSeq="0",e.sharedFolderName=""),e},this.makeMailEvent=function(){function n(e,t){var n=e.find("option:"+(t?"selected":"first")).text();e.closest("a").find("span.txt").text(n)}var t=this;jQuery(document).on("click",function(e){var t=jQuery(e.currentTarget).find("#more_layout");closeMoreLayout(t)}),jQuery("header").on("vclick","#mailWriteBtn",function(e){hideMailFolderSide(),goWrite()}),jQuery("header #search_wrap").on("vclick","a",function(e){var t=jQuery(this).attr("evt-rol");if(!t)return;e.stopPropagation?e.stopPropagation():e.cancelBubble=!0,e.preventDefault(),closeMoreLayout(),t=="search-message"?searchGoMessage():t=="search-cancel"&&(currentMenu=="addr"?searchAddrCancel():searchMessageCancel())}),jQuery("#mailHomeToolbarWrap").on("vclick","a",function(t){var n=jQuery(this).attr("evt-rol");if(!n)return;t.stopPropagation?t.stopPropagation():t.cancelBubble=!0,t.preventDefault(),closeMoreLayout(),n=="toggle-folder-side"?toggleMailFolderSide():n=="write-mail"?goWrite():n=="toggle-search-message"?toggleSearchMessageWrap():n=="goto-gohome"?escapewriteAndGoHome():n=="mail-refresh"?e.reloadMessageList():n=="move-folder-cancel"||n=="tag-message-cancel"?(gotoHistoryBack(),currentMenu=="list"?changeMailContainer("list"):changeMailContainer("read")):n=="download-attach-confirm-close"?(jQuery("#attachOverlay").hide(),jQuery("#downloadAttachConfirmLayer").hide()):n=="send-check-cancel"&&(checkSendMessageCancel(),jQuery("#attachOverlay").hide())}),jQuery("#mailWriteToolbarWrap").on("click","a,span,p",function(e){var t=jQuery(this).attr("evt-act");if(!t)return;e.stopPropagation?e.stopPropagation():e.cancelBubble=!0,e.preventDefault(),t=="write-cancel"?(document.activeElement.blur(),MOBILE_WEB?history.back():historyControl.historyIdx==1?isAndroidApp()?window.GOMobile.goHome():window.location.href="gomobile://goHome":isAndroidApp()?window.GOMobile.pressBackKey():history.back()):t=="write-add-address"?writeAddrSelect():t=="send-mail"&&setTimeout(function(){sendMessage()},100)}),jQuery("#mailReadToolbarWrap,#mailListToolbarWrap, #mailWebFolderSelectToolbarWrap, #mailWebSubFolderToolbarWrap").on("click","a,span,p",function(t){var n=jQuery(this).attr("evt-rol");if(!n)return;t.stopPropagation?t.stopPropagation():t.cancelBubble=!0,t.preventDefault();if(n=="toolbar"){if(currentMenu=="list"){var r="on"==jQuery(this).attr("ignore");if(!r&&getMailListCheckedCount()==0){alert(mailMsg.mail_message_notselect);return}}var i="on"==jQuery(this).attr("sub"),s=jQuery(this).attr("menu");if(i)e.makeSubToolbar(jQuery(this),s);else{var o=jQuery(this).attr("evt-act");if(o=="mail-select-all"){var u=jQuery(this).data("checked");u?(jQuery("input[name=msgId]").each(function(){jQuery(this).prop("checked",!1),checkMailListCheckbox(jQuery(this))}),jQuery(this).data("checked",!1),jQuery(this).find("span.txt").text(mailMsg.mail_select_all)):(jQuery("input[name=msgId]").each(function(){jQuery(this).prop("checked",!0),checkMailListCheckbox(jQuery(this))}),jQuery(this).data("checked",!0),jQuery(this).find("span.txt").text(mailMsg.mail_select_all_cancel))}else o=="mail-delete"?e.listMode=="mdnlist"?(deleteMdn(),jQuery("#mailHomeToolbarWrap").show(),jQuery("#mailListToolbarWrap").hide(),changeStatusBarColor(!1)):deleteMessage():o=="mail-forward"?forwardMessage("parsed"):o=="mail-reply"?replyWrite("reply"):o=="mail-reply-all"?replyWrite("replyall"):o=="write-add-address"?writeAddrSelect():o=="move-message-page"?(moveMessagePage(),closeMoreToolbarLayer()):o=="tag-message-page"?(tagMessagePage(),closeMoreToolbarLayer()):o=="read-pre-message"?readMessage(e.preNavi.folderName,e.preNavi.uid):o=="read-next-message"?readMessage(e.nextNavi.folderName,e.nextNavi.uid):o=="toggle-more-layout"?e.makeSubToolbar(jQuery(this),s):o=="change-flag-seen"?changeSeenFlag(!0):o=="change-flag-unseen"?changeSeenFlag(!1):o=="mail_spam_move"&&(alert(mailMsg.mail_spam_move),copyMoveMessage("Trash"))}}else if(n=="reload-list")e.reloadMessageList();else if(n=="goto-prev-page"){if(jQuery("#searchResultWrap ul").length!=0){jQuery("#goSearch").show(),jQuery("#searchResultWrap").show();return}setTimeout(function(){gotoHistoryBack()},100)}else if(n=="checked-cancel")closeToolbarMenu();else if(n=="checked-webfolder-cancel")e.resetCheckedWebFolder();else if(n=="move-parent-webfolder")e.currentWebFolderInfo={},e.currentWebFolderInfo.param=e.webFolderParamHistoryList.pop(),_.contains(e.currentWebFolderInfo.param.path,jQuery("#mailWebSubFolderToolbarWrap h1").text().trim())&&(e.currentWebFolderInfo.param=e.webFolderParamHistoryList.pop()),e.webFolderParamHistoryList.length===0?(jQuery("#mailWebFolderHomeToolbarWrap").show(),jQuery("#mailWebSubFolderToolbarWrap").hide(),e.webFolderParamHistoryList.push(e.currentWebFolderInfo.param)):(jQuery("#mailWebSubFolderToolbarWrap").show(),jQuery("#mailWebFolderHomeToolbarWrap").hide(),jQuery("#mailWebSubFolderToolbarWrap h1").text(e.currentWebFolderInfo.param.path.split(".").slice(-1)[0])),e.currentWebFolderInfo.param.currentPage=1,e.fetchWebFolderList(e.currentWebFolderInfo.param);else if(n=="select-webfolder-all")jQuery("#select-all").text()===mailMsg.mail_select_all?(jQuery("#webfolder_list input[type=checkbox]").prop("checked",!0),jQuery("#select-all").text(mailMsg.mail_select_all_cancel)):(jQuery("#webfolder_list input[type=checkbox]").prop("checked",!1),jQuery("#select-all").text(mailMsg.mail_select_all)),judgmentWebFolderCheckList();else if(n=="attach-webfolder"){progressAction({action:!0}),jQuery(window).off("scroll.renderNewWebFolderPage");var a=jQuery("div.webFolderHeader:visible"),f={path:a.attr("data-path"),sharedUserSeq:a.attr("data-userseq")===""?0:a.attr("data-userseq"),sroot:a.attr("data-sroot"),type:a.attr("data-type")},l=[];_.each(jQuery("#webfolder_content").find("li input:checked"),function(e){l.push(jQuery(e).data("uid").toString())}),e.resetCheckedWebFolder(),jQuery("#mailWebFolderHomeToolbarWrap").hide(),jQuery("#mailWebSubFolderToolbarWrap").hide(),jQuery("#mailWriteToolbarWrap").show(),f=_.extend(f,{uids:l}),changeMailContainer("write"),ActionLoader.postSyncGoJsonLoadAction(e.webfolderAttachWriteAction,f,function(e){progressAction({action:!1}),checkUploadfile(e)},"json",function(){alert(mailMsg.alert_attachFile)})}}),jQuery("#main_content").on("touchstart","a.flagClass",function(e){var t=jQuery(this).attr("tap-rol");if(t=="switch-flag"){var n=jQuery(this).find("span.ic"),r=n.attr("flag"),i="on"==n.attr("flaged"),s=n.closest("li").attr("id");switchFlagFlaged([s],r,!i)}}),jQuery("#main_content").on("click","a,span,li",function(t){var n=jQuery(this).attr("evt-rol");if(!n)return;t.stopPropagation?t.stopPropagation():t.cancelBubble=!0,t.preventDefault();if(n=="switch-flag"){var r=jQuery(this).attr("flag"),i="on"==jQuery(this).attr("flaged"),s=jQuery(this).closest("li").attr("id");switchFlagFlaged([s],r,!i)}else if(n=="read-message"){var o=jQuery(this),u=o.attr("data-list-id"),a=Math.floor(_.indexOf(_.map(jQuery("ul.list_mail li>a"),function(e){return jQuery(e).attr("data-list-id")}),u.toString())/20)+1,f={listId:u};sessionStorage.setItem("PAGE-NO",a),sessionStorage.setItem("SELECTED-DOC-ID",JSON.stringify(f));var l=jQuery(this).closest("li").attr("folder"),c=jQuery(this).closest("li").attr("uid");readMessage(l,c)}else if(n=="draft-message"){var l=jQuery(this).closest("li").attr("folder"),c=jQuery(this).closest("li").attr("uid");writeDraftMessage(l,c)}else if(n=="mail-read-toggle-sender-list"){var h=jQuery("#mailReadSenderListWrap");h.css("display")=="none"?(h.show(),jQuery(this).find("span.ic_arrow2_down").removeClass("ic_arrow2_down").addClass("ic_arrow2_up"),setCookie("rcpt_show","on",365)):(h.hide(),jQuery(this).find("span.ic_arrow2_up").removeClass("ic_arrow2_up").addClass("ic_arrow2_down"),setCookie("rcpt_show","off",365)),e.Iscroll&&e.makeReadIscroll({isInitRendering:!1})}else if(n=="mail-read-toggle-attach-list"){var h=jQuery("#mailReadAttachListWrap");h.css("display")=="none"?(h.show(),jQuery(this).find("span.ic_arrow2_down").removeClass("ic_arrow2_down").addClass("ic_arrow2_up")):(h.hide(),jQuery(this).find("span.ic_arrow2_up").removeClass("ic_arrow2_up").addClass("ic_arrow2_down")),e.Iscroll&&e.Iscroll.refresh()}else if(n=="download-tnef-attach"){var l=jQuery("#folderName").val(),c=jQuery("#msgUid").val(),p=jQuery(this).closest("li").attr("part"),d=jQuery(this).attr("attkey");downLoadTnefAttach(l,c,p,d)}else if(n=="download-attach"){var v=jQuery(this).attr("evt-data"),m=jQuery("#attachFileWrap").attr("evt-confirm");if(v)openDownloadAttachConfirm();else{var l=jQuery("#folderName").val(),c=jQuery("#msgUid").val(),p=jQuery(this).closest("li").attr("part"),g=jQuery(this).closest("li").attr("fileName"),y=jQuery(this).closest("li").attr("fileSize"),b={folderName:l,uid:c,part:p,type:"normal"};b=e.getSharedFolderParam(b),downloadAttach(b,g,y)}}else if(n=="switch-flag-read"){var l=jQuery("#folderName").val(),c=jQuery("#msgUid").val(),r=jQuery(this).attr("flag"),i="on"==jQuery("#readFlagedFlagIcon").attr("flaged");e.switchMessagesFlags([c],[l],r,!i,!0)}else if(n=="show-contents-view"){var w=jQuery("#message_view_table").html();POPUPDATA=w;var E=location.protocol+"//"+window.location.host,S=E+"/app/mail/mobile/content";isAndroidApp()?window.GOMobile.viewHTML(encodeURIComponent(w)):isIphoneApp()?window.location.href="gomobile://viewHTML?"+encodeURIComponent(w):window.open(S,"","scrollbars=yes")}else if(n=="write-mail")goWrite();else if(n=="write-addr-select")jQuery(this).remove();else if(n=="write-toggle-ccbcc"){var x="open"==jQuery(this).data("toggle");x?(jQuery("#mail_write_table tr.ccbccWrap").hide(),jQuery(this).data("toggle","close")):(jQuery("#mail_write_table tr.ccbccWrap").show(),jQuery(this).data("toggle","open"))}else if(n=="attach-photo")selectAttachPhoto();else if(n=="attach-file"){var T=MAILCONFIG.maxAttachSize,N=MAILCONFIG.maxAttachCount,C="",k=jQuery("#attach_wrap li").size(),L=N-k,A=0;jQuery("#attach_wrap li").each(function(){A+=jQuery(this).attr("filesize")/1024/1024});if(T<A){alert(msgArgsReplace(mailMsg.mail_attach_limit_size,[T]));return}T-=A;if(N==0)L=-1;else if(L<1)return alert(msgArgsReplace(mailMsg.mail_attach_limit_count,[N])),!1;attachFile(T,L,C)}else if(n=="folder"){var O=jQuery(this).attr("fname");goFolder(O)}else if(n=="mdn-read"){var o=jQuery(this),u=o.attr("data-list-id"),a=Math.floor(_.indexOf(_.map(jQuery("ul.mail_mdn_list_area li>a"),function(e){return jQuery(e).attr("data-list-id")}),u.toString())/20)+1,f={listId:u};sessionStorage.setItem("PAGE-NO",a),sessionStorage.setItem("SELECTED-DOC-ID",JSON.stringify(f));var M=jQuery(this).attr("messageId"),D=jQuery(this).attr("subject"),P=jQuery(this).attr("date"),b={messageId:M,subject:D,dateUtc:P};e.loadMdnRead(b)}else if(n=="recall-mdn"){var H=jQuery(this).attr("addr");recallMsg([H])}else if(n=="delete-attach"){if(!confirm(mailMsg.mobile_delete_attach))return;jQuery(this).closest("li").remove()}else if(n=="preview-attach"){if(!isCallPreviewAttach){isCallPreviewAttach=!0,progressAction({action:!0});var l=jQuery("#folderName").val(),c=jQuery("#msgUid").val(),p=jQuery(this).closest("li").attr("part");previewAttach(c,l,p)}}else if(n=="preview-attach-temp"){if(!isCallPreviewAttach){isCallPreviewAttach=!0,progressAction({action:!0});var g=jQuery(this).closest("li").attr("filename"),B=jQuery(this).closest("li").attr("orgname"),j=jQuery(this).closest("li").attr("hostid");previewAttachTemp(B,g,j)}}else if(n=="preview-attach-image"){progressAction({action:!0});var l=jQuery("#folderName").val(),c=jQuery("#msgUid").val(),p=jQuery(this).closest("li").attr("part"),g=jQuery(this).closest("li").attr("fileName");previewAttachImage(c,l,p,g)}else if(n=="layer-write-email"){var H=jQuery(this).parent().attr("email");goWrieLoad({to:H})}else if(n=="read-nested-pop"){var l=jQuery("#folderName").val(),c=jQuery("#msgUid").val(),p=jQuery(this).closest("li").attr("part");readNestedMessage(l,c,p)}else if(n=="ext-url"){var F=jQuery(this).attr("href");executeExtUrl(F)}else if(n=="list-page-move"){var I=jQuery(this).attr("page");e.movePage(I),jQuery(document).scrollTop(0)}else n=="mail-read-font-resize"?(jQuery("#fontResizeLayer").toggle(),fontResizeEventBind()):n=="open-write-webfolder"&&(jQuery(window).off("scroll.renderNewWebFolderPage"),jQuery(window).on("scroll.renderNewWebFolderPage",jQuery.proxy(e.detectWebFolderListScroll,this)),jQuery("#mailWriteToolbarWrap").hide(),jQuery("#mailWebFolderHomeToolbarWrap").show(),jQuery("#mailWebSubFolderToolbarWrap").hide(),jQuery("#webFolderDirectory").val("user").attr("selected","selected"),e.webFolderParamHistoryList=[],e.currentWebFolderInfo={},e.currentWebFolderInfo.param={path:"/",fullPath:"/"},changeMailContainer("webFolder"),e.getSharedFolderList(),e.webFolderParamHistoryList.push(e.currentWebFolderInfo.param),e.fetchWebFolderList(e.currentWebFolderInfo.param))}),jQuery("#main_content").on("click","input",function(e){var t=jQuery(this).attr("evt-rol");if(!t)return;if(t=="write-myself"){var n=jQuery(this).attr("checked");makeWriteMyself(n)}}),jQuery("#attachLayer").on("click","a",function(e){closeAttachPhoto();var t=jQuery(this).attr("evt-rol");if(!t)return;e.stopPropagation?e.stopPropagation():e.cancelBubble=!0,e.preventDefault(),t=="attach-take-picture"?attachTakePicuture():t=="attach-select-album"&&attachSelectAlbum()}),jQuery("#sendCheckLayer").on("click","span, a",function(e){var t=jQuery(this).attr("evt-rol");if(!t)return;t=="send-check-ok"?(checkSendMessage(),checkSendMessageCancel(),jQuery("#attachOverlay").hide()):t=="send-check-cancel"?(checkSendMessageCancel(),jQuery("#attachOverlay").hide()):t=="send-check-apply"&&(settingWriteInfo(),checkSendMessageCancel(),jQuery("#attachOverlay").hide())}),jQuery("#downloadAttachConfirmLayer").on("click","span, a",function(t){var n=jQuery(this).attr("evt-rol");if(!n)return;if(n=="download-attach-confirm-close")jQuery("#attachOverlay").hide(),jQuery("#downloadAttachConfirmLayer").hide();else if(n=="attach-confirm-layer-download"){var r=jQuery("#folderName").val(),i=jQuery("#msgUid").val(),s=jQuery(this).closest("li").attr("part"),o=jQuery(this).closest("li").attr("fileName"),u=jQuery(this).closest("li").attr("fileSize"),a={folderName:r,uid:i,part:s,type:"normal"};a=e.getSharedFolderParam(a),downloadAttach(a,o,u)}}),jQuery("#main_content").on("tap","input[type=file]",function(e){var t=jQuery(this).attr("evt-rol");if(!t)return;var n=MAILCONFIG.maxAttachCount,r=jQuery("#attach_wrap li").size(),i=n-r;if(n==0)i=-1;else if(i<1)return alert(msgArgsReplace(mailMsg.mail_attach_limit_count,[n])),!1;return!0}),jQuery("#main_content").on("change","input[type=file]",function(t){var n=jQuery(this).attr("evt-rol");if(!n)return;t.stopPropagation?t.stopPropagation():t.cancelBubble=!0,t.preventDefault();if(n=="attach-image"){var r=jQuery(this).get(0).files;_.each(r,function(t){var n=MAILCONFIG.maxAttachSize,r=t.size/1024/1024,i=new FormData,s=t.name.split("."),o=s[s.length-1];if(o==undefined){alert(mailMsg.mail_attach_type_exception);return}var u=r;jQuery("#file_wrap li").each(function(){u+=jQuery(this).attr("filesize")/1024/1024}),jQuery("#img_wrap li").each(function(){u+=jQuery(this).attr("filesize")/1024/1024});if(n<u){alert(msgArgsReplace(mailMsg.mail_attach_limit_size,[n]));return}i.append("file",t),i.append("GOSSOcookie",getCookie("GOSSOcookie")),jQuery.ajax({url:e.writeAttachAction,type:"POST",contentType:!1,processData:!1,data:i,success:function(e){attachFileSuccess(e)}})})}}),jQuery("#popSideOverlay").on("swipeleft",function(e){e.stopPropagation?e.stopPropagation():e.cancelBubble=!0,e.preventDefault(),hideMailFolderSide()}),jQuery("#popSideOverlay").on("tap",function(e){e.stopPropagation?e.stopPropagation():e.cancelBubble=!0,e.preventDefault(),hideMailFolderSide()}),jQuery("#move_folder_page").on("click","a,span",function(e){var t=jQuery(this).attr("evt-rol");if(!t)return;if(t=="move-message"){var n=jQuery(this).attr("folder");copyMoveMessage(n)}else t=="move-folder-cancel"&&changeMailContainer("list")}),jQuery("#tag_message_page").on("click","a,span",function(e){var t=jQuery(this).attr("evt-rol");if(!t)return;if(t=="tag-message"){var n=jQuery(this).attr("val");tagMessage(n,!0)}else t=="tag-message-cancel"&&changeMailContainer("list")}),jQuery("#addr_content").on("click","a,span",function(t){var n=jQuery(this).attr("evt-rol");if(!n)return;if(n=="change-addr-type"){var r=jQuery(this).data("type");jQuery("#addr_tab_wrap li").removeClass("on"),jQuery(this).closest("li").addClass("on"),changeMailWriteAddrType(r,!1)}else if(n=="list-page-move"){var i=jQuery(this).attr("page");e.moveAddrPage(i)}else if(n=="write-addr-cancel")jQuery("#mailWriteToolbarWrap").show(),e.selectedNodes=[],closeAddressContent();else if(n=="add-addr-write"){var s=jQuery(this).data("type");makeAddrSelectItem(s,e.selectedNodes)}}),jQuery("#webfolder_content").on("click","a,span",function(t){var n=jQuery(t.currentTarget),r=jQuery(this).attr("evt-rol");if(!r)return;r=="move-sub-webfolder"?(e.currentWebFolderInfo={},jQuery("#mailWebFolderHomeToolbarWrap").hide(),jQuery("#mailWebSubFolderToolbarWrap").show(),e.resetCheckedWebFolder(),jQuery("#mailWebSubFolderToolbarWrap h1").text(n.text()),e.currentWebFolderInfo.param={type:n.data("type"),path:n.data("full-path").split("WEBFOLDERROOT.")[1],fullPath:n.data("full-path"),nodeNum:n.data("node-num")},n.data("type")==="share"&&(e.currentWebFolderInfo.param.userSeq=n.data("userseq"),e.currentWebFolderInfo.param.sroot=n.data("sroot")),e.webFolderParamHistoryList.push(e.currentWebFolderInfo.param),e.fetchWebFolderList(e.currentWebFolderInfo.param)):r=="choose-webfolder-cancel"?closeWebFolder():r=="select-webfolder"&&(n.next().trigger("click"),judgmentWebFolderCheckList())}),jQuery("#webfolder_content").on("click","input[type=checkbox]",function(e){judgmentWebFolderCheckList()}),jQuery("#webfolder_content").on("change","#webFolderDirectory",function(t){var n=jQuery(t.currentTarget).find("option:selected");e.webFolderParamHistoryList=[],e.currentWebFolderInfo={},jQuery("#mailWebFolderHomeToolbarWrap").show(),jQuery("#mailWebSubFolderToolbarWrap").hide(),e.resetCheckedWebFolder(),e.currentWebFolderInfo.param={type:n.data("type"),fullPath:"WEBFOLDERROOT"},n.data("type")==="share"&&(e.currentWebFolderInfo.param=jQuery.extend(e.currentWebFolderInfo.param,{sroot:n.data("sroot"),userSeq:n.data("userseq"),path:n.data("full-path").split(".")[1],fullPath:n.data("full-path")})),e.webFolderParamHistoryList.push(e.currentWebFolderInfo.param),e.fetchWebFolderList(e.currentWebFolderInfo.param)}),jQuery("#addr_content").on("change","select.addr_select",jQuery.proxy(function(e){function s(){u().done(function(r){var i=jQuery.ajax({method:"GET",data:{folderId:r[0].metadata.id},async:!1,url:t.companySelectAction});i.done(function(e){if(_.isEmpty(e)){changeMailWriteAddrType("user",!0);return}var t=e[0].metadata.parentPathName.split(">").length,r=Handlebars.compile(jQuery("#addr_company_select_tmpl").html())({isFirst:!0,depth:t,data:e});jQuery("#addr_content div.addr_main").append(r),n(jQuery("#addr_content span.depthspan:last select"),!1)}),jQuery("#addr_content span.depthspan:last").find("select").trigger("change",[e.isTrigger])})}function o(){var e=jQuery.ajax({method:"GET",async:!1,url:t.deptSelectAction});e.done(function(e){var t=Handlebars.compile(jQuery("#addr_dept_select_tmpl").html())(e);jQuery("#addr_content div.addr_main").append(t),n(jQuery("#addr_content span.depthspan:last select"),!1)})}function u(){var e=jQuery.ajax({method:"GET",async:!1,url:t.companySelectAction});return e}var t=this,r=jQuery(e.currentTarget),i=r.val();n(r,!0),jQuery("#addr_content").find("span.depthspan").remove(),jQuery("#userCheckedScroll").empty();if(i==="department")o();else{if(i==="company"){s();return}jQuery("#writeDeptAddrLink").hide()}changeMailWriteAddrType(i,e.isTrigger)},this)),jQuery("#addr_content").on("change","select.company_addr_select",jQuery.proxy(function(e,t){function h(e){jQuery.each(jQuery("#addr_content span.depthspan"),function(){var t=Number(jQuery(this).data("depth"));Number(e)<t&&jQuery(this).remove()})}var r=jQuery(e.currentTarget),i=this,s=r.closest("span.depthspan"),o=s.data("depth"),u=r.find("option:selected").val(),a=jQuery("select.addr_select").val(),f=r.find("option:selected").data("readable");h(o),n(r,!0);if(u==""){if(Number(o)>1){var l=s.prev().find("select");changeMailWriteAddrType(a,t,l.val(),l.find("option:selected").data("readable"));return}return}var c=jQuery.ajax({method:"GET",async:!1,data:{folderId:u},url:i.companySelectAction});c.done(function(e){if(e.length==0)return;var t=e[0].metadata.parentPathName.split(">").length;h(t);var r=Handlebars.compile(jQuery("#addr_company_select_tmpl").html())({isFirst:!1,depth:t,data:e});jQuery("#addr_content div.addr_main").append(r),n(jQuery("#addr_content span.depthspan:last select"),!1)}),changeMailWriteAddrType(a,t,u,f)},this)),jQuery("#addr_content").on("change","select.dept_addr_select",function(e){var t=jQuery(e.currentTarget),n=t.val();t.closest("a").find("span.txt").text(t.find("option:selected").text());var r=t.closest("div").find("select.addr_select").val();changeMailWriteAddrType(r,!1,n)}),jQuery("#addr_content input#addrSearchText").on("keyup",function(e){e.preventDefault();if(e.keyCode==13){searchAddr();return}}),jQuery("#addrSearchCancel").on("vclick",function(t){t.preventDefault(),jQuery("#addrSearchText").val(""),jQuery("#writeAddrSelect").val()==="emp"?(e.removeOrgList(),e.fetchOrgMember("",function(t){e.setHeaderCrumbList(t),e.setOrgMemberByCompany(t)})):writeAddrSelect()}),jQuery("#addrSearchBtn").on("vclick",function(e){e.preventDefault(),searchAddr()}),jQuery("body").on("touchstart","div.layer_auto_complete",function(e){jQuery(this).addClass("hover_effect")}),jQuery("#main_content").on("tap","span",function(){var e=jQuery(this).attr("evt-rol");if(e=="check-checkbox"){jQuery(this).prev().trigger("click"),checkMailListCheckbox(jQuery(this).prev());var t=jQuery(this).attr("data-type");judgmentCheckList(t)}}),jQuery("#addr_member_list").on("tap","li",function(e){e.preventDefault();var t=jQuery(this).find("span").attr("evt-rol");t=="check-checkbox-only"&&jQuery(this).find("input").trigger("click")}),jQuery("#commonSearchInput").on("keyup",function(e){if(e.keyCode==13){simpleSearch("all");return}jQuery("#simpleSearchWrap span.searchText").text(jQuery("#commonSearchInput").val())}),jQuery("#goSearch").on("vclick","a",function(e){function i(){var e=jQuery("#detailSearchToggle");e.toggleClass("on"),e.hasClass("on")?(jQuery("#detailSearchTitle, #detailSearchWrap").show(),jQuery("#simpleSearchWrap, #simpleSearchTitle").hide()):(jQuery("#simpleSearchTitle, #simpleSearchWrap").show(),jQuery("#detailSearchWrap, #detailSearchTitle").hide()),jQuery("#searchResultWrap").hide()}function s(){return jQuery("#commonSearchInput").val(""),jQuery("#simpleSearchWrap span.searchText").text(""),!1}e.preventDefault();var t=jQuery(this).attr("evt-rol");if(!t)return;if(t=="searchCloseButton"){jQuery("#simpleSearchTitle").show();if(window.History.getState().data.type=="read"){var n=mailControl.getCurrentFolder(),r={folder:n};mailControl.loadMessageList(r)}closeSearchLayer()}else t=="detailSearchToggle"||t=="detailSearchTitle"?i():t=="deleteSearchText"?s():t=="searchInit"&&(jQuery("#detailSearchWrap input[type=search], #detailSearchWrap input[type=checkbox]").prop("checked",!1).val(""),jQuery("#detailSearchWrap select").prop("selectedIndex",0))})},this.makeSearchEvent=function(){jQuery("a[data-search]").off(),jQuery("a[data-search]").on("vclick",function(e){e.preventDefault(),simpleSearch(jQuery(this).attr("data-search"))}),jQuery("ul.search_result").off(),jQuery("ul.search_result").on("keyup",function(e){if(e.keyCode==13){detailSearch(e);return}})},this.makeSearchResultEvent=function(){var e=this;jQuery("#searchResultWrap li a.tit").off(),jQuery("#searchResultWrap li a.tit").on("vclick",function(){var e=jQuery(this).closest("li").attr("evt-rol");if(e=="read-message"){var t=jQuery(this).attr("folder"),n=jQuery(this).attr("uid");readMessage(t,n),closeSearchLayer(!0)}}),jQuery("#searchResultWrap li a[tap-rol='switch-flag']").off(),jQuery("#searchResultWrap li a[tap-rol='switch-flag']").on("vclick",function(e){var t=jQuery(this).find("span.ic"),n=t.attr("flag"),r="on"==t.attr("flaged"),i=t.closest("li").attr("id");switchFlagFlaged([i],n,!r)}),jQuery("#searchResultWrap li span.checkboxSelect").off(),jQuery("#searchResultWrap li span.checkboxSelect").on("tap",function(e){var t=jQuery(this).attr("evt-rol");t=="check-checkbox"&&(jQuery(this).prev().trigger("click"),checkMailListCheckbox(jQuery(this).prev()),judgmentSearchCheckList())}),jQuery("#searchResultNav").off(),jQuery("#searchResultNav").on("tap","a",function(t){var n=jQuery(this).attr("evt-rol");if(!n)return;t.stopPropagation?t.stopPropagation():t.cancelBubble=!0,t.preventDefault();if(n=="toolbar"){var r="on"==jQuery(this).attr("sub"),i=jQuery(this).attr("menu");if(r)e.makeSubToolbar(jQuery(this),i);else{var s=jQuery(this).attr("evt-act");if(s=="mail-select-all"){var o=jQuery(this).data("checked");o?(jQuery("input[name=msgId]").each(function(){jQuery(this).prop("checked",!1),checkMailListCheckbox(jQuery(this))}),jQuery(this).data("checked",!1),jQuery(this).find("span.txt").text(mailMsg.mail_select_all)):(jQuery("input[name=msgId]").each(function(){jQuery(this).prop("checked",!0),checkMailListCheckbox(jQuery(this))}),jQuery(this).data("checked",!0),jQuery(this).find("span.txt").text(mailMsg.mail_select_all_cancel))}else s=="mail-delete"?(deleteMessage(),closeSearchLayer()):s=="move-message-page"?(moveMessagePage(),closeSearchLayer(!0),closeMoreToolbarLayer()):s=="tag-message-page"?(tagMessagePage(),closeSearchLayer(!0),closeMoreToolbarLayer()):s=="search-toggle-more-layout"?e.makeSubToolbar(jQuery(this),i):s=="change-flag-seen"?(changeSeenFlag(!0),closeSearchLayer()):s=="change-flag-unseen"&&(changeSeenFlag(!1),closeSearchLayer())}}else n=="checked-cancel"&&(jQuery("#searchNav").show(),jQuery("#searchResultNav").hide(),jQuery("#searchResultNav div.array_option").hide(),jQuery("#searchResultWrap input[name=msgId]").each(function(){jQuery(this).prop("checked",!1),checkMailListCheckbox(jQuery(this))}),jQuery("#mail_toolbar_search_selectall").data("checked",!1),jQuery("#mail_toolbar_search_selectall").find("span.txt").text(mailMsg.mail_select_all))})}};