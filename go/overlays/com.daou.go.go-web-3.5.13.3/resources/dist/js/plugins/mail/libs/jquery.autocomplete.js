/*
 * jQuery Autocomplete plugin 1.2.3
 *
 * Copyright (c) 2009 Jörn Zaefferer
 *
 * Dual licensed under the MIT and GPL licenses:
 *   http://www.opensource.org/licenses/mit-license.php
 *   http://www.gnu.org/licenses/gpl.html
 *
 * With small modifications by Alfonso Gómez-Arzola.
 * See changelog for details.
 *
 */

(function(e){e.fn.extend({autocomplete:function(t,n){var r=typeof t=="string";return n=e.extend({},e.Autocompleter.defaults,{url:r?t:null,data:r?null:t,delay:r?e.Autocompleter.defaults.delay:10,max:n&&!n.scroll?10:150,noRecord:"No Records."},n),n.highlight=n.highlight||function(e){return e},n.formatMatch=n.formatMatch||n.formatItem,this.each(function(){new e.Autocompleter(this,n)})},result:function(e){return this.bind("result",e)},search:function(e){return this.trigger("search",[e])},flushCache:function(){return this.trigger("flushCache")},setOptions:function(e){return this.trigger("setOptions",[e])},unautocomplete:function(){return this.trigger("unautocomplete")}}),e.Autocompleter=function(t,n){function d(){var r=h.selected();if(!r){if(!n.makeFormat)return!1;var i=e.trim(s.val());if(i=="")return!1;r=i}var u=r;o=u;if(n.multiple){var a=m(s.val());if(a.length>1){var f=n.multipleSeparator.length,c=e(t).selection().start,p,d=0;e.each(a,function(e,t){d+=t.length;if(c<=d)return p=e,!1;d+=f}),a[p]=u,u=a.join(n.multipleSeparator)}u+=n.multipleSeparator}return n.makeFormat?n.editMode?n.editModeFunc(s,u):n.makeFormatFunc(s,u):s.val(u),n.autoResizeWidth&&s.width(l),w(),s.trigger("result",[r.data,r.value]),!0}function v(e,t){if(f==r.DEL){h.hide();return}var i=s.val();h.setImeMode(validateHan(i)?"etc":"en");if(!t&&i==o)return;if(n.autoResizeWidth){var u=jQuery("#writeStrWidth");u.text(i),u.outerWidth()+50>s.width()&&s.width(u.outerWidth()+50)}o=i,i=g(i),i.length>=n.minChars?(s.addClass(n.loadingClass),n.matchCase||(i=i.toLowerCase()),i!=""&&S(i,E,w)):(T(),h.hide())}function m(t){if(!t)return[""];var r=t.split(n.multipleSeparator),i=[],s;for(var o=0;o<r.length;o++)r[o].indexOf(n.multipleSeparatorEtc)>-1?(s=r[o].split(n.multipleSeparatorEtc),e.each(s,function(t,n){e.trim(n)&&(i[i.length]=n)})):i[i.length]=r[o];var u=[];return e.each(i,function(t,n){e.trim(n)&&(u[t]=e.trim(n))}),u}function g(r){if(!n.multiple)return r;var i=m(r);if(i.length==1)return i[0];var s=e(t).selection().start;s==r.length?i=m(r):i=m(r.replace(r.substring(s),""));var o=i&&i.length>0?i[i.length-1]:"";return o}function y(i,u){n.autoFill&&g(s.val()).toLowerCase()==i.toLowerCase()&&f!=r.BACKSPACE&&(s.val(s.val()+u.substring(g(o).length)),e(t).selection(o.length,o.length+u.length))}function b(){clearTimeout(e);var e=setTimeout(w,200)}function w(){var e=h.visible();h.hide(),T(),n.mustMatch&&s.search(function(e){if(!e)if(n.multiple){var t=m(s.val()).slice(0,-1);s.val(t.join(n.multipleSeparator)+(t.length?n.multipleSeparator:""))}else s.val(""),s.trigger("result",null)})}function E(e,t){t&&t.length&&a?(T(),h.display(t,e),y(e,t[0].value),h.show()):w()}function S(t,r,s){n.matchCase||(t=t.toLowerCase());var a=u.load(t);if(a&&a.length)r(t,a);else if(typeof n.url=="string"&&n.url.length>0){var f={timestamp:+(new Date)};e.each(n.extraParams,function(e,t){f[e]=typeof t=="function"?t():t}),jQuery.post(n.url,{keyword:g(t),notContact:n.notContact},function(e){e.code=="200"&&e.data&&t==o&&(u.add(t,e.data),r(t,e.data))},"json")}else h.emptyList(),i!=null?i():s(t)}function x(t){var r=[],i=t.split("\n");for(var s=0;s<i.length;s++){var o=e.trim(i[s]);o&&(o=o.split("|"),r[r.length]={data:o,value:o[0],result:n.formatResult&&n.formatResult(o,o[0])||o[0]})}return r}function T(){s.removeClass(n.loadingClass)}var r={UP:38,DOWN:40,DEL:46,TAB:9,RETURN:13,ESC:27,COMMA:188,PAGEUP:33,PAGEDOWN:34,BACKSPACE:8},i=null;n.failure!=null&&typeof n.failure=="function"&&(i=n.failure);var s=e(t).attr("autocomplete","off").addClass(n.inputClass),o="",u=e.Autocompleter.Cache(n),a=0,f,l=n.autoResizeWidth?s.width():0,c={mouseDownOnSelect:!1},h=e.Autocompleter.Select(n,t,d,c),p;navigator.userAgent.indexOf("Opera")!=-1&&e(t.form).bind("submit.autocomplete",function(){if(p)return p=!1,!1}),s.bind((navigator.userAgent.indexOf("Opera")!=-1&&!1 in window?"keypress":"keydown")+".autocomplete",function(e){a=1,f=e.keyCode;switch(e.keyCode){case r.UP:h.visible()?(e.preventDefault(),h.prev()):v(0,!0);break;case r.DOWN:h.visible()?(e.preventDefault(),h.next()):v(0,!0);break;case r.PAGEUP:h.visible()?(e.preventDefault(),h.pageUp()):v(0,!0);break;case r.PAGEDOWN:h.visible()?(e.preventDefault(),h.pageDown()):v(0,!0);break;case r.TAB:case r.RETURN:if(d())return e.preventDefault(),p=!0,!1;break;case r.ESC:h.hide();break;default:clearTimeout(t);var t=setTimeout(v,n.delay)}}).focus(function(){a++}).blur(function(){a=0,c.mouseDownOnSelect||b()}).click(function(){n.clickFire?h.visible()||v(0,!0):a++>1&&!h.visible()&&v(0,!0)}).bind("search",function(){function n(e,n){var r;if(n&&n.length)for(var i=0;i<n.length;i++)if(n[i].result.toLowerCase()==e.toLowerCase()){r=n[i];break}typeof t=="function"?t(r):s.trigger("result",r&&[r.data,r.value])}var t=arguments.length>1?arguments[1]:null;e.each(m(s.val()),function(e,t){S(t,n,n)})}).bind("flushCache",function(){u.flush()}).bind("setOptions",function(){e.extend(!0,n,arguments[1]),"data"in arguments[1]&&u.populate()}).bind("unautocomplete",function(){h.unbind(),s.unbind(),e(t.form).unbind(".autocomplete")})},e.Autocompleter.defaults={inputClass:"ac_input",resultsClass:"ac_results",loadingClass:"ac_loading",minChars:1,delay:100,matchCase:!1,matchSubset:!1,matchContains:!0,cacheLength:10,max:1e3,mustMatch:!1,extraParams:{},selectFirst:!0,formatItem:function(e){return e},formatMatch:null,autoFill:!1,width:0,multiple:!0,multipleSeparator:",",multipleSeparatorEtc:";",inputFocus:!0,clickFire:!1,highlight:function(e,t){return e=e.split("<").join("&lt;"),e=e.split(">").join("&gt;"),t!=""?e.replace(new RegExp("(?![^&;]+;)(?!<[^<>]*)("+t.replace(/([\^\$\(\)\[\]\{\}\*\.\+\?\|\\])/gi,"\\$1")+")(?![^<>]*>)(?![^&;]+;)","gi"),"<strong>$1</strong>"):e},scroll:!0,scrollHeight:80,scrollJumpPosition:!0,autoResizeWidth:!1,makeFormat:!1,makeFormatFunc:null,editMode:!1,editModeFunc:null},e.Autocompleter.Cache=function(t){function i(e,n){t.matchCase||(e=e.toLowerCase());var r=e.indexOf(n);return t.matchContains=="word"&&(r=e.toLowerCase().search("\\b"+n.toLowerCase())),r==-1?!1:r==0||t.matchContains}function s(e,i){r>t.cacheLength&&u(),n[e]||r++,n[e]=i}function o(){if(!t.data)return!1;var n={},r=0;t.url||(t.cacheLength=1),n[""]=[];for(var i=0,o=t.data.length;i<o;i++){var u=t.data[i];u=typeof u=="string"?[u]:u;var a=t.formatMatch(u,i+1,t.data.length);if(typeof a=="undefined"||a===!1)continue;var f=a.charAt(0).toLowerCase();n[f]||(n[f]=[]);var l={value:a,data:u,result:t.formatResult&&t.formatResult(u)||a};n[f].push(l),r++<t.max&&n[""].push(l)}e.each(n,function(e,n){t.cacheLength++,s(e,n)})}function u(){n={},r=0}var n={},r=0;return setTimeout(o,25),{flush:u,add:s,populate:o,load:function(s){if(!t.cacheLength||!r)return null;if(!t.url&&t.matchContains){var o=[];for(var u in n)if(u.length>0){var a=n[u];e.each(a,function(e,t){i(t.value,s)&&o.push(t)})}return o}if(n[s])return n[s];if(t.matchSubset)for(var f=s.length-1;f>=t.minChars;f--){var a=n[s.substr(0,f)];if(a){var o=[];return e.each(a,function(e,t){i(t.value,s)&&(o[o.length]=t)}),o}}return null}}},e.Autocompleter.Select=function(t,n,r,i){function d(){if(!l)return;c=e("<div class='layer_auto_complete' data-outside='"+e(n).attr("id")+"'/>").hide().addClass(t.resultsClass).css("position","absolute").css("overflow","auto").attr("id",e(n).attr("id")+"_actb").appendTo(document.body).hover(function(t){e(this).is(":visible")&&n.focus(),i.mouseDownOnSelect=!1}),h=e("<ul class='layer_auto_complete'/>").appendTo(c).mouseover(function(t){v(t).nodeName&&v(t).nodeName.toUpperCase()=="LI"&&(u=e("li",h).removeClass(s.ACTIVE).index(v(t)),e(v(t)).addClass(s.ACTIVE))}).click(function(i){return e(v(i)).addClass(s.ACTIVE),r(),t.inputFocus&&n.focus(),jQuery(n).css("ime-mode",p=="etc"?"active":"auto"),!1}).mousedown(function(){i.mouseDownOnSelect=!0}).mouseup(function(){i.mouseDownOnSelect=!1}),t.width>0&&c.css("width",t.width),l=!1}function v(e){var t=e.target;while(t&&t.tagName!="LI")t=t.parentNode;return t?t:[]}function m(e){o.slice(u,u+1).removeClass(s.ACTIVE),g(e);var n=o.slice(u,u+1).addClass(s.ACTIVE);if(t.scroll){var r=0;o.slice(0,u).each(function(){r+=this.offsetHeight}),r+n[0].offsetHeight-h.scrollTop()>h[0].clientHeight?h.scrollTop(r+n[0].offsetHeight-h.innerHeight()):r<h.scrollTop()&&h.scrollTop(r)}}function g(e){if(t.scrollJumpPosition||!t.scrollJumpPosition&&!(e<0&&u==0||e>0&&u==o.size()-1))u+=e,u<0?u=o.size()-1:u>=o.size()&&(u=0)}function y(e){return t.max&&t.max<e?t.max:e}function b(){h.empty();var n=y(a.length);for(var r=0;r<n;r++){if(!a[r])continue;if(a[r].result)continue;var i=t.formatItem(a[r],r+1,n,a[r],f);if(i===!1)continue;var l=e("<li/>").html(t.highlight(i,f)).addClass(r%2==0?"ac_even":"ac_odd").appendTo(h)[0];e.data(l,"ac_data",a[r])}o=h.find("li"),t.selectFirst&&(o.slice(0,1).addClass(s.ACTIVE),u=0),e.fn.bgiframe&&h.bgiframe()}var s={ACTIVE:"ac_over"},o,u=-1,a,f="",l=!0,c,h,p;return{display:function(e,t){d(),a=e,f=t,b()},next:function(){m(1)},prev:function(){m(-1)},pageUp:function(){u!=0&&u-8<0?m(-u):m(-8)},pageDown:function(){u!=o.size()-1&&u+8>o.size()?m(o.size()-1-u):m(8)},hide:function(){c&&c.hide(),o&&o.removeClass(s.ACTIVE),u=-1},visible:function(){return c&&c.is(":visible")},current:function(){return this.visible()&&(o.filter("."+s.ACTIVE)[0]||t.selectFirst&&o[0])},show:function(){var r=e(n).offset(),i=navigator.userAgent.toLowerCase(),s=n.offsetHeight;i.indexOf("firefox")!=-1&&(s=n.offsetHeight-6),c.css({width:typeof t.width=="string"||t.width>0?t.width:e(n).width(),top:r.top+s,left:r.left}).show();if(t.scroll){h.scrollTop(0),h.css({maxHeight:t.scrollHeight,overflow:"auto"});if(navigator.userAgent.indexOf("MSIE")!=-1&&typeof document.body.style.maxHeight=="undefined"){var u=0;o.each(function(){u+=this.offsetHeight});var a=u>t.scrollHeight;h.css("height",a?t.scrollHeight:u),a||o.width(h.width()-parseInt(o.css("padding-left"))-parseInt(o.css("padding-right")))}}},selected:function(){var t=o&&o.filter("."+s.ACTIVE).removeClass(s.ACTIVE);return t&&t.length&&e.data(t[0],"ac_data")},emptyList:function(){h&&h.empty()},unbind:function(){c&&c.remove()},setImeMode:function(e){p=e}}},e.fn.selection=function(e,t){if(e!==undefined)return this.each(function(){if(this.createTextRange){var n=this.createTextRange();t===undefined||e==t?(n.move("character",e),n.select()):(n.collapse(!0),n.moveStart("character",e),n.moveEnd("character",t),n.select())}else this.setSelectionRange?this.setSelectionRange(e,t):this.selectionStart&&(this.selectionStart=e,this.selectionEnd=t)});var n=this[0];if(n.createTextRange){var r=document.selection.createRange(),i=n.value,s="<->",o=r.text.length;r.text=s;var u=n.value.indexOf(s);return n.value=i,this.selection(u,u+o),{start:u,end:u+o}}if(n.selectionStart!==undefined)return{start:n.selectionStart,end:n.selectionEnd}}})(jQuery);