function deleteMessage(){var e=isContainedTrashMail(),t=mailMsg.confirm_delete;e||currentFolderType=="trash"?t=mailMsg.confirm_trashdelete:currentFolderType=="reserved"&&(t=mailMsg.confirm_reserveddelete);if(!confirm(t))return;var n=getMailListCheckedIdArray(),r=getListProcessParams(n),i={folderNames:r.fnames,uids:r.uids};mailControl.deleteMessages(i)}function deleteMdn(){var e=new Array;getMailListCheckedObj().each(function(){e.push(jQuery(this).val())}),mailControl.deleteMdn({messageIds:e})}function changeSeenFlag(e){var t=getMailListCheckedIdArray(),n=getListProcessParams(t);mailControl.switchMessagesFlags(n.uids,n.fnames,"S",e)}function switchFlagFlaged(e,t,n){var r=getListProcessParams(e);mailControl.switchMessagesFlags(r.uids,r.fnames,t,n)}function goFolder(e,t){if(!checkEscapeWriteMode())return;var n={folder:e};n.sharedFlag="user",t&&(n.flag=t),hideMailFolderSide(),mailControl.loadMessageList(n)}function displayHomeIcon(){var e=sessionStorage.getItem("GO-Agent-mail");(e=="GO-Android"||e=="GO-iPhone")&&jQuery("#mailHomeToolbarWrap a[evt-rol='goto-gohome']").hide()}function gotoMailHome(e){var t={folder:"Inbox"};goMailList(t,e)}function goMailList(e,t){e=e?e:{};if(!checkEscapeWriteMode())return;makeTopMenuTitle(MAIL_APP_NAME),hideMailFolderSide(),mailControl.loadMessageList(e,!1,t)}function emptyFolder(e){var t="";e=="Trash"?t=mailMsg.confirm_emptytrash:e=="Spam"?t=mailMsg.confirm_emptyspam:t=mailMsg.mail_folder_delete_alert,setTimeout(function(){if(!confirm(t))return;var n={folderName:e};folderControl.emptyMailFolder(n)},500)}function toggleMailFolderSide(){var e=jQuery("#mail_folder_side_background").css("display")=="none";e?showMailFolderSide():hideMailFolderSide()}function hideMailFolderSide(){jQuery("#mail_folder_side,#mail_folder_side_background").hide(),jQuery("#popSideOverlay").css({left:"0px",top:0,width:"0px",height:"0px"}).hide(),jQuery(document).undelegate("#popSideOverlay, header.go_header","scrollstart"),jQuery("#go_body").height("auto"),jQuery(".dim").hide()}function showMailFolderSide(){jQuery("#mail_folder_side,#mail_folder_side_background").show();var e=jQuery("#go_content"),t=e.offset();jQuery("#popSideOverlay").css({left:t.left+"px",top:0,width:e.width()+"px",height:jQuery(window).height()+"px"}).show(),jQuery(document).scrollTop(0).delegate("#popSideOverlay, header.go_header","scrollstart",!1),jQuery("#go_body").height(jQuery(window).height()-jQuery("header").height()),folderControl.makeLeftMenuIscroll(),jQuery(".dim").show()}function changeFlagView(e,t,n){var r,i;for(var s=0;s<n.length;s++){r=n[s];if(t=="F")i=jQuery("#"+getFolderNameId(r)).find('span[flag="F"]'),e?(i.removeClass("ic_important_off"),i.addClass("ic_important_on"),i.attr("flaged","on")):(i.removeClass("ic_important_on"),i.addClass("ic_important_off"),i.attr("flaged","off"));else if(t=="S"){var o=jQuery("#"+getFolderNameId(r));if(e){o.removeClass("read_no");var u=o.find("span.flagClass");u.hasClass("ic_noread_reply")?u.removeClass("ic_noread_reply").addClass("ic_read_reply"):u.hasClass("ic_read_no")?u.removeClass("ic_read_no").addClass("ic_read_yes"):u.hasClass("ic_noread_fw")&&u.removeClass("ic_noread_fw").addClass("ic_read_fw")}else if(!o.hasClass("read_no")){o.addClass("read_no");var u=o.find("span.flagClass");u.hasClass("ic_read_reply")?u.removeClass("ic_read_reply").addClass("ic_noread_reply"):u.hasClass("ic_read_yes")?u.removeClass("ic_read_yes").addClass("ic_read_no"):u.hasClass("ic_read_fw")&&u.removeClass("ic_read_fw").addClass("ic_noread_fw")}}}}function changeFlagReadView(e,t){if(t=="F"){var n=jQuery("#readFlagedFlagIcon");e?(n.removeClass("ic_important_off"),n.addClass("ic_important_on"),n.attr("flaged","on")):(n.removeClass("ic_important_on"),n.addClass("ic_important_off"),n.attr("flaged","off"))}}function executeFolderInfo(){folderControl.updateFolderCountInfo()}function bookmarkExecute(e,t,n){var r={};t=="tag"?(r.listType=t,r.tagId=n):(r.folder="all",r.extFolder="on",t=="unseen"?r.flag="U":t=="today"?(r.adv="on",r.sdate="TODAYS",r.edate="TODAYE"):t=="yesterday"?(r.adv="on",r.sdate="YESTERDAYS",r.edate="YESTERDAYE"):t=="flaged"?r.flag="F":t=="seen"?r.flag="S":t=="attach"?r.flag="T":t=="reply"?r.flag="A":t=="myself"?r.flag="L":(r.folder=n,r.extFolder="off"),r.extType=t),r.bookmarkSeq=e,goMailList(r)}function folderExecute(e){var t={};e=="unseen"?t.flag="U":e=="today"?(t.adv="on",t.sdate="TODAYS",t.edate="TODAYE"):e=="yesterday"?(t.adv="on",t.sdate="YESTERDAYS",t.edate="YESTERDAYE"):e=="flaged"?t.flag="F":e=="seen"?t.flag="S":e=="attach"?t.flag="T":e=="reply"?t.flag="A":e=="myself"&&(t.flag="L"),t.folder="all",t.extFolder="on",t.extType=e,goMailList(t)}function selectedMailMenu(){var e="";Number(bookmarkSeq)>0?e="bookmark_title_"+bookmarkSeq:listType=="tag"?e="tag_link_"+bookmarkValue:isAllFolder||(e="folder_link_"+currentFolderEncName),selectCurrentFolderName(e)}function readMessage(e,t){var n={folder:e,uid:t};mailControl.readMessage(n)}function selectCurrentFolderName(e){jQuery("#mail_folder_side li.title").removeClass("on"),e!=""&&(jQuery("#"+getFolderNameId(e)).length==0?setTimeout(function(){jQuery("#"+getFolderNameId(e)).addClass("on")},1e3):jQuery("#"+getFolderNameId(e)).addClass("on"))}function goWrite(){if(!checkEscapeWriteMode())return;var e=!0,t=jQuery("#defaultFolder2_num").text();isWriteNoti&&Number(t)>0&&confirm(mailMsg.confirm_draftswrite)&&(e=!1,goFolder("Drafts"));if(e){var n={wtype:"normal"};mailControl.writeMessage(n)}}function makeWriteMyself(e){var t=!1;jQuery("#toAddrWrap ul.name_tag li:not(.creat)").each(function(){var n=jQuery(this).find("span.name").data("email"),r=get_email(n);if(USEREMAIL==r){if(e)return t=!0,!1;deleteAddressUnitFormat("to",jQuery(this))}});if(e&&!t){var n='"'+USERNAME+'" <'+USEREMAIL+">";makeAddressUnitFormat("to",n)}}function replyWrite(e){var t=getMailListCheckedIdArray(),n=getListProcessParams(t),r={};r.folderName=n.fnames[0],r.uids=n.uids,r.wtype=e,goWrieLoad(r)}function forwardMessage(e){var t=getMailListCheckedIdArray(),n=getListProcessParams(t),r={};r.folderName=n.fnames[0],r.uids=n.uids,r.fwmode=e,r.wtype="forward",goWrieLoad(r)}function reWrite(){if(isWriteModify()){if(!confirm(mailMsg.confirm_mobile_escaperewrite))return;hideAutoComplate()}else hideAutoComplate();mailControl.reloadWriteMessage()}function sendMessage(e){if(currentMenu!="send"){var t=mailControl.getSendData();t=makeRcptForm(t);var n=t.to,r=t.cc,i=t.bcc,s=!1;if(e!="draft"){e="normal",t.massMode=!1;if(jQuery.trim(n)==""&&currentMenu!="send"){alert(mailMsg.error_norecipient),jQuery("#to").focus();return}if(!checkEmailInvalidAddress(n))return;if(!checkEmailInvalidAddress(r))return;if(!checkEmailInvalidAddress(i))return;if(isSendInfoCheckUse||isSendEmailCheckUse||isSendAttachCheckUse||isSendKeywordCheckUse)s=!0}t.sendType=e;var o=jQuery.trim(jQuery("#subject").val());if(o==""){alert(mailMsg.alert_nosubject),jQuery("#subject").focus();return}t.subject=o;var u=jQuery("#signSelect").val();u&&u>0?(t.attachSign=!0,t.signSeq=u):(t.attachSign=!1,t.signSeq="");var a=jQuery("#content").val();if(!checkSendMailCount(t))return;if(s){t.sendEmailCheckResult=!1,t.sendAttachCheckResult=!1,t.sendKeywordCheckResult=!1,t.sendInfoCheck=!1;if(isSendEmailCheckUse){var n=getEmailArray(t.to),r=!t.cc||jQuery.trim(t.cc)==""?"":getEmailArray(t.cc),i=!t.bcc||jQuery.trim(t.bcc)==""?"":getEmailArray(t.bcc);r!=""&&(n=n.concat(r)),i!=""&&(n=n.concat(i));var f=new Array;for(var l=0;l<n.length;l++)f[l]=get_email(n[l]);var c={};c.emailArray=f,f.length!=0?ActionLoader.postSyncGoLoadAction("/api/mail/address/search/external",c,function(e){t.sendEmailCheckResult=e?!0:!1},"json"):t.sendEmailCheckResult=!1}if(isSendAttachCheckUse){var h=sendAttachData;if(searchContentKeyword(a,h,/,/g)){var p=jQuery("#file_wrap"),d=jQuery("#img_wrap");p.children().length>0||d.children().length>0?t.sendAttachCheckResult=!1:t.sendAttachCheckResult=!0}}if(isSendKeywordCheckUse){var h=sendKeywordData;searchContentKeyword(a,h,/\\\\/g)?t.sendKeywordCheckResult=!0:t.sendKeywordCheckResult=!1}isSendInfoCheckUse&&(t.sendInfoCheck=!0,jQuery("#sendCheckLayerApply").show()),t.sendEmailCheckResult||t.sendAttachCheckResult||t.sendKeywordCheckResult||t.sendInfoCheck?(jQuery("#attachOverlay").show(),jQuery("#sendCheckLayer").show(),mailControl.setSendData(t),checkSendInfoValue(t)):sendMessageParamProcess(t)}else sendMessageParamProcess(t)}}function searchContentKeyword(e,t,n){var r=new RegExp("[.*+?|()\\[\\]{}\\\\]","g");t=t.replace(r,"\\$&");var i=t.replace(n,"|");return e.match(new RegExp("("+i+")","gi"))}function getEmailAddrNoPersonal(e){var t=jQuery("#"+e),n=t.children().length,r="";return n>0&&t.children().each(function(e){var t=jQuery(this).css("display");t=="block"&&(e===n-1?r+=get_email(unescape_tag(jQuery(this).attr("data-addr"))):r+=get_email(unescape_tag(jQuery(this).attr("data-addr")))+",")}),r}function checkSendInfoValue(e){var t=[];jQuery("#file_wrap li").each(function(){t.push({name:jQuery(this).attr("filename"),id:jQuery(this).attr("orgname"),size:jQuery(this).attr("filesize"),hostId:jQuery(this).attr("hostid")})}),jQuery("#img_wrap li").each(function(){t.push({name:jQuery(this).attr("filename"),id:jQuery(this).attr("orgname"),size:jQuery(this).attr("filesize"),hostId:jQuery(this).attr("hostid"),fileattr:"go"})});var n={};n.subject=e.subject,n.toList=getEmailArray(e.to),n.ccList=!e.cc||jQuery.trim(e.cc)==""?null:getEmailArray(e.cc),n.bccList=!e.bcc||jQuery.trim(e.bcc)==""?null:getEmailArray(e.bcc),n.attachList=t,n.sendEmailCheckResult=e.sendEmailCheckResult,n.sendAttachCheckResult=e.sendAttachCheckResult,n.sendKeywordCheckResult=e.sendKeywordCheckResult,n.sendInfoCheck=e.sendInfoCheck,jQuery("#sendInfoCheck").append(getHandlebarsTemplate("mail_send_allow_check_content_tmpl",n))}function checkSendMessage(){var e=mailControl.getSendData();if(isSendInfoCheckUse){var t=getCheckSendInfoValue("to");if(!t||t.length==0){alert(mailMsg.mail_rcpt_to_noselect);return}settingWriteInfo(),jQuery("#sendCheckLayer").hide()}sendMessageParamProcess(e)}function checkSendMessageCancel(){jQuery("#sendCheckLayer").hide(),jQuery("#sendInfoCheck").children().remove()}function settingWriteInfo(){var e=getCheckSendInfoValue("to"),t=getCheckSendInfoValue("cc"),n=getCheckSendInfoValue("bcc");deleteAddressUnitFormatAll("to"),deleteAddressUnitFormatAll("cc"),deleteAddressUnitFormatAll("bcc");if(e&&e.length>0)for(var r=0;r<e.length;r++)makeAddressUnitFormat("to",e[r]);if(t&&t.length>0)for(var r=0;r<t.length;r++)makeAddressUnitFormat("cc",t[r]);if(n&&n.length>0)for(var r=0;r<n.length;r++)makeAddressUnitFormat("bcc",n[r]);var i=mailControl.getSendData();i.to=e.reverse().join(),i.cc=t.reverse().join(),i.bcc=n.reverse().join(),mailControl.setSendData(i),settingWriteInfoAttach()}function settingWriteInfoAttach(){var e=mailControl.getSendData(),t="";jQuery("#sendCheckLayer input[name=attachFile]").each(function(){if(jQuery(this).attr("checked")){var e=jQuery(this).val(),n=jQuery(this).attr("orgname"),r=jQuery(this).attr("filename"),i=jQuery(this).attr("filesize"),s=jQuery(this).attr("fileattr");s!=""?t+=n+"	"+r+"	"+i+"	"+"0"+"	"+s+"\n":t+=n+"	"+r+"	"+i+"\n"}else{var n=jQuery(this).attr("orgname"),r=jQuery(this).attr("filename"),i=jQuery(this).attr("filesize"),s=jQuery(this).attr("fileattr");jQuery("#img_wrap li[orgname='"+n+"']").remove()}}),e.attachList=t,mailControl.setSendData(e)}function getCheckSendInfoValue(e){var t=new Array;return jQuery("#sendCheckLayer input[name="+e+"Addr]:checked").each(function(){t.push(jQuery(this).val()),t.reverse()}),t}function sendMessageParamProcess(e){var t=e.sendType;e.content=jQuery("#content").val();var n=folderControl.getQuotaInfo();if(Number(n.percent)>=100){if(t=="draft"){alert(mailMsg.mail_send_quotaover_draft);return}if(!confirm(mailMsg.mail_send_quotaover_confirm))return;e.receiveNoti=!1,e.saveSent=!1}else jQuery("#receivenoti").attr("checked")&&(e.receiveNoti=!0),jQuery("#onesend").attr("checked")&&(e.oneSend=!0);var r=mailMsg.mail_send_confirm;t=="draft"?r=mailMsg.mail_send_drafts_confirm:e.saveSent=!0,e.mobileMail=!0,e.forwardOrgText=jQuery("#forwardOrgText").val(),e.replyOrgText=jQuery("#replyOrgText").val(),sendConfirm?confirm(r)&&(e.attachList=getAttachString(),mailControl.sendMessage(e)):(e.attachList=getAttachString(),mailControl.sendMessage(e))}function getAttachString(){var e="";return jQuery("#file_wrap li").each(function(){var t=jQuery(this).attr("orgname"),n=jQuery(this).attr("filename"),r=jQuery(this).attr("filesize"),i=jQuery(this).attr("hostid");e+=t+"	"+n+"	"+r+"	"+i+"\n"}),jQuery("#img_wrap li").each(function(){var t=jQuery(this).attr("orgname"),n=jQuery(this).attr("filename"),r=jQuery(this).attr("filesize"),i=jQuery(this).attr("hostid"),s="go";e+=t+"	"+n+"	"+r+"	"+i+"	"+"0"+"	"+s+"\n"}),e}function goWrieLoad(e){if(!checkEscapeWriteMode())return;mailControl.writeMessage(e)}function writeDraftMessage(e,t){goWrieLoad({wtype:"drafts",folderName:e,uids:[t]})}function loadMdnList(e){if(!checkEscapeWriteMode())return;hideMailFolderSide(),mailControl.loadMdnList(e)}function recallMsg(e){var t=jQuery("#mdnReadUid").val(),n=jQuery("#mdnMessageId").val(),r=jQuery("#mdnMessageSubject").val();if(!confirm(mailMsg.mail_mdn_confirm))return;var i={};i.messageId=n,i.uid=t,i.subject=r,i.recallEmails=e,mailControl.recallMessage(i)}function toggleSearchMessageWrap(){jQuery("#goSearch").toggle();var e={};e.folderList=folderControl.getUserFolderList(),jQuery("#detailSearchToggle").removeClass("on"),jQuery("#searchDetail").handlebars("mail_search_detail",e);var t=mailControl.isMailAttachSearch();t&&jQuery("#adAttachContentSearch").show(),mailControl.initSearchInfo(),mailControl.preventBodyScroll(),mailControl.searchResultSetHeight(),mailControl.searchLayerInitScroll(),mailControl.makeSearchEvent()}function openSearchMessageWrap(){var e=jQuery("#search_wrap");e.show(),clearSearchTerm(),openSearchOverlay()}function closeSearchMessageWrap(){var e=jQuery("#search_wrap");e.hide(),closeSearchOverlay()}function simpleSearch(e){var t=jQuery("#commonSearchInput");if(t.val()==""){alert(mailMsg.mail_mobile_search_message);return}if(!validateSearchInput(t,2,64,"searchMail"))return;var n=jQuery.trim(t.val()),r=getSimpleSearchParam(n,e);mailControl.getSearchList(r,function(e){printSearchList(e),t.blur()})}function detailSearch(e){if(!validateAdSearchMessage())return;var t=getDetailSearchParam();mailControl.getSearchList(t,function(e){printSearchList(e),jQuery("#detailSearchToggle").removeClass("on"),jQuery("#commonSearchInput").blur()})}function moreSearchList(e){var t=e.param;t.page=e.pageInfo.nextPage,mailControl.getSearchList(t,function(e){printSearchMoreList(e)})}function printSearchList(e){var t={};t.total=e.total,t.messageList=e.messageList,jQuery("#simpleSearchWrap, #detailSearchWrap").hide(),jQuery("#searchResultWrap").show(),jQuery("#searchResultWrap").handlebars("mail_search_list_wrap",t),mailControl.makeSearchResultEvent()}function printSearchMoreList(e){jQuery("#searchResultWrap ul").append(getHandlebarsTemplate("mail_search_list",e.messageList)),mailControl.makeSearchResultEvent()}function getSimpleSearchParam(e,t){var n={adv:"on",category:"",edate:"",flag:"",folder:"all",listType:"mail",fromaddr:"",keyWord:"",sdate:"",searchExtFolder:"off",toaddr:""};return t=="all"?n={folder:t,keyWord:e}:t=="fromaddr"?n.fromaddr=e:t=="toaddr"?n.toaddr=e:t=="subject"&&(n.category="s",n.keyWord=e),n}function getDetailSearchParam(){var e=jQuery.trim(jQuery("#adFolderName").val()),t=jQuery.trim(jQuery("#fromaddr").val()),n=jQuery.trim(jQuery("#toaddr").val()),r="";jQuery("#adSearchCondWrap input:checked").each(function(){r+=jQuery(this).val()});var i=jQuery.trim(jQuery("#adSearchKeyWord").val()),s={adv:"on",category:r,edate:"",sdate:"",flag:"",folder:e,fromaddr:t,keyWord:i,listType:"mail",searchExtFolder:"off",toaddr:n};return s}function validateAdSearchMessage(){var e=jQuery.trim(jQuery("#fromaddr").val()),t=jQuery.trim(jQuery("#toaddr").val()),n=jQuery.trim(jQuery("#adSearchKeyWord").val());if(e==""&&t==""&&n=="")return alert(mailMsg.mail_mobile_search_message),!1;if(n!=""&&jQuery("#adSearchCondWrap input[type=checkbox]:checked").length<1)return alert(mailMsg.mail_search_valid_checkbox),!1;if(n==""&&jQuery("#adSearchCondWrap input[type=checkbox]:checked").length>=1)return alert(mailMsg.mail_mobile_search_message),!1;var r=[{id:"fromaddr"},{id:"toaddr"},{id:"adSearchKeyWord"}],i=r.length;for(var s=0;s<i;s++)if(!validateSearchInput(jQuery("#"+r[s].id),2,64,"searchMail"))return!1;return!0}function openSearchOverlay(){jQuery("#popSearchOverlay").remove(),jQuery('<div id="popSearchOverlay" class="overlay" />').appendTo(".go_wrap").click(function(e){closeSearchMessageWrap(e)})}function closeSearchOverlay(){jQuery("#popSearchOverlay").remove()}function searchMessage(){var e=jQuery("#search_keyword");keyWord=jQuery.trim(e.val());if(keyWord==""){alert(mailMsg.alert_search_nostr),e.focus();return}if(!validateInput(e,2,64,"searchMail"))return;if(!checkEscapeWriteMode())return;if(mailControl.getListMode()=="mdnlist"){var t={pattern:keyWord};loadMdnList(t)}else if(mailControl.getListMode()=="mdnread"){var n=jQuery("#mdnReadUid").val(),t={pattern:keyWord,uid:n};mailControl.loadMdnRead(t)}else{var t={folder:"all",keyWord:keyWord};mailControl.searchMessage(t)}closeSearchMessageWrap()}function searchMessageCancel(){jQuery("#search_keyword").val("")}function searchGoMessage(){currentMenu=="addr"?searchAddr():searchMessage()}function checkEmailInvalidAddress(e){var t=getEmailArray(e);for(var n=0;n<t.length;n++){var r=t[n];r=jQuery.trim(r);var i=get_email(r);if(i.charAt(0)=="$"||i.charAt(0)=="&"||i.charAt(0)=="+"||i.charAt(0)=="#")continue;if(r==""||isEmail(i))continue;return alert(mailMsg.alert_invalidaddress+"\n\n"+r),!1}return!0}function selectAttachPhoto(){jQuery("#subject").blur(),jQuery("#content").blur(),jQuery("#attachOverlay").touchstart(function(){closeAttachPhoto()}).show(),jQuery("#attachLayer").show()}function closeAttachPhoto(){jQuery("#attachLayer").hide(),jQuery("#attachOverlay").hide()}function makeCopyMoveContent(){var e=folderControl.getUserFolderList();jQuery("#mail_move_folder_list").empty(),jQuery("#mail_move_folder_list").handlebars("mail_folder_selectbox_tmpl",e)}function makeTagListContent(){var e=folderControl.getTagData();jQuery("#mail_tag_message_list").empty(),jQuery("#mail_tag_message_list").handlebars("mail_tag_page_tmpl",e)}function copyMoveMessage(e){var t=getMailListCheckedIdArray(),n=getListProcessParams(t),r={fromFolders:n.fnames,uids:n.uids,toFolder:e};mailControl.moveMessage(r)}function tagMessage(e,t){var n=getMailListCheckedIdArray(),r=getListProcessParams(n),i={addFlag:t,tagId:e,folderNames:r.fnames,uids:r.uids};mailControl.taggingMessage(i)}function writeAddrSelect(){var e=getCookie("ContactViewTypeMobile");e=e?e:"user",changeWriteAddrSelect(e),jQuery("select.addr_select").trigger("change")}function changeWriteAddrSelect(e){var t=jQuery("#writeAddrSelect").val(e);t.val(e),jQuery("#writeAddrLink span.txt").text(t.find("option:selected").text())}function changeMailWriteMode(){changeMailContainer("write"),makeTopMenuTitle(MAIL_APP_NAME),checkCcBccRcptArea()}function closeAddressContent(){jQuery("#addr_content").hide(),jQuery("#go_content").show(),jQuery("#main_content").addClass("write")}function makeAddrSelectItem(e,t){var n=null;jQuery("#writeAddrSelect").val()==="emp"?addSelectedMemberInReceiverList(e,t):(n=jQuery("#addr_member_list input[name=addrEmail]:checked"),jQuery(n).each(function(){var t=jQuery(this).data("name"),n=jQuery(this).data("position"),r=jQuery(this).data("department"),i=jQuery(this).data("email");makeAddressUnitFormat(e,getEmailInfoFormat(t,n,r,i))})),checkCcBccRcptArea();if(t.length===0&&(!n||n.length==0)){alert(mailMsg.comn_error_001);return}setTimeout(function(){alert(mailMsg.addr_list_write_insert_success)},200)}function closeWebFolder(){jQuery(window).off("scroll.renderNewWebFolderPage"),jQuery("#webfolder_content").hide(),jQuery("#mailWriteToolbarWrap").show(),jQuery("#go_content").show()}function goParentWebFolder(){jQuery("#moveParentWebFolder").trigger("click")}function checkUploadfile(e){var t,n,r,i,s,o;_.each(e,function(e){i=e.upkey,t=e.name,n=e.extension,r=e.size,o=e.hostId,s=e.uid?e.uid:"",addlist(t,n,r,i,o,s)})}function addlist(e,t,n,r,i,s){var o="normal",u=MAILCONFIG.maxAttachSize,a=parseInt(n)/1024/1024,f=a;jQuery("#attach_wrap li").each(function(){f+=jQuery(this).attr("filesize")/1024/1024});if(u<f){alert(msgArgsReplace(mailMsg.mail_attach_limit_size,[u]));return}var l={};return l.data={filePath:r,fileSize:n,fileName:e,hostId:i,uid:s,type:o,notChage:!0,fileExt:t,thumbnail:"/thumb/temp/"+i+"/small"+r},attachFileSuccess(l),!0}function changeMailWriteAddrType(e,t,n,r){var e=e?e:"user";setCookie("ContactViewTypeMobile",e,365);var i;e==="company"?i={groupId:n,isReadable:r}:e==="department"&&(i={deptId:n}),mailControl.writeAddrSelect(jQuery.extend({ownerType:e,isInit:t},i))}function searchAddrCancel(){jQuery("#search_keyword").val("")}function searchAddr(){var e=jQuery("#addrSearchText"),t=jQuery.trim(e.val());if(t==""){alert(mailMsg.alert_search_nostr),e.focus();return}if(!validateInput(e,2,64,"onlyBack"))return;var n=mailControl.getAddrParam(),r=n&&n.ownerType?n.ownerType:"user",i={ownerType:r};i.searchType="or",i.keyword=t,i.isReadable=n&&n.isReadable?n.isReadable:!1,mailControl.writeAddrSelect(i)}function clearSearchTerm(){var e=jQuery("#search_keyword");e.val(""),e.focus(),e.bind("focusout",function(){this.focus(),this.trigger("tap")}),setTimeout(function(){e.off("focusout")},300)}function goSharedFolder(e,t){if(!checkEscapeWriteMode())return;hideMailFolderSide();var n={folder:e,sharedFlag:"shared",sharedUserSeq:t,sharedFolderName:e};mailControl.loadMessageList(n)}function moveMessagePage(){makeCopyMoveContent(),changeMailContainer("moveFolder")}function tagMessagePage(){makeTagListContent(),changeMailContainer("tag")}function doDraftSave(){isAutoSave=!0;var e={};e=makeRcptForm(e);var t=jQuery("#editorMode").data("mode"),n;n=jQuery("#content").val(),e.subject=jQuery("#subject").val(),e.sendType="draft";var r=mailControl.getSendData();e.draftMessageId=r.draftMessageId,e.sendFlag=r.sendFlag,e.writeMode=t,e.uids=r.uids,e.folderName=r.folder,e.charset=r.charset,e.massMode=!1,e.content=n,e.mobileMail=!0,e.forwardOrgText=jQuery("#forwardOrgText").val(),e.replyOrgText=jQuery("#replyOrgText").val(),e.attachList=getAttachString(),mailControl.sendMessage(e)}function openDownloadAttachConfirm(){jQuery("#attachFileWrap").attr("evt-confirm",!0),jQuery("#downloadAttachConfirmCheck").html(getHandlebarsTemplate("mail_attach_download_confirm_tmpl")),jQuery("#attachDownloadConfirmSubject").text(jQuery("#readSubject").text()),jQuery("#attachFileCount").text(jQuery("#mailViewContentWrap div.add_file_header span.num").text()),jQuery("#attachDownloadConfirmItemWrap").empty(),jQuery("#attachFileWrap li").each(function(){var e={};e.name=jQuery(this).attr("fileName"),e.css=jQuery(this).find("span.ic_file").attr("class"),e.size=jQuery(this).find("span.size").text(),e.realsize=jQuery(this).attr("filesize"),e.part=jQuery(this).attr("part"),jQuery("#attachDownloadConfirmItemWrap").append(getHandlebarsTemplate("mail_attach_download_confirm_item_tmpl",e))}),jQuery("#attachOverlay").show(),jQuery("#downloadAttachConfirmLayer").show()}function checkSendMailCount(e){if(!isMaxSendMailCountUse||e.sendType=="draft")return!0;makeProcessLoader();var t=0,n=!0;jQuery.ajax({type:"POST",url:"/api/mail/recipientcount",data:{to:e.to,cc:e.cc,bcc:e.bcc},async:!1,success:function(e){t=e.data,removeProcessLoader()},error:function(){n=!1,removeProcessLoader()},dataType:"json"});if(!n)return!1;var r="";e.sendType=="reserved"&&(r=e.reservedDateUtc);var i=0;return jQuery.ajax({type:"POST",url:"/api/mail/sendmailcount",data:{sendType:e.sendType,reservedDateUtc:r},async:!1,success:function(e){i=e.data},dataType:"json"}),t+i>maxSendMailCount?(alert(mailMsg.mail_max_send_message_001),!1):!0}function addSelectedMemberInReceiverList(e,t){var n=[];_.each(t,function(e){var t=null,r=e.type.toLowerCase();if(r!=="department"&&r!=="org"||(r==="department"||r==="org")&&e.email!=="")t=!0;t?n.push(e):jQuery.ajax({type:"GET",url:"/api/organization/multi/list",async:!1,data:{deptid:e.id,type:"child"},dataType:"json",success:function(e){_.each(e,function(e){var t=_.extend(e.metadata,{department:e.metadata.deptName});n.push(t)})}})}),_.each(n,function(t){var n=_.isUndefined(t.department)?t.departments:t.department,r=getEmailInfoFormat(t.name,t.position,n,t.email);makeAddressUnitFormat(e,r)})};