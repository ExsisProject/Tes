var UploadSimpleBasicControl=function(e){var t=this;this.opt=e,this.init=function(){var e=this.opt;this.btnId="#"+e.btnId,this.listId="#"+e.listId,this.controlType=e.controlType,this.quota={hugeMax:0,normalMax:0,hugeUse:0,normalUse:0},this.normalFileList=new HashMap,this.hugeFileList=new HashMap,this.queueFileList=new HashMap,this.uploadCompleteFile=[],this.hugeMode=e.controlType=="power",this.defaultImgPath="/resources/images/upload.gif";var t=getCookie("isAttachAreaFolded")=="true"&&jQuery('[evt-rol="attach-area-toggle"]').length;t&&(jQuery('[evt-rol="attach-area-toggle"]').removeClass("ic_arrow_up_type4").addClass("ic_arrow_down_type4"),jQuery("#att_simple_area").hide())},this.makeBtnControl=function(){function e(e){var t=e.files[0];return jQuery("#"+t.id).length?!1:t.relativePath?!1:!0}if(this.btnId=="#basicUploadControl"){var n=jQuery("#dropZone"),r=null;jQuery("#simpleFileInitSub").off("click"),jQuery("#simpleFileInitSub").on("click",function(){jQuery("#mailSimpleUpload").click()}),jQuery("#mailSimpleUpload").unbind(),n.unbind(),jQuery("#mailSimpleUpload").fileupload({url:"/api/mail/file/upload",sequentialUploads:!0,formData:{uploadType:"flash",maxAttachFileSize:MAX_ATTACH_SIZE},dataType:"json",done:function(e,t){},dropZone:n,pasteZone:null}),n.bind("dragleave",function(e){clearTimeout(r),r=setTimeout(function(){n.removeClass("drag_file")},100)}),n.bind("dragover",function(e){e.preventDefault(),e.stopPropagation(),e.originalEvent.dataTransfer.dropEffect="move",jQuery(this).addClass("drag_file"),clearTimeout(r)}),n.bind("drop",function(e){e.preventDefault(),e.stopPropagation(),jQuery(this).removeClass("drag_file")}),jQuery("#mailSimpleUpload").bind("fileuploadadd",function(e,n){uploadAttachFilesComplete=!1;var r=basicAttachUploadControl.generatorFileIndex(),i="file_index_"+r;n.files[0].id=i,n.files[0].index=r;var s=n.files[0],o=basicAttachUploadControl.getAttachQuotaInfo(),u=s.size+o.normalUse>o.normalMax,a=jQuery("#bigAttachFlagCheck").attr("checked"),f="normal";if((a||s.size>o.normalMax||u)&&basicAttachUploadControl.getHugeUploadUse()){f="huge";if(s.size+o.hugeUse>o.hugeMax)return u?jQuery.goAlert(mailMsg.comn_upload_title,mailMsg.ocx_upalert_size):jQuery.goAlert(mailMsg.comn_upload_title,printSize(o.hugeMax)+" "+mailMsg.ocx_upalert_size),!1;if(s.size>MAX_BIG_ATTACH_SIZE)return jQuery.goAlert(mailMsg.comn_upload_title,msgArgsReplace(mailMsg.bigattach_18,[printSize(MAX_BIG_ATTACH_SIZE)])),!1;n.formData={uploadType:"flash",maxAttachFileSize:MAX_ATTACH_SIZE,attachtype:"huge",regdate:today.getTime()},updateAttachQuota("hugeUse",s.size+o.hugeUse)}else{f="normal";if(s.size+o.normalUse>o.normalMax)return jQuery.goAlert(mailMsg.comn_upload_title,printSize(o.normalMax)+" "+mailMsg.ocx_upalert_size),!1;if(s.size>MAX_ATTACH_SIZE*1024*1024)return jQuery.goAlert(mailMsg.comn_upload_title,MAX_ATTACH_SIZE+"MB "+mailMsg.ocx_upalert_size),!1;updateAttachQuota("normalUse",s.size+o.normalUse)}var s={id:i,index:r,name:s.name,size:s.size,type:f};t.addAttachFile(s);var l=n.submit();jQuery('[data-id="'+i+'delBtn"]').on("click",function(e){l.abort()})}).bind("fileuploadprogress",function(e,t){var n=t.files[0],r=n.id,i=Math.ceil(t.loaded/t.total*100);i>99&&(i=100),i=i>=100?100:i;var s=jQuery("#progress_"+r);s.hide(),s.find(".gage").css("width",i),s.show(),jQuery("#"+r+"delBtn").show();var o=jQuery("#status_"+r);i==100?o.html("<img src='/resources/images/img_loader_s.gif'>"):o.html('<span class="rate">'+i+"%</span>")}).bind("fileuploadsubmit",function(e,t){var n=jQuery("#bigAttachFlagCheck").attr("checked"),r=t.formData?t.formData.attachtype=="huge":!1;if(n||r)t.formData={uploadType:"flash",maxAttachFileSize:MAX_ATTACH_SIZE,attachtype:"huge",regdate:today.getTime()}}).bind("fileuploadsend",function(e,t){}).bind("fileuploaddone",function(e,n){var r=n.result,i=r.uploadResult,s=mailMsg.comn_upload_complete,o=r.fileSize,u=n.files[0],a=u.id;if(i==="success"){var f=jQuery("#bigAttachFlagCheck").attr("checked"),l=n.formData?n.formData.attachtype=="huge":!1,c=f||l?"huge":"normal";addlistForJQuery(r.fileName,r.fileSize,r.filePath,r.hostId,r.uid,c,a)}else{s=mailMsg.conf_pop_54;if(o==0)return jQuery.goAlert(mailMsg.comn_upload_title,mailMsg.file_size_zero),jQuery("#"+a).closest("li").remove(),uploadAttachFilesComplete=!0,!1}uploadAttachFilesComplete=t.isUploadComplete(u,n.originalFiles),t.updateAttachFileProgress(a,s),jQuery("#att_simple_area").toggle(!0),jQuery('[evt-rol="attach-area-toggle"]').removeClass("ic_arrow_down_type4").addClass("ic_arrow_up_type4"),setCookie("isAttachAreaFolded",!1,365)}).bind("fileuploadfail",function(e,n){uploadAttachFilesComplete=t.isUploadComplete(n.files[0],n.originalFiles);if(n.errorThrown!="abort"){var r=n.files[0].id;t.updateAttachFileProgress(r,mailMsg.conf_pop_54),jQuery.goAlert(mailMsg.comn_upload_title,mailMsg.error_fileupload)}}).bind("fileuploadchunkalways",function(e,t){})}else jQuery("#massSimpleUpload").unbind(),jQuery("#massSimpleUpload").fileupload({url:"/api/mail/file/upload",formData:{uploadType:"flash",maxAttachFileSize:MAX_ATTACH_SIZE},dataType:"json",done:function(e,t){var n=t.result,r=n.fileName,i=(parseInt(n.fileSize)/1024).toFixed(2),s=["<span class='item_file' file-path='"+n.filePath+"'>","<span class='ic_file ic_txt'></span>","<span class=''>"+r+"</span>","<span class='size'>"+i+"KB"+"</span>","<span class='btn_bdr'>","<span class='ic_classic ic_del' title='"+mailMsg.comn_del+"'></span>","</span>","</span>"].join("");if(!isConfirmFile(r,"txt")){jQuery.goAlert(msgArgsReplace(mailMsg.error_nofileext,["txt"]));return}$fileItemTmp=jQuery(s),jQuery("#massFileItem").html($fileItemTmp),jQuery("#uploadActor").hide(),$fileItemTmp.find("span.ic_del").on("click",function(e){jQuery(this).parents("span.item_file:first").remove(),jQuery("#uploadActor").show()})}})},this.generatorFileIndex=function(){var e=0,t=jQuery("#basicAttachList > li").size();if(t>0){var n=jQuery("#basicAttachList li:last").attr("data-index");n&&(e=parseInt(n)+1)}return e},this.isUploadComplete=function(e,t){return e==t[t.length-1]},this.btnControldestory=function(){},this.getControlFile=function(){},this.startUpload=function(){},this.stopUpload=function(){},this.cancelUpload=function(){},this.resetUpload=function(){this.init(),this.makeListControl()},this.makeListControl=function(){var e=jQuery('<ul id="basicAttachList" class="attach_list" style="display: none;">'),t=jQuery('<ul id="bigAttachList" class="file_wrap big_file" style="display: none;">'),n=this.listId;setTimeout(function(){jQuery(n).empty(),jQuery(n).append(e),jQuery(n).append(t)},100)},this.makeListWebFolderControl=function(){var e=jQuery('<table class="form_type"></table>'),t=jQuery("<tr></tr>"),n=jQuery('<td style="padding:0"></td>'),r=jQuery('<table id="basicAttachTitle" class="in_table form_mail004"></table>'),i=jQuery("<thead></thead>"),s=jQuery("<tr></tr>");s.append('<th class="checkbox"><input type="checkbox" id="basicAttachChkAll" onclick="checkAll(this,document.uploadForm.basicAttachFileEl)"/></th>'),s.append('<th class="align_l filename">'+mailMsg.bigattach_list_001+"</th>"),s.append('<th class="align_l attachtype">'+mailMsg.webfolder_ext+"</th>"),s.append('<th class="align_r filesize">'+mailMsg.bigattach_list_002+"</th>"),s.append('<th class="align_c" style="width:46px">'+mailMsg.comn_upload_status+"</th>"),i.append(s),r.append(i),n.append(r),t.append(n),e.append(t);var o=jQuery('<div class="div_scroll" style="height:200px"><table id="basicAttachList" class="in_table form_mail004">'),u=this.listId;setTimeout(function(){jQuery(u).empty(),jQuery(u).append(e),jQuery(u).append(o)},100)},this.addAttachList=function(e){t.addAttachFile(e),t.updateAttachFile(e),t.updateAttachFileProgress(e.id)},this.addAttachFile=function(e){function r(e){var t=[];t.push('<span class="attach_opt">');if(i(getFileTypeImage(e.name))){var n=['<span class="btn_fn7" onclick="previewTempFile(\''+e.id+'\')"><span class="txt">'+mailMsg.mail_preview+"</span></span>&nbsp;"];t.push(n)}var r=['<span class="btn_fn7" onclick="downloadTempFile(\''+e.id+'\')"><span class="txt">'+mailMsg.bigattach_09+"</span></span>"];return t.push(r),t.push("</span>"),t.join("")}function i(e){e=e.toLowerCase();var t="doc|docx|hwp|ppt|pptx|xls|xlsx|pdf|txt|jpg|jpeg|gif|tif|tiff|png",n=new RegExp("("+t+")$","i");return n.test(e)?!0:!1}var t=e.type=="huge",n='<li id="'+e.id+'Low" data-index="'+e.index+'" class="wrap_file">'+'<input type="checkbox" id="'+e.id+'" name="basicAttachFileEl" style="display: none;" attsize="'+e.size+'" atttype="'+(t?"huge":"normal")+'" />'+'<span class="file">'+'<span class="btn_wrap" onclick="deletefileById(\''+e.id+"')\">"+'<span id="'+e.id+'delBtn" data-id="'+e.id+'delBtn" class="ic_attach ic_del"></span>'+"</span>"+'<span class="ic_file ic_'+getFileTypeImage(e.name)+'"></span>'+'<span class="name">'+escape_tag(e.name)+"</span>"+r.call(this,e)+"</span>"+'<span class="info">'+'<span class="etc">'+'<span class="gage_wrap" id="progress_'+e.id+'" style="display: none;">'+'<span class="gage" style="width: 0%;"></span>'+"</span>"+"</span>"+'<span id="status_'+e.id+'" class="status">'+'<span class="ic state_stay"></span>'+"</span>"+'<span class="kind">'+'<span class="'+(t?"state nude":"txt")+'">'+(t?mailMsg.bigattach_11:mailMsg.bigattach_10)+"</span>"+"</span>"+'<span class="size">'+printSize(e.size)+"</span>"+"</span>"+"</li>";jQuery("#basicAttachList").show().append(n),showAttachBoxDisplay(!0)},this.updateAttachFileProgress=function(e,t){jQuery('[data-id="fileNameWrapper_'+e+'"]').show(),jQuery("#progress_"+e).hide(),jQuery("#status_"+e).html('<span class="ic state_complete"></span>')},this.updateAttachFile=function(e){var t=e.type=="huge";t?this.hugeFileList.put(e.id,e):this.normalFileList.put(e.id,e)},this.addAttachWebfolderList=function(e){var t=e.type=="huge",n='<tr id="'+e.id+'Low" >';n+='<td class="checkbox"><input type="checkbox" id="'+e.id+'" name="basicAttachFileEl" value="" attsize="'+e.size+'" atttype="'+(t?"huge":"normal")+'">'+'<span class="btn_bdr" onclick="deletefileById(\''+e.id+"')\">"+'<span title="'+mailMsg.comn_del+'" class="ic_attach ic_del"></span>'+"</span>"+"</td>",n+='<td class="align_l filename" title="'+escape_tag(e.name)+'">'+'<span class="item_file file_wrap">'+'<span class="ic_file ic_'+getFileTypeImage(e.name)+'"></span>'+'<span class="name">'+escape_tag(e.name)+"</span>"+"</span>"+"</td>",n+='<td class="align_c attachtype"><span class="name">'+getFileTypeImage(e.name)+"</span>"+"</td>",n+='<td class="align_r filesize"><span class="size">'+printSize(e.size)+"</span></td>",n+='<td id="'+e.id+'TypeInfo" class="align_c" style="width:30px">'+'<span id="progress_'+e.id+'" class="progressBar">'+'<span class="ic state_complete"></span>'+"</span>"+"</td>",n+="</tr>",t?this.hugeFileList.put(e.id,e):this.normalFileList.put(e.id,e),jQuery("#basicAttachList").append(n)},this.getCheckAttachFileIds=function(){var e=[];return jQuery("/*#basicAttachList */input[name=basicAttachFileEl]:checked").each(function(){e.push(jQuery(this).attr("id"))}),e},this.deleteAttachList=function(e,t){var n=jQuery("#"+e).attr("atttype"),r=jQuery("#"+e).attr("attsize");n=="huge"?(this.hugeFileList.remove(e),updateAttachQuota("hugeUse",this.quota.hugeUse-parseInt(r,0))):(this.normalFileList.remove(e),updateAttachQuota("normalUse",this.quota.normalUse-parseInt(r,0))),t?jQuery(t.currentTarget).parents("#"+e+"Low").remove():jQuery("#"+e+"Low").remove()},this.setAttachSize=function(e,t){e=="hugeMax"?this.quota.hugeMax=t:e=="hugeUse"?this.quota.hugeUse=t:e=="normalMax"?this.quota.normalMax=t:e=="normalUse"&&(this.quota.normalUse=t)},this.getAttachSize=function(e){var t=0;return e=="hugeMax"?t=this.quota.hugeMax:e=="hugeUse"?t=this.quota.hugeUse:e=="normalMax"?t=this.quota.normalMax:e=="normalUse"&&(t=this.quota.normalUse),t},this.getAttachQuotaInfo=function(){return this.quota},this.getFileList=function(e){return e=="huge"?this.hugeFileList.getValues():e=="normal"?this.normalFileList.getValues():[]},this.setFileList=function(e,t){var n=new HashMap;for(var r=0;r<t.length;r++)n.put(t[r].id,t[r]);e=="huge"?this.hugeFileList=n:this.normalFileList=n},this.getAttachFileInfo=function(e,t){return e=="huge"?this.hugeFileList.get(t):this.normalFileList.get(t)},this.setAttachFileInfo=function(e,t,n){e=="huge"?this.hugeFileList.put(t,n):this.normalFileList.put(t,n)},this.setUploadCompleteFile=function(e,t){var n=this.hugeFileList.get(e);n?(n.uid=t.uid,n.path=t.filePath,this.hugeFileList.remove(e),this.hugeFileList.put(e,n)):(n=this.normalFileList.get(e),n&&(n.uid=t.uid,n.path=t.filePath,this.normalFileList.remove(e),this.normalFileList.put(e,n)))},this.setHugeUploadUse=function(e){this.hugeMode=e},this.getHugeUploadUse=function(){return this.hugeMode},this.isHugeTypeFile=function(e){var t=this.hugeFileList.get(e);return t?!0:!1},this.chageAttachType=function(e){},this.destroy=function(){this.listId&&jQuery(this.listId).empty(),this.quota={hugeMax:0,normalMax:0,hugeUse:0,normalUse:0},this.normalFileList&&this.normalFileList.destroy(),this.hugeFileList&&this.hugeFileList.destroy(),this.queueFileList&&this.queueFileList.destroy(),this.uploadCompleteFile=[]},this.emptyFileList=function(){this.listId&&jQuery(this.listId).empty()}},SignSimpleSettingControl=function(e){this.opt=e,this.makeBtnControl=function(){},this.destroy=function(){}},MailSimpleInlineImgControl=function(e){this.opt=e,this.makeBtnControl=function(){},this.destroy=function(){}};