var HistoryControl=function(a){this.historyIdx=0;this.History=window.History;this.History.Adapter.bind(window,"statechange",function(){a(this.History.getState())});this.setHistory=function(b){b.state=this.historyIdx;this.historyIdx++;this.History.pushState(b,TITLENAME,"?state="+this.historyIdx)};this.getHistoryIndex=function(){return this.historyIdx}};var ActionLoader={};ActionLoader.postLoadAction=function(b,d,c,a){jQuery.post(b,d,function(e,f){c(e,f)},a)};ActionLoader.getLoadAction=function(b,d,c,a){jQuery.get(b,d,function(e,f){c(e,f)},a)};ActionLoader.requestGoLoadAction=function(c,h,b,d,g,f,a,e){ActionLoader.isloadAction=true;jQuery.ajax({type:c,contentType:h,url:d,data:g,async:b,success:function(i){f(i.data)},error:function(k){var j=JSON.parse(k.responseText);if(j.code=="401"){if(BASECONFIG.data.useOtp||BASECONFIG.data.useCert){var i=k.getResponseHeader("Location");if(i==null){window.location=window.location.href}else{window.location=i}}else{window.location="/"}}else{if(e){e(j)}else{alert(j.message)}}},dataType:a})};var formContentType="application/x-www-form-urlencoded; charset=UTF-8";var jsonContentType="application/json; charset=UTF-8";ActionLoader.getGoLoadAction=function(b,e,d,a,c){ActionLoader.requestGoLoadAction("GET",formContentType,true,b,e,d,a,c)};ActionLoader.getSyncGoLoadAction=function(b,e,d,a,c){ActionLoader.requestGoLoadAction("GET",formContentType,false,b,e,d,a,c)};ActionLoader.postGoLoadAction=function(b,e,d,a,c){ActionLoader.requestGoLoadAction("POST",formContentType,true,b,e,d,a,c)};ActionLoader.postGoJsonLoadAction=function(b,e,d,a,c){ActionLoader.requestGoLoadAction("POST",jsonContentType,true,b,JSON.stringify(e),d,a,c)};ActionLoader.postSyncGoLoadAction=function(b,e,d,a,c){ActionLoader.requestGoLoadAction("POST",formContentType,false,b,e,d,a,c)};ActionLoader.postSyncGoJsonLoadAction=function(b,e,d,a,c){ActionLoader.requestGoLoadAction("POST",jsonContentType,false,b,JSON.stringify(e),d,a,c)};ActionLoader.putGoJsonLoadAction=function(b,e,d,a,c){ActionLoader.requestGoLoadAction("PUT",jsonContentType,true,b,JSON.stringify(e),d,a,c)};function makeTopMenuTitle(a){jQuery("#top_menu_title").text(a)}function initLayoutSize(){var a=jQuery(window).height();var c=jQuery(document).height();var d=jQuery("header.go_header div.nav").height();jQuery("#go_body").css({height:"auto","min-height":a-d});var a=jQuery(window).height();var d=jQuery("header.go_header div.nav").height();if(MOBILE_WEB){var b=jQuery("footer").height();a=(isAndroid())?a-b-d:a-d;jQuery("#mail_folder_side").css({top:d+"px",height:a+"px"})}else{jQuery("#mail_folder_side").css({top:d+"px",height:c-d-1+"px"})}jQuery("#top_menu_title").on("click",function(){gotoMailHome()})}var IscrollControl=function(c,a){var b=this;this.topOffset=(a.topOffset)?a.topOffset:0;this.mainTop=(a.mainTop)?a.mainTop:88;this.pullUpDownUse=(a.pullUpDownUse)?a.pullUpDownUse:false;this.bounce=(a.bounceBlock)?false:true;this.clickStyle=(a.clickStyle)?true:false;this.zoom=(a.zoom)?true:false;this.$obj=jQuery("#"+c);this.myScroll=null;this.pullUpEl=null;this.pullDownEl=null;this.pullDownOffset=0;this.pullUpOffset=0;this.makeIscroll=function(){b.destroyIscroll();b.$obj.css({position:"absolute",top:b.mainTop+"px",bottom:"15px",left:"0","padding-bottom":"10px",width:"100%",overflow:"hidden"});this.makePullUpDownTmpl();this.myScroll=new iScroll(c,{useTransition:true,topOffset:b.topOffset||0,bounce:b.bounce,clickStyle:b.clickStyle,zoom:b.zoom,onBeforeScrollStart:function(f){var d=f.target;while(d.nodeType!=1){d=d.parentNode}if(d.tagName!="SELECT"&&d.tagName!="INPUT"&&d.tagName!="TEXTAREA"){f.preventDefault()}},onRefresh:function(){if(b.pullUpDownUse){if(b.pullUpEl.hasClass("loading")){b.pullUpEl.removeClass("loading");b.pullUpEl.find("span.pullUpLabel").text(mailMsg.mail_mobile_pullup_touchstart)}}},onScrollMove:function(){if(b.pullUpDownUse){if(this.y<(this.maxScrollY-5)&&!b.pullUpEl.hasClass("flip")){b.pullUpEl.addClass("flip");b.pullUpEl.find("span.pullUpLabel").text(mailMsg.mail_mobile_pullup_touchend);this.maxScrollY=this.maxScrollY}else{if(this.y>(this.maxScrollY+5)&&b.pullUpEl.hasClass("flip")){b.pullUpEl.removeClass("flip");b.pullUpEl.find("span.pullUpLabel").text(mailMsg.mail_mobile_pullup_touchstart);this.maxScrollY=b.pullUpOffset}}}},onScrollEnd:function(){if(b.pullUpDownUse){if(b.pullUpEl.hasClass("flip")){b.pullUpEl.removeClass("flip").addClass("loading");b.pullUpEl.find("span.pullUpLabel").text(mailMsg.mail_mobile_loading);if(a.upAction){a.upAction()}}}}});document.addEventListener("touchmove",function(d){d.preventDefault()},false)};this.scrollToTop=function(){if(this.myScroll){this.myScroll.scrollTo(0,0,0)}},this.scrollToBottom=function(){if(this.myScroll){this.myScroll.scrollTo(0,this.myScroll.maxScrollY,0)}},this.refreshIscroll=function(){if(this.myScroll){this.makePullUpDownTmpl();this.myScroll.refresh()}else{this.makeIscroll()}};this.destroyIscroll=function(){if(this.myScroll){this.myScroll.destroy();this.myScroll=null;jQuery("#"+c+"_pullUp").remove();b.$obj.removeAttr("style")}};this.getIscrollObj=function(){return this.myScroll};this.getPullUpObj=function(){return jQuery("#"+c+"_pullUp")};this.makePullUpDownTmpl=function(){if(b.pullUpDownUse){if(!jQuery("#"+c+"_pullUp").length){b.$obj.find("div.iscroll").append('<div id="'+c+'_pullUp" class="pullUp" style="display:none"><span class="pullDownIcon"><span class="pullUpIcon"></span><span class="pullUpLabel">'+mailMsg.mail_mobile_pullup_touchstart+"</span></div>")}b.pullUpEl=jQuery("#"+c+"_pullUp");b.pullUpOffset=b.pullUpEl&&b.pullUpEl.length>0?b.pullUpEl[0].offsetHeight:0}}};jQuery.fn.refreshIscroll=function(b){if(b){b.refresh()}else{var a=jQuery(this).data("opt");b=jQuery(this).makeIscroll(a)}return b};function isAndroid(){return checkOS()=="android"}function isIphone(){return checkOS()=="iphone"}function isIpad(){return checkOS()=="ipad"}function checkOS(){var a=window.navigator.userAgent.toLowerCase();if(a.indexOf("android")>-1){return"android"}else{if(a.indexOf("iphone")>-1){return"iphone"}else{if(a.indexOf("ipad")>-1){return"ipad"}else{return -1}}}}function isAndroidApp(){return isMobileApp()&&checkOS()=="android"}function isIphoneApp(){return isMobileApp()&&(checkOS()=="iphone"||checkOS()=="ipad")}function isMobileApp(){var a=sessionStorage.getItem("GO-Agent-mail");return(a=="GO-Android"||a=="GO-iPhone")}var mailToolbarRuleMap=new HashMap();mailToolbarRuleMap.put("normal",{remove:true,reply:true,forward:true,seen:true,copy:true,move:true,resend:false});mailToolbarRuleMap.put("inbox",{remove:true,reply:true,forward:true,seen:true,copy:true,move:true,resend:false});mailToolbarRuleMap.put("sent",{remove:true,reply:true,forward:true,seen:true,copy:true,move:true,resend:true});mailToolbarRuleMap.put("drafts",{remove:true,reply:false,forward:false,seen:false,copy:true,move:true,resend:false});mailToolbarRuleMap.put("reserved",{remove:true,reply:false,forward:false,seen:false,copy:false,move:false,resend:false});mailToolbarRuleMap.put("spam",{remove:true,reply:true,forward:true,seen:true,copy:true,move:true,resend:false});mailToolbarRuleMap.put("trash",{remove:true,reply:true,forward:true,seen:true,copy:true,move:true,resend:false});mailToolbarRuleMap.put("all",{remove:true,reply:true,forward:true,seen:true,copy:true,move:true,resend:false});mailToolbarRuleMap.put("shared",{remove:false,reply:true,forward:true,seen:false,copy:true,move:false,resend:false});mailToolbarRuleMap.put("quotaviolate",{remove:false,reply:true,forward:true,seen:false,copy:true,move:false,resend:false});var mailControl,folderControl,historyControl;var currentFolderType,currentFolderName,currentFolderViewName,currentFolderEncName,isAllfolder,currentMenu;var isBookmark=false;var listType="mail";var bookmarkType="mail";var bookmarkSeq=0;var bookmarkName="";var bookmarkValue="";var isCallPreviewAttach=false;var isMaxSendMailCountUse=false;var maxSendMailCount=0;var isFirstLoad=false;var sendConfirm="";var LOCAL_DOMAIN="";var toolBarMenus={"전체선택":{id:"mail_toolbar_list_selectall",action:"mail-select-all",ignore:"on",text:mailMsg.mail_select_all},"전체선택_search":{id:"mail_toolbar_search_selectall",action:"mail-select-all",ignore:"on",text:mailMsg.mail_select_all},"삭제_list":{id:"mail_toolbar_list_delete",action:"mail-delete",text:mailMsg.menu_delete},"삭제_read":{id:"mail_toolbar_read_delete",action:"mail-delete",text:mailMsg.menu_delete},"읽음":{selectId:"toolbar_seen_flag",menu:"seen",role:"change-flag-seen",text:mailMsg.menu_flag_read},"안읽음":{selectId:"toolbar_seen_flag",menu:"seen",role:"change-flag-unseen",text:mailMsg.menu_flag_unread},"이동":{id:"mail_toolbar_list_move",action:"move-message-page",text:mailMsg.menu_move},"태그":{id:"mail_toolbar_list_tag",action:"tag-message-page",text:mailMsg.folder_tag},"전체답장_read":{title:mailMsg.mail_thismessage,id:"mail_toolbar_read_replyall",action:"mail-reply-all",text:mailMsg.menu_replyall,inMoreBtn:true},"스팸이동":{id:"mail_toolbar_spam_move",action:"mail_spam_move",text:mailMsg.menu_conf_spam+mailMsg.comn_move,inMoreBtn:true},"이동_read":{title:mailMsg.mail_thismessage,id:"mail_toolbar_read_move",action:"move-message-page",text:mailMsg.mail_folder_move,inMoreBtn:true},"태그_read":{title:mailMsg.mail_thismessage,id:"mail_toolbar_read_tag",action:"tag-message-page",text:mailMsg.folder_tag,inMoreBtn:true},"안읽음_read":{title:mailMsg.mail_thismessage,action:"change-flag-unseen",text:mailMsg.menu_flag_unread,inMoreBtn:true},"이전":{id:"read_pre_message_btn",action:"read-pre-message",text:mailMsg.comn_page_up,inMoreBtn:true},"다음":{id:"read_next_message_btn",action:"read-next-message",text:mailMsg.comn_page_down,inMoreBtn:true},"답장":{id:"mail_toolbar_read_reply",action:"mail-reply",text:mailMsg.menu_reply},"전달":{id:"mail_toolbar_read_forward",action:"mail-forward",text:mailMsg.menu_forward}};jQuery(document).ready(function(){initLayoutSize();initMailFunction();isFirstLoad=true;makeTopMenuTitle(MAIL_APP_NAME);if(workAction=="error"){return}var a=false;if(workAction=="write"){jQuery("#mailHomeToolbarWrap").hide();a=true;var b={};if(writeToList){b.to=unescape_tag_title(writeToList)}b.init=true;goWrieLoad(b)}else{if(workAction=="read"){if(isNotFoundError=="true"){alert(mailMsg.mail_sid_not_found_alert);gotoMailHome(true)}if(workFolder&&workFolder!=""&&workUid&&Number(workUid)>0){a=true;readMessage(unescape_tag_title(workFolder),workUid)}}}if(!a){gotoMailHome(true)}folderControl.getFolderAllInfo();folderControl.getBookmarkInfo();pageDone();changeStatusBarColor(false);displayHomeIcon()});window.moveTab=function(){isMoveTabReturn();if(checkEscapeWriteMode()){isMoveTab()}};var FolderControl=function(){var a=this;this.folderInfoAction="/api/mail/folder/info";this.folderAllInfoAction="/api/mail/folder/all";this.emptyFolderAction="/api/mail/folder/empty";this.bookmarkListAction="/api/mail/bookmark/list";this.defaultFolders=[];this.userFolderList=[];this.tagData=[];this.Iscroll=null;this.getFolderAllInfo=function(){var b={};ActionLoader.getGoLoadAction(this.folderAllInfoAction,b,function(c){a.printFolderAllInfo(c)},"json")};this.printFolderAllInfo=function(b){a.printFolderInfo(b);a.makeTagList(b.userTags);a.makeSharedFolderList(b.userSharedFolderList)};this.printFolderInfo=function(b){a.makeDefaultFolder(b.defaultFolders);a.makeUserFolder(b.userFolders);a.printFolderCountUpdateBookmark(b.defaultFolders);a.printFolderCountUpdateBookmark(b.userFolders);a.quotaInfo=b.quotaInfo};this.makeDefaultFolder=function(d){this.defaultFolders=d;var c=false;if(d&&d.length>0){for(var e=0;e<d.length;e++){var f=d[e];if(f.fullName=="Quotaviolate"){c=true}var b=jQuery("#"+f.id+"_num");b.empty();if(f.fullName!="Sent"&&f.unseenCnt>0){b.text(f.unseenCnt)}}}if(c){jQuery("#folder_quotaviolate").show()}else{jQuery("#folder_quotaviolate").hide()}};this.makeUserFolder=function(b){this.userFolderList=b;b.isInbox=true;jQuery("#inbox_folder_area").handlebars("mail_user_folder_tmpl",b);b.isInbox=false;jQuery("#uf_folder_area").handlebars("mail_user_folder_tmpl",b);jQuery("#uf_smart_area").handlebars("mail_smart_folder_tmpl",b);if(jQuery("#uf_smart_area li").length>0){jQuery("#smart_menu").show()}else{jQuery("#smart_menu").hide()}};this.makeSharedFolderList=function(b){if(b&&b.length>0){jQuery("#shared_folder_title").show()}else{jQuery("#shared_folder_title").hide()}jQuery("#shared_folder_wrap").handlebars("shared_folder_tmpl",b)};this.makeTagList=function(b){a.tagData=b;jQuery("#mail_tag_list_area").handlebars("mail_tag_tmpl",b)};this.getBookmarkInfo=function(){ActionLoader.getGoLoadAction(this.bookmarkListAction,null,function(b){jQuery("#mail_bookmark_list").handlebars("mail_bookmark_tmpl",b)},"json")};this.updateFolderCountInfo=function(){var b={};ActionLoader.getGoLoadAction(this.folderInfoAction,b,function(c){a.printFolderCountUpdate(c);a.printFolderCountUpdateBookmark(c)},"json")};this.printFolderCountUpdate=function(f){var c=f;if(c&&c.length>0){for(var d=0;d<c.length;d++){var e=c[d];var b=jQuery("#"+e.id+"_num");b.empty();if(e.fullName!="Sent"&&e.unseenCnt>0){b.text(e.unseenCnt)}if(e.child&&e.child.length>0){a.printFolderCountUpdate(e.child)}}}};this.printFolderCountUpdateBookmark=function(b){if(b&&b.length>0){for(var c=0;c<b.length;c++){var d=b[c];jQuery("#mail_bookmark_list li").each(function(){var g=jQuery(this).attr("query");var f=jQuery(this).attr("seq");if(g==d.fullName){var e=jQuery("#bookmark_num_"+f);e.empty();if(d.unseenCnt>0){e.text(d.unseenCnt)}}});if(d.child&&d.child.length>0){a.printFolderCountUpdateBookmark(d.child)}}}};this.emptyMailFolder=function(b){ActionLoader.postGoLoadAction(this.emptyFolderAction,b,function(c){if(b.folderName==currentFolderName){mailControl.reloadMessageList()}else{executeFolderInfo()}},"json")};this.getQuotaInfo=function(){return this.quotaInfo};this.getTagData=function(){return this.tagData};this.getDefaultFolderList=function(){return this.defaultFolders};this.getUserFolderList=function(){return this.userFolderList};this.makeMailEvent=function(){jQuery("#mail_folder_side").on("tap","a",function(c){var j=jQuery(this).attr("evt-rol");if(!j){return}if(c.stopPropagation){c.stopPropagation()}else{c.cancelBubble=true}c.preventDefault();if(j=="folder"){var f=jQuery(this).attr("fname");goFolder(f)}else{if(j=="empty-spam-folder"){emptyFolder("Spam")}else{if(j=="empty-trash-folder"){emptyFolder("Trash")}else{if(j=="tag-message"){var g={folder:"all",listType:"tag",tagId:jQuery(this).attr("val")};goMailList(g)}else{if(j=="bookmark-execute"){var d=jQuery(this).closest("li");var h=d.attr("type");var i=d.attr("query");var k=d.attr("seq");bookmarkExecute(k,h,i)}else{if(j=="folder-execute"){var l=jQuery(this).attr("type");folderExecute(l)}else{if(j=="receive-noti-list"){loadMdnList()}else{if(j=="shared-folder"){var f=jQuery(this).attr("fname");var e=jQuery(this).attr("seq");goSharedFolder(f,e)}else{if(j=="move-security-center"){var b=jQuery(this).attr("evt-data-url");executeExtUrl(b)}}}}}}}}}});jQuery(window).on("orientationchange",function(){window.orientationChangeListener()});window.orientationChangeListener=function(){if(console){console.log("orientationchange")}setTimeout(function(){var b=jQuery("#mail_folder_side").css("display")==="none"?false:true;folderControl.setBodyHeight(b);folderControl.setSideHeight();if(folderControl.Iscroll){folderControl.Iscroll.refresh()}},1000)}};this.setSideHeight=function(){var c=jQuery("#mail_folder_side");var e=jQuery("header div.nav");var d=jQuery(window).height();var b=d-e.height();c.css({height:b})};this.setBodyHeight=function(c){var b=jQuery("#go_body");if(c){b.height(jQuery(window).height()-jQuery("header").height())}else{b.height("auto")}};this.makeLeftMenuIscroll=function(){if(this.Iscroll){this.Iscroll.refresh()}else{this.Iscroll=new IScroll("#mail_folder_side",{bounce:true,scrollbars:true})}}};var MailControl=function(){var a=this;this.offset=20;this.listAction="/api/mail/message/list";this.readAction="/api/mail/message/read";this.writeAction="/api/mail/message/write";this.sendAction="/api/mail/message/send";this.mdnListAction="/api/mail/message/mdn/list";this.mdnReadAction="/api/mail/message/mdn/read";this.deleteMdnAction="/api/mail/message/mdn/delete";this.recallMessageAction="/api/mail/message/mdn/recall";this.sendMdnResponseAction="/api/mail/message/mdn/send";this.deleteMessageAction="/api/mail/message/delete";this.switchFlagAction="/api/mail/message/flag";this.searchAddressAction="/api/mail/address/search/name";this.copyMessageAction="/api/mail/message/copy";this.moveMessageAction="/api/mail/message/move";this.writeAddrSelectAction="/api/contact/contacts";this.writeAddrSearchAction="/api/contact/search";this.deptSelectAction="/api/department/list/joined";this.companySelectAction="/api/contact/companyfolder/manage";this.writeAttachAction="/api/file";this.signListAction="/api/mail/setting/sign/list";this.taggingMessageAction="/api/mail/message/tag";this.isMailAttachSearchAction="/api/system/mailattachsearch";this.viewFolderAction="/api/webfolder/folder/list";this.webfolderAttachWriteAction="/api/webfolder/mail/attach/write";this.viewShareFolderAction="/api/webfolder/folder/tree?type=share";this.listMode="mail";this.listParam={};this.readParam={};this.writeParam={};this.writeData={};this.sendData={};this.addrParam={};this.sharedFlag=false;this.currentFolder="Inbox";this.nextPage=1;this.addrNextPage=1;this.lastPage=1;this.preNavi={};this.nextNavi={};this.Iscroll=null;this.selectedMailId=null;this.pageNo=null;this.dataSet={};this.searchInfo={};this.depts=[];this.users=[];this.selectedNodes=[];this.isMultiSite=false;this.webFolderParamHistoryList=[];this.currentWebFolderInfo={};this.isMailAttachSearch=function(){var b=false;ActionLoader.getSyncGoLoadAction(this.isMailAttachSearchAction,null,function(c){b=c},"json");return b};this.getSearchList=function(b,c){a.searchInfo.param=b;ActionLoader.postSyncGoJsonLoadAction(this.listAction,b,function(d){a.searchInfo.pageInfo=d.pageInfo;if(typeof c=="function"){c(d)}},"json")};this.initSearchInfo=function(){this.searchInfo={}};this.preventBodyScroll=function(){jQuery("body").addClass("scroll_fix")};this.searchResultSetHeight=function(){var b=jQuery(window).height()-jQuery("#searchNav").outerHeight(true);jQuery("#searchDetail").css("height",b+"px")};this.searchLayerInitScroll=function(){jQuery("#searchDetail").off("scroll.searchLayer");jQuery("#searchDetail").on("scroll.searchLayer",jQuery.proxy(this.detectSearchScroll,this))};this.detectSearchScroll=function(h){var c=jQuery(window).height();var b=jQuery("#searchResultWrap").height();var g=jQuery(h.currentTarget).scrollTop();var d=b-c-10;var f=(g-d)>=jQuery("#searchNav").outerHeight(true);if(f){if(a.searchInfo.pageInfo.lastPage){return}moreSearchList(a.searchInfo)}};this.detectScroll=function(c){var b=jQuery(c.currentTarget).scrollTop();var f=parseInt(b)>=(jQuery(document).height()-jQuery(window).height()-60);var d=a.lastPage!==1;if(d&&f){this.appendRenderAboveList()}if(b===0){jQuery("#main_content").empty();if(this.pageNo===0){return false}this.selectedMailId=null;this.pageNo=1;this.dataFetch(this.pageNo);jQuery("#mailHomeToolbarWrap").show();jQuery("#mailListToolbarWrap").hide()}};this.getSharedFolderList=function(){ActionLoader.getSyncGoLoadAction(this.viewShareFolderAction,{},function(b){jQuery("#webFolderDirectory option[data-type=share]").remove();_.each(b.webfolder,function(c){jQuery("#webFolderDirectory").append("<option data-type='share' data-sroot='"+c.sroot+"' data-full-path='"+c.fullName+"' data-userseq='"+c.mailUserSeq+"' >"+c.name+"</option>")})},"json")};this.fetchWebFolderList=function(c){var b=a.currentWebFolderInfo.pageInfo;if(!_.isUndefined(b)){if(b.lastPage){return}c=_.extend(c,{currentPage:b.page+1})}ActionLoader.getSyncGoLoadAction(this.viewFolderAction,c,function(d){a.currentWebFolderInfo.pageInfo=d.pageInfo;a.renderWebFolderList(d);a.renderWebFolderHeader(d)},"json")};this.renderWebFolderHeader=function(b){jQuery("div.webFolderHeader:visible").attr({"data-path":b.path,"data-userseq":b.userSeq,"data-sroot":b.sroot,"data-type":b.type})};this.renderWebFolderList=function(c){if(a.currentWebFolderInfo.pageInfo.firstPage){jQuery("#webfolder_list").empty()}else{c.folders=[]}if(c.total===0&&c.folders.length===0){var b='<li class="creat data_null"><span class="txt">'+mailMsg.webfolder_file_empty_title+"</span></li>";jQuery("#webfolder_list").append(b)}jQuery("#webfolder_list").append(getHandlebarsTemplate("webfolder_content_tmpl",c));jQuery("#webfolder_content").show()};this.detectWebFolderListScroll=function(g){var c=jQuery(g.currentTarget).height();var b=jQuery(".go_wrap").height();var f=jQuery(g.currentTarget).scrollTop();var d=b-c;if(f-d>-1){a.fetchWebFolderList(a.currentWebFolderInfo.param)}};this.resetCheckedWebFolder=function(b){jQuery("#mailWebFolderSelectToolbarWrap").hide();jQuery("#webfolder_list input[type=checkbox]").prop("checked",false);jQuery("#select-all").text(mailMsg.mail_select_all)};this.loadMessageList=function(c,b,d){progressAction({action:true});if(c){if(c.folder&&c.folder!=""){this.currentFolder=c.folder}if(c.sharedFlag&&c.sharedFlag=="shared"){this.sharedFlag=true}else{this.sharedFlag=false}}else{c={}}this.listParam=c;c.init=d;this.dataSet=c;ActionLoader.postSyncGoJsonLoadAction(this.listAction,c,a.printMessageList,"json");jQuery(window).off("scroll.renderNewPage");jQuery(window).on("scroll.renderNewPage",jQuery.proxy(this.detectScroll,this));google.sendPageView(this.listAction);if(!b){historyControl.setHistory({type:"list",param:c})}};this.printMessageList=function(c){a.selectedMailId=_.isNull(sessionStorage.getItem("SELECTED-DOC-ID"))?null:sessionStorage.getItem("SELECTED-DOC-ID");a.pageNo=_.isNull(sessionStorage.getItem("PAGE-NO"))?1:parseInt(sessionStorage.getItem("PAGE-NO"));sessionStorage.removeItem("SELECTED-DOC-ID");sessionStorage.removeItem("PAGE-NO");a.dataSet.folder=a.listParam.folder;a.dataSet.init=a.listParam.init;changeMailContainer("list");a.lastPage=c.total<=20?1:Math.ceil(c.total/20);a.listMode="mail";currentMenu="list";a.nextPage=1;currentFolderType=c.folderType;currentFolderName=c.folderFullName;currentFolderViewName=c.folderName;currentFolderEncName=c.folderEncName;isAllFolder=(currentFolderType=="all")?true:false;isBookmark=c.bookmark;listType=c.listType;bookmarkSeq=c.bookmarkSeq;bookmarkType=c.bookmarkType;bookmarkName=currentFolderViewName;bookmarkValue=currentFolderName;if(c.extFolder=="on"){bookmarkType=c.extType;bookmarkValue=bookmarkType}var b={};b.isList=true;b.search=c.search;b.name=c.folderName;b.bookmarkSeq=c.bookmarkSeq;b.bookmarkType=bookmarkType;b.bookmarkValue=bookmarkValue;b.isBookmark=isBookmark;b.isAllFolder=isAllFolder;b.flag=c.flag;b.extFolder=c.extFolder;b.extType=c.extType;b.folderType=c.folderType;if(listType=="tag"){bookmarkValue=c.tagId;var d=getTagInfo(bookmarkValue);b.type="tag";b.tagInfo=d}jQuery("#main_content").empty();if(a.pageNo>=2){a.dataSet.offset=a.offset*(parseInt(a.pageNo));a.pageNo=1;a.dataFetch(a.pageNo)}else{a.dataSet.offset=a.offset;a.makeMailListContent(c)}a.scrollToEl();progressAction({action:false});a.makeListToolbar(b);if(!isFirstLoad){executeFolderInfo()}isFirstLoad=false;changeStatusBarColor(false);if(a.isBiggerStyle()){jQuery("#main_content").removeClass("content_detail")}};this.scrollToEl=function(){if(a.selectedMailId==null){return false}var b=JSON.parse(this.selectedMailId);var c=jQuery("li").find('a[data-list-id="'+b.listId+'"]').closest("li");if(c.length==0){return}var d=c.offset().top-jQuery("#mailHomeToolbarWrap").outerHeight(true);jQuery("html").animate({scrollTop:d},10)};this.appendRenderAboveList=function(){if(a.dataSet.offset>a.offset){a.pageNo=a.dataSet.offset/a.offset;a.dataSet.offset=a.offset}if(a.lastPage===a.pageNo){return}a.pageNo=a.pageNo+1;a.dataFetch(a.pageNo)};this.dataFetch=function(b){a.dataSet.page=b;if(this.listMode==="mail"){ActionLoader.postSyncGoJsonLoadAction(this.listAction,this.dataSet,a.makeMailListContent,"json")}else{ActionLoader.postSyncGoLoadAction(this.mdnListAction,this.dataSet,a.makeMailMdnListContent,"json")}};this.makeListHeader=function(e){jQuery("#mail_header .mailHeaderWrap").hide();jQuery("#mail_list_header").show();jQuery("#search_back_btn").hide();jQuery("#toggle_folder_side_btn").show();jQuery("#mail_refresh_btn").show();if(e.bookmarkSeq>0){var d=e.type;var b=e.bookmarkType;if(d=="tag"){jQuery("#header_title_wrap").hide();jQuery("#header_tag_color").removeClass().addClass("ic_tag "+e.tagInfo.color);jQuery("#header_tag_name").text(e.tagInfo.name);jQuery("#header_tag_title_wrap").show()}else{jQuery("#header_tag_title_wrap").hide();var c=mailBookmarkName(b,e.name);jQuery("#header_title_wrap").text(c).show()}}else{if(e.type=="tag"){jQuery("#header_title_wrap").hide();jQuery("#header_tag_color").removeClass().addClass("ic_tag "+e.tagInfo.color);jQuery("#header_tag_name").text(e.tagInfo.name);jQuery("#header_tag_title_wrap").show()}else{jQuery("#header_tag_title_wrap").hide();var c="";if(e.isAllFolder){if(e.search){c=mailMsg.mail_search_result;jQuery("#mail_refresh_btn").hide();jQuery("#search_back_btn").show()}else{if(e.extFolder=="on"){c=mailBookmarkName(e.extType,"")}}}else{c=e.name}jQuery("#header_title_wrap").text(c).show()}}};this.makeMenuItemTemplate=function(c,d){var b=[];if(this.isSelectType(d)){b=this._makeSelectTemplate(c,b,d)}else{b=this._makeButtonTemplate(b,d)}return b.join("")};this.isSelectType=function(b){return b.selectId!=undefined};this._makeSelectTemplate=function(c,b,e){var d=c.find("#"+e.selectId);if(d.length>0){d.append('<li><a href="javascript:;" evt-act="'+e.role+'" evt-rol="toolbar"><span>'+e.text+"</span></a></li>")}else{b.push('<li><div class="btn_submenu">');b.push('<a href="javascript:;" class="btn_tool" data-role="button" evt-rol="toolbar" sub="on" menu="'+e.menu+'">');b.push("\n");if(e.title==undefined){b.push('<span class="txt">'+e.text+"</span>")}else{b.push('<span class="txt">'+e.title+"</span>")}b.push("\n");b.push('<span class="ic_cmm ic_dropdown_small"></span>');b.push("</a>");b.push('<div class="array_option" style="width:110px;display:none;">');b.push('<ul id="'+e.selectId+'" class="array_type">');b.push('<li><a href="javascript:;" evt-act="'+e.role+'" evt-rol="toolbar"><span>'+e.text+"</span>");b.push("</a></li>");b.push("</div></li>")}return b};this._makeButtonTemplate=function(b,d){var c="";var e=d.role==undefined?"toolbar":d.role;if(d.ignore=="on"){b.push('<li><a href="javascript:;" class="'+c+'" data-role="button" id="'+d.id+'" evt-rol="'+e+'" evt-act="'+d.action+'" ignore="on">')}else{b.push('<li><a href="javascript:;" class="'+c+'" data-role="button" id="'+d.id+'" evt-rol="'+e+'" evt-act="'+d.action+'">')}b.push('<span class="txt">'+d.text+"</span>");b.push("</a></li>");return b};this.makeMoreMenuItemTemplate=function(c){var b=[];var d=c.role==undefined?"toolbar":c.role;b.push("<li>");b.push('<a href="javascript:;" data-role="button" id="'+c.id+'" evt-rol="'+d+'" evt-act="'+c.action+'">');b.push('<span class="txt">'+c.text+"</span>");b.push("</a></li>");return b.join("")};this.menuBarAllowWidthPolicy=function(b,c){var d=34;return(c-b.outerWidth()+d>0)};this.makeListToolbar=function(f){jQuery("#mailHomeToolbarWrap").show();jQuery("#mailHomeToolbarWrap div.optional").show();jQuery("#mailWriteToolbarWrap").hide();jQuery("#mailReadToolbarWrap").hide();jQuery("#mailListToolbarWrap").hide();jQuery("#mailWriteBtn").show();var d=jQuery("#mailListToolbarWrap");var b=jQuery("#searchResultNav");d.find("li").not(".moreItemLi").remove();b.find("li").not(".moreItemLi").remove();var e=mailToolbarRuleMap.get(f.folderType);var c=[];c.push(toolBarMenus.전체선택);if(e.remove){c.push(toolBarMenus.삭제_list)}if(e.seen){c.push(toolBarMenus.읽음);c.push(toolBarMenus.안읽음)}if(e.move){c.push(toolBarMenus.이동)}c.push(toolBarMenus.태그);jQuery("#toolbar_wrap").show();this._renderListTitle(f);this._renderHeaderToolBar(d,c);c.splice(0,1,toolBarMenus.전체선택_search);this._renderHeaderToolBar(b,c)};this._renderListTitle=function(e){var b=mailMsg.mail_title;if(e.bookmarkSeq>0){var d=e.type;var c=e.bookmarkType;if(d=="tag"){b=e.tagInfo.name}else{b=mailBookmarkName(c,e.name)}}else{if(e.type=="tag"){b=e.tagInfo.name}else{if(e.isAllFolder){if(e.extFolder=="on"){b=mailBookmarkName(e.extType,"")}}else{b=e.name}}}jQuery("#top_menu_title").text(b)};this._renderHeaderToolBar=function(d,c){if(!c){return}var e=false;var b=this;c.forEach(function(g){var f=jQuery(b.makeMenuItemTemplate(d,g));if(g.inMoreBtn){d.find(".moreMenuItem").append(f,"\n");e=true}else{d.find(".moreItemLi").before(f,"\n")}if(e){d.find(".moreItemLi").show()}});if(e){d.find(".moreItemLi").show()}displayHomeIcon()};this._renderToolBar=function(d,c){var f=18;var e=false;var b=this;c.forEach(function(h){var g=jQuery(b.makeMenuItemTemplate(d,h));d.find(".critical").append(g,"\n");f+=g.outerWidth()>0?(g.outerWidth()+2):g.outerWidth();if(g.find(".array_option").length>0){f+=20}else{if(g.find(".ic_arrow3_t").length>0||g.find(".ic_arrow3_d").length>0){f+=10}}if(b.menuBarAllowWidthPolicy(d,f)){g.attr("data-more","Y");d.find("[data-id=more_list]").append(b.makeMoreMenuItemTemplate(h));e=true}});d.find("[data-more]").remove();if(e){d.find("#more_btn").show()}else{d.find("#more_btn").hide()}};this.makeMailListContent=function(b){jQuery("#main_content").append(getHandlebarsTemplate("mail_list_content_tmpl",b))};this.readMessage=function(c,b){this.readParam=clone(this.listParam);this.readParam.folder=c.folder;this.readParam.uid=c.uid;this.readParam.viewImg=true;this.readParam=this.getSharedFolderParam(this.readParam);progressAction({action:true});ActionLoader.postSyncGoJsonLoadAction(this.readAction,this.readParam,a.printReadMessage,"json");jQuery(window).off("scroll.renderNewPage");google.sendPageView(this.readAction);if(!b){historyControl.setHistory({type:"read",param:c})}};this.reloadReadMessage=function(){var b=a.readParam;a.readMessage(b,true)};this.printReadMessage=function(e){changeMailContainer("read");a.listMode="mail";currentMenu="read";isAllFolder=false;a.preNavi=e.preNavi;a.nextNavi=e.nextNavi;var b={isRead:true};moment.lang("kr");e.msgContent.date=moment(e.msgContent.dateUtc).format("YYYY/MM/DD dddd a HH:mm:ss");var d=("on"==getCookie("rcpt_show"));e.isRcptShow=d;progressAction({action:false});a.makeReadToolbar(e);a.makeMailReadContent(e).done(jQuery.proxy(function(){window.Iscroll=a.makeReadIscroll({isInitRendering:true})},a));jQuery.mobile.silentScroll(0);var h=e.msgContent;if(h.mdnCheck){if(confirm(mailMsg.mail_mdn_response_confirm)){var g={folderName:h.folderEncName,uid:h.uid};g=a.getSharedFolderParam(g);a.sendMdnResponse(g)}}executeFolderInfo();var f=a.readParam;if(f){f.page=e.page;a.readParam=f}var c=a.listParam;if(c){c.page=e.page;a.listParam=c}};this.makeReadToolbar=function(e){jQuery("#mailHomeToolbarWrap").hide();jQuery("#mailWriteToolbarWrap").hide();jQuery("#mailListToolbarWrap").hide();jQuery("#mailWriteBtn").show();var c=jQuery("#mailReadToolbarWrap");c.show();c.find("li").not(".moreItemLi").remove();c.find("div.optional").show();var d=mailToolbarRuleMap.get(e.folderType);var b=[];if(d.reply){b.push(toolBarMenus.답장)}if(d.forward){b.push(toolBarMenus.전달);jQuery("#mail_bottom_toolbar_read_forward").show()}else{jQuery("#mail_bottom_toolbar_read_forward").hide()}if(d.remove){b.push(toolBarMenus.삭제_read);jQuery("#mail_bottom_toolbar_read_delete").show()}else{jQuery("#mail_bottom_toolbar_read_delete").hide()}if(d.reply){b.push(toolBarMenus.전체답장_read);jQuery("#mail_bottom_toolbar_read_reply").show();jQuery("#mail_bottom_toolbar_read_replyall").show()}else{jQuery("#mail_bottom_toolbar_read_reply").hide();jQuery("#mail_bottom_toolbar_read_replyall").hide()}b.push(toolBarMenus.스팸이동);if(d.move){b.push(toolBarMenus.이동_read);jQuery("#mail_bottom_toolbar_read_move").show()}else{jQuery("#mail_bottom_toolbar_read_move").hide()}b.push(toolBarMenus.태그_read);b.push(toolBarMenus.안읽음_read);if(e.preNavi){b.push(toolBarMenus.이전)}if(e.nextNavi){b.push(toolBarMenus.다음)}jQuery("#toolbar_wrap").show();this._renderHeaderToolBar(c,b)};this.makeMailReadContent=function(f){var n=jQuery.Deferred();var b=jQuery(window).width()-30;f.msgContent.htmlContent=a.convertIcalTemplate(f.msgContent.icalList)+f.msgContent.htmlContent;jQuery("#main_content").handlebars("mail_read_content_tmpl",f);jQuery("#fontResizeLayer li input[value="+this.getFontSize()+"]").prop("checked",true);var c=f.tagIdList;var k=jQuery("#readTagWrap");if(c&&c.length>0){var l=folderControl.getTagData();for(var g=0;g<c.length;g++){for(var e=0;e<l.length;e++){if(c[g]==l[e].id){k.append(getHandlebarsTemplate("mail_read_tag_tmpl",l[e]));break}}}}jQuery("#message_view_table a[href],area[href]").each(function(){if(!MOBILE_WEB){jQuery(this).attr("evt-rol","ext-url")}});var d=jQuery("#message_view_table").find("img:not([src*=mdnData])");var m=d.length;if(!m){n.resolve()}var h=0;d.load(function(){h++;if(m==h){n.resolve()}});return n};this.makeReadIscroll=function(j){var f=j.isInitRendering;var i=this;var b=jQuery(window).height();var c=jQuery("#mailContentWrapper").outerWidth(true);var d=jQuery(window).width();if(d>c){c=d}if(f){this.contentsParsingForFontSizeResizing();resizeFontSize(this.getFontSize())}jQuery("#message_view_table").css("width",c+"px");var g=jQuery("#mailReadToolbarWrap").outerHeight(true);var e=jQuery("header.article_header").outerHeight(true);jQuery("#article_view").height(b-e-g);if(this.isBiggerStyle()){jQuery("#main_content").addClass("content_detail")}if(this.Iscroll){this.Iscroll.destroy()}var h=1/(c/d);i.Iscroll=new IScroll("#article_view",{bounce:false,zoom:true,zoomMin:h,disablePointer:true,disableTouch:false,disableMouse:false,preventDefault:false});i.Iscroll.on("zoomStart",function(k){jQuery("#article_view").css("overflow-x","").css("overflow-y","")});i.Iscroll.on("zoomEnd",function(k){jQuery("#article_view").css("overflow-x","scroll").css("overflow-y","hidden")});setTimeout(function(){if(c>d){i.Iscroll.zoom(0,0,h);i.Iscroll.scrollTo(0,0)}i.Iscroll.refresh()},400);return i.Iscroll};this.getFontSize=function(){var b=getLocalStorage("lastFontSize_"+USERSESSION.id);return b?b:40};this.isBiggerStyle=function(){if(document.getElementById("systemBigStyle").disabled==true||document.getElementById("systemBiggerStyle").disabled==true){return true}return false};this.contentsParsingForFontSizeResizing=function(){jQuery("#fontResizeWrap").show();jQuery("#mailContentWrapper").wrapInner("<div></div>").find("*").contents().filter(function(){return this.nodeType==3&&jQuery.trim(this.nodeValue)}).each(function(b,f){var c=getComputedStyle(this.parentNode);var e=c.fontSize.replace("px","");var d=c.lineHeight.replace("px","");jQuery(this).wrap('<span data-font-resize data-origin-fontsize="'+e+'" data-origin-lineheight="'+d+'" style="font-size:'+e+"px;line-height:"+d+'px" />')})};this.makeReadSwipeEvent=function(){var b=jQuery("#leftHandle");var c=jQuery("#rightHandle");jQuery("#mailViewContentWrap").swipe({swipeLeft:function(e,g,h,f,d){if(a.nextUid>0){readMessage(a.nextNavi.folderName,a.nextNavi.uid)}else{alert(mailMsg.mail_last_message);return}},swipeRight:function(e,g,h,f,d){if(a.preNavi){readMessage(a.preNavi.folderName,a.preNavi.uid)}else{alert(mailMsg.mail_first_message);return}},swipeStatus:function(f,d,h,i,g,e){if(d=="start"){b.css("right","-50px").hide();c.css("left","-50px").hide()}else{if(d=="move"){if(h=="left"){c.css("left","-50px").hide();b.show();if(i<=50){b.css("right",(-50+i)+"px")}}else{if(h=="right"){b.css("right","-50px").hide();c.show();if(i<=50){c.css("left",(-50+i)+"px")}}}}else{if(d=="end"){b.css("right","-50px").hide();c.css("left","-50px").hide()}}}},threshold:100})};this.convertIcalTemplate=function(d){if(!d||d.length==0){return""}for(var c=0;c<d.length;c++){var e=d[c].icalRecurrence;d[c].icalRecurrenceMsg="";if(e!=""&&e!=null){d[c].icalRecurrenceMsg=recurrenceParser(d[c].icalRecurrence);d[c].icalStartDate=""}var b=jQuery.trim(d[c].icalSubject);if(b==""||b==null){d[c].icalSubject=mailMsg.header_nosubject}}return getHandlebarsTemplate("mail_icalendar_tmpl",d)};this.writeMessage=function(c,b){if(!c.init){progressAction({action:true})}c.init=null;this.writeParam=c;ActionLoader.postGoJsonLoadAction(this.writeAction,c,a.printWriteMessage,"json");jQuery(window).off("scroll.renderNewPage");google.sendPageView(this.writeAction);if(!b){historyControl.setHistory({type:"empty",param:c})}};this.printWriteMessage=function(c){LOCAL_DOMAIN=c.localDomain?c.localDomain:"";changeMailContainer("write");a.listMode="mail";currentMenu="write";notiMode=c.notiMode;sendConfirm=c.sendConfirm;var b={isWrite:true};c.isMobileWeb=MOBILE_WEB;a.makeMailWriteContent(c);progressAction({action:false});a.makeMailWriteHeader(b);a.makeMailWriteToolbar(c);a.writeData=c;a.convertSendData(c);mailWriteInit(c);isMaxSendMailCountUse=c.sendMailCount.maxSendMailCountUse;maxSendMailCount=c.sendMailCount.maxSendMailCount};this.convertSendData=function(b){this.sendData={};this.sendData.senderEmail=b.senderEmail;this.sendData.senderName=b.senderName;this.sendData.sendType=b.writeType;this.sendData.sendFlag=b.sendFlag;this.sendData.charset=b.encoding;this.sendData.folderName=b.folderName;this.sendData.uids=b.uids;this.sendData.orgMessageId=b.orgMsgId;this.sendData.draftMessageId=b.draftMsgId};this.makeMailWriteHeader=function(b){jQuery("#mail_header .mailHeaderWrap").hide();jQuery("#mail_write_header").show()};this.makeMailWriteToolbar=function(b){jQuery("#mailHomeToolbarWrap").hide();jQuery("#mailListToolbarWrap").hide();jQuery("#mailReadToolbarWrap").hide();jQuery("#mailWriteToolbarWrap").show();jQuery("#mailWriteBtn").hide();if(!USE_CONTACT){jQuery("#contactButton").hide()}jQuery("#toolbar_wrap").show()};this.makeMailWriteContent=function(b){jQuery("#main_content").handlebars("mail_write_content_tmpl",jQuery.extend({},b,{isAndroidApp:isAndroidApp(),isWebFolderUsable:USE_WEBFOLDER}))};this.getSignList=function(b){ActionLoader.getGoLoadAction(this.signListAction,null,function(c){if(c&&c.length>0){var d=jQuery("#signListWrap").data("attach");c.useAttach=d;jQuery("#signListWrap").html(getHandlebarsTemplate("mail_layer_sign_tmpl",c));jQuery("#signWrap").show()}},"json")};this.loadMdnList=function(c,b){c=(!c)?{}:c;this.listParam=c;this.dataSet={};progressAction({action:true});ActionLoader.postGoLoadAction(this.mdnListAction,c,a.printMdnList,"json");jQuery(window).off("scroll.renderNewPage");jQuery(window).on("scroll.renderNewPage",jQuery.proxy(this.detectScroll,this));google.sendPageView(this.mdnListAction);if(!b){historyControl.setHistory({type:"mdnlist",param:c})}};this.printMdnList=function(e){a.selectedMailId=_.isNull(sessionStorage.getItem("SELECTED-DOC-ID"))?null:sessionStorage.getItem("SELECTED-DOC-ID");a.pageNo=_.isNull(sessionStorage.getItem("PAGE-NO"))?1:parseInt(sessionStorage.getItem("PAGE-NO"));sessionStorage.removeItem("SELECTED-DOC-ID");sessionStorage.removeItem("PAGE-NO");a.nextPage=1;a.lastPage=e.pageInfo.pages.length;a.listMode="mdnlist";currentMenu="list";changeMailContainer("list");var b={isMdnList:true};jQuery("#main_content").empty();if(a.pageNo>=2){var d=a.pageNo;for(var c=1;c<=d;c++){a.pageNo=c;a.dataFetch(c)}}else{a.makeMailMdnListContent(e)}a.scrollToEl();a.makeMailMdnListToolbar(e);changeStatusBarColor(false);progressAction({action:false})};this.makeMailMdnListToolbar=function(b){jQuery("#mailHomeToolbarWrap").show();jQuery("#mailHomeToolbarWrap div.optional").hide();jQuery("#mailWriteToolbarWrap").hide();jQuery("#mailReadToolbarWrap").hide();jQuery("#toolbar_wrap").show();jQuery("#top_menu_title").text(mailMsg.menu_receivenoti)};this.makeMailMdnListContent=function(b){jQuery("#main_content").append(getHandlebarsTemplate("mail_mdn_list_content_tmpl",b))};this.loadMdnRead=function(c,b){this.readParam=c;progressAction({action:true});ActionLoader.postGoLoadAction(this.mdnReadAction,c,a.printMdnRead,"json");jQuery(window).off("scroll.renderNewPage");google.sendPageView(this.mdnReadAction);if(!b){historyControl.setHistory({type:"mdnread",param:c})}};this.printMdnRead=function(c){a.nextPage=1;a.listMode="mdnread";currentMenu="list";changeMailContainer("list");var b={isMdnRead:true};c.subject=a.readParam.subject;c.dateUtc=a.readParam.dateUtc;a.makeMailMdnReadToolbar(c);a.makeMailMdnReadContent(c);progressAction({action:false})};this.makeMailMdnReadToolbar=function(d){jQuery("#mailHomeToolbarWrap").hide();jQuery("#mailWriteToolbarWrap").hide();jQuery("#mailListToolbarWrap").hide();jQuery("#mailWriteBtn").show();var c=jQuery("#mailReadToolbarWrap");c.show();c.find("li").not(".moreItemLi").remove();c.find("div.optional").hide();var b=[];this._renderHeaderToolBar(c,b)};this.makeMailMdnReadContent=function(b){jQuery("#main_content").handlebars("mail_mdn_read_tmpl",b)};this.deleteMdn=function(b){ActionLoader.postGoLoadAction(this.deleteMdnAction,b,function(c){a.reloadMessageList()},"json")};this.recallMessage=function(b){ActionLoader.postGoLoadAction(this.recallMessageAction,b,function(c){a.reloadMessageList()},"json")};this.sendMdnResponse=function(b){ActionLoader.postGoJsonLoadAction(this.sendMdnResponseAction,b,function(c){alert(mailMsg.mail_send_success)},"json")};this.searchMessage=function(b){this.loadMessageList(b)};this.copyMessage=function(b){b=this.getSharedFolderParam(b);ActionLoader.postGoJsonLoadAction(this.copyMessageAction,b,function(c){a.reloadMessageList()},"json",function(c){alert(c.message)})};this.moveMessage=function(b){b=this.getSharedFolderParam(b);ActionLoader.postGoJsonLoadAction(this.moveMessageAction,b,function(c){a.reloadMessageList()},"json",function(c){alert(c.message)})};this.taggingMessage=function(b){ActionLoader.postGoJsonLoadAction(this.taggingMessageAction,b,function(c){if(currentMenu=="read"){a.reloadReadMessage()}else{a.reloadMessageList()}},"json")};this.writeDeptAddrInfo=function(b){ActionLoader.getLoadAction(this.deptSelectAction,{},function(c){jQuery("#writeDeptAddrSelect").handlebars("addr_dept_select_tmpl",c);jQuery("#writeDeptAddrLink span.txt").text(jQuery("#writeDeptAddrSelect option:first").text());if(b){b()}},"json")};this.writeAddrSelect=function(f){var c=sessionStorage.getItem("GO-Agent-mail");jQuery("#mailWriteToolbarWrap").hide();if(jQuery(".list_employee_new").length===0){a.selectedNodes=[]}jQuery("#companyText").nextAll().andSelf().remove();jQuery("#companySelect").nextAll().andSelf().remove();jQuery("#addr_dept_list").empty();jQuery("#addr_member_list").empty();f=(!f)?{}:f;this.addrParam=f;var b=this.writeAddrSelectAction;var e=f.name;var d=this.makeWriteAddrListContent;if(f.ownerType=="company"&&!f.isReadable){d=this.makeNotReadableListContent}if(f.ownerType=="department"){f.deptId=(!f.deptId)?jQuery("select.dept_addr_select").val():f.deptId;this.addrParam.deptId=f.deptId}if(f.ownerType=="emp"){if(c==="BROWSER"){e=f.keyword}else{jQuery("#mailWriteToolbarWrap").show();setCookie("ContactViewTypeMobile","user",365);if(isIphoneApp()){window.location="gomobile://callOrgDept?&addReceiverSuccess&addReceiverFail"}else{if(isAndroidApp()){window.GOMobile.callOrgDept("addReceiverSuccess","addReceiverFail")}}}}else{if(f.keyword){b=this.writeAddrSearchAction}else{f={page:f.page||0,offset:20,property:"nameInitialConsonant",direction:"asc",keyword:"",type:(f.ownerType).toUpperCase()||"",groupId:f.groupId||"",deptId:f.deptId||jQuery("select.dept_addr_select").val()}}}currentMenu="addr";changeMailContainer("addr");makeTopMenuTitle(mailMsg.addr_list_write_select);a.addrNextPage=1;if(f.ownerType=="emp"){jQuery("#users_list_title").text(mailMsg.common_org_dept_staff);jQuery("#dept_list_title").show();if(c==="BROWSER"){if(jQuery.trim(e)!=""||!_.isUndefined(e)){a.fetchOrgMemberBySearch(e)}else{jQuery(".list_employee_new").remove();a.fetchOrgMember("",function(g){a.setHeaderCrumbList(g);a.setOrgMemberByCompany(g)})}}}else{jQuery("#users_list_title").text(mailMsg.addr_user);jQuery("#dept_list_title").hide();jQuery(".list_employee_new").remove();ActionLoader.getLoadAction(b,f,function(g){if(e&&jQuery.trim(e)!=""){g.search=true}if(!g.search){d(g)}},"json")}jQuery(window).off("scroll.renderNewPage");google.sendPageView(b);if(f.isInit){historyControl.setHistory({type:"addr",param:f})}};this.makeNotReadableListContent=function(b){jQuery("#addr_member_list").handlebars("addr_no_readable_mail_tmpl")};this.makeWriteAddrListContent=function(e){var c=e.page;var d=c.page+1;var f={};f.firstPage=(d==1);f.prePage=(d-1);f.page=d;f.pageSize=c.offset;f.total=c.total;f.lastPage=c.lastPage;f.nextPage=d+1;var b={};b.data=e.data;b.pageInfo=f;jQuery("#addr_member_list").handlebars("addr_write_mail_tmpl",b)};this.setHeaderCrumbList=function(b){var e=[];var d=a.getCompanyList(b);_.each(d,function(f){e.push(f.data.title)});if(jQuery("select[name=companySelect]").text()===e.join("")){return}if(d.length>=2){a.isMultiSite=true;var c='<select id="companySelect" name="companySelect"></select>';jQuery("#userCheckedScroll").append(c);_.each(d,function(f){if(jQuery("select[name=companySelect]").text().indexOf(f.data.title)===-1){jQuery("#companySelect").append('<option value="'+f.data.id+'">'+f.data.title+"</option>")}})}else{var c='<a id="companyText">'+mailMsg.mail_search_all+"</a>";jQuery("#userCheckedScroll").append(c)}};this.getCompanyList=function(b){var c=[];_.each(b,function(d){if(d.data.id.indexOf("company")!==-1){c.push(d)}});return c};this.getFetchOrgUrl=function(d){var c="/api/organization/multi/list";var b;if(!_.isEmpty(d)){b=c+"?deptid="+d+"&type=child"}else{b=c+"?type=mydept"}return b};this.fetchOrgMember=function(c,b){jQuery.ajax({method:"GET",reset:true,url:a.getFetchOrgUrl(c),success:function(d){a.depts=[];a.users=[];b(d);a.drawOrgMember()}})};this.setOrgMemberByCompany=function(c){var d=jQuery("#companyText").length>=1;var b=jQuery("#companySelect").length!==0&&jQuery("#companySelect").children.length>=2;if(d){a.setOrgMemberByPosition(c[0].children)}else{if(b){var e=jQuery("select[name=companySelect]").val();_.any(c,function(f){if(f.data.id===e){a.setOrgMemberByPosition(f.children);return true}})}else{a.setOrgMemberByPosition(c)}}},this.setOrgMemberByPosition=function(b){_.each(b,function(d){if(d.data.id.includes("org")){var c=(d.metadata.childrenCount>0||d.metadata.memberCount>0);a.depts.push({title:d.data.title,id:d.metadata.id,email:d.metadata.email,originalEmail:d.metadata.email,name:d.metadata.name,type:d.data.id.split("_")[0],includedSubDept:false,code:d.metadata.code,useReception:d.metadata.useReception,useReference:d.metadata.useReference,hasDeptChildren:c})}else{if(_.contains(["MASTER","MODERATOR","MEMBER"],d.data.id.split("_")[0])){a.users.push({nodeId:d.attr.nodeId,id:d.metadata.id,companyName:d.metadata.companyName,email:d.metadata.email,originalEmail:d.metadata.email,name:d.metadata.name,type:d.data.id.split("_")[0],duty:d.metadata.duty,deptId:d.metadata.deptId,departments:d.metadata.deptName,position:d.metadata.position,displayName:d.metadata.name+d.metadata.position,thumbnail:d.metadata.thumbnail,employeeNumber:d.metadata.employeeNumber,loginId:d.metadata.loginId})}}})};this.fetchOrgMemberBySearch=function(b){jQuery.ajax({method:"GET",reset:true,async:false,url:"/api/org/user/sort/list?nodeType=org&page=0&keyword="+encodeURIComponent(b),success:function(c){a.depts=[];a.users=[];a.setOrgMemberBySearch(c.data);a.drawOrgMember()}})};this.setOrgMemberBySearch=function(b){if(b.length<1){return}var c=[];_.each(b,function(d){if(c.indexOf(d.id)===-1){c.push(d.id);if(d.nodeType=="user"){a.users.push({nodeId:d.employeeNumber,id:d.id,companyName:d.companyName,email:d.email,originalEmail:d.originalEmail,name:d.name,type:"user",duty:d.duties[0],deptId:d.departmentIds[0],departments:d.departments,position:d.position,displayName:d.name+d.position,thumbnail:d.thumbnail,employeeNumber:d.employeeNumber,loginId:d.loginId,isMultiCompany:a.isMultiSite})}else{if(d.nodeType=="department"){a.depts.push({title:d.name,id:d.id,email:d.email,originalEmail:d.email,name:d.name,type:"org",includedSubDept:false,userReception:d.useReception,useReference:d.useReference,isMultiCompany:a.isMultiSite,companyName:d.companyName})}}}})};this.removeOrgList=function(){jQuery("#companySelect").nextAll().remove();jQuery("#addr_dept_list").empty();jQuery("#addr_member_list").empty()};this.drawOrgMember=function(c){var b={};var d={};b.mailExposure=MAIL_EXPOSURE;d.mailExposure=MAIL_EXPOSURE;d.data=a.depts;b.data=a.users;jQuery("#addr_dept_list").handlebars("mail_org_dept_tmpl",d);jQuery("#addr_member_list").handlebars("mail_org_member_tmpl",b);jQuery("select[name=companySelect]").off();jQuery("select[name=companySelect]").on("change",function(f){a.removeOrgList();a.fetchOrgMember("",a.setOrgMemberByCompany)});jQuery("select[name=companySelect]").on("vclick",function(f){a.removeOrgList();a.fetchOrgMember("",a.setOrgMemberByCompany)});jQuery("#companyText").off();jQuery("#companyText").on("vclick",function(f){jQuery("#companyText").nextAll().remove();a.fetchOrgMember("",a.setOrgMemberByCompany)});jQuery(".dept_info").off();jQuery(".dept_info").on("vclick",function(h){var f=jQuery(h.currentTarget);f.prop("disabled",true);if(f.find(".ic.ic_arrow4").length===0){return}var g=f.attr("data-id").split("_")[1];var i=f.text();jQuery("#userCheckedScroll").append('<a id="sub_dept" class="orgDepthspan" data-id="'+g+'">'+i+"</a>");a.fetchOrgMember(g,a.setOrgMemberByPosition)});jQuery(".orgDepthspan").off();jQuery(".orgDepthspan").on("vclick",function(h){var g=jQuery(h.currentTarget);g.nextAll().remove();var f=g.attr("data-id");a.fetchOrgMember(f,a.setOrgMemberByPosition)});jQuery(".btn.btn_plus").off();jQuery(".btn.btn_plus").on("vclick",function(q){q.preventDefault();var u=jQuery.extend({},a.depts);var h=jQuery.extend({},a.users);var l=jQuery(q.currentTarget).attr("value");var o=l.split("_")[0];var i=l.split("_")[1];var t=_.find(u,function(e){return e.type===o&&e.id==i});var n=_.find(h,function(e){return e.type==o&&e.id==i});if(_.isUndefined(t)&&_.isUndefined(n)){alert(mailMsg.error_noselect);return}var k=_.isUndefined(t)?n:t;k.dataId=l;if(o=="org"){k.includedSubDept=confirm(mailMsg.mail_subdept_include)}var m=_.some(a.selectedNodes,function(e){return e.dataId===l});if(m){alert(mailMsg.alert_same);return}a.selectedNodes.push(k);if(jQuery("div.list_employee_new").length<1){var j='<div class="list_employee_new"><ul class="name_tag" id="activeBar"></ul></div>';jQuery("div.docu_search").before(j)}if(k.includedSubDept){var r=[];var s="/api/organization/dept/tree?deptid="+i+"&scope=subdept";jQuery.ajax({method:"GET",reset:true,async:false,url:s,success:function(e){r=e;a.setOrgMemberByPosition(e);_.each(e,function(B){var y=B.attr.id;var z=_.any(a.selectedNodes,function(E){return E.dataId===y});if(!z){var C=mailMsg.mail_search_name_department;var v=B.attr.title;var w='<a value="'+y+'" class="nameTagItem"><li><div class="depart"><span class="txt">'+C+'</span></div><span class="name">'+v+'</span><span class="btn_wrap" id="btn_del" value="'+y+'"><span class="btn btn_del_type2"></span></span></li></a>';jQuery("#activeBar").append(w);if(k.dataId!==y){var A=y.split("_")[0];var x=y.split("_")[1];var D=_.find(a.depts,function(E){return E.type===A&&E.id==x});D.dataId=y;a.selectedNodes.push(D)}}})}})}var g=null;if(o!="org"){g='<a value="'+k.dataId+'" class="nameTagItem"><li><div class="photo"><img src="'+k.thumbnail+'"></div><span class="name">'+k.name+'</span><span class="btn_wrap" id="btn_del"  value="'+k.dataId+'"><span class="btn btn_del_type2"></span></span></li></a>'}else{var l=k.dataId;var p=mailMsg.mail_search_name_department;var f=k.name;g='<a value="'+l+'" class="nameTagItem"><li><div class="depart"><span class="txt">'+p+'</span></div><span class="name">'+f+'</span><span class="btn_wrap" id="btn_del"  value="'+l+'"><span class="btn btn_del_type2"></span></span></li></a>'}jQuery("#activeBar").append(g);jQuery(".nameTagItem").on("vclick",function(x){x.preventDefault();var w=jQuery(x.currentTarget).attr("value");var v=0;_.any(a.selectedNodes,function(e){if(e.dataId===w){return true}v++});if(a.selectedNodes.length!==v){a.selectedNodes.splice(v,1)}if(_.isEmpty(a.selectedNodes)){jQuery("div.list_employee_new").remove()}jQuery(".name_tag").find("a[value="+w+"]").remove()})})};this.moveAddrPage=function(b){b-=1;this.addrParam.page=b;a.writeAddrSelect(this.addrParam)};this.reloadWriteAddrSelect=function(){a.writeAddrSelect(this.addrParam)};this.makeDeptSelectOptions=function(b){jQuery(".addr_select").val("user");jQuery(".dept_addr_select").hide();addrAction=this.deptSelectAction;addrResultFunc=this.makeDeptSelectOptions;var c=jQuery("#addr_content select.dept_addr_select");ActionLoader.getLoadAction(addrAction,{},function(d){jQuery("#addr_content select.dept_addr_select").handlebars("addr_dept_select_tmpl",d);c.closest("a").find("span.txt").text(c.find("option:first").text())},"json")};this.deleteMessages=function(b){ActionLoader.postGoJsonLoadAction(this.deleteMessageAction,b,function(c){a.reloadMessageList(true)},"json")};this.switchMessagesFlags=function(d,b,g,c,e){var f={};f=this.getSharedFolderParam(f);f.folderNames=b;f.uids=d;f.flagType=g;f.used=c;ActionLoader.postGoJsonLoadAction(this.switchFlagAction,f,function(h){if(e){changeFlagReadView(c,g)}else{if(g=="F"){changeFlagView(c,g,h)}else{a.reloadMessageListWithUseHistory()}}},"json")};this.movePage=function(b){var c=this.listParam;if(this.listMode=="mdnread"){c=this.readParam}if(c==null){c={}}c.page=b;this.listParam=c;if(this.listMode=="mail"){this.loadMessageList(c)}else{if(this.listMode=="mdnlist"){this.loadMdnList(c)}else{if(this.listMode=="mdnread"){this.loadMdnRead(c)}}}};this.reloadMessageListWithUseHistory=function(){this.reloadMessageList(true)};this.reloadMessageList=function(b){ignoreHistory=(!b)?true:false;if(this.listMode=="mail"){this.loadMessageList(this.listParam,ignoreHistory)}else{if(this.listMode=="mdnlist"){this.loadMdnList(this.listParam,ignoreHistory)}else{if(this.listMode=="mdnread"){this.loadMdnRead(this.readParam,ignoreHistory)}}}};this.reloadWriteMessage=function(){this.writeMessage(this.writeParam)};this.sendMessage=function(b){progressAction({action:true});ActionLoader.postGoJsonLoadAction(this.sendAction,b,function(d){if(b.sendType=="draft"){if(!d.isError){alert(mailMsg.mail_drafts_success);progressAction({action:false});var c=mailControl.getSendData();c.draftMessageId=d.messageId}}else{a.sendMessageResult(d);progressAction({action:false})}if(!d.isError&&(isAndroidApp()||isIphoneApp())){mailSendComplete();if(isAndroidApp()){progressAction({action:false})}}},"json");if(b.sendType!="draft"){jQuery(window).off("scroll.renderNewPage");google.sendPageView(this.sendAction)}};this.sendMessageResult=function(c){currentMenu="send";changeMailContainer("send");var b={isSend:true};a.makeMailSendHeader(b);a.makeMailSendToolbar(c);a.makeMailSendContent(c);executeFolderInfo()};this.makeMailSendHeader=function(b){jQuery("#mail_header .mailHeaderWrap").hide();jQuery("#mail_send_header").show()};this.makeMailSendToolbar=function(b){jQuery("#toolbar_wrap").hide()};this.makeMailSendContent=function(b){jQuery("#main_content").handlebars("mail_send_content_tmpl",b)};this.makeSubToolbar=function(f,g){var b=f.closest("li");var d=b.find("div.array_option");if(d.css("display")=="none"){var c=jQuery("#toolbar_wrap");if(isSearchResult()){c=jQuery("#searchResultNav")}c.find("div.array_option").hide();d.show();var e;f.bind("mouseover",function(){if(e){clearTimeout(e)}});f.bind("mouseout",function(){e=setTimeout(function(){d.hide()},500)});b.bind("mouseout",function(){e=setTimeout(function(){d.hide()},500)});b.bind("mouseover",function(){if(e){clearTimeout(e)}});if(g=="move"){d.bind("mouseover",function(){if(e){clearTimeout(e)}})}}else{f.unbind();d.hide()}};this.getCurrentFolder=function(){return this.currentFolder};this.getSendData=function(){return this.sendData};this.setSendData=function(b){this.sendData=b};this.getListMode=function(){return this.listMode};this.getAddrParam=function(){return this.addrParam};this.getSharedFolderParam=function(b){if(this.sharedFlag){b.sharedFlag="shared";b.sharedUserSeq=this.listParam.sharedUserSeq;b.sharedFolderName=this.listParam.sharedFolderName}else{b.sharedFlag="user";b.sharedUserSeq="0";b.sharedFolderName=""}return b};this.makeMailEvent=function(){var b=this;jQuery(document).on("click",function(f){var d=jQuery(f.currentTarget).find("#more_layout");closeMoreLayout(d)});jQuery("header").on("vclick","#mailWriteBtn",function(d){hideMailFolderSide();goWrite()});jQuery("header #search_wrap").on("vclick","a",function(e){var d=jQuery(this).attr("evt-rol");if(!d){return}if(e.stopPropagation){e.stopPropagation()}else{e.cancelBubble=true}e.preventDefault();closeMoreLayout();if(d=="search-message"){searchGoMessage()}else{if(d=="search-cancel"){if(currentMenu=="addr"){searchAddrCancel()}else{searchMessageCancel()}}}});jQuery("#mailHomeToolbarWrap").on("vclick","a",function(e){var d=jQuery(this).attr("evt-rol");if(!d){return}if(e.stopPropagation){e.stopPropagation()}else{e.cancelBubble=true}e.preventDefault();closeMoreLayout();if(d=="toggle-folder-side"){toggleMailFolderSide()}else{if(d=="write-mail"){goWrite()}else{if(d=="toggle-search-message"){toggleSearchMessageWrap()}else{if(d=="goto-gohome"){escapewriteAndGoHome()}else{if(d=="mail-refresh"){a.reloadMessageList()}else{if(d=="move-folder-cancel"||d=="tag-message-cancel"){gotoHistoryBack();if(currentMenu=="list"){changeMailContainer("list")}else{changeMailContainer("read")}}else{if(d=="download-attach-confirm-close"){jQuery("#attachOverlay").hide();jQuery("#downloadAttachConfirmLayer").hide()}else{if(d=="send-check-cancel"){checkSendMessageCancel();jQuery("#attachOverlay").hide()}}}}}}}}});jQuery("#mailWriteToolbarWrap").on("click","a,span,p",function(e){var d=jQuery(this).attr("evt-act");if(!d){return}if(e.stopPropagation){e.stopPropagation()}else{e.cancelBubble=true}e.preventDefault();if(d=="write-cancel"){document.activeElement.blur();if(MOBILE_WEB){history.back()}else{if(historyControl.historyIdx==1){if(isAndroidApp()){window.GOMobile.goHome()}else{window.location.href="gomobile://goHome"}}else{if(isAndroidApp()){window.GOMobile.pressBackKey()}else{history.back()}}}}else{if(d=="write-add-address"){writeAddrSelect()}else{if(d=="send-mail"){setTimeout(function(){sendMessage()},100)}}}});jQuery("#mailReadToolbarWrap,#mailListToolbarWrap, #mailWebFolderSelectToolbarWrap, #mailWebSubFolderToolbarWrap").on("click","a,span,p",function(d){var l=jQuery(this).attr("evt-rol");if(!l){return}if(d.stopPropagation){d.stopPropagation()}else{d.cancelBubble=true}d.preventDefault();if(l=="toolbar"){if(currentMenu=="list"){var k=("on"==jQuery(this).attr("ignore"));if(!k&&getMailListCheckedCount()==0){alert(mailMsg.mail_message_notselect);return}}var i=("on"==jQuery(this).attr("sub"));var e=jQuery(this).attr("menu");if(i){a.makeSubToolbar(jQuery(this),e)}else{var j=jQuery(this).attr("evt-act");if(j=="mail-select-all"){var m=jQuery(this).data("checked");if(m){jQuery("input[name=msgId]").each(function(){jQuery(this).prop("checked",false);checkMailListCheckbox(jQuery(this))});jQuery(this).data("checked",false);jQuery(this).find("span.txt").text(mailMsg.mail_select_all)}else{jQuery("input[name=msgId]").each(function(){jQuery(this).prop("checked",true);checkMailListCheckbox(jQuery(this))});jQuery(this).data("checked",true);jQuery(this).find("span.txt").text(mailMsg.mail_select_all_cancel)}}else{if(j=="mail-delete"){if(a.listMode=="mdnlist"){deleteMdn();jQuery("#mailHomeToolbarWrap").show();jQuery("#mailListToolbarWrap").hide();changeStatusBarColor(false)}else{deleteMessage()}}else{if(j=="mail-forward"){forwardMessage("parsed")}else{if(j=="mail-reply"){replyWrite("reply")}else{if(j=="mail-reply-all"){replyWrite("replyall")}else{if(j=="write-add-address"){writeAddrSelect()}else{if(j=="move-message-page"){moveMessagePage();closeMoreToolbarLayer()}else{if(j=="tag-message-page"){tagMessagePage();closeMoreToolbarLayer()}else{if(j=="read-pre-message"){readMessage(a.preNavi.folderName,a.preNavi.uid)}else{if(j=="read-next-message"){readMessage(a.nextNavi.folderName,a.nextNavi.uid)}else{if(j=="toggle-more-layout"){a.makeSubToolbar(jQuery(this),e)}else{if(j=="change-flag-seen"){changeSeenFlag(true)}else{if(j=="change-flag-unseen"){changeSeenFlag(false)}else{if(j=="mail_spam_move"){alert(mailMsg.mail_spam_move);copyMoveMessage("Trash")}}}}}}}}}}}}}}}}else{if(l=="reload-list"){a.reloadMessageList()}else{if(l=="goto-prev-page"){if(jQuery("#searchResultWrap ul").length!=0){jQuery("#goSearch").show();jQuery("#searchResultWrap").show();return}setTimeout(function(){gotoHistoryBack()},100)}else{if(l=="checked-cancel"){closeToolbarMenu()}else{if(l=="checked-webfolder-cancel"){a.resetCheckedWebFolder()}else{if(l=="move-parent-webfolder"){a.currentWebFolderInfo={};a.currentWebFolderInfo.param=a.webFolderParamHistoryList.pop();if(_.contains(a.currentWebFolderInfo.param.path,jQuery("#mailWebSubFolderToolbarWrap h1").text().trim())){a.currentWebFolderInfo.param=a.webFolderParamHistoryList.pop()}if(a.webFolderParamHistoryList.length===0){jQuery("#mailWebFolderHomeToolbarWrap").show();jQuery("#mailWebSubFolderToolbarWrap").hide();a.webFolderParamHistoryList.push(a.currentWebFolderInfo.param)}else{jQuery("#mailWebSubFolderToolbarWrap").show();jQuery("#mailWebFolderHomeToolbarWrap").hide();jQuery("#mailWebSubFolderToolbarWrap h1").text(a.currentWebFolderInfo.param.path.split(".").slice(-1)[0])}a.currentWebFolderInfo.param.currentPage=1;a.fetchWebFolderList(a.currentWebFolderInfo.param)}else{if(l=="select-webfolder-all"){if(jQuery("#select-all").text()===mailMsg.mail_select_all){jQuery("#webfolder_list input[type=checkbox]").prop("checked",true);jQuery("#select-all").text(mailMsg.mail_select_all_cancel)}else{jQuery("#webfolder_list input[type=checkbox]").prop("checked",false);jQuery("#select-all").text(mailMsg.mail_select_all)}judgmentWebFolderCheckList()}else{if(l=="attach-webfolder"){progressAction({action:true});jQuery(window).off("scroll.renderNewWebFolderPage");var h=jQuery("div.webFolderHeader:visible");var g={path:h.attr("data-path"),sharedUserSeq:h.attr("data-userseq")===""?0:h.attr("data-userseq"),sroot:h.attr("data-sroot"),type:h.attr("data-type")};var f=[];_.each(jQuery("#webfolder_content").find("li input:checked"),function(n){f.push(jQuery(n).data("uid").toString())});a.resetCheckedWebFolder();jQuery("#mailWebFolderHomeToolbarWrap").hide();jQuery("#mailWebSubFolderToolbarWrap").hide();jQuery("#mailWriteToolbarWrap").show();g=_.extend(g,{uids:f});changeMailContainer("write");ActionLoader.postSyncGoJsonLoadAction(a.webfolderAttachWriteAction,g,function(n){progressAction({action:false});checkUploadfile(n)},"json",function(){alert(mailMsg.alert_attachFile)})}}}}}}}}});jQuery("#main_content").on("touchstart","a.flagClass",function(i){var h=jQuery(this).attr("tap-rol");if(h=="switch-flag"){var d=jQuery(this).find("span.ic");var f=d.attr("flag");var e=("on"==d.attr("flaged"));var g=d.closest("li").attr("id");switchFlagFlaged([g],f,!e)}});jQuery("#main_content").on("click","a,span,li",function(M){var O=jQuery(this).attr("evt-rol");if(!O){return}if(M.stopPropagation){M.stopPropagation()}else{M.cancelBubble=true}M.preventDefault();if(O=="switch-flag"){var F=jQuery(this).attr("flag");var K=("on"==jQuery(this).attr("flaged"));var g=jQuery(this).closest("li").attr("id");switchFlagFlaged([g],F,!K)}else{if(O=="read-message"){var y=jQuery(this);var l=y.attr("data-list-id");var A=Math.floor(_.indexOf(_.map(jQuery("ul.list_mail li>a"),function(P){return jQuery(P).attr("data-list-id")}),l.toString())/20)+1;var d={listId:l};sessionStorage.setItem("PAGE-NO",A);sessionStorage.setItem("SELECTED-DOC-ID",JSON.stringify(d));var u=jQuery(this).closest("li").attr("folder");var m=jQuery(this).closest("li").attr("uid");readMessage(u,m)}else{if(O=="draft-message"){var u=jQuery(this).closest("li").attr("folder");var m=jQuery(this).closest("li").attr("uid");writeDraftMessage(u,m)}else{if(O=="mail-read-toggle-sender-list"){var s=jQuery("#mailReadSenderListWrap");if(s.css("display")=="none"){s.show();jQuery(this).find("span.ic_arrow2_down").removeClass("ic_arrow2_down").addClass("ic_arrow2_up");setCookie("rcpt_show","on",365)}else{s.hide();jQuery(this).find("span.ic_arrow2_up").removeClass("ic_arrow2_up").addClass("ic_arrow2_down");setCookie("rcpt_show","off",365)}if(a.Iscroll){a.makeReadIscroll({isInitRendering:false})}}else{if(O=="mail-read-toggle-attach-list"){var s=jQuery("#mailReadAttachListWrap");if(s.css("display")=="none"){s.show();jQuery(this).find("span.ic_arrow2_down").removeClass("ic_arrow2_down").addClass("ic_arrow2_up")}else{s.hide();jQuery(this).find("span.ic_arrow2_up").removeClass("ic_arrow2_up").addClass("ic_arrow2_down")}if(a.Iscroll){a.Iscroll.refresh()}}else{if(O=="download-tnef-attach"){var u=jQuery("#folderName").val();var m=jQuery("#msgUid").val();var x=jQuery(this).closest("li").attr("part");var f=jQuery(this).attr("attkey");downLoadTnefAttach(u,m,x,f)}else{if(O=="download-attach"){var r=jQuery(this).attr("evt-data");var e=jQuery("#attachFileWrap").attr("evt-confirm");if(r){openDownloadAttachConfirm()}else{var u=jQuery("#folderName").val();var m=jQuery("#msgUid").val();var x=jQuery(this).closest("li").attr("part");var D=jQuery(this).closest("li").attr("fileName");var z=jQuery(this).closest("li").attr("fileSize");var q={folderName:u,uid:m,part:x,type:"normal"};q=a.getSharedFolderParam(q);downloadAttach(q,D,z)}}else{if(O=="switch-flag-read"){var u=jQuery("#folderName").val();var m=jQuery("#msgUid").val();var F=jQuery(this).attr("flag");var K=("on"==jQuery("#readFlagedFlagIcon").attr("flaged"));a.switchMessagesFlags([m],[u],F,!K,true)}else{if(O=="show-contents-view"){var G=jQuery("#message_view_table").html();POPUPDATA=G;var j=location.protocol+"//"+window.location.host;var n=j+"/app/mail/mobile/content";if(isAndroidApp()){window.GOMobile.viewHTML(encodeURIComponent(G))}else{if(isIphoneApp()){window.location.href="gomobile://viewHTML?"+encodeURIComponent(G)}else{window.open(n,"","scrollbars=yes")}}}else{if(O=="write-mail"){goWrite()}else{if(O=="write-addr-select"){jQuery(this).remove()}else{if(O=="write-toggle-ccbcc"){var h=("open"==jQuery(this).data("toggle"));if(h){jQuery("#mail_write_table tr.ccbccWrap").hide();jQuery(this).data("toggle","close")}else{jQuery("#mail_write_table tr.ccbccWrap").show();jQuery(this).data("toggle","open")}}else{if(O=="attach-photo"){selectAttachPhoto()}else{if(O=="attach-file"){var L=MAILCONFIG.maxAttachSize,E=MAILCONFIG.maxAttachCount,H="",w=jQuery("#attach_wrap li").size(),k=E-w;var I=0;jQuery("#attach_wrap li").each(function(){I+=jQuery(this).attr("filesize")/1024/1024});if(L<I){alert(msgArgsReplace(mailMsg.mail_attach_limit_size,[L]));return}L-=I;if(E==0){k=-1}else{if(k<1){alert(msgArgsReplace(mailMsg.mail_attach_limit_count,[E]));return false}}attachFile(L,k,H)}else{if(O=="folder"){var J=jQuery(this).attr("fname");goFolder(J)}else{if(O=="mdn-read"){var y=jQuery(this);var l=y.attr("data-list-id");var A=Math.floor(_.indexOf(_.map(jQuery("ul.mail_mdn_list_area li>a"),function(P){return jQuery(P).attr("data-list-id")}),l.toString())/20)+1;var d={listId:l};sessionStorage.setItem("PAGE-NO",A);sessionStorage.setItem("SELECTED-DOC-ID",JSON.stringify(d));var o=jQuery(this).attr("messageId");var p=jQuery(this).attr("subject");var v=jQuery(this).attr("date");var q={messageId:o,subject:p,dateUtc:v};a.loadMdnRead(q)}else{if(O=="recall-mdn"){var C=jQuery(this).attr("addr");recallMsg([C])}else{if(O=="delete-attach"){if(!confirm(mailMsg.mobile_delete_attach)){return}jQuery(this).closest("li").remove()}else{if(O=="preview-attach"){if(!isCallPreviewAttach){isCallPreviewAttach=true;progressAction({action:true});var u=jQuery("#folderName").val();var m=jQuery("#msgUid").val();var x=jQuery(this).closest("li").attr("part");previewAttach(m,u,x)}}else{if(O=="preview-attach-temp"){if(!isCallPreviewAttach){isCallPreviewAttach=true;progressAction({action:true});var D=jQuery(this).closest("li").attr("filename");var N=jQuery(this).closest("li").attr("orgname");var t=jQuery(this).closest("li").attr("hostid");previewAttachTemp(N,D,t)}}else{if(O=="preview-attach-image"){progressAction({action:true});var u=jQuery("#folderName").val();var m=jQuery("#msgUid").val();var x=jQuery(this).closest("li").attr("part");var D=jQuery(this).closest("li").attr("fileName");previewAttachImage(m,u,x,D)}else{if(O=="layer-write-email"){var C=jQuery(this).parent().attr("email");goWrieLoad({to:C})}else{if(O=="read-nested-pop"){var u=jQuery("#folderName").val();var m=jQuery("#msgUid").val();var x=jQuery(this).closest("li").attr("part");readNestedMessage(u,m,x)}else{if(O=="ext-url"){var B=jQuery(this).attr("href");executeExtUrl(B)}else{if(O=="list-page-move"){var i=jQuery(this).attr("page");a.movePage(i);jQuery(document).scrollTop(0)}else{if(O=="mail-read-font-resize"){jQuery("#fontResizeLayer").toggle();fontResizeEventBind()}else{if(O=="open-write-webfolder"){jQuery(window).off("scroll.renderNewWebFolderPage");jQuery(window).on("scroll.renderNewWebFolderPage",jQuery.proxy(a.detectWebFolderListScroll,this));jQuery("#mailWriteToolbarWrap").hide();jQuery("#mailWebFolderHomeToolbarWrap").show();jQuery("#mailWebSubFolderToolbarWrap").hide();jQuery("#webFolderDirectory").val("user").attr("selected","selected");a.webFolderParamHistoryList=[];a.currentWebFolderInfo={};a.currentWebFolderInfo.param={path:"/",fullPath:"/"};changeMailContainer("webFolder");a.getSharedFolderList();a.webFolderParamHistoryList.push(a.currentWebFolderInfo.param);a.fetchWebFolderList(a.currentWebFolderInfo.param)}}}}}}}}}}}}}}}}}}}}}}}}}}}});jQuery("#main_content").on("click","input",function(f){var d=jQuery(this).attr("evt-rol");if(!d){return}if(d=="write-myself"){var e=jQuery(this).attr("checked");makeWriteMyself(e)}});jQuery("#attachLayer").on("click","a",function(e){closeAttachPhoto();var d=jQuery(this).attr("evt-rol");if(!d){return}if(e.stopPropagation){e.stopPropagation()}else{e.cancelBubble=true}e.preventDefault();if(d=="attach-take-picture"){attachTakePicuture()}else{if(d=="attach-select-album"){attachSelectAlbum()}}});jQuery("#sendCheckLayer").on("click","span, a",function(e){var d=jQuery(this).attr("evt-rol");if(!d){return}if(d=="send-check-ok"){checkSendMessage();checkSendMessageCancel();jQuery("#attachOverlay").hide()}else{if(d=="send-check-cancel"){checkSendMessageCancel();jQuery("#attachOverlay").hide()}else{if(d=="send-check-apply"){settingWriteInfo();checkSendMessageCancel();jQuery("#attachOverlay").hide()}}}});jQuery("#downloadAttachConfirmLayer").on("click","span, a",function(h){var g=jQuery(this).attr("evt-rol");if(!g){return}if(g=="download-attach-confirm-close"){jQuery("#attachOverlay").hide();jQuery("#downloadAttachConfirmLayer").hide()}else{if(g=="attach-confirm-layer-download"){var j=jQuery("#folderName").val();var f=jQuery("#msgUid").val();var e=jQuery(this).closest("li").attr("part");var k=jQuery(this).closest("li").attr("fileName");var d=jQuery(this).closest("li").attr("fileSize");var i={folderName:j,uid:f,part:e,type:"normal"};i=a.getSharedFolderParam(i);downloadAttach(i,k,d)}}});jQuery("#main_content").on("tap","input[type=file]",function(h){var g=jQuery(this).attr("evt-rol");if(!g){return}var d=MAILCONFIG.maxAttachCount,f=jQuery("#attach_wrap li").size(),e=d-f;if(d==0){e=-1}else{if(e<1){alert(msgArgsReplace(mailMsg.mail_attach_limit_count,[d]));return false}}return true});jQuery("#main_content").on("change","input[type=file]",function(f){var d=jQuery(this).attr("evt-rol");if(!d){return}if(f.stopPropagation){f.stopPropagation()}else{f.cancelBubble=true}f.preventDefault();if(d=="attach-image"){var e=jQuery(this).get(0).files;_.each(e,function(j){var m=MAILCONFIG.maxAttachSize;var g=j.size/1024/1024;var i=new FormData();var l=j.name.split(".");var k=l[l.length-1];if(k==undefined){alert(mailMsg.mail_attach_type_exception);return}var h=g;jQuery("#file_wrap li").each(function(){h+=jQuery(this).attr("filesize")/1024/1024});jQuery("#img_wrap li").each(function(){h+=jQuery(this).attr("filesize")/1024/1024});if(m<h){alert(msgArgsReplace(mailMsg.mail_attach_limit_size,[m]));return}i.append("file",j);i.append("GOSSOcookie",getCookie("GOSSOcookie"));jQuery.ajax({url:a.writeAttachAction,type:"POST",contentType:false,processData:false,data:i,success:function(n){attachFileSuccess(n)}})})}});jQuery("#popSideOverlay").on("swipeleft",function(d){if(d.stopPropagation){d.stopPropagation()}else{d.cancelBubble=true}d.preventDefault();hideMailFolderSide()});jQuery("#popSideOverlay").on("tap",function(d){if(d.stopPropagation){d.stopPropagation()}else{d.cancelBubble=true}d.preventDefault();hideMailFolderSide()});jQuery("#move_folder_page").on("click","a,span",function(f){var e=jQuery(this).attr("evt-rol");if(!e){return}if(e=="move-message"){var d=jQuery(this).attr("folder");copyMoveMessage(d)}else{if(e=="move-folder-cancel"){changeMailContainer("list")}}});jQuery("#tag_message_page").on("click","a,span",function(f){var e=jQuery(this).attr("evt-rol");if(!e){return}if(e=="tag-message"){var d=jQuery(this).attr("val");tagMessage(d,true)}else{if(e=="tag-message-cancel"){changeMailContainer("list")}}});jQuery("#addr_content").on("click","a,span",function(e){var d=jQuery(this).attr("evt-rol");if(!d){return}if(d=="change-addr-type"){var g=jQuery(this).data("type");jQuery("#addr_tab_wrap li").removeClass("on");jQuery(this).closest("li").addClass("on");changeMailWriteAddrType(g,false)}else{if(d=="list-page-move"){var f=jQuery(this).attr("page");a.moveAddrPage(f)}else{if(d=="write-addr-cancel"){jQuery("#mailWriteToolbarWrap").show();a.selectedNodes=[];closeAddressContent()}else{if(d=="add-addr-write"){var h=jQuery(this).data("type");makeAddrSelectItem(h,a.selectedNodes)}}}}});jQuery("#webfolder_content").on("click","a,span",function(g){var d=jQuery(g.currentTarget);var f=jQuery(this).attr("evt-rol");if(!f){return}if(f=="move-sub-webfolder"){a.currentWebFolderInfo={};jQuery("#mailWebFolderHomeToolbarWrap").hide();jQuery("#mailWebSubFolderToolbarWrap").show();a.resetCheckedWebFolder();jQuery("#mailWebSubFolderToolbarWrap h1").text(d.text());a.currentWebFolderInfo.param={type:d.data("type"),path:d.data("full-path").split("WEBFOLDERROOT.")[1],fullPath:d.data("full-path"),nodeNum:d.data("node-num")};if(d.data("type")==="share"){a.currentWebFolderInfo.param.userSeq=d.data("userseq");a.currentWebFolderInfo.param.sroot=d.data("sroot")}a.webFolderParamHistoryList.push(a.currentWebFolderInfo.param);a.fetchWebFolderList(a.currentWebFolderInfo.param)}else{if(f=="choose-webfolder-cancel"){closeWebFolder()}else{if(f=="select-webfolder"){d.next().trigger("click");judgmentWebFolderCheckList()}}}});jQuery("#webfolder_content").on("click","input[type=checkbox]",function(d){judgmentWebFolderCheckList()});jQuery("#webfolder_content").on("change","#webFolderDirectory",function(f){var d=jQuery(f.currentTarget).find("option:selected");a.webFolderParamHistoryList=[];a.currentWebFolderInfo={};jQuery("#mailWebFolderHomeToolbarWrap").show();jQuery("#mailWebSubFolderToolbarWrap").hide();a.resetCheckedWebFolder();a.currentWebFolderInfo.param={type:d.data("type"),fullPath:"WEBFOLDERROOT"};if(d.data("type")==="share"){a.currentWebFolderInfo.param=jQuery.extend(a.currentWebFolderInfo.param,{sroot:d.data("sroot"),userSeq:d.data("userseq"),path:d.data("full-path").split(".")[1],fullPath:d.data("full-path")})}a.webFolderParamHistoryList.push(a.currentWebFolderInfo.param);a.fetchWebFolderList(a.currentWebFolderInfo.param)});function c(f,d){var e=f.find("option:"+(d?"selected":"first")).text();f.closest("a").find("span.txt").text(e)}jQuery("#addr_content").on("change","select.addr_select",jQuery.proxy(function(g){var j=this;var d=jQuery(g.currentTarget);var i=d.val();c(d,true);jQuery("#addr_content").find("span.depthspan").remove();jQuery("#userCheckedScroll").empty();if(i==="department"){e()}else{if(i==="company"){f();return}else{jQuery("#writeDeptAddrLink").hide()}}changeMailWriteAddrType(i,g.isTrigger);function f(){h().done(function(l){var k=jQuery.ajax({method:"GET",data:{folderId:l[0].metadata.id},async:false,url:j.companySelectAction});k.done(function(n){if(_.isEmpty(n)){changeMailWriteAddrType("user",true);return}var o=n[0].metadata.parentPathName.split(">").length;var m=Handlebars.compile(jQuery("#addr_company_select_tmpl").html())({isFirst:true,depth:o,data:n});jQuery("#addr_content div.addr_main").append(m);c(jQuery("#addr_content span.depthspan:last select"),false)});jQuery("#addr_content span.depthspan:last").find("select").trigger("change",[g.isTrigger])})}function e(){var k=jQuery.ajax({method:"GET",async:false,url:j.deptSelectAction});k.done(function(m){var l=Handlebars.compile(jQuery("#addr_dept_select_tmpl").html())(m);jQuery("#addr_content div.addr_main").append(l);c(jQuery("#addr_content span.depthspan:last select"),false)})}function h(){var k=jQuery.ajax({method:"GET",async:false,url:j.companySelectAction});return k}},this));jQuery("#addr_content").on("change","select.company_addr_select",jQuery.proxy(function(d,k){var f=jQuery(d.currentTarget),l=this;var n=f.closest("span.depthspan"),j=n.data("depth"),g=f.find("option:selected").val(),m=jQuery("select.addr_select").val(),e=f.find("option:selected").data("readable");o(j);c(f,true);if(g==""){if(Number(j)>1){var i=n.prev().find("select");changeMailWriteAddrType(m,k,i.val(),i.find("option:selected").data("readable"));return}return}var h=jQuery.ajax({method:"GET",async:false,data:{folderId:g},url:l.companySelectAction});h.done(function(q){if(q.length==0){return}var r=q[0].metadata.parentPathName.split(">").length;o(r);var p=Handlebars.compile(jQuery("#addr_company_select_tmpl").html())({isFirst:false,depth:r,data:q});jQuery("#addr_content div.addr_main").append(p);c(jQuery("#addr_content span.depthspan:last select"),false)});changeMailWriteAddrType(m,k,g,e);function o(p){jQuery.each(jQuery("#addr_content span.depthspan"),function(){var q=Number(jQuery(this).data("depth"));if(Number(p)<q){jQuery(this).remove()}})}},this));jQuery("#addr_content").on("change","select.dept_addr_select",function(f){var d=jQuery(f.currentTarget);var e=d.val();d.closest("a").find("span.txt").text(d.find("option:selected").text());var g=d.closest("div").find("select.addr_select").val();changeMailWriteAddrType(g,false,e)});jQuery("#addr_content input#addrSearchText").on("keyup",function(d){d.preventDefault();if(d.keyCode==13){searchAddr();return}});jQuery("#addrSearchCancel").on("vclick",function(d){d.preventDefault();jQuery("#addrSearchText").val("");if(jQuery("#writeAddrSelect").val()==="emp"){a.removeOrgList();a.fetchOrgMember("",function(e){a.setHeaderCrumbList(e);a.setOrgMemberByCompany(e)})}else{writeAddrSelect()}});jQuery("#addrSearchBtn").on("vclick",function(d){d.preventDefault();searchAddr()});jQuery("body").on("touchstart","div.layer_auto_complete",function(d){jQuery(this).addClass("hover_effect")});jQuery("#main_content").on("tap","span",function(){var e=jQuery(this).attr("evt-rol");if(e=="check-checkbox"){jQuery(this).prev().trigger("click");checkMailListCheckbox(jQuery(this).prev());var d=jQuery(this).attr("data-type");judgmentCheckList(d)}});jQuery("#addr_member_list").on("tap","li",function(f){f.preventDefault();var d=jQuery(this).find("span").attr("evt-rol");if(d=="check-checkbox-only"){jQuery(this).find("input").trigger("click")}});jQuery("#commonSearchInput").on("keyup",function(d){if(d.keyCode==13){simpleSearch("all");return}jQuery("#simpleSearchWrap span.searchText").text(jQuery("#commonSearchInput").val())});jQuery("#goSearch").on("vclick","a",function(f){f.preventDefault();var d=jQuery(this).attr("evt-rol");if(!d){return}if(d=="searchCloseButton"){jQuery("#simpleSearchTitle").show();if(window.History.getState().data.type=="read"){var h=mailControl.getCurrentFolder();var g={folder:h};mailControl.loadMessageList(g)}closeSearchLayer()}else{if(d=="detailSearchToggle"||d=="detailSearchTitle"){j()}else{if(d=="deleteSearchText"){i()}else{if(d=="searchInit"){jQuery("#detailSearchWrap input[type=search], #detailSearchWrap input[type=checkbox]").prop("checked",false).val("");jQuery("#detailSearchWrap select").prop("selectedIndex",0)}}}}function j(){var e=jQuery("#detailSearchToggle");e.toggleClass("on");if(e.hasClass("on")){jQuery("#detailSearchTitle, #detailSearchWrap").show();jQuery("#simpleSearchWrap, #simpleSearchTitle").hide()}else{jQuery("#simpleSearchTitle, #simpleSearchWrap").show();jQuery("#detailSearchWrap, #detailSearchTitle").hide()}jQuery("#searchResultWrap").hide()}function i(){jQuery("#commonSearchInput").val("");jQuery("#simpleSearchWrap span.searchText").text("");return false}})};this.makeSearchEvent=function(){jQuery("a[data-search]").off();jQuery("a[data-search]").on("vclick",function(b){b.preventDefault();simpleSearch(jQuery(this).attr("data-search"))});jQuery("ul.search_result").off();jQuery("ul.search_result").on("keyup",function(b){if(b.keyCode==13){detailSearch(b);return}})};this.makeSearchResultEvent=function(){var b=this;jQuery("#searchResultWrap li a.tit").off();jQuery("#searchResultWrap li a.tit").on("vclick",function(){var d=jQuery(this).closest("li").attr("evt-rol");if(d=="read-message"){var e=jQuery(this).attr("folder");var c=jQuery(this).attr("uid");readMessage(e,c);closeSearchLayer(true)}});jQuery("#searchResultWrap li a[tap-rol='switch-flag']").off();jQuery("#searchResultWrap li a[tap-rol='switch-flag']").on("vclick",function(g){var c=jQuery(this).find("span.ic");var e=c.attr("flag");var d=("on"==c.attr("flaged"));var f=c.closest("li").attr("id");switchFlagFlaged([f],e,!d)});jQuery("#searchResultWrap li span.checkboxSelect").off();jQuery("#searchResultWrap li span.checkboxSelect").on("tap",function(d){var c=jQuery(this).attr("evt-rol");if(c=="check-checkbox"){jQuery(this).prev().trigger("click");checkMailListCheckbox(jQuery(this).prev());judgmentSearchCheckList()}});jQuery("#searchResultNav").off();jQuery("#searchResultNav").on("tap","a",function(f){var d=jQuery(this).attr("evt-rol");if(!d){return}if(f.stopPropagation){f.stopPropagation()}else{f.cancelBubble=true}f.preventDefault();if(d=="toolbar"){var g=("on"==jQuery(this).attr("sub"));var h=jQuery(this).attr("menu");if(g){b.makeSubToolbar(jQuery(this),h)}else{var c=jQuery(this).attr("evt-act");if(c=="mail-select-all"){var e=jQuery(this).data("checked");if(e){jQuery("input[name=msgId]").each(function(){jQuery(this).prop("checked",false);checkMailListCheckbox(jQuery(this))});jQuery(this).data("checked",false);jQuery(this).find("span.txt").text(mailMsg.mail_select_all)}else{jQuery("input[name=msgId]").each(function(){jQuery(this).prop("checked",true);checkMailListCheckbox(jQuery(this))});jQuery(this).data("checked",true);jQuery(this).find("span.txt").text(mailMsg.mail_select_all_cancel)}}else{if(c=="mail-delete"){deleteMessage();closeSearchLayer()}else{if(c=="move-message-page"){moveMessagePage();closeSearchLayer(true);closeMoreToolbarLayer()}else{if(c=="tag-message-page"){tagMessagePage();closeSearchLayer(true);closeMoreToolbarLayer()}else{if(c=="search-toggle-more-layout"){b.makeSubToolbar(jQuery(this),h)}else{if(c=="change-flag-seen"){changeSeenFlag(true);closeSearchLayer()}else{if(c=="change-flag-unseen"){changeSeenFlag(false);closeSearchLayer()}}}}}}}}}else{if(d=="checked-cancel"){jQuery("#searchNav").show();jQuery("#searchResultNav").hide();jQuery("#searchResultNav div.array_option").hide();jQuery("#searchResultWrap input[name=msgId]").each(function(){jQuery(this).prop("checked",false);checkMailListCheckbox(jQuery(this))});jQuery("#mail_toolbar_search_selectall").data("checked",false);jQuery("#mail_toolbar_search_selectall").find("span.txt").text(mailMsg.mail_select_all)}}})}};function fontResizeEventBind(){var a=this;jQuery("#fontResizeLayer ul.list_fs").on("touchmove",function(c){var d=c.originalEvent.touches[0];var b=document.elementFromPoint(d.pageX,d.pageY);try{if(jQuery(b)[0].nodeName&&jQuery(b)[0].nodeName=="INPUT"){jQuery(b).trigger("click")}}catch(c){return}});jQuery("#fontResizeLayer input[name=inpFont]").on("change",function(c){var b=jQuery(c.currentTarget);var d=b.val();resizeFontSize(parseInt(d));setLocalStorage("lastFontSize_"+USERSESSION.id,d)})}function resizeFontSize(a){jQuery("#mailContentWrapper").find("span[data-font-resize]").each(function(){var c=jQuery(this).attr("data-origin-fontsize");var b=jQuery(this).attr("data-origin-lineheight");var e=parseFloat(c)+parseFloat(c*(a*0.01));var d=parseFloat(b)+parseFloat(b*(a*0.01));jQuery(this).css({"font-size":e.toFixed(3)+"px","line-height":d.toFixed(3)+"px"})});if(this.Iscroll){this.Iscroll.refresh()}}function closeToolbarMenu(){jQuery("#mailHomeToolbarWrap").show();jQuery("#mailListToolbarWrap").hide();jQuery("#mail_list_area input[name=msgId], #mail_mdn_list_area input[name=msgId]").each(function(){jQuery(this).attr("checked",false);checkMailListCheckbox(jQuery(this))});jQuery("#mail_toolbar_list_selectall").data("checked",false);jQuery("#mail_toolbar_list_selectall").find("span.txt").text(mailMsg.mail_select_all);changeStatusBarColor(false)}function isSearchResult(){var a=jQuery("#goSearch").find("li input:checked").length;return a>0}function closeMoreToolbarLayer(){var a=jQuery("#toolbar_wrap");if(isSearchResult()){a=jQuery("#searchResultNav")}a.find("div.array_option").hide()}function closeSearchLayer(a){jQuery("#goSearch input").blur();jQuery("#goSearch").hide();jQuery("#commonSearchInput").val("");jQuery("body").removeClass("scroll_fix");initSearhResultLayer(a)}function initSearhResultLayer(a){console.log("initSearchResultLayer");jQuery("#searchNav").show();jQuery("#searchResultNav").hide();if(!a){jQuery("#searchResultWrap").html("")}jQuery("#mail_toolbar_search_selectall").data("checked",false);jQuery("#mail_toolbar_search_selectall").find("span.txt").text(mailMsg.mail_select_all)}function judgmentCheckList(a){var b=jQuery("#main_content").find("li input:checked").length;if(b){jQuery("#mailHomeToolbarWrap").hide();jQuery("#mailListToolbarWrap").show();changeStatusBarColor(true)}else{jQuery("#mailHomeToolbarWrap").show();jQuery("#mailListToolbarWrap").hide();changeStatusBarColor(false)}if(a=="mdn"){jQuery("#mailListToolbarWrap div.btn_submenu").hide();jQuery("#mailListToolbarWrap span.wrap_btn_m_more").hide()}else{jQuery("#mailListToolbarWrap div.btn_submenu").show();jQuery("#mailListToolbarWrap span.wrap_btn_m_more").show()}}function judgmentSearchCheckList(){var a=jQuery("#searchResultWrap").find("li input:checked").length;if(a){jQuery("#searchNav").hide();jQuery("#searchResultNav").show()}else{jQuery("#searchNav").show();jQuery("#searchResultNav").hide();jQuery("#searchResultNav div.array_option").hide()}}function judgmentWebFolderCheckList(){var a=jQuery("#webfolder_content").find("li input:checked").length;if(a){jQuery("#mailWebFolderSelectToolbarWrap").show()}else{jQuery("#mailWebFolderSelectToolbarWrap").hide()}jQuery("#mailWebFolderSelectToolbarWrap span.count").text(msgArgsReplace(mailMsg.folder_select_number.replace("{number}","0"),[a]))}function closeMoreLayout(a){if(a==undefined){a=jQuery("#more_layout")}if(a.is(":visible")){a.hide();return true}return false}function getPopupData(){return POPUPDATA}function initMailFunction(){folderControl=new FolderControl();mailControl=new MailControl();historyControl=new HistoryControl(mailHistoryCallBack);folderControl.makeMailEvent();mailControl.makeMailEvent()}function mailHistoryCallBack(d){var c=historyControl.getHistoryIndex();var b=d.data;if(b&&b.param&&c-1>b.state){if((b.type!="empty")&&(!checkEscapeWriteMode())){history.forward();return}switch(b.type){case"list":mailControl.loadMessageList(b.param,true);break;case"read":mailControl.readMessage(b.param,true);break;case"mdnlist":mailControl.loadMdnList(b.param,true);break;case"mdnread":mailControl.loadMdnRead(b.param,true);break;case"empty":if(currentMenu=="addr"){changeMailWriteMode()}break;case"move":gotoHistoryBack();break;case"tag":gotoHistoryBack();break}}else{if(!b||!b.type){var a=d.url;if(a.indexOf("app/mail?work=")>0){if(!checkEscapeWriteMode()){history.forward();return}gotoHistoryBack()}}}}function changeMailContainer(a){var b=jQuery("#main_content");if(a=="addr"||a=="moveFolder"||a=="tag"||a=="webFolder"){jQuery("#go_content").hide();if(a=="addr"){jQuery("#addr_content").show();b.removeClass("write")}else{if(a=="tag"){jQuery("#tag_message_page").show()}else{if(a=="moveFolder"){jQuery("#move_folder_page").show()}else{jQuery("#webfolder_content").show()}}}}else{jQuery("#addr_content").hide();jQuery("#webfolder_content").hide();jQuery("#move_folder_page").hide();jQuery("#tag_message_page").hide();jQuery("#go_content").show();if(a=="write"){if(!b.hasClass("write")){b.addClass("write")}}else{b.removeClass("write")}}}function getTagInfo(b){var c=folderControl.getTagData();if(c&&c.length>0){for(var a=0;a<c.length;a++){if(c[a].id==b){return c[a]}}}return null}function isContainedTrashMail(){return jQuery("li[folder=Trash] input:checked").length>0}function getMailListCheckedObj(){var b;if(currentMenu=="read"){b=jQuery("#messageListId")}else{var a=jQuery("#main_content");if(isSearchResult()){a=jQuery("#searchResultWrap")}b=a.find("input[name=msgId]:checked")}return b}function getMailListCheckedCount(){return getMailListCheckedObj().length}function getMailListCheckedIdArray(){var a=new Array();if(currentMenu=="read"){a.push(getMailListCheckedObj().val())}else{getMailListCheckedObj().each(function(){a.push(jQuery(this).closest("li").attr("id"))})}return a}function getListProcessParams(f){var c=[];var d=[];for(var b=0;b<f.length;b++){var g=f[b].lastIndexOf("_");var e=f[b].substring(0,g);var a=f[b].substring(g+1);c[c.length]=a;if(isAllFolder){d[d.length]=e}else{d[0]=e}}return{uids:c,fnames:d}}function checkSuccess(a){if(a&&a.isSuccess){return true}else{if(a&&a.failMsg){alert(a.failMsg)}return false}}function checkMailListCheckbox(b){var a=jQuery(b).closest("li");if(b.attr("checked")){if(!a.hasClass("choice")){a.addClass("choice")}}else{if(a.hasClass("choice")){a.removeClass("choice")}}}function checkEscapeWriteMode(){if(currentMenu=="write"||currentMenu=="addr"){if(isWriteModify()&&confirm(mailMsg.mail_draft_save)){doDraftSave()}hideAutoComplate()}return true}function escapewriteAndGoHome(){if(currentMenu=="write"||currentMenu=="addr"){if(isWriteModify()){setTimeout(function(){if(confirm(mailMsg.confirm_mobile_escapewrite)){hideAutoComplate();window.location="/app/home"}},200)}else{hideAutoComplate();window.location="/app/home"}}else{window.location="/app/home"}}function isWriteModify(){var b=getRcptFormCount();if(b>0){return true}var a=jQuery.trim(jQuery("#subject").val());if(a!=""){return true}var c=jQuery.trim(jQuery("#content").val());if(c!=""){return true}var d=jQuery("#file_wrap li").length;d+=jQuery("#img_wrap li").length;if(d>0){return true}return false}function mailWriteInit(b){makeInputAddresskeyEvt("to");makeInputAddresskeyEvt("cc");makeInputAddresskeyEvt("bcc");var a={autoResizeWidth:false,makeFormat:true,multiple:false,matchCase:true,notContact:(USE_CONTACT==true?"F":"T")};jQuery("#to").autocomplete(mailControl.searchAddressAction,a);jQuery("#cc").autocomplete(mailControl.searchAddressAction,a);jQuery("#bcc").autocomplete(mailControl.searchAddressAction,a);makeInputAddressFormat("to",b.to);makeInputAddressFormat("cc",b.cc);makeInputAddressFormat("bcc",b.bcc);isSendInfoCheckUse=b.sendCheckConfig.sendCheckApply;isSendEmailCheckUse=b.sendCheckConfig.sendEmailCheck;isSendAttachCheckUse=b.sendCheckConfig.sendAttachCheck;sendAttachData=b.sendCheckConfig.sendAttachData;isSendKeywordCheckUse=b.sendCheckConfig.sendKeywordCheck;sendKeywordData=b.sendCheckConfig.sendKeywordData;MAX_ATTACH_SIZE=b.attachConfig.maxAttachSize;checkCcBccRcptArea();mailControl.getSignList();jQuery("#content").css("min-height",jQuery("#content").height());jQuery("#content").on("keyup paste change",function(){jQuery(this).height(1);jQuery(this).height(jQuery(this).prop("scrollHeight")+12)})}function resizeTextFrame(a,b){document.getElementById("messageContentFrame").style.height=a+25+"px";document.getElementById("messageContentFrame").style.width=b+"px"}function getMessageText(){return document.getElementById("messageText").value}function makeInputAddressFormat(a,c){if(!c){return}c=jQuery.trim(c);addressArray=c.split(",");for(var b=0;b<addressArray.length;b++){makeAddressUnitFormat(a,addressArray[b])}}function makeAddressUnitFormat(c,d){var h=false;if(jQuery.trim(d)==""){return}_.each(jQuery("#"+c+"AddrWrap span.name"),function(i){if(i.title.indexOf(d.substring(d.indexOf("<")))>-1){h=true;return}});if(h){return}var g=jQuery("#"+c);var a=jQuery('<span class="name"></span>').attr("title",d).data("email",d).text(getFormatName(d,MAIL_EXPOSURE==false,LOCAL_DOMAIN));var b=jQuery('<span class="ic ic_del"></span>');b.click(function(){jQuery(this).closest("a.adr").remove();g.focus()});var e=jQuery('<span class="btn_wrap" style="display:inline-block;"></span>').append(b);var f=jQuery("<li evt-rol='write-addr-select'></li>");f.append(a).append(e);g.closest("li").before(f);g.val("");g.focus()}function deleteAddressUnitFormat(a,b){jQuery(b).remove();jQuery("#"+a).focus()}function deleteAddressUnitFormatAll(a){jQuery("#"+a+"AddrWrap ul.name_tag li:not(.creat)").remove()}function makeInputAddresskeyEvt(a){jQuery("#"+a).blur(function(c){c.preventDefault();var d=jQuery.trim(jQuery(this).val());var b=jQuery("#"+a+"_actb");if(b.length==0||b.css("display")=="none"){makeInputAddressFormat(a,d)}else{setTimeout(function(){if(jQuery("div.layer_auto_complete").hasClass("hover_effect")){jQuery(this).val("");jQuery("div.layer_auto_complete").removeClass("hover_effect")}else{makeInputAddressFormat(a,d)}},200)}});jQuery("#"+a+"AddrWrap ul.name_tag").click(function(b){jQuery("#"+a).focus()})}function getRcptFormCount(){var c=["to","cc","bcc"];var b=0;for(var a=0;a<c.length;a++){jQuery("#"+c[a]+"AddrWrap li span.name").each(function(){b++})}return b}function makeRcptForm(d){if(!d){d={}}var c=["to","cc","bcc"];var b=[];for(var a=0;a<c.length;a++){jQuery("#"+c[a]+"AddrWrap li span.name").each(function(){b.push(jQuery(this).data("email"))});if(c[a]=="to"){d.to=b.join(",")}else{if(c[a]=="cc"){d.cc=b.join(",")}else{if(c[a]=="bcc"){d.bcc=b.join(",")}}}b=[]}return d}function checkCcBccRcptArea(){var c=["cc","bcc"];var b=0;for(var a=0;a<c.length;a++){jQuery("#"+c[a]+"AddrWrap li span.name").each(function(){b++})}if(b>0){jQuery("#mail_write_table tr.ccbccWrap").show();jQuery("#toggle_ccbcc_link").data("toggle","open")}}function hideAutoComplate(){jQuery("#to").unautocomplete();jQuery("#cc").unautocomplete();jQuery("#bcc").unautocomplete()}function getFileSizeWithUnit(f,c){var e=parseInt(f)||0,a={K:1024,M:1048576,G:1073700000,T:1099500000000},b=0,d="B";if(e>a.T){b=a.T;d="T"+d}else{if(e>a.G){b=a.G;d="G"+d}else{if(e>a.M){b=a.M;d="M"+d}else{b=a.K;d="K"+d}}}return(e/b).toFixed(c)+" "+d}function getFileIconStyle(a){var c=a.toLowerCase(),b=new RegExp("(zip|doc|docx|ppt|pptx|xls|xlsx|hwp|pdf|txt|html|htm|jpg|jpeg|png|gif|tif|tiff|bmp|exe|avi|mp3|mp4|mov|mpg|mpeg|lzh|xml|log|csv|eml)","gi");return"ic_"+(b.test(c)?c:"def")}function isImage(b){var a=new RegExp("(jpeg|jpg|gif|png|bmp|tiff|tif)","gi");if(a.test(b)){return true}return false}function recurrenceParser(a){var j=a.split(";");var g={};for(var f=0;f<j.length;f++){var b=j[f].split("=");g[b[0]]=b[1]}var d=humanizeFrequency(g);var e=humanizeIntervalOption(g);var c=humanizeUntil(g);var h=humanizeCount(g);return d+" "+e+" "+c+" "+h}function humanizeFrequency(a){var b="";switch(a.FREQ){case"DAILY":if(a.hasOwnProperty("INTERVAL")){b=msgArgsReplace(mailMsg.mail_calendar_recur_day,[a.INTERVAL])}else{b=mailMsg.mail_calendar_allday}break;case"WEEKLY":if(a.hasOwnProperty("INTERVAL")){b=msgArgsReplace(mailMsg.mail_calendar_recur_week,[a.INTERVAL])}else{b=mailMsg.mail_calendar_allweek}break;case"MONTHLY":if(a.hasOwnProperty("INTERVAL")){b=msgArgsReplace(mailMsg.mail_calendar_recur_month,[a.INTERVAL])}else{b=mailMsg.mail_calendar_allmonth}break;case"YEARLY":if(a.hasOwnProperty("INTERVAL")){b=msgArgsReplace(mailMsg.mail_calendar_recur_year,[a.INTERVAL])}else{b=mailMsg.mail_calendar_allyear}break}return b}function humanizeIntervalOption(f){var g="";if(f.hasOwnProperty("BYDAY")){var b=f.BYDAY.split(",");var h={SU:mailMsg.mail_calendar_sunday,MO:mailMsg.mail_calendar_monday,TU:mailMsg.mail_calendar_tuesday,WE:mailMsg.mail_calendar_wednesday,TH:mailMsg.mail_calendar_thursday,FR:mailMsg.mail_calendar_friday,SA:mailMsg.mail_calendar_saturday};for(var d=0;d<b.length;d++){var a=/([0-9]*)(SU|MO|TU|WE|TH|FR|SA)?$/.exec(b[d]);var e=a[1]?a[1]:undefined;var c=h[a[2]];if(f.hasOwnProperty("BYSETPOS")){e=f.BYSETPOS}if(e==null){g+=c}else{g+=msgArgsReplace(mailMsg.mail_calendar_recur_number,[e,c])}if(b.length!=(d+1)){g+=", "}}}if(f.hasOwnProperty("BYMONTHDAY")){var b=f.BYMONTHDAY.split(",");for(var d=0;d<b.length;d++){g+=msgArgsReplace(mailMsg.mail_calendar_recur_day,[b[d]]);if(b.length!=(d+1)){g+=", "}}}if(f.hasOwnProperty("BYMONTH")){var b=f.BYMONTHDAY.split(",");for(var d=0;d<b.length;d++){g+=msgArgsReplace(mailMsg.mail_calendar_recur_day,[b[d]]);if(b.length!=(d+1)){g+=", "}}}return g}function humanizeUntil(a){var c="";if(a.hasOwnProperty("UNTIL")){var b=moment(a.UNTIL,"YYYYMMDD");c=msgArgsReplace(mailMsg.mail_calendar_recur_to,[b.format("YYYY-MM-DD")])}return c}function humanizeCount(a){var b="";if(a.hasOwnProperty("COUNT")){b=msgArgsReplace(mailMsg.mail_calendar_recur_count,[a.COUNT])}return b}function deleteMessage(){var a=isContainedTrashMail();var e=mailMsg.confirm_delete;if(a||currentFolderType=="trash"){e=mailMsg.confirm_trashdelete}else{if(currentFolderType=="reserved"){e=mailMsg.confirm_reserveddelete}}if(!confirm(e)){return}var c=getMailListCheckedIdArray();var d=getListProcessParams(c);var b={folderNames:d.fnames,uids:d.uids};mailControl.deleteMessages(b)}function deleteMdn(){var a=new Array();getMailListCheckedObj().each(function(){a.push(jQuery(this).val())});mailControl.deleteMdn({messageIds:a})}function changeSeenFlag(a){var c=getMailListCheckedIdArray();var b=getListProcessParams(c);mailControl.switchMessagesFlags(b.uids,b.fnames,"S",a)}function switchFlagFlaged(c,d,a){var b=getListProcessParams(c);mailControl.switchMessagesFlags(b.uids,b.fnames,d,a)}function goFolder(c,a){if(!checkEscapeWriteMode()){return}var b={folder:c};b.sharedFlag="user";if(a){b.flag=a}hideMailFolderSide();mailControl.loadMessageList(b)}function displayHomeIcon(){var a=sessionStorage.getItem("GO-Agent-mail");if(a=="GO-Android"||a=="GO-iPhone"){jQuery("#mailHomeToolbarWrap a[evt-rol='goto-gohome']").hide()}}function gotoMailHome(b){var a={folder:"Inbox"};goMailList(a,b)}function goMailList(a,b){a=(!a)?{}:a;if(!checkEscapeWriteMode()){return}makeTopMenuTitle(MAIL_APP_NAME);hideMailFolderSide();mailControl.loadMessageList(a,false,b)}function emptyFolder(b){var a="";if(b=="Trash"){a=mailMsg.confirm_emptytrash}else{if(b=="Spam"){a=mailMsg.confirm_emptyspam}else{a=mailMsg.mail_folder_delete_alert}}setTimeout(function(){if(!confirm(a)){return}var c={folderName:b};folderControl.emptyMailFolder(c)},500)}function toggleMailFolderSide(){var a=(jQuery("#mail_folder_side_background").css("display")=="none");if(a){showMailFolderSide()}else{hideMailFolderSide()}}function hideMailFolderSide(){jQuery("#mail_folder_side,#mail_folder_side_background").hide();jQuery("#popSideOverlay").css({left:"0px",top:0,width:"0px",height:"0px"}).hide();jQuery(document).undelegate("#popSideOverlay, header.go_header","scrollstart");jQuery("#go_body").height("auto");jQuery(".dim").hide()}function showMailFolderSide(){jQuery("#mail_folder_side,#mail_folder_side_background").show();var b=jQuery("#go_content");var a=b.offset();jQuery("#popSideOverlay").css({left:a.left+"px",top:0,width:b.width()+"px",height:jQuery(window).height()+"px"}).show();jQuery(document).scrollTop(0).delegate("#popSideOverlay, header.go_header","scrollstart",false);jQuery("#go_body").height(jQuery(window).height()-jQuery("header").height());folderControl.makeLeftMenuIscroll();jQuery(".dim").show()}function changeFlagView(d,h,c){var a,f;for(var b=0;b<c.length;b++){a=c[b];if(h=="F"){f=jQuery("#"+getFolderNameId(a)).find('span[flag="F"]');if(d){f.removeClass("ic_important_off");f.addClass("ic_important_on");f.attr("flaged","on")}else{f.removeClass("ic_important_on");f.addClass("ic_important_off");f.attr("flaged","off")}}else{if(h=="S"){var g=jQuery("#"+getFolderNameId(a));if(d){g.removeClass("read_no");var e=g.find("span.flagClass");if(e.hasClass("ic_noread_reply")){e.removeClass("ic_noread_reply").addClass("ic_read_reply")}else{if(e.hasClass("ic_read_no")){e.removeClass("ic_read_no").addClass("ic_read_yes")}else{if(e.hasClass("ic_noread_fw")){e.removeClass("ic_noread_fw").addClass("ic_read_fw")}}}}else{if(!g.hasClass("read_no")){g.addClass("read_no");var e=g.find("span.flagClass");if(e.hasClass("ic_read_reply")){e.removeClass("ic_read_reply").addClass("ic_noread_reply")}else{if(e.hasClass("ic_read_yes")){e.removeClass("ic_read_yes").addClass("ic_read_no")}else{if(e.hasClass("ic_read_fw")){e.removeClass("ic_read_fw").addClass("ic_noread_fw")}}}}}}}}}function changeFlagReadView(a,c){if(c=="F"){var b=jQuery("#readFlagedFlagIcon");if(a){b.removeClass("ic_important_off");b.addClass("ic_important_on");b.attr("flaged","on")}else{b.removeClass("ic_important_on");b.addClass("ic_important_off");b.attr("flaged","off")}}}function executeFolderInfo(){folderControl.updateFolderCountInfo()}function bookmarkExecute(a,b,c){var d={};if(b=="tag"){d.listType=b;d.tagId=c}else{d.folder="all";d.extFolder="on";if(b=="unseen"){d.flag="U"}else{if(b=="today"){d.adv="on";d.sdate="TODAYS";d.edate="TODAYE"}else{if(b=="yesterday"){d.adv="on";d.sdate="YESTERDAYS";d.edate="YESTERDAYE"}else{if(b=="flaged"){d.flag="F"}else{if(b=="seen"){d.flag="S"}else{if(b=="attach"){d.flag="T"}else{if(b=="reply"){d.flag="A"}else{if(b=="myself"){d.flag="L"}else{d.folder=c;d.extFolder="off"}}}}}}}}d.extType=b}d.bookmarkSeq=a;goMailList(d)}function folderExecute(a){var b={};if(a=="unseen"){b.flag="U"}else{if(a=="today"){b.adv="on";b.sdate="TODAYS";b.edate="TODAYE"}else{if(a=="yesterday"){b.adv="on";b.sdate="YESTERDAYS";b.edate="YESTERDAYE"}else{if(a=="flaged"){b.flag="F"}else{if(a=="seen"){b.flag="S"}else{if(a=="attach"){b.flag="T"}else{if(a=="reply"){b.flag="A"}else{if(a=="myself"){b.flag="L"}}}}}}}}b.folder="all";b.extFolder="on";b.extType=a;goMailList(b)}function selectedMailMenu(){var a="";if(Number(bookmarkSeq)>0){a="bookmark_title_"+bookmarkSeq}else{if(listType=="tag"){a="tag_link_"+bookmarkValue}else{if(!isAllFolder){a="folder_link_"+currentFolderEncName}}}selectCurrentFolderName(a)}function readMessage(c,a){var b={folder:c,uid:a};mailControl.readMessage(b)}function selectCurrentFolderName(a){jQuery("#mail_folder_side li.title").removeClass("on");if(a!=""){if(jQuery("#"+getFolderNameId(a)).length==0){setTimeout(function(){jQuery("#"+getFolderNameId(a)).addClass("on")},1000)}else{jQuery("#"+getFolderNameId(a)).addClass("on")}}}function goWrite(){if(!checkEscapeWriteMode()){return}var c=true;var a=jQuery("#defaultFolder2_num").text();if(isWriteNoti&&Number(a)>0){if(confirm(mailMsg.confirm_draftswrite)){c=false;goFolder("Drafts")}}if(c){var b={wtype:"normal"};mailControl.writeMessage(b)}}function makeWriteMyself(b){var c=false;jQuery("#toAddrWrap ul.name_tag li:not(.creat)").each(function(){var e=jQuery(this).find("span.name").data("email");var d=get_email(e);if(USEREMAIL==d){if(b){c=true;return false}else{deleteAddressUnitFormat("to",jQuery(this))}}});if(b&&!c){var a='"'+USERNAME+'" <'+USEREMAIL+">";makeAddressUnitFormat("to",a)}}function replyWrite(c){var b=getMailListCheckedIdArray();var a=getListProcessParams(b);var d={};d.folderName=a.fnames[0];d.uids=a.uids;d.wtype=c;goWrieLoad(d)}function forwardMessage(a){var c=getMailListCheckedIdArray();var b=getListProcessParams(c);var d={};d.folderName=b.fnames[0];d.uids=b.uids;d.fwmode=a;d.wtype="forward";goWrieLoad(d)}function reWrite(){if(isWriteModify()){if(!confirm(mailMsg.confirm_mobile_escaperewrite)){return}hideAutoComplate()}else{hideAutoComplate()}mailControl.reloadWriteMessage()}function sendMessage(l){if(currentMenu!="send"){var b=mailControl.getSendData();b=makeRcptForm(b);var n=b.to;var a=b.cc;var f=b.bcc;var p=false;if(l!="draft"){l="normal";b.massMode=false;if(jQuery.trim(n)==""&&currentMenu!="send"){alert(mailMsg.error_norecipient);jQuery("#to").focus();return}if(!checkEmailInvalidAddress(n)){return}if(!checkEmailInvalidAddress(a)){return}if(!checkEmailInvalidAddress(f)){return}if(isSendInfoCheckUse||isSendEmailCheckUse||isSendAttachCheckUse||isSendKeywordCheckUse){p=true}}b.sendType=l;var m=jQuery.trim(jQuery("#subject").val());if(m==""){alert(mailMsg.alert_nosubject);jQuery("#subject").focus();return}b.subject=m;var o=jQuery("#signSelect").val();if(o&&o>0){b.attachSign=true;b.signSeq=o}else{b.attachSign=false;b.signSeq=""}var h=jQuery("#content").val();if(!checkSendMailCount(b)){return}if(p){b.sendEmailCheckResult=false;b.sendAttachCheckResult=false;b.sendKeywordCheckResult=false;b.sendInfoCheck=false;if(isSendEmailCheckUse){var n=getEmailArray(b.to);var a=(!b.cc||jQuery.trim(b.cc)=="")?"":getEmailArray(b.cc);var f=(!b.bcc||jQuery.trim(b.bcc)=="")?"":getEmailArray(b.bcc);if(a!=""){n=n.concat(a)}if(f!=""){n=n.concat(f)}var k=new Array();for(var d=0;d<n.length;d++){k[d]=get_email(n[d])}var c={};c.emailArray=k;if(k.length!=0){ActionLoader.postSyncGoLoadAction("/api/mail/address/search/external",c,function(i){b.sendEmailCheckResult=(i)?true:false},"json")}else{b.sendEmailCheckResult=false}}if(isSendAttachCheckUse){var e=sendAttachData;if(searchContentKeyword(h,e,/,/g)){var j=jQuery("#file_wrap");var g=jQuery("#img_wrap");if(j.children().length>0||g.children().length>0){b.sendAttachCheckResult=false}else{b.sendAttachCheckResult=true}}}if(isSendKeywordCheckUse){var e=sendKeywordData;if(searchContentKeyword(h,e,/\\\\/g)){b.sendKeywordCheckResult=true}else{b.sendKeywordCheckResult=false}}if(isSendInfoCheckUse){b.sendInfoCheck=true;jQuery("#sendCheckLayerApply").show()}if(b.sendEmailCheckResult||b.sendAttachCheckResult||b.sendKeywordCheckResult||b.sendInfoCheck){jQuery("#attachOverlay").show();jQuery("#sendCheckLayer").show();mailControl.setSendData(b);checkSendInfoValue(b)}else{sendMessageParamProcess(b)}}else{sendMessageParamProcess(b)}}}function searchContentKeyword(e,d,c){var b=new RegExp("[.*+?|()\\[\\]{}\\\\]","g");d=d.replace(b,"\\$&");var a=d.replace(c,"|");return e.match(new RegExp("("+a+")","gi"))}function getEmailAddrNoPersonal(d){var c=jQuery("#"+d);var b=c.children().length;var a="";if(b>0){c.children().each(function(e){var f=jQuery(this).css("display");if(f=="block"){if(e===b-1){a+=get_email(unescape_tag(jQuery(this).attr("data-addr")))}else{a+=get_email(unescape_tag(jQuery(this).attr("data-addr")))+","}}})}return a}function checkSendInfoValue(c){var a=[];jQuery("#file_wrap li").each(function(){a.push({name:jQuery(this).attr("filename"),id:jQuery(this).attr("orgname"),size:jQuery(this).attr("filesize"),hostId:jQuery(this).attr("hostid")})});jQuery("#img_wrap li").each(function(){a.push({name:jQuery(this).attr("filename"),id:jQuery(this).attr("orgname"),size:jQuery(this).attr("filesize"),hostId:jQuery(this).attr("hostid"),fileattr:"go"})});var b={};b.subject=c.subject;b.toList=getEmailArray(c.to);b.ccList=(!c.cc||jQuery.trim(c.cc)=="")?null:getEmailArray(c.cc);b.bccList=(!c.bcc||jQuery.trim(c.bcc)=="")?null:getEmailArray(c.bcc);b.attachList=a;b.sendEmailCheckResult=c.sendEmailCheckResult;b.sendAttachCheckResult=c.sendAttachCheckResult;b.sendKeywordCheckResult=c.sendKeywordCheckResult;b.sendInfoCheck=c.sendInfoCheck;jQuery("#sendInfoCheck").append(getHandlebarsTemplate("mail_send_allow_check_content_tmpl",b))}function checkSendMessage(){var b=mailControl.getSendData();if(isSendInfoCheckUse){var a=getCheckSendInfoValue("to");if(!a||a.length==0){alert(mailMsg.mail_rcpt_to_noselect);return}settingWriteInfo();jQuery("#sendCheckLayer").hide()}sendMessageParamProcess(b)}function checkSendMessageCancel(){jQuery("#sendCheckLayer").hide();jQuery("#sendInfoCheck").children().remove()}function settingWriteInfo(){var c=getCheckSendInfoValue("to");var b=getCheckSendInfoValue("cc");var d=getCheckSendInfoValue("bcc");deleteAddressUnitFormatAll("to");deleteAddressUnitFormatAll("cc");deleteAddressUnitFormatAll("bcc");if(c&&c.length>0){for(var a=0;a<c.length;a++){makeAddressUnitFormat("to",c[a])}}if(b&&b.length>0){for(var a=0;a<b.length;a++){makeAddressUnitFormat("cc",b[a])}}if(d&&d.length>0){for(var a=0;a<d.length;a++){makeAddressUnitFormat("bcc",d[a])}}var e=mailControl.getSendData();e.to=c.reverse().join();e.cc=b.reverse().join();e.bcc=d.reverse().join();mailControl.setSendData(e);settingWriteInfoAttach()}function settingWriteInfoAttach(){var b=mailControl.getSendData();var a="";jQuery("#sendCheckLayer input[name=attachFile]").each(function(){if(jQuery(this).attr("checked")){var e=jQuery(this).val();var f=jQuery(this).attr("orgname");var c=jQuery(this).attr("filename");var d=jQuery(this).attr("filesize");var g=jQuery(this).attr("fileattr");if(g!=""){a+=f+"\t"+c+"\t"+d+"\t0\t"+g+"\n"}else{a+=f+"\t"+c+"\t"+d+"\n"}}else{var f=jQuery(this).attr("orgname");var c=jQuery(this).attr("filename");var d=jQuery(this).attr("filesize");var g=jQuery(this).attr("fileattr");jQuery("#img_wrap li[orgname='"+f+"']").remove()}});b.attachList=a;mailControl.setSendData(b)}function getCheckSendInfoValue(b){var a=new Array();jQuery("#sendCheckLayer input[name="+b+"Addr]:checked").each(function(){a.push(jQuery(this).val());a.reverse()});return a}function sendMessageParamProcess(d){var b=d.sendType;d.content=jQuery("#content").val();var c=folderControl.getQuotaInfo();if(Number(c.percent)>=100){if(b=="draft"){alert(mailMsg.mail_send_quotaover_draft);return}else{if(!confirm(mailMsg.mail_send_quotaover_confirm)){return}d.receiveNoti=false;d.saveSent=false}}else{if(jQuery("#receivenoti").attr("checked")){d.receiveNoti=true}if(jQuery("#onesend").attr("checked")){d.oneSend=true}}var a=mailMsg.mail_send_confirm;if(b=="draft"){a=mailMsg.mail_send_drafts_confirm}else{d.saveSent=true}d.mobileMail=true;d.forwardOrgText=jQuery("#forwardOrgText").val();d.replyOrgText=jQuery("#replyOrgText").val();if(!sendConfirm){d.attachList=getAttachString();mailControl.sendMessage(d)}else{if(confirm(a)){d.attachList=getAttachString();mailControl.sendMessage(d)}}}function getAttachString(){var a="";jQuery("#file_wrap li").each(function(){var e=jQuery(this).attr("orgname");var b=jQuery(this).attr("filename");var c=jQuery(this).attr("filesize");var d=jQuery(this).attr("hostid");a+=e+"\t"+b+"\t"+c+"\t"+d+"\n"});jQuery("#img_wrap li").each(function(){var e=jQuery(this).attr("orgname");var b=jQuery(this).attr("filename");var c=jQuery(this).attr("filesize");var d=jQuery(this).attr("hostid");var f="go";a+=e+"\t"+b+"\t"+c+"\t"+d+"\t0\t"+f+"\n"});return a}function goWrieLoad(a){if(!checkEscapeWriteMode()){return}mailControl.writeMessage(a)}function writeDraftMessage(b,a){goWrieLoad({wtype:"drafts",folderName:b,uids:[a]})}function loadMdnList(a){if(!checkEscapeWriteMode()){return}hideMailFolderSide();mailControl.loadMdnList(a)}function recallMsg(b){var d=jQuery("#mdnReadUid").val();var a=jQuery("#mdnMessageId").val();var c=jQuery("#mdnMessageSubject").val();if(!confirm(mailMsg.mail_mdn_confirm)){return}var e={};e.messageId=a;e.uid=d;e.subject=c;e.recallEmails=b;mailControl.recallMessage(e)}function toggleSearchMessageWrap(){jQuery("#goSearch").toggle();var b={};b.folderList=folderControl.getUserFolderList();jQuery("#detailSearchToggle").removeClass("on");jQuery("#searchDetail").handlebars("mail_search_detail",b);var a=mailControl.isMailAttachSearch();if(a){jQuery("#adAttachContentSearch").show()}mailControl.initSearchInfo();mailControl.preventBodyScroll();mailControl.searchResultSetHeight();mailControl.searchLayerInitScroll();mailControl.makeSearchEvent()}function openSearchMessageWrap(){var a=jQuery("#search_wrap");a.show();clearSearchTerm();openSearchOverlay()}function closeSearchMessageWrap(){var a=jQuery("#search_wrap");a.hide();closeSearchOverlay()}function simpleSearch(a){var d=jQuery("#commonSearchInput");if(d.val()==""){alert(mailMsg.mail_mobile_search_message);return}if(!validateSearchInput(d,2,64,"searchMail")){return}var b=jQuery.trim(d.val());var c=getSimpleSearchParam(b,a);mailControl.getSearchList(c,function(e){printSearchList(e);d.blur()})}function detailSearch(a){if(!validateAdSearchMessage()){return}var b=getDetailSearchParam();mailControl.getSearchList(b,function(c){printSearchList(c);jQuery("#detailSearchToggle").removeClass("on");jQuery("#commonSearchInput").blur()})}function moreSearchList(a){var b=a.param;b.page=a.pageInfo.nextPage;mailControl.getSearchList(b,function(c){printSearchMoreList(c)})}function printSearchList(b){var a={};a.total=b.total;a.messageList=b.messageList;jQuery("#simpleSearchWrap, #detailSearchWrap").hide();jQuery("#searchResultWrap").show();jQuery("#searchResultWrap").handlebars("mail_search_list_wrap",a);mailControl.makeSearchResultEvent()}function printSearchMoreList(a){jQuery("#searchResultWrap ul").append(getHandlebarsTemplate("mail_search_list",a.messageList));mailControl.makeSearchResultEvent()}function getSimpleSearchParam(b,a){var c={adv:"on",category:"",edate:"",flag:"",folder:"all",listType:"mail",fromaddr:"",keyWord:"",sdate:"",searchExtFolder:"off",toaddr:""};if(a=="all"){c={folder:a,keyWord:b}}else{if(a=="fromaddr"){c.fromaddr=b}else{if(a=="toaddr"){c.toaddr=b}else{if(a=="subject"){c.category="s";c.keyWord=b}}}}return c}function getDetailSearchParam(){var f=jQuery.trim(jQuery("#adFolderName").val());var d=jQuery.trim(jQuery("#fromaddr").val());var c=jQuery.trim(jQuery("#toaddr").val());var b="";jQuery("#adSearchCondWrap input:checked").each(function(){b+=jQuery(this).val()});var a=jQuery.trim(jQuery("#adSearchKeyWord").val());var e={adv:"on",category:b,edate:"",sdate:"",flag:"",folder:f,fromaddr:d,keyWord:a,listType:"mail",searchExtFolder:"off",toaddr:c};return e}function validateAdSearchMessage(){var e=jQuery.trim(jQuery("#fromaddr").val());var c=jQuery.trim(jQuery("#toaddr").val());var b=jQuery.trim(jQuery("#adSearchKeyWord").val());if(e==""&&c==""&&b==""){alert(mailMsg.mail_mobile_search_message);return false}if(b!=""&&jQuery("#adSearchCondWrap input[type=checkbox]:checked").length<1){alert(mailMsg.mail_search_valid_checkbox);return false}if(b==""&&jQuery("#adSearchCondWrap input[type=checkbox]:checked").length>=1){alert(mailMsg.mail_mobile_search_message);return false}var f=[{id:"fromaddr"},{id:"toaddr"},{id:"adSearchKeyWord"}];var a=f.length;for(var d=0;d<a;d++){if(!validateSearchInput(jQuery("#"+f[d].id),2,64,"searchMail")){return false}}return true}function openSearchOverlay(){jQuery("#popSearchOverlay").remove();jQuery('<div id="popSearchOverlay" class="overlay" />').appendTo(".go_wrap").click(function(a){closeSearchMessageWrap(a)})}function closeSearchOverlay(){jQuery("#popSearchOverlay").remove()}function searchMessage(){var a=jQuery("#search_keyword");keyWord=jQuery.trim(a.val());if(keyWord==""){alert(mailMsg.alert_search_nostr);a.focus();return}if(!validateInput(a,2,64,"searchMail")){return}if(!checkEscapeWriteMode()){return}if(mailControl.getListMode()=="mdnlist"){var c={pattern:keyWord};loadMdnList(c)}else{if(mailControl.getListMode()=="mdnread"){var b=jQuery("#mdnReadUid").val();var c={pattern:keyWord,uid:b};mailControl.loadMdnRead(c)}else{var c={folder:"all",keyWord:keyWord};mailControl.searchMessage(c)}}closeSearchMessageWrap()}function searchMessageCancel(){jQuery("#search_keyword").val("")}function searchGoMessage(){if(currentMenu=="addr"){searchAddr()}else{searchMessage()}}function checkEmailInvalidAddress(e){var c=getEmailArray(e);for(var d=0;d<c.length;d++){var a=c[d];a=jQuery.trim(a);var b=get_email(a);if(b.charAt(0)=="$"||b.charAt(0)=="&"||b.charAt(0)=="+"||b.charAt(0)=="#"){continue}if(a==""||isEmail(b)){continue}else{alert(mailMsg.alert_invalidaddress+"\n\n"+a);return false}}return true}function selectAttachPhoto(){jQuery("#subject").blur();jQuery("#content").blur();jQuery("#attachOverlay").touchstart(function(){closeAttachPhoto()}).show();jQuery("#attachLayer").show()}function closeAttachPhoto(){jQuery("#attachLayer").hide();jQuery("#attachOverlay").hide()}function makeCopyMoveContent(){var a=folderControl.getUserFolderList();jQuery("#mail_move_folder_list").empty();jQuery("#mail_move_folder_list").handlebars("mail_folder_selectbox_tmpl",a)}function makeTagListContent(){var a=folderControl.getTagData();jQuery("#mail_tag_message_list").empty();jQuery("#mail_tag_message_list").handlebars("mail_tag_page_tmpl",a)}function copyMoveMessage(c){var b=getMailListCheckedIdArray();var d=getListProcessParams(b);var a={fromFolders:d.fnames,uids:d.uids,toFolder:c};mailControl.moveMessage(a)}function tagMessage(d,b){var c=getMailListCheckedIdArray();var e=getListProcessParams(c);var a={addFlag:b,tagId:d,folderNames:e.fnames,uids:e.uids};mailControl.taggingMessage(a)}function writeAddrSelect(){var a=getCookie("ContactViewTypeMobile");a=(a)?a:"user";changeWriteAddrSelect(a);jQuery("select.addr_select").trigger("change")}function changeWriteAddrSelect(a){var b=jQuery("#writeAddrSelect").val(a);b.val(a);jQuery("#writeAddrLink span.txt").text(b.find("option:selected").text())}function changeMailWriteMode(){changeMailContainer("write");makeTopMenuTitle(MAIL_APP_NAME);checkCcBccRcptArea()}function closeAddressContent(){jQuery("#addr_content").hide();jQuery("#go_content").show();jQuery("#main_content").addClass("write")}function makeAddrSelectItem(b,c){var a=null;if(jQuery("#writeAddrSelect").val()==="emp"){addSelectedMemberInReceiverList(b,c)}else{a=jQuery("#addr_member_list input[name=addrEmail]:checked");jQuery(a).each(function(){var e=jQuery(this).data("name");var g=jQuery(this).data("position");var f=jQuery(this).data("department");var d=jQuery(this).data("email");makeAddressUnitFormat(b,getEmailInfoFormat(e,g,f,d))})}checkCcBccRcptArea();if(c.length===0&&(!a||a.length==0)){alert(mailMsg.comn_error_001);return}setTimeout(function(){alert(mailMsg.addr_list_write_insert_success)},200)}function closeWebFolder(){jQuery(window).off("scroll.renderNewWebFolderPage");jQuery("#webfolder_content").hide();jQuery("#mailWriteToolbarWrap").show();jQuery("#go_content").show()}function goParentWebFolder(){jQuery("#moveParentWebFolder").trigger("click")}function checkUploadfile(a){var b,g,d,e,c,f;_.each(a,function(h){e=h.upkey;b=h.name;g=h.extension;d=h.size;f=h.hostId;c=(h.uid)?h.uid:"";addlist(b,g,d,e,f,c)})}function addlist(c,i,k,j,g,f){var e="normal";var a=MAILCONFIG.maxAttachSize;var b=parseInt(k)/1024/1024;var h=b;jQuery("#attach_wrap li").each(function(){h+=jQuery(this).attr("filesize")/1024/1024});if(a<h){alert(msgArgsReplace(mailMsg.mail_attach_limit_size,[a]));return}var d={};d.data={filePath:j,fileSize:k,fileName:c,hostId:g,uid:f,type:e,notChage:true,fileExt:i,thumbnail:"/thumb/temp/"+g+"/small"+j};attachFileSuccess(d);return true}function changeMailWriteAddrType(d,e,b,a){var d=(!d)?"user":d;setCookie("ContactViewTypeMobile",d,365);var c;if(d==="company"){c={groupId:b,isReadable:a}}else{if(d==="department"){c={deptId:b}}}mailControl.writeAddrSelect(jQuery.extend({ownerType:d,isInit:e},c))}function searchAddrCancel(){jQuery("#search_keyword").val("")}function searchAddr(){var a=jQuery("#addrSearchText");var e=jQuery.trim(a.val());if(e==""){alert(mailMsg.alert_search_nostr);a.focus();return}if(!validateInput(a,2,64,"onlyBack")){return}var b=mailControl.getAddrParam();var d=(b&&b.ownerType)?b.ownerType:"user";var c={ownerType:d};c.searchType="or";c.keyword=e;c.isReadable=(b&&b.isReadable)?b.isReadable:false;mailControl.writeAddrSelect(c)}function clearSearchTerm(){var a=jQuery("#search_keyword");a.val("");a.focus();a.bind("focusout",function(){this.focus();this.trigger("tap")});setTimeout(function(){a.off("focusout")},300)}function goSharedFolder(c,a){if(!checkEscapeWriteMode()){return}hideMailFolderSide();var b={folder:c,sharedFlag:"shared",sharedUserSeq:a,sharedFolderName:c};mailControl.loadMessageList(b)}function moveMessagePage(){makeCopyMoveContent();changeMailContainer("moveFolder")}function tagMessagePage(){makeTagListContent();changeMailContainer("tag")}function doDraftSave(){isAutoSave=true;var d={};d=makeRcptForm(d);var c=jQuery("#editorMode").data("mode");var b;b=jQuery("#content").val();d.subject=jQuery("#subject").val();d.sendType="draft";var a=mailControl.getSendData();d.draftMessageId=a.draftMessageId;d.sendFlag=a.sendFlag;d.writeMode=c;d.uids=a.uids;d.folderName=a.folder;d.charset=a.charset;d.massMode=false;d.content=b;d.mobileMail=true;d.forwardOrgText=jQuery("#forwardOrgText").val();d.replyOrgText=jQuery("#replyOrgText").val();d.attachList=getAttachString();mailControl.sendMessage(d)}function openDownloadAttachConfirm(){jQuery("#attachFileWrap").attr("evt-confirm",true);jQuery("#downloadAttachConfirmCheck").html(getHandlebarsTemplate("mail_attach_download_confirm_tmpl"));jQuery("#attachDownloadConfirmSubject").text(jQuery("#readSubject").text());jQuery("#attachFileCount").text(jQuery("#mailViewContentWrap div.add_file_header span.num").text());jQuery("#attachDownloadConfirmItemWrap").empty();jQuery("#attachFileWrap li").each(function(){var a={};a.name=jQuery(this).attr("fileName");a.css=jQuery(this).find("span.ic_file").attr("class");a.size=jQuery(this).find("span.size").text();a.realsize=jQuery(this).attr("filesize");a.part=jQuery(this).attr("part");jQuery("#attachDownloadConfirmItemWrap").append(getHandlebarsTemplate("mail_attach_download_confirm_item_tmpl",a))});jQuery("#attachOverlay").show();jQuery("#downloadAttachConfirmLayer").show()}function checkSendMailCount(e){if(!isMaxSendMailCountUse||e.sendType=="draft"){return true}makeProcessLoader();var a=0;var c=true;jQuery.ajax({type:"POST",url:"/api/mail/recipientcount",data:{to:e.to,cc:e.cc,bcc:e.bcc},async:false,success:function(f){a=f.data;removeProcessLoader()},error:function(){c=false;removeProcessLoader()},dataType:"json"});if(!c){return false}var d="";if(e.sendType=="reserved"){d=e.reservedDateUtc}var b=0;jQuery.ajax({type:"POST",url:"/api/mail/sendmailcount",data:{sendType:e.sendType,reservedDateUtc:d},async:false,success:function(f){b=f.data},dataType:"json"});if((a+b)>maxSendMailCount){alert(mailMsg.mail_max_send_message_001);return false}return true}function addSelectedMemberInReceiverList(b,c){var a=[];_.each(c,function(f){var d=null;var e=f.type.toLowerCase();if((e!=="department"&&e!=="org")||((e==="department"||e==="org")&&f.email!=="")){d=true}if(d){a.push(f)}else{jQuery.ajax({type:"GET",url:"/api/organization/multi/list",async:false,data:{deptid:f.id,type:"child"},dataType:"json",success:function(g){_.each(g,function(i){var h=_.extend(i.metadata,{department:i.metadata.deptName});a.push(h)})}})}});_.each(a,function(d){var f=_.isUndefined(d.department)?d.departments:d.department;var e=getEmailInfoFormat(d.name,d.position,f,d.email);makeAddressUnitFormat(b,e)})};