function initService(){initMailLayout(),folderControl.getFolderAllInfo(),folderControl.getBookmarkInfo(),folderControl.makeEvent(),mailControl.makeMailEvent(),isFirstLoad=!0;var e=!1;if(workAction=="write"){e=!0;var t={};writeToList&&(t.to=unescape_tag_title(writeToList)),wtype&&(t.wtype=wtype,t.wuid=wuid,t.folderName=folder,t.wfolderType=wfolderType,t.wfolderShareSeq=wfolderShareSeq),goWrieLoad(t),isPopupWrite&&mailControl.loadMessageList()}else if(workAction=="read"){isNotFoundError=="true"&&(jQuery.goAlert("",mailMsg.mail_sid_not_found_alert),mailControl.loadMessageList());if(workFolder&&workFolder!=""&&workUid&&Number(workUid)>0){workFolder=decodeURIComponent(workFolder);var t={};quickType&&quickType!=""?t=getFolderExecuteParam(quickType):t.folder=unescape_tag_title(workFolder),parseInt(initPage,10)>1&&(t.page=initPage),mailControl.loadMessageList(t,!0,!0),e=!0,readMessage(unescape_tag_title(workFolder),workUid)}}else workAction=="list"?(isShareFolder?goSharedFolder(workFolder,workUid):goFolder(workFolder),e=!0):workAction=="quick"&&(folderExecute(workFolder),e=!0);e||mailControl.loadMessageList(),jQuery("#mailSearchKeyWord").placeholder()}function setMailAppName(){jQuery("#mailAppNameLink").text(currentAppName)}function initMailFunction(){layoutControl=new LayoutControl,folderControl=new FolderControl,mailControl=new MailControl,historyControl=new HistoryControl(mailHistoryCallBack)}function initMailLayout(){layoutControl.makeLayout(storeLayoutMode),layoutMode=layoutControl.getContentSplitterMode()}function goFolder(e,t){checkEscapeWriteMode(function(){var n={folder:e};n.sharedFlag="user",t&&(n.flag=t);if(e!="Drafts"){var r=layoutControl.getContentSplitterMode();r=r?r:"n",layoutControl.contentSplitterChange(r)}else layoutControl.contentNormalSplitter();mailControl.loadMessageList(n),hideSearchCancelBtn()})}function writeDraftMessage(e,t){goWrieLoad({wtype:"drafts",folderName:e,uids:[t]})}function readMessage(e,t){var n={folder:e,uid:t};mailControl.readMessage(n),layoutMode!="n"&&ReadSubMessageChecker.hasCurrentItem()&&ReadSubMessageChecker.currentUid!=t&&changeFlagView(!0,"S",[e+"_"+t])}function readMessagePopup(e,t){currentMenu=="list"&&changeFlagView(!0,"S",[e+"_"+t]);var n={};n.folder=e,n.uid=t,n.folderType=currentFolderType,n=mailControl.getSharedFolderParam(n),n.action="read",n.popupWrite=isPopupWrite,POPUPDATA=n;var r="popupRead"+makeRandom();POPUPDATA.wname=r,window.open("/app/mail/popup",r,"scrollbars=yes,resizable=yes,width=1280,height=640")}function reloadMessagePopup(){var e="";POPUPDATA.action=="read"&&(e=POPUPDATA.wname),window.open("/app/mail/popup",e)}function reloadMessageList(){mailControl.reloadMessageList()}function downloadAttach(e,t,n){var r={folderName:e,uid:t,part:n,type:"normal"};r=mailControl.getSharedFolderParam(r),mailControl.downloadAttachFile(r)}function downloadAllAttach(e,t,n){var r={folderName:e,uid:t,part:n};r=mailControl.getSharedFolderParam(r),mailControl.downloadAllAttachFile(r)}function downLoadTnefAttach(e,t,n,r){var i={folderName:e,uid:t,part:n,type:"tnef",tnefKey:r};i=mailControl.getSharedFolderParam(i),mailControl.downloadTnefAttachFile(i)}function deleteAttachFile(e,t,n){jQuery.goConfirm(mailMsg.mail_del_attach,mailMsg.confirm_delete,function(){jQuery("#gpopupLayer").hide(),jQuery(this)[0].autoclose=!1,makeProcessLoader();var r={folderName:e,uid:t,part:n};mailControl.removeAttachFile(r)})}function deleteAllAttach(e,t,n){jQuery.goConfirm(mailMsg.mail_attach_delete_all,mailMsg.confirm_delete,function(){jQuery("#gpopupLayer").hide(),jQuery(this)[0].autoclose=!1,makeProcessLoader();var r={folderName:e,uid:t,part:n};mailControl.removeAttachFile(r)})}function deleteMessageAttaches(){var e=getMailListCheckedIdArray(),t=getListProcessParams(e),n={folderNames:t.fnames,uids:t.uids};jQuery.goConfirm(mailMsg.mail_del_attach,mailMsg.confirm_delete,function(){jQuery("#gpopupLayer").hide(),jQuery(this)[0].autoclose=!1,makeProcessLoader(),mailControl.removeAllAttachesFromMessage(n)})}function readNestedMessage(e,t,n){var r={};r.folderName=e,r.uid=t,r.part=n,r.action="nestedRead",r=mailControl.getSharedFolderParam(r),POPUPDATA=r;var i="popupRead"+makeRandom();window.open("/app/mail/popup",i,"scrollbars=yes,resizable=yes,width=800,height=640")}function readRelationMessage(e,t,n){mailControl.readRelationMessage(n)}function goSharedFolder(e,t){checkEscapeWriteMode(function(){var n={folder:e,sharedFlag:"shared",sharedUserSeq:t,sharedFolderName:e};mailControl.loadMessageList(n)})}function addFolder(e){var t=null;e&&(t={top:e.top,left:e.left+90});var n=folderControl.getUserFolderList();jQuery.goPopup({id:"mail_add_folder_popup",pclass:"layer_normal layer_add_mailbox",header:mailMsg.mail_folder_add,width:300,contents:getHandlebarsTemplate("mail_add_folder_tmpl",n),offset:t,openCallback:function(){jQuery("#mail_add_folder_popup div.content").on("click","input",function(e){var t=jQuery(this).attr("evt-rol");t=="add-folder-select-parent"&&(jQuery(this).attr("checked")?(jQuery("#addFolderParentSelect").attr("disabled",!1),jQuery("#addFolderParentSelect").removeClass("inactive")):(jQuery("#addFolderParentSelect").attr("disabled",!0),jQuery("#addFolderParentSelect").addClass("inactive")))})},closeCallback:function(){jQuery("#mail_add_folder_popup div.content").off()},buttons:[{btype:"confirm",btext:mailMsg.comn_confirm,autoclose:!1,callback:saveMailFolder},{btype:"cancel",btext:mailMsg.comn_cancel}]})}function addSubFolder(e){var t={folderName:e};jQuery.goPopup({id:"mail_add_subfolder_popup",pclass:"layer_normal layer_add_mailbox",header:mailMsg.mail_subfolder_add,width:300,contents:getHandlebarsTemplate("mail_add_subfolder_tmpl",t),buttons:[{btype:"confirm",btext:mailMsg.comn_confirm,autoclose:!1,callback:saveSubMailFolder},{btype:"cancel",btext:mailMsg.comn_cancel}]})}function saveMailFolder(){if(!validateInputValue(jQuery("#newMailFolderName"),2,32,"folderName"))return;var e=jQuery.trim(jQuery("#newMailFolderName").val());if(isDefaultBoxCheck(e)){jQuery.goMessage(mailMsg.alert_systemfolder);return}var t="";jQuery("#newParentSelectCheck").attr("checked")&&(t=jQuery("#addFolderParentSelect").val()),e=t==""?e:t+"."+e;var n={folderName:e};folderControl.addFolder(n),jQuery.goPopup.close()}function saveSubMailFolder(){if(!validateInputValue(jQuery("#subMailFolderName"),2,32,"folderName"))return;var e=jQuery("#subMailFolderName").val(),t=jQuery("#subMailFolderName").attr("folder"),n=t+"."+e;if(strByteLength(n)>255){jQuery.goSlideMessage(mailMsg.mail_newfolder_error,"caution");return}var r={folderName:n};folderControl.addFolder(r),jQuery.goPopup.close(),makeProcessLoader()}function modifyFolder(e){var t={folderName:e};jQuery.goPopup({id:"mail_modify_folder_popup",pclass:"layer_normal layer_add_mailbox",header:mailMsg.mail_folder_modify,width:300,contents:getHandlebarsTemplate("mail_modify_folder_tmpl",t),buttons:[{btype:"confirm",btext:mailMsg.comn_confirm,autoclose:!1,callback:modifySaveFolder},{btype:"cancel",btext:mailMsg.comn_cancel}]})}function moveFolder(e){var t={folderName:e},n={},r=e,i="";ActionLoader.getGoLoadAction(folderControl.folderAllInfoAction,n,function(e){var t=e.userFolders;t.isInbox=!0,jQuery.goPopup({id:"mail_move_folder_popup",pclass:"layer_normal layer_select layer_mailbox_detail ",header:mailMsg.mail_folder_move_header,contents:getHandlebarsTemplate("mail_move_folder_popup_tmpl"),openCallback:function(){jQuery("#preMailFolderName").val(r),jQuery("#selectMailFolderPopup").on("click","a,span,ins,li,p",function(e){var t=jQuery(this).attr("evt-rol");if(!t)return;e.stopPropagation?e.stopPropagation():e.cancelBubble=!0,e.preventDefault();if(t=="toggle-mail-folder"){var n=jQuery(this).attr("status"),r=jQuery(this).attr("fid"),s=jQuery(this).closest("li").attr("depth");s=parseInt(s,10);var o=jQuery(this).closest("li").find("ul[depth='"+(s+1)+"']"),u="O";n=="open"?(o.hide(),jQuery(this).removeClass("close").addClass("open").attr({status:"close",title:mailMsg.comn_open}),u="C"):(o.show(),jQuery(this).removeClass("open").addClass("close").attr({status:"open",title:mailMsg.comn_close}))}else t=="folder"?(i=jQuery(this).find("a").attr("fname"),jQuery("#selectMailFolderPopup p").each(function(e){jQuery(this).hasClass("title on")&&jQuery(this).removeClass("on")}),jQuery("#selectMailFolderPopup h1.mail").hasClass("on")&&jQuery("#selectMailFolderPopup h1.mail").removeClass("on"),jQuery(this).addClass("on"),jQuery("#newMailFolderName").val(i)):t=="select-root"&&(i="",jQuery("#newMailFolderName").val(i),jQuery("#selectMailFolderPopup p").each(function(e){jQuery(this).hasClass("title on")&&jQuery(this).removeClass("on")}),jQuery(this).parent().addClass("on"))})},buttons:[{btype:"confirm",btext:mailMsg.comn_confirm,autoclose:!1,callback:moveSaveFolder},{btype:"cancel",btext:mailMsg.comn_cancel}]}),t.isInbox=!0;var n=jQuery("#inbox_folder_popup_area");n.handlebars("mail_user_folder_popup_tmpl",t);var s=jQuery("#inbox_toggle_popup_btn");n.find("li.folder").length>0?(status=="C"?(s.addClass("open").removeClass("close").attr({status:"close",title:mailMsg.comn_open}),n.hide()):(s.addClass("close").removeClass("open").attr({status:"open",title:mailMsg.comn_close}),n.show()),s.show()):s.hide(),t.isInbox=!1,jQuery("#uf_folder_popup_area").handlebars("mail_user_folder_popup_tmpl",t),jQuery("#selectMailFolderPopup span").each(function(e){if(jQuery(this).attr("status")!=null){var t=jQuery(this).closest("li").attr("depth");t=parseInt(t,10);var n=jQuery(this).closest("li").find("ul[depth='"+(t+1)+"']");n.show(),jQuery(this).removeClass("open").addClass("close").attr({status:"open",title:mailMsg.comn_close})}}),jQuery("#selectMailFolderPopup a").each(function(e){jQuery(this).attr("fname")==r&&jQuery(this).parent().addClass("title_selected")})},"json")}function moveSaveFolder(){var e=jQuery("#newMailFolderName"),t=jQuery("#preMailFolderName"),n=jQuery(".title_selected").parent().find("p a"),r=new Array(n.length);jQuery(".title_selected").parent().find("p a").each(function(e){r[e]=jQuery(this).attr("fname")}),checkMoveFolderName(e,t,n)}function checkMoveFolderName(e,t,n){var r=new Array(n.length);n.each(function(e){r[e]=jQuery(this).attr("fname")});var i=t.val().substring(t.val().lastIndexOf(".")+1),s=t.val().substring(0,t.val().lastIndexOf(".")+1),o=e.val()+".";e.val()==""&&(o="");var u=o+i,a=t.val(),f=e.val().split("."),l=t.val().split("."),c=strByteLength(u);if(c>255){jQuery.goSlideMessage(mailMsg.mail_folder_move_message_001,"caution");return}var h=new Array(r.length);for(var p=0;p<r.length;p++)h[p]=strByteLength(r[p]);var d=h[0];for(var p=0;p<h.length;p++){var v=h[p]-d;if(parseInt(c)+v>255){jQuery.goSlideMessage(mailMsg.mail_folder_move_message_001,"caution");return}}var m=!1;if(f.length>l.length){for(var p=0;p<l.length;p++){if(f[p]==l[p]){m=!0;continue}m=!1;break}if(m){jQuery.goSlideMessage(mailMsg.mail_folder_move_message_002,"caution");return}}if(e.val()==a){jQuery.goSlideMessage(mailMsg.mail_folder_move_message_003,"caution");return}var g={previousName:t.val(),newName:u};folderControl.modifyFolder(g),jQuery.goPopup.close()}function modifySaveFolder(){var e=jQuery("#modifyMailFolderName");if(!validateInputValue(e,2,32,"folderName"))return;var t=e.attr("folder"),n="";t.indexOf(".")>0&&(n=t.substring(0,t.lastIndexOf(".")+1));var r=jQuery.trim(e.val()),i=e.data("folder-name");if(r==i){jQuery.goPopup.close();return}r=n+""+r;var s=r,o=n+""+i,u=strByteLength(r);if(u>255){jQuery.goSlideMessage(mailMsg.mail_folder_move_message_001,"caution");return}var a=new Array(childrenFnameForModify.length);for(var f=0;f<childrenFnameForModify.length;f++)a[f]=strByteLength(childrenFnameForModify[f]);var l=a[0];for(var f=0;f<a.length;f++){var c=a[f]-l;if(parseInt(u)+c>255){jQuery.goSlideMessage(mailMsg.mail_folder_move_message_001,"caution");return}}if(isDefaultBoxCheck(r)){jQuery.goMessage(mailMsg.alert_systemfolder);return}var h={previousName:t,newName:r};folderControl.modifyFolder(h),jQuery.goPopup.close(),childrenFnameForModify=null}function bookmarkManage(){var e=jQuery("#mail_bookmark_wrap");e.data("content",e.html()),e.hasClass("lnb_edit")||e.addClass("lnb_edit"),e.find("span.btn_wrap").show(),jQuery("#mail_bookmark_list").find("p.on").attr("data-on","true").removeClass("on"),jQuery("#mail_bookmark_list").sortable({start:function(e,t){jQuery(t.helper).addClass("move")},beforeStop:function(e,t){jQuery(t.helper).removeClass("move")}}).sortable("enable"),jQuery("#mail_bookmark_list").disableSelection(),jQuery("#mail_bookmark_btn_normal").hide(),jQuery("#mail_bookmark_btn_modify").show()}function bookmarkCancel(){var e=jQuery("#mail_bookmark_wrap");e.find("span.btn_wrap").hide(),e.html(e.data("content")),e.hasClass("lnb_edit")&&e.removeClass("lnb_edit"),jQuery("#mail_bookmark_list").sortable("disable"),jQuery("#mail_bookmark_list").find("p[data-on=true]").addClass("on")}function bookmarkModify(){var e=[];jQuery("#mail_bookmark_list li").each(function(){e.push(jQuery(this).attr("seq"))});var t={bookmarkSeqArray:e};folderControl.updateBookmark(t),jQuery("#mail_bookmark_list span.btn_wrap").hide();var n=jQuery("#mail_bookmark_wrap");n.hasClass("lnb_edit")&&n.removeClass("lnb_edit"),jQuery("#mail_bookmark_btn_modify").hide(),jQuery("#mail_bookmark_btn_normal").show(),jQuery("#mail_bookmark_list").sortable("disable");if(isBookmark&&(currentMenu=="list"||currentMenu=="read")){var r=!1;jQuery("#mail_bookmark_list li").each(function(){var e=jQuery(this).attr("type"),t=jQuery(this).attr("query");e==bookmarkType&&t==bookmarkValue&&(r=!0)}),r||folderControl.changeBookmarkFlag(!1)}}function bookmarkExecute(e,t,n){checkEscapeWriteMode(function(){var r={};if(t=="tag")r.listType=t,r.tagId=n;else{r.folder="all",r.extFolder="on",t=="unseen"?r.flag="U":t=="today"?(r.adv="on",r.sdate="TODAYS",r.edate="TODAYE"):t=="yesterday"?(r.adv="on",r.sdate="YESTERDAYS",r.edate="YESTERDAYE"):t=="flaged"?r.flag="F":t=="seen"?r.flag="S":t=="attach"?r.flag="T":t=="reply"?r.flag="A":t=="myself"?r.flag="L":(r.folder=n,r.extFolder="off"),r.extType=t;if(n!="Drafts"){var i=layoutControl.getContentSplitterMode();i=i?i:"n",layoutControl.contentSplitterChange(i)}else layoutControl.contentNormalSplitter()}r.bookmarkSeq=e,mailControl.loadMessageList(r)})}function folderExecute(e){checkEscapeWriteMode(function(){var t=getFolderExecuteParam(e),n=layoutControl.getContentSplitterMode();n=n?n:"n",layoutControl.contentSplitterChange(n),mailControl.loadMessageList(t)})}function getFolderExecuteParam(e){var t={};return e=="unseen"?t.flag="U":e=="today"?(t.adv="on",t.sdate="TODAYS",t.edate="TODAYE"):e=="yesterday"?(t.adv="on",t.sdate="YESTERDAYS",t.edate="YESTERDAYE"):e=="flaged"?t.flag="F":e=="seen"?t.flag="S":e=="attach"?t.flag="T":e=="reply"?t.flag="A":e=="myself"&&(t.flag="L"),t.folder="all",t.extFolder="on",t.extType=e,t}function addMailTag(e,t){var n=folderControl.getTagData();if((!e||e.type!="modify")&&n&&n.length>=300){jQuery.goMessage(mailMsg.mail_tag_insert_limit);return}var r=null;t&&(t.sideTop=="sideTop_mail"?r={top:t.top-300,left:t.left+120}:r={top:t.top,left:t.left+120}),jQuery.goPopup({id:"mail_tag_popup",pclass:"layer_normal layer_add_tag",header:mailMsg.mail_tag_add,contents:getHandlebarsTemplate("mail_tag_add_tmpl",e),offset:r,openCallback:function(){jQuery("#mail_tag_popup div.layer_pallete").on("click","a",function(e){jQuery("#mail_tag_popup div.layer_pallete a").removeClass("active"),jQuery(this).addClass("active")})},closeCallback:function(){jQuery("#mail_tag_popup div.layer_pallete").off()},buttons:[{btype:"confirm",btext:mailMsg.comn_confirm,autoclose:!1,callback:saveMailTag},{btype:"cancel",btext:mailMsg.comn_cancel}]})}function saveMailTag(){if(!validateInputValue(jQuery("#tag_name_input"),2,32,"folderName"))return;var e=jQuery.trim(jQuery("#tag_id_hidden").val()),t=jQuery.trim(jQuery("#tag_name_input").val()),n=jQuery("#mail_tag_popup div.layer_pallete a.active").attr("color"),r={tagName:t,tagColor:n};if(e!=""){r.oldId=e;if(isExistTagName(t,e)){jQuery.goMessage(mailMsg.alert_tag_samename);return}folderControl.modifyTag(r)}else{if(isExistTagName(t)){jQuery.goMessage(mailMsg.alert_tag_samename);return}folderControl.addTag(r)}jQuery.goPopup.close()}function deleteMailTag(e){jQuery.goConfirm(mailMsg.mail_tag_delete,mailMsg.mail_tag_delete_confirm,function(){folderControl.delTag(e),isFolderManageMenu()&&mailSettingControl.loadViewFolderManage()})}function checkEscapeWriteMode(e,t){currentMenu=="write"?isWriteModify()?jQuery.goConfirm("",mailMsg.confirm_escapewrite,function(){clearTimeout(writeAutoSave),clearTimeout(autoSaveTimeTerm),deleteAllHugeFile(),destroyBasicUploadControl(),destroyMassUploadControl(),destoryEditorControl(),hideAutoComplate(),jQuery.goPopup.close(),e&&e()},function(){t&&t()}):(clearTimeout(writeAutoSave),clearTimeout(autoSaveTimeTerm),destroyBasicUploadControl(),destroyMassUploadControl(),destoryEditorControl(),hideAutoComplate(),jQuery.goPopup.close(),e&&e()):e&&e()}function writePreview(){var e=mailControl.getSendData(),t=makeRcptForm();t.writeMode=jQuery("#editorMode").data("mode"),t.subject=jQuery("#subject").val(),t.content=getMessageContent("preview"),t.letterSeq=e.letterSeq?e.letterSeq:"";var n=jQuery("#senderMode");if(n.length>0&&n.val()=="on"){var r=jQuery("#senderUserEmail :selected").val();t.senderName=get_name(r),t.senderEmail=get_email(r)}else t.senderName=e.senderName,t.senderEmail=e.senderEmail;t.attachList=getPreviewAttachString();var i=jQuery("#signSelect").val();i&&i>0?(t.attachSign=!0,t.signSeq=i):(t.attachSign=!1,t.signSeq=""),t.bannerDisplay=e.bannerDisplay,t.bannerContent=e.mailBanner?e.mailBanner.content:null,t.action="writePreview",POPUPDATA=t,window.open("/app/mail/popup","previewPopup","resizable=yes,scrollbars=yes,width=850,height=700")}function isWriteModify(){var e=jQuery("#editorMode").data("mode"),t="";try{var n=!1;if(editorControl==null)return!1;if(e=="html"){if(!editorControl.oEditor.validate())return jQuery.goError(mailMsg.mail_mime_size_exceed),!1;try{t=getHtmlMessage("ascheck")}catch(r){}}else t=jQuery.trim(getTextMessage());if(jQuery.trim(t)!="")return n=!0,n;if(getHugeFileUidList().length>0)return n=!0,n;if(!uploadAttachFilesComplete)return!0;getRcptFormCount()>0&&(n=!0)}finally{t=null}return n}function getMessageContent(e){var t=mailControl.getSendData(),n=!1,r=t.signLocation,i=jQuery("#editorMode").data("mode"),s,o,u,a;if(i=="html"){if(!editorControl.oEditor.validate())return jQuery.goError(mailMsg.mail_mime_size_exceed),!1;s=getHtmlMessage(e)}else s=getTextMessage();return e!="secure"&&e!="draft"&&(r=="inside"&&(i=="html"?(o="<signpos></signpos>",u=s.indexOf(o),u>-1&&(a=s.substring(0,u),s=a+s.substring(u,s.length),n=!0)):(o="--- Original Message ---",u=s.indexOf(o),u>-1&&(a=s.substring(0,u),s=a+s.substring(u,s.length),n=!0))),n||i=="html"),s}function goWriteSecureMail(){goWrite("expressE")}function goWrite(){secureWriteMode="normal",isOcxUpload=getCookie("OcxUpload")=="on"?!0:!1,isPopupWrite?goWriteWork():checkEscapeWriteMode(function(){goWriteWork()})}function goWriteWork(){var e=function(){var e={wtype:"normal"};isPopupWrite?popupWriteLoad(e):(layoutControl.contentNormalSplitter(),mailControl.writeMessage(e),hideSearchCancelBtn())},t=jQuery("#folder_link_Drafts span.num").text();isWriteNoti&&Number(t)>0?jQuery.goConfirm(mailMsg.conf_profile_74,mailMsg.confirm_draftswrite,function(){goFolder("Drafts")},function(){e()}):e()}function goWrieLoad(e){e=mailControl.getSharedFolderParam(e),isPopupWrite?popupWriteLoad(e):checkEscapeWriteMode(function(){var t=!1;try{t=isPopupView()}catch(n){t=!1}t?popupWriteLoad(e):(layoutControl.contentNormalSplitter(),mailControl.writeMessage(e),hideSearchCancelBtn())})}function switchFlagFlaged(e,t,n){var r=getListProcessParams(e);mailControl.switchMessagesFlags(r.uids,r.fnames,t,n)}function changeFlagView(e,t,n){var r,i;for(var s=0;s<n.length;s++){r=n[s];if(t=="F")i=jQuery("#"+getFolderNameId(r)).find('span[flag="F"]'),e?(i.removeClass("ic_important_off"),i.addClass("ic_important_on"),i.attr("flaged","on")):(i.removeClass("ic_important_on"),i.addClass("ic_important_off"),i.attr("flaged","off"));else if(t=="S"){var o=jQuery("#"+getFolderNameId(r));if(e){o.removeClass("read_no");var u=o.find("span.flagClass");u.hasClass("ic_noread_reply")?u.removeClass("ic_noread_reply").addClass("ic_read_reply"):u.hasClass("ic_read_no")?u.removeClass("ic_read_no").addClass("ic_read_yes"):u.hasClass("ic_noread_fw")&&u.removeClass("ic_noread_fw").addClass("ic_read_fw")}else if(!o.hasClass("read_no")){o.addClass("read_no");var u=o.find("span.flagClass");u.hasClass("ic_read_reply")?u.removeClass("ic_read_reply").addClass("ic_noread_reply"):u.hasClass("ic_read_yes")?u.removeClass("ic_read_yes").addClass("ic_read_no"):u.hasClass("ic_read_fw")&&u.removeClass("ic_read_fw").addClass("ic_noread_fw")}}}var a=mailControl.getListMode();t=="S"&&a=="mail"&&folderControl.updateFolderCountInfo()}function changeFlagReadView(e,t){if(t=="F"){var n=jQuery("#readFlagedFlagIcon");e?(n.removeClass("ic_important_off"),n.addClass("ic_important_on"),n.attr("flaged","on")):(n.removeClass("ic_important_on"),n.addClass("ic_important_off"),n.attr("flaged","off"))}}function searchMessage(e){var t=mailControl.getListMode(),n="";if(e)n=e;else{var r=jQuery("#mailSearchKeyWord");n=jQuery.trim(r.val());if(n==""){jQuery.goSlideMessage(mailMsg.alert_search_nostr,"caution"),r.focus();return}if(!validateInputValue(r,2,64,"searchMail"))return}checkEscapeWriteMode(function(){if(t=="mdnlist"){var e={pattern:n};mailControl.loadMdnList(e)}else if(t=="mdnread"){var r=jQuery("#mdnMessageId").val(),e={pattern:n,messageId:r};mailControl.loadMdnRead(e)}else{closeDetailSearchLayer();var i=mailControl.getCurrentFolder(),e={folder:i,keyWord:n};mailControl.searchMessage(e)}showSearchCancelBtn()})}function makeDetailSearchLayer(){mailControl.getSearchQueryList(),jQuery("#detailSearchLayerWrap").on("click","input,span,a",function(e){var t=jQuery(this).attr("evt-rol");if(!t)return;if(t=="select-saved-search"){var n=jQuery(this).closest("li").attr("query");checkEscapeWriteMode(function(){var e=unserialize(Base64TMS.decode(n));mailControl.loadMessageList(e),closeDetailSearchLayer()})}else if(t=="delete-saved-search"){var r=jQuery(this).closest("li").attr("uid"),i={searchQueryIds:[r]};mailControl.deleteSearchQuery(i)}else if(t=="save-search-folder"){if(jQuery("#detail_search_cond_area li").length>=15){jQuery.goAlert(mailMsg.mail_sfolder_save,mailMsg.mail_sfolder_insert_limit);return}openAdSearchMessageNamePopup()}else t=="close-search-folder"?closeDetailSearchLayer():t=="detail-mail-search"&&adSearchMessage()}),jQuery("#detailSearchLayerWrap").on("change","select",function(e){var t=jQuery(this).attr("evt-rol");if(t=="select-search-folder"){var n=jQuery(this).val();n=="all"?jQuery("#searchIncludeExtFolderWrap").show():(jQuery("#searchIncludeExtFolderWrap").hide(),jQuery("#searchIncludeExtFolder").attr("checked",!1))}}),jQuery("#detailSearchLayerWrap").on("keypress","input",function(e){e.which==13&&adSearchMessage()}),makeProcessLoader("mask")}function makeDetailUnifiedSearchLayer(){mailControl.getUnifiedSearchFolderList();var e=mailControl.isMailAttachSearch();e&&jQuery("#searchAttachContentsWrap").parents("div.vertical_wrap").show(),jQuery("#detailSearchLayerWrap").on("click","input,span,a",function(e){var t=jQuery(this).attr("evt-rol");if(!t)return;var n=jQuery("input:radio[name='searchPeriod']:checked").val(),r=moment(new Date).format("YYYY-MM-DDTHH:mm:ss.SSSZ"),i=moment("1970/01/01").format("YYYY-MM-DDTHH:mm:ss.SSSZ"),s=moment(new Date).format("YYYY-MM-DDTHH:mm:ss.SSSZ"),o="all";n=="-1"&&(i=moment(moment(r).clone().add("weeks",n)).format("YYYY-MM-DDTHH:mm:ss.SSSZ"),o="1w"),n=="-2"?(i=moment(moment(r).clone().add("weeks",n)).format("YYYY-MM-DDTHH:mm:ss.SSSZ"),o="2w"):n=="month"?(i=moment(moment(r).clone().add("months",-1)).format("YYYY-MM-DDTHH:mm:ss.SSSZ"),o="1m"):n=="directly"&&(i=moment(jQuery("#fromDate").val()).format("YYYY-MM-DDTHH:mm:ss.SSSZ"),s=moment(moment(jQuery("#toDate").val()).clone().add("days",1).subtract("seconds",1)).format("YYYY-MM-DDTHH:mm:ss.SSSZ"),o="");if(t=="search-period")jQuery("#fromDate").attr("disabled",!0),jQuery("#toDate").attr("disabled",!0);else if(t=="search-directly")jQuery("#fromDate").attr("disabled",!1),jQuery("#toDate").attr("disabled",!1);else if(t=="close-unified-search-folder")closeDetailSearchLayer();else if(t=="detail-unified-search"){var u=jQuery.trim(jQuery("#keyword").val());if(u=="")return jQuery.goSlideMessage(mailMsg.alert_search_nostr,"caution"),!1;if(!validateInputValue(jQuery("#keyword"),2,64,"searchMail"))return!1;if(jQuery("#fromDate").val()!=""||jQuery("#toDate").val()!=="")if(!checkDatePeriod(jQuery("#fromDate").val(),jQuery("#toDate").val()))return!1;isMsie8?window.top.window.location="/app/#unified/search?offset=5&page=0&stype=detail&keyword="+encodeURIComponent(jQuery("#keyword").val())+"&searchAttachContents="+jQuery("#searchAttachContents").is(":checked")+"&fromDate="+i+"&toDate="+s+"&searchTerm="+o:window.top.window.location="/app/unified/search?offset=5&page=0&stype=detail&keyword="+encodeURIComponent(jQuery("#keyword").val())+"&searchAttachContents="+jQuery("#searchAttachContents").is(":checked")+"&fromDate="+i+"&toDate="+s+"&searchTerm="+o,jQuery("#searchType").val("appSearch"),jQuery("#keyword").val("")}}),jQuery("#detailSearchLayerWrap").on("change","select",function(e){var t=jQuery(this).attr("evt-rol");if(t=="select-search-folder"){var n=jQuery(this).val();n=="all"?jQuery("#searchIncludeExtFolderWrap").show():(jQuery("#searchIncludeExtFolderWrap").hide(),jQuery("#searchIncludeExtFolder").attr("checked",!1))}}),jQuery("#detailSearchLayerWrap").on("keypress","input",function(e){e.which==13&&adSearchMessage()}),makeProcessLoader("mask")}function adSearchMessage(){if(!validateAdSearchMessage())return;checkEscapeWriteMode(function(){var e=getAdSearchMessageQuery();mailControl.loadMessageList(e),closeDetailSearchLayer(),showSearchCancelBtn()})}function validateAdSearchMessage(){var e=jQuery.trim(jQuery("#adFrom").val());if(e!=""&&!validateInputValue(jQuery("#adFrom"),2,64,"searchMail"))return!1;var t=jQuery.trim(jQuery("#adTo").val());if(t!=""&&!validateInputValue(jQuery("#adTo"),2,64,"searchMail"))return!1;var n=jQuery("#adStartDate").val(),r=jQuery("#adEndDate").val();if(n!=""||r!=="")if(!checkDatePeriod(n,r))return!1;var i=jQuery.trim(jQuery("#adSearchKeyWord").val());if(e==""&&t==""&&n==""&&r==""&&i=="")return jQuery.goMessage(mailMsg.alert_search_nostr),jQuery("#adSearchKeyWord").focus(),!1;if(i!=""&&!validateInputValue(jQuery("#adSearchKeyWord"),2,64,"searchMail"))return;return!0}function getAdSearchMessageQuery(){var e=jQuery.trim(jQuery("#adFolderName").val()),t=jQuery("#searchIncludeExtFolder").attr("checked")?"on":"off",n=jQuery.trim(jQuery("#adFrom").val()),r=jQuery.trim(jQuery("#adTo").val()),i="";jQuery("#adSearchCondWrap input:checked").each(function(){i+=jQuery(this).val()});var s=jQuery.trim(jQuery("#adSearchKeyWord").val()),o=jQuery("#adStartDate").val(),u=jQuery("#adEndDate").val();o!=""&&u!=""&&(o+="-00-00-00",u+="-23-59-59",o=moment(o,"YYYY-MM-DD-HH-mm-ss").utc().format(),u=moment(u,"YYYY-MM-DD-HH-mm-ss").utc().format());var a="";jQuery("#addSearchFlagWrap input:checked").each(function(){a+=jQuery(this).val()});var f={};return f.adv="on",f.listType="mail",f.keyWord=s,f.folder=e,f.fromaddr=n,f.toaddr=r,f.category=i,f.sdate=o,f.edate=u,f.flag=a,f.searchExtFolder=t,f}function closeDetailSearchLayer(){ocxUploadVisible(!0),jQuery("#detailSearchLayerWrap").hide(),jQuery("#detailSearchLayerWrap").off(),jQuery(document).trigger("hideLayer.goLayer"),removeProcessLoader()}function toggleDetailSearchLayer(){if(jQuery("#detailSearchLayerWrap").css("display")=="none"){var e=jQuery("#searchType").val();e=="appSearch"?makeDetailSearchLayer():makeDetailUnifiedSearchLayer()}else closeDetailSearchLayer()}function openAdSearchMessageNamePopup(){if(!validateAdSearchMessage())return;jQuery.goPopup({id:"ad_search_name_popup",pclass:"layer_normal",header:mailMsg.mail_sfolder_save,contents:getHandlebarsTemplate("mail_detail_search_save_cond_name_tmpl"),buttons:[{btype:"confirm",btext:mailMsg.comn_confirm,autoclose:!1,callback:saveAdSearchMessageCond},{btype:"cancel",btext:mailMsg.comn_cancel}]})}function saveAdSearchMessageCond(){if(!validateInputValue(jQuery("#adSearchMessageCondName"),2,32,"folderName"))return;var e=jQuery.trim(jQuery("#adSearchMessageCondName").val()),t=Base64TMS.encode(jQuery.param(getAdSearchMessageQuery())),n={searchName:e,searchQuery:t};mailControl.saveSearchQuery(n),jQuery.goPopup.close()}function getMessageText(){return jQuery("#messageText").val()}function resizeTextFrame(e,t){jQuery("#messageContentFrame").css({height:e+25+"px","overflow-x":"hidden","overflow-y":"hidden"}),contentFrameWidth=jQuery("#messageContentFrame").contents().find("#contentT").width(),contentFrameWidth=t<1e3?contentFrameWidth:t;var n;CURRENT_PAGE_NAME=="popup"?(n=function(){var e=jQuery("#readContentMessageWrap"),t=jQuery("#mailViewContentWrap"),n=jQuery("#mailReadSenderListWrap"),r=jQuery("#mailReadArea");t.width()<contentFrameWidth?(e.css("width",t.width()),t.css("width",contentFrameWidth)):(r.width()>t.width()+57&&t.css("width",""),e.css("width",isMsie?"":"100%")),t.height("100%")},jQuery(window).unbind("resize.mailread"),jQuery(window).bind("resize.mailread",n)):(n=function(){var e=jQuery("#readContentMessageWrap"),t=jQuery("#mailViewContentWrap"),n=jQuery("#mailReadArea"),r=jQuery("#mailReadSenderListWrap");t.width()<contentFrameWidth?(t.css("width",contentFrameWidth),e.css("width",t.width())):(n.width()>t.width()+57&&t.css("width",""),e.css("width",isMsie?"":"100%")),getReadResizeHeight(),layoutMode==="h"&&t.css("height",n.height()-60+"px")},jQuery(window).unbind("resize.mailread"),jQuery(window).bind("resize.mailread",n)),n()}function viewSource(e,t){var n={};n.folder=e,n.uid=t,n=mailControl.getSharedFolderParam(n),n.action="source",POPUPDATA=n,window.open("/app/mail/popup","sourcePopup","scrollbars=yes,width=1280,height=640,resizable=yes")}function viewNdrGuide(){window.open("/app/mail/ndrguide","ndrGuidePopup","scrollbars=yes,width=920,height=640,resizable=yes")}function viewRegistrationSchedule(e){function r(e,t){window.location.href="/app/calendar/"+e+"/event/"+t}var t=BASECONFIG.data;t.contextRoot||(t.contextRoot="/"),t.locale||(t.locale=LOCALE);var n=jQuery("#resistration").offset();session={},session.id=SESSION_ID,session.serverTZOffset=SERVER_TIMEZONE,GO.Calendar.addSimpleEvent({contextRoot:t.contextRoot,modal:!1,summary:e,session:session,onCreateError:function(e){jQuery.goMessage(getSimpleEventErrorMessage(e))},afterAddEvent:function(e){function u(){var e=t.contextRoot+"app/calendar/"+n+"/event/"+r;window.opener?window.location.href=e:window.top.window.location.href=e}function a(){return}var n=e.calendarId,r=e.id,i=mailMsg.event_added,s=mailMsg.event_confirm_to_move,o=mailMsg.event_move;jQuery.goConfirm(i,s,u,a,o)},lang:{"\ub0b4 \uce98\ub9b0\ub354":mailMsg.mail_registe_my_calendar,"\uc77c\uc815 \ub4f1\ub85d":mailMsg.mail_registe_schedule,"\uc77c\uc815\uba85":mailMsg.mail_registe_name,"\uc77c\uc2dc":mailMsg.mail_registe_date,"\uc2dc\uac04":mailMsg.mail_registe_time,"\uc885\uc77c":mailMsg.mail_registe_allday,"\ud655\uc778":mailMsg.comn_confirm,"\ucde8\uc18c":mailMsg.comn_cancel,"\uc77c\uc815\uc0c1\uc138 \uc785\ub825":mailMsg.mail_registe_detail,"\uae30\ubcf8 \uce98\ub9b0\ub354 \uc774\ub984":mailMsg.mail_registe_basic_calendar,"\uae30\ubcf8 \uce98\ub9b0\ub354 \ud45c\uc2dc":mailMsg.mail_registe_basic,"\ubd84":mailMsg.autosave_option_min,"\uc7a5\uc18c":mailMsg.mail_calendar_location,"\uc804\uc0ac\uc77c\uc815":mailMsg.mail_calendar_company},offset:{left:n.left,top:n.top+jQuery("#resistration").height()}})}function getSimpleEventErrorMessage(e){var t=500,n={"required:summary":mailMsg.mail_registe_error_01,"max:summary":msgArgsReplace(mailMsg.mail_registe_error_02,[t])};return n[e]||mailMsg.mail_registe_error}function addWriteToolbarClass(){jQuery("#mainContentWrap").hasClass("mail_write")||jQuery("#mainContentWrap").addClass("mail_write"),jQuery("#toolbar_wrap").hide(),jQuery("div[data-tag=write_toolbar_wrap]").show()}function deleteWriteToolbarClass(){jQuery("#mainContentWrap").hasClass("mail_write")&&jQuery("#mainContentWrap").removeClass("mail_write"),jQuery("div[data-tag=write_toolbar_wrap]").hide(),jQuery("#toolbar_wrap").show()}function saveLayoutOption(){var e="n";jQuery("#mailOptionBoxWrap span.ic_con").each(function(){if(jQuery(this).hasClass("on"))return e=jQuery(this).attr("val"),!1});var t={readMode:e};mailControl.updateReadModeOption(t)}function savePageBase(){var e=jQuery("#toolbar_list_pagebase").val(),t={pageBase:e};mailControl.updatePageBaseOption(t)}function contentSplitterChange(e){layoutMode=e,layoutControl.contentSplitterChange(e),mailControl.reloadMessageList()}function editorBoxScript(e){if(editorControl)return;makeEditorProcess(e)}function makeEditorProcess(e){var t={};destoryEditorControl();var n=jQuery("#writeChangeEditorWrap");t.id="smartEditor",t.locale=LOCALE,t.content=e.htmlContent,t.letterUse=e.letterUse,editorControl=new SmartEditorControl(t),EDITOR_TYPE!="SmartEditor"&&(n.parent().css("top","0px"),n.show()),editorControl.makeEditor(function(){e.docTemplateApply&&editorControl.showWriteTemplateSelectLink(),editorControl.setEditorText(e.htmlContent),setFocus(e)})}function setFocus(e){!e.sendFlag||e.sendFlag.indexOf("forward")>-1?isRcptModeNormal?jQuery("#to").focus():jQuery("#writeRcptValue").focus():editorControl.setFocus()}function destoryEditorControl(){editorControl&&(editorControl.destroy(),editorControl=null)}function makeAddressUnitFormat(e,t,n){if(jQuery.trim(t)=="")return;var r=jQuery("#"+e);makeFormatUnit(r,t,n),r.focus(),r.width("80px")}function makeFormatEmail(e){var t=new Array,n=0,r=!1,i=!1;for(var s=0;s<e.length;s++){if(e[s]=="")continue;if(e[s].indexOf('"')>-1){r=!0;for(var o=s+1;o<e.length;o++)if(e[o].indexOf('"')>-1){i=!0;for(var u=s;u<=o;u++)u==s?t[n]=e[u]+",":u==o?t[n]=t[n]+e[u]:t[n]=t[n]+e[u]+",";n++;break}i||(t[n]=e[s]),s=o}else t[n]=e[s],n++}return t}function makeFormatUnit(e,t,n){if(jQuery.trim(t)=="")return;addressArray=new Array,t=t.replace(/[\r|\n|\t]/g,""),addressSplit=t.split(">,");for(var r=0;r<addressSplit.length;r++){tempAddressArray=addressSplit[r].split(",");for(var i=0;i<tempAddressArray.length;i++)tempAddressArray[i]=jQuery.trim(tempAddressArray[i]);addressArray=addressArray.concat(makeFormatEmail(tempAddressArray))}for(var r=0;r<addressArray.length;r++){t=addressArray[r];var s=checkEmailFormat(t),o=isDiffDomain(t,USEREMAIL),u=get_email(t),a=s?u.indexOf("$")==0||u.indexOf("#")==0||u.indexOf("!")==0?!0:!1:!1,f=s?getFormatName(t):t,l=s?getEmailFormatName(t):t,c=jQuery('<span class="name" evt-rol="select-field" onselectstart="return false"></span>').attr("title",f).data("email",l).text(f);n!=null&&c.data("info",!0).data("name",n[0].name).data("companyName",n[0].companyName).data("deptName",n[0].deptName).data("position",n[0].title);var h=jQuery('<span class="ic_con ic_edit_m" evt-rol="mod-field"></span>');h.attr("title",mailMsg.comn_modfy).click(function(){jQuery(this).closest("li").find("span.btn_wrap").hide();var e=jQuery(this).closest("li").hasClass("invalid"),t=jQuery(this).closest("li").addClass(e&&!isRcptModeNoneAC?"invalid_on":"on").find("span.name"),n=t.data("email"),r=jQuery('<input type="text" evt-rol="mod-field-inside" class="edit" style="display:none;">').val(n);if(!isRcptModeNoneAC){var i={autoResizeWidth:!0,makeFormat:!0,multiple:!1,width:"400px",matchCase:!0,editMode:!0,editModeFunc:makeEditFormatUnit};jQuery(r).autocomplete(mailControl.searchAddressAction,i)}t.before(r).remove(),r.blur(function(e){e.preventDefault(),isModFieldInside=!1;if(jQuery("div.layer_auto_complete:hover").length)jQuery(this).val("");else{var t=r.parent().next().children().children().attr("id"),n=r.val();makeEditFormatUnit(r,r.val()),isRcptModeNoneAC&&isRcptModeNormal&&searchRcptAddrOneName(t,n)}}).keydown(function(e){if(isRcptModeNoneAC){var t=jQuery.trim(jQuery(this).val());if(e.which==13||e.which==9){var n=r.parent().next().children().children().attr("id"),i=r.val();makeEditFormatUnit(r,r.val()),searchRcptAddrOneName(n,i)}var s=jQuery("#writeStrWidth");s.text(t),s.outerWidth()+50>jQuery(this).width()&&jQuery(this).width(s.outerWidth()+50)}e.which==13&&(isModFieldInside=!1)});var s=jQuery.Event("keydown");s.which=40,r.trigger(s).show().focus()});var p="";a||(p=jQuery('<span class="btn_wrap"></span>').append(h));var d=jQuery('<span class="ic_con ic_info_m"></span>');d.attr("title",mailMsg.mail_search_name_title).click(function(){var e=jQuery(this).closest("li"),t=jQuery(this).closest("li").find("span.name").data("email"),n=jQuery(this).closest("li").find("span.name").data("name"),r=jQuery(this).closest("li").find("span.name").data("deptName"),i=jQuery(this).closest("li").find("span.name").data("companyName"),s=jQuery(this).closest("li").find("span.name").data("position"),o=get_email(t),u={};u.emailValue=t,n==null&&(n=get_name(t)),u.name=n,u.email=o,u.position=s,u.company=i,u.department=r,rcptSelectInfoPopup(u)});var v=jQuery('<span class="btn_wrap"></span>').append(d),m=jQuery('<span class="ic_classic ic_del"></span>');m.attr("title",mailMsg.comn_del).click(function(){var t=jQuery(this).closest("li");t.find("input.edit").unautocomplete(),t.remove(),e.focus()});var g=jQuery('<span class="btn_wrap"></span>').append(m),y=jQuery("<li></li>");y.addClass(!s&&!isRcptModeNoneAC?"invalid":o?"out":""),isRcptModeNoneAC?y.append(c).append(v).append(p).append(g):y.append(c).append(p).append(g),e.closest("li").before(y),e.val("");if(isRcptModeNormal)var b=e.attr("id")}}function makeEditFormatUnit(e,t){if(jQuery.trim(t)=="")return;var n=checkEmailFormat(t),r=isDiffDomain(t,USEREMAIL),i=n?getFormatName(t):t,s=n?getEmailFormatName(t):t,o=jQuery('<span class="name" evt-rol="select-field" onselectstart="return false"></span>').attr("title",i).data("email",s).text(i);e.before(o),e.closest("li").removeClass("out invalid invalid_on on").addClass(!n&&!isRcptModeNoneAC?"invalid":r?"out":""),e.closest("li").find("span.btn_wrap").show(),e.unautocomplete(),e.remove()}function makeSearchAddressUnitFormat(e,t){if(jQuery.trim(e)=="")return;var n=checkEmailFormat(e),r=isDiffDomain(e,USEREMAIL),i=n?getFormatName(e,MAIL_EXPOSURE==0,LOCAL_DOMAIN):e,s=n?getEmailFormatName(e):e;t=t?t:jQuery("#writeRcptType").val();var o="";t=="to"?o=mailMsg.mail_to:t=="cc"?o=mailMsg.mail_cc:t=="bcc"&&(o=mailMsg.mail_bcc),$input=jQuery("#writeRcptValue");var u=jQuery('<p class="title"></p>').text(o+":"),a=jQuery('<span class="name"></span>').attr("title",i).data("email",s).data("type",t).text(i),f=jQuery('<span class="ic_classic ic_del"></span>');f.click(function(){jQuery(this).closest("ul.name_tag").closest("li").remove(),$input.focus()});var l=jQuery('<span class="btn_wrap"></span>').append(f),c=jQuery('<ul class="name_tag"></ul>');c.append(jQuery("<li></li>").addClass(n?r?"out":"":"invalid").append(a).append(l)),jQuery("#writeRcptList").append(jQuery("<li></li>").append(u).append(c)),$input.val(""),$input.focus()}function makeInputAddresskeyEvt(e){jQuery("#"+e).keydown(function(t){var n=jQuery.trim(jQuery(this).val());t.which==188&&!t.shiftKey&&(makeInputAddressFormat(e,n),t.preventDefault());if(isRcptModeNoneAC){if(t.which==13||t.which==9)makeInputAddressFormat(e,n),searchRcptAddrOneName(e,n),t.preventDefault();var r=jQuery("#writeStrWidth");r.text(n),r.outerWidth()+50>jQuery(this).width()&&jQuery(this).width(r.outerWidth()+50)}}).blur(function(t){t.preventDefault();var n=jQuery.trim(jQuery(this).val()),r=jQuery("#"+e+"_actb");if(r.length==0||r.css("display")=="none")jQuery("div.layer_auto_complete:hover").length?jQuery(this).val(""):(makeInputAddressFormat(e,n),isRcptModeNoneAC&&isRcptModeNormal&&searchRcptAddrOneName(e,n));else if(jQuery("div.layer_auto_complete:hover").length){var i=this;setTimeout(function(){r.css("display")=="none"&&jQuery(i).val("")},100)}else makeInputAddressFormat(e,n)}).keydown(function(e){e.which==8&&jQuery(this).val()==""&&jQuery(this).closest("ul.name_tag").find("li:not(.creat):last").remove()})}function makeInputAddressFormat(e,t){if(!t)return;var n=jQuery.trim(t),r=getEmailArray(n);for(var i=0;i<r.length;i++)isRcptModeNormal?makeAddressUnitFormat(e,r[i]):makeSearchAddressUnitFormat(r[i],e)}function deleteAddressUnitFormat(e,t){jQuery(t).remove(),jQuery("#"+e).focus()}function deleteSearchAddressUnitFormat(e){jQuery(e).closest("ul.name_tag").closest("li").remove(),jQuery("#writeRcptValue").focus()}function deleteAddressUnitFormatAll(e){jQuery("#"+e+"AddrWrap ul.name_tag li:not(.creat)").remove()}function deleteSearchAddressUnitFormatAll(){jQuery("#writeRcptList li").remove()}function selectRcptEmail(e,t){jQuery.trim(t)!=""&&(isRcptModeNormal?makeAddressUnitFormat(e,t):makeSearchAddressUnitFormat(t))}function insertRcptEmail(e,t){jQuery.trim(t)!=""&&(isRcptModeNormal?makeAddressUnitFormat(e,t):makeSearchAddressUnitFormat(t,e))}function makeWriteMyself(e){var t=!1,n=isRcptModeNormal?"toAddrWrap":"writeRcptList";jQuery("#"+n+" ul.name_tag li:not(.creat)").each(function(){var n=jQuery(this).find("span.name").data("email"),r=get_email(n);if(USEREMAIL==r){if(e)return t=!0,!1;isRcptModeNormal?deleteAddressUnitFormat("to",jQuery(this)):deleteSearchAddressUnitFormat(jQuery(this))}});if(e&&!t)if(isRcptModeNormal)if(isRcptModeNoneAC){var r={};jQuery.ajax({type:"GET",url:"/api/user/profile/"+SESSION_ID,async:!1,success:function(e){var t=e.data.deptMembers,n="";for(var i=0;i<t.length;i++)i==0?n=t[i].deptName:n=n+"/"+t[i].deptName;r.companyName=e.data.companyName,r.deptName=n,r.email=USEREMAIL,r.name=USERNAME,r.title=USERPOSITION},dataType:"json"});var i=new Array(1);i[0]=r;var s='"'+USERNAME+'" <'+USEREMAIL+">";makeAddressUnitFormat("to",s,i)}else{var s='"'+USERNAME+'" <'+USEREMAIL+">";makeAddressUnitFormat("to",s)}else{var s='"'+USERNAME+'" <'+USEREMAIL+">";makeSearchAddressUnitFormat(s)}}function contentDataCheck(){var e=jQuery("#contentTemp").val(),t=mailControl.getSendData();e!=""&&setTimeout("initTextContentData()",500)}function initTextContentData(){var e=jQuery("#contentTemp").val();isMsie?window.textContentFrame.setContent(e):document.getElementById("textContentFrame").contentWindow.setContent(e)}function getWriteType(){return jQuery("#editorMode").data("mode")}function openWriteBccWrap(){jQuery("#writeToggleBccWrap").removeClass("ic_arrow_down_type4").addClass("ic_arrow_up_type4").attr("title",mailMsg.comn_close),jQuery("#writeBccWrap").show()}function getWriteMode(){var e=mailControl.getSendData(),t="normal";if(e.sendFlag=="forwardAttached"||e.sendFlag=="forward")t="forward";return t}function chgEditorMod(e,t){var n=jQuery("#modeHtmlWrapper"),r=jQuery("#modeTextWrapper"),i;isOcxUpload&&(i=document.uploadForm.powerupload,i.SetChangeUpMode("true"));var s=jQuery("#editorMode").data("mode");if(!t&&s==e)return;var o=function(){if(e=="text"){var i=mailControl.getSendData();i.letterMode=="on"&&clearLetterPaper(),n.hide(),r.show(),closeLetterListLayer(),closeDocTmplListLayer(),jQuery("#editorMode").data("mode",e).text("TEXT"),t||(isMsie?window.textContentFrame.setFrameFocus():document.getElementById("textContentFrame").contentWindow.setFrameFocus()),notiMode=="link"&&jQuery("#receivenoti").attr("disabled",!0),jQuery("#writeChangeEditorWrap").show(),jQuery("#signSelect").attr("disabled",!0)}else{r.hide(),n.show(),jQuery("#editorMode").data("mode",e).text("HTML");var o=mailControl.getWriteData();editorBoxScript(o),notiMode=="link"&&jQuery("#receivenoti").attr("disabled",!1),EDITOR_TYPE=="SmartEditor"&&jQuery("#writeChangeEditorWrap").hide(),jQuery("#signSelect").removeAttr("disabled")}s=e},u=mailMsg.write_alert002;s=="html"&&notiMode=="link"&&(u=mailMsg.write_alert003),t?o():jQuery.goConfirm(mailMsg.mail_write_editor_mode,u,function(){o()})}function viewBigAttachManager(){mailControl.listBigAttachFile(function(e){jQuery.goPopup({id:"mail_bigattach_manager_popup",pclass:"layer_normal layer_big_data",header:mailMsg.mail_attach_manager_simple,width:750,contents:getHandlebarsTemplate("mail_layer_bigattach_manager_tmpl",e),openCallback:function(){jQuery("#mail_bigattach_manager_popup").on("click","span",function(e){var t=jQuery(this).attr("evt-rol");if(!t)return;if(t=="bigattach-delete"){var n=jQuery(this).data("messageuid");deleteBigAttach(n)}})},closeCallback:function(){jQuery("#mail_bigattach_manager_popup").off()},buttons:[{btype:"cancel",btext:mailMsg.comn_close}]})})}function deleteBigAttach(e){jQuery.goCaution(mailMsg.mail_bigattach_delete,mailMsg.bigattach_list_010,function(){var t={messageUids:[e]};mailControl.deleteBigAttach(t,function(t){jQuery("#bigattach_item_"+e).remove(),updateHugeQuota(Number(t)),deleteUpoladBarList(e)},function(e){jQuery.goAlert(mailMsg.mail_bigattach_delete_fail,mailMsg.bigattach_list_009)})},function(){viewBigAttachManager()})}function viewExtMailPopup(){mailControl.loadExtMail(function(e){jQuery.goPopup({id:"mail_extmail_popup",pclass:"layer_normal out_mail",header:mailMsg.conf_pop_44,width:700,contents:getHandlebarsTemplate("mail_layer_extmail_tmpl",e),openCallback:function(){jQuery("#mail_extmail_popup").on("click","a",function(e){var t=jQuery(this).attr("evt-rol");if(!t)return;if(t=="extmail-download-start"){if(!jQuery(this).find("span.state").hasClass("finish"))return;var n=jQuery(this).attr("host"),r=jQuery(this).attr("userid"),i={pop3Host:n,pop3Id:r};mailControl.downloadOrderExtMail(i),jQuery(this).find("span.state").text(mailMsg.comn_waiting).removeClass("finish").addClass("wait")}else if(t=="extmail-download-reset"){var n=jQuery(this).attr("host"),r=jQuery(this).attr("userid"),i={pop3Host:n,pop3Id:r};mailControl.resetExtMail(i)}}),checkPop3Status()},closeCallback:function(){jQuery("#mail_extmail_popup").off(),clearTimeout(pop3StatusTimeout)},buttons:[{btype:"cancel",btext:mailMsg.comn_close},{btype:"confirm",btext:mailMsg.mail_pop3_insert,callback:function(){selectSettingMenu("extmail")}}]})})}function checkPop3Status(){clearTimeout(pop3StatusTimeout),jQuery("#mail_extmail_popup tr.item").each(function(){var e=jQuery(this).attr("status");if(e=="INPROGRESS"||e=="WAIT")return pop3StatusTimeout=setTimeout("runCheckPop3Status()",5e3),!1})}function runCheckPop3Status(){mailControl.loadExtMail(function(e){jQuery("#mail_extmail_popup div.content").html(getHandlebarsTemplate("mail_layer_extmail_tmpl",e)),checkPop3Status()})}function receiveMessage(e){var t=e.status,n=e.index,r=jQuery("#extMailBtn"+n);t=="finish"||t=="fail"?(r.text(mailMsg.comn_complate).removeClass("btn_fn8").addClass("btn_fn4"),r.attr("evt-rol","extmail-download-complate"),t=="fail"&&(jQuery("#extMailProcess"+n).hide(),jQuery("#extMailProcessMsg"+n).text(e.msg).show())):t=="total"?jQuery("#extMailProcessTotalCount"+n).text(e.count):t=="success"?jQuery("#extMailProcessSuccessCount"+n).text(e.count):t=="failCount"?jQuery("#extMailProcessFailCount"+n).text(e.count):t=="graph"?(jQuery("#extMailProcessTotalGraph"+n).css("width",e.graphTotal+"%"),jQuery("#extMailProcessSuccessGraph"+n).css("width",e.graphSuccess+"%")):t=="complate"}function getWriteModeLayer(){var e=jQuery("#writeModeSelect"),t=e.css("display")=="none";if(!t){closeWriteModeLayer();return}jQuery("#writeModeSelect ul > *").bind("mouseout",function(){writeModeTimeout=setTimeout(function(){closeWriteModeLayer()},1e3)}),jQuery("#writeModeSelect ul > *").bind("mouseover",function(){writeModeTimeout&&clearTimeout(writeModeTimeout)}),jQuery("#writeModeSelect ul > *").bind("click",function(){closeWriteModeLayer()}),closeDocTmplListLayer(),closeLetterListLayer(),e.show()}function closeWriteModeLayer(){jQuery("#writeModeSelect ul > *").unbind(),jQuery("#writeModeSelect").hide()}function getLetterListLayer(e){closeWriteModeLayer(),closeDocTmplListLayer(),e||(e=1);var t={page:e},n=mailControl.getSendData();mailControl.getLetterList(t,function(e){e.letterMode=n.letterMode,e.type="letter",jQuery("#writeOptionLayer").handlebars("mail_letter_layer_tmpl",e),jQuery("#mailLetterLayerWrap").on("click","li",function(e){jQuery("#mailLetterLayerWrap li").removeClass("on"),jQuery(this).addClass("on")}),jQuery("#mailLetterLayerWrap").on("click","span,a",function(e){var t=jQuery(this).attr("evt-rol");if(!t)return;if(t=="apply-letter"){var n=jQuery("#mailLetterLayerWrap li.on");if(n.length==0)return;var r=n.data("letterseq"),i=n.data("header"),s=n.data("body"),o=n.data("tail"),u={};u.letterSeq=r,u.header=i,u.body=s,u.tail=o,setLetterPaper(u)}else t=="letter-layer-close"?closeLetterListLayer():t=="cancel-letter"&&clearLetterPaper()})})}function setLetterPaper(e){if(!editorControl.oEditor.validate())return jQuery.goError(mailMsg.mail_mime_size_exceed),!1;var t=getHtmlMessage("ascheck");jQuery.trim(t)==""&&(isDocTemplate=!1);if(isDocTemplate){jQuery.goAlert(mailMsg.doctemplate_text_alert3);return}var n=e.header,r=e.body,i=e.tail,s=jQuery("<img></img>");s.attr("id","letter_top_img"),s.attr("src",n),s.css("width","600px");var o=jQuery("<img></img>");o.attr("id","letter_bot_img"),o.attr("src",i),o.css("width","600px"),editorControl.makeLetterLayout(s,r,o);var u=mailControl.getSendData();u.letterMode="on",u.letterSeq=e.letterSeq,u.letterData=e,mailControl.setSendData(u),isLetter=!0,closeLetterListLayer()}function clearLetterPaper(){editorControl.cancelLetterLayout();var e=mailControl.getSendData();e.letterMode="off",mailControl.setSendData(e),isLetter=!1,closeLetterListLayer()}function closeLetterListLayer(){jQuery("#mailLetterLayerWrap").off(),jQuery("#writeOptionLayer").empty()}function getDocTemplateList(e){closeWriteModeLayer(),closeLetterListLayer(),e||(e=1);var t={page:e};mailControl.getDocTemplateList(t,function(e){e.type="docTmpl",jQuery("#writeOptionLayer").handlebars("mail_doctemplate_layer_tmpl",e),jQuery("#mailDocTmplLayerWrap").on("click","li",function(e){jQuery("#mailDocTmplLayerWrap li").removeClass("on"),jQuery(this).addClass("on")}),jQuery("#mailDocTmplLayerWrap").on("click","span,a",function(e){var t=jQuery(this).attr("evt-rol");if(!t)return;if(t=="apply-doctmpl"){var n=jQuery("#mailDocTmplLayerWrap li.on");if(n.length==0)return;var r=n.data("seq");setDocTemplate(r)}else t=="doctmpl-layer-close"&&closeDocTmplListLayer()})})}function setDocTemplate(e){if(isLetter){jQuery.goAlert(mailMsg.doctemplate_text_alert3);return}if(!editorControl.oEditor.validate())return jQuery.goError(mailMsg.mail_mime_size_exceed),!1;var t=getHtmlMessage("ascheck"),n=function(){var t={templateSeq:e};mailControl.getTemplateContent(t,function(e){editorControl.setEditorText(e.template),isDocTemplate=!0}),closeDocTmplListLayer()};jQuery.trim(t)!=""?jQuery.goConfirm(mailMsg.mail_doctemplate_title,mailMsg.doctemplate_text_alert2,function(){n()}):n()}function closeDocTmplListLayer(){jQuery("#mailDocTmplLayerWrap").off(),jQuery("#writeOptionLayer").empty()}function chgAutoSaveTerm(e){clearTimeout(autoSaveTimeTerm),isAutoSaveStart=!1,mailControl.updateAutoSaveInfo(e,function(e){runAutoSaveProcess(),processAutoSaveMessage("saveTerm")})}function runAutoSaveProcess(){clearTimeout(autoSaveTimeTerm);var e=folderControl.getQuotaInfo(),t=jQuery("#autoSaveSelect").val(),n=t*1e3;n>0?(Number(e.percent)>=100?processAutoSaveMessage("quotaover"):(isAutoSaveStart&&doAutoSave(),isAutoSaveStart=!0),autoSaveTimeTerm=setTimeout("runAutoSaveProcess()",n)):(isAutoSaveStart=!1,clearTimeout(autoSaveTimeTerm))}function runAutoReflashProcess(){clearTimeout(autoReflashTimeTerm);var e=getCookie("reflash_time"),t=e*1e3*60;t>0&&isUseReflashTime?(isAutoReflash&&currentMenu=="list"&&mailControl.reloadMessageList(),isAutoReflash=!0,autoReflashTimeTerm=setTimeout("runAutoReflashProcess()",t)):(isAutoReflash=!1,clearTimeout(autoReflashTimeTerm))}function processAutoSaveMessage(e,t){clearTimeout(checkSaveTimeTerm);var n="";if(e=="saveMessage"){var r=mailControl.getSendData();r.draftMessageId=t.messageId,n=mailMsg.autosave_message_savesuccess+" ( "+moment(t.updateTimeUtc).format("HH:mm:ss")+" )"}else if(e=="saveTerm"){var i=jQuery("#autoSaveSelect").val();n=mailMsg.autosave_message_termchange,i>0?i<60?n+=" ("+i+mailMsg.autosave_option_sec+")":n+=" ("+i/60+mailMsg.autosave_option_min+")":n+=" ("+mailMsg.autosave_option_nosave+")"}else e=="saveErrorTerm"?n=mailMsg.autosave_term_error:e=="saveErrMessage"?n=mailMsg.autosave_message_error:e=="quotaover"&&(n=mailMsg.mail_send_quotaover_draft);processMessageViewer(n),isAutoSave=!1}function contentValidation(){var e=jQuery("#editorMode").data("mode");return e=="html"&&!editorControl.oEditor.validate()?(jQuery.goError(mailMsg.mail_mime_size_exceed),!1):!0}function doAutoSave(){if(isSendWork)return;if(t=="html"&&!editorControl.oEditor.isAccessible())return;var e={};e=makeRcptForm(e);var t=jQuery("#editorMode").data("mode"),n;if(t=="html"){if(!editorControl.oEditor.validate())return jQuery.goError(mailMsg.mail_mime_size_exceed),!1;n=getHtmlMessage("draft")}else n=getTextMessage();e.subject=jQuery("#subject").val(),e.sendType="autosave";var r=mailControl.getSendData();e.draftMessageId=r.draftMessageId,e.sendFlag=r.sendFlag,e.writeMode=t,e.uids=r.uids,e.folderName=r.folderName,e.charset=r.charset,e.massMode=!1,e.content=n,e.attachList=getAttachString();if(e.to==""&&e.bcc==""&&e.cc==""&&e.subject==""&&e.content==""&&e.attachList=="")return;isAutoSave=!0,processMessageViewer(mailMsg.autosave_message_start),checkSaveTimeTerm=setTimeout(function(){isAutoSave&&processAutoSaveMessage("saveErrMessage")},1e4),mailControl.autoSaveMessage(e)}function doDraftSave(){if(isSendWork)return;var e={};e=makeRcptForm(e);var t=jQuery("#editorMode").data("mode"),n;if(t=="html"){if(!editorControl.oEditor.validate())return jQuery.goError(mailMsg.mail_mime_size_exceed),!1;n=getHtmlMessage("draft")}else n=getTextMessage();var r=jQuery("#subject").val();if(r==""){jQuery.goSlideMessage(mailMsg.alert_nosubject,"caution");return}e.subject=r,e.sendType="draft";var i=mailControl.getSendData();e.draftMessageId=i.draftMessageId,e.sendFlag=i.sendFlag,e.writeMode=t,e.uids=i.uids,e.folderName=i.folderName,e.charset=i.charset,e.massMode=!1,e.content=n,isAutoSave=!0;if(isOcxUpload){var s=document.uploadForm.powerupload,o=s.GetAttachedFileCount();if(o>0){var u=s.GetAttachedSize("HUGE");u>0?jQuery.goConfirm(mailMsg.menu_draft,mailMsg.confirm_draftbigattach,function(){for(var t=0;t<o;t++)type=s.GetAttachedFileAttr(t,"attachtype"),type=="huge"&&s.RemoveAttachFile(s.GetAttachedFileAttr(t,"attachid"));ocxUploadAndSendMessage(e)}):ocxUploadAndSendMessage(e)}else mailControl.sendMessage(e)}else{e.attachList=getAttachString();var a=makeBigAttachContent();a.mode=="on"?jQuery.goConfirm(mailMsg.menu_draft,mailMsg.confirm_draftbigattach,function(){mailControl.sendMessage(e)}):mailControl.sendMessage(e)}}function ocxUploadAndSendMessage(e){if(!uploadOcxFile()){isAutoSave=!1;return}e.attachList=getAttachString(),mailControl.sendMessage(e)}function processMessageViewer(e){clearTimeout(autoSaveMessageTerm),jQuery("#processMessageContent").text(e),jQuery("#processMessageWrap").fadeIn(500,function(){autoSaveMessageTerm=setTimeout(function(){jQuery("#processMessageWrap").fadeOut(500)},3e3)})}function makeRcptForm(e){e||(e={});if(isRcptModeNormal){var t=["to","cc","bcc"],n=[];for(var r=0;r<t.length;r++)jQuery("#"+t[r]+"AddrWrap li span.name").each(function(){n.push(jQuery(this).data("email"))}),t[r]=="to"?e.to=n.join(","):t[r]=="cc"?e.cc=n.join(","):t[r]=="bcc"&&(e.bcc=n.join(",")),n=[]}else{var i=[],s=[],o=[],u,a;jQuery("#writeRcptList li span.name").each(function(){u=jQuery(this).data("type"),a=jQuery(this).data("email"),u=="to"?i.push(a):u=="cc"?s.push(a):u=="bcc"&&o.push(a)}),e.to=i.join(","),e.cc=s.join(","),e.bcc=o.join(",")}return e}function getRcptFormCount(){var e=0;if(isRcptModeNormal){var t=["to","cc","bcc"];for(var n=0;n<t.length;n++)jQuery("#"+t[n]+"AddrWrap li span.name").each(function(){e++})}return e}function resultAutoSave(e){e.success?processAutoSaveMessage("saveMessage",e):processAutoSaveMessage("saveErrMessage")}function openReservedLayerPopup(){var e={},t=[],n=[],r=mailControl.getWriteData(),i=mailControl.getSendData();for(var s=0;s<24;s++)t.push(s);for(var s=0;s<6;s++)n.push(s*10);e.hourArray=t,e.minArray=n,e.reservedDateInfo=r.reservedDateInfo;var o=e.reservedDateInfo.reservedDateUtc,u=moment(o);i.reservation=="on"&&(u=moment(i.reservedDateUtc)),e.reservedDateInfo.todayDate=u.format("YYYY")+"-"+u.format("MM")+"-"+u.format("DD"),e.reservedDateInfo.thour=u.format("HH"),e.reservedDateInfo.tmin=u.format("mm"),jQuery("#secureReservedLayerWrap").html(getHandlebarsTemplate("mail_layer_reserved_tmpl",e)),jQuery("#reservedDate").datepicker({dateFormat:"yy-mm-dd",changeMonth:!0,changeYear:!0,yearSuffix:""}),jQuery("#mailReservedLayerWrap").on("click","span,a",function(e){var t=jQuery(this).attr("evt-rol");if(!t)return;t=="apply-reserved"?applyReservedMail():t=="reserved-layer-close"&&closeReservedLayerPopup()})}function applyReservedMail(){var e=jQuery.trim(jQuery("#reservedDate").val());if(e==""){jQuery.goMessage(mailMsg.alert_emptyreserved);return}var t=jQuery("#reservedDate").data("maxreservedday"),n=e.split("-");if(!checkReserveTime(n[0],n[1],n[2],jQuery("#reservedHour").val(),jQuery("#reservedMin").val(),t))return;var r=mailControl.getSendData();r.reserveMail=!0;var i=moment(e+" "+jQuery("#reservedHour").val()+":"+jQuery("#reservedMin").val(),"YYYY-MM-DD HH:mm"),s=i.format("HH"),o=i.format("mm");r.reservedDateUtc=i.utc().format(),r.sendType="reserved",mailControl.setSendData(r);var u=jQuery("#reservation_setting_info");u.empty();var a=jQuery('<span class="data"></span>');a.text(e+" "+s+mailMsg.comn_hour+" "+o+mailMsg.comn_min);var f=jQuery('<span title="'+mailMsg.comn_disabled+'" class="btn_wrap"></span>'),l=jQuery('<span class="ic_classic ic_del"></span>');l.click(function(){clearReservedData()}),f.append(l),u.append(a).append(f),u.closest("dl").addClass("option_on"),closeReservedLayerPopup()}function closeReservedLayerPopup(){jQuery("#mailReservedLayerWrap").off(),jQuery("#secureReservedLayerWrap").empty(),jQuery(document).trigger("hideLayer.goLayer")}function clearReservedData(){var e=mailControl.getSendData();e.reserveMail=!1,e.reservedDateUtc="",e.sendType="normal",mailControl.setSendData(e),jQuery("#reservation_setting_info").empty(),jQuery("#reservation_setting_info").closest("dl").removeClass("option_on")}function openSecureMailLayerPopup(e){var t={};jQuery("#secureReservedLayerWrap").html(getHandlebarsTemplate("mail_layer_securemail_tmpl",t)),jQuery("#mailSecureLayerWrap").on("click","span,a",function(e){var t=jQuery(this).attr("evt-rol");if(!t)return;t=="apply-secure"?applySecureMail():t=="secure-layer-close"&&closeSecureLayerPopup()})}function applySecureMail(){if(!validateInputValue(jQuery("#securemailPass"),2,32,"searchMail"))return;if(!validateInputValue(jQuery("#securemailHint"),2,32,"searchMail"))return;var e=jQuery.trim(jQuery("#securemailPass").val()),t=jQuery.trim(jQuery("#securemailHint").val()),n=mailControl.getSendData();n.secureMail=!0,n.securePass=e,n.secureHint=t,mailControl.setSendData(n);var r=jQuery("#secure_setting_info");r.empty();var i=jQuery('<span class="data"></span>');i.text(mailMsg.comn_use);var s=jQuery('<span title="'+mailMsg.comn_disabled+'" class="btn_wrap"></span>'),o=jQuery('<span class="ic_classic ic_del"></span>');o.click(function(){clearSecureMailData()}),s.append(o),r.append(i).append(s),r.closest("dl").addClass("option_on"),closeSecureLayerPopup()}function closeSecureLayerPopup(){jQuery("#mailSecureLayerWrap").off(),jQuery("#secureReservedLayerWrap").empty(),jQuery(document).trigger("hideLayer.goLayer")}function clearSecureMailData(){var e=mailControl.getSendData();e.secureMail=!1,e.securePass="",e.secureHint="",mailControl.setSendData(e),jQuery("#secure_setting_info").empty(),jQuery("#secure_setting_info").closest("dl").removeClass("option_on")}function makeSignListItem(e){e=e?e:{};var t=jQuery("#signListWrap").data("attach");e.useAttach=t?!0:!1,jQuery("#signListWrap").html(getHandlebarsTemplate("mail_layer_sign_tmpl",e)),jQuery("#signSelect").on("change",function(){callSignData(jQuery("#signSelect option:selected").val())})}function callSignData(e){if(e==0){editorControl.setSignData("");return}var t={signSeq:e};mailControl.signContent(t,function(e){editorControl.setSignData(e)})}function sendMessage(e){if(!uploadAttachFilesComplete){jQuery.goAlert(mailMsg.alert_upload_progress);return}if(sendAllowUsed&&e!="draft"&&!isSendAllowed()){jQuery.goAlert("",mailMsg.sendallow_msg3);return}isSendWork=!0,isRcptModeNoneAC?(sendMailType=e,searchRcptAddrName(),newSendMessage(sendMailType)):newSendMessage(e)}function isSendAllowed(){var e=!1,t=makeRcptForm(),n=getRcptFilePath();return n!=""&&(t.massRcpt=n),mailControl.checkSendAllow(t,function(t){e=t}),e}function newSendMessage(e){if(!uploadAttachFilesComplete){jQuery.goAlert(mailMsg.alert_upload_progress);return}var t=mailControl.getSendData();t=makeRcptForm(t);var n=!1,r=t.to,i=t.cc,s=t.bcc;if(e!="draft"){var o=getRcptFilePath();if(o==""){t.massMode=!1;if(jQuery.trim(r)==""){jQuery.goAlert(mailMsg.error_norecipient),jQuery("#to").focus();return}if(!checkEmailInvalidAddress(r))return;if(!checkEmailInvalidAddress(i))return;if(!checkEmailInvalidAddress(s))return;if(isSendInfoCheckUse||isSendEmailCheckUse||isSendAttachCheckUse||isSendKeywordCheckUse)n=!0}else t.massRcpt=o,t.massMode=!0,jQuery("#onesend").attr("checked",!0);var u=jQuery("#signSelect").val();u&&u>0?(t.attachSign=!0,t.signSeq=u):(t.attachSign=!1,t.signSeq=""),t.senderMode=jQuery("#senderMode").val()=="on"?!0:!1,t.senderUserEmail=jQuery("#senderUserEmail").val(),t.useAliasEmail=jQuery("#senderUserEmail option:selected").attr("alias")=="true",t.reserveMail?e="reserved":e="normal"}t.sendType=e;var a=jQuery.trim(jQuery("#subject").val());if(a==""){jQuery.goAlert(mailMsg.alert_nosubject),jQuery("#subject").focus();return}t.subject=a,t.writeMode=jQuery("#editorMode").data("mode");var f=jQuery("#editorMode").data("mode"),l="";if(f=="html"){if(!editorControl.oEditor.validate())return jQuery.goError(mailMsg.mail_mime_size_exceed),!1;l=getHtmlMessage("ascheck")}else l=jQuery.trim(getTextMessage());if(!checkSendMailCount(t))return;if(n){t.sendEmailCheckResult=!1,t.sendAttachCheckResult=!1,t.sendKeywordCheckResult=!1,t.sendInfoCheck=!1;if(isSendEmailCheckUse){var r=getEmailArray(t.to),i=!t.cc||jQuery.trim(t.cc)==""?"":getEmailArray(t.cc),s=!t.bcc||jQuery.trim(t.bcc)==""?"":getEmailArray(t.bcc);i!=""&&(r=r.concat(i)),s!=""&&(r=r.concat(s));var c=new Array,h=new Array,p=0,d=0,v;for(var m=0;m<r.length;m++)v=get_email(r[m]),(v.indexOf("$")==0||v.indexOf("#")==0||v.indexOf("!")==0?!0:!1)?(h[p]=v,p++):(c[d]=v,d++);var g={};g.emailArray=c,c.length!=0?ActionLoader.postSyncGoLoadAction("/api/mail/address/search/external",g,function(e){t.sendEmailCheckResult=e?!0:!1},"json"):t.sendEmailCheckResult=!1}if(isSendAttachCheckUse){var y;if(isOcxUpload){var b=document.uploadForm.powerupload;y=b.GetAttachedFileCount()}else{var w=basicAttachUploadControl.getFileList("huge"),E=basicAttachUploadControl.getFileList("normal");jQuery.merge(w,E),y=w.length}var S=sendAttachData;searchContentKeyword(l,S,/,/g)&&(y>0?t.sendAttachCheckResult=!1:t.sendAttachCheckResult=!0)}if(isSendKeywordCheckUse){var S=sendKeywordData;searchContentKeyword(l,S,/\\\\/g)?t.sendKeywordCheckResult=!0:t.sendKeywordCheckResult=!1}isSendInfoCheckUse&&(t.sendInfoCheck=!0),t.sendEmailCheckResult||t.sendAttachCheckResult||t.sendKeywordCheckResult||t.sendInfoCheck?(mailControl.setSendData(t),checkSendInfoValue(t)):sendMessageParamProcess(t)}else sendMessageParamProcess(t)}function searchContentKeyword(e,t,n){var r=jQuery("#editorMode").data("mode");r=="html"&&(e=unescape_tag_title(e));var i=new RegExp("[.*+?|()\\[\\]\\^\\${}\\\\]","g");t=t.replace(i,"\\$&");var s=t.replace(n,"|");return e.match(new RegExp("("+s+")","gi"))}function getEmailAddrNoPersonal(e){var t=jQuery("#"+e),n=t.children().length,r="";return n>0&&t.children().each(function(e){var t=jQuery(this).css("display");t=="block"&&(e===n-1?r+=get_email(unescape_tag(jQuery(this).attr("data-addr"))):r+=get_email(unescape_tag(jQuery(this).attr("data-addr")))+",")}),r}function checkSendInfoValue(e){var t=[];if(isOcxUpload){var n=document.uploadForm.powerupload,r=n.GetAttachedFileCount();for(var i=0;i<r;i++)t.push({name:Base64TMS.decode(n.GetAttachedFileAttr(i,"FILENAME2")),id:n.GetAttachedFileAttr(i,"attachid"),size:n.GetAttachedFileAttr(i,"SIZE")})}else{var s=basicAttachUploadControl.getFileList("huge"),o=basicAttachUploadControl.getFileList("normal");jQuery.merge(s,o);for(var i=0;i<s.length;i++)t.push({name:s[i].name,id:s[i].id,size:s[i].size})}var u={};u.subject=e.subject,u.toList=getEmailArray(e.to),u.ccList=!e.cc||jQuery.trim(e.cc)==""?null:getEmailArray(e.cc),u.bccList=!e.bcc||jQuery.trim(e.bcc)==""?null:getEmailArray(e.bcc),u.attachList=t,u.sendEmailCheckResult=e.sendEmailCheckResult,u.sendAttachCheckResult=e.sendAttachCheckResult,u.sendKeywordCheckResult=e.sendKeywordCheckResult,u.sendInfoCheck=e.sendInfoCheck;var a;isSendInfoCheckUse?a=[{btype:"confirm",btext:mailMsg.menu_send,callback:checkSendMessage,autoclose:!1},{btype:"cancel",btext:mailMsg.comn_setting,callback:settingWriteInfo},{btype:"cancel",btext:mailMsg.comn_cancel,callback:cancelSend,autoclose:!0}]:a=[{btype:"confirm",btext:mailMsg.menu_send,callback:checkSendMessage,autoclose:!1},{btype:"cancel",btext:mailMsg.comn_cancel,callback:cancelSend,autoclose:!0}],jQuery.goPopup({id:"mail_send_allow_check_popup",pclass:"layer_normal layer_prevent_receiveError",header:mailMsg.mail_rcptcheck,width:600,contents:getHandlebarsTemplate("mail_send_allow_check_tmpl",u),buttons:a})}function cancelSend(){isSendWork=!1;var e=mailControl.getSendData(),t=mailControl.getInitSendData();e.letterMode=="on"&&(t.letterMode="on",t.letterSeq=e.letterSeq,t.letterData=e.letterData),e.reserveMail&&(t.reserveMail=!0,t.reservedDateUtc=e.reservedDateUtc,t.sendType="reserved"),e.secure=="on"&&(t.secure="on",t.securePass=e.securePass,t.secureHint=e.secureHint),t.draftMessageId=e.draftMessageId,mailControl.setSendData(t)}function checkSendMessage(){var e=mailControl.getSendData();if(isSendInfoCheckUse){var t=getCheckSendInfoValue("to");if(!t||t.length==0){jQuery.goMessage(mailMsg.mail_rcpt_to_noselect);return}settingWriteInfo(),jQuery.goPopup.close(),e=makeRcptForm(e)}else jQuery.goPopup.close();sendMessageParamProcess(e)}function settingWriteInfo(){var e=getCheckSendInfoValue("to"),t=getCheckSendInfoValue("cc"),n=getCheckSendInfoValue("bcc");isRcptModeNormal?(deleteAddressUnitFormatAll("to"),deleteAddressUnitFormatAll("cc"),deleteAddressUnitFormatAll("bcc")):deleteSearchAddressUnitFormatAll();if(e&&e.length>0)for(var r=0;r<e.length;r++)insertRcptEmail("to",e[r]);if(t&&t.length>0)for(var r=0;r<t.length;r++)insertRcptEmail("cc",t[r]);if(n&&n.length>0)for(var r=0;r<n.length;r++)insertRcptEmail("bcc",n[r]);settingWriteInfoAttach()}function settingWriteInfoAttach(){jQuery("#basicAttachList input[name='basicAttachFileEl']").attr("checked",!1),jQuery("#mail_send_allow_check_popup input[name=attachFile]").each(function(){if(!jQuery(this).attr("checked")){var e=jQuery(this).val();isOcxUpload?ocx.RemoveAttachFile(e):jQuery("#"+e).attr("checked",!0)}isOcxUpload||deletefile()})}function sendMessageParamProcess(e){var t=e.sendType;if(directedApproverFilter(e))return;if(isAutoSave){jQuery.goAlert(mailMsg.write_alert008);return}e.content=getMessageContent(t);var n=folderControl.getQuotaInfo();if(Number(n.percent)>=100){if(t=="draft"){jQuery.goAlert(mailMsg.mail_send_quotaover_draft);return}jQuery.goConfirm(mailMsg.mail_quota_over,mailMsg.mail_send_quotaover_confirm,function(){jQuery("#savesent").attr("checked",!1),jQuery("#receivenoti").attr("checked",!1),mailControl.setSendData(e),clearReservedData(),clearSecureMailData(),e=mailControl.getSendData(),jQuery("#onesend").attr("checked")&&(e.oneSend=!0),jQuery("#priority").attr("checked")&&(e.priority="HIGH"),jQuery("#vcardAttach").attr("checked")&&(e.attachVcard=!0);if(isOcxUpload&&!uploadOcxFile())return;requestSendAction(e)})}else sendNormalMessage(e)}function sendNormalMessage(e){var t=e.sendType,n=mailMsg.mail_send_confirm;if(t!="draft")jQuery("#onesend").attr("checked")&&(e.oneSend=!0),jQuery("#priority").attr("checked")&&(e.priority="HIGH"),jQuery("#vcardAttach").attr("checked")&&(e.attachVcard=!0),jQuery("#receivenoti").attr("checked")&&(e.writeMode=="html"&&notiMode=="link"||notiMode=="mail")&&(e.receiveNoti=!0),jQuery("#savesent").attr("checked")&&(e.saveSent=!0),e.secureMail&&(n=mailMsg.mail_secure_confirm);else{e.letterMode="off";if(e.secureMail){jQuery.goAlert(mailMsg.error_secure_draft);return}if(!processDraftHuseFile())return;n=mailMsg.mail_send_drafts_confirm}var r=e.sendType=="draft"?mailMsg.menu_draft:mailMsg.mail_send_title;makeProcessLoader();if(!sendConfirm){if(isOcxUpload&&!uploadOcxFile())return;requestSendAction(e)}else jQuery.goConfirm(r,n,function(){jQuery("#gpopupLayer").hide(),jQuery(this)[0].autoclose=!0,makeProcessLoader();if(isOcxUpload&&!uploadOcxFile())return;requestSendAction(e)},function(){cancelSend()})}function requestSendAction(e){var t=!1,n={},r=[],i=[],s=[],o=[];e.attachList=getAttachString();if(isOcxUpload){var u=document.uploadForm.powerupload,a=u.GetAttachedFileCount(),f,l;for(var c=0;c<a;c++)f=u.GetAttachedFileAttr(c,"TYPE"),l=u.GetAttachedFileAttr(c,"UID"),f=="huge"&&(!l||l=="")&&(t=!0,r.push(c),i.push(u.GetAttachedFileAttr(c,"FILENAME")),s.push(u.GetAttachedFileAttr(c,"FILEPATH")),o.push(u.GetAttachedFileAttr(c,"SIZE")))}else{var h=basicAttachUploadControl.getFileList("huge"),l;if(h)for(var c=0;c<h.length;c++){l=h[c].uid;if(!l||l==""||l=="0")t=!0,r.push(h[c].id),i.push(h[c].name),s.push(h[c].path),o.push(h[c].size)}}if(!t){var p=makeBigAttachContent();e.bigAttachContent=p.html,e.bigAttachMode=p.mode,e.bigAttachLinks=p.links,mailControl.sendMessage(e)}else n.hidx=r,n.hfileName=i,n.hfilePath=s,n.hfileSize=o,n.regdate=today.getTime(),mailControl.bigAttachUpdate(n,e);makeProcessLoader()}function sendForBigAttach(e,t){var n;if(isOcxUpload){var r=document.uploadForm.powerupload;for(var i=0;i<e.length;i++)n=r.GetAttachedFileAttr(parseInt(e[i].fileIndex),"attachid"),r.SetAttachedFileAttr2(n,"UID",e[i].messageUid)}else{var s;for(var i=0;i<e.length;i++)s=basicAttachUploadControl.getAttachFileInfo("huge",e[i].fileIndex),s.uid=e[i].messageUid,basicAttachUploadControl.setAttachFileInfo("huge",e[i].fileIndex,s)}var o=makeBigAttachContent();t.bigAttachContent=o.html,t.bigAttachMode=o.mode,t.bigAttachLinks=o.links,mailControl.sendMessage(t),destroyBasicUploadControl(),destroyMassUploadControl()}function processDraftHuseFile(){var e;if(isOcxUpload){var t=document.uploadForm.powerupload,n=t.GetAttachedFileCount();e=t.GetAttachedSize("HUGE");if(e>0&&!confirm(mailMsg.confirm_draftbigattach))return!1;for(var r=n-1;r>=0;r--)fileType=t.GetAttachedFileAttr(r,"attachtype"),fileType=="huge"&&(id=t.GetAttachedFileAttr(r,"attachid"),t.RemoveAttachFile(id))}else{e=basicAttachUploadControl.getAttachSize("hugeUse");if(e>0&&!confirm(mailMsg.confirm_draftbigattach))return!1;var i=basicAttachUploadControl.getFileList("huge");for(var r=0;r<i.length;r++)basicAttachUploadControl.deleteAttachList(i[r].id)}return!0}function viewQuickList(e){checkEscapeWriteMode(function(){var t={};t=mailControl.getSharedFolderParam(t),t.folder=currentFolderName,t.page=1,e=="TODAY"?(t.adv="on",t.sdate="TODAYS",t.edate="TODAYE"):e=="YESTERDAY"?(t.adv="on",t.sdate="YESTERDAYS",t.edate="YESTERDAYE"):t.flag=e,mailControl.loadMessageList(t)})}function makeTagToolbar(){var e=folderControl.getTagData();if(!e||e.length==0){jQuery.goAlert(mailMsg.mail_tag_empty);return}var t=getMailListCheckedIdArray(),n=0,r="tag";currentMenu=="read"&&layoutMode=="n"&&(r="read_"+r);for(var i=0;i<e.length;i++)for(var s=0;s<t.length;s++){var o=jQuery("#"+r+"_"+getFolderNameId(t[s])+"_"+e[i].id).length;if(o>0){n++,e[i].containsTag=!0;break}e[i].containsTag=!1}jQuery("#mailListTagBox").width(n>0?LOCALE=="en"?"265px":"250px":"205px"),mailControl.makeToolbarTagList(e)}function makeCopyMoveToolbar(){var e=folderControl.getUserFolderList();e.isInbox=!0,jQuery("#toolbarInboxMoveMessageList").handlebars("mail_toolbar_user_folder_tmpl",e),jQuery("#toolbarInboxMoveMessageList li").length>0&&jQuery("#inboxToggleFolder").show(),e.isInbox=!1,jQuery("#toolbarMoveMessageList").handlebars("mail_toolbar_user_folder_tmpl",e),jQuery("#checkMessageCopy").attr("checked",!1)}function messageTaggingManager(e,t){var n=getMailListCheckedIdArray(),r=getListProcessParams(n),i={addFlag:t,tagId:e,folderNames:r.fnames,uids:r.uids};mailControl.taggingMessage(i)}function selfRemoveMessageTagging(e,t,n){var r={addFlag:"false",tagId:n,folderNames:[e],uids:[t]};mailControl.taggingMessage(r)}function deleteMessage(){var e=isContainedTrashMail();if(!e&&currentFolderType!="trash"&&currentFolderType!="reserved")deleteMessageAction();else{var t="";e||currentFolderType=="trash"?t=mailMsg.confirm_trashdelete:currentFolderType=="reserved"&&(t=mailMsg.confirm_reserveddelete),jQuery.goConfirm(mailMsg.mail_message_delete,t,function(){deleteMessageAction()})}}function deleteMessageAction(){var e="on"==jQuery("#mailListAllCheck").val();if(e)allSelectAction("delete","");else{var t=getMailListCheckedIdArray(),n=getListProcessParams(t),r={folderNames:n.fnames,uids:n.uids};mailControl.deleteMessages(r)}}function deleteMdn(){var e=new Array;getMailListCheckedObj().each(function(){e.push(jQuery(this).val())}),mailControl.deleteMdn({messageIds:e})}function cleanMessage(){var e="on"==jQuery("#mailListAllCheck").val(),t=getMailListCheckedCount(),n=jQuery("#pageNaviWrap").data("total");t=e?n:t,jQuery.goConfirm(mailMsg.menu_deleteforever,msgArgsReplace(mailMsg.confirm_clean,[t]),function(){jQuery("#gpopupLayer").hide(),jQuery(this)[0].autoclose=!1;if(e)allSelectAction("clean","");else{var t=getMailListCheckedIdArray(),n=getListProcessParams(t),r={folderNames:n.fnames,uids:n.uids};mailControl.cleanMessages(r)}})}function downloadMessage(){var e=getMailListCheckedIdArray(),t=getListProcessParams(e),n={folder:t.fnames,uids:t.uids};n=mailControl.getSharedFolderParam(n),e.length>1&&jQuery.goAlert(mailMsg.mail_attach_all_save_title,mailMsg.mail_attach_all_save_message),mailControl.downloadMessages(n)}function copyMoveMessage(e){var t="move";if(jQuery("#checkMessageCopy").attr("checked")||jQuery("#onlyMessageCopy").attr("checked"))t="copy";var n="on"==jQuery("#mailListAllCheck").val();if(n)allSelectAction(t,e);else{var r=getMailListCheckedIdArray(),i=getListProcessParams(r),s={fromFolders:i.fnames,uids:i.uids,toFolder:e};t=="copy"?mailControl.copyMessage(s):t=="move"&&mailControl.moveMessage(s)}}function allSelectAction(e,t){var n=mailControl.getListParam();n.actionType=e,n.targetFolder=t,mailControl.allSelectMessageProcess(n)}function changeSeenFlag(e){var t=getMailListCheckedIdArray(),n=getListProcessParams(t),r="seen",i="on"==jQuery("#mailListAllCheck").val();if(i){var s=mailControl.getListParam();s.actionType=r,s.targetFolder="",s.flagType="S",s.used=e,mailControl.allSelectMessageProcess(s)}else mailControl.switchMessagesFlags(n.uids,n.fnames,"S",e)}function replyWrite(e){if(getMailListCheckedCount()>1){jQuery.goAlert(mailMsg.error_replyone);return}var t=getMailListCheckedIdArray(),n=getListProcessParams(t),r={};r.folderName=n.fnames[0],r.uids=n.uids,r.wtype=e,mailControl.getSharedFolderParam(r),goWrieLoad(r)}function forwardMessage(e){var t=getMailListCheckedIdArray(),n=getListProcessParams(t),r={};r.folderName=n.fnames[0],r.uids=n.uids,r.fwmode=e,r.wtype="forward",mailControl.getSharedFolderParam(r),goWrieLoad(r)}function printMessage(){if(getMailListCheckedCount()>1){jQuery.goAlert(mailMsg.error_printone);return}var e=getMailListCheckedIdArray(),t=getListProcessParams(e),n={};n.folder=t.fnames[0],n.uid=t.uids[0],n=mailControl.getSharedFolderParam(n),n.viewImg=!0,n.action="print",POPUPDATA=n,window.open("/app/mail/popup","printPopup","scrollbars=yes,width=1280,height=640,resizable=yes")}function addMessageFilter(){if(getMailListCheckedCount()>1){jQuery.goAlert(mailMsg.mail_filter_select_one);return}var e=folderControl.getUserFolderList(),t=folderControl.getTagData(),n=getMailListCheckedObj(),r,i;MAIL_EXPOSURE?(r=jQuery.trim(get_email(n.data("femail"))),i=jQuery.trim(get_email(n.data("temail")))):(r=getEmailNotInCompanyDomain(companyDomainList,n.data("femail")),i=getEmailNotInCompanyDomain(companyDomainList,n.data("temail")));var s="";currentMenu=="read"&&layoutMode=="n"?s=n.attr("subject"):s=jQuery.trim(n.closest("tr").find("span.subject").text());var o={from:r,to:i,subject:s,folderList:e,tagList:t};jQuery.goPopup({id:"mail_message_filter_popup",pclass:"layer_normal layer_auto",header:mailMsg.menu_rule,width:500,contents:getHandlebarsTemplate("mail_layer_filter_tmpl",o),openCallback:function(){jQuery("#mail_message_filter_popup input[name='filterCondOption']").click(function(){jQuery("#mail_message_filter_popup input[name='filterCondOption']:checked").length>1?jQuery("#filterCondOperationWrap").show():jQuery("#filterCondOperationWrap").hide()}),jQuery("#mail_message_filter_popup  input[placeholder]").placeholder(),jQuery("#mail_message_filter_popup div.layer_pallete").on("click","a",function(e){jQuery("#mail_message_filter_popup div.layer_pallete a").removeClass("active"),jQuery(this).addClass("active"),setTimeout(function(){jQuery("#mail_message_filter_popup input[placeholder]").placeholder()},3e3)})},closeCallback:function(){jQuery("#mail_message_filter_popup div.layer_pallete").off()},buttons:[{btype:"confirm",btext:mailMsg.comn_confirm,callback:saveMessageFilter,autoclose:!1},{btype:"cancel",btext:mailMsg.comn_cancel}]})}function saveMessageFilter(){var e=jQuery("#mail_message_filter_popup input[name=filterCondOption]:checked");if(e.length==0){jQuery.goSlideMessage(mailMsg.comn_error_001,"caution");return}var t={},n=[],r=!0;e.each(function(){var e=jQuery(this).val();if(e=="from"){var t=jQuery.trim(jQuery("#filterFrom").val().toLowerCase());if(t=="")return jQuery.goSlideMessage(mailMsg.conf_filter_1,"caution"),jQuery("#filterFrom").focus(),r=!1,!1;n.push({field:"FROM",pattern:t})}else if(e=="to"){var t=jQuery.trim(jQuery("#filterTo").val().toLowerCase());if(t=="")return jQuery.goSlideMessage(mailMsg.conf_filter_1,"caution"),jQuery("#filterTo").focus(),r=!1,!1;n.push({field:"TO",pattern:t})}else if(e=="subject"){var t=jQuery.trim(jQuery("#filterSubject").val());if(t=="")return jQuery.goSlideMessage(mailMsg.conf_filter_1,"caution"),jQuery("#filterSubject").focus(),r=!1,!1;if(!validateInputValue(jQuery("#filterSubject"),0,255,"onlyBack"))return jQuery("#filterSubject").focus(),r=!1,!1;n.push({field:"SUBJECT",pattern:t})}});if(!r)return;t.subcondList=n;var i=jQuery("#mail_message_filter_popup input[name=filterOperation]:checked").val();t.operation=i;var s=jQuery("#mail_message_filter_popup input[name=filterOption]:checked").val(),o=!1,u="",a=!1,f="",l="";if(s=="extBox")t.policy="move "+jQuery("#filterFolder").val();else if(s=="newBox"){var c=jQuery("#filterNewMailBox"),h=jQuery.trim(c.val());if(h==""||c.hasClass("placeholder")){jQuery.goMessage(mailMsg.conf_filter_37),c.focus();return}if(!validateInputValue(c,2,32,"folderName"))return;var p=jQuery("#filterParentFolder").val();p==""?u=h:u=p+"."+h,o=!0}else if(s=="extTag"){var d=jQuery("#filterTagList").val();if(d==""){jQuery.goMessage(mailMsg.mail_tag_select_msg);return}t.policy="tag "+d}else{if(s!="newTag"){jQuery.goMessage(mailMsg.conf_filter_1);return}var v=jQuery("#filterNewTagName"),m=jQuery.trim(v.val());if(m==""||v.hasClass("placeholder")){jQuery.goMessage(mailMsg.mail_tag_add_msg),v.focus();return}if(!checkInputLength("jQuery",v,mailMsg.conf_filter_1,2,32))return;if(isExistTagName(m)){jQuery.goSlideMessage(mailMsg.alert_tag_samename,"caution");return}var g=folderControl.getTagData();if(g&&g.length>=300){jQuery.goMessage(mailMsg.mail_tag_insert_limit);return}a=!0,f=m;var y=jQuery("#filterNewTagList a.active").attr("color");l=y}if(o)folderControl.addFolderAfterFunc(u,function(){t.policy="move "+u,mailControl.saveMailFilter(t)});else if(a){var b={tagName:f,tagColor:l};folderControl.addTagAfterFunc(b,function(){folderControl.getTagListAfterFunc(function(e){folderControl.makeTagList(e);var n="";for(var r=0;r<e.length;r++)if(e[r].name==m){n=e[r].id;break}t.policy="tag "+n,mailControl.saveMailFilter(t)})})}else mailControl.saveMailFilter(t)}function saveMessageFilterResult(e,t){jQuery.goConfirm(mailMsg.menu_rule,mailMsg.list_filter01,function(){jQuery("#gpopupLayer").hide(),jQuery(this)[0].autoclose=!1,makeProcessLoader(),sortFilterList(e)})}function sortFilterList(e){var t={},n=e.policy,r=n.split(" ")[0];r=="tag"?(t.storeTag=!0,t.tagId=jQuery.trim(replaceAll(n,"tag",""))):t.toFolder=jQuery.trim(replaceAll(n,"move","")),t.fromFolder=mailControl.getCurrentFolder();var i=e.subcondList;if(i&&i.length>0)for(var s=0;s<i.length;s++)i[s].field=="FROM"?t.from=i[s].pattern:i[s].field=="TO"?t.to=i[s].pattern:i[s].field=="SUBJECT"&&(t.subject=i[s].pattern);mailControl.sortFilterMessage(t)}function addSpamWhiteRule(e){var t=e=="black"?mailMsg.reportspam_title:mailMsg.reportham_title,n=e=="black"?"mail_layer_spam_tmpl":"mail_layer_white_tmpl";jQuery.goPopup({id:"mail_add_spam_white_popup",pclass:"layer_normal",header:t,width:300,openCallback:function(){jQuery("#mail_add_spam_white_popup").data("type",e)},contents:getHandlebarsTemplate(n),buttons:[{btype:"confirm",btext:mailMsg.comn_confirm,callback:saveSpamWhiteRule,autoclose:!1},{btype:"cancel",btext:mailMsg.comn_cancel}]})}function saveSpamWhiteRule(){var e=jQuery("#mail_add_spam_white_popup").data("type"),t=getMailListCheckedIdArray(),n=getListProcessParams(t),r=n.uids,i=n.fnames[0],s=[],o=!1,u=jQuery("#mail_add_spam_white_popup input:checkbox"),a=u.eq(0).attr("checked")?!0:!1,f=u.eq(1).attr("checked")?!0:!1,l;if(a){var c=getMailListCheckedData("femail");if(c&&c.length>0)for(var h=0;h<c.length;h++){l=get_email(c[h]).toLowerCase();if(l==USEREMAIL){o=!0;break}s[s.length]=l}if(o){jQuery.goSlideMessage(mailMsg.conf_forward_14,"caution");return}}var p={};p.ruleType=e,p.folderName=i,p.uids=r,p.fromEmails=s,p.addRule=a,p.moveBox=f,p.adminReport=!0,mailControl.addResistRule(p,saveSpamWhiteRuleResult)}function saveSpamWhiteRuleResult(e){e=="black"?jQuery.goMessage(mailMsg.bayesian_reportspam):jQuery.goMessage(mailMsg.bayesian_reportwhite),isPopupView()?(isReloadReady()&&opener.reloadMessageList(),window.close()):reloadMessageList(),jQuery.goPopup.close()}function registRejectAllow(e){var t="",n="";e=="black"?(t=mailMsg.mail_receivreject,n=mailMsg.confirm_denymsg):(t=mailMsg.mail_receivallow,n=mailMsg.confirm_allowmsg),jQuery.goConfirm(t,n,function(){var t=getMailListCheckedData("femail"),n=[],r,i=!1;if(t&&t.length>0)for(var s=0;s<t.length;s++){r=get_email(t[s]).toLowerCase();if(r==USEREMAIL){i=!0;break}n[n.length]=r}if(i){jQuery.goMessage(mailMsg.conf_forward_14);return}var o={};o.ruleType=e,o.addRule=!0,o.fromEmails=n,mailControl.addResistRule(o,registRejectAllowResult)})}function registRejectAllowResult(e){var t="",n="";e=="black"?(t=mailMsg.mail_receivreject,n=mailMsg.confirm_denyok):(t=mailMsg.mail_receivallow,n=mailMsg.confirm_allowok),jQuery.goConfirm(t,n,function(){moveRejectMsg(e)})}function moveRejectMsg(e){var t=getMailListCheckedIdArray(),n=getListProcessParams(t),r=n.uids,i=n.fnames[0],s={};s.ruleType=e,s.moveBox=!0,s.uids=r,s.folderName=i,mailControl.addResistRule(s,function(){isPopupView()?(isReloadReady()&&opener.reloadMessageList(),window.close()):mailControl.reloadMessageList()})}function emptyFolder(e){var t="";e=="Trash"?t=mailMsg.confirm_emptytrash:e=="Spam"?t=mailMsg.confirm_emptyspam:t=mailMsg.mail_folder_delete_alert,jQuery.goConfirm(mailMsg.mail_folder_empty,t,function(){var t={folderName:e};folderControl.emptyMailFolder(t,function(){e==currentFolderName?mailControl.reloadMessageList():(executeFolderInfo(),isFolderManageMenu()&&mailSettingControl.loadViewFolderManage())})}),jQuery("#gpopupLayer").width("410")}function reWrite(){if(getMailListCheckedCount()>1){jQuery.goAlert(mailMsg.error_rewrite);return}var e=getMailListCheckedIdArray(),t=getListProcessParams(e),n={};n.folderName=t.fnames[0],n.uids=t.uids,n.wtype="rewrite",goWrieLoad(n)}function recallMsg(){var e=getMailListCheckedValue(),t=jQuery("#mdnReadUid").val(),n=jQuery("#mdnMessageId").val(),r=jQuery("#mdnMessageSubject").val();jQuery.goConfirm(mailMsg.mail_mdn_recall,mailMsg.mail_mdn_confirm,function(){var i={};i.messageId=n,i.uid=t,i.subject=r,i.recallEmails=e,mailControl.recallMessage(i)})}function recallSelectMsg(){if(getMailListCheckedCount()>1){jQuery.goAlert(mailMsg.error_recall);return}jQuery.goConfirm(mailMsg.mail_mdn_recall,mailMsg.mail_mdn_confirm,function(){var e=jQuery("input[name='msgId']:checked"),t=e.val(),n=e.attr("subject"),r={messageId:t,subject:n,recallAll:!0};mailControl.recallMessage(r)})}function searchRcptAddress(){var e=jQuery("#writeRcptValue"),t=jQuery.trim(e.val()),n=[],r=[],i=[];if(t==""){jQuery.goMessage(mailMsg.alert_addr_search_nostr),e.focus();return}var s=t.indexOf(",")>-1,o=t.indexOf(";")>-1;s||o?s?n=t.split(","):o&&(n=t.split(";")):n.push(t);for(var u=0;u<n.length;u++){var t=jQuery.trim(n[u]);if(!checkInputSearchAddr(t,2,255,!0))break;isEmail(t)?r.push(t):i.push(t)}if(i.length>0){var a={keywords:i,equalSearch:!1};mailControl.searchAddressByKeyowrd(a,function(e){searchRcptResult(e)})}if(r.length>0)for(var u=0;u<r.length;u++)makeSearchAddressUnitFormat(r[u]);e.val(""),e.focus()}function searchRcptResult(e){if(e.singleAddressList.length==0&&e.multiAddressList.length==0){jQuery.goMessage(mailMsg.alert_addr_search_noresult);return}var t=e.singleAddressList,n=e.multiAddressList;for(var r=0;r<t.length;r++)makeSearchAddressUnitFormat(t[r].address);n.length>0&&makeRcptSelectPopup(n,applyRcptSearchAddress)}function applyRcptSearchAddress(){jQuery("#mail_write_multi_search_result_popup input[name=emailCheck]:checked").each(function(){makeSearchAddressUnitFormat(jQuery(this).val())}),jQuery.goPopup.close()}function applyRcptAddress(e){var t=jQuery("#mail_write_multi_search_result_popup input[name=emailCheck]:checked");if(t.length==0){jQuery.goMessage(mailMsg.comn_error_001);return}var n=jQuery("#"+e+"AddrWrap li span.name");t.each(function(){var t=this;makeAddressUnitFormat(e,jQuery(this).val()),n.each(function(){jQuery(t).data("name")==jQuery(this).data("email")&&jQuery(this).closest("li").remove()})}),jQuery.goPopup.close();if(SearchByNameInfo.emptyKeywordList&&SearchByNameInfo.emptyKeywordList.length>0){var n=jQuery("#"+e+"AddrWrap li span.name");for(var r=0;r<SearchByNameInfo.emptyKeywordList.length;r++){var i=SearchByNameInfo.emptyKeywordList[r];n.each(function(){i==jQuery(this).data("email")&&jQuery(this).closest("li").addClass("invalid")})}}else queryByRcptName()}function makeRcptSelectPopup(e,t){e.mailExposure=MAIL_EXPOSURE,jQuery.goPopup({id:"mail_write_multi_search_result_popup",pclass:"layer_normal",header:mailMsg.mail_rcptadd,width:600,contents:getHandlebarsTemplate("mail_write_multi_search_result_tmpl",e),openCallback:function(){jQuery("#mail_write_multi_search_result_popup").on("click","#writeMultiSearchCheckAll",function(){var e=jQuery("#mail_write_multi_search_result_popup input[name=emailCheck]:checkbox");jQuery(this).attr("checked")?e.attr("checked",!0):e.attr("checked",!1)})},closeCallback:function(){jQuery("#mail_write_multi_search_result_popup").off()},buttons:[{btype:"confirm",btext:mailMsg.comn_confirm,callback:t,autoclose:!1},{btype:"cancel",btext:mailMsg.comn_cancel}]})}function searchRcptAddrName(){var e=makeRcptForm();SearchByNameInfo.searchAddrValueList.push({type:"to",list:e.to}),SearchByNameInfo.searchAddrValueList.push({type:"cc",list:e.cc}),SearchByNameInfo.searchAddrValueList.push({type:"bcc",list:e.bcc}),queryByRcptName()}function searchRcptAddrOneName(e,t){if(jQuery.trim(t)=="")return;var n={};e=="to"?(n.to=t,SearchByNameInfo.searchAddrValueList.push({type:"to",list:n.to})):e=="cc"?(n.cc=t,SearchByNameInfo.searchAddrValueList.push({type:"cc",list:n.cc})):e=="bcc"?(n.bcc=t,SearchByNameInfo.searchAddrValueList.push({type:"bcc",list:n.bcc})):e=="edit"&&(n.edit=t,SearchByNameInfo.searchAddrValueList.push({type:"edit",list:n.edit})),queryByRcptName()}function queryByRcptName(){SearchByNameInfo.emptyListFlag=!1,SearchByNameInfo.emptyKeywordList=[],SearchByNameInfo.rcptType="";var e=SearchByNameInfo.searchAddrValueList.pop();if(e){var t=e.list,n=e.type;SearchByNameInfo.rcptType=n;if(!t||jQuery.trim(t)==""){queryByRcptName();return}var r=[],i=[],s=[],o=2,u=t.indexOf(",")>-1,a=t.indexOf(";")>-1;u||a?u?r=t.split(","):a&&(r=t.split(";")):r.push(t);for(var f=0;f<r.length;f++){var l=jQuery.trim(r[f]);if(l==""||l.length==0)continue;if(!checkInputSearchAddr(l,o,255,!0))break;checkEmailFormat(l)?i.push(l):s.push(l)}if(i.length>0)for(var f=0;f<i.length;f++){var c=jQuery("#"+n+"AddrWrap li span.name");c.each(function(){i[f]==jQuery(this).data("email")&&jQuery(this).closest("li").remove()}),makeAddressUnitFormat(n,i[f])}if(!(s.length>0)){queryByRcptName();return}var h={keywords:s};mailControl.searchAddressByKeyowrd(h,function(e){resultQueryByRcptName(n,e)})}}function resultQueryByRcptName(e,t){if(!t.singleAddressList&&!t.multiAddressList){SearchByNameInfo.rcptMultiResultType="empty";var n=jQuery("#"+e+"AddrWrap li span.name");for(var r=0;r<t.emptyAddressList.length;r++){var i=t.emptyAddressList[r];n.each(function(){i==jQuery(this).data("email")&&jQuery(this).closest("li").addClass("invalid")})}return}var s=t.singleAddressList,o=t.multiAddressList,u=t.emptyAddressList;if(s.length>0){var n=jQuery("#"+e+"AddrWrap li span.name");for(var r=0;r<s.length;r++)makeAddressUnitFormat(e,s[r].address,s),n.each(function(){s[r].personal==jQuery(this).data("email")&&jQuery(this).closest("li").remove()})}u.length>0&&(SearchByNameInfo.emptyListFlag=!0,SearchByNameInfo.emptyKeywordList=u);if(o.length>0)SearchByNameInfo.rcptMultiResultType="normal",makeRcptSelectPopup(o,function(){applyRcptAddress(e)});else if(SearchByNameInfo.emptyListFlag){SearchByNameInfo.rcptMultiResultType="empty";var n=jQuery("#"+e+"AddrWrap li span.name");for(var r=0;r<u.length;r++){var i=u[r];n.each(function(){i==jQuery(this).data("email")&&jQuery(this).closest("li").addClass("invalid")})}}else queryByRcptName()}function deleteFolder(e){jQuery.goConfirm(mailMsg.mail_folder_delete,mailMsg.confirm_delete_folder,function(){folderControl.deleteFolder(e,function(){e==currentFolderName&&goFolder("Inbox"),isFolderManageMenu()&&mailSettingControl.loadViewFolderManage(),childrenFnameForModify=null})})}function popupWriteLoad(e){POPUPDATA=e,e.action="write";var t="writePopup"+makeRandom(),n="scrollbars=yes, resizable=yes, width=1280";window.screen&&window.screen.height&&window.screen.availTop&&window.screen.height+window.screen.availTop<790?n+=", height="+(window.screen.height+window.screen.availTop):n+=", height=790",popWriteWin=window.open("/app/mail/popup",t,n)}function addBookmark(){if(bookmarkType=="tag"){var e=getTagInfo(bookmarkValue);bookmarkName=e.name}else bookmarkType=="unseen"?(bookmarkName="unseen",bookmarkValue="unseen"):bookmarkType=="flaged"?(bookmarkName="flaged",bookmarkValue="flaged"):bookmarkType=="today"&&(bookmarkName="today",bookmarkValue="today");var t={bookmarkType:bookmarkType,bookmarkName:bookmarkName,bookmarkValue:bookmarkValue};folderControl.saveBookmark(t)}function deleteBookmark(){bookmarkType=="unseen"?bookmarkValue="unseen":bookmarkType=="flaged"?bookmarkValue="flaged":bookmarkType=="today"&&(bookmarkValue="today");var e={bookmarkType:bookmarkType,bookmarkValue:bookmarkValue};folderControl.deleteBookmark(e)}function toggleAllCheckMessage(e){var t=jQuery("#pageNaviWrap"),n=t.data("total"),r=t.data("pagebase");if(n<=r)return;e?(selectAllMessageOff(),jQuery("#allSelectTr").show()):(jQuery("#allSelectTr").hide(),jQuery("#mailListAllCheck").val("off"))}function selectAllMessageOn(){jQuery("#allSelectMsg1").empty(),jQuery("#allSelectMsg2").empty(),jQuery("#allSelectMsg3").empty(),jQuery("#allSelectMsg1").text(mailMsg.allselect_007),jQuery("#allSelectMsg2").text(mailMsg.allselect_005);var e=jQuery("<a evt-rol='select-all-message-off'></a>").append(mailMsg.allselect_009);jQuery("#allSelectMsg3").append(e),jQuery("#mailListAllCheck").val("on"),displayToolbarBySelectAll()}function selectAllMessageOff(){jQuery("#allSelectMsg1").empty(),jQuery("#allSelectMsg2").empty(),jQuery("#allSelectMsg3").empty();var e=jQuery("#pageNaviWrap").data("total");jQuery("#allSelectMsg1").text(mailMsg.allselect_001),jQuery("#allSelectMsg2").text(msgArgsReplace(mailMsg.allselect_002,[e]));var t=jQuery("<a evt-rol='select-all-message-on'></a>").append(mailMsg.allselect_008);jQuery("#allSelectMsg3").append(t),jQuery("#mailListAllCheck").val("off"),displayToolbarBySelectAll()}function displayToolbarBySelectAll(){jQuery.each(jQuery("#toolbar_wrap .critical").children().not("[evt-rol=list-select-all]"),function(e,t){if(jQuery(t).find('a[evt-act="toolbar-message-delete"]').length>0)jQuery("#mailListAllCheck").val()=="on"?(jQuery(t).find('[evt-rol="toolbar-attach-delete"]').css({opacity:"0.3",cursor:"default"}),jQuery(t).find('[evt-rol="toolbar-attach-delete"]').attr("evt-rol","")):(jQuery(t).find('[evt-rol=""]').css({opacity:"",cursor:"pointer"}),jQuery(t).find('[evt-rol=""]').attr("evt-rol","toolbar-attach-delete"));else{if(jQuery(t).find('a[evt-act="change-flag-seen"]').length>0)return!0;if(jQuery(t).find('a[menu="move"]').length>0)return!0;jQuery("#mailListAllCheck").val()=="on"?(jQuery(t).css("opacity","0.3"),jQuery(t).find('[evt-rol="toolbar"]').andSelf().attr("evt-rol",""),jQuery(t).children().andSelf().css("cursor","default")):(jQuery("#toolbar_wrap .critical").children().css("opacity",""),jQuery(t).find('[evt-rol=""]').andSelf().attr("evt-rol","toolbar"),jQuery(t).children().andSelf().css("cursor","pointer"))}})}function addAddrBookEmail(e){var t=get_name(e),n=get_email(e);jQuery.get("/api/contact/personal/group",function(e){var r={name:t,email:n,groupList:e.data};jQuery.goPopup({id:"mail_add_addrbook_email_popup",pclass:"layer_normal layer_add_address",header:mailMsg.menu_addaddr,width:300,contents:getHandlebarsTemplate("mail_add_addr_email_tmpl",r),buttons:[{btype:"confirm",btext:mailMsg.comn_confirm,autoclose:!1,callback:saveAddrBookEmail},{btype:"cancel",btext:mailMsg.comn_cancel}]})})}function saveAddrBookEmail(){var e=jQuery.trim(jQuery("#addrMemberName").val());if(!validateInputValue(jQuery("#addrMemberName"),2,64,"userName"))return;var t=jQuery.trim(jQuery("#addrMemberEmail").val()),n=jQuery.trim(jQuery("#addrMemberGroup").val()),r={name:e,email:t};n&&(r.groupIds=[n]),mailControl.saveMemberAddress(r),jQuery.goPopup.close()}function openAddrLayerPopup(e){var t=jQuery(e).data("email"),n={email:t,useContact:USE_CONTACT&&MAIL_EXPOSURE},r=jQuery(e).parent().find("div.layerPop");r.html(getHandlebarsTemplate("mail_email_layer_menu_tmpl",n));var i={clickObj:jQuery(e)};jQuery(r).dropDownMenu(i)}function closeAddrLayerPopup(e){jQuery(e).closest("div.layerPop").empty()}function readViewImg(e,t){var n={};n.folder=e,n.uid=t,n.viewImg=!0,n=mailControl.getSharedFolderParam(n),mailControl.readMessage(n)}function registBayesianRuleMessage(e,t,n){var r={};r.ruleType=e,r.folderName=t,r.uid=n,mailControl.registBayesianRule(r)}function confirmIntegrity(e,t){jQuery("#integrityMsg").text(mailMsg.mail_integrity_check),jQuery("#integrityBtn").hide();var n={};n.folderName=e,n.uid=t,mailControl.messageIntegrity(n,function(e){updateIntegrity(e)})}function updateIntegrity(e){var t=jQuery("#integrityMsg");e=="match"?t.text(mailMsg.mail_integrity_match):e=="no-match"?t.text(mailMsg.mail_integrity_nomatch):e=="no"?t.text(mailMsg.mail_integrity_no):e=="error"&&t.text(mailMsg.mail_integrity_error),jQuery("#integrityBtn").show()}function getCheckSendInfoValue(e){var t=new Array;return jQuery("#mail_send_allow_check_popup input[name="+e+"Addr]:checked").each(function(){t.push(jQuery(this).val())}),t}function loadBasicSetting(){mailSettingControl.loadBasicSetting()}function loadMdnList(){checkEscapeWriteMode(function(){layoutControl.contentNormalSplitter(),mailControl.loadMdnList(),hideSearchCancelBtn()})}function clearMassRcpt(){var e=document.massRcptUploadForm;e.reset(),e.massFilePath.value="",jQuery("#massRcptFile").show(),jQuery("#massRcptFileInfo").hide(),jQuery("#massFileName").empty(),jQuery("#massFileSize").empty()}function openWriteAddrRcptPopup(e){jQuery.goPopup({id:"mail_write_address_add_popup",pclass:"layer_normal layer_address",header:mailMsg.mail_searchaddr,width:980,modal:!0,contents:"<iframe id='writeAddrRcptFrame' name='writeAddrRcptFrame' scrolling='no' src='/app/contact/connector/all' frameborder='0' style='border:0;width:100%;height:470px;overflow: hidden;'></iframe><div id='popOverlay' data-overlay style='position:absolute !important;' class='overlay'><div class='processing'></div></div>",openCallback:function(e){e.draggable("option","containment","document"),jQuery("body").css("overflow","hidden")},closeCallback:function(){jQuery("body").css("overflow","auto")},buttons:[{btype:"confirm",btext:mailMsg.comn_confirm,autoclose:!1,callback:applyWriteAddrRcpt},{btype:"cancel",btext:mailMsg.comn_cancel}]})}function applyWriteAddrRcpt(){var e;isMsie?e=window.writeAddrRcptFrame.getAddrRcptList():e=document.getElementById("writeAddrRcptFrame").contentWindow.getAddrRcptList();var t=e.toList,n=e.ccList,r=e.bccList,i=!1;if(t&&t.length>0){for(var s=0;s<t.length;s++)insertRcptEmail("to",t[s]);i=!0}if(n&&n.length>0){for(var s=0;s<n.length;s++)insertRcptEmail("cc",n[s]);i=!0}if(r&&r.length>0){for(var s=0;s<r.length;s++)insertRcptEmail("bcc",r[s]);i=!0}if(!i){jQuery.goSlideMessage(mailMsg.mail_addr_popup_alert,"caution");return}jQuery.goPopup.close(function(){jQuery("body").css("overflow","auto")})}function closeMailWritePopup(){checkEscapeWriteMode(function(){try{isReloadReady()&&opener.reloadMessageList()}catch(e){}window.close()})}function previewAttach(e,t,n){var r={folderName:t,uid:e,part:n,type:"normal"};r=mailControl.getSharedFolderParam(r),r.action="previewAttach",POPUPDATA=r,window.open("/app/mail/popup","","resizable=yes,scrollbars=yes,status=yes,width=800,height=640")}function listCheckboxControl(e,t){if(t){e.attr("checked",!0).closest("tr").addClass("choice");var n=jQuery("#mail_list_content :checkbox").length,r=jQuery("#mail_list_content :checkbox:checked").length;n==r&&(jQuery("#mailListAllCheck").attr("checked",!0),toggleAllCheckMessage(!0)),layoutMode!="n"&&(ReadSubMessageChecker.hasCurrentItem()||(jQuery("#mailReadArea").handlebars("mail_read_checked_list_tmpl"),jQuery("#checkedListMessage").text(msgArgsReplace(mailMsg.mail_message_checked_list,[r]))))}else{e.attr("checked",!1).closest("tr").removeClass("choice"),jQuery("#mailListAllCheck").attr("checked")&&(jQuery("#mailListAllCheck").attr("checked",!1),toggleAllCheckMessage(!1));var r=jQuery("#mail_list_content :checkbox:checked").length;layoutMode!="n"&&(ReadSubMessageChecker.hasCurrentItem()||(jQuery("#mailReadArea").handlebars("mail_read_checked_list_tmpl"),r!=0?jQuery("#checkedListMessage").text(msgArgsReplace(mailMsg.mail_message_checked_list,[r])):jQuery("#mailReadArea").handlebars("mail_read_default_tmpl")))}}function showSearchCancelBtn(){var e=mailControl.getListMode(),t="107px",n="55px";if(e=="mdnlist"||e=="mdnread")t="126px",n="37px";jQuery("#mailSearchKeyWord").width(t),jQuery("#mailSearchCancelBtn").css("right",n).show()}function hideSearchCancelBtn(){jQuery("#mailSearchCancelBtn").hide().css("right","55px"),jQuery("#mailSearchKeyWord").width("126px"),jQuery("#mailSearchKeyWord").val(""),jQuery("#mailSearchKeyWord").placeholder()}function cancelSearch(){var e=mailControl.getListMode();if(e=="mdnlist")mailControl.loadMdnList();else if(e=="mdnread"){var t=jQuery("#mdnReadUid").val(),n={uid:t};mailControl.loadMdnRead(n)}else{var r=mailControl.getCurrentFolder();r=r=="all"?"Inbox":r;var n={folder:r};mailControl.loadMessageList(n)}hideSearchCancelBtn()}function makeMailBadgeCount(){}function openWebfolderPopup(e){jQuery.goPopup({id:"mail_read_attach_webfolder_popup",pclass:"layer_normal",header:mailMsg.mail_attach_webfolder_select,width:400,contents:"<iframe id='mailReadAttachWebfolderSelectFrame' name='mailReadAttachWebfolderSelectFrame' scrolling='no' src='/app/webfolder/popup/process' frameborder='0' style='border:0;width:100%;height:200px;overflow: hidden;'></iframe>"
,openCallback:function(t){t.draggable("option","containment","document"),t.data("attachInfo",e)},buttons:[{btype:"confirm",btext:mailMsg.comn_confirm,autoclose:!1,callback:saveMailReadAttachWebfolder},{btype:"cancel",btext:mailMsg.comn_cancel}]})}function saveMailReadAttachWebfolder(){var e;isMsie?e=window.mailReadAttachWebfolderSelectFrame.selectFileList():e=document.getElementById("mailReadAttachWebfolderSelectFrame").contentWindow.selectFileList();if(!e)return;var t=jQuery("#mail_read_attach_webfolder_popup").data("attachInfo"),n={};n.attachInfo=t,n.webfolderInfo=e,mailControl.webfolderAttachSave(n)}function openWriteWebfolder(){jQuery.goPopup({id:"mail_write_attach_webfolder_popup",pclass:"layer_normal",header:mailMsg.mail_attach_webfolder_write_attach,width:900,offset:isPopupWrite?{top:0,left:0}:null,contents:"<iframe id='mailWriteAttachWebfolderSelectFrame' name='mailWriteAttachWebfolderSelectFrame' scrolling='no' src='/app/webfolder/popup/process?path=selectFile' frameborder='0' style='border:0;width:100%;height:350px;overflow: hidden;vertical-align: top;'></iframe>",modal:!0,openCallback:function(e){webfolderAttachProcess=!1,jQuery("#mail_write_attach_webfolder_popup").addClass("layer_import_file"),e.draggable("option","containment","document")},closeCallback:function(e){webfolderAttachProcess=!1},buttons:[{btype:"confirm",btext:mailMsg.comn_confirm,autoclose:!1,callback:applyWriteWebfolderFile},{btype:"cancel",btext:mailMsg.comn_cancel}]})}function applyWriteWebfolderFile(){if(webfolderAttachProcess){jQuery.goMessage(mailMsg.mail_attach_webfolder_write_attach_process);return}var e;isMsie?e=window.mailWriteAttachWebfolderSelectFrame.writeAttachFile():e=document.getElementById("mailWriteAttachWebfolderSelectFrame").contentWindow.writeAttachFile();if(!e||!e.uids||e.uids.length==0)return;webfolderAttachProcess=!0,mailControl.webfolderWriteAttach(e,function(e){checkUploadfile(e),jQuery.goPopup.close()})}function getMailUserSender(){var e=jQuery("#senderUserEmail"),t=e.attr("sname"),n='"'+t+'" <'+USERLOGINEMAIL+">";e.empty(),e.append(jQuery("<option selected></option>").text(n).attr("value",n).attr("alias",!1)),mailControl.readMailUserSender(function(t){e.append(getHandlebarsTemplate("mail_write_sender_tmpl",t)),previousSenderEmail=e.val()})}function viewSendAllow(e){jQuery.goPopup({pclass:"layer_normal layer_mail_allowlist",header:mailMsg.sendallow_list,contents:getHandlebarsTemplate("mail_send_allow_list_tmpl",e),buttons:[{btype:"cancel",btext:mailMsg.comn_close}]})}function makeInputDropEvents(e){jQuery(e).droppable({accept:"ul.name_tag li:not(.creat)",tolerance:"pointer",over:function(e,t){jQuery("#dragHelperIcon").removeClass("ic_disallow").addClass("ic_allow")},out:function(e,t){jQuery("#dragHelperIcon").removeClass("ic_allow").addClass("ic_disallow")},drop:function(e,t){t.helper.remove();var n=jQuery(this).attr("sort");if(n&&"true"==n)return;var r=this,i=t.draggable.parent().find("li.on");i.length==0&&(i=t.draggable),i.each(function(){var e=jQuery(this).find("span.name"),t=null;e.data("info")&&(t=[],t.push({name:e.data("name"),companyName:e.data("companyName"),deptName:e.data("deptName"),title:e.data("position")})),makeAddressUnitFormat(jQuery(r).attr("area"),e.data("email"),t)}),i.remove()}})}function bindAddrAreaEvents(e){jQuery(e).sortable({items:"li:not(:last-child)",containment:"#mailWriteAreaTable",appendTo:"body",cursorAt:{top:10,left:-5},scroll:!1,change:function(e,t){t.placeholder.css({background:"gray",opacity:"0.3",width:"100px",visibility:"visible",border:"1px solid"}).removeClass("out")},over:function(e,t){jQuery(this).attr("sort",!0)},out:function(e,t){jQuery(this).attr("sort",!1)},helper:function(e,t){var n="",r=t.length||0;r>0?n=t.context.textContent:n=jQuery(this).find("span.name").text();var i={message:n};return getHandlebarsTemplate("mail_dnd_tmpl",i)}}).disableSelection()}function selectAddressFieldkeyEvt(e){var t=16,n=17,r=37,i=39,s=65,o=67,u=8,a=46,f=e.closest("ul.name_tag"),l=f.find("li:not(.creat)"),c=l.size(),h=l.first(),p=new Array,d=null,v=jQuery("#toAddrWrap").find("li:not(.creat)"),m=jQuery("#ccAddrWrap").find("li:not(.creat)"),g=jQuery("#bccAddrWrap").find("li:not(.creat)"),y=v.first(),b=m.first(),w=g.first(),E=v.size(),S=m.size(),x=g.size(),T=f.closest("div.div_ipt").attr("id");T!="toAddrWrap"&&(jQuery(document).unbind("keydown"),initSelectField(y,E)),T!="ccAddrWrap"&&(jQuery(document).unbind("keydown"),initSelectField(b,S)),T!="bccAddrWrap"&&(jQuery(document).unbind("keydown"),initSelectField(w,x));for(var N=0;N<c;N++)N==0?(h.removeClass("on"),d=h.next()):(d.removeClass("on"),d=d.next());e.addClass("on");var C=l.index(e),k=l.index(h),L=k+c-1;C==-1&&(c=l.size(),h=l.first()),ctrlDown=!1,shiftDown=!1,ctrlPlusA=!1,ctrlPlusClick=!1,jQuery(document).keydown(function(v){if(v.keyCode==n){ctrlDown=!0;for(var m=0;m<c;m++)m==0?(h.find("span.name").attr("evt-rol","multi-select-field"),d=h.next()):(d.find("span.name").attr("evt-rol","multi-select-field"),d=d.next());v.preventDefault()}C!=-1&&(v.keyCode==u||v.keyCode==a)&&(window.event?window.event.returnValue=!1:v.returnValue=!1,f.find("li.on").remove());if(v.keyCode==t){window.event?window.event.returnValue=!1:v.returnValue=!1,shiftDown=!0;for(var m=0;m<c;m++)m==0?(h.find("span.name").attr("evt-rol","multi-select-fields"),d=h.next()):(d.find("span.name").attr("evt-rol","multi-select-fields"),d=d.next());v.preventDefault()}if(ctrlDown&&v.keyCode==o){ctrlDown=!1;for(var m=0;m<c;m++)m==0?(h.hasClass("on")&&p.push(h.find("span.name").data("email")),h.find("span.name").attr("evt-rol","select-field"),d=h.next()):(d.hasClass("on")&&p.push(d.find("span.name").data("email")),d.find("span.name").attr("evt-rol","select-field"),d=d.next());if(window.clipboardData){var g="";for(var m=0;m<p.length;m++)m!=p.length-1?g+=p[m]+",":g+=p[m];window.clipboardData.setData("text",g),v.preventDefault(),jQuery(document).unbind("keydown")}else{var g="";for(var m=0;m<p.length;m++)m!=p.length-1?g+=p[m]+",":g+=p[m];var y=jQuery("#hiddenCopyTextEl");if(!y||y.length==0)y=jQuery("<textarea></textarea>").css({position:"absolute",left:"-9999px",top:"0",id:"hiddenCopyTextEl"}),jQuery("body").append(y);y.val(g),y.focus(),y[0].setSelectionRange(0,y.val().length);try{document.execCommand("copy")}catch(b){}y.val(""),v.preventDefault(),jQuery(document).unbind("keydown")}}ctrlDown&&v.keyCode==s&&(window.event?window.event.returnValue=!1:v.returnValue=!1,ctrlPlusA=!0,l.addClass("on")),v.keyCode==i&&C!=L&&(shiftDown?(e.next().hasClass("on")?e.removeClass("on"):e.next().addClass("on"),e=e.next(),C=l.index(e)):(e.removeClass("on"),e.next().addClass("on"),e=e.next(),jQuery(document).unbind("keydown"),selectAddressFieldkeyEvt(e))),v.keyCode==r&&C!=k&&(shiftDown?(e.prev().hasClass("on")?e.removeClass("on"):e.prev().addClass("on"),e=e.prev(),C=l.index(e)):(e.removeClass("on"),e.prev().addClass("on"),e=e.prev(),jQuery(document).unbind("keydown"),selectAddressFieldkeyEvt(e)))}).keyup(function(e){if(e.keyCode==n||e.keyCode==t){ctrlDown=!1,shiftDown=!1;for(var r=0;r<c;r++)r==0?(h.find("span.name").attr("evt-rol","select-field"),d=h.next()):(d.find("span.name").attr("evt-rol","select-field"),d=d.next());e.preventDefault()}})}function initSelectField(e,t){var n=null;for(var r=0;r<t;r++)r==0?(e.find("span.name").attr("evt-rol","select-field"),e.removeClass("on"),n=e.next()):(n.find("span.name").attr("evt-rol","select-field"),n.removeClass("on"),n=n.next())}function inlineImgUploadLayer(e){var t={useFlash:hasFlashPlayer()},n=this,r=jQuery.goPopup({id:"mail_inline_img_upload",header:mailMsg.common_upload_picture,width:"250px",pclass:"layer_normal layer_date_set",contents:"<div style='text-align:center'>"+getHandlebarsTemplate("mail_inline_img_upload_tmpl",t)+"</div>",modal:!0,closeCallback:function(){hasFlashPlayer()&&jQuery("#swfupload-control").swfupload("destroy")},openCallback:function(e){var t={locale:LOCALE,param:{maxImageSize:"1024000",uploadType:"flash",email:USER_EMAIL},popupContents:e};hasFlashPlayer()?inlineImgUploadControl=new MailInlineImgControl(t):(inlineImgUploadControl=new MailSimpleInlineImgControl(t),jQuery("#mailSimpleInlineImgUpload").fileupload({url:"/api/mail/image/upload",formData:{uploadType:"flash",maxImageSize:jQuery("#maxImageSize").val()},dataType:"json",pasteZone:null,done:function(t,n){var r=n.result;if(r.errorMessage==""){var i='<img src="'+r.fileURL+'" title="'+r.fileName+'"/>';editorControl.addEditorText(i),e.close()}else jQuery.goSlideMessage(r.errorMessage,"caution")}})),inlineImgUploadControl.makeBtnControl()}});return this}function moreFolder(e){var t=null,n={};e&&(t={top:e.top,left:e.left+90}),ActionLoader.getGoLoadAction(folderControl.folderAllInfoAction,n,function(e){var t=e.userFolders;t.isInbox=!0,jQuery.goPopup({id:"mail_more_folder_popup",pclass:"layer_normal layer_select layer_mailbox_detail ",header:mailMsg.mail_folder_more,width:400,modal:!1,contents:getHandlebarsTemplate("mail_more_folder_popup_tmpl"),openCallback:function(){jQuery("#selectMoreMailFolderPopup").on("click","a,span,ins,li,p",function(e){var t=jQuery(this).attr("evt-rol");if(!t)return;e.stopPropagation?e.stopPropagation():e.cancelBubble=!0,e.preventDefault();if(t=="toggle-mail-folder"){var n=jQuery(this).attr("status"),r=jQuery(this).attr("fid"),i=jQuery(this).closest("li").attr("depth");i=parseInt(i,10);var s=jQuery(this).closest("li").find("ul[depth='"+(i+1)+"']"),o="O";n=="open"?(s.hide(),jQuery(this).removeClass("close").addClass("open").attr({status:"close",title:mailMsg.comn_open}),o="C"):(s.show(),jQuery(this).removeClass("open").addClass("close").attr({status:"open",title:mailMsg.comn_close}))}else if(t=="folder"){var u=jQuery(this).attr("fname");goFolder(u),closeMailMoreFolderPopupLayer(),closeMailFolderOptionLayer()}else if(t=="unseen-folder"){var u=jQuery(this).attr("fname");goFolder(u,"U"),closeMailMoreFolderPopupLayer(),closeMailFolderOptionLayer()}else if(t=="receive-noti-list")loadMdnList(),closeMailMoreFolderPopupLayer(),closeMailFolderOptionLayer();else if(t=="empty-spam-folder")emptyFolder("Spam"),closeMailMoreFolderPopupLayer(),closeMailFolderOptionLayer();else if(t=="empty-trash-folder")emptyFolder("Trash"),closeMailMoreFolderPopupLayer(),closeMailFolderOptionLayer();else if(t=="mail-folder-option"){closeMailFolderOptionLayer();var a=jQuery(this).data("depth"),f=jQuery(this).attr("fname"),l=jQuery(this).parent().parent().find("p a");childrenFnameForModify=new Array(l.length),jQuery(this).parent().parent().find("p a").each(function(e){childrenFnameForModify[e]=jQuery(this).attr("fname")});var c=jQuery(this).data("share"),h=jQuery(this).data("shareseq"),p={folderName:f,depth:a,share:c,shareseq:h},d=jQuery(this).offset();p.useSharedfolder=useSharedfolder,jQuery.goPopup({id:"mailFolderOptionLayer",pclass:"layer_normal layer_context",width:115,modal:!1,isClose:!0,openCallback:function(){jQuery("#mailFolderOptionLayer header,#mailFolderOptionLayer footer").hide(),jQuery("#mailFolderOptionLayer div.content").css("padding","0"),jQuery("#mailFolderOptionLayer div.content").on("click","li",function(e){var t=jQuery(this).attr("evt-rol"),n=jQuery(this).parent().attr("folder");if(t=="empty-user-folder")emptyFolder(n);else if(t=="modify-folder")modifyFolder(n);else if(t=="delete-folder")deleteFolder(n);else if(t=="add-sub-folder")addSubFolder(n);else if(t=="share-folder"){openShareFolderSettingLayer(n);var r="on"==jQuery(this).parent().data("share");if(r){var i=jQuery(this).parent().data("shareseq");jQuery("#orgShareFlag").attr("checked",!0),jQuery("#orgShareFlag").data("shareSeq",i);var s={folderUid:i};folderControl.getSharringReaderList(s)}}else t=="upload-message"?(upfolderName=n,openUploadMessageLayer()):t=="move-folder"&&moveFolder(n)})},offset:{top:d.top,left:d.left+15},contents:getHandlebarsTemplate("mail_folder_option_tmpl",p),buttons:[]})}else t=="tmw-folder"&&window.open("tmwPopup.jsp")})},closeCallback:function(){},buttons:[{btype:"cancel",btext:mailMsg.comn_close}]});var n=e.defaultFolders,r=!1;if(n&&n.length>0)for(var i=0;i<n.length;i++){var s=n[i];s.fullName=="Quotaviolate"&&(r=!0);var o=jQuery("#"+s.id+"_more_num");o.empty();if(s.unseenCnt>0){var u=jQuery("<a></a>"),a=jQuery("<span class='num'></span>");a.text(s.unseenCnt),u.attr({"evt-rol":"unseen-folder",fname:s.fullName}),u.html(a),o.html(u),o.data("unseen",s.unseenCnt)}isMailBadgeUse&&s.fullName=="Inbox"&&(mailBadgeCount=s.unseenCnt)}r?jQuery("#more_df_quotaviolate").show():jQuery("#more_df_quotaviolate").hide(),t.isInbox=!0;var f=jQuery("#inbox_folder_popup_area");f.handlebars("mail_more_user_folder_tmpl",t);var l=jQuery("#inbox_toggle_more_btn");f.find("li.folder").length>0?(status=="C"?(l.addClass("open").removeClass("close").attr({status:"close",title:mailMsg.comn_open}),f.hide()):(l.addClass("close").removeClass("open").attr({status:"open",title:mailMsg.comn_close}),f.show()),l.show()):l.hide(),t.isInbox=!1,jQuery("#uf_more_folder_popup_area").handlebars("mail_more_user_folder_tmpl",t),jQuery("#selectMoreMailFolderPopup span").each(function(e){if(jQuery(this).attr("status")!=null){var t=jQuery(this).closest("li").attr("depth");t=parseInt(t,10);var n=jQuery(this).closest("li").find("ul[depth='"+(t+1)+"']");n.show(),jQuery(this).removeClass("open").addClass("close").attr({status:"open",title:mailMsg.comn_close})}})},"json")}function contactGoSlideMessage(e,t){jQuery.goSlideMessage(e,t||"caution")}function rcptSelectInfoPopup(e,t){jQuery.goPopup({id:"mail_write_multi_search_result_popup",pclass:"layer_normal",header:mailMsg.mail_search_name_title,width:600,contents:getHandlebarsTemplate("mail_write_rcpt_info_tmpl",e),openCallback:function(){jQuery("#mail_write_multi_search_result_popup").on("click","#writeMultiSearchCheckAll",function(){var e=jQuery("#mail_write_multi_search_result_popup input[name=emailCheck]:checkbox");jQuery(this).attr("checked")?e.attr("checked",!0):e.attr("checked",!1)})},closeCallback:function(){jQuery("#mail_write_multi_search_result_popup").off()},buttons:[{btype:"confirm",btext:mailMsg.comn_confirm,callback:t,autoclose:!1},{btype:"cancel",btext:mailMsg.comn_cancel}]})}function bigAttachBtnCheck(){jQuery("#bigAttachFlagCheck").is(":checked")?jQuery("#bigattachBtn").removeClass("action_off").addClass("action_on"):jQuery("#bigattachBtn").removeClass("action_on").addClass("action_off")}function directedApproverFilter(e){if(!isDirectedApprover())return!1;var t={};t.to=e.to,t.cc=e.cc,t.bcc=e.bcc,t.massRcpt=e.massRcpt;var n=!0;ActionLoader.postSyncGoLoadAction("/api/mail/address/search/external/domain",t,function(e){n=e},"json");var r=jQuery("#approverAddrWrap"),i=jQuery("#approverAddrWrap ul li");return i.length>0&&n?(n=!1,e.approver=jQuery("#approverAddrWrap li").attr("approver")):n?(openDirectedApproverPopup(),r.show()):(i.remove(),r.hide()),n}function isDirectedApprover(){return jQuery("#approverAddrWrap").attr("data")}function checkMassRcptToggleBtn(e){if(e){var t=getCookie("DO_MASSRCPT_CLOSE")=="on";t||(jQuery("#massRcptToggleBtn").removeClass("ic_arrow_down_type4").addClass("ic_arrow_up_type4").attr("title",mailMsg.comn_close),jQuery("#massRcptwrap").show())}}function attachChecklayer(){jQuery.goPopup({id:"attachChecklayer",header:mailMsg.mail_attach_check_layer_header,pclass:"layer_normal layer_prevent_receiveError",width:600,contents:getHandlebarsTemplate("mail_attch_check_layer"),openCallback:function(){jQuery("#attachChekLayerSubject").text(jQuery("#subjectTitle").text()),jQuery("#attachChekLayerListWrap").html(jQuery("#attachListWrap").html()),jQuery("#attachChekLayerFileCount").text(jQuery("#attachFileCount").text()),jQuery("#attachChecklayer").on("click","a,span,ins,li,p",function(e){var t=jQuery(this).attr("evt-rol");if(!t)return;e.stopPropagation?e.stopPropagation():e.cancelBubble=!0,e.preventDefault();var n=jQuery("#folderName").val(),r=jQuery("#msgUid").val(),i=jQuery(this).closest("li").attr("part");if(t=="download-attach")downloadAttach(n,r,i);else if(t=="download-tnef-attach"){var s=jQuery(this).attr("attkey");downLoadTnefAttach(n,r,i,s)}else if(t=="delete-attach")deleteAttachFile(n,r,i);else if(t=="delete-attach-all"){var o="";jQuery("#attachListWrap li").each(function(){jQuery(this).hasClass("deleted")||(o+=o==""?o:"_",o+=jQuery(this).attr("part"))}),deleteAllAttach(n,r,o)}else if(t=="preview-attach")previewAttach(r,n,i);else if(t=="save-webfolder"){var u={folderName:n,uid:r,part:i};jQuery("#shared_folder_wrap").find("p.title.on").length>0&&(u.sharedUserSeq=jQuery("#shared_folder_wrap").find("p.title.on").children().attr("seq"),u.sharedFolderName=n,u.sharedFlag="shared"),openWebfolderPopup(u)}})},buttons:[{btype:"close",autoclose:!0,btext:mailMsg.comn_close}]})}function checkSendMailCount(e){if(!isMaxSendMailCountUse||e.sendType=="draft")return!0;makeProcessLoader();var t=0,n=!0;jQuery.ajax({type:"POST",url:"/api/mail/recipientcount",data:{to:e.to,cc:e.cc,bcc:e.bcc},async:!1,success:function(e){t=e.data,removeProcessLoader()},error:function(){n=!1,removeProcessLoader()},dataType:"json"});if(!n)return!1;var r="";e.sendType=="reserved"&&(r=e.reservedDateUtc);var i=0;return jQuery.ajax({type:"POST",url:"/api/mail/sendmailcount",data:{sendType:e.sendType,reservedDateUtc:r},async:!1,success:function(e){i=e.data},dataType:"json"}),t+i>maxSendMailCount?(jQuery.goAlert(mailMsg.mail_max_send_message_001),!1):!0}function isFolderManageMenu(){return currentMenu=="setting"&&currentMenuType=="folder"}function getRcptFilePath(){var e=jQuery("#massFileItem span.item_file");return e.length>0?e.attr("file-path"):""}var layoutMode=window.layoutMode||"h",isFirstLoad=!1,contentFrameWidth,pop3StatusTimeout,writeModeTimeout,writeType=!1,writeParam=!1,SearchByNameInfo={searchAddrValueList:[],emptyListFlag:!1,emptyKeywordList:[],rcptMultiResultType:"normal",rcptType:""},webfolderAttachProcess=!1;