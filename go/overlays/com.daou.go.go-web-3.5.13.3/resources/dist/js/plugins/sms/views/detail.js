define("sms/views/detail",function(require){var e=require("i18n!nls/commons"),t=require("i18n!sms/nls/sms"),n=require("sms/views/base_sms"),r=require("hgn!sms/templates/detail"),i=require("hgn!sms/templates/receiver"),s=require("sms/models/sms_info"),o=require("sms/collections/sms_receivers"),u=require("views/pagination"),a=require("views/profile_card"),f=require("attach_file"),l={"\uc0ad\uc81c":e["\uc0ad\uc81c"],"\ubd84\ub958":t["\ubd84\ub958"],"\ubc1c\uc2e0\ubc88\ud638":t["\ubc1c\uc2e0\ubc88\ud638"],"\ud3ec\ud1a0":t["\ud3ec\ud1a0"],"\uc218\uc2e0\uc790\ubaa9\ub85d":t["\uc218\uc2e0\uc790 \ubaa9\ub85d"],"\uba85":e["\uba85"],"\uc218\uc2e0\uc790\uac00\uc5c6\uc2b5\ub2c8\ub2e4":t["\uc218\uc2e0\uc790\uac00 \uc5c6\uc2b5\ub2c8\ub2e4."]},c=n.extend({events:{},initialize:function(e){n.prototype.initialize.apply(this,arguments),this.smsMessageId=e.smsMessageId,this.smsInfo=new s({id:this.smsMessageId}),this.collection=new o,this.collection.setAttributes({smsMessageId:this.smsMessageId,pageSize:10}),this.collection.bind("sync",this.renderReceivers,this)},render:function(){n.prototype.render.apply(this,arguments),$("div .content_page").addClass("content_message send_message");var e=this;return this.smsInfo.fetch({statusCode:{400:function(){GO.util.error("404",{msgCode:"400-common"})},403:function(){GO.util.error("403",{msgCode:"400-common"})},404:function(){GO.util.error("404",{msgCode:"400-common"})},500:function(){GO.util.error("500")}},success:function(n){e.$el.html(r({lang:l,senderId:n.getSenderId(),isSender:GO.session().id==n.getSenderId()?!0:!1,senderName:n.getSenderNameWithPosition(),senderNumber:n.getSenderNumber(),senderDeptName:n.getSenderDeptName(),senderThumbnail:n.getSenderThumbnail(),sendDate:n.getSendDate(),subject:n.getSubject(),content:n.getContent(),type:n.getType(),hasAttaches:n.hasAttaches(),count:n.getReceiversCount()})),n.hasAttaches()&&f.create("#attach-placeholder",n.get("attaches"),function(t){return GO.config("contextRoot")+"api/sms/"+e.options.smsMessageId+"/download/"+t.id}),e.$el.find("a[data-action=remove]").click(function(n){var r=e.smsMessageId;$.goConfirm(t["\ubb38\uc790 \uc0ad\uc81c"],t["\ubb38\uc790\uc0ad\uc81c\uc9c8\ubb38"],function(){e.smsInfo.destroy({success:function(){var e="sms";GO.router.navigate(e,{trigger:!0})}})})}),e.$el.find("a[data-userid]").click(function(e){var t=$(e.currentTarget).attr("data-userid");t!=""&&a.render(t,e.currentTarget)}),e.collection.fetch({statusCode:{400:function(){GO.util.error("404",{msgCode:"400-common"})},403:function(){GO.util.error("403",{msgCode:"400-common"})},404:function(){GO.util.error("404",{msgCode:"400-common"})},500:function(){GO.util.error("500")}},success:function(){e.renderReceivers()}})}}),this},renderReceivers:function(){this.$el.find(".address_list").html(i({lang:l,collection:this._parseCollection()})),this._renderPageView(),this._markHeader(),this.$el.find(".paging_full_numbers").css("padding-top","")},_parseCollection:function(){var e=_.clone(this.collection);return _.map(e.models,function(e){var t={resultMessage:e.getResultMessage(),makeReceiverName:e.getReceiverName(),isFail:e.isFail(),statusText:e.getStatusText()};return _.extend(t,e.toJSON())})},_renderPageView:function(){this.pageView&&this.pageView.remove(),this.pageView=new u({pageInfo:this.collection.pageInfo()}),this.pageView.bind("paging",this._selectPage,this),this.$("#paginateArea").append(this.pageView.render().el)},_selectPage:function(e){this.collection.setPageNo(e),this.collection.fetch()},_selectPageSize:function(e){this.collection.setPageSize(e),this.collection.fetch()},_markHeader:function(){var e=this.$("th[data-property='"+this.collection.property+"']");e.attr("data-direction",this.collection.direction),e.removeClass(),e.addClass("sorting_"+this.collection.direction)}});return c});