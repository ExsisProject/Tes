define("sms/views/connector",function(require){var e=require("jquery"),t=require("underscore"),n=require("backbone"),r=require("hgn!sms/templates/connector"),i=require("hgn!sms/templates/connector_add"),s=require("hgn!sms/templates/connector_add_user"),o=require("hgn!sms/templates/connector_add_group"),u=require("contact/views/tab_book/main"),a=require("i18n!nls/commons"),f=require("i18n!contact/nls/contact"),l=require("i18n!sms/nls/sms"),c=require("i18n!admin/nls/admin"),h=require("contact/views/tab_book/components/type_manager"),p={receiver:f["\ubc1b\ub294\uc0ac\ub78c"],contact_desc:l["\uc8fc\uc18c\ub85d\uc785\ub825\uc548\ub0b4"],"\uc8fc\uc18c\ub85d":f["\uc8fc\uc18c\ub85d"],"\ubd80\uc11c":f["\ubd80\uc11c"],"\ud558\uc704\ubd80\uc11c\ud3ec\ud568":a["\ud558\uc704\ubd80\uc11c\ud3ec\ud568"],user_id:a["\uc544\uc774\ub514"],phone:c["\uc804\ud654"],title:c["\uc9c1\ucc45"]},d=n.View.extend({events:{"click a#add":"addReceiver"},initialize:function(t){this.$el.off(),this.options=t||{};var n=new h({localStorageKey:"sms-connector-type"});this.connectorInfoView=new u({mode:"SMS",tabArea:"#tabArea",infoArea:"#infoArea",typeManager:n}),this.addView=new v;var r=this;this.addView.on("click.add",function(t){try{var n=r.connectorInfoView.getSelectedUsers()}catch(i){if(i.message!="not select users")throw new Error(i.message)}try{var s=r.connectorInfoView.getSelectedGroup()}catch(i){if(i.message!="not select group")throw new Error(i.message)}var o,u,a;if(n)o=n,u="LIST";else{if(!s){e.goSlideMessage(f["\uc120\ud0dd\ub41c \uadf8\ub8f9\uc774 \uc5c6\uc2b5\ub2c8\ub2e4"],"caution");return}o=s.data,a=s.groupType,u="SIDE"}t.callback(o,u,a)})},render:function(){var t=e.extend(!0,{},{lang:p});return this.$el.empty().append(r(t)),this.connectorInfoView.render(),this.$el.find("#addArea").html(this.addView.render()),this.$el},getData:function(){return this.addView.getData()}}),v=n.View.extend({events:{"click #add":"_onClickAdd","click span.ic_list_del":"_onClickRemove","click input.lowDeptChk":"_onClickLowDept"},initialize:function(){},render:function(){var e=i({lang:p});return this.$el.html(e),this.$el},_onClickAdd:function(t){this.trigger("click.add",{callback:e.proxy(this.addData,this)})},_onClickRemove:function(t){var n=e(t.currentTarget);n.closest("li").remove()},_onClickLowDept:function(t){var n=e(t.currentTarget),r=n.closest("li"),i;n.is(":checked")?i="subdepartment":i="department",r.attr("data-type",i)},addData:function(n,r,i){var u=this.$el.find("#receivers");t.each(n,function(n){function f(e){return e=="LIST"}function l(e){return e=="GROUP"}function c(e){return e=="ORG"}function h(n,r,i){var s=this.$el.find("#receivers li").map(function(){var t=e(this);if(f(r))return t.data("mobileno");var n=t.data("type");if(l(i)||n=="group")return t.data("id");if(c(i)||n=="department")return t.data("id")}).get(),o=f(r)?n.mobileNo:n.dataId;return t.indexOf(s,o)<0?!1:!0}if(h.call(this,n,r,i))return;if(f(r))var a=s({data:n,summeryInfo:function(){var e=[];return this.name&&e.push(this.name),this.deptName&&e.push(this.deptName),this.position&&e.push(this.position),e.join(" ")}});else var a=o({data:n,isOrg:c(i),lang:p});u.append(a)},this)},getData:function(){var t=this.$el.find("#receivers li"),n=[];return e.each(t,function(){var t=e(this),r=t.data("type");n.push({id:t.data("id"),name:t.data("name"),nameAddition:function(){var e="";return r=="subdepartment"&&(e=p.\ud558\uc704\ubd80\uc11c\ud3ec\ud568),e}(),type:r,mobileNo:t.data("mobileno")})}),n}});return d});