(function(){define(["jquery","backbone","app","system/models/licenseModel","hgn!system/templates/search_indexing_list","hgn!system/templates/list_empty","i18n!nls/commons","i18n!board/nls/board","i18n!admin/nls/admin","jquery.go-grid","jquery.go-sdk","GO.util"],function(e,t,n,r,i,s,o,u,a){var f={label_title:a["\uac80\uc0c9 \uc778\ub371\uc2f1"],label_task:o["\uc5c5\ubb34"],label_works:o.Works,label_board:o["\uac8c\uc2dc\ud310"],label_community:o["\ucee4\ubba4\ub2c8\ud2f0"],label_calendar:o["\uce98\ub9b0\ub354"],label_report:o["\ubcf4\uace0"],label_todo:o["ToDO+"],label_execution:a["\uc2e4\ud589"],label_approval:o["\uc804\uc790\uacb0\uc7ac"],label_siteName:a["\uc0ac\uc774\ud2b8\uba85"],label_draftDateBase:a["\uae30\uc548\uc77c \uae30\uc900"],label_boardCreatedDateBase:u["\uae00 \ub4f1\ub85d \uae30\uc900"],label_docs:o["\ubb38\uc11c\uad00\ub9ac"],label_base_date:a["\uae30\uc900\uc77c"],label_true_false:a["\uc720\ubb34"],label_works_indexType:a["\uc778\ub371\uc2f1 \ud0c0\uc785"],label_works_url_sample_desc:a["works reindexing url desc"],label_works_only_all_appletid:a["all_appletId\ub9cc \ud574\ub2f9"],label_works_attachIndexable_true_false:a["\ucca8\ubd80\ud30c\uc77c \uc778\ub371\uc2f1 \uc720\ubb34"]},l=t.View.extend({events:{"click span.btn_execution":"executeJob","change #worksIndexTypeSelect":"_worksIndexTypeSelect"},initialize:function(){this.globalListE="#indexingList",this.dataTable=null,this.licenseModel=r.read()},render:function(){var t=this;e(".breadcrumb .path").html(a["\uac80\uc0c9 \uc778\ub371\uc2f1"]),this.$el.empty();var n=t.licenseModel.get("socialServicePack"),r=t.licenseModel.get("collaborationServicePack"),s=t.licenseModel.get("approvalServicePack");this.$el.html(i({lang:f,hasSocialPack:n,hasCollaborationPack:r,hasApprovalServicePack:s})),t.setCompanyList(),t.initDate("approval"),t.initDate("board"),t.initDate("works"),e("select.companyList").val(GO.session("companyId"))},executeJob:function(t){var r=this,i=e(t.currentTarget).attr("id"),s=e(t.currentTarget).attr("name"),o=this.getUrl(i);GO.EventEmitter.trigger("common","layout:setOverlay",""),e.go(o,"",{qryType:"GET",contentType:"application/json",timeout:3e3,responseFn:function(t){t.code==200?e.goMessage(n.i18n(a["{{arg1}} \uc2e4\ud589 \uc131\uacf5"],{arg1:s})):e.goMessage(n.i18n(a["{{arg1}} \uc2e4\ud589 \uc2e4\ud328"],{arg1:s})),GO.EventEmitter.trigger("common","layout:clearOverlay",!0)},error:function(t){var r=n.i18n(a["{{arg1}} \uc2e4\ud589 \uc2e4\ud328"],{arg1:s});t.statusText=="timeout"?r=n.i18n(a["{{arg1}} \uc2e4\ud589 \uc131\uacf5"],{arg1:s}):t.responseJSON.message&&(r+="["+t.responseJSON.message+"]"),e.goMessage(r),GO.EventEmitter.trigger("common","layout:clearOverlay",!0)}})},initDate:function(t){var n=this;e.datepicker.setDefaults(e.datepicker.regional[GO.config("locale")]);var r=this.$el.find("#"+t+"StartDate"),i=this.$el.find("#"+t+"EndDate");r.val(GO.util.now().format("YYYY-MM-DD")),i.val(GO.util.now().format("YYYY-MM-DD")),r.datepicker({dateFormat:"yy-mm-dd",changeMonth:!0,changeYear:!0,yearSuffix:"",maxDate:i.val()}),i.datepicker({dateFormat:"yy-mm-dd",changeMonth:!0,changeYear:!0,yearSuffix:"",onClose:function(e){r.datepicker("option","maxDate",e)}})},setCompanyList:function(){var t=GO.contextRoot+"ad/api/system/companies?offset=999";e.go(t,"",{qryType:"GET",async:!1,responseFn:function(t){e.each(t.data,function(t,n){e("select.companyList").append('<option value="'+n.id+'">'+n.name+"</option>")})},error:function(t){var n=JSON.parse(t.responseText);e.goMessage(n.message)}})},getUrl:function(t){var n=GO.contextRoot+"ad/api/search/"+t+"/full-import";if(t=="approvalPeriod"){var r=e("#approvalCompanyList").val(),i=GO.util.toISO8601(GO.util.toMoment(e("#approvalStartDate").val())),s=GO.util.toISO8601(GO.util.toMoment(e("#approvalEndDate").val()).add("days",1).subtract("seconds",1));n=GO.contextRoot+"ad/api/search/approval/full-import-with-draftedAt"+"?"+e.param({draftedAtFrom:i,draftedAtTo:s,companyId:r})}else if(t=="boardPeriod"){var r=e("#boardCompanyList").val(),o=GO.util.toISO8601(GO.util.toMoment(e("#boardStartDate").val())),u=GO.util.toISO8601(GO.util.toMoment(e("#boardEndDate").val()).add("days",1).subtract("seconds",1));n=GO.contextRoot+"ad/api/search/board/full-import-with-createdAt"+"?"+e.param({createdAtFrom:o,createdAtTo:u,companyId:r})}else if(t=="worksPeriod"){var a=e("#worksIndexTypeSelect").val(),f=e("#clear_solr").is(":checked"),l=e("#attach_Indexable").is(":checked");if(a=="docIds"){var c=e("#worksDocIds").val().replace(/ /gi,"").replace(/,/gi,"&id=");n=GO.contextRoot+"ad/api/search/works/reindex/docIds?id="+c}else{var h=e("#appletId").val()||null,p=e("#worksStartDate").val()?GO.util.toISO8601(GO.util.toMoment(e("#worksStartDate").val())):null,d=e("#worksEndDate").val()?GO.util.toISO8601(GO.util.toMoment(e("#worksEndDate").val()).add("days",1).subtract("seconds",1)):null;n=GO.contextRoot+"ad/api/search/works/reindex/type/"+a+"?"+e.param({isClearSolr:f,attachIndexable:l,appletId:h,from:p,to:d})}}return n},_worksIndexTypeSelect:function(t){var n=e(t.currentTarget);this._worksIndexRender(n.val())},_worksIndexRender:function(e){e==="all"?this._renderWithTypeAll():e==="appletId"?this._renderWithTypeAppletId():_.contains(["createdAt","updatedAt"],e)?this._renderWithTypeDate():_.contains(["createdAtWithAppletId","updatedAtWithAppletId"],e)?this._renderWithTypeDateAndAppletId():e==="docIds"&&(this.$("#clear_solr_wrap").show(),this.$("#applet_id_wrap").hide(),this.$("#from_to_date_wrap").hide()),this._commonRenderingForWorks(e)},_renderWithTypeAll:function(){this.$("#clear_solr_wrap").show(),this.$("#applet_id_wrap").hide(),this.$("#from_to_date_wrap").hide()},_renderWithTypeAppletId:function(){this.$("#clear_solr_wrap").show(),this.$("#applet_id_wrap").show(),this.$("#from_to_date_wrap").hide()},_renderWithTypeDate:function(){this.$("#clear_solr_wrap").hide(),this.$("#applet_id_wrap").hide(),this.$("#from_to_date_wrap").show()},_renderWithTypeDateAndAppletId:function(){this.$("#clear_solr_wrap").hide(),this.$("#applet_id_wrap").show(),this.$("#from_to_date_wrap").show()},_commonRenderingForWorks:function(e){var t=e==="docIds"||!1;t?(this.$("#worksDocIds").val(""),this.$("#docIds_wrap").show()):this.$("#docIds_wrap").hide(),this.$("#clear_solr").prop("checked",!1).prop("disabled",t),this.$("#attach_Indexable").prop("checked",!0).prop("disabled",t)}},{__instance__:null});return l})}).call(this);