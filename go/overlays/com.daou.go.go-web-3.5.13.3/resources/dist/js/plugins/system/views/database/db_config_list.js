define(function(require){var e=require("backbone"),t=require("underscore"),n=require("system/views/database/db_config_detail"),r=require("hgn!system/templates/database/db_list"),i=require("hgn!system/templates/database/db_main"),s=require("i18n!admin/nls/admin"),o=require("i18n!nls/commons"),u={label_db_header_info:s["DB \uc124\uc815 \uc815\ubcf4"],label_db_header_config:o["\uc811\uc18d\uc124\uc815"],label_db_company_name:s["\ud68c\uc0ac\uba85"],label_db_config_name:s["\uc124\uc815\uba85"],label_db_key:s.Key,label_db_vender:s.Vender,label_db_host:s.Host,label_db_description:s["\uc124\uba85"],label_empty_list:s["\ud45c\uc2dc\ud560 \ub370\uc774\ud130 \uc5c6\uc74c"],label_add:s["\ucd94\uac00"],label_delete:o["\uc0ad\uc81c"],label_apply:s["\uc11c\ubc84 \uc801\uc6a9"],label_db_delete:s["\uc811\uc18d \uc815\ubcf4 \uc0ad\uc81c"],label_db_delete_message:s["\ud574\ub2f9 DB \uc811\uc18d \uc815\ubcf4\ub97c \uc0ad\uc81c\ud558\uc2dc\uaca0\uc2b5\ub2c8\uae4c?"],label_db_empty_delete_data:s["\uc0ad\uc81c\ud560 \uc815\ubcf4\uac00 \uc874\uc7ac\ud558\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4."],label_delete_success_message:s["\uc815\uc0c1\uc801\uc73c\ub85c \uc0ad\uc81c\ub418\uc5c8\uc2b5\ub2c8\ub2e4."],label_apply_message:s["\uc801\uc6a9\ub418\uc5c8\uc2b5\ub2c8\ub2e4."],label_db_apply_server:s["DB \uc124\uc815 \uc11c\ubc84 \uc801\uc6a9"],label_db_apply_server_message:s["\ud574\ub2f9 DB \uc811\uc18d \uc815\ubcf4\ub97c \uc801\uc6a9\ud558\uc2dc\uaca0\uc2b5\ub2c8\uae4c?"],label_overlap_key_message:s["\uc911\ubcf5\ub41c \ud0a4\uac00 \uc874\uc7ac\ud569\ub2c8\ub2e4."]},a=e.Collection.extend({url:GO.contextRoot+"ad/api/system/dbconfig"}),f=e.View.extend({events:{"click #add_btn":"_add","click #delete_btn":"_delete","click #apply_btn":"_apply","click #dbConfigTable tr":"_detail","click #group_all":"_checkAll","click td.check input":"_check"},initialize:function(){this.collection=new a},_render_list:function(){var e=this;$(".breadcrumb .path").html(s["DB \uc124\uc815"]),this.collection.fetch().done(function(){e.$el.find("tbody.document-row").html(r({data:e.collection.toJSON(),lang:u}))})},render:function(){this.$el.html(i({lang:u})),this._render_list()},setDetailView:function(){this.detailViews||(this.detailViews=new n,this.detailViews.on("isDulicatedKey",$.proxy(this._isDulicatedKey,this)),this.detailViews.on("refresh_list",$.proxy(this._render_list,this)))},_delete:function(){function t(){var t=[];document.querySelectorAll("td.check input").forEach(function(e){e.checked==1&&t.push("ids="+Number(e.closest("tr").dataset.id))});if(t.length==0){$.goError(u.label_db_empty_delete_data);return}$.ajax({contentType:"application/json",method:"DELETE",url:GO.contextRoot+"ad/api/system/dbconfig?"+t.join("&"),success:function(){$.goMessage(u.label_delete_success_message),document.querySelector(".detail_container").innerHTML="",e._render_list()},fail:function(){}})}var e=this;$.goCaution(u.label_db_delete,u.label_db_delete_message,t)},_apply:function(){function e(){var e=$.ajax({contentType:"application/json",method:"GET",url:GO.contextRoot+"ad/api/system/dbconfig/refresh"});e.done(function(){$.goMessage(u.label_apply_message)})}$.goConfirm(u.label_db_apply_server,u.label_db_apply_server_message,e)},_add:function(e){this.setDetailView(),this.detailViews.renderInsert()},_detail:function(e){var t=$(e.currentTarget).closest("tr").data("id"),n=this;this.collection.map(function(e){if(t==e.id){n.setDetailView(),n.detailViews.renderModify(e);return}})},_checkAll:function(e){var t=e.target.checked,n=document.querySelectorAll("td.check input");for(var r=0;r<n.length;r++)n[r].checked=t},_isDulicatedKey:function(e){var t=$(e[1].currentTarget),n=e[0];this.collection.toJSON().map(function(e){e.key==n&&n!=t.data("prevalue")&&($.goError(u.label_overlap_key_message),t.val(""))})}});return f});