define(["jquery","backbone","app","i18n!nls/commons","i18n!admin/nls/admin","hgn!system/templates/device_version_list","hgn!system/templates/list_empty","jquery.go-sdk","jquery.go-popup","jquery.go-grid","jquery.ui","GO.util","jquery.go-validation"],function(e,t,n,r,i,s,o){var u={label_add:r["\ucd94\uac00"],label_delete:r["\uc0ad\uc81c"],label_desc:i["\ub514\ubc14\uc774\uc2a4\uad00\ub9ac \ubaa9\ub85d \uc124\uba85"],label_device:i["\ub514\ubc14\uc774\uc2a4"],label_importance:i["\uc911\uc694\ub3c4"],label_version:i["\ubc84\uc804"],label_linkinfo:i["\ub9c1\ud06c\uc815\ubcf4"],label_createdAt:i["\ub4f1\ub85d\uc77c"],label_default:i["\uae30\ubcf8"],label_messenger_type:i["\uba54\uc2e0\uc800 \ud0c0\uc785 \uc124\uc815"],select_type:[{text:i["\uc804\uccb4\ubd84\ub958"],value:"all"},{text:i.PC,value:"pc"},{text:"PC - Electron",value:"pc_electron"},{text:"PC - MAC",value:"pc_mac"},{text:"PC - XP",value:"pc_xp"},{text:i.iPhone,value:"iphone"},{text:i.Android,value:"android"}]},a=null,f=t.View.extend({el:"#layoutContent",initialize:function(){this.$el.off(),this.$el.empty(),this.listEl="#deviceVersionList",this.dataTable=null,this.bindEvent()},bindEvent:function(){this.$el.on("click","span#btn_add",e.proxy(this.addDeviceVersion,this)),this.$el.on("click","span#btn_delete",e.proxy(this.deleteDeviceVersion,this)),this.$el.on("change","#deviceType",e.proxy(this.categoryNameFilter,this)),this.$el.on("change","input[name='messengerType']",e.proxy(this.changeMessengerType,this))},changeMessengerType:function(t){var n=e(t.currentTarget).parent().find("label").text(),s=e('input[name="messengerType"]:radio:checked').val();e.goPopup({title:i["\uba54\uc2e0\uc800 \ud0c0\uc785 \uc124\uc815"],message:GO.i18n(i["\ud0c0\uc785 \uc800\uc7a5"],{arg1:n}),modal:!0,allowPrevPopup:!0,closeIconVisible:!1,buttons:[{btext:"\ud655\uc778",btype:"confirm",callback:function(){var t=GO.contextRoot+"ad/api/system/messenger/type/"+s;e.go(t,"",{qryType:"PUT",contentType:"application/json",responseFn:function(t){e.goMessage(r["\uc800\uc7a5\ub418\uc5c8\uc2b5\ub2c8\ub2e4."])},error:function(t){var n=JSON.parse(t.responseText),i=n.message;e.goMessage(r["\uc2e4\ud328\ud588\uc2b5\ub2c8\ub2e4."]+i)}})}},{btext:"\ucde8\uc18c",btype:"normal",callback:function(){var t=s=="electron"?"default":"electron";e('input[name="messengerType"][value="'+t+'"]').prop("checked",!0)}}]}),t.stopPropagation()},categoryNameFilter:function(t){var n=e(t.currentTarget).val();typeof this.dataTable.tables.setParam=="function"&&this.dataTable.tables.setParam("deviceType",n)},addDeviceVersion:function(){n.router.navigate("system/device/create",!0)},deleteDeviceVersion:function(){var t=this,n=e("#deviceVersionList input[type=checkbox]:checked");if(n.length==0)return e.goAlert("",i["\uc0ad\uc81c\ud560 \ud56d\ubaa9\uc744 \uc120\ud0dd\ud558\uc138\uc694."]);e.goConfirm("",i["\uc0ad\uc81c\uacbd\uace0"],function(){var i=GO.contextRoot+"ad/api/system/device/version",s={ids:[]};for(var o=0;o<n.length;o++){if(n[o].value=="on")continue;s.ids.push(parseInt(n[o].value))}if(s.ids.length==0)return;e.go(i,JSON.stringify(s),{qryType:"DELETE",contentType:"application/json",responseFn:function(n){e.goMessage(r["\uc0ad\uc81c\ub418\uc5c8\uc2b5\ub2c8\ub2e4."]),t.render()},error:function(t){e.goMessage(r["\uc2e4\ud328\ud588\uc2b5\ub2c8\ub2e4."])}})})},render:function(){e("#mobilty").addClass("on"),e(".breadcrumb .path").html(i["\ubaa8\ube4c\ub9ac\ud2f0 > \ubaa8\ubc14\uc77c \uc571 \ubc84\uc804 \uad00\ub9ac"]),this.$el.empty(),this.$el.html(s({lang:u})),this.renderMessengerType(),this.renderDeviceVersionList()},renderMessengerType:function(){var t=GO.contextRoot+"ad/api/system/messenger/type";e.go(t,"",{qryType:"GET",contentType:"application/json",responseFn:function(t){e('input[name="messengerType"][value="'+t.data+'"]').prop("checked",!0)}})},renderDeviceVersionList:function(){var t=this;this.dataTable=e.goGrid({el:this.listEl,method:"GET",url:GO.contextRoot+"ad/api/system/device/version/all",emptyMessage:o({label_desc:i["\ud45c\uc2dc\ud560 \ub370\uc774\ud130 \uc5c6\uc74c"]}),defaultSorting:[[5,"desc"]],checkbox:!0,sDomType:"admin",checkboxData:"id",displayLength:n.session("adminPageBase"),columns:[{mData:"deviceType",sWidth:"120px",bSortable:!1,fnRender:function(e){var t=e.aData.deviceType;return t=="pc"?i.PC:t=="pc_electron"?"PC - Electron":t=="pc_mac"?"PC - MAC":t=="pc_xp"?"PC - XP":t=="iphone"?i.iPhone:t=="android"?i.Android:t}},{mData:"importance",sWidth:"100px",bSortable:!1,fnRender:function(e){var t=e.aData.importance;return t=="urgent"?i["\uae34\uae09"]:t=="high"?i["\uc0c1"]:t=="medium"?i["\uc911"]:t=="low"?i["\ud558"]:t}},{mData:"version",sWidth:"100px",bSortable:!1,fnRender:function(e){return e.aData.version}},{mData:null,bSortable:!1,fnRender:function(e){return e.aData.linkType=="upload"?e.aData.deviceVersionAttach==null?"-":GO.util.escapeToLtGt(e.aData.linkUrl):GO.util.escapeToLtGt(e.aData.linkUrl)}},{mData:"createdAt",sClass:"align_c",sWidth:"150px",bSortable:!0,fnRender:function(e){return GO.util.basicDate(e.aData.createdAt)}}],fnDrawCallback:function(r){t.$el.find(".toolbar_top .custom_header").append(t.$el.find("#controllButtons").show()),t.$el.find(this.el+" tr>td:not(:first-child)").css("cursor","pointer").click(function(t){n.router.navigate("system/device/"+e(t.currentTarget).parent().find("input").val()+"/modify",{trigger:!0})})}})}},{create:function(){return a=new f({el:"#layoutContent"}),a.render()}});return{render:function(){var e=f.create();return e}}});