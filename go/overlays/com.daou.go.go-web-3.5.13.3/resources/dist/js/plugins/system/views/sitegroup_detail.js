define(function(require){var e=require("jquery"),t=require("backbone"),n=require("when"),r=require("app"),i=require("system/views/simple_circle"),s=require("system/models/sitegroup"),o=require("system/models/user_integration"),u=require("system/collections/companies"),a=require("system/collections/simple_companies"),f=require("system/collections/company_borad_shares"),l=require("system/collections/company_asset_shares"),c=require("system/views/company_group_share"),h=require("hgn!system/templates/sitegroup_detail"),p=require("hgn!system/templates/user_integration_layer"),d=require("i18n!nls/commons"),v=require("i18n!admin/nls/admin");require("jquery.go-grid"),require("jquery.go-sdk"),require("jquery.go-orgtab"),require("jquery.go-orgslide"),require("GO.util"),require("jquery.go-validation");var m={"\uc0ac\uc774\ud2b8 \uadf8\ub8f9 \uae30\ubcf8 \uc815\ubcf4":v["\uc0ac\uc774\ud2b8 \uadf8\ub8f9 \uae30\ubcf8 \uc815\ubcf4"],"\uc0ac\uc774\ud2b8 \uadf8\ub8f9\uba85":v["\uc0ac\uc774\ud2b8 \uadf8\ub8f9\uba85"],"\uc0ac\uc774\ud2b8 \ub9e4\uce6d":v["\uc0ac\uc774\ud2b8 \ub9e4\uce6d"],"\uc0ac\uc774\ud2b8 \ubaa9\ub85d":v["\uc0ac\uc774\ud2b8 \ubaa9\ub85d"],"\uc120\ud0dd\ud55c \uc0ac\uc774\ud2b8":v["\uc120\ud0dd\ud55c \uc0ac\uc774\ud2b8"],"\ub9e8 \uc704\ub85c":v["\ub9e8 \uc704\ub85c"],"\uc704\ub85c":v["\uc704\ub85c"],"\uc544\ub798\ub85c":v["\uc544\ub798\ub85c"],"\ub9e8 \uc544\ub798\ub85c":v["\ub9e8 \uc544\ub798\ub85c"],"\uc0ad\uc81c":v["\uc0ad\uc81c"],"\uadf8\ub8f9\uac04 \uc870\uc9c1\ub3c4 \uacf5\uc720":v["\uadf8\ub8f9\uac04 \uc870\uc9c1\ub3c4 \uacf5\uc720"],"\uc870\uc9c1\ub3c4 \uacf5\uc720\uc790":v["\uc870\uc9c1\ub3c4 \uacf5\uc720\uc790"],"\uc9c0\uc815 \uc0ac\uc6a9\uc790":v["\uc9c0\uc815 \uc0ac\uc6a9\uc790"],"\ubaa8\ub4e0 \uc0ac\uc6a9\uc790":v["\ubaa8\ub4e0 \uc0ac\uc6a9\uc790"],"\uacf5\uc720 \ubc94\uc704":v["\uacf5\uc720 \ubc94\uc704"],"\ucd94\uac00\ud560 \uc0ac\uc774\ud2b8\uac00 \uc5c6\uc2b5\ub2c8\ub2e4":v["\ucd94\uac00\ud560 \uc0ac\uc774\ud2b8\uac00 \uc5c6\uc2b5\ub2c8\ub2e4."],"\uc870\uc9c1\ub3c4\uc640 \uac80\uc0c9\uc744 \uc81c\uacf5\ud569\ub2c8\ub2e4":v["\uc870\uc9c1\ub3c4\uc640 \uac80\uc0c9\uc744 \uc81c\uacf5\ud569\ub2c8\ub2e4."],"\uac80\uc0c9\ub9cc \uc81c\uacf5\ud569\ub2c8\ub2e4":v["\uac80\uc0c9\ub9cc \uc81c\uacf5\ud569\ub2c8\ub2e4."],"\uc120\ud0dd\ub41c \uc0ac\uc774\ud2b8\uac00 \uc5c6\uc2b5\ub2c8\ub2e4":v["\uc120\ud0dd\ub41c \uc0ac\uc774\ud2b8\uac00 \uc5c6\uc2b5\ub2c8\ub2e4."],"\ucd94\uac00":d["\ucd94\uac00"],"\uc0ad\uc81c":d["\uc0ad\uc81c"],"\uc800\uc7a5":d["\uc800\uc7a5"],"\ucde8\uc18c":d["\ucde8\uc18c"],"\ubaa9\ub85d\uc73c\ub85c \ub3cc\uc544\uac00\uae30":v["\ubaa9\ub85d\uc73c\ub85c \ub3cc\uc544\uac00\uae30"],"\uc800\uc7a5\ub418\uc5c8\uc2b5\ub2c8\ub2e4":d["\uc800\uc7a5\ub418\uc5c8\uc2b5\ub2c8\ub2e4."],"500 \uc624\ub958\ud398\uc774\uc9c0 \ub0b4\uc6a9":d["500 \uc624\ub958\ud398\uc774\uc9c0 \ub0b4\uc6a9"],"\uc0ac\uc774\ud2b8 \uadf8\ub8f9\uba85\uc744 \uc785\ub825\ud558\uc138\uc694":v["\uc0ac\uc774\ud2b8 \uadf8\ub8f9\uba85\uc744 \uc785\ub825\ud558\uc138\uc694."],"2\uac1c \uc774\uc0c1\uc758 \uc0ac\uc774\ud2b8\uac00 \ub9e4\uce6d\ub418\uc5b4\uc57c \ud569\ub2c8\ub2e4":v["2\uac1c \uc774\uc0c1\uc758 \uc0ac\uc774\ud2b8\uac00 \ub9e4\uce6d\ub418\uc5b4\uc57c \ud569\ub2c8\ub2e4."],"\uacb8\uc9c1\uc790\uac00 \uc874\uc7ac\ud558\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4":v["\uacb8\uc9c1\uc790\uac00 \uc874\uc7ac\ud558\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4."],"\ucd94\uac00":d["\ucd94\uac00"],"\uc0ad\uc81c":d["\uc0ad\uc81c"],"\uc774\ub984":d["\uc774\ub984"],"\uc0ac\uc774\ud2b8\uba85":v["\uc0ac\uc774\ud2b8\uba85"],"\uc774\uba54\uc77c":d["\uc774\uba54\uc77c"],"\uacb8\uc9c1\uc790 \uc124\uc815":v["\uacb8\uc9c1\uc790 \uc124\uc815"],"\uc120\ud0dd\ud55c \uc0ac\uc6a9\uc790":v["\uc120\ud0dd\ud55c \uc0ac\uc6a9\uc790"],"\uacb8\uc9c1\uc790 \uc124\uc815 \ub808\uc774\uc5b4 \uc124\uba85":v["\uacb8\uc9c1\uc790 \uc124\uc815 \ub808\uc774\uc5b4 \uc124\uba85"],"\uc120\ud0dd\ub41c \uc0ac\uc6a9\uc790\uac00 \uc5c6\uc2b5\ub2c8\ub2e4":v["\uc120\ud0dd\ub41c \uc0ac\uc6a9\uc790\uac00 \uc5c6\uc2b5\ub2c8\ub2e4"],"\uc11c\ub85c \ub2e4\ub978 \ud68c\uc0ac\uc758 \uc0ac\uc6a9\uc790\ub97c \ub458 \uc774\uc0c1 \ucd94\uac00\ud574\uc8fc\uc138\uc694":v["\uc11c\ub85c \ub2e4\ub978 \ud68c\uc0ac\uc758 \uc0ac\uc6a9\uc790\ub97c \ub458 \uc774\uc0c1 \ucd94\uac00\ud574\uc8fc\uc138\uc694"],"\ud68c\uc0ac\uac00 \ub3d9\uc77c\ud55c \uc0ac\uc6a9\uc790\ub97c \ucd94\uac00\ud560 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4":v["\ud68c\uc0ac\uac00 \ub3d9\uc77c\ud55c \uc0ac\uc6a9\uc790\ub97c \ucd94\uac00\ud560 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4"],"\ub3d9\uc77c\ud55c \uc0ac\uc6a9\uc790\ub97c \ucd94\uac00\ud560 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4":v["\ub3d9\uc77c\ud55c \uc0ac\uc6a9\uc790\ub97c \ucd94\uac00\ud560 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4"],"\uc120\ud0dd \uc548\ud568":v["\uc120\ud0dd \uc548\ud568"],"\uacb8\uc9c1\uc790 \ubaa9\ub85d":v["\uacb8\uc9c1\uc790 \ubaa9\ub85d"],"\uadf8\ub8f9\uc0ac\uac04 \uc870\uc9c1\ub3c4 \uacf5\uc720":v["\uadf8\ub8f9\uc0ac\uac04 \uc870\uc9c1\ub3c4 \uacf5\uc720"],"\uacb8\uc9c1\uc790 \ubaa9\ub85d \ub3c4\uc6c0\ub9d0":v["\uacb8\uc9c1\uc790 \ubaa9\ub85d \ub3c4\uc6c0\ub9d0"],"\uadf8\ub8f9\uc0ac\uac04 \uc870\uc9c1\ub3c4 \uacf5\uc720 \ub3c4\uc6c0\ub9d0":v["\uadf8\ub8f9\uc0ac\uac04 \uc870\uc9c1\ub3c4 \uacf5\uc720 \ub3c4\uc6c0\ub9d0"],"\uacf5\uc720 \ubc94\uc704 \ub3c4\uc6c0\ub9d0":v["\uacf5\uc720 \ubc94\uc704 \ub3c4\uc6c0\ub9d0"],"\uc774\ubbf8 \uacb8\uc9c1\uc73c\ub85c \ucd94\uac00\ub41c \uc0ac\uc6a9\uc790\ub97c \uacb8\uc9c1\uc73c\ub85c \ub2e4\uc2dc \ucd94\uac00\ud560 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4.":v["\uc774\ubbf8 \uacb8\uc9c1\uc73c\ub85c \ucd94\uac00\ub41c \uc0ac\uc6a9\uc790\ub97c \uacb8\uc9c1\uc73c\ub85c \ub2e4\uc2dc \ucd94\uac00\ud560 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4."],"\uc0ad\uc81c\ub41c \uc0ac\uc6a9\uc790\ub97c \uacb8\uc9c1\uc73c\ub85c \ucd94\uac00\ud560 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4.":v["\uc0ad\uc81c\ub41c \uc0ac\uc6a9\uc790\ub97c \uacb8\uc9c1\uc73c\ub85c \ucd94\uac00\ud560 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4."],"\uc0ac\uc774\ud2b8 \uadf8\ub8f9\uc774 \ub2e4\ub974\uac70\ub098 \uadf8\ub8f9\uc5d0 \uc18c\uc18d\ub418\uc9c0 \uc54a\uc740 \uc0ac\uc6a9\uc790\ub97c \uacb8\uc9c1\uc73c\ub85c \ucd94\uac00\ud560 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4.":v["\uc0ac\uc774\ud2b8 \uadf8\ub8f9\uc774 \ub2e4\ub974\uac70\ub098 \uadf8\ub8f9\uc5d0 \uc18c\uc18d\ub418\uc9c0 \uc54a\uc740 \uc0ac\uc6a9\uc790\ub97c \uacb8\uc9c1\uc73c\ub85c \ucd94\uac00\ud560 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4."],"\uc0ac\uc774\ud2b8 \uadf8\ub8f9\uba85\uc744 1\uc790 \uc774\uc0c1 64\uc790 \ubbf8\ub9cc\uc73c\ub85c \uc785\ub825\ud558\uc138\uc694.":v["\uc0ac\uc774\ud2b8 \uadf8\ub8f9\uba85\uc744 1\uc790 \uc774\uc0c1 64\uc790 \ubbf8\ub9cc\uc73c\ub85c \uc785\ub825\ud558\uc138\uc694."],"\uc774\ubbf8 \ub2e4\ub978 \uadf8\ub8f9\uc5d0 \uc18d\ud55c \uc0ac\uc774\ud2b8\ub97c \ucd94\uac00\ud560 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4.":v["\uc774\ubbf8 \ub2e4\ub978 \uadf8\ub8f9\uc5d0 \uc18d\ud55c \uc0ac\uc774\ud2b8\ub97c \ucd94\uac00\ud560 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4."],"\uc774\ubbf8 \uc0ac\uc6a9\uc911\uc778 \uc0ac\uc774\ud2b8\uba85\uc785\ub2c8\ub2e4.":v["\uc774\ubbf8 \uc0ac\uc6a9\uc911\uc778 \uc0ac\uc774\ud2b8\uba85\uc785\ub2c8\ub2e4."],"\ub4e4\uc5ec\uc4f0\uae30":v["\ub4e4\uc5ec\uc4f0\uae30"],"\ub4e4\uc5ec\uc4f0\uae30 \ucde8\uc18c":v["\ub4e4\uc5ec\uc4f0\uae30"]+" "+d["\ucde8\uc18c"],"\uc0ac\uc774\ud2b8 \uadf8\ub8f9 \ucee8\ud150\uce20 \uacf5\uc720\ubc29\ubc95 \uc124\uba851":v["\uc0ac\uc774\ud2b8 \uadf8\ub8f9 \ucee8\ud150\uce20 \uacf5\uc720\ubc29\ubc95 \uc124\uba851"],"\uc0ac\uc774\ud2b8 \uadf8\ub8f9 \ub9f5\ud551 \ucef4\ud37c\ub2c8 \uc0ad\uc81c \uacbd\uace0":v["\uc0ac\uc774\ud2b8 \uadf8\ub8f9 \ub9f5\ud551 \ucef4\ud37c\ub2c8 \uc0ad\uc81c \uacbd\uace0"]},g=t.View.extend({initialize:function(e){var t=_.extend({},e.data);this.model=new o(t),this.availableCompanyIds=e.availableCompanyIds},render:function(){this.$el.html(p({lang:m})),this._renderOrgTree(),this._renderUserList(),this.$el.off(),this._bindEvents()},_renderOrgTree:function(){this.orgTab=e.goOrgTab({elId:"user_integration_layer_org_tree",companyIds:this.availableCompanyIds,isAdmin:!0,css:{minHeight:"185px",maxHeight:"185px","overflow-y":"auto"}})},_renderUserList:function(t){var n="{{#users}}<li data-id={{id}}>{{companyName}} - {{name}}({{email}})</li>{{/users}}";this.$("#integration_users").html(Hogan.compile(n).render({users:this.model.get("users")})),t&&e('#integration_users > li[data-id="'+t+'"]').addClass("on")},_bindEvents:function(){this.$el.on("click","#integration_users > li",e.proxy(this._onUserClicked,this)),this.$el.on("click","#add_user",e.proxy(this._onAddUserClicked,this)),this.$el.on("click","div.tool_bar > span",e.proxy(this._onToolbarClicked,this))},_onUserClicked:function(t){var n=e(t.currentTarget),r=e("#integration_users > li");r.removeClass("on"),n.addClass("on")},_onAddUserClicked:function(t){var n=this.model.get("users"),r=this.orgTab.getSelectedData(),i=!1,s=!1;if(!_.contains(["MASTER","MODERATOR","MEMBER"],r.type))return!1;e.ajax({type:"GET",async:!1,dataType:"json",url:GO.contextRoot+"ad/api/system/user/profile/"+r.id,success:function(e){var t=e.data;r.companyId=t.companyId,r.companyName=t.companyName}}),_.each(n,function(e){r["companyId"]==e["companyId"]&&(i=!0),r["id"]==e["id"]&&(s=!0)});if(i)return e.goMessage(m["\ud68c\uc0ac\uac00 \ub3d9\uc77c\ud55c \uc0ac\uc6a9\uc790\ub97c \ucd94\uac00\ud560 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4"]),!1;if(s)return e.goMessage(m["\ub3d9\uc77c\ud55c \uc0ac\uc6a9\uc790\ub97c \ucd94\uac00\ud560 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4"]),!1;n.push({id:r.id,name:r.name,email:r.email,companyId:r.companyId,companyName:r.companyName}),this.model.set("users",n),this._renderUserList(r.id)},_onToolbarClicked:function(t){var n=e("#integration_users > li.on"),r=n.attr("data-id");n.length<1&&e.goMessage(m["\uc120\ud0dd\ub41c \uc0ac\uc6a9\uc790\uac00 \uc5c6\uc2b5\ub2c8\ub2e4"]);switch(e(t.currentTarget).attr("id")){case"move_user_top":this.model.moveUserTop(r);break;case"move_user_up":this.model.moveUserUp(r);break;case"move_user_down":this.model.moveUserDown(r);break;case"move_user_bottom":this.model.moveUserBottom(r);break;case"delete_user":this.model.removeUser(r)}this._renderUserList(r)},validate:function(){var t=this.model.get("users"),n=!1;return t.length<2?(e.goMessage(m["\uc11c\ub85c \ub2e4\ub978 \ud68c\uc0ac\uc758 \uc0ac\uc6a9\uc790\ub97c \ub458 \uc774\uc0c1 \ucd94\uac00\ud574\uc8fc\uc138\uc694"]),!1):(_.each(t,function(e){var r=_.filter(t,function(t){return e["companyId"]==t["companyId"]});r.length>1&&(n=!0)}),n?(e.goMessage(m["\uc11c\ub85c \ub2e4\ub978 \ud68c\uc0ac\uc758 \uc0ac\uc6a9\uc790\ub97c \ub458 \uc774\uc0c1 \ucd94\uac00\ud574\uc8fc\uc138\uc694"]),!1):!0)},getData:function(){return this.model.toJSON()}}),y=t.View.extend({el:"#layoutContent",initialize:function(e){this.unbindEvent(),this.bindEvent(),this.companies=new a,this.siteGroup=new s({id:e.siteGroupId})},unbindEvent:function(){this.$el.off("click","#add_site_to_group"),this.$el.off("click","#selected_companies_tool_bar > span"),this.$el.off("click","#companies_candidate > li[data-id]"),this.$el.off("click","#companies_selected > li[data-id]"),this.$el.off("focusout",'input[name="name"]'),this.$el.off("change",'input[name="org_tree_share_scope"]'),this.$el.off("change",'input[name="org_tree_share_content"]'),this.$el.off("click","#btn_save"),this.$el.off("click","#btn_cancel"),this.$el.off("click","#btn_return_list"),this.$el.off("click",'input[name="userIntegration"]'),this.$el.off("click","#deleteUserIntegrations"),this.$el.off("click","td.showUserIntegration"),this.$el.off("click","#addUserIntegration")},bindEvent:function(){this.$el.on("click","#add_site_to_group",e.proxy(this._onSiteAddClicked,this)),this.$el.on("click","#selected_companies_tool_bar > span",e.proxy(this._onSiteToolbarClicked,this)),this.$el.on("click","#companies_candidate > li[data-id]",e.proxy(this._onCompanyCandidateSelected,this)),this.$el.on("click","#companies_selected > li[data-id]",e.proxy(this._onCompanySelectedSelected,this)),this.$el.on("focusout",'input[name="name"]',e.proxy(this._onNameFocusOut,this)),this.$el.on("change",'input[name="org_tree_share_scope"]',e.proxy(this._onOrgShareScopeClicked,this)),this.$el.on("change",'input[name="org_tree_share_content"]',e.proxy(this._onOrgShareContentClicked,this)),this.$el.on("click","#btn_save",e.proxy(this._onSaveButtonClicked,this)),this.$el.on("click","#btn_cancel",e.proxy(this._onCancelButtonClicked,this)),this.$el.on("click","#btn_return_list",e.proxy(this._onListButtonClicked,this)),this.$el.on("click",'input[name="userIntegration"]',e.proxy(this._onUserIntegrationChecked,this)),this.$el.on("click","#deleteUserIntegrations",e.proxy(this._onUserIntegrationDeleteClicked,this)),this.$el.on("click","td.showUserIntegration",e.proxy(this._onUserIntegrationShowClicked,this)),this.$el.on("click","#addUserIntegration",e.proxy(this._onUserIntegrationAddClicked,this))},render:function(t){var n=this;this.companies.fetch({success:function(){n.siteGroup.isNew()?(e(".breadcrumb .path").html(v["\uc0ac\uc774\ud2b8 \uad00\ub9ac > \uc0ac\uc774\ud2b8 \uadf8\ub8f9 \ucd94\uac00"]),n._renderTemplate()):n.siteGroup.fetch({success:function(t){e(".breadcrumb .path").html(v["\uc0ac\uc774\ud2b8 \uad00\ub9ac > \uc0ac\uc774\ud2b8 \uadf8\ub8f9 \uc218\uc815"]),n._renderTemplate(undefined,n.siteGroupId)}})}})},_renderTemplate:function(t,n){this.$el.empty().html(h({data:this._makeTemplateData(),lang:m})),_.isUndefined(t)||e('#companies_selected > li[data-id="'+t+'"]').addClass("on");var r=_.map(this.siteGroup.get("companies"),function(e){return e.id}),s=function(e){this.siteGroup.set("orgTreeShareUser",e)};this.orgTreeShareUserView=new i({selector:"#org_tree_share_user",isAdmin:!0,withCompanies:!0,companyIds:r,circleJSON:this.siteGroup.get("orgTreeShareUser"),nodeTypes:["user","department","position","grade","duty","usergroup"],addCallback:e.proxy(s,this),removeCallback:e.proxy(s,this),companies:this.companies}),this.orgTreeShareUserView.render(),this.siteGroup.isOrgShareToSelectedUser()&&this.orgTreeShareUserView.show(),this._handleOrgShareContentVisible(),_.isUndefined(n)?e("#companySharePageNoti").show():(e("#companySharePageNoti").hide(),this._renderBoardCompany())},_renderBoardCompany:function(){var e=this.siteGroup.get("companies");c.render({type:"BOARD",companyGroupId:this.siteGroupId,companies:new u(e)})},_makeTemplateData:function(){var e={isNew:this.siteGroup.isNew(),name:this.siteGroup.get("name"),orgShareByTree:this.siteGroup.isOrgShareByTree(),orgShareToNoUser:this.siteGroup.isOrgShareToNoUser(),orgShareToAllUser:this.siteGroup.isOrgShareToAllUser(),orgShareToSelectedUser:this.siteGroup.isOrgShareToSelectedUser(),companiesSelected:this.siteGroup.get("companies"),companies:this.companies.toJSON(),companiesCandidate:[],userIntegrations:[]};return this.companies.each(function(t){_.isEmpty(t.get("companyGroup"))&&e.companiesCandidate.push(t.toJSON())}),_.each(this.siteGroup.get("userIntegrations"),function(t){var n=[],r=[],i=[],o=[];_.each(t.users,function(e){n.push(e.id),r.push(e.name),i.push(e.email),o.push(e.companyName)}),e.userIntegrations.push({id:t.id,userNames:r,userEmails:i,userListKey:s.generateUserListKey(n),siteNames:o})}),e},_onSiteAddClicked:function(){var t=e("#companies_candidate > li.on"),n=t.attr("data-id");t.length<1&&e.goMessage(m["\uc120\ud0dd\ub41c \uc0ac\uc774\ud2b8\uac00 \uc5c6\uc2b5\ub2c8\ub2e4"]),this.companies.each(function(e){n==e.get("id")&&(e.set("companyGroup",this.siteGroup),this.siteGroup.addCompany(e))},this),this._renderTemplate(n,this.siteGroupId)},_onSiteToolbarClicked:function(t){var n=this,r=e("#companies_selected > li.on"),i=r.attr("data-id");r.length<1&&e.goMessage(m["\uc120\ud0dd\ub41c \uc0ac\uc774\ud2b8\uac00 \uc5c6\uc2b5\ub2c8\ub2e4"]);switch(e(t.currentTarget).attr("id")){case"move_site_top":this.siteGroup.moveCompanyTop(i);break;case"move_site_up":this.siteGroup.moveCompanyUp(i);break;case"move_site_down":this.siteGroup.moveCompanyDown(i);break;case"move_site_bottom":this.siteGroup.moveCompanyBottom(i);break;case"move_site_right":this.moveCompanyRight(r);break;case"move_site_left":this.moveCompanyLeft(r);break;case"remove_site_from_group":this.siteGroup.removeCompany(i);var s=this.companies.get(i);s.set("companyGroup",null),this._removeUserIntegrationOfCompany(i),this._removeOrgShareUserOfCompany(i)}this._renderTemplate(i,this.siteGroupId)},moveCompanyRight:function(e){var t=parseInt(e.attr("data-depth"));if(t==4)return;var n=t+1;_.each(this.siteGroup.get("companies"),function(t){e.attr("data-id")==t["id"]&&(t.groupDepth=n)})},moveCompanyLeft:function(t){var n=parseInt(e(t).attr("data-depth"));if(n==0)return;var r=n-1;_.each(this.siteGroup.get("companies"),function(e){t.attr("data-id")==e["id"]&&(e.groupDepth=r)})},_removeUserIntegrationOfCompany:function(e){this.siteGroup.removeUserIntegrationOfCompany(e)},_removeOrgShareUserOfCompany:function(e){this.orgTreeShareUserView.deleteDataOfCompany(e),this.siteGroup.set("orgTreeShareUser",this.orgTreeShareUserView.getData())},_onCompanyCandidateSelected:function(t){e("#companies_candidate > li").removeClass("on"),e(t.currentTarget).addClass("on")},_onCompanySelectedSelected:function(t){e("#companies_selected > li").removeClass("on"),e(t.currentTarget).addClass("on")},_onNameFocusOut:function(t){this.siteGroup.set("name",e('input[name="name"]').val())},_onOrgShareScopeClicked:function(t){this.siteGroup.set("orgTreeShareScope",e(t.currentTarget).val()),this.siteGroup.isOrgShareToSelectedUser()?this.orgTreeShareUserView.show():this.orgTreeShareUserView.hide(),this._handleOrgShareContentVisible()},_handleOrgShareContentVisible:function(t){var n=e("#sitegroup_detail_org_share_content");this.siteGroup.isOrgShareToNoUser()?n.hide():n.show()},_onOrgShareContentClicked:function(t){this.siteGroup.set("orgTreeShareContent",e(t.currentTarget).val())},_onSaveButtonClicked:function(){if(_.isEmpty(this.siteGroup.get("name")))return e.goMessage(m["\uc0ac\uc774\ud2b8 \uadf8\ub8f9\uba85\uc744 \uc785\ub825\ud558\uc138\uc694"]),e('input[name="name"]').focus(),!1;if(this.siteGroup.get("companies").length<2)return e.goMessage(m["2\uac1c \uc774\uc0c1\uc758 \uc0ac\uc774\ud2b8\uac00 \ub9e4\uce6d\ub418\uc5b4\uc57c \ud569\ub2c8\ub2e4"]),!1;_.each(this.siteGroup.get("companies"),function(t){t.companyGroup=null,e("#companies_selected").find("li").each(function(n,r){e(r).attr("data-id")==t["id"]&&(t.groupDepth=e(r).attr("data-depth"))})}),this.siteGroup.set("orgTreeShareUser",this.orgTreeShareUserView.getData());var t=this;this.siteGroup.save({},{success:function(n){e.goMessage(m["\uc800\uc7a5\ub418\uc5c8\uc2b5\ub2c8\ub2e4"]),t._goToShow(n.get("id"))},error:function(t,n,r){if(n.responseJSON.code==400)switch(n.responseJSON.message){case"already integrated with others.":e.goMessage(m["\uc774\ubbf8 \uacb8\uc9c1\uc73c\ub85c \ucd94\uac00\ub41c \uc0ac\uc6a9\uc790\ub97c \uacb8\uc9c1\uc73c\ub85c \ub2e4\uc2dc \ucd94\uac00\ud560 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4."]);break;case"same company.":case"invalid integration size":e.goMessage(m["\uc11c\ub85c \ub2e4\ub978 \ud68c\uc0ac\uc758 \uc0ac\uc6a9\uc790\ub97c \ub458 \uc774\uc0c1 \ucd94\uac00\ud574\uc8fc\uc138\uc694"]);break;case"deleted user.":e.goMessage(m["\uc0ad\uc81c\ub41c \uc0ac\uc6a9\uc790\ub97c \uacb8\uc9c1\uc73c\ub85c \ucd94\uac00\ud560 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4."]);break;case"not in same company group or empty.":e.goMessage(m["\uc0ac\uc774\ud2b8 \uadf8\ub8f9\uc774 \ub2e4\ub974\uac70\ub098 \uadf8\ub8f9\uc5d0 \uc18c\uc18d\ub418\uc9c0 \uc54a\uc740 \uc0ac\uc6a9\uc790\ub97c \uacb8\uc9c1\uc73c\ub85c \ucd94\uac00\ud560 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4."]);break;case"empty or more than 64 length.":e.goMessage(m["\uc0ac\uc774\ud2b8 \uadf8\ub8f9\uba85\uc744 1\uc790 \uc774\uc0c1 64\uc790 \ubbf8\ub9cc\uc73c\ub85c \uc785\ub825\ud558\uc138\uc694."]);break;case"already belonged to other group.":e.goMessage(m["\uc774\ubbf8 \ub2e4\ub978 \uadf8\ub8f9\uc5d0 \uc18d\ud55c \uc0ac\uc774\ud2b8\ub97c \ucd94\uac00\ud560 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4."]);break;case"duplicated company group name.":e.goMessage(m["\uc774\ubbf8 \uc0ac\uc6a9\uc911\uc778 \uc0ac\uc774\ud2b8\uba85\uc785\ub2c8\ub2e4."]);break;default:e.goMessage(m["500 \uc624\ub958\ud398\uc774\uc9c0 \ub0b4\uc6a9"])}else e.goMessage(m["500 \uc624\ub958\ud398\uc774\uc9c0 \ub0b4\uc6a9"])}})},_onCancelButtonClicked:function(){this._reload()},_onListButtonClicked:function(){this._goToList()},_onUserIntegrationChecked:function(t){var n=e(t.currentTarget);n.attr("id")=="checkAllUserIntegration"?e('input[name="userIntegration"]').prop("checked",n.is(":checked")):n.is(":checked")||e("#checkAllUserIntegration").prop("checked",!1)},_onUserIntegrationDeleteClicked:function(){var t=e('input[name="userIntegration"]:checked'),n=[];t.each(function(t){n.push(e(this).data("userlistkey"))}),_.each(n,function(e){this.siteGroup.removeUserIntegrationByUserListKey(e)},this),this._renderTemplate(undefined,this.siteGroupId)},_onUserIntegrationShowClicked:function(t){t.preventDefault();var n=e(t.currentTarget).parents("tr"),r=n.find('input[name="userIntegration"]').data("userlistkey"),i=this.siteGroup.getUserIntegrationByUserListKey(r),s=this;this._loadUserIntegrationLayer(i,function(e){s.siteGroup.updateUserIntegration(i,e),s._renderTemplate(undefined,this.siteGroupId)})},_onUserIntegrationAddClicked:function(t){t.preventDefault();if(_.isEmpty(this.siteGroup.get("companies")))return e.goMessage(m["2\uac1c \uc774\uc0c1\uc758 \uc0ac\uc774\ud2b8\uac00 \ub9e4\uce6d\ub418\uc5b4\uc57c \ud569\ub2c8\ub2e4"]),!1;var n=this;this._loadUserIntegrationLayer({},function(e){n.siteGroup.addUserIntegration(e),n._renderTemplate(undefined,this.siteGroupId)})},_loadUserIntegrationLayer:function(t,n){var r=this;e.goPopup({pclass:"layer_normal layer_admin_sideJob layer_user_integration",header:m["\uacb8\uc9c1\uc790 \uc124\uc815"],modal:!0,width:600,contents:"",buttons:[{btext:d["\ud655\uc778"],autoclose:!1,btype:"confirm",callback:function(e){if(!i.validate())return!1;n(i.getData()),e.close()}},{btext:d["\ucde8\uc18c"],btype:"cancel"}]});var i=new g({el:".layer_user_integration .content",availableCompanyIds:_.map(this.siteGroup.get("companies"),function(e){return e.id}),data:t});i.render()},_reload:function(){this.siteGroup.isNew()?this._goToCreate():this._goToShow(this.siteGroup.get("id"))},_goToCreate:function(){GO.router.navigate("system/sitegroup/create",{trigger:!0})},_goToShow:function(e){GO.router.navigate("system/sitegroup/"+e+"/modify",{trigger:!0})},_goToList:function(){GO.router.navigate("system/sitegroup",{trigger:!0})}},{create:function(e){return instance=new y({el:e.el?e.el:"#layoutContent",siteGroupId:e?e.siteGroupId:""}),instance.siteGroupId=e?e.siteGroupId:"",instance.render()}});return{render:function(e){var t=y.create(e);return t}}});