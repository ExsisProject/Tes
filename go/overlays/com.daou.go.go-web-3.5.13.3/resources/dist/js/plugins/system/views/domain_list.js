(function(){define(["jquery","backbone","app","hgn!system/templates/domain_list","hgn!system/templates/list_empty","system/models/licenseModel","i18n!nls/commons","i18n!admin/nls/admin","jquery.go-grid","jquery.go-sdk","GO.util","jquery.go-validation"],function(e,t,n,r,i,s,o,u){var a={label_add:o["\ucd94\uac00"],label_delete:o["\uc0ad\uc81c"],label_domain_name:u["\ub3c4\uba54\uc778\uba85"],label_loginmod:u["\ub85c\uadf8\uc778 \ubc29\ubc95"],label_confirm_delete:u["\uc0ad\uc81c\ud558\uc2dc\uac8c\uc2b5\ub2c8\uae4c?"],label_check_delete_item:u["\uc0ad\uc81c\ud560 \ud56d\ubaa9\uc744 \uc120\ud0dd\ud558\uc138\uc694."],label_breadcrumb:u["\ub3c4\uba54\uc778/\uc0ac\uc774\ud2b8 \uad00\ub9ac > \ub3c4\uba54\uc778 \ubaa9\ub85d"],label_register_user_license:u["\uc0ac\uc6a9\uc790 \ub77c\uc774\uc120\uc2a4\ub97c \ub4f1\ub85d\ud574\uc8fc\uc138\uc694."],label_search:o["\uac80\uc0c9"],label_search_domain:u["\ub3c4\uba54\uc778 \uac80\uc0c9"]},f=t.View.extend({el:"#layoutContent",initialize:function(){this.listEl="#domainList",this.licenseModel=s.read(),this.dataTable=null,this.unbindEvent(),this.bindEvent()},unbindEvent:function(){this.$el.off("click","span#btn_add"),this.$el.off("click","span#btn_delete"),this.$el.off("click","span#btn_search"),this.$el.off("keydown","input#search")},bindEvent:function(){this.$el.on("click","span#btn_add",e.proxy(this.addDomain,this)),this.$el.on("click","span#btn_delete",e.proxy(this.deleteDomain,this)),this.$el.on("click","span#btn_search",e.proxy(this.searchDomain,this)),this.$el.on("keydown","input#search",e.proxy(this.searchKeyboardEvent,this))},toggleCheckbox:function(e){},addDomain:function(){this.licenseModel.get("hasUserLicense")==0?e.goAlert(u["\uc0ac\uc6a9\uc790 \ub77c\uc774\uc120\uc2a4\ub97c \ub4f1\ub85d\ud574\uc8fc\uc138\uc694."]):this.isExceedLicenseUser()?e.goAlert(u["\ucd5c\ub300 \uc0ac\uc6a9\uc790 \uc218\ub97c \ucd08\uacfc\ud558\uc600\uc2b5\ub2c8\ub2e4."]):this.isExceedLicenseUser()||n.router.navigate("system/domain/create",!0)},deleteDomain:function(t){var n=this,r=e("#domainList input[type=checkbox]:checked"),i=e(t.currentTarget).attr("data-defaultdomain");for(var s=0;s<r.length;s++)if(r[s].value==i){e.goAlert(u["\ub514\ud3f4\ud2b8 \ub3c4\uba54\uc778\uc740 \uc0ad\uc81c\ud560 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4."]),e("#domainList input[type=checkbox]:checked").attr("checked",!1);return}if(r.length==0)return e.goAlert("",u["\uc0ad\uc81c\ud560 \ud56d\ubaa9\uc744 \uc120\ud0dd\ud558\uc138\uc694."]);e.goConfirm(u["\uc0ad\uc81c\ud558\uc2dc\uaca0\uc2b5\ub2c8\uae4c?"],"",function(){var t=GO.contextRoot+"ad/api/system/domains";options={ids:[]};for(var i=0;i<r.length;i++){if(r[i].value=="on")continue;options.ids.push(r[i].value)}if(n.hasCompanyies(options.ids)){e.goMessage(u["\uc0ac\uc774\ud2b8\uc5d0\uc11c \uc0ac\uc6a9\uc911\uc778 \ub3c4\uba54\uc778\uc785\ub2c8\ub2e4."]);return}if(options.ids.length==0)return;e.go(t,JSON.stringify(options),{qryType:"DELETE",contentType:"application/json",responseFn:function(t){e.goMessage(o["\uc0ad\uc81c\ub418\uc5c8\uc2b5\ub2c8\ub2e4."]),n.render()},error:function(t){e.goMessage(o["\uc2e4\ud328\ud588\uc2b5\ub2c8\ub2e4."])}})})},render:function(t){e("#site").addClass("on"),e(".breadcrumb .path").html(u["\ub3c4\uba54\uc778/\uc0ac\uc774\ud2b8 \uad00\ub9ac > \ub3c4\uba54\uc778 \ubaa9\ub85d"]),this.$el.empty(),this.$el.html(r({lang:a})),this.renderDomainList(t),e("#search").attr("value",t)},renderDomainList:function(t){var r=this,s=null;this.$tableEl=this.$el.find("#domainList"),this.dataTable=e.goGrid({el:this.listEl,method:"GET",url:GO.contextRoot+"ad/api/system/domains",emptyMessage:i({label_desc:u["\ud45c\uc2dc\ud560 \ub370\uc774\ud130 \uc5c6\uc74c"]}),pageUse:!0,sDomUse:!0,checkbox:!0,sDomType:"admin",checkboxData:"mailDomainSeq",defaultSorting:[[1,"desc"]],params:{keyword:t},displayLength:n.session("adminPageBase"),columns:[{mData:"mailDomain",sWidth:"500px",bSortable:!0,fnRender:function(e){return e.aData.defaultDomain=="this"&&(s=e.aData.mailDomainSeq),"<div id='name"+e.aData.mailDomainSeq+"'>"+e.aData.mailDomain+"</div>"}},{mData:null,sWidth:"400px",bSortable:!1,fnRender:function(e){return e.aData.loginMode=="empno"?u["\uc778\uc2dd\ubc88\ud638(\uc0ac\ubc88/\ud559\ubc88)"]:e.aData.loginMode=="id"?u["\uc544\uc774\ub514"]:""}}],fnDrawCallback:function(t){r.$el.find(".toolbar_top .custom_header").append(r.$el.find("#controllButtons").show()),r.$el.find(this.el+" tr>td:nth-child(2)").css("cursor","pointer").click(function(t){n.router.navigate("system/domain/modify/"+e(t.currentTarget).parent().find("input").val(),{trigger:!0})}),r.$tableEl.find('input[type="checkbox"][value="'+s+'"]').parent().parent().css("background-color","#b0c4de"),r.$el.find("#btn_delete").attr("data-defaultdomain",s)}})},isExceedLicenseUser:function(){var t=!1,n=GO.contextRoot+"ad/api/system/company/userstat";return e.go(n,"",{qryType:"GET",async:!1,responseFn:function(e){e.code==200&&e.data.licenseUserCount-e.data.companiesUserCount<=0&&(t=!0)},error:function(t){var n=JSON.parse(t.responseText);e.goMessage(n.message)}}),t},searchKeyboardEvent:function(e){e.keyCode==13&&this.searchDomain()},searchDomain:function(){keyword=e("#search").val();if(keyword=="")return e.goMessage(o["\uac80\uc0c9\uc5b4\ub97c \uc785\ub825\ud558\uc138\uc694."]),!1;if(!e.goValidation.isCheckLength(2,255,keyword))return e.goMessage(n.i18n(o["0\uc790\uc774\uc0c1 0\uc774\ud558 \uc785\ub825\ud574\uc57c\ud569\ub2c8\ub2e4."],{arg1:"2",arg2:"255"})),!1;if(!e.goValidation.charValidation("/\\/",keyword))return e.goMessage(u["\uc785\ub825\ud560 \uc218 \uc5c6\ub294 \ubb38\uc790"]),!1;this.render(keyword)},hasCompanyies:function(t){var n=!0,r=GO.contextRoot+"ad/api/system/domain/hascompanies";return e.go(r,JSON.stringify({ids:t}),{qryType:"POST",contentType:"application/json",async:!1,responseFn:function(e){e.code==200&&(n=e.data)},error:function(t){e.goMessage(o["\uc2e4\ud328\ud588\uc2b5\ub2c8\ub2e4."])}}),n}},{__instance__:null});return f})}).call(this);