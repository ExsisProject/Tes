(function(){define(["backbone","app","views/circle","admin/libs/recurrence_parser","i18n!nls/commons","i18n!admin/nls/admin","i18n!calendar/nls/calendar","hgn!system/templates/notice/form","system/models/notice","file_upload","attach_file","GO.util","jquery.go-validation","go-webeditor/jquery.go-webeditor","go-notice","jquery.go-preloader","jquery.go-sdk","formeditor","jquery.jstree","jquery.go-popup","jquery.go-orgslide"],function(e,t,n,r,i,s,o,u,a,f,l){function p(){var e=this.$el.find("#startDate").val()+" 00:00",n=this.$el.find("#endDate").val()+" 23:59",r=this.$el.find("#state").is(":checked")?"NORMAL":"HIDDEN";this.model.set({title:this.$el.find("#title").val(),content:t.Editor.getInstance("notice_editor").getContent(),startTime:e,endTime:n,option:this.$el.find("input:radio[name='option']:checked").val(),state:r})}function d(){return $.goValidation.isCheckLength(0,64,this.model.get("title"))?(this.$el.find("#name_validation").hide(),!0):(this.$el.find("#name_validation").show(),this.$el.find("#title").focus(),!1)}function v(){this.model.get("attaches")&&$.each(this.model.get("attaches"),function(){this.file_icon=t.util.getFileIconStyle({extention:this.extention}),this.sizeByKb=t.util.getHumanizedFileSize(this.size)});var e='<div class="banner" style="background:#20bec6; height:60px">"<br/><a href="http://daouoffice.com/edu_cloud.html" target="_blank"><br/>    <!-- \ud3b8\uc9d1\uae30\uc758 \uc778\ub77c\uc778 \uc774\ubbf8\uc9c0\ub97c \ud1b5\ud574 \ub4f1\ub85d\ud574\uc8fc\uc138\uc694 --><br/>    <img src="images/banner_edu.png" title="\ub2e4\uc6b0\uc624\ud53c\uc2a4 \uc0ac\uc6a9\uc790 \uad50\uc721\uc5d0 \ucd08\ub300\ud569\ub2c8\ub2e4." /><br/></a><br/>';'<!-- id=bannerClose \ub85c \uc9c0\uc815\ud574\uc57c X\ubc84\ud2bc\uc774 \ub3d9\uc791\ud569\ub2c8\ub2e4. --><br/><a id="bannerClose" class="btn_layer_bigx" title="\ub2e4\uc2dc \uc5f4\uc9c0 \uc548\uc74c"><br/>    <span class="ic">  </span><br/></a></div>',this.$el.html(u({lang:c,data:$.extend({},this.model.toJSON(),{hasByDay:this.model.hasByDay(),isNoneMode:this.model.isNoneMode(),convertedStartTime:this.model.getConvertStartTime(),convertedEndTime:this.model.getConvertEndTime(),isNormalState:this.model.isNormalState(),sample:e})}))}function m(){var e=$("#startDate"),n=$("#endDate");$.datepicker.setDefaults($.datepicker.regional[t.config("locale")]),e.datepicker({dateFormat:"yy-mm-dd",changeMonth:!0,changeYear:!0,yearSuffix:"",minDate:t.util.customDate(new Date,"YYYY-MM-DD"),onSelect:function(e){n.datepicker("option","minDate",e)}}),n.datepicker({dateFormat:"yy-mm-dd",changeMonth:!0,changeYear:!0,yearSuffix:"",minDate:this.model.getConvertStartTime()})}function g(e,n,r){var i=this.isCreate?"":this.model.get("content");$("#notice_editor").goWebEditor({contextRoot:t.config("contextRoot"),lang:t.session("locale"),editorValue:i})}var c={notice_config:s["\ud31d\uc5c5 \uacf5\uc9c0 \uc124\uc815"],notice_detail_config:s["\ud31d\uc5c5 \uacf5\uc9c0 \uc0c1\uc138 \uc124\uc815"],notice_name:s["\uacf5\uc9c0 \uc81c\ubaa9"],limit_char:t.i18n(s["0\uc790\uc774\ud558 \uc785\ub825\ud574\uc57c\ud569\ub2c8\ub2e4."],{arg1:64}),content:s["\uacf5\uc9c0 \ub0b4\uc6a9"],term:s["\uacf5\uc9c0 \uae30\uac04"],options:s["\uc635\uc158"],option_4:s["\uc0ac\uc6a9\uc790\uc5d0\uac8c '\ub354\uc774\uc0c1 \uc5f4\uc9c0 \uc54a\uc74c' \uae30\ub2a5 \uc81c\uacf5"],save:i["\uc800\uc7a5"],cancel:i["\ucde8\uc18c"],save_success:i["\uc800\uc7a5\ub418\uc5c8\uc2b5\ub2c8\ub2e4."],attach_file:i["\ud30c\uc77c\ucca8\ubd80"],remove:i["\uc0ad\uc81c"],target:s["\uacf5\uc9c0 \ub300\uc0c1"],targetAll:s["\uc804\uccb4 \uc0ac\uc6a9\uc790"],state:s["\uc0ac\uc6a9\uc5ec\ubd80"],normal:s["\uc0ac\uc6a9"],recur:o["\ubc18\ubcf5"],scope:o["\ud2b9\uc815\uae30\uac04"],usedesc:s["\ud31d\uc5c5\uacf5\uc9c0\uc0ac\uc6a9\uc5ec\ubd80"],web:s["\uc6f9"],mobile:s["\ubaa8\ubc14\uc77c"],mobile_size_desc:s["\ubaa8\ubc14\uc77c\uc740 \uae30\uae30\uc5d0 \ub9de\ucdb0\uc11c \uc0ac\uc774\uc988\uac00 \uc790\ub3d9 \uc9c0\uc815\ub429\ub2c8\ub2e4."],mobile_option_1_desc:s["\ub85c\uadf8\uc778 \ud560 \ub54c\ub9c8\ub2e4 \uc0ac\uc6a9\uc790\uc5d0\uac8c \ubcf4\uc5ec\uc8fc\uae30 \ubaa8\ubc14\uc77c \uc548\ub0b4"]},h=e.View.extend({events:{"click #save":"save","click #cancel":"cancel","click #targetAll":"changeTarget","click input[name='term']":"changeTerm","click input[name='month']":"changeMonthOrWeek","click input[name='week']":"changeMonthOrWeek","click input[id*='_all']":"selectAll","change #startDay":"changeDay","change select[data-tag=repeatSelect]":"changeRecurrence","change input[data-tag=repeatSelect]":"changeRecurrence"},initialize:function(){$(".breadcrumb .path").html("\ub85c\uadf8\uc778\ud398\uc774\uc9c0 \uacf5\uc9c0"),this.isCreate=this.options.noticeId==undefined?!0:!1,this.model=new a,this.isCreate?this.model.setInitData():(this.model.set({id:this.options.noticeId}),this.model.fetch({async:!1}))},render:function(){v.call(this),g.call(this),m.call(this)},save:function(){if(!t.Editor.getInstance("notice_editor").validate())return $.goError(commonLang["\ub9c8\uc784 \uc0ac\uc774\uc988 \ucd08\uacfc"]),!1;var e=$.goPreloader();e.render(),p.call(this);if(!d.call(this))return e.release(),!1;this.model.save(null,{success:function(){e.release();var n="system/extension/frontnotice";$.goMessage(c.save_success),t.router.navigate(n,{trigger:!0})},error:function(t,n){e.release(),n.message?$.goAlert(n.message):$.goMessage(i["\uc2e4\ud328\ud588\uc2b5\ub2c8\ub2e4."])}})},changeMonthOrWeek:function(e){var t=$(e.currentTarget),n=t.attr("name"),r=t.attr("id");n=="month"&&!$(e.currentTarget).is(":checked")&&r!="month_all"&&$("#month_all").attr("checked",!1),n=="week"&&!$(e.currentTarget).is(":checked")&&r!="week_all"&&$("#week_all").attr("checked",!1)},selectAll:function(e){var t=$(e.currentTarget),n=t.is(":checked");$("input[name='"+t.attr("name")+"']").attr("checked",n)},changeDay:function(e){var t=$(e.currentTarget),n=t.attr("id"),r=t.val();(parseInt(r)>parseInt($("#endDay option:selected").val())||r==-1)&&$("#endDay option:selected").val()!=-1&&$("#endDay").val(r);var i=$("#"+n+" option:selected").prevAll();$("#endDay").children().attr("disabled",!1),_.each(i,function(e){$("#endDay option[value="+e.value+"]").attr("disabled",!0)})},cancel:function(){var e="system/extension/frontnotice";t.router.navigate(e,{trigger:!0})}},{render:function(e){var t=new h(e);return t.render(),t}});return h})})();