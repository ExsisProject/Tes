(function(){define(["jquery","backbone","app","system/models/hostModel","hgn!system/templates/cache_list","hgn!system/templates/list_empty","i18n!nls/commons","i18n!admin/nls/admin","jquery.go-grid","jquery.go-sdk","GO.util"],function(e,t,n,r,i,s,o,u){var a={label_host:u["\ud638\uc2a4\ud2b8 \uc120\ud0dd"],label_service:u["\uc11c\ube44\uc2a4 \uc120\ud0dd"],label_delete:u["\uce90\uc2dc \ube44\uc6b0\uae30"],label_breadcrumb:u["\uce90\uc2dc \uad00\ub9ac"],label_cacheName:u["\uce90\uc2dc\uba85"],label_cacheHits:u["\uce90\uc2dc \uc131\uacf5"],label_cacheMisses:u["\uce90\uc2dc \uc2e4\ud328"],label_cacheHitRatio:u["\uce90\uc2dc \uc801\uc911\ub960"],label_count:u["\uce90\uc2dc \uc5d4\ud2b8\ub9ac \uc218"],label_size:u["\uce90\uc2dc \uc0ac\uc774\uc988"],label_description:u["\uc124\uba85"]},f=t.View.extend({events:{"click span#btn_delete":"deleteCache","click input:checkbox":"toggleCheckbox","change select#hostName":"changeOption","change select#serviceType":"changeOption"},initialize:function(){this.listEl="#cacheList",this.dataTable=null,this.hostModel=new r,this.hostModel.fetch({async:!1})},changeOption:function(t){var n=e(t.currentTarget).attr("name"),r=e(t.currentTarget).attr("value");this.dataTable.tables.setParam(n,r)},toggleCheckbox:function(t){this.$el.find("#checkedAll").is(":checked")&&e('input[type="checkbox"][value="shiro-admin-session-cache"]').attr("checked",!1),e(t.currentTarget).is(":checked")?e(t.currentTarget).attr("checked",!0):(this.$el.find("#checkedAll").attr("checked",!1),e(t.currentTarget).attr("checked",!1))},deleteCache:function(){var t=this,n=e("#cacheList input[type=checkbox]:checked");if(n.length==0)return e.goAlert("",u["\uc0ad\uc81c\ud560 \ud56d\ubaa9\uc744 \uc120\ud0dd\ud558\uc138\uc694."]);e.goConfirm(u["\uce90\uc2dc \uc0ad\uc81c\uacbd\uace0"],"",function(){var r=e("#hostName option:selected").val()==null?e("#hostName option:first").val():e("#hostName option:selected").val(),i=e("#serviceType option:selected").val()==null?"front":e("#serviceType option:selected").val(),s=GO.contextRoot+"ad/api/cache/evict",u={names:[],hostName:r,serviceType:i};for(var a=0;a<n.length;a++){if(n[a].value=="on")continue;u.names.push(n[a].value)}if(u.names.length==0)return;e.go(s,JSON.stringify(u),{qryType:"PUT",contentType:"application/json",responseFn:function(n){e.goMessage(o["\uc0ad\uc81c\ub418\uc5c8\uc2b5\ub2c8\ub2e4."]),t.render()},error:function(t){e.goMessage(o["\uc2e4\ud328\ud588\uc2b5\ub2c8\ub2e4."])}})})},render:function(){e(".breadcrumb .path").html(u["\uce90\uc2dc \uad00\ub9ac"]),this.$el.empty();var t=[];e.each(this.hostModel.toJSON(),function(e,n){n.hostName!=null&&t.push({hostName:n.hostName})}),this.$el.html(i({lang:a,hostNames:t}));var n=e("#hostName option:selected").val()==null?e("#hostName option:first").val():e("#hostName option:selected").val(),r=e("#serviceType option:selected").val()==null?"front":e("#serviceType option:selected").val();this.renderCacheList(n,r)},renderCacheList:function(t,n){console.log(t),console.log(n);var r=this,i=GO.contextRoot+"ad/api/cache/list";this.searchParams={hostName:t,serviceType:n},this.dataTable=e.goGrid({el:this.listEl,method:"GET",url:i,params:this.searchParams,emptyMessage:s({label_desc:u["\ud45c\uc2dc\ud560 \ub370\uc774\ud130 \uc5c6\uc74c"]}),pageUse:!1,sDomUse:!1,checkbox:!0,displayLength:999,sDomType:"admin",checkboxData:"name",columns:[{mData:"name",bSortable:!1,fnRender:function(e){return e.aData.name}},{mData:null,bSortable:!1,fnRender:function(e){return u[e.aData.name]}},{mData:"cacheHits",sWidth:"100px",sClass:"align_r",bSortable:!1,fnRender:function(e){return e.aData.cacheHits}},{mData:"cacheMisses",sWidth:"100px",sClass:"align_r",bSortable:!1,fnRender:function(e){return e.aData.cacheMisses}},{mData:null,sWidth:"130px",sClass:"align_r",bSortable:!1,fnRender:function(e){var t=0;return e.aData.cacheHits==0&&e.aData.cacheMisses==0&&(t=0),e.aData.cacheHits+e.aData.cacheMisses!=0&&(t=e.aData.cacheHits/(e.aData.cacheHits+e.aData.cacheMisses)),(t*100).toFixed(1)}},{mData:"objectCount",sWidth:"100px",sClass:"align_r",bSortable:!1,fnRender:function(e){return e.aData.objectCount}},{mData:"size",sWidth:"140px",sClass:"align_r",bSortable:!1,fnRender:function(e){return e.aData.size}}],fnDrawCallback:function(t){r.$el.find(".toolbar_top").append(r.$el.find("#controlButtons").show()),r.$el.find(".toolbar_top .custom_header").append(r.$el.find("#controllButtons").show()),e('input[type="checkbox"][value="shiro-admin-session-cache"]').attr("disabled",!0)}})}},{__instance__:null});return f})}).call(this);