(function(){define(["jquery","backbone","app","hgn!system/templates/ehr_stat","hgn!system/templates/list_empty","i18n!nls/commons","i18n!board/nls/board","i18n!admin/nls/admin","jquery.go-grid","jquery.go-sdk","GO.util"],function(e,t,n,r,i,s,o,u){var a={label_siteName:u["\uc0ac\uc774\ud2b8\uba85"],label_ehr_stat:u["\uadfc\ud0dc \ud1b5\uacc4"],label_execution:u["\uc2e4\ud589"],label_all:s["\uc804\uccb4"]},f=t.View.extend({events:{"click span.btn_execution":"execute"},initialize:function(){this.dataTable=null},render:function(){var t=this;e(".breadcrumb .path").html(u["\uadfc\ud0dc \ud1b5\uacc4"]),this.$el.empty(),this.$el.html(r({lang:a})),t.setCompanyList(),t.initDate(!0),t.initDate(!1),e("select.companyList").val(GO.session("companyId"))},execute:function(t){var r=this,i=this.getUrl(e(t.currentTarget).attr("id"));GO.EventEmitter.trigger("common","layout:setOverlay",""),e.go(i,"",{qryType:"GET",contentType:"application/json",timeout:3e3,responseFn:function(t){t.code==200?e.goMessage(n.i18n(u["{{arg1}} \uc2e4\ud589 \uc131\uacf5"],{arg1:u["\uadfc\ud0dc \ud1b5\uacc4"]})):e.goMessage(n.i18n(u["{{arg1}} \uc2e4\ud589 \uc2e4\ud328"],{arg1:u["\uadfc\ud0dc \ud1b5\uacc4"]})),GO.EventEmitter.trigger("common","layout:clearOverlay",!0)},error:function(t){t.statusText=="timeout"?e.goMessage(n.i18n(u["{{arg1}} \uc2e4\ud589 \uc131\uacf5"],{arg1:u["\uadfc\ud0dc \ud1b5\uacc4"]})):e.goMessage(n.i18n(u["{{arg1}} \uc2e4\ud589 \uc2e4\ud328"],{arg1:u["\uadfc\ud0dc \ud1b5\uacc4"]})),GO.EventEmitter.trigger("common","layout:clearOverlay",!0)}})},initDate:function(t){var n=this;e.datepicker.setDefaults(e.datepicker.regional[GO.config("locale")]);var r=t?this.$el.find("#allStartDate"):this.$el.find("#startDate"),i=t?this.$el.find("#allEndDate"):this.$el.find("#endDate");r.val(GO.util.now().format("YYYY-MM-DD")),i.val(GO.util.now().format("YYYY-MM-DD")),r.datepicker({dateFormat:"yy-mm-dd",changeMonth:!0,changeYear:!0,yearSuffix:"",maxDate:i.val()}),i.datepicker({dateFormat:"yy-mm-dd",changeMonth:!0,changeYear:!0,yearSuffix:"",onClose:function(e){r.datepicker("option","maxDate",e)}})},setCompanyList:function(){var t=GO.contextRoot+"ad/api/system/companies?offset=999";e.go(t,"",{qryType:"GET",async:!1,responseFn:function(t){e.each(t.data,function(t,n){e("select.companyList").append('<option value="'+n.id+'">'+n.name+"</option>")})},error:function(t){var n=JSON.parse(t.responseText);e.goMessage(n.message)}})},getUrl:function(t){var n="";if(t=="ehrStatWithCompany"){var r=e("#companyList").val(),i=GO.util.toISO8601(GO.util.toMoment(e("#startDate").val())),s=GO.util.toISO8601(GO.util.toMoment(e("#endDate").val()).add("days",1).subtract("seconds",1));n=GO.contextRoot+"ad/api/ehr/attnd/stat/all/batch-with-companyId"+"?"+e.param({startDate:i,endDate:s,companyId:r})}else{var i=GO.util.toISO8601(GO.util.toMoment(e("#allStartDate").val())),s=GO.util.toISO8601(GO.util.toMoment(e("#allEndDate").val()).add("days",1).subtract("seconds",1));n=GO.contextRoot+"ad/api/ehr/attnd/stat/all/batch"+"?"+e.param({startDate:i,endDate:s})}return n}},{__instance__:null});return f})}).call(this);