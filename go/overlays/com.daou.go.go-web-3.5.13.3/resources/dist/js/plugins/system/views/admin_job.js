(function(){define(["jquery","backbone","app","hgn!system/templates/admin_job","hgn!system/templates/admin_job_item_head","i18n!nls/commons","i18n!admin/nls/admin","jquery.go-grid"],function(e,t,n,r,i,s,o){var u=["sync_data","re_sync_data","sync_legacy_db","migration"],a={deleteJob:s["\uc0ad\uc81c"],detailJob:s["\uc0c1\uc138"],doSyncJob:s["\uc218\ud589"]},f=n.BaseView.extend({events:{"click #sync_start":"syncStart","click #sync_detail":"syncDetail","click #sync_delete":"syncDelete","click #redo_checked_item":"syncCheckedJobItem","click #redo_all_failed_item":"syncAllFailedJobItem","click #show_data_detail":"showDataDetail"},initialize:function(){},render:function(){var t=this;this.$el.empty();var n=r({lang:a});return this.$el.html(n),this.renderAdminJobList(),e(".breadcrumb .path").html(o["AdminJob \uad00\ub9ac"]),this.$el},syncStart:function(){e.go(GO.contextRoot+"ad/api/system/sync/job","",{qryType:"post",async:!1,contentType:"application/json",responseFn:function(){e.goMessage(o["\uc218\ud589\uc774 \uc644\ub8cc\ub418\uc5c8\uc2b5\ub2c8\ub2e4."]),n.router.navigate("system/extension/adminjob",{trigger:!0})},error:function(t){e.goMessage(t.responseJSON.message)}})},syncDetail:function(){var t=e("#admin_job_list tbody input[type=checkbox]:checked");if(t.length==0)return e.goMessage(o["\ud56d\ubaa9\uc774 \uc120\ud0dd\ub418\uc9c0 \uc54a\uc558\uc2b5\ub2c8\ub2e4."]);if(t.length>1)return e.goMessage(o["\ud56d\ubaa9\uc740 \ud55c\uac1c\ub9cc \uc120\ud0dd\uac00\ub2a5\ud569\ub2c8\ub2e4."]);var n=t[0].value,r=t.parent().parent().find("td:last").text();this.adminJobItemList&&this.adminJobItemList.tables.fnDestroy(),this.renderAdminJobItemList(n,"all",r),e("#admin_job_item_list").attr("job_id",n)},syncDelete:function(){var t=this,r=e("#admin_job_list tbody input[type=checkbox]:checked");if(r.length==0)return e.goMessage(o["\ud56d\ubaa9\uc774 \uc120\ud0dd\ub418\uc9c0 \uc54a\uc558\uc2b5\ub2c8\ub2e4."]);if(r.length>1)return e.goMessage(o["\ud56d\ubaa9\uc740 \ud55c\uac1c\ub9cc \uc120\ud0dd\uac00\ub2a5\ud569\ub2c8\ub2e4."]);var i=r[0].value;e.go(GO.contextRoot+"ad/api/system/adminjob/"+i,"",{qryType:"delete",async:!1,contentType:"application/json",responseFn:function(){e.goMessage(o["\uc0ad\uc81c\uac00 \uc644\ub8cc\ub418\uc5c8\uc2b5\ub2c8\ub2e4."]),n.router.navigate("system/extension/adminjob",{trigger:!0})},error:function(t){e.goMessage(t.responseJSON.message)}})},syncCheckedJobItem:function(t){var r=this.adminJobItemList.tables.getCheckedIds();if(r.length==0){e.goMessage(o["\ud56d\ubaa9\uc774 \uc120\ud0dd\ub418\uc9c0 \uc54a\uc558\uc2b5\ub2c8\ub2e4."]);return}var i=e("#admin_job_item_list").attr("job_id"),s=JSON.stringify(r);e.go(GO.contextRoot+"ad/api/system/adminjob/retry/"+i,s,{qryType:"post",async:!1,contentType:"application/json",responseFn:function(){e.goMessage(o["\uc218\ud589\uc774 \uc644\ub8cc\ub418\uc5c8\uc2b5\ub2c8\ub2e4."]),n.router.navigate("system/extension/adminjob",{trigger:!0})},error:function(t){e.goMessage(t.responseJSON.message)}})},syncAllFailedJobItem:function(t){var r=e("#admin_job_item_list").attr("job_id");e.go(GO.contextRoot+"ad/api/system/adminjob/retry/all/"+r,"",{qryType:"post",async:!1,contentType:"application/json",responseFn:function(){e.goMessage(o["\uc218\ud589\uc774 \uc644\ub8cc\ub418\uc5c8\uc2b5\ub2c8\ub2e4."]),n.router.navigate("system/extension/adminjob",{trigger:!0})},error:function(t){e.goMessage(t.responseJSON.message)}})},showDataDetail:function(){var t=this.adminJobItemList.tables.getCheckedIds();if(t.length==0)return e.goMessage(o["\ud56d\ubaa9\uc774 \uc120\ud0dd\ub418\uc9c0 \uc54a\uc558\uc2b5\ub2c8\ub2e4."]);if(t.length>1)return e.goMessage(o["\ud56d\ubaa9\uc740 \ud55c\uac1c\ub9cc \uc120\ud0dd\uac00\ub2a5\ud569\ub2c8\ub2e4."]);var n=t[0];this.getJobItem(n).then(function(n){var r=e.Deferred();try{var i=n.data;i=i.substring(i.indexOf("{"),i.length),i=JSON.stringify(JSON.parse(i),null,"<br>"),i=i.substring(1,i.length-1),r.resolve(i)}catch(o){e.goMessage(s["\ub370\uc774\ud130\ub97c \ud45c\uc2dc\ud560 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4."])}return r.promise()}).then(function(n){e.goPopup({pclass:"layer_normal layer_count",header:o["\ub370\uc774\ud130 \uc0c1\uc138"],contents:n,buttons:[{btype:"close",btext:s["\ub2eb\uae30"]}]})})},getJobItem:function(t){var n=e.Deferred();return e.go(GO.contextRoot+"ad/api/system/adminjob/item/"+t,"",{qryType:"get",async:!1,contentType:"application/json",responseFn:function(e){n.resolve(e.data)},error:function(t){e.goMessage(t.responseJSON.message)}}),n.promise()},renderAdminJobList:function(){var t=this;this.$tableEl=this.$el.find("#admin_job_list"),this.adminJobList=e.goGrid({el:"#admin_job_list",method:"GET",destroy:!0,url:GO.contextRoot+"ad/api/system/adminjob/list",params:this.searchParams,emptyMessage:"<p class='data_null'> <span class='ic_data_type ic_no_data'></span><span class=\"txt\">"+s["\uc5c6\uc74c"]+"</span>"+"</p>",defaultSorting:[[6,"desc"]],sDomType:"admin",checkbox:!0,checkboxData:"jobId",columns:[{mData:"jobId",sWidth:"100px",bSortable:!1},{mData:"companyId",sWidth:"100px",bSortable:!0},{mData:"size",sWidth:"100px",bSortable:!0},{mData:"successCount",sWidth:"100px",bSortable:!0},{mData:"failCount",sWidth:"100px",bSortable:!0},{mData:"startedAt",bSortable:!0,fnRender:function(e){return GO.util.basicDate(e.aData.startedAt)}},{mData:"endedAt",bSortable:!0,fnRender:function(e){return GO.util.basicDate(e.aData.endedAt)}},{mData:null,sWidth:"150px",bSortable:!1,fnRender:function(e){return e.aData.operator!=undefined?e.aData.operator.name:""}},{mData:"jobName",bSortable:!0}],fnDrawCallback:function(e,n,r){t.$el.find("#admin_job_list_wrapper .toolbar_top .custom_header").append(t.$el.find("#controlButtons1").show())}})},renderAdminJobItemList:function(t,r,a){var f=this,l=u.indexOf(a)>-1?!0:!1;l||(l=a.indexOf("re_sync_data")>-1?!0:!1);var c='<div class="critical" id="controlButtons3" style="display: none"><span class="btn_tool" id="show_data_detail">'+o["\ub370\uc774\ud130 \uc0c1\uc138"]+"</span>"+'<span class="btn_tool" id="redo_checked_item">'+o["\uc120\ud0dd\ub370\uc774\ud130 \uc7ac\uc218\ud589"]+"</span>"+'<span class="btn_tool" id="redo_all_failed_item">'+o["\ubaa8\ub4e0 \uc2e4\ud328\ub370\uc774\ud130 \uc7ac\uc218\ud589"]+"</span></div>";this.$el.find("#admin_job_item_container").append(c),this.$tableEl=this.$el.find("#admin_job_item_list"),this.$tableEl.html(""),this.$tableEl.append(i()),this.adminJobItemList=e.goGrid({el:"#admin_job_item_list",method:"GET",destroy:!0,url:GO.contextRoot+"ad/api/system/adminjob/"+t+"/item/"+r,params:this.searchParams,checkbox:l,checkboxData:"id",emptyMessage:'<p class=\'data_null\'> <span class="ic_data_type ic_no_data"></span><span class="txt">'+s["\uc5c6\uc74c"]+"</span>"+"</p>",defaultSorting:[[1,"asc"]],sDomType:"admin",displayLength:n.session("adminPageBase"),columns:[{mData:"id",sWidth:"100px",bSortable:!0},{mData:"jobId",sWidth:"100px",bSortable:!0},{mData:"status",sWidth:"100px",bSortable:!0},{mData:"data",bSortable:!0},{mData:"message",bSortable:!0}],fnDrawCallback:function(e,t,n){l&&f.$el.find("#admin_job_item_list_wrapper .toolbar_top .custom_header").append(f.$el.find("#controlButtons3").show())}})}},{__instance__:null});return f})}).call(this);