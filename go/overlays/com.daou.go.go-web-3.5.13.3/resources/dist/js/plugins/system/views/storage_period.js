(function(){define(["jquery","backbone","app","hgn!system/templates/storage_period","i18n!nls/commons","i18n!admin/nls/admin","jquery.go-grid","jquery.go-sdk","GO.util"],function(e,t,n,r,i,s){var o={label_set_storage_period:s["\ubcf4\uad00 \uae30\uac04 \uc124\uc815"],label_noti_period:s["\uc54c\ub9bc \ubcf4\uad00 \uae30\uac04"],label_chat:s["\ub300\ud654\ub0b4\uc6a9 \ubcf4\uad00 \uae30\uac04"],label_attach:s["\ucca8\ubd80\ud30c\uc77c \ubcf4\uad00 \uae30\uac04"],label_chat_and_attach:s["\ub300\ud654 \ubc0f \ucca8\ubd80\ud30c\uc77c \ubcf4\uad00 \uae30\uac04"],label_ok:i["\uc800\uc7a5"],label_cancel:i["\ucde8\uc18c"],label_direct_input:s["\uc9c1\uc811 \uc785\ub825"],label_months:s["\uac1c\uc6d4"],label_days:s["\uc77c\ub2e8\uc704"],label_years:s["\ub144\ub2e8\uc704"],label_validation_input:s["(1~999 \uc785\ub825\uac00\ub2a5)"],label_tool_tip:s["\ub300\ud654\ub0b4\uc6a9 \ubcf4\uad00 \uae30\uac04 \uc124\uba85"],label_apply_all:s["\uc2dc\uc2a4\ud15c \uc124\uc815"],label_apply_site:s["\uc0ac\uc774\ud2b8 \ubcc4 \uc124\uc815"]},u=t.View.extend({el:"#layoutContent",initialize:function(){this.unbindEvent(),this.bindEvent(),this.model=null},unbindEvent:function(){this.$el.off()},bindEvent:function(){this.$el.on("click","#btn_ok",e.proxy(this.saveStoragePeriod,this)),this.$el.on("click","#btn_cancel",e.proxy(this.cancelStoragePeriod,this)),this.$el.on("change","#notiPeriod",e.proxy(this.selectNotiPeriod,this)),this.$el.on("change","[name='applyType']",e.proxy(this.toggleRadio,this))},render:function(){e("#etcConfig").addClass("on");var t=this,n=e.Deferred();return e.when(this.getStoragePeriod()).then(function(){e(".breadcrumb .path").html(s["\uae30\ud0c0 \uc124\uc815"]+" > "+s["\ubcf4\uad00 \uae30\uac04 \uc124\uc815"]),e("#layoutTitle").html(s["\ubcf4\uad00 \uae30\uac04 \uc124\uc815"]),t.$el.html(r({lang:o,isApplyAll:function(){return"ALL"==t.model.applyType?!0:!1}})),n.resolveWith(t,[t]),t.selectedValueFromModel(),t.toggleRadio()}),n},getStoragePeriod:function(){var t=this,n=e.Deferred(),r=GO.contextRoot+"ad/api/system/storagePeriod",t=this;return e.go(r,"",{qryType:"GET",responseFn:function(e){e.code==200&&(t.model=e.data,n.resolve())},error:function(e){}}),n},saveStoragePeriod:function(){var t=this,r=e.Deferred(),o={},u=GO.contextRoot+"ad/api/system/storagePeriod",a=t.$("#notiPeriod").val(),f=Number(t.$("#chatPeriod").val()),l=Number(t.$("#chatAttachPeriod").val());if(a=="etc"){var c=t.$("#notiPeriodDirectValue").val();if(isNaN(c)||c<1){e.goError(s["\uc22b\uc790\ub9cc \uc785\ub825\ud558\uc138\uc694."]);return}a=c+"_days"}if(isNaN(f)||f<1||isNaN(l)||l<1){e.goError(s["\uc22b\uc790\ub9cc \uc785\ub825\ud558\uc138\uc694."]);return}if(l>f){e.goError(n.i18n(s["\ub300\ud654\ub0b4\uc6a9 ge \ucca8\ubd80\ud30c\uc77c \ubcf4\uad00\uae30\uac04"]));return}return o.notiPeriod=a,o.chatPeriod=f,o.chatAttachPeriod=l,o.applyType=e("[name='applyType']:checked").val(),e.go(u,JSON.stringify(o),{qryType:"PUT",contentType:"application/json",responseFn:function(n){n.code==200&&(e.goMessage(i["\uc800\uc7a5\ub418\uc5c8\uc2b5\ub2c8\ub2e4."]),t.model=n.data,r.resolve())},error:function(t){e.goMessage(responseData.message)}}),r},selectedValueFromModel:function(){var t=this,n=this.model.notiPeriod,r=this.model.chatPeriod,i=this.model.chatAttachPeriod,s=!1;e.each(e("select#notiPeriod option"),function(r,i){if(e(i).val()==n)return t.$("#notiPerioddirect").hide(),e(i).attr("selected","selected"),s=!0,!1});if(!s){t.$("#notiPerioddirect").show(),t.$("select#notiPeriod option[value='etc']").attr("selected","selected"),t.$("#notiPeriodDirectValue").removeAttr("disabled");var o=n.split("_");t.$("#notiPeriodDirectValue").val(o[0])}t.$("#chatPeriod").val(r),t.$("#chatAttachPeriod").val(i)},selectNotiPeriod:function(t){e(t.currentTarget).val()=="etc"?(this.$("#notiPerioddirect").show(),this.$("#notiPeriodDirectValue").removeAttr("disabled").val("1")):(this.$("#notiPerioddirect").hide(),this.$("#notiPeriodDirectValue").attr("disabled","disabled").val("-"))},toggleRadio:function(){var t=e("[name='applyType']:checked").val();t=="ALL"?(e("#chatPeriodDiv").show(),e("#chatAttachPeriodDiv").show()):(e("#chatPeriodDiv").hide(),e("#chatAttachPeriodDiv").hide())},cancelStoragePeriod:function(e){this.render()}},{__instance__:null});return u})}).call(this);