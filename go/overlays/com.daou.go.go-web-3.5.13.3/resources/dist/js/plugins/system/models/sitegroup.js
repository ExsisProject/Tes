define(["backbone","system/models/user_integration","system/collections/companies"],function(e,t,n){var r=e.Collection.extend({model:t,getByUserListKey:function(e){return this.find(function(t){return t.generateUserListKey()==e})},removeByUserListKey:function(e){var t=this.getByUserListKey(e);t&&this.remove(t)},removeByCompanyId:function(e){var t=this.filter(function(t){return t.hasCompanyUser(e)});this.remove(t)}}),i=e.Model.extend({defaults:{id:null,name:"",orgTreeShareScope:"NO_USER",orgTreeShareContent:"TREE",orgTreeShareUser:null,companies:null,userIntegrations:null},initialize:function(){_.isEmpty(this.get("companies"))&&this.set("companies",[]),_.isEmpty(this.get("userIntegrations"))&&this.set("userIntegrations",[])},url:function(){var e=GO.contextRoot+"ad/api/system/companygroup";return this.get("id")&&(e+="/"+this.get("id")),e},addCompany:function(e){this._setCompaniesSeq();var t=new n(this.get("companies"));t.add(e),this.set("companies",t.toJSON()),this._setCompaniesSeq()},removeCompany:function(e,t){this._setCompaniesSeq();var r=new n(this.get("companies")),i=r.get(e),s=r.indexOf(i);return i?(r.remove(i),_.isFunction(t)&&t(r,i,s),this.set("companies",r.toJSON()),i.set("companyGroup",null),this._setCompaniesSeq(),i):i},moveCompanyTop:function(e){this.removeCompany(e,function(e,t,n){e.add(t,{at:0})})},moveCompanyUp:function(e){this.removeCompany(e,function(e,t,n){e.add(t,{at:n==0?0:n-1})})},moveCompanyDown:function(e){this.removeCompany(e,function(e,t,n){e.add(t,{at:n==e.size()?n:n+1})})},moveCompanyBottom:function(e){this.removeCompany(e,function(e,t,n){e.add(t)})},_setCompaniesSeq:function(){var e=this.get("companies");for(var t=0;t<e.length;t++)e[t].seq=t},getUserIntegrationByUserListKey:function(e){var t=new r(this.get("userIntegrations"));return integration=t.getByUserListKey(e),integration.toJSON()},removeUserIntegrationByUserListKey:function(e){var t=new r(this.get("userIntegrations"));t.removeByUserListKey(e),this.set("userIntegrations",t.toJSON())},removeUserIntegrationOfCompany:function(e){var t=new r(this.get("userIntegrations"));t.removeByCompanyId(e),this.set("userIntegrations",t.toJSON())},isOrgShareToNoUser:function(){return this.get("orgTreeShareScope")=="NO_USER"},isOrgShareToSelectedUser:function(){return this.get("orgTreeShareScope")=="SELECTED_USER"},isOrgShareToAllUser:function(){return this.get("orgTreeShareScope")=="ALL_USER"},isOrgShareByTree:function(){return this.get("orgTreeShareContent")=="TREE"},addUserIntegration:function(e){var n=new r(this.get("userIntegrations"));n.add(new t(e)),this.set("userIntegrations",n.toJSON())},updateUserIntegration:function(e,t){var n=new r(this.get("userIntegrations")),s,o;s=_.map(e.users,function(e){return e.id}),o=n.getByUserListKey(i.generateUserListKey(s)),o&&o.set(t),this.set("userIntegrations",n.toJSON())}},{generateUserListKey:function(e){return t.generateUserListKey(e)}});return i});