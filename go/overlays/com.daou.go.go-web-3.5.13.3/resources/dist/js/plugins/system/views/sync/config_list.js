define(function(require){var e=require("backbone"),t=require("system/views/sync/config_detail"),n=require("system/views/sync/config_item"),r=require("system/models/sync/config_query_model"),i=require("hgn!system/templates/sync/config_list"),s=require("i18n!admin/nls/admin"),o=require("i18n!nls/commons"),u={label_sync_query_list_title:s["\ub3d9\uae30\ud654 \uc124\uc815"],label_add:o["\ucd94\uac00"],label_delete:o["\uc0ad\uc81c"],label_sync_company_select:s["\ud68c\uc0ac \uc120\ud0dd"],label_all:o["\uc804\uccb4"],label_sync_company_name:s["\ud68c\uc0ac\uba85"],label_sync_jdbc_name:s["Jdbc Name"],label_sync_query_type:s["Query Type"],label_sync_query_columns:s["Key Columns"],label_sync_query:s.Query,label_empty_list:s["\ud45c\uc2dc\ud560 \ub370\uc774\ud130 \uc5c6\uc74c"],label_sync_delete:s["\ub3d9\uae30\ud654 \uc124\uc815 \uc0ad\uc81c"],label_sync_delete_message:s["\ud574\ub2f9 \ub3d9\uae30\ud654 \uc124\uc815\uc744 \uc0ad\uc81c\ud558\uc2dc\uaca0\uc2b5\ub2c8\uae4c?"],label_delete_check_error_message:s["\uc0ad\uc81c\ud560 \ub370\uc774\ud130\uac00 \uc120\ud0dd\ub418\uc9c0 \uc54a\uc558\uc2b5\ub2c8\ub2e4."],label_delete_success_message:s["\uc815\uc0c1\uc801\uc73c\ub85c \uc0ad\uc81c\ub418\uc5c8\uc2b5\ub2c8\ub2e4."],label_delete_error_message:s["\uc0ad\uc81c\uc5d0 \uc2e4\ud328\ud558\uc600\uc2b5\ub2c8\ub2e4."]},a=e.Collection.extend({model:r,companyId:null,url:function(){var e={company_id:this.companyId};return GO.contextRoot+"ad/api/sync/queries?"+$.param(e)},setCompanyId:function(e){this.companyId=e}}),f="<td class='align_c' colspan='6'><p class='data_null'><span class='ic_data_type ic_no_data'></span> <span class='txt'>"+u.label_empty_list+"</span></p></td>",l=e.View.extend({events:{"change #sortCompanies":"_refreshListByComapny","click #add_btn":"_addQuery","click #delete_btn":"_deleteQuery","click #group_all":"_checkAll"},initialize:function(){this.queryList=new a,this.companies=this.options.companies,this.queryList.fetch({async:!1})},render:function(){var e=this;$(".breadcrumb .path").html(s["\ub370\uc774\ud130 \ub3d9\uae30\ud654 \uc124\uc815 / \uc218\ud589"]),this.$el.html(i({lang:u,companies:this.companies,isSelectedCompany:function(){return this.id==e.queryList.companyId}}));var t=this.$el.find("#syncConfigTable tbody");this.queryList.length==0&&t.append(f),this.queryList.each($.proxy(function(e){var r=new n({model:e,companies:this.companies});t.append(r.el),r.render()},this))},_refreshListByComapny:function(){var e=$("#sortCompanies option:selected").val();_.isEmpty(e)&&(e=null),this.queryList.setCompanyId(e),this.queryList.fetch({async:!1}).done($.proxy(this,this.render()))},_addQuery:function(){var e=new t({companies:this.companies});e.render()},_deleteQuery:function(){function t(){var t=[],n=$(".check input:checked");if(_.isEmpty(n)){$.goError(u.label_delete_check_error_message);return}$.each(n,function(e,n){var r=$(n).val();if(_.isEmpty(r))return;t.push(r)});var r={deleteList:t.join(",")};$.ajax({method:"DELETE",contentType:"application/json; charset=UTF-8",dataType:"json",data:JSON.stringify(r),url:GO.contextRoot+"ad/api/sync/query",success:function(){$.goMessage(u.label_delete_success_message),e._refreshListByComapny()},error:function(){$.goError(u.label_delete_error_message)}})}var e=this;$.goCaution(u.label_sync_delete,u.label_sync_delete_message,t)},_checkAll:function(e){var t=e.target.checked;$.each($(".check input"),function(e,n){this.checked=t})}});return l});