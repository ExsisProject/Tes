define(function(require){var e=require("jquery"),t=require("backbone"),n=require("app"),r=require("hgn!system/templates/laboratory/feedback/list");return require("jquery.go-sdk"),require("jquery.go-grid"),n.BaseView.extend({events:{"click #use_config_btn":"_clickUseConfig","click #add_config":"_clickAddConfig","click #delete_config":"_clickDeleteConfig"},initialize:function(){e(".breadcrumb .path").html("\uc2e4\ud5d8\uc2e4 \ud53c\ub4dc\ubc31 \uc124\uc815 \ubaa9\ub85d"),this.useLabFeedback=GO.useLabFeedback,this.feedbackConfigGrid=null},render:function(){return this.$el.html(r({useLabFeedback:this.useLabFeedback})),this.useLabFeedback&&this._renderGrid(),this.$el},_renderGrid:function(){this.feedbackConfigGrid=e.goGrid({el:"#feedback_config_table",method:"GET",destroy:!0,url:GO.contextRoot+"ad/api/laboratory/feedback/configs",params:this.searchParams,emptyMessage:"<p class='data_null'> <span class='ic_data_type ic_no_data'></span><span class='txt'>\uc5c6\uc74c</span></p>",defaultSorting:[[1,"desc"]],sDomType:"admin",checkbox:!0,checkboxData:"id",displayLength:GO.session("adminPageBase"),columns:[{mData:"id",sWidth:"100px",bSortable:!0},{mData:"title",sClass:"subject",bSortable:!0},{mData:"appliedVersion",bSortable:!0},{mData:"startDate",bSortable:!0,fnRender:function(e){var t=moment(e.aData.startDate).format("YYYY-MM-DD"),n=moment(e.aData.endDate).format("YYYY-MM-DD");return t+" ~ "+n}},{mData:"createdAt",sWidth:"200px",bSortable:!0,fnRender:function(e){return moment(e.aData.createdAt).format("YYYY-MM-DD HH:mm:ss")}},{mData:"useConfig",bSortable:!0,fnRender:function(e){return e.aData.useConfig?'<input type="radio" name="usgConfig" value='+e.aData.id+" data-id="+e.aData.id+" checked> <label>\uc0ac\uc6a9\uc911</label>":'<input type="radio" name="usgConfig" value='+e.aData.id+" data-id="+e.aData.id+'> <span class="btn_tool" id="use_config_btn" data-id='+e.aData.id+">\uc0ac\uc6a9\ubcc0\uacbd</span>"}},{mData:null,sClass:"last action",bSortable:!1,fnRender:function(e){return'<span class="btn_s" data-id='+e.aData.id+">\uc124\uc815</span>"}}],fnDrawCallback:e.proxy(function(){this.$el.find(".toolbar_top .custom_header").append(this.$el.find("#controlButtons").show()),this.$el.find("tr>td.last span.btn_s").css("cursor","pointer").click(function(t){var n="system/extension/laboratory/feedback/config/"+e(t.currentTarget).attr("data-id");GO.router.navigate(n,{trigger:!0})})},this)}).tables},_clickUseConfig:function(t){var n=this,r=e(t.currentTarget).attr("data-id"),i=e("input[name=usgConfig]:checked").val();if(r!==i){e.goMessage("\uc120\ud0dd\ud55c \uc124\uc815\uacfc \uc0c1\uc774\ud569\ub2c8\ub2e4. \ub2e4\uc2dc \uc120\ud0dd \ud6c4 \ud074\ub9ad\ud574 \uc8fc\uc138\uc694.");return}e.goConfirm("\uc0ac\uc6a9\ubcc0\uacbd","\uc0ac\uc6a9\ud560 \ud53c\ub4dc\ubc31 \uc124\uc815\uc744 \ubcc0\uacbd \ud558\uc2dc\uaca0\uc2b5\ub2c8\uae4c?",function(){e.ajax({type:"PUT",async:!0,dataType:"json",contentType:"application/json",url:GO.config("contextRoot")+"ad/api/laboratory/feedback/config/change/"+i}).done(function(t){e.goMessage("\uc0ac\uc6a9\ud560 \uc124\uc815\uc774 \ubcc0\uacbd\ub418\uc5c8\uc2b5\ub2c8\ub2e4."),n.feedbackConfigGrid.reload()})})},_clickAddConfig:function(){GO.router.navigate("system/extension/laboratory/feedback/config/create",{trigger:!0})},_clickDeleteConfig:function(){var t=this,n=this.feedbackConfigGrid.getCheckedIds(),r=e("#feedback_config_table").find('tbody input[type="checkbox"]:checked').length;if(r!==n.length)return;if(n.length===0){e.goMessage("\uc120\ud0dd\ud55c \ud56d\ubaa9\uc774 \uc5c6\uc2b5\ub2c8\ub2e4.");return}e.goConfirm("\uc124\uc815\uc0ad\uc81c","\uc120\ud0dd\ud558\uc2e0 \uc124\uc815(\ub4e4)\uc744 \uc0ad\uc81c\ud558\uc2dc\uaca0\uc2b5\ub2c8\uae4c?",function(){e.ajax({type:"DELETE",async:!0,data:JSON.stringify({ids:n}),dataType:"json",contentType:"application/json",url:GO.config("contextRoot")+"ad/api/laboratory/feedback/configs"}).done(function(n){e.goMessage("\uc0ad\uc81c\ub418\uc5c8\uc2b5\ub2c8\ub2e4"),t.feedbackConfigGrid.reload()})})}})});