(function(){define(["jquery","underscore","backbone","calendar/collections/events_pool","calendar/libs/util","jquery.go-preloader"],function(e,t,n,r,i){var s=new r,o=new r,u=new r,a=n.View.extend({tagName:"div",id:"calendar-viewport",eventsPool:s,beforePool:o,afterPool:u,initialize:function(){this._registCalViewRef()},release:function(){this.undelegateEvents(),this.remove()},addCalendar:function(e){return this.beforePool.add(e),this.eventsPool.add(e),this.afterPool.add(e),this},clearCalendars:function(){return this.beforePool.clear(),this.eventsPool.clear(),this.afterPool.clear(),this},beforeSideSelect:function(){var e=i.getSavedSelectedCalendar().split(",");t.each(t.keys(this.eventsPool.getCollections()),function(n){t.contains(e,n)||this.eventsPool.remove(n)},this)},hasAuth:function(){return!0},changeDate:function(e){},resize:function(e){},changeType:function(e){return this},_registCalViewRef:function(){var e="GO_ref_calendar_view";if(!this.name)throw new Error("name \uc18d\uc131\uc774 \ud544\uc694\ud569\ub2c8\ub2e4.");window[e]||(window[e]=this),window[e].name!==this.name&&(window[e].release(),window[e]=this)},showCalendar:function(n){var r=e.Deferred(),i=t.isArray(n)?n:[n],s=!1;return t.each(i,function(e,t){this.eventsPool.contains(e.id)?this.eventsPool.show(e.id):(this.beforeSideSelect(),this.eventsPool.isCached=!1,this.eventsPool.add(e.id),this.beforePool.add(e.id),this.afterPool.add(e.id),s=!0)},this),s&&r.notify(),r.resolve(),r},hideCalendar:function(n){var r=e.Deferred(),i=t.isArray(n)?n:[n],s=!1;return t.each(i,function(e,t){this.eventsPool.contains(e.id)&&(this.eventsPool.remove(e.id),this.beforePool.remove(e.id),this.afterPool.remove(e.id),s=!0)},this),s&&r.notify(this),r.resolve(this),r},getCalendarEvent:function(t,n,r){this.eventsPool.setBoundaryTime(t,n),this.eventsPool.setIncludingAttendees(!0);var i=this.eventsPool.fetch();this.eventsPool.setIncludingAttendees(!1);var s=e.goPreloader();return i.progress(function(){s.render()}),i.always(function(){s.release()}),i},getCalendarEvents:function(t,n,r){var i=this._isContained(t,n),s=this._getBoundaryDate(),o=e.Deferred();if(i&&this.eventsPool.isCached&&!r)o.resolve(this.eventsPool);else if(this.eventsPool.isCached&&!r){var u=this._makeNewPool();this._outOfBoundary(t,n)?this._renewalPools(t,n):this._isMoveForward(t)?(this.afterPool=this.eventsPool,this.eventsPool=this.beforePool,this.beforePool=u,this.beforePool.setBoundaryTime(s.beforeStartDate,s.beforeEndDate),this.beforePool.fetch()):(this.beforePool=this.eventsPool,this.eventsPool=this.afterPool,this.afterPool=u,this.afterPool.setBoundaryTime(s.afterStartDate,s.afterEndDate),this.afterPool.fetch()),this.eventsPool.isFetching?(GO.util.preloader(this.eventsPool.fetching),this.eventsPool.fetching.done(e.proxy(function(){o.resolve(this.eventsPool)},this))):o.resolve(this.eventsPool)}else this.beforePool.setBoundaryTime(s.beforeStartDate,s.beforeEndDate),this.afterPool.setBoundaryTime(s.afterStartDate,s.afterEndDate),this.eventsPool.setBoundaryTime(t,n),o=this.eventsPool.fetch(),this.beforePool.fetch(),this.afterPool.fetch(),GO.util.preloader(o);return o},_makeNewPool:function(){var e=new r;return t.each(this.eventsPool.getCollections(),function(t){e.add(t.calendarId)}),e},_outOfBoundary:function(e,t){var n=moment(this.beforePool.timeMin),r=moment(this.afterPool.timeMax);return e.isBefore(n)||t.isAfter(r)},_renewalPools:function(e,t){this.beforePool.setBoundaryTime(e.clone().add("months",-1),t.clone().add("months",-1)),this.eventsPool.setBoundaryTime(e,t),this.afterPool.setBoundaryTime(e.clone().add("months",1),t.clone().add("months",1)),this.beforePool.fetch(),this.eventsPool.fetch(),this.afterPool.fetch()},_isMoveForward:function(e){var t=moment(this.eventsPool.timeMin);return e-t<=0},_isContained:function(e,t){if(!this.eventsPool.timeMin||!this.eventsPool.timeMax)return!1;var n=moment(this.eventsPool.timeMin),r=moment(this.eventsPool.timeMax);return e-n>=0&&t-r<=0}});return a})}).call(this);