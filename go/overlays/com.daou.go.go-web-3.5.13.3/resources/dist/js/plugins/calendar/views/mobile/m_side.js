(function(){define(["jquery","backbone","app","hgn!calendar/templates/mobile/m_side","calendar/collections/calendar_feeds","i18n!calendar/nls/calendar","calendar/collections/calendars","calendar/libs/util","i18n!nls/commons"],function(e,t,n,r,i,s,o,u,a){var f={my_calendar:s["\ub0b4 \uce98\ub9b0\ub354"],my_plan:s["\ub0b4 \uc77c\uc815"],feeds:s["\uad00\uc2ec \uce98\ub9b0\ub354"],company_calendar:s["\uc804\uc0ac\uc77c\uc815"],cal_default_name:s["\uce98\ub9b0\ub354 \uae30\ubcf8\uc774\ub984"],cal_display_name:s["\uce98\ub9b0\ub354 \ud45c\uc2dc\uc774\ub984"],cal_default:s["\uae30\ubcf8 \uce98\ub9b0\ub354 \ud45c\uc2dc"],calendar:a["\uce98\ub9b0\ub354"],all:a["\uc804\uccb4"]},l=t.View.extend({className:"go_side",attributes:{style:"position:static;"},unBindEvent:function(){this.$el.off("click","input[data-event-type='checkList']"),this.$el.off("click","#allFeedCheckbox")},bindEvent:function(){this.$el.on("click","input[data-event-type='checkList']",e.proxy(this.saveCheckedCalendar,this)),this.$el.on("click","#allFeedCheckbox",e.proxy(this.checkAllFeedCheckbox,this))},initialize:function(e){var t=this;this.options=e||{},this.checkAllCheckBox=!1,this.checkedCalendarIds=[],o.getCalendars().done(function(e){var n=u.getSavedSelectedCalendar();_.isUndefined(n)||n===""?(t.checkedCalendarIds.push(e.getMyCalendars()[0].id.toString()),u.saveCheckedCalendar(t.checkedCalendarIds)):t.checkedCalendarIds=n.split(","),t.checkedCalendarIds.indexOf(e.getHolidayCalendars()[0].id.toString())===-1&&(t.checkedCalendarIds.push(e.getHolidayCalendars()[0].id.toString()),u.saveCheckedCalendar(t.checkedCalendarIds))})},saveCheckedCalendar:function(t){var n=this;n.checkedOwnerIds=_.isUndefined(u.getSavedSelectedCalendarOwnerId())||u.getSavedSelectedCalendarOwnerId()===""?[]:u.getSavedSelectedCalendarOwnerId().split(",");var r=e(t.currentTarget),i=r.attr("data-calendar-owner-id"),s=r.attr("data-calendarid");r.is(":checked")?n.checkedCalendarIds.indexOf(s)<0&&(n.checkedCalendarIds.push(s),_.isUndefined(i)||n.checkedOwnerIds.push(i)):(n.checkedCalendarIds.indexOf(s)>-1&&n.checkedCalendarIds.splice(n.checkedCalendarIds.indexOf(s),1),n.checkedOwnerIds.indexOf(i)>-1&&n.checkedOwnerIds.splice(n.checkedOwnerIds.indexOf(i),1)),u.saveCheckedCalendarOwnerId(this.checkedOwnerIds),u.saveCheckedCalendar(this.checkedCalendarIds),this.checkAllCheckBox||this.setAllFeedCheckBoxProperty()},setAllFeedCheckBoxProperty:function(){var e=this.$el.find('input:checkbox[data-type="feed"]').length,t=this.$el.find('input:checkbox[data-type="feed"]:checked').length,r=this.$el.find('input:checkbox[data-type="all"]');r.prop("checked",e===t),n.EventEmitter.trigger("calendar","checkFeedBox")},checkAllFeedCheckbox:function(t){this.checkAllCheckBox=!0;var n=e(t.currentTarget);e("input:checkbox[data-type='feed']").prop("checked",!n.is(":checked")).click(),this.setAllFeedCheckBoxProperty(),this.checkAllCheckBox=!1},getCalendarFeeds:function(){return i.setUserId(n.session("id")).getData()},render:function(){this.packageName=this.options.packageName,this.feedsId=[];var n=this,i=e.Deferred();this.unBindEvent(),this.bindEvent();var s=new t.Collection(o.getCompanyCalendar()),u=[];e.each(o.getMyCalendar(),function(e,t){return u.push(t.toJSON())});var a=function(){return this.state=="following"?(n.feedsId.push(this.calendar.id),!0):!1},l=function(){return this.defaultCalendar===!0?!0:!1};return this.$el.html(r({data:this.getCalendarFeeds().toJSON(),feedName:function(){return this.calendar.name+"("+this.calendar.owner.name+")"},lang:f,companyCal:s.toJSON(),myCal:u,checkState:a,isDefaultCalendar:l,myCalName:function(){return this.defaultCalendar===!0?f.cal_default+" "+this.name:this.name}})),this.$el.find('input:checkbox[data-type="all"]').attr("data-calendarid",this.feedsId),this.setSideApp(),this.setCheckboxProperty(),i.resolveWith(this,[this]),i},setSideApp:function(){e("body").data("sideApp",this.packageName)},setCheckboxProperty:function(){var e=this;_.each(this.checkedCalendarIds,function(t){var n=e.$el.find('input:checkbox[data-calendarid="'+t+'"]');n.prop("checked",!0)}),this.setAllFeedCheckBoxProperty()}},{__instance__:null,create:function(e){return this.__instance__=new this.prototype.constructor({packageName:e}),this.__instance__}});return l})}).call(this);