define("calendar/views/mobile/m_calendar_write",function(require){var e=require("jquery"),t=require("backbone"),n=require("app"),r=require("views/mobile/header_toolbar"),i=require("hgn!calendar/templates/mobile/m_calendar_write"),s=require("hgn!calendar/templates/mobile/m_reminder"),o=require("hgn!calendar/templates/mobile/m_attendee"),u=require("hgn!calendar/templates/mobile/m_asset"),a=require("calendar/collections/calendars"),f=require("calendar/models/event"),l=require("asset/collections/asset_calendar"),c=require("asset/models/asset_user_create"),h=require("views/mobile/m_org"),p=require("calendar/views/external_attendee"),d=require("calendar/views/alarm_popup_layer"),v=require("i18n!nls/commons"),m=require("i18n!calendar/nls/calendar"),g=require("i18n!asset/nls/asset"),y=require("calendar/libs/util");require("jquery.mobile.autocomplete"),require("GO.util"),require("jquery.ui"),require("jquery.go-sdk");var b={minute:m["\ubd84\uc804"],hour:m["\uc2dc\uac04\uc804"],week:m["\uc8fc\uc804"],day:m["\uc77c\uc804"],subject:m["\uc77c\uc815\uba85"],add:v["\ucd94\uac00"],allday:m["\uc885\uc77c"],attendees:m["\ucc38\uc11d\uc790"],location:m["\uc7a5\uc18c"],reminder:m["\uc54c\ub78c"],my_cal:m["\ub0b4 \uce98\ub9b0\ub354"],placeholder_subject:m["\uc81c\ubaa9\uc744 \uc785\ub824\ud558\ub824\uba74 \ub204\ub974\uc138\uc694"],placeholder_location:m["\uc7a5\uc18c\ub97c \uc785\ub824\ud558\ub824\uba74 \ub204\ub974\uc138\uc694"],placeholder_content:m["\ub0b4\uc6a9\uc744 \uc785\ub825\ud558\uc138\uc694"],start:m["\uc2dc\uc791"],end:m["\uc885\ub8cc"],"private":v["\ube44\uacf5\uac1c"],reservation:m["\uc608\uc57d"],alert_no_reservation:v["\uc608\uc57d\ud560 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4."],alert_oneday:v["\uc608\uc57d\uc740 \ud558\ub8e8\ub9cc \uac00\ub2a5\ud569\ub2c8\ub2e4."],alert_cancel_asset:m["\uc608\uc57d\ud55c \uc790\uc0b0\uc774 \ucde8\uc18c\ub429\ub2c8\ub2e4."],cal_default:m["\uae30\ubcf8 \uce98\ub9b0\ub354 \ud45c\uc2dc"],external_participants:m["\uc678\ubd80\ucc38\uc11d\uc790"],companyType:m["\uc804\uc0ac\uc77c\uc815"],pushNoti:m["\ud478\uc2dc\uc54c\ub9bc"],mailNoti:m["\uba54\uc77c\uc54c\ub9bc"]},w=GO.util.now(),E=t.View.extend({initialize:function(e){this.headerToolbarView=r,this.isSaving=!1,this.eventDate=e.eventDate,this.calendarId=e.calendarId||"",this.eventId=e.eventId||"",this.isCopied=e.isCopied,this.startTime=e.startTime,this.endTime=e.endTime,this.key||(this.key=e.queryString||"empty"),this.mcalendarAsset=GO.util.store.get(this.key),this.mcalendarAsset&&(this.calendarId=this.mcalendarAsset.calendarId?this.mcalendarAsset.calendarId:this.calendarId,this.eventId=this.mcalendarAsset.eventId?this.mcalendarAsset.eventId:this.eventId,this.isCopied=this.mcalendarAsset.isCopied?this.mcalendarAsset.isCopied:this.isCopied),this.eventModel=new f(_.extend({id:this.eventId,calendarId:this.calendarId},this.mcalendarAsset)),this.assetList=new l({type:"assetList"}),this.reservations=new l({type:"current",eventId:this.eventId}),this.headerBindEvent()},headerBindEvent:function(){GO.EventEmitter.off("trigger-action"),GO.EventEmitter.on("trigger-action","calendar-save",this.calendarSaveAction,this)},events:{"vclick a[data-btntype='userAddBtn']":"callUserAddBtn","vclick a[data-btntype='remindersAdd']":"addReminderTemplete","vclick a[data-btntype='reminderDelete']":"reminderDelete","vclick a[data-btntype='asset']":"moveAssetList","vclick span[data-btntype='assetDelete']":"_onClickDeleteAssetItem","vclick #addExternal":"addExternal","vclick #delete_all_attendees":"_deleteAll","vclick span[data-btntype='attendeeDelete']":"deleteAttendee","keyup #description":"expandTextarea","change #allDay":"_onChangeAllDay","change #startTime":"changeStartTime","change #startTime, #endTime, #startDate, #endDate":"changeTime","change #startDate":"_onChangeStartDate","change #companyType":"_onCompanyCheckboxClicked","change #visibility":"_onPrivateCheckboxClicked"},render:function(){return e('div[data-role="layer"]').length?(e('div[data-role="layer"]').remove(),!1):(GO.isAvailableApp("asset")==1?(this.assetList.on("sync",e.proxy(function(e,t){this.renderWrite(e.toJSON())},this)),this.assetList.fetch()):this.renderWrite([]),this)},setTimeList:function(e){var t=[],n=moment().startOf("days"),r=30,i=48;for(var s=0;s<i;s++){var o=n.add("minutes",r).format("HH:mm");t.push(["<option value=",o,">",o,"</option>"].join(""))}e.append(t.join("\n"))},renderWrite:function(t){var n=GO.util.toMoment(new Date),r=this.eventDate?this.eventDate:n.format("YYYY-MM-DD"),s=GO.util.getIntervalTime(w).format("HH:mm"),o=GO.session("position")?GO.session("position"):"",u=_.map(a.getMyCalendar(),function(e){return e.toJSON()}),f=[];_.each(a.getCompanyCalendar(),function(e){e.get("permission")&&f.push(e.toJSON())});var l=i({lang:b,me:GO.session("name")+" "+o,userid:GO.session("id"),username:GO.session("name"),position:GO.session("position"),prevDate:r,prevTime:s,dataset:t,useAsset:GO.isAvailableApp("asset"),myCalList:u,comCalList:f,comCalListEmpty:f.length==0});this.$el.html(l),e("th.assetTH:first").html('<span class="title">'+b.reservation+"</span>"),this.isCopied||this._setAllDayView(),this.renderTitleToolbar(),this._initDatepicker(),this.setAppCallBack(),this.initAutoComplete(),this.setTimeList(e("#startTime")),this.setTimeList(e("#endTime")),this.setData(),e("#calId").find("option:first").attr("selected",!0),!this.mcalendarAsset&&this.isCopied&&GO.util.toastMessage(m["\ubcf5\uc0ac\ub41c \uc77c\uc815\uc785\ub2c8\ub2e4."])},expandTextarea:function(e){GO.util.textAreaExpand(e)},changeTime:function(e){console.log("on change time"),this._confirmDeleteAsset()||(this.$("#startDate").val(this.selectStartDate),this.$("#endDate").val(this.selectEndDate),this.$("#startTime").val(this.selectStartTime),this.$("#endTime").val(this.selectEndTime),this.$("#startTime").attr("data-prev",this.selectStartTime),this.$("#endTime").attr("data-prev",this.selectEndTime))},moveAssetList:function(t){var r=e(t.currentTarget).attr("data-assetid"),i=this.$("#startDate").val(),s=this.$("#endDate").val(),o=this.$("#startTime").val(),u=this.$("#endTime").val(),a=this.$("#allDay").is(":checked");if(GO.util.isBeforeToday(i)){alert(b.alert_no_reservation);return}var f=GO.util.toISO8601(GO.util.toMoment(i+" "+o,"YYYY-MM-DD HH:mm")),l=GO.util.toISO8601(GO.util.toMoment(s+" "+u,"YYYY-MM-DD HH:mm")),c={summary:this.$("#summary").val(),attendees:this.getAttendees(),externalAttendees:this.getExternalAttendees(),location:e("#location").val(),reminders:this.getReminders(),asset:this.getAsset(),description:e("#description").val(),calendarId:this.calendarId||"",eventId:this.eventId||"",allday:a,isCopied:this.isCopied,visibility:this.$("#visibility").is(":checked"),companyType:this.$("#companyType").is(":checked")};this.key!="empty"?GO.util.store.set(this.key,null):this.key=this._generateUUID(),GO.util.store.set(this.key,c,{type:"session"});var h=["asset",r,"list","calendar",f,l,this.key];n.router.navigate(h.join("/"),{trigger:!0,pushState:!0})},getAsset:function(){var t=[],n=[];return e("tr.assetList li").each(function(){n.push({attributeId:e(this).attr("data-attributeId"),content:e(this).attr("data-content")}),t.push({reservationId:e(this).attr("data-reservationid"),assetId:e(this).attr("data-assetid"),assetName:e(this).attr("data-assetname"),itemId:e(this).attr("data-itemId"),properties:n})}),t},getReminders:function(){var t=[];return e("#remindersPart span.remindersPart").each(function(){t.push({time:e(this).find("input").val(),type:e(this).find("select#reminder_type").val(),method:e(this).find("select#reminder_method").val()})}),t},getAttendees:function(){var t=[];return e("#attendeesUL li").each(function(){t.push({id:e(this).attr("data-userid"),name:e(this).attr("data-username"),position:e(this).attr("data-userposition")})}),t},getExternalAttendees:function(){var t=[];return _.each(this.$("#externals").find("span.name"),function(n){t.push({email:e(n).data().email,name:e(n).text()})}),t},_deleteAll:function(){this.$el.find("#attendeesUL li").not(":first").remove()},deleteAttendee:function(t){var n=e(t.currentTarget);n.parents("li").first().remove()},reminderDelete:function(t){t.preventDefault(),t.stopPropagation();var n=e(t.currentTarget);n.parents("span.remindersPart").first().remove()},addReminderTemplete:function(t){t.preventDefault(),t.stopPropagation();if(e("#remindersPart td input").length==5){alert(n.i18n(m["\uc54c\ub78c\uc740 \ucd5c\ub300 {{max}}\uac1c\uae4c\uc9c0\ub9cc \uc124\uc815\uc774 \uac00\ub2a5\ud569\ub2c8\ub2e4."],"max","5"));return}e("#remindersPart td").prepend(s({lang:b,time:"30"}))},callUserAddBtn:function(t){t.preventDefault(),t.stopPropagation();var r=[];e.each(e("#attendeesUL li"),function(){r.push({id:e(this).attr("data-userid"),username:e(this).attr("data-username"),position:e(this).attr("data-userposition")})}),GO.config("isMobileApp")?GO.util.callOrg(r):(n.router.navigate(n.router.getUrl()+"#org",{trigger:!1,pushState:!0}),this.orgView=new h({}),this.orgView.render({title:m["\ucc38\uc11d\uc790 \ucd94\uac00"],checkedUser:r,callback:function(t){var n=o({data:t});return e("#attendeesUL").html(n),!1}}))},getData:function(){var t=e("#summary").val(),n=this.$("#allDay").is(":checked"),r=e("#visibility").is(":checked"),i="public",s="00:00",o="00:00",u="allday";n?n&&this.mcalendarAsset!=undefined&&this.mcalendarAsset.asset.length>0&&(s=this.mcalendarAsset.asset[0].assetStartTime,o=this.mcalendarAsset.asset[0].assetEndTime=="24:00"?"23:59":this.mcalendarAsset.asset[0].assetEndTime):(s=this.$("#startTime").val(),o=this.$("#endTime").val(),u="timed"),r&&(i="private");var a=GO.util.toISO8601(GO.util.toMoment(e("#startDate").val()+" "+s,"YYYY-MM-DD HH:mm")),f=GO.util.toISO8601(GO.util.toMoment(e("#endDate").val()+" "+o,"YYYY-MM-DD HH:mm")),l=e("#location").val(),c=e("#description").val(),h;this.eventId?h=this.eventModel.get("type"):this.$("#companyCalIdWrap").is(":visible")?h="company":h="normal";var p=this.$("#calId").val();h=="company"&&(p=this.$("select[name=companyCalId]").val());var d=[];h!="company"&&e.each(e("#attendeesUL").find("li"),function(){d.push({id:e(this).attr("data-userid")})}),_.each(this.$("#externals").find("span.name"),function(t){d.push({email:e(t).data().email,name:e(t).text()})});var v={calendarId:p,type:h,summary:t,startTime:a,endTime:f,location:l,description:c,attendees:d,visibility:i,timeType:u,allday:n},m=[];e.each(e(".remindersPart"),function(){m.push({time:parseInt(e(this).find("input").val()),type:e(this).find("select#reminder_type").val(),method:e(this).find("select#reminder_method").val()})}),e(".remindersPart").length>0&&(v.reminders=m);var g=[];return this.eventId?(e.each(e("li[data-type='assetItemList']"),function(){var t=e(this).attr("data-reservationid");t&&g.push(t)}),e("li[data-type='assetItemList']").length>0&&(v.assetReservationIds=g)):v.assetReservationIds=g,v},isInvalidTime:function(){var t=e("#startDate").val(),n=e("#endDate").val()||t,r=e("#startTime").val(),i=e("#endTime").val(),s=moment(t+"T"+r+":00"),o=moment(n+"T"+i+":00");return s>o},submit:function(){function s(t){function i(){var n=this,i=e(n.alarmPopup.popupEl);isPushNoti=i.find("input:checkbox[id='chkbox_push']").is(":checked"),isMailNoti=i.find("input:checkbox[id='chkbox_mail']").is(":checked"),t.set("pushNoti",isPushNoti),t.set("mailNoti",isMailNoti),r.resolve(),o(t)}function s(){t.set("pushNoti",!1),t.set("mailNoti",!1),r.resolve(),o(t)}function u(){r.reject()}var n=this,r=e.Deferred();return this.alarmPopup=new d,this.alarmPopup.setConfirmCallback(i,this),this.alarmPopup.setCancelCallback(s,this),this.alarmPopup.setCloseCallback(u,this),this.alarmPopup.render({type:"mobile"}),r}function o(e){_.isNull(t.loc)&&(t.loc={},t.loc.type="monthly",t.loc.date=t.eventDate),GO.util.preloader(e.save({},{success:function(e){t.isSaving=!1,n.router.navigate("calendar/"+t.loc.type+"/"+t.loc.date,{trigger:!0,pushState:!0})},error:function(){t.isSaving=!1,alert(m["\uc77c\uc815 \ub4f1\ub85d\uc2dc \uc624\ub958\uac00 \ubc1c\uc0dd\ud558\uc600\uc2b5\ub2c8\ub2e4"])}}))}var t=this;if(this.isSaving)return;this.isSaving=!0;var r=this.getData();if(this.isInvalidTime()){this.$("#startTime").focus(),alert(m["\ub05d\uc2dc\uac04\uc740 \uc2dc\uc791\uc2dc\uac04\ubcf4\ub2e4 \uc774\uc804\uc73c\ub85c \ub4f1\ub85d\ud560 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4."]),this.isSaving=!1;return}if(r.summary==""){alert(m["\uc81c\ubaa9\uc744 \uc785\ub825\ud574 \uc8fc\uc2ed\uc2dc\uc624"]),e("#summary").focus(),this.isSaving=!1;return}if(e("#attendeesUL li").length==0&&r.type!="company"){alert(m["\ucc38\uc11d\uc790\ub97c \uc9c0\uc815\ud574 \uc8fc\uc2ed\uc2dc\uc624"]),this.isSaving=!1;return}this.loc=GO.util.getLocalStorage("calLocalStorage"),this._saveReservationAssets(r);if(this.eventId&&!this.isCopied)this.eventModel.toJSON().recurrence&&this.eventModel.setRecurChangeType("instance"),this.eventModel.off("error:validate"),this.eventModel.on("error:validate",e.proxy(this._validateErrorCallback,this)),this.eventModel.set(r),this.eventModel.isAlone()||r.type=="company"?o(this.eventModel):s(this.eventModel).done(function(){}).fail(function(){t.isSaving=!1});else{var i=new f;i.on("error:validate",e.proxy(this._validateErrorCallback,this)),i.set(r),i.isAlone()?o(i):s(i).done(function(){}).fail(function(){t.isSaving=!1})}},redirectUrl:function(){var e=GO.util.getLocalStorage("calLocalStorage");_.isNull(e)||_.isUndefined(e)?GO.util.goHome():n.router.navigate("calendar/"+e.type+"/"+e.date,{trigger:!0,pushState:!0})},renderTitleToolbar:function(){var t=this,n=this.eventId&&!this.isCopied?m["\uc77c\uc815 \uc218\uc815"]:m["\uc77c\uc815 \ub4f1\ub85d"],r={isClose:!0,title:n,closeCallback:e.proxy(function(){this.$("#startDate").datepicker("hide"),this.$("#endDate").datepicker("hide");if(GO.util.disagreeContentLoss())return;this.redirectUrl()},this),actionMenu:[{id:"calendar-save",text:v["\ud655\uc778"],triggerFunc:"calendar-save"}]};this.headerToolbarView.render(r)},calendarSaveAction:function(){var e=this;setTimeout(function(){e.$("#startDate").datepicker("hide"),e.$("#endDate").datepicker("hide"),e.submit()},200)},setAssetData:function(){this.reservations.on("sync",function(t,n){e("tr.assetList ul.name_tag li").remove(),e.each(t.toJSON(),function(t,n){e("tr.assetList ul[data-assetid='"+n.assetId+"']").append(u({reservationId:n.id,assetId:n.assetId,itemName:n.itemName,itemId:n.itemId}))})}),this.reservations.fetch()},setMcalendarAsset:function(){var t=this;this.me1=[],this.attendee1=[];var n=this.mcalendarAsset.summary,r=this.mcalendarAsset.location,i=this.mcalendarAsset.description;this.calendarId=this.mcalendarAsset.calendarId||this.calendarId,this.eventId=this.mcalendarAsset.eventId||this.eventId,this.$("#visibility").prop("checked",this.mcalendarAsset.visibility),this.$("#companyType").prop("checked",this.mcalendarAsset.companyType),this.$("#summary").val(n),this.$("#location").val(r),this.$("#description").val(i),this.mcalendarAsset.attendees.length>0&&(e("#attendeesUL").html(""),e.each(this.mcalendarAsset.attendees,function(e,n){n.id==GO.session("id")?t.me1.push(o({data:n})):t.attendee1.push(o({data:n}))}),e("#attendeesUL").html(t.me1.join("")+t.attendee1.join(""))),this.renderExternal(this.mcalendarAsset.externalAttendees),this.mcalendarAsset.reminders.length>0&&(this.$el.find("#remindersPart span.remindersPart").remove(),e.each(this.mcalendarAsset.reminders,function(t,n){e("#remindersPart td").prepend(s({lang:b,time:n.time})).find("select:first").val(n.type)})),this.mcalendarAsset.asset.length>0&&(this.$el.find("tr.assetList ul.name_tag li").remove(),e.each(this.mcalendarAsset.asset,function(t,n){var r="",i="";n.properties.length>0&&(r=n.properties[0].attributeId,i=n.properties[0].content),e("tr.assetList ul[data-assetid='"+n.assetId+"']").append(u({reservationId:n.reservationId,assetId:n.assetId,itemName:n.assetName,itemId:n.itemId,attributeId:r,content:i}))}))},setData:function(){if(this.eventId)this.setEventData(this.calendarId,this.eventId),!this.isCopied&&!this.mcalendarAsset&&this.setAssetData();else{var t=this.eventDate?this.eventDate:this.getDefaultDate(),n=this.getDefaultStartTime(),r=this.getDefaultEndTime();this.$el.find("#startDate").val(t),this.$el.find("#endDate").val(t),this.$("#startTime").val(n),this.$("#endTime").val(r),this.$("#startTime").attr("data-prev",n),this.$("#endTime").attr("data-prev",r)}if(this.mcalendarAsset){this.setMcalendarAsset(),this._hasAsset()&&(this.$("#startDate").attr("disabled","disabled"),this.$("#endDate").attr("disabled","disabled"));var i=GO.util.formatDatetime(this.startTime,null,"YYYY-MM-DD"),s=GO.util.formatDatetime(this.endTime,null,"YYYY-MM-DD"),o=GO.util.formatDatetime(this.startTime,null,"HH:mm"),u=GO.util.formatDatetime(this.endTime,null,"HH:mm");this.$("#startDate").val(i),this.$("#endDate").val(s),this.$("#startTime").val(o),this.$("#endTime").val(u),this._setAllDayView(this.mcalendarAsset.allday)}this.selectStartDate=e("#startDate").val(),this.selectEndDate=e("#endDate").val(),this.selectStartTime=e("#startTime").val(),this.selectEndTime=e("#endTime").val()},setAppCallBack:function(){window.addSuccess=function(t){var n=JSON.parse(t),r=o({data:n});e("#attendeesUL").html(r)}},getDefaultDate:function(){return w.clone().format("YYYY-MM-DD")},getDefaultStartTime:function(){return GO.util.getIntervalTime(w.clone()).format("HH:mm")},getDefaultEndTime:function(){return GO.util.getIntervalTime(w.clone().add("hours",1)).format("HH:mm")},setEventData:function(t,n){this.me1=[],this.attendee1=[],this.eventModel.fetch({async:!1});var r=this,i=this.eventModel,u=i.toJSON(),a=u.summary,f=GO.util.shortDate(u.startTime),l=GO.util.shortDate(u.endTime),c=GO.util.hourMinute(u.startTime),h=GO.util.hourMinute(u.endTime),p=u.location,d=u.description,t=u.calendarId,v=u.type;this.isCopied?(f=this.getDefaultDate(),l=this.getDefaultDate(),c=this.getDefaultStartTime(),h=this.getDefaultEndTime()):this._setAllDayView(u.timeType=="allday"),this.$("#startTime").val(c),this.$("#endTime").val(h),this.$("#startTime").attr("data-prev",c),this.$("#endTime").attr("data-prev",h),this.$("#summary").val(GO.util.calendarStrParse(a)),this.$("#startDate").val(f).attr({value:f}),this.$("#endDate").val(l).attr({value:l}),this.$("#location").val(GO.util.calendarStrParse(p)),this.$("#description").val(GO.util.calendarStrParse(d)),v=="company"?(this._setCompanyCalCheckboxVisible(!1),this._setCompanyCalSelectVisible(!0),this._setMyCalendarsVisible(!1),this._setInnerAttendeeVisible(!1),this.$("select[name=companyCalId]").val(t)):(this._setCompanyCalendarsVisible(!1),this.$("#calId").val(t)),u.reminders&&u.reminders.length>0&&(this.$el.find("#remindersPart span.remindersPart").remove(),e.each(u.reminders,function(t,n){var r=e("#remindersPart td").prepend(s({lang:b,time:n.time,index:t}));r.find("select[name=reminder_type_"+t+"]").val(n.type),r.find("select[name=reminder_method_"+t+"]").val(n.method)})),u.visibility=="private"&&e("#visibility").attr("checked",!0),u.attendees!=undefined&&u.attendees.length>0&&(e("#attendeesUL li").remove(),e.each(u.attendees,function(e,t){t.id==GO.session("id")?r.me1.push(o({data:t})):_.isUndefined(t.id)||r.attendee1.push(o({data:t}))}),e("#attendeesUL").prepend(r.me1.join("")+r.attendee1.join("")),this.attendee1.length>0&&this.$el.find("#delete_all_attendees").show()),this.renderExternal(this.eventModel.getExternalAttendees())},renderExternal:function(e){e.length&&(this.$("#externalArea").show(),this.$el.find("#externals li").remove()),_.each(e,function(e){var t=new p(e);this.$("#externals").append(t.render().el)},this)},addExternal:function(){var e=this.$el.find("#externalForm").val();if(!e)return;this.makeFormatUnit(this.$el.find("#externalForm"),e),this.$el.find("#externalForm").val(""),this.$el.find("#externalArea").show()},initAutoComplete:function(){var t={autoResizeWidth:!0,makeFormat:!0,makeFormatFunc:e.proxy(this.makeFormatUnit,this),multiple:!1,width:"400px",matchCase:!0,notContact:"F",excSearchOption:"RIPD",isDomainSearch:"F",offKeyPress:GO.util.msie()?!0:!1,width:300,customStyle:{"z-index":"10"},customList:this.$("#externals")};this.$("#externalForm").autocomplete(GO.contextRoot+"api/mail/address/search/name",t)},makeFormatUnit:function(t,n){function g(t){var n=null,r=null;return e.ajax({url:GO.contextRoot+"api/user/sort/list",data:{keyword:t},type:"GET",async:!1,success:function(e){hasName=e.data.length>0,hasName&&(n=e.data[0].name,r=e.data[0].email)},error:function(e){console.log(e)}}),{hasName:hasName,name:n,email:r}}var r=this;if(e.trim(n)=="")return;var i=new Array,s=n.split(">,");for(var o=0;o<s.length;o++){tempAddressArray=s[o].split(",");for(var u=0;u<tempAddressArray.length;u++)tempAddressArray[u]=e.trim(tempAddressArray[u]);i=i.concat(GO.util.makeFormatEmail(tempAddressArray))}for(var o=0;o<i.length;o++){n=i[o];var a=GO.util.checkEmailFormat(n),f=null,l=a?GO.util.get_name(n):n,c=a?l||GO.util.get_email(n):n,h=e('<span class="name" id="nameField" evt-rol="select-field" onselectstart="return false"></span>').attr("title",c).data("email",GO.util.get_email(n)).data("label",l).data("select",!1).text(c),p="",d=e('<span class="ic ic_del"></span>');d.attr("title","\uc0ad\uc81c").click(function(){var n=e(this).closest("li");n.find("input.edit").unautocomplete(),n.remove(),t.focus(),r.$("#externalArea").find("li").length||r.$("#externalArea").hide()});var v=e('<span class="btn_wrap"></span>').append(d),m=e("<li></li>");m.addClass(a?"":"invalid"),m.append(h).append(p).append(v),this.$("#externalArea").show(),this.$("#externals").append(m),t.val("")}},changeStartTime:function(){var e=this.$("#startDate").val(),t=this.$("#startTime").attr("data-prev"),n=moment(e+"T"+t+":00"),r=this.$("#endDate").val(),i=this.$("#endTime").val(),s=moment(r+"T"+i+":00"),o=Math.floor(s.diff(n,"minutes",!0)*10)/10,u=this.$("#startTime").val(),a=moment(e+"T"+u+":00"),f=a.add("minutes",o),l=f.format("YYYY-MM-DD"),c=f.format("HH:mm");this.$("#endDate").val(l),this.$("#endTime").val(c),this.$("#endDate").attr("data-prev",l),this.$("#endTime").attr("data-prev",c),this.$("#startTime").attr("data-prev",u)},_initDatepicker:function(){this.$("#startDate").datepicker({yearSuffix:"",dateFormat:"yy-mm-dd",changeMonth:!0,changeYear:!0}),this.$("#endDate").datepicker({yearSuffix:"",dateFormat:"yy-mm-dd",changeMonth:!0,changeYear:!0,minDate:this.eventDate||this.$("#startDate").val()})},_hasAsset:function(){return this.mcalendarAsset.asset.length>0},_saveReservationAssets:function(t){var n=e.Deferred(),r=this;return e("tr.assetList li").length>0&&e("tr.assetList li").each(function(){var i=[];e(this).attr("data-attributeId")&&i.push({attributeId:e(this).attr("data-attributeId"),content:e(this).attr("data-content")});var s=new c({assetId:e(this).attr("data-assetid"),itemId:e(this).attr("data-itemid"),itemName:e(this).attr("data-assetname"),type:"reserve",startTime:t.startTime,endTime:t.endTime,allday:t.allday,properties:i});n=e.ajax({url:GO.contextRoot+"api/asset/"+s.get("assetId")+"/item/"+s.get("itemId")+"/reserve",type:"POST",async:!1,data:JSON.stringify(s),dataType:"json",contentType:"application/json;",success:function(n){e("tr.assetList li").attr("data-reservationid",n.data.id),t.assetReservationIds.push(n.data.id)},error:function(e){var t=e.responseJSON.name;if(t=="DuplicateRequestException")throw alert(g["\uc608\uc57d\ud558\ub824\ub294 \uc2dc\uac04\ub300\uc5d0 \uc774\ubbf8 \uc608\uc57d\ub41c \uac74\uc774 \ud3ec\ud568\ub418\uc5b4\uc788\uc2b5\ub2c8\ub2e4."]),r.isSaving=!1,new Error}})}),n},_validateErrorCallback:function(t,n,r){this.isSaving=!1;var i=Array.prototype.slice.call(arguments,3);return alert(r,"",e.proxy(function(){switch(n){case"numeric:reminder_time":case"min:reminder_time":case"max:reminder_time":var t=this.$el.find('input[name^="reminder_value_"]')[i[0]];e(t).val(FormReminderHelper.DEFAULT_VALUE)}},this)),this},_generateUUID:function(){var e=(new Date).getTime(),t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var n=(e+Math.random()*16)%16|0;return e=Math.floor(e/16),(t=="x"?n:n&3|8).toString(16)});return t},_onChangeStartDate:function(){this.$("#endDate").datepicker("option","minDate",this.$("#startDate").val())},_onCompanyCheckboxClicked:function(e){this._isCompanyTypeChecked()?(this._setCompanyCalSelectVisible(!0),this._setInnerAttendeeVisible(!1),this._setMyCalendarsVisible(!1),this._setPrivateCheckboxVisible(!1)):(this._setCompanyCalSelectVisible(!1),this._setInnerAttendeeVisible(!0),this._setMyCalendarsVisible(!0),this._setPrivateCheckboxVisible(!0))},_onPrivateCheckboxClicked:function(t){var n=e(t.currentTarget);this._setVisible(this.$("#company_cal_list"),!n.is(":checked"))},_isCompanyTypeChecked:function(){return this.$("#companyType").is(":checked")},_setPrivateCheckboxVisible:function(e){this._setVisible(this.$("#visibility").parent(),e)},_setMyCalendarsVisible:function(e){this._setVisible(this.$("#my_cal_list"),e)},_setCompanyCalendarsVisible:function(e){this._setVisible(this.$("#company_cal_list"),e)},_setCompanyCalCheckboxVisible:function(e){this._setVisible(this.$("#checkbox-company-wrap"),e)},_setCompanyCalSelectVisible:function(e){this._setVisible(this.$("#companyCalIdWrap"),e)},_setInnerAttendeeVisible:function(e){this._setVisible(this.$("#inner_attendees"),e)},_setVisible:function(e,t){t?e.show():e.hide()},_setAllDayView:function(e){var t=e===undefined?!1:e;this.$("#allDay").prop("checked",t),this.$("#startTime").toggle(!t),this.$("#endTime").toggle(!t)},_activateDateForm:function(){this.$("#startDate").attr("disabled",!1),this.$("#endDate").attr("disabled",!1)},_onChangeAllDay:function(){var e=this.$("#allDay"),t=e.is(":checked");if(!this.mcalendarAsset&&!this._confirmDeleteAsset())return e.prop("checked",!t),!1;t?(this.$("#startTime").val("09:00"),this.$("#endTime").val("18:00")):(this.$("#startTime").val(this.getDefaultStartTime()),this.$("#endTime").val(this.getDefaultEndTime())),this.$("#startTime").toggle(!t),this.$("#endTime").toggle(!t)},_onClickDeleteAssetItem:function(e){this._confirmDeleteAsset()},_confirmDeleteAsset:function(){return this.$("tr.assetList li").length<1?!0:confirm(b.alert_cancel_asset)?(this._deleteReservation().done(e.proxy(function(){this.$("tr.assetList li").remove(),this.$("tr.assetList").find("li").length||this._activateDateForm()},this)),!0):!1},_deleteReservation:function(){var t=[],n=e.Deferred();e.each(this.$("tr.assetList li"),function(){var n=e(this).attr("data-reservationid");n&&t.push(n)});if(!t.length)n.resolve();else{var r=GO.contextRoot+"api/asset/item/reservation";e.ajax({type:"DELETE",url:r,contentType:"application/json",data:JSON.stringify({ids:t}),success:function(){n.resolve()}})}return n}});return E});