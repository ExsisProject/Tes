(function(){define(["jquery","underscore","backbone","app","calendar/collections/search_results","hgn!calendar/templates/search_result","hgn!calendar/templates/_search_results","i18n!nls/commons","i18n!calendar/nls/calendar","jquery.go-preloader"],function(e,t,n,r,i,s,o,u,a){var f={label:{keyword:u["\uac80\uc0c9\uc5b4"],summary:a["\uc77c\uc815\uba85"],category:a["\uc77c\uc815 \uad6c\ubd84"],attendee:a["\ucc38\uc11d\uc790"],description:u["\ub0b4\uc6a9"],period:a["\uae30\uac04"],date:a["\ub0a0\uc9dc"],more:u["\ub354\ubcf4\uae30"]}},l=r.BaseView.extend({className:"content_page",events:{"click a.summary_link":"_goToEvent","click #searchMoreButton":"_showMore"},initialize:function(){this.collection=new i,this.collection.parseQueryString(),this._prepareTemplate()},fetchResult:function(){var t=this,n=e.Deferred(),r=e.goPreloader();return this.collection.fetch({beforeSend:function(){r.render(),n.notify()},complete:function(){r.release()},success:function(){t.render()},fail:n.reject}),n},render:function(){return this.$el.find("table.tb_search_result > tbody").empty().append(this._makeList()),this._renderMoreButton(),e("header.content_top > h1 > span.num").html(r.i18n(u["\ucd1d\uac74\uc218"],{num:this.getResultCount()})),this._bindScrollEvent(),this},_showMore:function(){var e=this;this.collection.setPage(e.collection.getPage()+1),this.collection.fetch({success:function(){e.$el.find("table.tb_search_result > tbody").append(e._makeList()),e._renderMoreButton()}})},_makeList:function(){return o({search_results:this._parseSearchResults(),msg:{no_matched:a["\uac80\uc0c9\uc5b4\uc640 \uc77c\uce58\ud558\ub294 \uc77c\uc815\uc774 \uc5c6\uc2b5\ub2c8\ub2e4"]}})},_renderMoreButton:function(){this.collection.page.lastPage?this.$("#searchMoreButton").hide():this.$("#searchMoreButton").show()},_bindScrollEvent:function(){var t=this;e(window).unbind("scroll.board"),e(window).bind("scroll.board",function(n){d_height=e(document).height(),w_height=e(window).height(),s_height=d_height-w_height,d_top=e(document).scrollTop(),s_height-d_top<2&&t.$el.find("div.bottom_action").is(":visible")&&t._showMore()})},reload:function(){this.$el.find(".tb_search_result").empty(),this.render()},getResultCount:function(){return this.collection.length},_prepareTemplate:function(){this.$el.empty();var e=s(t.extend({"detail_search?":this.collection.isDetailSearch(),keyword:this._parseKeyword()},f));return this.$el.append(e),this},_parseKeyword:function(){var e=null;return this.collection.isDetailSearch()?(e={summary:u["\uc804\uccb4"],attendees:u["\uc804\uccb4"],period:u["\uc804\uccb4"]},this.collection.getSummary()&&(e.summary=this.collection.getSummary()),this.collection.getAttendees()&&(e.attendees=this.collection.getAttendees()),this.collection.getFromDate()&&this.collection.getToDate()&&(e.period=[r.util.shortDate(this.collection.getFromDate()),r.util.shortDate(this.collection.getToDate())].join(" ~ "))):e=this.collection.getKeyword(),e},_parseSearchResults:function(){var e=this.collection.toJSON();return t.map(e,function(e,t){e.event_date=r.util.basicDate2(e.startTime);if(e.timeType==="allday")e.event_time=a["\uc885\uc77c\uc77c\uc815"];else{var i=r.util.hourMinute(e.startTime),s=r.util.isSameDate(e.startTime,e.endTime)?r.util.hourMinute(e.endTime):a["\uacc4\uc18d"];e.event_time=[i,s].join(" ~ ")}e.calendarId=n.$.trim(e.calendarId)},this),e},_goToEvent:function(t){t.preventDefault();var n=e(t.currentTarget);return r.router.navigate(["calendar",n.attr("data-calendar-id"),"event",n.attr("data-id")].join("/"),{trigger:!0,pushState:!0}),this}});return l})}).call(this);