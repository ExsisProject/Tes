(function(){define(["underscore","app","calendar/collections/calendars","i18n!calendar/nls/calendar","calendar/libs/util"],function(e,t,n,r,i){var s=500,o=500,u=4e3,a=t.BaseModel.extend({recurChangeType:null,originCalendarId:null,url:function(){var e=this.originCalendarId||this.get("calendarId");return["/api/calendar/",e,"/event/",this.id,this.isMove?"/move":"",this.recurChangeType?"?"+$.param({recurChangeType:this.recurChangeType}):""].join("")},initialize:function(e,t){e&&e.hasOwnProperty("calendarId")&&(this.originCalendarId=e.calendarId),this.recurChangeType=null},validate:function(n){var i=!1,u="error:validate",a=e.filter(n.attendees,function(t){return!e.isUndefined(t.id)});if(!n.summary)this.trigger(u,this,"required:summary",r["\uc77c\uc815\uba85\uc744 \uc785\ub825\ud558\uc138\uc694"]);else if(!n.calendarId)this.trigger(u,this,"required:calendarId",r["\uce98\ub9b0\ub354 \ubbf8\uc120\ud0dd \uba54\uc2dc\uc9c0"]);else if(n.summary.length>s)this.trigger(u,this,"max:summary",t.i18n(r["\uc77c\uc815\uba85\uc740 {{max}}\uc790 \uc774\ud558\ub85c \uc785\ub825\ud574 \uc8fc\uc2ed\uc2dc\uc624"],"max",s));else if(!n.startTime)this.trigger(u,this,"required:startTime",r["\uc2dc\uc791\uc77c\uc790\ub97c \uc785\ub825\ud574 \uc8fc\uc2ed\uc2dc\uc624"]);else if(!n.endTime)this.trigger(u,this,"required:startTime",r["\uc885\ub8cc\uc77c\uc790\ub97c \uc785\ub825\ud574 \uc8fc\uc2ed\uc2dc\uc624"]);else if(n.location&&n.location.length>o)this.trigger(u,this,"max:location",t.i18n(r["\uc7a5\uc18c\ub294 {{max}}\uc790\uae4c\uc9c0 \uac00\ub2a5\ud569\ub2c8\ub2e4"],"max",o));else if(n.type==="normal"&&(n.attendees&&n.attendees.length<=0||e.isEmpty(a)))this.isNew()?this.trigger(u,this,"required:attendees",r["\ucc38\uc11d\uc790\ub97c \uc9c0\uc815\ud574 \uc8fc\uc2ed\uc2dc\uc624"]):i=!0;else if(n.reminders){for(var f=0,l=n.reminders.length;f<l;f++){var c=n.reminders[f],h=c.time,p=parseInt(h);if(!/^[\-\+]?[\d\,]*\.?[\d]*$/.test(h))return this.trigger(u,this,"numeric:reminder_time",r["\ubbf8\ub9ac\uc54c\ub9bc \uac12\uc740 \uc22b\uc790\ub9cc \uac00\ub2a5\ud569\ub2c8\ub2e4"],f),!0;if(p<0)return this.trigger(u,this,"min:reminder_time",r["\ubbf8\ub9ac\uc54c\ub9bc \uac12\uc740 \ucd5c\uc18c 0\uc774\uc0c1\uc774\uc5b4\uc57c \ud569\ub2c8\ub2e4"],f),!0;if(p>1e4)return this.trigger(u,this,"max:reminder_time",t.i18n(r["\ubbf8\ub9ac\uc54c\ub9bc \uac12\uc740 \ucd5c\ub300 {{max}}\uc774\ud558\uc774\uc5b4\uc57c \ud569\ub2c8\ub2e4"],"max",1e4),f),!0}i=!0}else i=!0;return!i},parse:function(e,r){var s=t.BaseModel.prototype.parse.call(this,e,r);return i.parseEventModel(s,n.isCalendarManager())},isCreator:function(e){return this.get("creator").id===e},isCompanyEvent:function(){return this.get("type")==="company"},isNormalEvent:function(){return this.get("type")==="normal"},isHolidayEvent:function(){return this.get("type")==="holiday"},isRecurrence:function(){return!!this.get("recurrence")},isEmptyAttendees:function(){return!(this.get("attendees").length>0)},isIncludedAttendee:function(t){return e.where(this.get("attendees"),{id:parseInt(t)}).length>0},setRecurChangeType:function(e){this.recurChangeType=e},isAllday:function(){return this.get("timeType")==="allday"},isPublic:function(){return this.get("visibility")==="public"},isPrivate:function(){return this.get("visibility")==="private"},isTimed:function(){return this.get("timeType")==="timed"},hasPermission:function(e){var t=!1;return this.isCompanyEvent()||this.isHolidayEvent()?t=!1:this.isCreator(e)?t=!0:this.isIncludedAttendee(e)&&(t=!0),t},getExternalAttendees:function(){return e.filter(this.get("attendees"),function(t){return e.isUndefined(t.id)})},hasExternalAttendees:function(){return this.getExternalAttendees().length>0},isAlone:function(){var e=this.get("attendees");return e&&e.length-this.getExternalAttendees().length==1&&e[0].id==t.session().id}});return a})}).call(this);