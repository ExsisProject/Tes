(function(){define(["jquery","backbone","app","i18n!nls/commons","i18n!calendar/nls/calendar","views/mobile/header_toolbar","hgn!calendar/templates/mobile/m_calendar_view","calendar/models/event","asset/collections/asset_calendar","calendar/libs/util","hgn!calendar/templates/mobile/m_event_remove_confirm_layer","GO.util","jquery.ui"],function(e,t,n,r,i,s,o,u,a,f,l){var c={externalAttendees:i["\uc678\ubd80\ucc38\uc11d\uc790"],attendees:i["\ucc38\uc11d\uc790"],location:i["\uc7a5\uc18c"],reminder:i["\uc54c\ub78c"],content:r["\ub0b4\uc6a9"],leave:i["\ucc38\uc11d\uc790\uc5d0\uc11c \ube60\uc9c0\uae30"],copy:r["\ubcf5\uc0ac"],modify:r["\uc218\uc815"],"delete":r["\uc0ad\uc81c"],comment:r["\ub313\uae00"],layerInform:i["\ud604\uc7ac '\ubc18\ubcf5\uc77c\uc815'\uc73c\ub85c \ub4f1\ub85d\ub418\uc5b4 \uc788\uc2b5\ub2c8\ub2e4."],removeInstance:i["\uc774 \uc77c\uc815\ub9cc \uc0ad\uc81c"],removeAfter:i["\uc774 \uc77c\uc815\ubd80\ud130 \uc774\ud6c4 \uc77c\uc815 \ubaa8\ub450 \uc0ad\uc81c"],removeAll:i["\uc804\uccb4 \ubc18\ubcf5 \uc77c\uc815 \uc0ad\uc81c"],confirm:r["\ud655\uc778"]},h=t.View.extend({events:{"click #copyUrl":"copyUrl"},initialize:function(e){this.eventId=e.eventId,this.calendarId=e.calendarId,this.headerToolbarView=s,this.assetList=new a({eventId:e.eventId,type:"current"}),this.headerBindEvent()},headerBindEvent:function(){GO.EventEmitter.off("trigger-action"),GO.EventEmitter.on("trigger-action","calendar-comment",this.commentList,this),GO.EventEmitter.on("trigger-action","calendar-modify",this.eventModify,this),GO.EventEmitter.on("trigger-action","calendar-delete",this.eventDelete,this),GO.EventEmitter.on("trigger-action","calendar-copy",this.eventCopy,this),GO.EventEmitter.on("trigger-action","calendar-leave",this.eventLeave,this)},render:function(){var t=this;this.eventModel=new u({id:this.eventId,calendarId:this.calendarId}),this.eventModel.fetch({async:!0,error:function(e,t){var i=JSON.parse(t.responseText);GO.util.isMobileApp()?(console.log(i.code+r[i.code+" \uc624\ub958\ud398\uc774\uc9c0 \ud0c0\uc774\ud2c0"]+"->calendar"),GO.util.isAndroidApp()?window.GOMobile.onError(i.code,r[i.code+" \uc624\ub958\ud398\uc774\uc9c0 \ud0c0\uc774\ud2c0"]):window.location="gomobile://onError?"+i.code+"&"+encodeURIComponent(r[i.code+" \uc624\ub958\ud398\uc774\uc9c0 \ud0c0\uc774\ud2c0"])):(alert(r[i.code+" \uc624\ub958\ud398\uc774\uc9c0 \ud0c0\uc774\ud2c0"]),n.router.navigate("calendar",{trigger:!0}))}}),this.calName=this.eventModel.get("calendarName")?decodeURIComponent(this.eventModel.get("calendarName")):decodeURIComponent(i["\ub0b4 \uc77c\uc815"]),this.eventModel.on("change",function(r){var s=function(){var t=[],n="";return e.each(this.attendees,function(e,r){if(!r.id)return!0;var i=r.id?r.name+(r.position?" "+r.position:""):r.email;r.id==GO.session("id")?n='<li><span class="name">'+i+"</span></li>":t.push('<li><span class="name">'+i+"</span></li>")}),n!=""&&t.push(n),t.reverse().join("")},u=function(){var t=[];return e.each(this.attendees,function(e,n){var r=n.name||n.email;if(n.id)return!0;t.push('<li><span class="name">'+r+"</span></li>")}),t.reverse().join("")},a=function(){return this.reminders.length>0?!0:!1},f=function(){return this.timeType=="allday"?GO.util.isSameDate(this.startTime,this.endTime)?GO.util.shortDate2(this.startTime)+" "+i["\uc885\uc77c"]:GO.util.shortDate2(this.startTime)+" ~ "+GO.util.shortDate2(this.endTime)+"("+i["\uc885\uc77c"]+")":GO.util.basicDate(this.startTime)+" ~ "+GO.util.basicDate(this.endTime)},l=function(){var e,t,n;return e=i["\uc54c\ub78c"],n=this.method=="email"?i["\uba54\uc77c\uc54c\ub9bc"]:i["\ud478\uc2dc\uc54c\ub9bc"],this.type=="day"?t=i["\uc77c\uc804"]:this.type=="week"?t=i["\uc8fc\uc804"]:this.type=="hour"?t=i["\uc2dc\uac04\uc804"]:t=i["\ubd84\uc804"],this.time+t+" "+e+" ["+n+"]"},h=function(){return GO.util.escapeHtml(this.description)},p=function(){return e.trim(this.location)==""?!1:!0},d=function(){return e.trim(this.description)==""?!1:!0},v=function(){return this.visibility=="private"?!0:!1},m=o({lang:c,dataset:r.toJSON(),hasExternal:r.hasExternalAttendees(),"showAttendeesParse?":r.isNormalEvent(),isAlone:r.isAlone(),isRecurrence:r.isRecurrence(),attendeesParse:s,externalAttendees:u,existReminders:a,reminderParse:l,eventDateParse:f,descriptionParse:h,locationCheck:p,descriptionCheck:d,isPrivate:v,commentLabel:r.get("commentCount")?"("+r.get("commentCount")+")":""});t.$el.html(m),GO.isAvailableApp("asset")&&t.setAssetList();var g={isPrev:!0,actionMenu:t.getUseMenus(r.get("permission"),r.get("commentCount"),r.isAlone(),r.isNormalEvent()),isWriteBtn:!0,writeBtnCallback:function(){n.router.navigate("calendar/write/"+GO.util.shortDate(new Date),{trigger:!0,pushState:!0})}};t.headerToolbarView.render(g)})},eventLeave:function(){e(".array_option").hide();if(this._isRecurrenceSchedule(this.eventModel)){e("#commonWriteButton").hide();var t={title:i["\ucc38\uc11d\uc790\uc5d0\uc11c \ube60\uc9c0\uae30"],subTitle:i["\ucc38\uc11d\uc790\uc5d0\uc11c \ube60\uc9c0\uba74 \ub0b4 \uc77c\uc815\uc5d0\uc11c \ub178\ucd9c\ub418\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4. \ud558\uc9c0\ub9cc, \ub2e4\ub978 \ucc38\uc11d\uc790\uc758 \uc77c\uc815\uc5d0\uc11c\ub294 \ud574\ub2f9 \uc77c\uc815\uc774 \uacc4\uc18d \ubcf4\uc5ec\uc9d1\ub2c8\ub2e4.\uc704 \uc77c\uc815\uc758 \ucc38\uc11d\uc790\uc5d0\uc11c \ube60\uc9c0\uc2dc\uaca0\uc2b5\ub2c8\uae4c?"].replace("<br />","\n")};this._renderConfirmLayer(t,this.saveEventModel)}else confirm(i["\ucc38\uc11d\uc790\uc5d0\uc11c \ube60\uc9c0\uae30"]+"\n"+i["\ucc38\uc11d\uc790\uc5d0\uc11c \ube60\uc9c0\uba74 \ub0b4 \uc77c\uc815\uc5d0\uc11c \ub178\ucd9c\ub418\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4. \ud558\uc9c0\ub9cc, \ub2e4\ub978 \ucc38\uc11d\uc790\uc758 \uc77c\uc815\uc5d0\uc11c\ub294 \ud574\ub2f9 \uc77c\uc815\uc774 \uacc4\uc18d \ubcf4\uc5ec\uc9d1\ub2c8\ub2e4.\uc704 \uc77c\uc815\uc758 \ucc38\uc11d\uc790\uc5d0\uc11c \ube60\uc9c0\uc2dc\uaca0\uc2b5\ub2c8\uae4c?"].replace("<br />","\n"))&&(this.eventModel.setRecurChangeType("instance"),this.saveEventModel(this.eventModel))},saveEventModel:function(e){e.set("attendees",e.get("attendees").filter(function(e){return e.id!==GO.session("id")}),{silent:!0}),e.save({},{success:function(){var e=GO.util.getLocalStorage("calLocalStorage");n.router.navigate("calendar/"+e.type+"/"+e.date,{trigger:!0,pushState:!0})},error:function(e){alert(e.responseJSON.message)}})},eventDelete:function(){e(".array_option").hide();if(this._isRecurrenceSchedule(this.eventModel)){e("#commonWriteButton").hide();var t={title:i["\uc77c\uc815 \uc0ad\uc81c"],subTitle:i["\uc77c\uc815\uc744 \uc0ad\uc81c\ud558\uc2dc\uba74 \ubaa8\ub4e0 \ucc38\uc11d\uc790\uc758 \uc77c\uc815\uc5d0\uc11c \uc0ac\ub77c\uc9d1\ub2c8\ub2e4. \ucc38\uc11d\uc790\uc5d0\uc11c \ube60\uc9c0\uace0 \uc2f6\ub2e4\uba74, \ucc38\uc11d\uc790 \uc815\ubcf4\ub97c \uc218\uc815\ud558\uc138\uc694"].replace("<br />","\n")};this._renderConfirmLayer(t,this.destroyEventModel)}else confirm(r["\uc0ad\uc81c\ud558\uc2dc\uaca0\uc2b5\ub2c8\uae4c?"])&&(this.eventModel.setRecurChangeType("instance"),this.destroyEventModel(this.eventModel))},destroyEventModel:function(e){e.destroy({success:function(){var e=GO.util.getLocalStorage("calLocalStorage");n.router.navigate("calendar/"+e.type+"/"+e.date,{trigger:!0,pushState:!0})}})},eventCopy:function(){confirm(i["\uc77c\uc815\uc744 \ubcf5\uc0ac\ud558\uc2dc\uaca0\uc2b5\ub2c8\uae4c?"]+"\n"+i["\uc885\uc77c, \ubc18\ubcf5 \uc124\uc815\uacfc \uc608\uc57d\ud558\uae30\ub294 \ubcf5\uc0ac \ub300\uc0c1\uc5d0\uc11c \uc81c\uc678\ub429\ub2c8\ub2e4."])&&n.router.navigate("calendar/write/copied/"+this.calendarId+"/"+this.eventId,{trigger:!0,pushState:!0})},eventModify:function(){return n.router.navigate("calendar/modify/"+this.calendarId+"/"+this.eventId,{trigger:!0,pushState:!0}),!1},_isRecurrenceSchedule:function(e){return e.attributes.recurrence},_renderConfirmLayer:function(t,n){var r=this;e(".go_wrap").append(l({lang:c,layerLabel:t})),e("#confirmDeleteOption").on("click",function(t){var i=e('input[name="deleteOption"]:checked').val();return e(".overlay_scroll").remove(),e("#commonWriteButton").show(),r.eventModel.setRecurChangeType(i),n(r.eventModel),!1}),e("#closeOptionLayer").on("click",function(t){return e(".overlay_scroll").remove(),e("#commonWriteButton").show(),!1})},getUseMenus:function(e,t,n,r){var i={"\ub313\uae00":{id:"calendar-comment",text:c.comment,triggerFunc:"calendar-comment",cls:"btn_comments",commentsCount:t?t:"0"},"\uc218\uc815":{id:"calendar-modify",text:c.modify,triggerFunc:"calendar-modify",inMoreBtn:!0},"\uc0ad\uc81c":{id:"calendar-delete",text:c.delete,triggerFunc:"calendar-delete",inMoreBtn:!0},"\ubcf5\uc0ac":{id:"calendar-copy",text:c.copy,triggerFunc:"calendar-copy"},"\ucc38\uc11d\uc790\ube60\uc9c0\uae30":{id:"calendar-leave",text:c.leave,triggerFunc:"calendar-leave",inMoreBtn:!0}},s=[];return s.push(i.\ub313\uae00),e.update&&(s.push(i.\ubcf5\uc0ac),s.push(i.\uc218\uc815)),e.delete&&s.push(i.\uc0ad\uc81c),e.update&&!n&&r&&s.push(i.\ucc38\uc11d\uc790\ube60\uc9c0\uae30),s},setAssetList:function(){var t="";this.assetList.on("sync",function(n,r){if(n.toJSON().length>0){var s=[];e.each(n.toJSON(),function(e,t){s.push('<li><span class="txt">'+t.itemName+"</span></li>")}),t='<dl class="list_type4"><dt><span class="txt">'+i["\uc608\uc57d"]+"</span></dt>"+"<dd>"+"<ul>"+s.join("")+"</ul>"+"</dd>"+"</dl>"}e("section").append(t)}),this.assetList.fetch()},commentList:function(){n.router.navigate("calendar/"+this.calendarId+"/event/"+this.eventId+"/comment",!0)},copyUrl:function(e){GO.util.copyUrl(e)}});return h})}).call(this);