define(["underscore","backbone","app","hgn!calendar/templates/color_picker","i18n!calendar/nls/calendar"],function(e,t,n,r,i){function p(){this.__instance__&&this.__instance__.$el.parents("#main").length<1&&(this.__instance__.remove(),this.__instance__=null)}var s,o={calendar:"calendar",feed:"feed",works:"works"},u={left:"left",right:"right"},a="color-picker",f=18,l=6,c=i["2\uc778 \uc774\uc0c1 \uc77c\uc815"],h=i["\uc0c9\uc0c1"];return s=t.View.extend({id:a,className:"layer_normal layer_pallete",target:null,oldTarget:null,type:o.feed,events:{"click .pallete_color":"selectedColor","change input":"onChangeInput"},initialize:function(e){console.log("[ColorPicker#initialize] ColorPicker initializing..."),this.target=null,this.oldTarget=null,this.useAddition=e.useAddition,this.useAdditionInput=e.useAdditionInput,this.additionText=e.additionText||c,this.$el.hide(),this.render()},delegateEvents:function(e){var n=this;this.undelegateEvents(),t.View.prototype.delegateEvents.call(this,e),t.$("body").on("click.colorpicker",function(e){var t=$(e.target);if(t.is("span.chip"))return;if(!n.isShow())return;if(t.parents("#color-picker").length>0)return;n.hide()})},undelegateEvents:function(e){t.View.prototype.undelegateEvents.call(this,e),t.$("body").off(".colorpicker")},render:function(){var t=r(e.extend({color_set:this.buildColorSetVars(),useAddition:this.useAddition,useAdditionInput:this.useAdditionInput},{additionText:this.additionText,label_color:h}));this.$el.html(t),this.$el.appendTo("#main")},setTargetElement:function(e){return this.target=e,this},setType:function(t){if(e.indexOf(e.values(o),t)===-1)throw new Error("Invalid Caller Type");return this.type=t,this},setPosition:function(e){return this.position=e,this},show:function(e){var t=typeof e=="undefined"?$(this.target):$(e.target),n=t.offset();this.target||(this.target=t),this.$el.show(),this.position==u.left?(this.$el.css("left",n.left-this.$el.outerWidth()-4),this.$el.css("top",n.top+t.height()+7)):(this.$el.css("left",n.left+t.width()+4),this.$el.css("top",n.top-7))},isShow:function(){return $(this.el).is(":visible")},selectedColor:function(e){console.log("[ColorPicker#selectedColor] selected calendar color..."),e.preventDefault();var t=$(e.target);if(!t.attr("data-code"))throw new Error("[ColorPicker#selectedColor] Invalid Color Code");$(this.target).trigger("changed:chip-color",[t.attr("data-code"),this.type]),this.trigger("changed:chip-color",t.attr("data-code")),this.hide()},hide:function(){this.$el.hide()},toggle:function(e){return this.isShow()?this.hide(e):this.show(e)},buildColorSetVars:function(){var e=[];for(var t=1;t<=f;t++)e.push({color_code:t,"last_cols?":t%l===0});return e},onChangeInput:function(e){var t=$(e.currentTarget);this.trigger("changed:addition-checkbox",t.is(":checked")),this.hide()}},{__instance__:null,create:function(e,t,n){return p.call(this),this.type=t,this.__instance__===null&&(this.__instance__=new this.prototype.constructor({type:t})),this.__instance__.setTargetElement(e),this.__instance__.setType(t),this.__instance__.setPosition(n),this.__instance__},show:function(e,t,n){console.log("[ColorPicker.show] show ColorPicker");var r=this.create(e,t,n);r.show()},hide:function(e,t){var n=this.create(e,t);n.hide()},toggle:function(e,t){var n=this.create(e,t);n.toggle()}}),s});