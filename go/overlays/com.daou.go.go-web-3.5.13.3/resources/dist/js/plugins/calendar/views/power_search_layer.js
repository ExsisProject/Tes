(function(){define(["jquery","underscore","app","calendar/libs/util","hgn!calendar/templates/power_search","i18n!nls/commons","i18n!calendar/nls/calendar","jquery.ui","jquery.go-popup","jquery.go-validation"],function(e,t,n,r,i,s,o){var u=n.util.toMoment(new Date),a={maxlength:200,label:{summary:o["\uc77c\uc815\uba85"],category:o["\uc77c\uc815 \uad6c\ubd84"],all:o["\uc804\uccb4"],my_calendar:o["\ub0b4 \uc77c\uc815"],follower:o["\uad00\uc2ec \uce98\ub9b0\ub354"],company_calendar:o["\uc804\uc0ac\uc77c\uc815"],attendee:o["\ucc38\uc11d\uc790"],period:o["\uae30\uac04"],week:o["\uc8fc\uc77c"],month:o["\uac1c\uc6d4"],custom:o["\uc9c1\uc811\uc120\ud0dd"],show_datepicker:o["\ub2ec\ub825\ubcf4\uae30"]},msg:{attendee_input_rule:o["\ubcf5\uc218\uc77c \uacbd\uc6b0 \ucf64\ub9c8(,)\ub85c \uad6c\ubd84"]}},f=function(){var f=function(e){this.template=i(t.extend({start_date:n.util.shortDate(u),end_date:n.util.shortDate(u)},a)),this.render(e),this.delegateEvents()};return f.prototype={render:function(t){var n={width:-1,modal:!0,header:s["\uc0c1\uc138\uac80\uc0c9"],pclass:"address_search_wrap",contents:this.template,closeCallback:e.proxy(this._release,this),callback:e.proxy(this._requestSearch,this)};return"offset"in t&&(n.offset=t.offset),this.el=e.goSearch(n),this.$el=e(this.el),this._prepareDatepicker(),this},delegateEvents:function(){this.undelegateEvents(),this.$el.on("keydown.calendar-power-search","input.enable_enter",e.proxy(this._bindKeyboardEvent,this)),r.bindDatepickerIcon(this.$el,"calendar-power-search")},undelegateEvents:function(){this.$el.off(".calendar-power-search")},close:function(){this.el.close(e.proxy(this._release,this))},_bindKeyboardEvent:function(e){return e.which===13&&this._requestSearch(),this},_prepareDatepicker:function(){var e=this.$el.find("#custom-start-date"),t=this.$el.find("#custom-end-date");return e.datepicker({dateFormat:"yy-mm-dd",changeMonth:!0,changeYear:!0,yearSuffix:"",onClose:function(e){t.datepicker("option","minDate",e)}}),t.datepicker({dateFormat:"yy-mm-dd",changeMonth:!0,changeYear:!0,yearSuffix:"",minDate:e.val()}),this},_requestSearch:function(){var e=n.util.serializeForm(this.$el.find("#power-search"),!1);return t.map(e,function(t,n){n==="attendees"&&(t=t.replace(/(,\s*)/g,","),t=t.replace(/(\s*,)/g,","),e[n]=t)}),this.validate(e)&&(n.router.navigate("calendar/search?"+n.util.jsonToQueryString(e),{trigger:!0,pushState:!0}),this.close()),this},validate:function(r){var i=this,u=!0,a=!1;return t.map(r,function(t,i){i!=="stype"&&!!t&&(u&=!1),i==="fromDate"&&t&&(r[i]=n.util.toISO8601(n.util.toMoment(t).startOf("day"))),i==="toDate"&&t&&(r[i]=n.util.toISO8601(n.util.toMoment(t).endOf("day"))),e.goValidation.isInValidEmailChar(decodeURIComponent(t||""))&&(a=!0)}),u?(e.goSlideMessage(s["\uac80\uc0c9\uc5b4\ub97c \uc785\ub825\ud558\uc138\uc694."],"caution"),!1):r.summary>200?(e.goMessage(n.i18n(o["{{max}}\uc790 \uc774\ud558\ub85c \uc785\ub825\ud574 \uc8fc\uc2ed\uc2dc\uc624"],{max:200})),this.$el.find("#keyword-summary").focus(),!1):a?(e.goMessage(s["\uba54\uc77c \uc0ac\uc6a9 \ubd88\uac00 \ubb38\uc790"]),!1):!0},_release:function(){this.undelegateEvents()},_showDatepicker:function(t){var n=e(t.currentTarget);return n.val()==="custom"?this.$el.find("#datepicker").show():this.$el.find("#datepicker").hide(),this}},f}();return f})}).call(this);