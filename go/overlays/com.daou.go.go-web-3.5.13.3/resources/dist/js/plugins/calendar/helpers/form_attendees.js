(function(){define(["jquery","hogan","app","hgn!calendar/templates/_regist_attendees","i18n!nls/commons","i18n!calendar/nls/calendar"],function(e,t,n,r,i,s){var o={remove:i["\uc0ad\uc81c"]},u=function(){var t=function(t,n,r){n=n||[],this.rootElement=t,this.editable=typeof r=="undefined"?!0:r,this.delegateEvents(),this.addAttendeeCallbacks=e.Callbacks(),this.removeCallbacks=e.Callbacks(),this.addAttendee(n)};return t.prototype={delegateEvents:function(){this.undelegateEvents(),e(this.rootElement).on("click.attendee","li:not([data-button]) > span.btn_wrap",e.proxy(this.removeAttendee,this))},undelegateEvents:function(){e(this.rootElement).off(".attendee")},addAttendee:function(t){function u(r,i,s){s=s||!1;var o=n.config("contextRoot")+"api/organization/user?deptid="+t.id+(s?"&scope=subdept":"");return e.ajax(o).done(_.bind(function(e){var t=[];_.each(e,function(e){t.push(e.metadata)},this),r.resolve(this._addAttendee(t))},this)).fail(function(){console.log("error"),r.reject()})}var r=this,o=e.Deferred();return t.type==="org"?e.goPopup({pclass:"layer_confim",title:s["\ucc38\uc11d\uc790 \ucd94\uac00"],message:n.i18n(s["\ucc38\uc11d\uc790 \ucd94\uac00 \ud655\uc778 \uba54\uc2dc\uc9c0"],{dept:t.name}),modal:!0,buttons:[{btype:"confirm",btext:s["\ud604\uc7ac \ubd80\uc11c\uc6d0\ub9cc \ucd94\uac00"],callback:function(){u.call(r,o,t.id)}},{btype:"confirm",btext:s["\ud558\uc704 \ubd80\uc11c\uc6d0 \ubaa8\ub450 \ucd94\uac00"],callback:function(){u.call(r,o,t.id,!0)}},{btype:"close",btext:i["\ucde8\uc18c"]}]}):(this._addAttendee(t),t.length>20&&this.rootElement.find("#moreAttendee").show(),o.resolve([t])),o},removeAttendee:function(t){var n=this._getAttendeeLIElement(t.currentTarget),r=e(n),i=parseInt(r.attr("data-id"));return this.removeCallbacks.fire(i,n),this},getAttendees:function(t){t=t||null;var n=e(this.rootElement).find("li:not([data-button])"),r=new Array;return n.each(function(n,i){var s=e(i),o=s.attr("data-id"),u=s.attr("data-name");(!t||t!==parseInt(o))&&r.push({id:o,name:u,email:s.attr("data-email"),position:s.attr("data-position")})}),r},isMe:function(e){return n.session("id")===e},includeMe:function(e){var t=_.where(this.getAttendees(),{id:""+e});return t.length>0},isExistedAttendee:function(e){return this.includeMe(e)},addRemoveCallback:function(e){return this.removeCallbacks.add(e),this},addAttendeeCallback:function(e){return this.addAttendeeCallbacks.add(e),this},_addAttendee:function(t){var n=e(this.rootElement),i=n.find("li.creat"),s=[],u=n.find("#moreAttendee");e.isArray(t)||(t=[t]);var a=!0;for(var f=0,l=t.length;f<l;f++){var c=t[f],h=this.isMe(c.id),p="";if(!c.id)continue;if(this.isExistedAttendee(c.id))continue;c.title=[c.name,c.position].join(" "),f>19&&(a=!1),p=r(_.extend({username:c.name,"me?":h,"editable?":this.editable,isVisible:a},c,o)),n.append(p,[u,i]),s.push(c)}return this.addAttendeeCallbacks.fire(s),s},_getAttendeeLIElement:function(t){return e(t).parent()}},t}();return u})}).call(this);