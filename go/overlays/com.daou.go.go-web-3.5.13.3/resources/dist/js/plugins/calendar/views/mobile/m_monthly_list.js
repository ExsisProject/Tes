define("calendar/views/mobile/m_monthly_list",function(require){var e=require("underscore"),t=require("jquery"),n=require("backbone"),r=require("app"),i=require("i18n!calendar/nls/calendar"),s=require("views/mobile/header_toolbar"),o=require("components/minical/views/minical_app"),u=require("calendar/collections/events_pool"),a=require("calendar/libs/util"),f=require("models/user_profile");require("jquery.go-popup"),require("GO.util"),require("jquery.go-validation"),require("jquery.placeholder");var l=n.View.extend({el:"#content",initialize:function(n){var r=this;GO.util.appLoading(!0),this.checkedCalIds=e.isUndefined(a.getSavedSelectedCalendar())||a.getSavedSelectedCalendar()===""?[]:a.getSavedSelectedCalendar().split(","),this.calLocalStorage={type:"monthly"},t.bind(this.setSelectedCalendarOwnerIdList(),this),this.eventPools=new u,e.each(this.checkedCalIds,function(e){r.eventPools.add(e)}),this.miniCalendar=new o(this._makeMiniCalendarOption(this.eventPools)),this.toolbarOption=this._makeToolbarOption(this.miniCalendar),GO.EventEmitter.off("calendar","calendar-day-click"),GO.EventEmitter.on("calendar","calendar-day-click",this.saveDateInLocalStorage,this),GO.EventEmitter.on("calendar","checkFeedBox",this.changeCheckbox,this)},changeCheckbox:function(){GO.util.appLoading(!1);var n=this;this.eventPools=new u,this.checkedCalIds=e.isUndefined(a.getSavedSelectedCalendar())||a.getSavedSelectedCalendar()===""?[]:a.getSavedSelectedCalendar().split(","),this.calLocalStorage={type:"monthly"},t.bind(this.setSelectedCalendarOwnerIdList(),this),e.each(this.checkedCalIds,function(e){n.eventPools.add(e)}),this.miniCalendar=new o(this._makeMiniCalendarOption(this.eventPools)),this.miniCalendar.render()},setSelectedCalendarOwnerIdList:function(){var n=this;this.selectedCalendarOwnerIds=a.getSavedSelectedCalendarOwnerId();if(e.isUndefined(this.selectedCalendarOwnerIds)||this.selectedCalendarOwnerIds==="")this.selectedCalendarOwnerIds=[],t("input:checkbox:checked[data-type!=all]").each(function(r,i){e.isUndefined(t(i).data("calendar-owner-id"))||n.selectedCalendarOwnerIds.push(t(i).data("calendar-owner-id").toString())}),a.saveCheckedCalendarOwnerId(this.selectedCalendarOwnerIds)},saveDateInLocalStorage:function(e){this.calLocalStorage.date=e,GO.util.setLocalStorage("calLocalStorage",this.calLocalStorage)},_makeToolbarOption:function(e){var t=this;return{title:i["\uc77c\uc815\ubaa9\ub85d"],isList:!0,isSideMenu:!0,isHome:!0,isSearch:!0,isWriteBtn:!0,writeBtnCallback:function(){t.saveDateInLocalStorage(e.getSelectedDate()),r.router.navigate("calendar/write/"+e.getSelectedDate(),{trigger:!0,pushState:!0})}}},_makeMiniCalendarOption:function(n){var r=this;return{renderTarget:r.$el,renderDate:r.$el.find("#curMonthPart").text(),dateDataEmptyMessage:i["\ub4f1\ub85d\ub41c \uc77c\uc815\uc774 \uc5c6\uc2b5\ub2c8\ub2e4"],buttonLeft:{label:i["\uc8fc\uac04"],url:function(e){return"calendar/daily/"+e.selectedDate}},loadDataOnDateSet:function(i,s){var o=function(t){var n=[],i=function(t){if(t.get("attendees").length>1){var n=!1,i=0;e.any(t.get("attendees"),function(e){r.selectedCalendarOwnerIds.indexOf(e.id)>-1&&i++;if(i===2)return n=!0,!0});if(n)return t.set("color","_group"),!0}return!1};return e.each(t.getCollections(),function(t){return t.map(function(t){n.push({id:t.get("id"),calendarId:t.get("calendarId"),calendarOwnerId:t.get("calendarOwnerId"),creatorId:e.isUndefined(t.get("creator"))?!1:t.get("creator").id,name:t.get("summary").replace(/&lt;/g,"<").replace(/&gt;/g,">"),startTime:t.get("startTime"),endTime:t.get("endTime"),alldayType:t.get("timeType")=="allday",moveURL:"calendar/"+t.get("calendarId")+"/event/"+t.get("id"),isRedColor:t.get("type")=="holiday"?!0:!1,isAllDay:t.get("type")=="anniversary"||t.get("type")=="holiday"?!0:!1,isMarking:t.get("type")!="holiday"?!0:!1,visibility:t.get("visibility"),hasMultipleAttendees:i(t),calendarColor:t.get("color"),timeType:t.get("timeType"),createdAt:t.get("createdAt")})})}),n},u=t.Deferred();return n.setBoundaryTime(i,s),n.fetch().done(function(e){u.resolve(o(e)),GO.util.appLoading(!1)}).fail(function(){u.reject(),GO.util.appLoading(!1)}),u.promise()}}},render:function(){s.render(this.toolbarOption),this.miniCalendar.render()}});return{render:function(e){var t=new l(e);t.render()}}});