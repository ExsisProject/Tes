(function(){define(["underscore","jquery","amplify","app"],function(e,t,n,r){function o(e,t){return t=t||!1,e.type==="company"&&t?!0:!1}function u(e){return e.type==="holiday"}var i=r.session("id"),s={getSavedCalendarType:function(){return r.util.store.get(i+"-calendar-viewtype")},getSavedBasedate:function(){return r.util.store.get(i+"-calendar-basedate")||r.util.now().format("YYYY-MM-DD")},getSavedSelectedCalendar:function(){return r.util.store.get(i+"-calendar-selected")},getSavedSelectedCalendarOwnerId:function(){return r.util.store.get(i+"-calendar-selected-ownerid")},getSavedFeedFoldState:function(){return r.util.store.get(i+"-calendar-feed-folded")},getSavedCalendarFoldState:function(){return r.util.store.get(i+"-calendar-calendar-folded")},getSavedCalendarId:function(){return r.util.store.get(i+"-calendar-saved-calendarid")},saveCalendarType:function(e){return r.util.store.set(i+"-calendar-viewtype",e)},saveCalendarId:function(e){var t=r.util.store;return t.set(i+"-calendar-saved-calendarid",e,{type:"session"})},saveBasedate:function(e){var t=r.util.store;return t.set(i+"-calendar-basedate",r.util.toMoment(e).format("YYYY-MM-DD"),{type:"session"})},saveSideFoldState:function(e,t){r.util.store.set(i+"-calendar-"+e+"-folded",t?"Y":"N")},saveCheckedCalendar:function(e){var n=t.isArray(e)?e:[e],s=r.util.store;return s.set(i+"-calendar-selected",n.join(","))},saveCheckedCalendarOwnerId:function(e){var n=t.isArray(e)?e:[e],s=r.util.store;return s.set(i+"-calendar-selected-ownerid",n.join(","))},getDateForUrl:function(e,t){var n=r.util.toMoment(t||new Date).clone(),i=n.format("YYYY-MM-DD");return e==="monthly"?i=n.format("YYYY-MM"):e==="agenda"&&!r.util.isThisMonth(t)&&(i=n.format("YYYY-MM-01")),i},getCalendarUrl:function(e){var t=this.getSavedCalendarType();return t?["calendar",t,this.getDateForUrl(t,e)].join("/"):"calendar"},goToCalendar:function(){var e=this.getSavedBasedate();return r.router.navigate(this.getCalendarUrl(e),{trigger:!0,pushState:!0}),this},parseEventModel:function(e,t){return e.summary=r.util.XSSFilter(e.summary),e.location=r.util.XSSFilter(e.location),e.description=r.util.XSSFilter(e.description),e.htmlLink=r.util.XSSFilter(e.htmlLink),u(e)&&/^\-(.*)/i.test(e.summary)&&(e.summary=""),e.auth=o(e,typeof t=="undefined"?!0:t),e},triggerReloadFeeds:function(){t(document).trigger("reload:calendar-feeds")},triggerRemoveFeed:function(){t(document).trigger("removed:calendar-feeds")},bindDatepickerIcon:function(e,n){e.on("click."+n,".ic_calendar",function(e){t(e.currentTarget).parent().find(".hasDatepicker").focus()})}};return s})}).call(this);