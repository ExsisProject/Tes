(function(){define(["jquery","backbone","app","i18n!board/nls/board","views/profile_card","board/views/board_title","board/collections/post_search","hgn!board/templates/post_result","hgn!board/templates/post_result_more","i18n!nls/commons","jquery.go-sdk"],function(e,t,n,r,i,s,o,u,a,f){var l={search_result:f["\uac80\uc0c9\uacb0\uacfc"],all:f["\uc804\uccb4"],board:r["\uc704\uce58"],content:r["\ubcf8\ubb38 \ub0b4\uc6a9"],comment:r["\ub313\uae00 \ub0b4\uc6a9"],attachName:r["\ucca8\ubd80\ud30c\uc77c \uba85"],attachContent:f["\ucca8\ubd80\ud30c\uc77c \ub0b4\uc6a9"],writer:r["\uc791\uc131\uc790"],term:r["\uae30\uac04"],search:f["\uac80\uc0c9\uc5b4"],no_search_result:f["\ud574\ub2f9 \uac80\uc0c9 \uacb0\uacfc\uac00 \uc874\uc7ac\ud558\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4."],detail:f["\uc790\uc138\ud788 \ubcf4\uae30"],more:r["\ub354 \ubcf4\uae30"]},c=t.View.extend({initialize:function(e){this.isCommunity=e.isCommunity},unbindEvent:function(){this.$el.off("click",".post_result [evt-profile]"),this.$el.off("click","ul.article_list li"),this.$el.off("click","#searchMoreButton")},bindEvent:function(){this.$el.on("click",".post_result [evt-profile]",e.proxy(this.showProfileCard,this)),this.$el.on("click","ul.article_list li",e.proxy(this.viewDetailLi,this)),this.$el.on("click","#searchMoreButton",e.proxy(this.listMore,this))},viewDetailLi:function(t){var n=e(t.currentTarget);this.moveBoardAction(n)},moveBoardAction:function(t){if(t.attr("data-hidden")=="true"){e.goSlideMessage(r["\uc5f4\ub78c\uad8c\ud55c\uc774 \uc5c6\ub294 \uac8c\uc2dc\ubb3c\uc785\ub2c8\ub2e4."]);return}var i=t.attr("data-boardType"),s=t.attr("data-boardId"),o=t.attr("data-postId");e.go(GO.contextRoot+"api/board/"+s+"/master","",{qryType:"GET",contentType:"application/json",responseFn:function(e){var t=0;e.data.ownerType=="Community"&&(t=e.data.ownerId);var r="board/"+s+"/post/"+o;t&&(r="community/"+t+"/"+r),i=="STREAM"&&(r+="/stream"),n.router.navigate(r,!0)}})},showProfileCard:function(t){var n=e(t.currentTarget).attr("data-userid");n!=""&&i.render(n,t.currentTarget),t.stopPropagation()},moreBtnHide:function(t){if(t.length==0){e("#searchMoreButton").hide();return}var n=t.page.lastPage;n?e("#searchMoreButton").hide():e("#searchMoreButton").show()},listMore:function(){var e=parseInt(this.collection.page.page)+1,t={page:e,offset:"15"};this.stype=="simple"?(t.stype=this.stype,t.keyword=this.keyword,t.fromDate=this.fromDate,t.toDate=this.toDate):(t.stype=this.stype,t.title=this.title,t.content=this.content,t.comments=this.comments,t.attachFileNames=this.attachFileNames,t.attachFileContents=this.attachFileContents,t.userName=this.userName,t.boardIds=this.boardIds,t.fromDate=this.fromDate,t.toDate=this.toDate),this.collection=o.searchCollection(t,this.isCommunity);var n=this.makeTemplete({data:this.collection,type:"more"});this.$el.find("ul.article_list").append(n),this.moreBtnHide(this.collection)},makeTemplete:function(e){var t=e.data,n=e.searchData,i=e.boardName,s=e.searchType,o=e.type,f=function(e){return GO.util.snsDate(this.createdAt)},c=function(){var e="def";return GO.util.fileExtentionCheck(this.fileExt)&&(e=this.fileExt),e},h=function(){return s=="detail"?!0:!1},p=function(){if(this.hiddenPost)return r["\uc5f4\ub78c\uad8c\ud55c\uc774 \uc5c6\ub294 \uac8c\uc2dc\ubb3c\uc785\ub2c8\ub2e4."];var e=this.content;return e=e.replace(/<br \/>/gi,""),e},d=function(){var e=this.boardType;return e=="STREAM"?!1:!0},v=function(){return n.allSearch=="true"?l.all+l.term:GO.util.shortDate(n.fromDate)+" ~ "+GO.util.shortDate(n.toDate)},m;return o?m=a({dataset:t.toJSON(),dateParse:f,checkFileType:c,boardName:i,resultContentParse:p,isStream:d,lang:l}):m=u({dataset:t.toJSON(),dateParse:f,checkFileType:c,searchData:n,boardName:i,parseFromDate:GO.util.shortDate(n.fromDate),parseToDate:GO.util.shortDate(n.toDate),isDetaiSearch:h,resultContentParse:p,isStream:d,lang:l,parseDate:v}),m},render:function(){GO.EventEmitter.trigger("common","layout:setOverlay",!0),this.unbindEvent(),this.bindEvent();var t=this,r=n.router.getSearch();e(window).unbind("scroll.board"),e(window).bind("scroll.board",function(n){d_height=e(document).height(),w_height=e(window).height(),s_height=d_height-w_height,d_top=e(document).scrollTop(),s_height-d_top<2&&t.$el.find("div.bottom_action").is(":visible")&&t.listMore()});var i=null;r.stype=="simple"?i={stype:r.stype,keyword:r.keyword,fromDate:r.fromDate,toDate:r.toDate,page:"0",offset:"15"}:r.stype=="detail"&&(i={stype:r.stype,title:r.title,content:r.content,comments:r.comments,attachFileNames:r.attachFileNames,attachFileContents:r.attachFileContents,userName:r.userName,boardIds:r.boardIds,fromDate:r.fromDate,toDate:r.toDate,page:"0",offset:"15",allSearch:r.allSearch}),this.collection=o.searchCollection(i,r.isCommunity);var u=this.collection,a=u.page||{},f=i,c=r.boardName,h=r.searchType,p=r.isCommunity=="true"?!0:!1;this.stype=r.stype,this.title=r.title||"",this.content=r.content||"",this.comments=r.comments||"",this.attachFileNames=r.attachFileNames||"",this.attachFileContents=r.attachFileContents||"",this.userName=r.userName||"",this.boardIds=r.boardIds||"",this.keyword=r.keyword||"",this.fromDate=r.fromDate,this.toDate=r.toDate,f.content=this.content||l.all,f.comments=this.comments||l.all,f.attachFileNames=this.attachFileNames||l.all,f.attachFileContents=this.attachFileContents||l.all,f.userName=this.userName||l.all;var d=this.makeTemplete({data:u,searchData:f,boardName:c||l.all,searchType:h});this.$el.html(d),s.render({el:".content_top",dataset:{name:l.search_result,postCount:a.total||""},isCommunity:p}),e.goPopup.close(),this.moreBtnHide(u)}});return{render:function(e){var t=new c({el:"#content",isCommunity:e&&e.isCommunity?e.isCommunity:!1});return t.render()}}})}).call(this);