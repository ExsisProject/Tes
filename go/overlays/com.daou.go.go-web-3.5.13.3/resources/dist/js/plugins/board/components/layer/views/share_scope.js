define(["jquery","underscore","backbone","when","app","system/collections/companies","hgn!board/components/layer/templates/share_scope","i18n!survey/nls/survey","i18n!nls/commons","i18n!approval/nls/approval","i18n!admin/nls/admin","i18n!board/nls/board"],function(e,t,n,r,i,s,o,u,a,f,l,c){var h={user:a["\uc0ac\uc6a9\uc790"],subdepartment:f["\ubd80\uc11c"],department:f["\ubd80\uc11c"],position:f["\uc9c1\uc704"],duty:l["\uc9c1\ucc45"],grade:l["\uc9c1\uae09"],company:l["\uc0ac\uc774\ud2b8\uba85"],usergroup:l["\uc0ac\uc6a9\uc790\uadf8\ub8f9"],position_select:l["\uc9c1\uc704 \uc120\ud0dd"],duty_select:l["\uc9c1\ucc45 \uc120\ud0dd"],grade_select:l["\uc9c1\uae09 \uc120\ud0dd"],usergroup_select:l["\uc0ac\uc6a9\uc790\uadf8\ub8f9 \uc120\ud0dd"],including_sub_dept:c["\ud558\uc704 \ubd80\uc11c \ud3ec\ud568"],include_child_dept:u["\ud558\uc704 \ubd80\uc11c \ud3ec\ud568\ud558\uae30"],select_department:u["\ubd80\uc11c \uc120\ud0dd"],select_user:u["\uc0ac\uc6a9\uc790 \uc120\ud0dd"],add:a["\ucd94\uac00"],remove:a["\uc0ad\uc81c"],add_dept:u["\ubd80\uc11c\ucd94\uac00"],dept_name:u["\ubd80\uc11c\uba85"],target_whole:u["\uc804\uc0ac"],target_part:u["\uc77c\ubd80"],select_dept:u["\ubd80\uc11c \uc120\ud0dd"],select_class:u["\ud074\ub798\uc2a4 \uc120\ud0dd"],child_dept:u["\ud558\uc704 \ubd80\uc11c"],site_select:l["\uc0ac\uc774\ud2b8 \uc120\ud0dd"],writable:l["\uc4f0\uae30\uac00\ub2a5"],notUseApprReception:"\ubb38\uc11c \uc218\uc2e0 \uae30\ub2a5\uc744 \uc0ac\uc6a9\ud558\uc9c0 \uc54a\ub294 \ubd80\uc11c\uc785\ub2c8\ub2e4. \ud574\ub2f9 \ubd80\uc11c\ub97c \ucd94\uac00\ud558\ub824\uba74 [\uc804\uc790\uacb0\uc7ac > \ubd80\uc11c \ubb38\uc11c\ud568 \uad00\ub9ac > \ubd80\uc11c \ubb38\uc11c\ud568 \uc0ac\uc6a9 \uc124\uc815]\uc5d0\uc11c \uc218\uc2e0\ud568\uc744 \uccb4\ud06c\ud574\uc8fc\uc138\uc694.",notUseApprReference:"\ubd80\uc11c\ubb38\uc11c\ud568 \uae30\ub2a5\uc744 \uc0ac\uc6a9\ud558\uc9c0 \uc54a\ub294 \ubd80\uc11c\uc785\ub2c8\ub2e4. \ud574\ub2f9 \ubd80\uc11c\ub97c \ucd94\uac00\ud558\ub824\uba74 [\uc804\uc790\uacb0\uc7ac > \ubd80\uc11c \ubb38\uc11c\ud568 \uad00\ub9ac > \ubd80\uc11c \ubb38\uc11c\ud568 \uc0ac\uc6a9 \uc124\uc815]\uc5d0\uc11c \ubd80\uc11c\ud568\uc744 \uccb4\ud06c\ud574\uc8fc\uc138\uc694."},p={READABLE:"read",WRITABLE:"write",REMOVABLE:"remove",MANAGABLE:"manage"},d=n.Model.extend({defaults:{nodeId:0,nodeDeptId:"",nodeCompanyId:null,nodeCompanyName:null,nodeType:"user",nodeValue:"",actions:"",members:null},initialize:function(){t.isArray(this.get("members"))||this.set("members",[])},isUserType:function(){return this.get("nodeType")=="user"},isUserWithDeptType:function(){return this.isUserType()&&!this.get("nodeDeptId")},isDeptType:function(e){var t=this.get("nodeType")=="department";return e&&(t=t||this.isSubDeptType()),t},isSubDeptType:function(){return this.get("nodeType")=="subdepartment"},isPositionType:function(){return this.get("nodeType")=="position"},isGradeType:function(){return this.get("nodeType")=="grade"},isDutyType:function(){return this.get("nodeType")=="duty"},isUserGroupType:function(){return this.get("nodeType")=="usergroup"},isCompanyType:function(){return this.get("nodeType")=="company"}}),v=n.Collection.extend({model:d}),m=n.View.extend({el:".layer_share_scope .content",initialize:function(e){this.options=e||{},this.shares=this.options.shares},render:function(){console.log(this.shares),t.each(this.shares.get("companyShares"),function(e){var t=new v(e.nodes);console.log(t),this.$el.append(o({nodes:this._makeTemplateData(t),withoutSubDept:this.withoutSubDept,visibleCompanyName:!0,including_sub_dept_label:h.including_sub_dept,useAction:this.useAction,companyName:t.at(0).get("nodeCompanyName")}))},this)},_makeTemplateData:function(e){return t.map(e.models,function(e,t){return{"isFirst?":t==0,"isDeptOrSubDeptType?":e.isDeptType(!0),"isSubDeptType?":e.isSubDeptType(),nodeId:e.get("nodeId"),nodeType:e.get("nodeType"),nodeDeptId:e.get("nodeDeptId"),nodeCompanyName:e.get("nodeCompanyName"),nodeValue:e.get("nodeValue"),nodeTypeLabel:h[e.get("nodeType")],actions:e.get("actions"),isCompanyType:e.isCompanyType(),actionName:function(){var t=e.get("actions"),n=[];return t.indexOf(p.READABLE)>=0&&n.push(l["\uc77d\uae30"]),t.indexOf(p.WRITABLE)>=0&&n.push(l["\uc4f0\uae30"]),n.join("/")}()}})}});return m});