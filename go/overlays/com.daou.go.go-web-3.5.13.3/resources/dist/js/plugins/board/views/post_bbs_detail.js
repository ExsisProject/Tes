(function(){define(["jquery","backbone","app","when","board/models/post","board/models/post_recommend","board/collections/post_reader","hgn!board/templates/post_bbs_detail","hgn!board/templates/post_recommend_list","hgn!board/templates/post_reader_list","hgn!board/templates/post_auth_user_popup","board/views/post_bbs_tiny","board/views/post_attaches","board/views/dept_list","views/profile_card","board/collections/header_list","hgn!board/templates/header_select_list","i18n!board/nls/board","i18n!nls/commons","board/models/board_config","board/models/post_mail","comment","email_send_layer","content_viewer","lottie","jquery.dataTables","jquery.go-sdk","jquery.ui","jquery.go-popup","GO.util","go-fancybox"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T){var N=null,C={ok:y["\ud655\uc778"],modify:y["\uc218\uc815"],"delete":y["\uc0ad\uc81c"],list:y["\ubaa9\ub85d"],print:y["\uc778\uc1c4"],copy:y["\ubcf5\uc0ac"],move:y["\uc774\ub3d9"],comment:y["\ub313\uae00"],count:y["\uac1c"],user_count:y["\uba85"],plus_user:y["\uc88b\uc544\uc694 \ub204\ub978 \uc0ac\ub78c"],post_write:g["\uc0c8\uae00\uc4f0\uae30"],reomment_list_tab:g["\uc88b\uc544\uc694"],recommend:y["\uc88b\uc544\uc694 \ud558\uae30"],recommend_cancel:y["\uc88b\uc544\uc694 \ucde8\uc18c"],read_count:g["\uc870\ud68c"],post_reply:g["\ub2f5\uae00\uc4f0\uae30"],board_urltoclip_ie:g["\uac8c\uc2dc\uae00\uc8fc\uc18c\ubcf5\uc0acIE"],board_urltoclip_etc:g["\uac8c\uc2dc\uae00\uc8fc\uc18c\ubcf5\uc0acETC"],post_orphan_msg:g["\uc6d0\uae00\uc774 \uc0ad\uc81c\ub41c \ub2f5\uae00"],post_delete_title:g["\uac8c\uc2dc\uae00\uc744 \uc0ad\uc81c \ud558\uc2dc\uaca0\uc2b5\ub2c8\uae4c?"],post_delete_desc:g["\uc0ad\uc81c\ud655\uc778\uba54\uc138\uc9c0"],post_move_title:g["\uac8c\uc2dc\ubb3c \uc774\ub3d9"],post_move_success:y["\uc131\uacf5\ud588\uc2b5\ub2c8\ub2e4."],header_default:g["\ub9d0\uba38\ub9ac \uc120\ud0dd"],post_move_desc:g["\uac8c\uc2dc\ubb3c\uc744 \uc774\ub3d9\uc2dc\ud0ac \uac8c\uc2dc\ud310\uc744 \uc120\ud0dd\ud558\uc138\uc694."],post_move_header_desc:g["\ub9d0\uba38\ub9ac\ub97c \uc120\ud0dd\ud574\uc8fc\uc138\uc694."],post_move_reply_only:g["\ub2f5\uae00\uc740 \uc6d0\uae00\uacfc \ud568\uaed8 \uc774\ub3d9\uc2dc\ud0ac \uc218 \uc788\uc2b5\ub2c8\ub2e4."],post_move_orphan_desc:g["\uc6d0\uae00\uc774 \uc0ad\uc81c\ub41c \ub2f5\uae00\uc740 \uc774\ub3d9\ud560 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4."],send_mail:y["\uba54\uc77c\ubc1c\uc1a1"],copy_fail:y["\uc2e4\ud328\ud588\uc2b5\ub2c8\ub2e4."],post_copy_title:g["\uac8c\uc2dc\ubb3c \ubcf5\uc0ac"],post_copy_message:g["* \uc6d0\uae00 \ubcf5\uc0ac\uc2dc, \ub2f5\uae00\ub3c4 \ud568\uaed8 \ubcf5\uc0ac\ub429\ub2c8\ub2e4."],post_copy_desc:g["\uac8c\uc2dc\ubb3c\uc744 \ubcf5\uc0ac\ud560 \uac8c\uc2dc\ud310\uc744 \uc120\ud0dd\ud558\uc138\uc694."],post_copy_success:y["\uc131\uacf5\ud588\uc2b5\ub2c8\ub2e4."],post_copy_orphan_desc:g["\uc6d0\uae00\uc774 \uc0ad\uc81c\ub41c \ub2f5\uae00\uc740 \ubcf5\uc0ac\ud560 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4."],post_copy_reply_desc:g["\uc6d0\uae00 \uc774\ub3d9 \uc2dc, \ub2f5\uae00\ub3c4 \ud568\uaed8 \ubcf5\uc0ac\ub429\ub2c8\ub2e4."],post_copy_reply_only:g["\ub2f5\uae00\uc740 \uc6d0\uae00\uacfc \ud568\uaed8 \ubcf5\uc0ac\uc2dc\ud0ac \uc218 \uc788\uc2b5\ub2c8\ub2e4."],post_copy_same_board_alert:g["\ub3d9\uc77c\ud55c \uac8c\uc2dc\ud310\uc774 \uc120\ud0dd\ub418\uc5c8\uc2b5\ub2c8\ub2e4."],copy_url:y["URL \ubcf5\uc0ac"],read_auth:g["\uc5f4\ub78c \uad8c\ud55c"]},k=function(){return r.promise.apply(this,arguments)},L=t.View.extend({el:"#content #postContents",events:{"click span.photo a[data-userid]":"showProfileCard","click div.info a.name":"triggerProfileCard","click span#heartbeat":"actionPostRecommend","click a#listPostRecommend":"showPostRecommend","click a#listPostReader":"showPostReader","click section.tool_bar a.post_delete":"actionPostDelete","click section.tool_bar a.post_move":"actionPostMove","click section.tool_bar a.post_copy":"actionPostCopy","click ul.tab_nav2 li.first":"showPostReader","click ul.tab_nav2 li.last":"showPostRecommend","click .btn_go_list":"goToList","click .btn_go_print":"print","click li a.preview":"preview","click section.tool_bar a.sendMailBtn":"showSendMailLayer","click .btn_more":"onMoreBtnClicked","click #postAuthUserShowBtn":"onPostAuthUserShowBtnClicked"},print:function(){var e=window.location.protocol+"//"+window.location.host+GO.contextRoot+"app/board/"+this.boardId+"/post/"+this.postId+"/popup";window.open(e,"","location=no, directories=no,resizable=yes,status=no,toolbar=no,menubar=no, width=1280,height=650,left=0, top=0, scrollbars=yes")},initialize:function(e){this.options=e||{};var t=this;this.deptId=this.options.owner.ownerId,this.boardId=this.options.boardId,this.postId=this.options.postId,this.masterOwner=this.options.owner,this.isCommunity=this.options.isCommunity||!1,this.commentFlag=this.options.commentFlag||!1,this.sendMailFlag=this.options.sendMailFlag||!1,this.writeUrl=this._getWriteUrl(),this.replyUrl=this._getReplyUrl(),this.editUrl=this._getEditUrl(),this.model=new i(this.options),this.model.setURL(),this.model.fetch({async:!1,statusCode:{403:function(){GO.util.error("403",{msgCode:"400-board"})},404:function(){GO.util.error("404",{msgCode:"400-board"})},500:function(){GO.util.error("500")}}}),this.boardId!=this.model.toJSON().boardId&&n.router.navigate("error/403",{trigger:!0,pushState:!1,replace:!0}),this.boardModel=b.get(this.boardId),this.postMailModel=new w({boardId:this.boardId,postId:this.postId}),this.recommendModel=new s(this.options),this.recommendModel.set("id",this.postId,{silent:!0}),this.postReaderCollection=null,this.model.on("change",function(e){e.hasChanged("id")&&(t.postId=e.id,e.set({postId:t.postId},{silent:!0}),n.router.navigate(t._getDirectPostUrl(),{trigger:!1})),t.render()})},render:function(){var t=n.router.getSearch(),r=this.model.toJSON(),i=this.boardModel.get("actions"),s=this.boardModel.get("anonymFlag"),o=function(){return this.dataset.recommendCount==0?!0:!1},a=u({dataset:r,postTitle:function(){return GO.util.textToHtml(this.dataset.title)},boardActions:i,boardId:this.boardId,ownerId:this.masterOwner.ownerId,isZero:o,directUrl:this._getDirectPostUrl(),writeUrl:this.writeUrl,replyUrl:this.replyUrl,editUrl:this.editUrl,dateformat:function(){return GO.util.basicDate(this.dataset.createdAt)},isActiveDept:this.boardModel.get("status")=="ACTIVE",contextRoot:GO.contextRoot,lang:C,boardLang:g,sendMailFlag:this.sendMailFlag,isCommunity:this.isCommunity,anonymFlag:s,hasAuthorizedUsers:r.authorizedUsers&&r.authorizedUsers.length>0?!0:!1});this.$el.html(a),this.renderContentViewer(),r.attaches&&r.attaches.length&&(h.render({el:"#attaches"+r.id,attaches:r.attaches,postId:this.postId,boardId:this.boardId}),h.resize(this.$el),e(".fancybox-thumbs").goFancybox()),this.commentRender(),c.render({boardId:this.boardId,postId:this.postId,listParams:t,masterOwner:this.masterOwner,stickable:r.stickable}),this.setHeartbeatAnimation(this.$el.find("#heartbeat"))},setHeartbeatAnimation:function(t){var n=T.loadAnimation({container:t[0],renderer:"svg",loop:!1,autoplay:!1,path:window.location.protocol+"//"+window.location.host+GO.contextRoot+"resources/js/vendors/lottie/heartbeat.json"});t.hasClass("on")?n.play():n.stop(),t.on("click",function(){e(this).hasClass("on")?n.stop():n.play()})},commentRender:function(){this.commentView=E.init({el:this.$("#replyArea"),typeUrl:"board/"+this.boardId+"/post",typeId:this.postId,isWritable:this.commentFlag,anonymFlag:this.boardModel.get("anonymFlag"),availableAnonymousWriterOptionInPostComment:this.boardModel.get("availableAnonymousWriterOptionInPostComment")}),this.commentView.render().fetchComments(!0);var t=this;this.commentView.$el.on("comment:change",function(n,r,i){t.$("#comment_num").text("["+i+"]"),e("#commentCount").html(i)})},popupCommentRender:function(){this.commentView=E.init({el:this.$("#replyArea"),typeUrl:"board/"+this.boardId+"/post",typeId:this.postId,isWritable:!1,popupPrint:!0}),this.commentView.fetchComments(!0);var e=this},popupRender:function(){var t=this.model.toJSON(),n=function(){return this.dataset.recommendCount==0?!0:!1},r=u({dataset:t,postTitle:function(){return GO.util.textToHtml(this.dataset.title)},boardId:this.boardId,ownerId:this.masterOwner.ownerId,isZero:n,directUrl:this._getDirectPostUrl(),writeUrl:this.writeUrl,replyUrl:this.replyUrl,editUrl:this.editUrl,dateformat:function(){return GO.util.basicDate(this.dataset.createdAt)},isActiveDept:this.boardModel.get("status")=="ACTIVE",contextRoot:GO.contextRoot,lang:C,sendMailFlag:this.sendMailFlag,isCommunity:this.isCommunity,isPopup:!0});return this.$el.html(r),this.$("#boardContent").html(this.model.get("content")),t.attaches&&t.attaches.length&&(h.render({el:"#attaches"+t.id,attaches:t.attaches,postId:this.postId,boardId:this.boardId}),h.resize(this.$el),e(".fancybox-thumbs").fancybox({type:"image",padding:5,openEffect:"elastic",openSpeed:150,closeEffect:"elastic",closeSpeed:150,closeBtn:!1,helpers:{title:{type:"outside"},buttons:{tpl:'<div id="fancybox-buttons" class="top"><ul><li><a class="btnPrev" title="Previous" href="javascript:;"></a></li><li><a class="btnPlay" title="Start slideshow" href="javascript:;"></a></li><li><a class="btnNext" title="Next" href="javascript:;"></a></li><li><a class="btnToggle btnDisabled" title="Toggle size" href="javascript:;"></a></li><li><a class="btnSave linkedImage" title="Save" data-bypass>Save</a></li><li><a class="btnClose" title="Close" href="javascript:jQuery.fancybox.close();"></a></li></ul></div>'},thumbs:{width:75,height:50}},beforeShow:function(){this.title=(this.title?""+this.title+"":"")+'<span style="float:right">'+(this.index+1)+" / "+this.group.length+"</span>"}}),e("#fancybox-buttons a.btnSave").die("click"),e("#fancybox-buttons a.btnSave").live("click",function(){GO.util.fancyBoxImageDownLoad()})),this.popupCommentRender(),this.$el},renderContentViewer:function(){var e=GO.util.convertMSWordTag(this.model.get("content"));this.model.get("contentType")=="TEXT"&&(e=GO.util.convertRichText(e)),this.contentViewer=x.init({$el:this.$("#boardContent"),content:e,css:["resources/css/doc_editor.css"]})},preview:function(t){var n=e(t.currentTarget);return GO.util.preview(n.attr("data-id")),!1},_getDirectPostUrl:function(){var e=n.router.getRootUrl();return this.isCommunity?e+="community/"+this.masterOwner.ownerId+"/board/"+this.boardId+"/post/"+this.postId:e+="board/"+this.boardId+"/post/"+this.postId,e},_getReplyUrl:function(){var e=GO.contextRoot;return this.isCommunity?e+="app/community/"+this.masterOwner.ownerId+"/board/"+this.boardId+"/post/"+this.postId+"/write":e+="app/board/post/write/"+this.masterOwner.ownerId+"/"+this.boardId+"/"+this.postId,e},_getEditUrl:function(){var e=GO.contextRoot;return this.isCommunity?e+="app/community/post/put/":e+="app/board/post/put/",e+this.masterOwner.ownerId+"/"+this.boardId+"/"+this.postId},_getWriteUrl:function(){var e=GO.contextRoot;return this.isCommunity?e+="app/community/"+this.masterOwner.ownerId+"/board/"+this.boardId+"/post/write":e+="app/board/post/write/"+this.masterOwner.ownerId+"/"+this.boardId,e},isFullSearch:function(){var e=GO.router.getSearch();return!_.isEmpty(e)&&!_.has(e,"page")},goToList:function(){var t=GO.router.getSearch(),r="",i="",s=t.page,o=t.offset,u=t.sorts;if(_.has(t,"keyword")){var a=t.keyword;delete t.keyword;var f="keyword="+encodeURIComponent(a)+"&"+e.param(t);r=f?"?"+f:""}else{var l="page="+s+"&offset="+o+"&sorts="+encodeURIComponent(u);r=l?"?"+l:""}this.isCommunity?i="community/"+this.masterOwner.ownerId+"/board/"+this.boardId:i="board/"+this.boardId,n.router.navigate(i,!0)},showProfileCard:function(t){var n=e(t.currentTarget).attr("data-userid");n!=""&&d.render(n,t.currentTarget)},triggerProfileCard:function(t){var n=e(t.currentTarget).parents(".article_wrap").find(".photo a");d.render(n.attr("data-userid"),n)},actionPostDelete:function(){var t=this;e.goCaution(C.post_delete_title,C.post_delete_desc,function(){t.model.destroy({success:function(e,r){GO.EventEmitter.trigger("board","change:boardInfo",!1),GO.EventEmitter.trigger("boardTree","changed:nodes"),n.router.navigate((t.isCommunity?"community/"+t.masterOwner.ownerId+"/":"")+"board/"+t.boardId,{trigger:!0,replace:!0})},error:function(t,n){n.responseJSON&&n.responseJSON.message&&e.goAlert(n.responseJSON.message)}})})},actionPostCopy:function(){var t=this,n=null,r=[],i=function(n){var i=!0,s=[],o=n.find("#boardCopyTable tr");e.each(o,function(t,n){var r={},o=e(n).find(".select_board option:selected"),u=e(n).find(".copy_header_list option:selected");if(!o.val())return e.goError(C.post_copy_desc),i=!1,!1;if(o.attr("data-headerFlag")=="true"&&o.attr("data-headerRequiredflag")=="true"&&u.val()==0)return e.goError(C.post_move_header_desc),i=!1,!1;var a=e.grep(s,function(e){return e.id==o.val()});if(a.length>0)return e.goSlideMessage(C.post_copy_same_board_alert,"caution"),i=!1,!1;r.id=o.val(),r.headerId=u.length?u.val():"",s.push(r)});if(!i)return;e.goPopup.close(),GO.EventEmitter.trigger("common","layout:setOverlay",!0);var u=[GO.contextRoot+"api/board",t.boardId,"post/copy"];e.ajax({type:"POST",async:!0,data:JSON.stringify({postIds:r,boards:s}),dataType:"json",contentType:"application/json",url:u.join("/")}).done(function(t){e.goSlideMessage(C.post_copy_success),GO.EventEmitter.trigger("board","change:boardInfo",!1),GO.EventEmitter.trigger("board","changed:deptBoard",!0),GO.EventEmitter.trigger("common","layout:clearOverlay",!0)}).fail(function(t){e.goSlideMessage(C.copy_fail,"caution"),GO.EventEmitter.trigger("common","layout:clearOverlay",!0)})};r.push(this.postId);var s=[C.post_copy_desc];if(this.model.toJSON().id!=this.model.toJSON().root){e.goAlert(C.post_copy_title,C.post_copy_reply_only);return}if(this.model.toJSON().orphanFlag){e.goAlert(C.post_copy_title,C.post_copy_orphan_desc);return}var o=[];o.push('<span class="desc">'),o.push("<br>"+g["\uc5f4\ub78c\uad8c\ud55c \ubcf5\uc0ac \ubb38\uad6c"]),o.push("</span>"),o.push('<br><br><div id="deptList"></div>'),n=e.goPopup({pclass:"layer_normal layer_absence",width:700,header:C.post_copy_title,title:s.join(""),modal:!0,contents:o.join(""),buttons:[{btype:"confirm",btext:C.copy,autoclose:!1,callback:i}]}),p.render({id:".go_popup #deptList",boardList:!0,deptId:this.deptId,boardId:this.boardId,isCommunity:this.isCommunity,boardType:"classic",postId:"",isCopy:!0}),this.attachHeaderSelectCopy(e("#boardCopyTable select.select_board")),n.reoffset(),e("#boardCopyTable select.select_board").die(),e("#boardCopyTable select.select_board").live("change",function(e){t.changeBoardListCopy(e)})},actionPostMove:function(){var t=this,r=null,i=[],s=function(r){var s=r.find("#select_board"),o=s.find("option:selected"),u=s.val(),a=s.find("option:selected").text(),f=[GO.contextRoot+"api/board",t.boardId,"post/move",u],l=r.find("#move_header_list"),c=l.val();c!="0"&&f.push(c);if(o.attr("data-headerFlag")=="true"&&o.attr("data-headerRequiredflag")=="true"&&c==0)return e.goError(C.post_move_header_desc),!1;if(!u)return e.goError(C.post_move_desc),!1;e.goPopup.close(),GO.EventEmitter.trigger("common","layout:setOverlay",!0),e.go(f.join("/"),JSON.stringify({ids:i}),{qryType:"PUT",contentType:"application/json",responseFn:function(){e.goMessage(a+C.post_move_success),GO.EventEmitter.trigger("board","change:boardInfo",!1),GO.EventEmitter.trigger("board","changed:deptBoard",!0),GO.EventEmitter.trigger("common","layout:clearOverlay",!0),t.isCommunity?n.router.navigate("community/"+t.masterOwner.ownerId+"/board/"+t.boardId,{trigger:!0,replace:!0}):n.router.navigate("board/"+t.boardId,{trigger:!0,replace:!0})},error:function(t){e.goAlert(t.responseJSON.message)}})};i.push(this.postId);var o=[C.post_move_desc];if(this.model.toJSON().id!=this.model.toJSON().root){e.goAlert(C.post_move_title,C.post_move_reply_only);return}if(this.model.toJSON().orphanFlag){e.goAlert(C.post_move_title,C.post_move_orphan_desc);return}r=e.goPopup({pclass:"layer_normal layer_item_move",width:300,header:C.post_move_title,title:o.join(""),modal:!0,contents:'<br /><div id="deptList"></div>',buttons:[{btype:"confirm",btext:C.move,autoclose:!1,callback:s}]}),p.render({id:".go_popup #deptList",boardList:!0,deptId:this.deptId,boardId:this.boardId,isCommunity:this.isCommunity,boardType:"classic",postId:"",isMove:!0}),r.reoffset(),e("#deptList select#select_board").die(),e("#deptList select#select_board").live("change",function(){t.changeBoardList()})},attachHeaderSelectCopy:function(t){if(t.val()){var n=[];t.find("option:selected").attr("data-headerflag")=="true"&&(n=v.getHeaderList({boardId:t.val()}).toJSON());if(n.length>0){var r=m({dataset:n,defaultSelect:C.header_default,selectClass:"wfix_medi copy_header_list"});e("#headerSelectPart").show(),t.parents("tr").first().find(".board_header_wrap").html(r)}else e("#headerSelectPart").hide(),t.parents("tr").first().find(".board_header_wrap").html("")}else e("#headerSelectPart").hide()},attachHeaderSelect:function(t,n){var r=[];n=="true"&&(r=v.getHeaderList({boardId:t}).toJSON());if(r.length>0){var i=m({dataset:r,defaultSelect:C.header_default,selectId:"move_header_list"});e("#header_dt").show(),e(".go_popup #deptList #board_header_wrap").html(i)}else e("#header_dt").hide(),e(".go_popup #deptList #board_header_wrap").html("")},changeBoardList:function(){var t=e("#select_board option:selected");this.attachHeaderSelect(t.val(),t.attr("data-headerflag"))},changeBoardListCopy:function(t){var n=e(t.currentTarget);this.attachHeaderSelectCopy(n)},actionPostRecommend:function(t){var n=this,r={success:function(i,s){if(s.code==200){var o=n.$el.find("#listPostRecommend"),u=s.data.recommendCount||0;o.html(u),r.type=="DELETE"?(e(t.currentTarget).removeClass("on").attr("title",C.recommend),e(t.currentTarget).find("span.txt").html(u)):(e(t.currentTarget).addClass("on").attr("title",C.recommend_cancel),e(t.currentTarget).find("span.txt").html(u)),n.model.set("recommend",!n.model.get("recommend"),{silent:!0})}else e.goMessage(s.message)}};r.type=this.model.get("recommend")?"DELETE":"POST",this.recommendModel.save({},r)},isCurrentLayer:function(t){return e(t.currentTarget).hasClass("on")},showPostRecommend:function(t){if(this.isCurrentLayer(t))return;var n=['<ul class="tab_nav tab_nav2"><li class="first"><span>',C.read_count,'</span></li><li class="last on"><span>',C.reomment_list_tab,"</span></li></ul>"],r=e.goPopup({pclass:"layer_normal layer_reader",headerHtml:n.join(""),contents:a(),buttons:[{btype:"confirm",btext:C.ok}]});this.postPopupTabs(r),e.goGrid({el:"#recommendList",url:GO.contextRoot+"api/board/"+this.boardId+"/post/"+this.postId+"/recommend",displayLength:10,displayLengthSelect:!1,emptyMessage:g["\uc88b\uc544\uc694 \ubaa9\ub85d\uc774 \uc5c6\uc2b5\ub2c8\ub2e4."],method:"GET",defaultSorting:[],sDom:'rt<"tool_bar"<"critical custom_bottom">p>',bProcessing:!1,columns:[{mData:null,sWidth:"150px",bSortable:!1,sClass:"align_l",fnRender:function(e){var t=e.aData,n=[t.recommender.name," ",t.recommender.positionName].join("");return t.recommender.otherCompanyUser&&(n='<span class="multi_user">'+n+"</span>"),returnArr=[n,'&nbsp;<span class="date">',GO.util.basicDate(t.updatedAt),"</span>"],returnArr.join("")}}],fnDrawCallback:function(t,n,i){var s=r.find(".tool_bar");n._iRecordsTotal<n._iDisplayLength?(e(this.el).find("tr:last-child>td").css("border-bottom",0),s.hide()):(s.show(),s.find("div.dataTables_paginate").css("margin-top",0)),r.find(".dataTables_wrapper").css("margin-bottom",0),r.reoffset()}})},postPopupTabs:function(t){var n=this;t.on("click","ul.tab_nav2 li",function(t){e(t.currentTarget).hasClass("first")?n.showPostReader(t):n.showPostRecommend(t)})},showPostReader:function(t){if(this.isCurrentLayer(t))return;var n=null,r=['<ul class="tab_nav tab_nav2"><li class="first on"><span>',C.read_count,'</span></li><li class="last"><span>',C.reomment_list_tab,"</span></li></ul>"];n=e.goPopup({pclass:"layer_normal layer_reader",headerHtml:r.join(""),contents:f(),buttons:[{btype:"confirm",btext:C.ok}]}),this.postPopupTabs(n),e.goGrid({el:"#readerList",url:GO.contextRoot+"api/board/"+this.boardId+"/post/"+this.postId+"/reader",displayLength:10,displayLengthSelect:!1,emptyMessage:"",method:"GET",defaultSorting:[],sDom:'rt<"tool_bar"<"critical custom_bottom">p>',bProcessing:!1,columns:[{mData:null,bSortable:!1,sClass:"align_l",fnRender:function(e){var t=e.aData,n=[t.reader.name," ",t.reader.positionName].join("");return t.reader.otherCompanyUser&&(n='<span class="multi_user">'+n+"</span>"),returnArr=[n,'&nbsp;<span class="date">',GO.util.basicDate(t.updatedAt),"</span>"],returnArr.join("")}},{mData:null,sWidth:"80px",sClass:"align_l",bSortable:!1,fnRender:function(e){var t=e.aData;return['<span class="plus_num">',C.read_count,t.point,"</span>&nbsp;"].join("")}}],fnDrawCallback:function(t,r,i){var s=n.find(".tool_bar");r._iRecordsTotal<r._iDisplayLength?(e(this.el).find("tr:last-child>td").css("border-bottom",0),s.hide()):(s.show(),s.find("div.dataTables_paginate").css("margin-top",0)),n.find(".dataTables_wrapper").css("margin-bottom",0),n.reoffset()}})},showSendMailLayer:function(){this.asyncFetch(this.postMailModel).then(_.bind(function(){var e=this.postMailModel.toJSON(),t=e.body,n=_.map(e.attachList,function(e){var t=e.path+":"+e.name+":"+e.size+":"+e.id+"\n";return t});this.openEmailPopup(t,n)},this)).otherwise(function(t){console.log(t.stack)})},onMoreBtnClicked:function(t){e(t.currentTarget).find(".array_option").toggle(),this.model.get("authorizedUsers").length>0?this.$el.find("#postAuthUserShowBtn").show():this.$el.find("#postAuthUserShowBtn").hide()},onPostAuthUserShowBtnClicked:function(){e.goPopup({width:"320",modal:!0,header:g["\uc5f4\ub78c \uad8c\ud55c"],pclass:"layer_normal layer_read_authority",contents:l({authorizedUsers:this.model.get("authorizedUsers")}),buttons:[{btext:y["\ud655\uc778"],btype:"confirm",autoclose:!0}]})},openEmailPopup:function(e,t){var n=Math.floor(Math.random()*1e4),r="scrollbars=yes,resizable=yes,width=1280,height=760";window.open("",n,r);var i=document.createElement("form"),s=document.createElement("input");s.type="hidden",s.name="data";var o={};o.content=e;var u=[];_.each(t,function(e){u.push(e)}),o.attachFiles=u,s.value=JSON.stringify(o),i.appendChild(s),i.action=GO.contextRoot+"app/mail/popup/process",i.method="post",i.target=n,document.body.appendChild(i),i.submit(),document.body.removeChild(i)},asyncFetch:function(t){return new k(function(n,r,i){t.fetch({success:n,error:r,statusCode:{400:function(){e.goError(y["500 \uc624\ub958\ud398\uc774\uc9c0 \ub0b4\uc6a9"])},403:function(){e.goError(y["\uad8c\ud55c\uc774 \uc5c6\uc2b5\ub2c8\ub2e4."])},404:function(){e.goError(GO.i18n(y["{{resource}}\uc774(\uac00) \uc874\uc7ac\ud558\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4."],{resource:"\uac8c\uc2dc\uae00"}))},500:function(){e.goError(y["500 \uc624\ub958\ud398\uc774\uc9c0 \ub0b4\uc6a9"])}}})})}});return{render:function(e){var t=new L(e);return t.render()},popupRender:function(e){var t=new L(e);return t.popupRender()}}})}).call(this);