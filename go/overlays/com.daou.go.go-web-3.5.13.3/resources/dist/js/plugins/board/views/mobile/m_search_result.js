(function(){define(function(require){var e=require("jquery"),t=require("backbone"),n=require("app"),r=require("board/collections/post_search"),i=require("text!board/templates/mobile/m_search_result.html"),s=require("text!board/templates/mobile/m_search_result_unit.html"),o=require("views/mobile/m_search_common_result"),u=require("i18n!nls/commons"),a=require("i18n!board/nls/board");require("GO.util");var f=null,l={"\uac80\uc0c9\uacb0\uacfc\uc5c6\uc74c":u["\uac80\uc0c9\uacb0\uacfc\uc5c6\uc74c"],"\uac80\uc0c9\uacb0\uacfc":u["\uac80\uc0c9\uacb0\uacfc"]},c=function(){return n.util.snsDate(this.createdAt)},h=function(){if(this.hiddenPost)return a["\uc5f4\ub78c\uad8c\ud55c\uc774 \uc5c6\ub294 \uac8c\uc2dc\ubb3c\uc785\ub2c8\ub2e4."];var e=this.content;return e=e.replace(/<br \/>/gi,""),e},p=function(){var e=this.boardType;return e=="STREAM"?!0:!1},d=t.View.extend({el:"#searchResultWrap",events:{"vclick li[data-postid]":"_getContent"},initialize:function(e){var t=this;this.options=e,this.lastPage=!1,this.$el.off(),this.collection=new r.setCollection(this.options.isCommunity),o.set({collection:this.collection,searchOptions:this.options,renderListFunc:function(e){t._renderContents(e)},renderListMoreFunc:function(e){t._moreList(e)}})},render:function(){return o.fetch(),this.el},_renderContents:function(){var t=this.collection;this.$el.html(Hogan.compile(i).render({lang:l,dataset:t.toJSON(),resultCount:t.page.total,dateParse:c,resultContentParse:h,isStream:p},{partial:s})),e("#detailSearchToggle").removeClass("on"),this._showResultWrap()},_moreList:function(e){var t=e.toJSON();this.$el.find("ul:first").append(Hogan.compile(s).render({lang:l,dataset:t,dateParse:c,resultContentParse:h,isStream:p}))},_showResultWrap:function(){e("#simpleSearchWrap").hide(),e("#detailSearchWrap").hide(),e("#searchResultWrap").show()},_getContent:function(t){t.preventDefault();var r=e(t.currentTarget),i=r.attr("data-boardType"),s=r.attr("data-boardId"),o=r.attr("data-postId");if(!i||!s||!o)return;if(r.attr("data-hidden")=="true"){n.util.delayAlert(a["\uc5f4\ub78c\uad8c\ud55c\uc774 \uc5c6\ub294 \uac8c\uc2dc\ubb3c\uc785\ub2c8\ub2e4."]);return}e.ajax({url:n.contextRoot+"api/board/"+s+"/master",type:"GET",dataType:"json",success:function(e){var t=0;e.data.ownerType=="Community"&&(t=e.data.ownerId);var r="board/"+s+"/post/"+o;t&&(r="community/"+t+"/"+r),i=="STREAM"&&(r+="/stream"),n.router.navigate(r,!0)}})}});return{render:function(e){return f=new d(e),f.render()}}})}).call(this);