(function(){define(["jquery","backbone","app","hogan","i18n!nls/commons","i18n!board/nls/board","hgn!board/templates/home_list","hgn!board/templates/home_list_more","board/collections/post_myhome","board/views/board_title","board/collections/board_favorite","jquery.go-preloader"],function(e,t,n,r,i,s,o,u,a,f,l){var c={board:i["\uac8c\uc2dc\ud310"],board_home:s["\uac8c\uc2dc\ud310 \ud648"],detail_search:i["\uc0c1\uc138\uac80\uc0c9"],detail_view:i["\uc790\uc138\ud788 \ubcf4\uae30"],more_view:s["\ub354 \ubcf4\uae30"],search:i["\uac80\uc0c9"],search_result:i["\uac80\uc0c9\uacb0\uacfc"],total:s["\ucd1d"],count:s["\uac74"],not_list:s["\uc544\uc9c1 \ub4f1\ub85d\ub41c \uae00\uc774 \uc5c6\uc2b5\ub2c8\ub2e4. \uc544\ub798 \ubc84\ud2bc\uc744 \ud074\ub9ad\ud558\uc5ec, \uae00\uc744 \ub4f1\ub85d\ud574 \uc8fc\uc138\uc694."],not_board:s["\uc544\uc9c1 \ub4f1\ub85d\ub41c \uac8c\uc2dc\ud310\uc774 \uc5c6\uc2b5\ub2c8\ub2e4. \uc544\ub798 \ubc84\ud2bc\uc744 \ud074\ub9ad\ud558\uc5ec, \uac8c\uc2dc\ud310\uc744 \ub4f1\ub85d\ud574 \uc8fc\uc138\uc694."],not_dept_board:s["\uc544\uc9c1 \ub4f1\ub85d\ub41c \uac8c\uc2dc\ud310\uc774 \uc5c6\uc2b5\ub2c8\ub2e4."],new_post:s["\uc0c8 \uae00 \uc791\uc131\ud558\uae30"],new_board:s["\uac8c\uc2dc\ud310 \ucd94\uac00\ud558\uae30"],no_auth:s["\uc5f4\ub78c\uad8c\ud55c\uc774 \uc5c6\ub294 \uac8c\uc2dc\ubb3c\uc785\ub2c8\ub2e4."],not_list_01:s["\uc791\uc131\ub41c \uac8c\uc2dc\uae00\uc774 \uc5c6\uc2b5\ub2c8\ub2e4."],"private":i["\ube44\uacf5\uac1c"],wait:i["\uc7a0\uc2dc\ub9cc \uae30\ub2e4\ub824\uc8fc\uc138\uc694"],recent_board:s["\ucd5c\uc2e0\uae00 \ubaa8\uc74c"],total_board:s["\uc804\uccb4 \uac8c\uc2dc\ud310"],favorite:i["\uc990\uaca8\ucc3e\uae30"],empty_favorite:s["\uc990\uaca8\ucc3e\uae30 \uac8c\uc2dc\ud310 \uc5c6\uc74c"]},h=t.View.extend({unbindEvent:function(){this.$el.off(),this.$el.off("focus",".search_wrap .search"),this.$el.off("blur",".search_wrap .search"),this.$el.off("click",".btn_list_more"),this.$el.off("click",".title"),this.$el.off("click","ul.home_list li.dataItem"),this.$el.off("click",".btn_list_more"),this.$el.off("click",".board_link"),this.$el.off("click","span.photo a"),this.$el.off("click","#homeListNewPostBtn"),this.$el.off("click","#homeListNewBoardBtn"),this.$el.off("click","#moreButtoff"),this.$el.off("click","#home_tab li"),this.$el.off("click","li.private"),this.$el.off("click",".community_link")},bindEvent:function(){this.$el.on("focus",".search_wrap .search",e.proxy(this.searchFocus,this)),this.$el.on("blur",".search_wrap .search",e.proxy(this.searchBlur,this)),this.$el.on("click",".btn_list_more",e.proxy(this.viewPost,this)),this.$el.on("click","ul.home_list li.dataItem",e.proxy(this.viewDetailLi,this)),this.$el.on("click",".btn_list_more",e.proxy(this.viewDetail,this)),this.$el.on("click",".board_link",e.proxy(this.moveBoardLink,this)),this.$el.on("click","span.photo a, a.name",e.proxy(this.showProfileCard,this)),this.$el.on("click","#homeListNewPostBtn",e.proxy(this.newPost,this)),this.$el.on("click","#homeListNewBoardBtn",e.proxy(this.newBoard,this)),this.$el.on("click","#moreButton",e.proxy(this.listMore,this)),this.$el.on("click","#home_tab li",e.proxy(this.changeTab,this)),this.$el.on("click",".community_link",e.proxy(this.moveCommunityLink,this))},initialize:function(){this.favoriteCollection=l.getCollection(),this.hasFavorite=this.favoriteCollection.length==0?!1:!0,this.tabType=this.hasFavorite?"favorite":"all",this.collection=a.create({url_type:this.tabType})},render:function(){this.unbindEvent(),this.bindEvent();var t=this;e(window).unbind("scroll.board"),e(window).bind("scroll.board",function(n){d_height=e(document).height(),w_height=e(window).height(),s_height=d_height-w_height,d_top=e(document).scrollTop(),s_height-d_top<2&&t.$el.find("div.bottom_action").is(":visible")&&t.listMore()}),homelistTpl=o({lang:c,hasFavorite:this.hasFavorite}),this.$el.html(homelistTpl),this.renderContent(),f.render({el:".content_top",dataset:{name:c.board_home}}),GO.session("useOrg")||e("#homeListNewBoardBtn").remove(),(new p).render()},changeTab:function(t){var n=e(t.currentTarget),r=n.parents("ul:first");this.tabType=n.attr("data-type"),this.collection=a.create({url_type:this.tabType}),r.find("li").removeClass("active"),n.addClass("active"),this.renderContent()},showProfileCard:function(t){ProfileView=require("views/profile_card");var n=e(t.currentTarget).attr("data-userid");n!=""&&ProfileView.render(n,t.currentTarget),t.stopPropagation()},moveCommunityLink:function(e){return},newPost:function(){n.router.navigate("board/post/write",!0)},newBoard:function(){n.router.navigate("board/create",!0)},viewContent:function(e){alert("viewContent")},viewPost:function(e){},searchFocus:function(t){e(t.target).parent().addClass("search_focus")},searchBlur:function(t){e(t.target).parent().removeClass("search_focus")},moveBoardLink:function(t){var r=e(t.currentTarget).parents("li").first(),i=r.attr("data-boardId");n.router.navigate("board/"+i,!0),t.stopPropagation()},viewDetailLi:function(t){var n=e(t.currentTarget);this.moveBoardAction(n)},viewDetail:function(t){var n=e(t.currentTarget).parents("li").first();this.moveBoardAction(n)},moveBoardAction:function(e){var t=e.attr("data-boardType"),r=e.attr("data-boardId"),i=e.attr("data-postId");t=="CLASSIC"?n.router.navigate("board/"+r+"/post/"+i,!0):t=="STREAM"?n.router.navigate("board/"+r+"/post/"+i+"/stream",!0):n.router.navigate("board/"+r,!0)},onClickedPrivatePost:function(){e.goMessage(s["\uac8c\uc2dc\uae00 \uc5f4\ub78c\ubd88\uac00 \uba54\uc138\uc9c0"])},listMore:function(){var e=parseInt(this.collection.page.page)+1;this.renderContent({page:e,offset:15,isMore:!0})},renderContent:function(t){var n=this;defaults={page:0,offset:15,isMore:!1},options={},preloader=null,options=e.extend({},defaults,t),options.isMore||(preloader=e.goPreloader(),preloader.render()),this.collection.fetch({data:{page:options.page,offset:options.offset,url_type:n.tabType},success:function(e){var t=e.toJSON(),r=!0,i=!0,s="",o=n.tabType=="favorite"?!0:!1,a=e.extParameter==undefined?!0:e.extParameter;!t.length&&e.extParameter&&(r=e.extParameter.hasBoard,i=e.extParameter.hasWritableBoard);var f=function(){return this.type=="CLASSIC"?"classic":"feed"},l=function(){return parseInt(this.recommendCount)==0?"zero":""},h=function(e){return GO.util.snsDate(this.createdAt)},p=function(){var e=this.type;return e=="CLASSIC"?!0:!1},d=function(){function e(e){if(!e)return;var t=e.split("\n"),n=_.clone(t);return _.each(t,function(e,t){if(e!="")return!1;n.shift(t)}),n.join("\n")}var t=this.type=="STREAM"?e(this.summary):this.summary;return GO.util.textToHtml(GO.util.convertMSWordTag(t))},v=function(){return GO.util.escapeHtml(this.title)},m=function(){return this.hiddenPost},g=function(){return this.summary!=" $$#HIDDEN_POST#$$ "&&this.hiddenPost};s=u({dataSet:t,isZero:l,titleParse:v,contentParse:d,dateParse:h,hasBoard:r,lang:c,isClassic:p,isPostHidden:m,isTitleShowHiddenPost:g,writeBtnShow:i,isOrgServiceOn:GO.session("useOrg"),isFavorite:o,isEmptyFavorite:a,boardType:f}),options.isMore?n.$el.find("ul.article_list").append(s):n.$el.find("ul.article_list").html(s),n.moreBtnHide(e),n.$el.on("click","li.private",n.onClickedPrivatePost)}}).done(function(){options.isMore||preloader.release()})},moreBtnHide:function(){if(this.collection.length==0){e("#moreButton").hide();return}var t=this.collection.page.lastPage;t?e("#moreButton").hide():e("#moreButton").show()}},{__instance__:null,create:function(){return this.__instance__=new this.prototype.constructor({el:e("#content")}),this.__instance__},render:function(){var e=this.create(),t=arguments.length>0?Array.prototype.slice.call(arguments):[];return this.prototype.render.apply(e,t)}}),p=t.View.extend({el:"div.comm_group",initialize:function(){this.collection=new(t.Collection.extend({url:GO.contextRoot+"api/board/home/exposure"}))},render:function(){var t=this;this.collection.fetch({success:function(n){if(n.length==0){e("#recent_board").remove(),e("#content div.dashboard_comm").addClass("widzet_none");return}n.each(function(n){var r=e(["<div  class='list_type6' data-id='"+n.get("id")+"'>","<p class='tit'>"+n.get("name")+"</p>","<ul>","</ul>","<div class='img_loader_large' title='"+c.wait+"'></div>","</div>"].join(""));t.$el.append(r);var i=new g({boardId:n.get("id"),el:r});i.render()})}})}}),d=r.compile(["<li>","{{#data.isClose}}","<span class='ic_classic ic_lock' title='{{lang.private}}'></span>","{{/data.isClose}}","{{#data.isPostHidden}}","<a href='javascript:;'>","<span class='list_subject'>{{#data.isTitleHidden}}{{lang.no_auth}}{{/data.isTitleHidden}}{{^data.isTitleHidden}}{{data.title}}{{/data.isTitleHidden}}</span>","</a>","{{/data.isPostHidden}}","{{^data.isPostHidden}}","<a href='{{data.url}}'>","<span class='list_subject' title='{{data.contentParse}}'>{{data.title}}</span>","</a>","{{/data.isPostHidden}}","{{#data.isNew}}","<span class='ic_classic ic_new2'></span>","{{/data.isNew}}","<span class='date'>{{data.createdAt}}</span>","</li>"].join("")),v=r.compile(["<li>","<p class='data_null'>","<span class='ic_data_type ic_no_contents'></span>","<br>","<span class='txt'>{{lang.not_list_01}}</span>","</p>","</li>"].join("")),m=t.Collection.extend({initialize:function(e){this.boardId=e.boardId},url:function(){return GO.contextRoot+"api/company/board/"+this.boardId+"/latest"}}),g=t.View.extend({initialize:function(){this.collection=new m({boardId:this.options.boardId})},render:function(){var t=this;this.collection.fetch({success:function(n){var r=t.$el.find("ul");if(n.length==0)r.html(v.render({lang:c}));else{var i=[];n.each(function(t){var n=d.render({lang:c,data:e.extend({},t.toJSON(),{url:function(){var e=GO.contextRoot+"app/board/"+t.get("boardId")+"/post/"+t.get("id");return t.get("type")=="STREAM"&&(e+="/stream"),e},isClose:t.get("status")=="CLOSE",isNew:t.get("newFlag"),createdAt:GO.util.customDate(t.get("createdAt"),"MM-DD"),isPostHidden:t.get("hiddenPost"),isTitleHidden:t.get("summary")==" $$#HIDDEN_POST#$$ ",title:t.get("title"),contentParse:function(){return t.get("summary")?GO.util.convertMSWordTag(t.get("summary")).replace(/(\n)/gi," "):""}})});i.push(n)}),r.html(i.join(""))}t.$el.find("div.img_loader_large").hide()}})}});return h})})();