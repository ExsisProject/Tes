(function(){define(["views/mobile/m_more_list","jquery","backbone","app","board/collections/post_classic","views/mobile/header_toolbar","hgn!board/templates/mobile/m_post_bbs_unit","hgn!board/templates/mobile/m_board_list_item","i18n!board/nls/board","i18n!nls/commons","GO.util"],function(e,t,n,r,i,s,o,u,a,f){var l={read:a["\uc870\ud68c"],plus:a["\uc88b\uc544\uc694"],hidden_post:a["\uc5f4\ub78c\uad8c\ud55c\uc774 \uc5c6\ub294 \uac8c\uc2dc\ubb3c\uc785\ub2c8\ub2e4."],post_sticky:a["\uacf5\uc9c0\uae00"],post_sticky_show:a["\uacf5\uc9c0\uae00 \ubcf4\uae30"],post_sticky_hide:a["\uacf5\uc9c0\uae00 \ub2eb\uae30"],post_null:a["\ub4f1\ub85d\ub41c \uae00\uc774 \uc5c6\uc2b5\ub2c8\ub2e4."],post_orphan_msg:a["\uc6d0\uae00\uc774 \uc0ad\uc81c\ub41c \ub2f5\uae00"],"public":f["\uacf5\uac1c"]},c=e.extend({initialize:function(e){this.options=e||{},GO.util.appLoading(!0),GO.EventEmitter.trigger("common","layout:scrollToTop",this),this.nullTpl=['<li class="creat data_null"><span class="subject"><span class="txt_ellipsis">',l.post_null,"</span></span></li>"],this.headerToolbarView=s,this.collection=new i;var n={sorts:"sortCriteria desc,threadRootCode desc,threadCode asc"};this.isNoticeVisible=GO.util.store.get("isBoardNoticeVisible",null,{type:"local"});var r={listFunc:t.proxy(function(e){this.renderPosts(e.toJSON(),e.page)},this)};this.setRenderListFunc(r),this.setFetchInfo(n,this.collection)},unbindEvent:function(){this.$el.off("vclick","ul#classicUl a[data-postid]"),this.$el.off("vclick","#notice")},bindEvent:function(){this.$el.on("vclick","ul#classicUl a[data-postid]",t.proxy(this.goPostDetail,this)),this.$el.on("vclick","#notice",t.proxy(this.toggleNotice,this))},resetPage:function(e,t){e.boardId=t.boardId,e.owner=t.owner,e.manageable=t.manageable||!1,e.isCommunity=t.isCommunity||!1,e.writable=t.writable||!1,e.status=t.status,e.page=e.getPage(),e.status=="CLOSED"&&(e.writable=!1),e.postBbsTables=null,e.controlButtons=null,e.boardData=t.boardModel},getPage:function(){var e=r.router.getSearch("page");return e?e:0},render:function(){var e=this;this.resetPage(this,this.options),this.collection.boardId=this.boardId,this.unbindEvent(),this.bindEvent(),this.$el.html(u({ulTagId:"classicUl",otherClass:"list_board"})),this.$listEl=this.$el.find("ul");var n=this.isCommunity?this.boardData.ownerInfo+" > "+this.boardData.name:this.boardData.name,r={title:n,isList:!0,isSideMenu:!0,isHome:!0,isSearch:!0};return this.writable&&(r.isWriteBtn=!0,r.writeBtnCallback=function(){var t=e.isCommunity?"community":"board";t+="/post/write/"+e.owner.ownerId+"/"+e.boardId,GO.router.navigate(t,{trigger:!0})}),this.headerToolbarView.render(r),this.dataFetch(this.pageNo).done(t.proxy(function(e){this.renderListFunc.listFunc(e),this.scrollToEl()},this)),GO.util.appLoading(!1),this.el},getPosts:function(e){var t={offset:this.offset,sorts:"sortCriteria desc,threadRootCode desc,threadCode asc",page:e||0};this.collection.boardId=this.boardId,this.collection.fetch({async:!0,data:t,reset:!0})},renderPosts:function(e,n){var r=[];n&&n.page==0&&(this.$listEl.empty(),this.renderNotice()),e.length==0?n.page==0&&r.push(this.nullTpl.join("")):t.each(e,function(e,n){r.push(o(t.extend(n,{lang:l,"isReply?":function(){return this.depth},"isClose?":function(){return this.status==="CLOSE"},"isHidden?":function(){return this.status==="CLOSE"&&this.summary==" $$#HIDDEN_POST#$$ "},dateformat:function(){return GO.util.boardDate(this.createdAt,GO.lang)},isVisible:!0,postTitle:function(){return GO.util.escapeHtml(this.title)}})))}),this.$listEl.append(r.join(""))},goPostDetail:function(e){this.setSessionInfo(e),e.stopPropagation();var n=t(e.currentTarget),i=n.attr("data-postId"),s=n.attr("data-hidden"),o="board/"+this.boardId+"/post/"+i+"?page="+this.getPage();return s=="true"?(GO.util.delayAlert(a["\uc5f4\ub78c\uad8c\ud55c\uc774 \uc5c6\ub294 \uac8c\uc2dc\ubb3c\uc785\ub2c8\ub2e4."]),!1):(this.isCommunity&&(o="community/"+this.owner.ownerId+"/"+o),r.router.navigate(o,!0),!1)},renderNotice:function(){var e=this,n=[],r=[];this.noticeCollection=new i,this.noticeCollection.boardId=this.boardId,this.noticeCollection.notice=!0,this.noticeCollection.fetch({async:!1,data:{page:0,sorts:"sortCriteria desc,threadRootCode desc,threadCode asc"},reset:!0}),n=this.noticeCollection.toJSON(),n.length&&(r.push('<li class="notice" id="notice">','<a class="tit" href="javascript:;">','<span class="subject">','<span class="ic ic_noti"></span>','<span class="title">',a["\uacf5\uc9c0"],"(",n.length,")","</span>",this.noticeCollection.hasNewFlagPost()?'<span class="ic ic_new"></span>':"","</span>",'<span class="optional">','<span data-tag="noticeArrow" class="ic ',this.isNoticeVisible?"ic_arrow3_t":"ic_arrow3_d",'"></span>',"</span>","</a>","</li>"),t.each(n,function(n,i){var s=!0;r.push(o(t.extend(i,{lang:l,"isNotice?":s,"isReply?":function(){return this.id!=this.thread&&this.status!="CLOSE"},"isClose?":function(){return this.status==="CLOSE"},"isHidden?":function(){return this.status==="CLOSE"&&this.summary==" $$#HIDDEN_POST#$$ "},dateformat:function(){return GO.util.boardDate(this.createdAt,GO.lang)},isVisible:e.isNoticeVisible,postTitle:function(){return GO.util.escapeHtml(this.title)}})))}),this.$listEl.prepend(r.join("")))},toggleNotice:function(e){var n=t(e.currentTarget),r=n.find("span[data-tag=noticeArrow]"),i=r.hasClass("ic_arrow3_d");r.toggleClass("ic_arrow3_t",i),r.toggleClass("ic_arrow3_d",!i),this.$listEl.find('li[data-notice="true"]').toggle(i),GO.util.store.set("isBoardNoticeVisible",i,{type:"local"})}},{__instance__:null,create:function(){return this.__instance__=new this.prototype.constructor({el:t("#content")}),this.__instance__},render:function(){var e=this.create(),t=arguments.length>0?Array.prototype.slice.call(arguments):[];return e.options=t[0],this.prototype.render.apply(e,t)}});return c})}).call(this);