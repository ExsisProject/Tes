(function(){define(["jquery","backbone","app","i18n!nls/commons","i18n!board/nls/board","hgn!board/templates/post_write","hgn!board/templates/post_write_auth_user","hgn!board/templates/post_attaches_file","hgn!board/templates/post_attaches_img","hgn!board/templates/post_link","hgn!board/templates/header_select_list","board/views/tmp_list","board/views/board_title","board/views/notice_layer","board/views/dept_list","board/collections/clipboard","board/models/post","board/models/board_config","board/collections/header_list","file_upload","jquery.go-popup","jquery.ui","json","json2","jquery.go-validation","jquery.placeholder","jquery.progressbar","jquery.go-orgslide","go-webeditor/jquery.go-webeditor"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b){var w=null,E={post_write:i["\uae00\uc4f0\uae30"],detail_search:r["\uc0c1\uc138\uac80\uc0c9"],notice:i["\uacf5\uc9c0"],notice_term:i["\uacf5\uc9c0 \uae30\uac04 \uc124\uc815"],notice_clear:i["\uacf5\uc9c0 \ud574\uc81c"],notice_register:i["\uacf5\uc9c0\ub85c \ub4f1\ub85d"],img_attach:r["\uc774\ubbf8\uc9c0 \ucca8\ubd80"],file_attach:r["\ud30c\uc77c \ucca8\ubd80"],link_add:i["\ub9c1\ud06c \ucd94\uac00"],vote:i["\ud22c\ud45c"],search:i["\uac80\uc0c9"],title:r["\uc81c\ubaa9"],tmp_posts:i["\uc784\uc2dc \uc800\uc7a5\ub41c \uae00"],public_setting:i["\uacf5\uac1c \uc124\uc815"],"public":r["\uacf5\uac1c"],"private":r["\ube44\uacf5\uac1c"],public_setting_msg:i["\u203b \ub098\uc640 \uc6b4\uc601\uc790\ub9cc \ubcfc \uc218 \uc788\ub3c4\ub85d \ube44\uacf5\uac1c\ub85c \uae00\uc744 \ub4f1\ub85d\ud569\ub2c8\ub2e4."],save_post:i["\ub4f1\ub85d"],tmp_post:i["\uc784\uc2dc\uc800\uc7a5"],share:i["\uc0c8\ub85c\uc6b4 \uc815\ubcf4, \uae30\ubd84 \uc88b\uc740 \uc18c\uc2dd\uc744 \ub3d9\ub8cc\ub4e4\uacfc \uacf5\uc720\ud558\uc138\uc694."],link_input:i["\ub9c1\ud06c\uc785\ub825"],post_stream:i["\uc774\uc57c\uae30 \ud558\uae30"],del:r["\uc0ad\uc81c"],confirm:r["\ud655\uc778"],cancel:r["\ucde8\uc18c"],tmpSave_success:i["\uc784\uc2dc\uc800\uc7a5 \ud588\uc2b5\ub2c8\ub2e4."],no_subject:r["\uc81c\ubaa9\uc5c6\uc74c"],no_content:i["\uc785\ub825\ub41c \ub0b4\uc6a9\uc774 \uc5c6\uc2b5\ub2c8\ub2e4."],alert_max_attach_cnt:i["\ucd5c\ub300 \ucca8\ubd80 \uac2f\uc218\ub294 0\uac1c \uc785\ub2c8\ub2e4."],alert_max_attach_size:i["\ucca8\ubd80\ud560 \uc218 \uc788\ub294 \ucd5c\ub300 \uc0ac\uc774\uc988\ub294 0MB \uc785\ub2c8\ub2e4."],alert_exclude_extension:i["\ud655\uc7a5\uc790\uac00 \ub561\ub561\uc778 \uac83\ub4e4\uc740 \ucca8\ubd80 \ud560 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4."],no_title:i["\uc81c\ubaa9\uc774 \uc5c6\uc2b5\ub2c8\ub2e4."],no_header:i["\ub9d0\uba38\ub9ac\ub97c \uc120\ud0dd\ud574\uc8fc\uc138\uc694."],alert_content:i["\uc785\ub825\ub41c \ub0b4\uc6a9\uc774 \uc5c6\uc2b5\ub2c8\ub2e4."],alert_length:i["0\uc790\uc774\uc0c1 0\uc774\ud558 \uc785\ub825\ud574\uc57c\ud569\ub2c8\ub2e4."],alert_init_writeform:i["\uc785\ub825\ud558\uc2e0 \uc815\ubcf4\uac00 \ucd08\uae30\ud654\ub429\ub2c8\ub2e4."],input_placeholder:i["\uc0c8\ub85c\uc6b4 \uc815\ubcf4, \uae30\ubd84 \uc88b\uc740 \uc18c\uc2dd\uc744 \ubd80\uc11c\uc6d0\ub4e4\uacfc \uacf5\uc720\ud558\uc138\uc694."],board_type_change:i["\uac8c\uc2dc\ud310 \ud0c0\uc785\uc774 \ubcc0\uacbd\ub418\uba74 ,\uae30\uc874\uc5d0 \uc785\ub825\ud588\ub358 \ub0b4\uc6a9\uc740 \ubaa8\ub450 \uc0ad\uc81c\ub429\ub2c8\ub2e4."],alert_date_format:i["\ub0a0\uc9dc \ud615\uc2dd\uc774 \ub9de\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4."],alert_fail:r["\uc2e4\ud328\ud588\uc2b5\ub2c8\ub2e4."],header_default:i["\ub9d0\uba38\ub9ac \uc120\ud0dd"],link_meta_delete:i["\uba54\ud0c0 \ub370\uc774\ud130 \uc0ad\uc81c"],link_meta_title:i["\ub9c1\ud06c \uba54\ud0c0\uc815\ubcf4 \ud0c0\uc774\ud2c0"],link_meta_img:i["\uba54\ud0c0\uc815\ubcf4 \uc774\ubbf8\uc9c0"],link_content_delete:i["\ub0b4\uc6a9 \uc0ad\uc81c"],link_img_delete:i["\uc774\ubbf8\uc9c0 \uc0ad\uc81c"],alim:r["\uc54c\ub9bc"],alim_mail:r["\uba54\uc77c\uc54c\ub9bc"],alim_push:r["\ud478\uc2dc\uc54c\ub9bc"],alim_tooltip:r["\ud574\ub2f9 \uac8c\uc2dc\ud310\uc5d0 \uc811\uadfc \uac00\ub2a5\ud55c \uc784\uc9c1\uc6d0\uc5d0\uac8c\ub9cc \uc54c\ub9bc\uc774 \ubc1c\uc1a1\ub429\ub2c8\ub2e4."],alim_alert:r["\uad00\ub9ac\uc790 \uc124\uc815\uc73c\ub85c \ud558\ub098\uc758 \uc54c\ub9bc\uc740 \ubc18\ub4dc\uc2dc \uc120\ud0dd\ub418\uc5b4\uc57c \ud569\ub2c8\ub2e4."],no_selected_board:i["\uac8c\uc2dc\ud310\uc744 \uc120\ud0dd\ud574 \uc8fc\uc138\uc694."],mail_push_desc:i["\uba54\uc77c\uc54c\ub9bc\uc548\ub0b4"],notice_top_register:i["\ucd5c\uc0c1\ub2e8\uc5d0 \ub4f1\ub85d"],notice_top_register_msg:i["\u203b \uacf5\uc9c0\uae00\uc774 \ub4f1\ub85d\ub418\uba74 \uac8c\uc2dc\ud310\uc758 \ucd5c\uc0c1\ub2e8\uc5d0 \ub4f1\ub85d\ub429\ub2c8\ub2e4."],"\uc774 \uacf3\uc5d0 \ud30c\uc77c\uc744 \ub4dc\ub798\uadf8 \ud558\uc138\uc694":r["\uc774 \uacf3\uc5d0 \ud30c\uc77c\uc744 \ub4dc\ub798\uadf8 \ud558\uc138\uc694"],"\uc774 \uacf3\uc5d0 \ud30c\uc77c\uc744 \ub4dc\ub798\uadf8 \ud558\uc138\uc694 \ub610\ub294":r["\uc774 \uacf3\uc5d0 \ud30c\uc77c\uc744 \ub4dc\ub798\uadf8 \ud558\uc138\uc694 \ub610\ub294"],"\ud30c\uc77c\uc120\ud0dd":r["\ud30c\uc77c\uc120\ud0dd"],public_writer_setting:i["\uc791\uc131\uc790 \uacf5\uac1c \uc124\uc815"],public_writer:i["\uc791\uc131\uc790 \uacf5\uac1c"]},S=t.View.extend({el:"#content",events:{"click #btn-add-authUsers":"showOrgSlider","click .authorizedUser .ic_del":"onRemoveAuthUserBtnClicked","click #removeAllAuthUser":"onRemoveAllAuthUserBtnClicked","dragover #dropZone":"_dragOver","dragleave #dropZone":"_dragLeave","drop #dropZone":"_drop"},unbindEvent:function(){this.$el.off("keyup","#feedContent"),this.$el.off("click","input[id=write_noti]"),this.$el.off("click",".editor .btn_temp_list"),this.$el.off("click",'span.btn_major[data-btntype="saveBbs"]'),this.$el.off("click",'span.btn_minor[data-btntype="tmpSave"]'),this.$el.off("click","span.ic_del"),this.$el.off("change","select#select_board"),this.$el.off("change","select#dept_select"),this.$el.off("click","span.ic_link_up"),this.$el.off("click","div#classicLinkWrap span.txt"),this.$el.off("click","input[id=link_img_delete]"),this.$el.off("click","input[id=link_description_delete]"),this.$el.off("click","li.url span.ic_del"),this.$el.off("click","span[id=feedWrite]"),this.$el.off("click","input[id=post_stream_mail_noti]"),this.$el.off("click","input[id=post_stream_push_noti]"),this.$el.off("click","input[id=post_classic_mail_noti]"),this.$el.off("click","input[id=post_classic_push_noti]"),this.$el.off("keyup","#feedContent"),this.$el.off("keyup","#subject"),this.$el.off("change","#header_list"),this.$el.off("click","input[name=writeSecret]")},bindEvent:function(){this.$el.on("keyup","#feedContent",e.proxy(this.streamKeyCheck,this)),this.$el.on("click","input[id=write_noti]",e.proxy(this.notiCheck,this)),this.$el.on("click",".editor .btn_temp_list",e.proxy(this.tempList,this)),this.$el.on("click",'span.btn_major[data-btntype="saveBbs"]',e.proxy(this.saveBbs,this)),this.$el.on("click",'span.btn_minor[data-btntype="tmpSave"]',e.proxy(this.tmpSave,this)),this.$el.on("click","span.ic_del",e.proxy(this.attachDelete,this)),this.$el.on("change","select#select_board",e.proxy(this.setWriteForm,this)),this.$el.on("change","select#dept_select",e.proxy(this.setWriteForm,this)),this.$el.on("click","span.ic_link_up",e.proxy(this.linkShow,this)),this.$el.on("click","div#classicLinkWrap span.txt",e.proxy(this.linkInsert,this)),this.$el.on("click","input[id=link_img_delete]",e.proxy(this.linkImageDelete,this)),this.$el.on("click","input[id=link_description_delete]",e.proxy(this.linkDescriptionDelete,this)),this.$el.on("click","li.url span.ic_del",e.proxy(this.linkDelete,this)),this.$el.on("click","span[id=feedWrite]",e.proxy(this.feedWrite,this)),this.$el.on("click","input[id=post_stream_mail_noti]",e.proxy(this.streamWriteNoti,this)),this.$el.on("click","input[id=post_stream_push_noti]",e.proxy(this.streamWriteNoti,this)),this.$el.on("click","input[id=post_classic_mail_noti]",e.proxy(this.streamWriteNoti,this)),this.$el.on("click","input[id=post_classic_push_noti]",e.proxy(this.streamWriteNoti,this)),this.$el.on("keyup","#feedContent",e.proxy(this.expandTextarea,this)),this.$el.on("keyup","#subject",e.proxy(this.subjectKeyup,this)),this.$el.on("change","#header_list",e.proxy(this.headerListChange,this)),this.$el.on("click","input[name=writeSecret]",e.proxy(this.writeSecret,this))},render:function(t){this.unbindEvent(),t=t?t:{},t.id="#deptList",t.boardList=!0,t.isCommunity=t.communityId?!0:!1,this.isCommunity=t.isCommunity,this.communityId=t.communityId||"",this.deptId=t.deptId||"",this.boardId=t.boardId||"",this.postId=t.postId||"",this.boardType="",this.type=t.type||"",this.postAuthorizedUsers=[],this.isSaaS=GO.session().brandName=="DO_SAAS",this.totalAttachSize=0,this.totalAttachCount=0,this.boardModel={};var n=this.isSaaS||GO.config("attachNumberLimit");if(n){var o=GO.config("attachSizeLimit")?parseInt(GO.config("maxAttachSize")):parseInt(GO.config("commonAttachConfig").maxAttachSize),u=GO.config("attachNumberLimit")?parseInt(GO.config("maxAttachNumber")):parseInt(GO.config("commonAttachConfig").maxAttachNumber),a={"\ucca8\ubd80\ud30c\uc77c 1\uac1c\uc758 \ucd5c\ub300 \uc6a9\ub7c9\uc740 NNN MB \uc774\uba70 \ucd5c\ub300 N\uac1c \uae4c\uc9c0 \ub4f1\ub85d \uac00\ub2a5\ud569\ub2c8\ub2e4":GO.i18n(r["\ucca8\ubd80\ud30c\uc77c 1\uac1c\uc758 \ucd5c\ub300 \uc6a9\ub7c9\uc740 {{size}} MB \uc774\uba70 \ucd5c\ub300 {{number}} \uac1c \uae4c\uc9c0 \ub4f1\ub85d \uac00\ub2a5\ud569\ub2c8\ub2e4"],{size:o,number:u})};E=_.extend(E,a)}this.$el.html(s({lang:E,boardLang:i,commonLang:r,isReply:t.type=="reply"?!0:!1,isAttachNumberToolTip:n,isEditMode:t.postId&&t.type=="edit"||!1})),h.render({el:".content_top",dataset:{name:E.post_write}}),d.render(t),this.deptId&&!this.$el.find('#dept_select option[value="'+this.deptId+'"]').length?this.setBoardTargetLowRank():(this.setCurrentBoard(),this.changeBoardList()),this.initWriteForm(),this.setTmpListCnt(),e("#side p.title").removeClass("on"),this.boardId&&(this.boardModel=g.get(this.boardId).toJSON(),this.boardModel.anonymFlag&&e("#stickableOption").hide(),this.boardModel.notificationFlag&&this.changeNotiStatus(!0)),t.type=="edit"&&this.changeNotiStatus(!1),this.setNotiMarkup(),this.bindEvent()},_dragOver:function(t){t.preventDefault(),t.stopPropagation(),t.originalEvent.dataTransfer.dropEffect="move",e("#dropZone").addClass("drag_file")},_dragLeave:function(t){t.preventDefault(),t.stopPropagation(),e("#dropZone").removeClass("drag_file")},_drop:function(e){this._dragLeave(e)},remove:function(){this.$el.empty(),this.undelegateEvents()},streamKeyCheck:function(e){e.shiftKey&&e.keyCode==13&&this.feedWrite()},writeSecret:function(t){var n=this,r=e(t.currentTarget);r.val()!="OPEN"&&e("input:checkbox[id='post_stream_push_noti']").attr("checked",!1),n.setPostAuthUsersMarkup(),n.setNotiMarkup()},subjectKeyup:function(){this.$el.find("#subject").removeClass("error").parent().siblings().remove()},headerListChange:function(){this.$el.find("#subject").removeClass("error").parent().siblings().remove()},changeNotiStatus:function(t,n){n||(this.boardType=="STREAM"?n=e("#post_stream_push_noti"):n=e("#post_classic_push_noti")),n.prop("checked",t);var r=n.attr("id");t?(n.siblings("label").parent().removeClass("action_off").addClass("action_on"),r.indexOf("mail")>0&&e("div #mail_push_desc").show()):(n.siblings("label").parent().removeClass("action_on").addClass("action_off"),r.indexOf("mail")>0&&e("div #mail_push_desc").hide())},changeBoardList:function(){var t=e("#select_board option:selected"),n=t.val();if(n){var r=g.get(n),i=r.get("anonymFlag"),s=r.get("availableAnonymousWriterOptionInPost");i?(e("#stickableOption").hide(),e("#streamAlimpOption").hide(),s?e("#publicWriterSettingPart").show():e("#publicWriterSettingPart").hide()):(e("#stickableOption").show(),e("#streamAlimpOption").show(),e("#publicWriterSettingPart").hide()),this.boardModel=r.toJSON(),this.initAuthorizedUser(),this.setNotiMarkup(),this.setPostAuthUsersMarkup(),this.changeNotiStatus(this.boardModel.notificationFlag)}if(t.attr("data-headerFlag")=="true"){var o=y.getHeaderList({boardId:n}).toJSON(),u=l({dataset:o,defaultSelect:E.header_default,selectId:"header_list",selectClass:"article_head"});e("#headerList").show(),e("#headerList").html(u)}else e("#headerList").html(""),e("#headerList").hide()},expandTextarea:function(e){GO.util.textAreaExpand(e)},streamWriteNoti:function(e){this.changeNoti(e)},changeNoti:function(t){var n=e(t.target);this.changeNotiStatus(n.is(":checked"),n),this.boardModel.notificationFlag&&(this.boardType=="STREAM"?!e("#post_stream_mail_noti").is(":checked")&&!e("#post_stream_push_noti").is(":checked")&&(e.goError(E.alim_alert),this.changeNotiStatus(!0,e("#post_stream_push_noti"))):!e("#post_classic_mail_noti").is(":checked")&&!e("#post_classic_push_noti").is(":checked")&&(e.goError(E.alim_alert),this.changeNotiStatus(!0,e("#post_classic_push_noti"))))},feedWrite:function(){if(e("#progressbar").length>0)return e.goMessage(r["\ud604\uc7ac \ud30c\uc77c \uc5c5\ub85c\ub4dc \uc911\uc785\ub2c8\ub2e4."]),!1;var t=this,i=e("#post_stream_mail_noti").is(":checked"),s=e("#post_stream_push_noti").is(":checked"),o=e("#feedContent").val(),u=[],a=e("#optionStreamDisplay").find("li[data-tmpname]");if(e.trim(o)==""||o==E.input_placeholder){e("#feedContent").focus(),e.goError(E.alert_content);return}a.each(function(){u.push({path:e(this).attr("data-tmpname"),name:e(this).attr("data-name"),hostId:e(this).attr("data-hostid"),size:e(this).attr("data-size")})});var f=e("#metaWrap li"),l=[];if(f.length>0){var c=e("#metaWrap a.url_type").html(),h=this.$("#link_img_delete").is(":checked")?null:e("#metaWrap .thumb img").attr("src"),p=e("#metaWrap a.url_type").attr("data-video"),d=e("#metaWrap .title").html(),v=this.$("#link_description_delete").is(":checked")?null:e("#metaWrap .meta_contents").html();l.push({url:c,title:d,description:v,imageSrc:h,videoSrc:p})}var g=e("#select_board option:selected").val();this.writemodel=new m,GO.EventEmitter.trigger("common","layout:setOverlay",!0),this.writemodel.set({boardId:g,postfId:""},{silent:!0}),this.writemodel.save({content:o,status:"OPEN",notiMailFlag:i,notiPushFlag:s,attaches:u,links:l},{success:function(){GO.EventEmitter.trigger("common","layout:clearOverlay",!0),GO.EventEmitter.trigger("board","change:boardInfo",!0),t.isCommunity?(n.router.navigate("community/"+t.communityId+"/board/"+g,!0),GO.EventEmitter.trigger("community","changed:lastPostedAt",g)):(n.router.navigate("board/"+g,!0),GO.EventEmitter.trigger("board","changed:lastPostedAt",g))},error:function(t,n){GO.EventEmitter.trigger("common","layout:clearOverlay",!0);var r=JSON.parse(n.responseText);r.message?e.goMessage(r.message):e.goMessage(E.alert_fail)}})},linkDelete:function(t){var n=e(t.currentTarget);e("#metaWrap").children().remove(),e("#classicLinkWrap").css("display","none"),n.parents("ul").parent().css("display","none"),e("#optionStreamDisplay").find("li").length<1&&(e("#optionStreamDisplay").removeClass("option_display"),e("#optionStreamDisplay").css("height","1px"))},linkDescriptionDelete:function(t){var n=e(t.target);n.is(":checked")?e("#metaWrap .meta_contents").hide():e("#metaWrap .meta_contents").show()},linkImageDelete:function(t){var n=e(t.target);n.is(":checked")?e("#metaWrap .thumb").hide():e("#metaWrap .thumb").show()},linkInsert:function(){var t=e("#select_board option:selected").val(),n=encodeURIComponent(e("#linkUrl").val()),r=GO.contextRoot+"api/board/"+t+"/html/parser?url="+n;e.go(r,"",{qryType:"GET",contentType:"application/json",responseFn:function(t){if(t.code==200){var n=f({dataset:t.data,lang:E});e("#metaWrap").parent().css("display",""),e("#metaWrap").html(n),e("#linkUrl").val("")}}})},linkShow:function(t){e("#optionStreamDisplay").addClass("option_display").css("height","auto"),e("#classicLinkWrap").show(),e("#linkUrl").focus()},initWriteForm:function(t){e("textarea[placeholder]").placeholder();var n=e("#select_board option:selected");this.boardType==""&&(this.boardType=n.attr("data-bbstype")),n.attr("data-bbstype")=="STREAM"?(window.oEditors=[],this.boardType="STREAM",e("#classicWriteWrap").hide(),e("#classicWriteSubmitWrap").hide(),e("#feedWriteWrap").show(),this.initStreamUpload("#steam_file_upload")):(this.boardType="CLASSIC",e("#classicWriteWrap").show(),e("#classicWriteSubmitWrap").show(),e("#feedWriteWrap").hide(),this.initGOWebEditor(),this.initFileUpload()),this.setViewedTotalAttachSize()},setStreamFrom:function(){this.boardType="STREAM",e("#classicWriteWrap").hide(),e("#classicWriteSubmitWrap").hide(),e("#feedWriteWrap").show(),window.oEditors=[],this.initStreamUpload("#steam_file_upload"),e("#subject").val("");var t=e("#dept_select option:selected").attr("data-ownertype");console.log("setStreamFrom deptType="+t),t=="Company"?e("#streamAlimpOption").hide():e("#streamAlimpOption").show()},setClassicForm:function(){this.boardType="CLASSIC",e("#classicWriteWrap").show(),e("#classicWriteSubmitWrap").show(),e("#feedWriteWrap").hide(),e("#editor").data("plugin_goWebEditor")||(e(".editor iframe").remove(),this.initGOWebEditor()),this.initFileUpload(),e("#feedContent").val("")},setWriteForm:function(t){var n=this,r=e("#select_board option:selected"),i=function(){n.setCurrentBoard(),r.attr("data-bbstype")=="STREAM"?n.setStreamFrom():n.setClassicForm(),n.changeBoardList()};this.boardType!=r.attr("data-bbstype")?e.goPopup({title:E.post_write,message:E.board_type_change,modal:!0,buttons:[{btext:E.confirm,btype:"caution",callback:i},{btext:E.cancel,btype:"normal",callback:function(){n.$el.find("#select_board").val(n.$el.find("input[name=currentBoard]").val())}}]}):this.changeBoardList()},attachDelete:function(t){e(t.target).parents("li").first().remove(),e("#optionStreamDisplay").find("li").length<1&&(e("#optionStreamDisplay").removeClass("option_display"),e("#optionStreamDisplay").css("height","1px")),this.setViewedTotalAttachSize()},initFileUpload:function(){var t=this,i={el:"#swfupload-control",context_root:GO.contextRoot,button_title:E["\ud30c\uc77c\uc120\ud0dd"],button_text:"<span class='txt'>"+E["\ud30c\uc77c\uc120\ud0dd"]+"</span>",url:"api/file?GOSSOcookie="+e.cookie("GOSSOcookie"),textTmpl:["<span class='btn_file''>","{text}","<input type='file' name='file' title='{title}' multiple='' accept={accept} />","</span>"].join(""),dropZone:"#dropZone",progressEl:"div.progress"},s=GO.config("attachSizeLimit")?parseInt(GO.config("maxAttachSize")):parseInt(GO.config("commonAttachConfig").maxAttachSize),o=s*1024*1024,u=GO.config("attachNumberLimit")?parseInt(GO.config("maxAttachNumber")):parseInt(GO.config("commonAttachConfig").maxAttachNumber);(new b(i)).queue(function(e,t){}).start(function(i,a){if(!GO.config("attachFileUpload"))return e.goAlert(r["\ud30c\uc77c\ucca8\ubd80\uc6a9\ub7c9\ucd08\uacfc"]),t.$("#dropZone").removeClass("drag_file"),!1;if(GO.config("excludeExtension")!=""){var f=e.inArray(a.type.substr(1).toLowerCase(),GO.config("excludeExtension").split(","));if(f>=0)return e.goMessage(n.i18n(E.alert_exclude_extension,"arg1",GO.config("excludeExtension"))),t.$("#dropZone").removeClass("drag_file"),!1}if(t.isSaaS||GO.config("attachSizeLimit")){if(o<a.size)return e.goMessage(n.i18n(E.alert_max_attach_size,"arg1",s)),t.$("#dropZone").removeClass("drag_file"),!1;t.totalAttachSize+=a.size}if(t.isSaaS||GO.config("attachNumberLimit")){var l=e("#imgWrap").find("li").length+e("#fileWrap").find("li").length+t.totalAttachCount+1;if(u<l)return e.goMessage(n.i18n(E.alert_max_attach_cnt,"arg1",u)),t.$("#dropZone").removeClass("drag_file"),!1;t.totalAttachCount++}}).progress(function(e,t){}).success(function(n,r,i){if(GO.util.fileUploadErrorCheck(r))i.find(".item_file").append("<strong class='caution'>"+GO.util.serverMessage(r)+"</strong>"),i.addClass("attachError");else if(GO.util.isFileSizeZero(r))return e.goAlert(GO.util.serverMessage(r)),!1;var s=r.data.hostId,o=r.data.fileSize,u=GO.util.getHumanizedFileSize(o),a=r.data.fileExt,f=r.data.fileName,l=r.data.filePath;i.attr("data-size",o),i.attr("data-name",f),i.attr("data-tmpname",l),i.attr("data-hostid",s),GO.util.isImage(a)?(i.find(".item_image").append("<span class='name'>"+f+"</span>"+"<span class='size'>("+u+")</span>"),t.$("#imgWrap").append(i)):t.$("#fileWrap").append(i),t.setViewedTotalAttachSize(),t.resetAttachSizeAndCount()}).complete(function(e,t){}).error(function(n,i){i.jqXHR&&(i.jqXHR.statusText=="abort"?e.goAlert(r["\ucde8\uc18c\ub418\uc5c8\uc2b5\ub2c8\ub2e4."]):e.goAlert(r["\uc5c5\ub85c\ub4dc\uc5d0 \uc2e4\ud328\ud558\uc600\uc2b5\ub2c8\ub2e4."]),t.resetAttachSizeAndCount())})},initStreamUpload:function(t){var i=this,s=E.file_attach;options={el:t,context_root:GO.contextRoot,url:"api/file?GOSSOcookie="+e.cookie("GOSSOcookie"),mode:"IMAGE",progressEl:"#progressBarWrap"},(new b(options)).queue(function(e,t){}).start(function(t,i){if(!GO.config("attachFileUpload"))return e.goAlert(r["\ud30c\uc77c\ucca8\ubd80\uc6a9\ub7c9\ucd08\uacfc"]),!1;e("input[name=disabled]:checked",this).length&&t.preventDefault();if(GO.config("excludeExtension")!=""){var s=e.inArray(i.type.substr(1).toLowerCase(),GO.config("excludeExtension").split(","));if(s>=0)return e.goMessage(n.i18n(E.alert_exclude_extension,"arg1",GO.config("excludeExtension"))),!1}if(GO.config("attachSizeLimit")){var o=i.size/1024/1024,u=GO.config("maxAttachSize");if(u<o)return e.goMessage(n.i18n(E.alert_max_attach_size,"arg1",u)),!1}if(GO.config("attachNumberLimit")){var a=e("#feedImgWrap").find("li").length+e("#feedFileWrap").find("li").length,f=GO.config("maxAttachNumber");if(f<=a)return e.goMessage(n.i18n(E.alert_max_attach_cnt,"arg1",f)),!1}}).progress(function(e,t){}).success(function(t,n,r){var i="",s="";if(GO.util.fileUploadErrorCheck(n))i="<strong class='caution'>"+GO.util.serverMessage(n)+"</strong>",s="attachError";else if(GO.util.isFileSizeZero(n))return e.goAlert(GO.util.serverMessage(n)),!1;e("#optionStreamDisplay").hasClass("option_display")||(e("#optionStreamDisplay").addClass("option_display"),e("#optionStreamDisplay").css("height","auto"));var o=n.data,u=o.filePath,a=o.fileName,f=o.fileExt,l=GO.util.getHumanizedFileSize(o.fileSize),c=o.thumbnail,h=o.hostId,p="";if(GO.util.isImage(f))p='<li class="'+s+'" data-tmpname="'+u+'" data-name="'+a+'" data-hostid="'+h+'">'+'<span class="item_image">'+'<span class="thumb"><img src="'+c+'" alt="'+a+'" /></span>'+'<span class="name">'+a+"</span>"+'<span class="size">('+l+")</span>"+"</span>"+'<span class="btn_wrap">'+'<span class="ic_classic ic_del" title="'+E.del+'"></span>'+"</span>"+"</li>",e("#feedImgWrap").parent().css("display",""),e("#feedImgWrap").append(p);else{var d="def";GO.util.fileExtentionCheck(f)&&(d=f),p='<li class="'+s+'" data-tmpname="'+u+'" data-name="'+a+'" data-hostid="'+h+'">'+'<span class="item_file">'+'<span class="ic_file ic_'+d+'"></span>'+'<span class="name">'+a+"</span>"+'<span class="size">('+l+")</span>"+'<span class="btn_bdr">'+'<span class="ic_classic ic_del" title="'+E.del+'"></span>'+"</span>"+i+"</span>"+"</li>",e("#feedFileWrap").parent().css("display",""),e("#feedFileWrap").append(p)}e("#progressBarWrap").hide()}).complete(function(e,t){console.info(t)}).error(function(e,t){console.info(t)})},setBoardTargetLowRank:function(){var t=this;this.$el.find("#deptList select").attr("disabled","disabled").empty(),e.go(GO.contextRoot+"api/board/"+this.boardId,{},{qryType:"get",responseFn:function(r){if(r.data){var i=e(r.data.owners).map(function(e,t){if(t.ownerShip=="MASTER")return t}).get();i.length?t.$el.find("#dept_select").html('<option value="'+i[0].ownerId+'" selected>'+i[0].ownerInfo+"</option>"):t.$el.find("#dept_select").hide(),t.$el.find("#select_board").html('<option value="'+r.data.id+'" selected data-headerFlag="'+r.data.headerFlag+'" data-headerRequiredFlag="'+r.data.headerRequiredFlag+'">'+r.data.name+"</option>"),t.changeBoardList()}else n.router.navigate(t.isCommunity?"community":"board/post/write",{replace:!0,trigger:!0})},error:function(){n.router.navigate(t.isCommunity?"community":"board",{replace:!0,trigger:!0})}})},setCurrentBoard:function(){var e=this.$el.find("#select_board").val();this.$el.find("input[name=currentBoard]").val(e)},setWriteData:function(t){var n=this;this.writeModel=new m({boardId:t.boardId,postId:t.postId,readOnly:!0,isStream:this.boardType=="STREAM"}),this.writeModel.setURL(),this.writeModel.fetch({async:!1}),t.type=="edit"&&!this.writeModel.checkEditAuth(GO.session().id)&&GO.util.error("403",{msgCode:"400-board"});var r=this.writeModel.toJSON(),i=r.content;r.contentType=="TEXT"&&(i=GO.util.convertRichText(i)),r.header&&e("#header_list").val(r.header.id),r.publicWriter&&t.type=="edit"&&e("#isPublicWriter").attr("checked",!0),t.type=="reply"&&(e("#publicSettingPart").hide(),e("#stickableOption").hide(),i='<p><br></p><blockquote style="PADDING-RIGHT: 0px; PADDING-LEFT: 5px; MARGIN-LEFT: 5px; BORDER-LEFT: #000000 2px solid; MARGIN-RIGHT: 0px">--- Original Message ---<br/>'+i+"<br/><br/>"+"</blockquote>",r.titleParse="RE : "+r.title,this.setNotiMarkup()),e("#subject").val(GO.util.unescapeHtml(r.titleParse||r.title));if(t.type=="edit"){this.writeOptionSetting(r);var s=[],o=[];e.each(r.attaches,function(e,t){t.thumbSmall?s.push(t):o.push(t)});var f=function(){var e="def";return GO.util.fileExtentionCheck(this.extention)&&(e=this.extention),e},l=function(){var e=this.size,t=GO.util.getHumanizedFileSize(e);return t};this.$el.find("#fileWrap").html(u({dataset:o,checkFileType:f,sizeCal:l})),this.$el.find("#imgWrap").html(a({dataset:s,sizeCal:l})),this.setViewedTotalAttachSize()}var c=this.writeModel.get("authorizedUsers");_.forEach(c,function(e){n.addAuthorizedUser(e.userId,e.displayName)}),this.setPostAuthUsersMarkup(),GO.Editor.getInstance("editor").setContent(GO.util.convertMSWordTag(i))},writeOptionSetting:function(t){if(t.id!=t.thread)e("#writeOptionWrap").hide();else if(t.repliesCount>0)e(":input:radio[name=writeSecret]").filter("input[value="+t.status+"]").attr("checked","checked"),e("#publicSettingPart").hide();else{e(":input:radio[name=writeSecret]").filter("input[value="+t.status+"]").attr("checked","checked");if(t.hasOwnProperty("fromDate")){var n=t.fromDate,r=t.toDate;e("#write_noti").attr("checked",!0),e("#write_noti").parent().removeClass("action_off"),e("#notice_term_part").show(),e("#stickyStartDate").val(GO.util.shortDateCalenderFormat(n)),e("#stickyEndDate").val(GO.util.shortDateCalenderFormat(r)),this.datePickerInit()}}},editorAfterLoad:function(){(this.type=="edit"||this.type=="reply")&&this.setWriteData({boardId:this.boardId,postId:this.postId,type:this.type})},initGOWebEditor:function(){e("#editor").goWebEditor({contextRoot:GO.config("contextRoot"),lang:GO.session("locale"),theme:"detail",onLoad:_.bind(this.editorAfterLoad,this)})},setTmpListCnt:function(){var t=new v;t.fetch({success:function(t){e("#tmpCnt").html(t.toJSON().length)},error:function(e,t){console.log(t)}})},saveBbs:function(){if(e("#progressbarWrite").length>0)return e.goError(r["\ud604\uc7ac \ud30c\uc77c \uc5c5\ub85c\ub4dc \uc911\uc785\ub2c8\ub2e4."]),!1;var t=GO.Editor.getInstance("editor");if(!t.validate())return e.goError(r["\ub9c8\uc784 \uc0ac\uc774\uc988 \ucd08\uacfc"]),!1;var i=t.getContent(),s=e("#subject").val(),o=e("#select_board option:selected"),u=this;if(e.trim(s)==""){e.goError(E.no_title,e("#subject").parent()),this.$el.find("#subject").focus().addClass("error");return}this.$el.find("#subject").removeClass("error").parent().siblings("#goMessage").remove();if(o.attr("data-headerFlag")=="true"&&o.attr("data-headerRequiredflag")=="true"&&e("#header_list").val()==0){e.goError(E.no_header,e("#subject").parent()),this.$el.find("#header_list").focus();return}this.$el.find("#subject").removeClass("error").parent().siblings("#goMessage").remove();if(!e.goValidation.isCheckLength(2,100,s)){e.goError(n.i18n(E.alert_length,{arg1:"2",arg2:"100"}),e("#subject").parent()),e("#subject").focus().addClass("error");return}this.$el.find("#subject").removeClass("error").parent().siblings("#goMessage").remove();if(!GO.util.isEditorWriting()){e.goMessage(E.alert_content);return}var a=[],f=o.val();if(e.trim(f).length==0){e.goAlert(E.no_selected_board);return}var l=e("#writePostId").val(),c=e("#writeType").val(),h="PUT";c!="edit"&&(h="POST");var p={title:s,content:i,contentType:"HTML",modifyPCWebPlatform:!0},d=e("#header_list option").length;d>0&&(p.headerId=e("#header_list option:selected").val());var v=e("#attachPart").find("li:not(.attachError)"),g;v.each(function(){g={},e(this).attr("data-tmpname")&&(g.path=e(this).attr("data-tmpname")),e(this).attr("data-name")&&(g.name=e(this).attr("data-name")),e(this).attr("data-id")&&(g.id=e(this).attr("data-id")),e(this).attr("data-hostid")&&(g.hostId=e(this).attr("data-hostid")),e(this).attr("data-clipboard")&&(g.clipboard=e(this).attr("data-clipboard")),a.push(g)}),a.length>0&&(p.attaches=a),e("#publicSettingPart").is(":visible")&&(p.status=e('input:radio[name="writeSecret"]:checked').val()),p.authorizedUsers=e("#authorizedUserList").is(":visible")?this.postAuthorizedUsers:[];if(e("#stickableOption").is(":visible"))if(e("#write_noti").is(":checked"))try{p.fromDate=GO.util.toISO8601(e("#stickyStartDate").val()),p.toDate=GO.util.searchEndDate(e("#stickyEndDate").val()),p.stickable=!0,e("#write_noti_order").is(":checked")&&(p.noticeSortable=!0)}catch(y){e.goMessage(E.alert_date_format);return}else p.stickable=!1;GO.EventEmitter.trigger("common","layout:setOverlay",!0);var b=!1,w=!1;e("#alimOption").is(":visible")&&(b=e("#post_classic_mail_noti").is(":checked"),w=e("#post_classic_push_noti").is(":checked"));var S=!1;e("#publicWriterSettingPart").is(":visible")&&(S=e("#isPublicWriter").is(":checked")),this.writemodel=new m,this.writemodel.set({boardId:f,notiMailFlag:b,notiPushFlag:w,postId:l,writeType:c,publicWriter:S},{silent:!0}),this.writemodel.save(p,{type:h,success:function(t){var r=e("div.editor a.btn_temp_list").attr("data-tmpid");r&&u.deleteSavedTmpPost(r),GO.EventEmitter.trigger("common","layout:clearOverlay",!0),u.isCommunity?(n.router.navigate("community/"+u.communityId+"/board/"+f+"/post/"+t.id,!0),GO.EventEmitter.trigger("community","changed:lastPostedAt",f)):(n.router.navigate("board/"+f+"/post/"+t.id,!0),GO.EventEmitter.trigger("board","changed:lastPostedAt",f))},error:function(t,n){GO.EventEmitter.trigger("common","layout:clearOverlay",!0);var r=JSON.parse(n.responseText);r.message?e.goMessage(r.message):e.goMessage(E.alert_fail)}})},tmpSave:function(){var t=GO.Editor.getInstance("editor");if(!t.validate())return console.log("invalid"),!1;var n=t.getContent();if(e.trim(n)==""||e.trim(n)=="<br>"){e.goError(E.no_content);return}var r=this,i=GO.contextRoot+"api/clipboard",s=e("#subject").val();e.trim(s)==""&&(s=E.no_subject);var o={title:s,content:n,attaches:this.getAttachData()};e.go(i,JSON.stringify(o),{qryType:"POST",contentType:"application/json",responseFn:function(t){if(t.code==200){var n=e("div.editor a.btn_temp_list").attr("data-tmpid");n?r.deleteSavedTmpPost(n):r.setTmpListCnt(),r.fetchAttachData(t.data.attaches),GO.Editor.getInstance("editor").setContent(t.data.content),e.goMessage(E.tmpSave_success),e("div.editor a.btn_temp_list").attr("data-tmpid",t.data.id)}}})},fetchAttachData:function(t){var n="";e("#fileWrap").children("li").remove(),e("#imgWrap").children("li").remove(),_.each(t,function(t){var r=GO.util.getHumanizedFileSize(t.size);if(GO.util.isImage(t.extention))n='<li class="" data-tmpname="'+t.path+'" data-name="'+t.name+'" data-hostid="'+"unknown"+'" data-id="'+t.id+'" data-path="'+t.path+'" data-size="'+t.size+'" data-clipboard="true">'+'<span class="item_image">'+'<span class="thumb">'+'<img src="'+t.thumbSmall+'" alt="'+t.name+'" />'+"</span>"+'<span class="name">'+t.name+"</span>"+'<span class="size">('+r+")</span>"+"</span>"+'<span class="btn_wrap">'+'<span class="ic_classic ic_del"></span>'+"</span>"+"</li>",e("#imgWrap").append(n);else{var i="def";GO.util.fileExtentionCheck(t.extention)&&(i=t.extention),n='<li class="" data-tmpname="'+t.path+'" data-name="'+t.name+'" data-hostid="'+"unknown"+'" data-id="'+t.id+'" data-path="'+t.path+'" data-size="'+t.size+'" data-clipboard="true">'+'<span class="item_file">'+'<span class="ic_file ic_'+i+'"></span>'+'<span class="name">'+t.name+"</span>"+'<span class="size">('+r+")</span>"+'<span class="btn_bdr">'+'<span class="ic_classic ic_del"></span>'+"</span>"+"</span>"+"</li>",e("#fileWrap").append(n)}},this)},getAttachData:function(){var t=e("#attachPart").find("li[data-name]"),n=[];return t.each(function(){attachOpt={},e(this).attr("data-name")&&(attachOpt.name=e(this).attr("data-name")),e(this).attr("data-id")&&(attachOpt.id=e(this).attr("data-id")),e(this).attr("data-clipboard")&&(attachOpt.clipboard=e(this).attr("data-clipboard")),e(this).attr("data-size")&&(attachOpt.size=e(this).attr("data-size")),attachOpt.path=e(this).attr("data-path")?e(this).attr("data-path"):e(this).attr("data-tmpname"),n.push(attachOpt)}),n},tempList:function(){e.goPopup({header:E.tmp_posts,width:400,pclass:"layer_normal layer_temporary_save",contents:"",buttons:[{btext:E.confirm,btype:"confirm",callback:function(){}}]}),c.render()},clearSticky:function(){e("#stickyStartDate").html(""),e("#stickyEndDate").html("")},notiCheck:function(t){var n=e(t.target);if(n.is(":checked")){this.clearSticky(),n.siblings("label").parent().removeClass("action_off");var r=this;e.goPopup({header:E.notice_term,width:"350px",pclass:"layer_normal layer_date_set",contents:"",modal:!0,buttons:[{btext:E.notice,btype:"confirm",callback:function(){if(e("#noticeStartDate").val()==""&&e("#noticeEndDate").val()==""&&e("input[name=noticeTerm]:radio:checked").length<1)return;try{r.setStickyDate()}catch(t){e.goMessage(E.alert_date_format);return}}}],closeCallback:function(){e("#stickyStartDate").val()==""&&(n.siblings("label").parent().addClass("action_off"),e("#write_noti").attr("checked",!1))}}),p.render()}else e.goPopup.close(),n.siblings("label").parent().addClass("action_off"),e("#notice_term_part").hide(),e("#stickyStartDate").val(""),e("#stickyEndDate").val("")},setStickyDate:function(){var t=e("input[name=noticeTerm]:radio:checked").attr("data-key"),n=e("input[name=noticeTerm]:radio:checked").attr("data-amount"),r,i,s,o;if(e("#noticeStartDate").val()!=""&&e("#noticeEndDate").val()!=""){s=e("#noticeStartDate").val(),o=e("#noticeEndDate").val();var u=/^(19|20)\d{2}\-(0[1-9]|1[012])\-(0[1-9]|[12][0-9]|3[0-1])$/;if(!u.test(s)||!u.test(o))throw new Error("invalid date format")}else r=new Date,i=new Date,s=GO.util.toISO8601(r),o=GO.util.calDate(i,t,n);var a=GO.util.shortDate(s),f=GO.util.shortDate(o);e("#notice_term_part").show(),e("#stickyStartDate").val(a),e("#stickyEndDate").val(f),this.datePickerInit()},showOrgSlider:function(t){function n(e){var t=this;e instanceof Array?_.forEach(e,function(e){t.addAuthorizedUser(e.id,e.fullName)}):this.addAuthorizedUser(e.id,e.displayName)}return e.goOrgSlide({header:i["\uc5f4\ub78c\uc790 \ucd94\uac00"],type:"node",memberTypeLabel:r["\uc5f4\ub78c\uc790"],contextRoot:GO.config("contextRoot"),callback:e.proxy(n,this),externalLang:r,isBatchAdd:!0})},datePickerInit:function(){var t=e("#stickyStartDate"),n=e("#stickyEndDate");e.datepicker.setDefaults(e.datepicker.regional[GO.config("locale")]),t.datepicker({dateFormat:"yy-mm-dd",changeMonth:!0,changeYear:!0,yearSuffix:"",onSelect:function(e){n.datepicker("option","minDate",e)}}),n.datepicker({dateFormat:"yy-mm-dd",changeMonth:!0,changeYear:!0,yearSuffix:"",onSelect:function(e){t.datepicker("option","maxDate",e)}})},deleteSavedTmpPost:function(t){var n=GO.contextRoot+"api/clipboard/"+t;e.go(n,{},{qryType:"DELETE",contentType:"application/json",responseFn:function(e){}})},addAuthorizedUser:function(e,t){var n=this;if(n.isOpenStatus()||!n.usePostAuthOption()||n.isDuplicatedAuthUser(e))return;n.postAuthorizedUsers.push({userId:e,name:t}),n.$el.find("#authorizedUserList").prepend(o({userId:e,name:t,commonLang:r})),n.setNotiMarkup()},initAuthorizedUser:function(){var e=this;_.forEach(e.postAuthorizedUsers,function(t){e.removePostAuthorizedUser(t.userId)}),e.$el.find("#authorizedUserList .authorizedUser").remove()},removePostAuthorizedUser:function(e){var t=this;t.postAuthorizedUsers=t.postAuthorizedUsers.filter(function(t){return t.userId!=e}),t.setNotiMarkup()},isDuplicatedAuthUser:function(e){return _.any(this.postAuthorizedUsers,function(t){return t.userId==e})},setNotiMarkup:function(){var e=this,t=e.type!="edit",n=!e.boardModel.anonymFlag,r=e.postAuthorizedUsers.length>0,i=e.usePostAuthOption(),s=e.isOpenStatus();s&&t&&n?e.$el.find("#alimOption").show():!s&&i&&r&&t&&n?e.$el.find("#alimOption").show():e.$el.find("#alimOption").hide()},setPostAuthUsersMarkup:function(){var e=this;e.isOpenStatus()?(e.$el.find("#authorizedUserList").closest(".option_display").hide(),e.$el.find("#publicSettingMsg").html("")):e.usePostAuthOption()?(e.$el.find("#authorizedUserList").closest(".option_display").show(),e.$el.find("#publicSettingMsg").html(i["\ube44\uacf5\uac1c\uae00 \uc5f4\ub78c\uc790 \uc124\uc815 \uc548\ub0b4\ubb38\uad6c"])):(e.$el.find("#authorizedUserList").closest(".option_display").hide(),e.$el.find("#publicSettingMsg").html(i["\u203b \ub098\uc640 \uc6b4\uc601\uc790\ub9cc \ubcfc \uc218 \uc788\ub3c4\ub85d \ube44\uacf5\uac1c\ub85c \uae00\uc744 \ub4f1\ub85d\ud569\ub2c8\ub2e4."]))},usePostAuthOption:function(){var e=this,t=e.$el.find("#publicSettingPart input:checked").val()=="OPEN",n=e.boardModel.postAuthOption;return!t&&n},isOpenStatus:function(){var e=this;return e.$el.find("#publicSettingPart input:checked").val()=="OPEN"},onRemoveAuthUserBtnClicked:function(t){var n=e(t.currentTarget).closest(".authorizedUser"),r=n.find("span").data("id");n.remove(),this.removePostAuthorizedUser(r)},onRemoveAllAuthUserBtnClicked:function(){this.initAuthorizedUser()},getViewedTotalAttachSize:function(){var t=0;return e("#fileWrap, #imgWrap").find("li").each(function(){t+=parseInt(this.getAttribute("data-size"),0)}),t},setViewedTotalAttachSize:function(){if(this.isSaaS||GO.config("attachSizeLimit")){var e=this.getViewedTotalAttachSize();this.$el.find("#total_size").html(GO.util.displayHumanizedAttachSizeStatus(e))}},resetAttachSizeAndCount:function(){if(this.isSaaS||GO.config("attachSizeLimit"))this.totalAttachSize=0,this.totalAttachCount=0}},{render:function(e){return w||(w=new S(e)),w.render(e)}});return S})}).call(this);