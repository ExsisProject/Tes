define("board/models/board_tree_node",function(require){var e=require("backbone"),t=require("when"),n=require("app"),r=require("board/models/board"),i=require("board/constants"),s=i.NODETYPE_FOLDER,o=i.NODETYPE_SEPERATOR,u=i.NODETYPE_BOARD,a=i.NODETYPE_COMPANY_SHARE,f="_share",l=i.STATUS_ACTIVE,c=i.STATUS_CLOSED,h=e.Model.extend({adminService:!1,initialize:function(e,t){var n=t||{};this.adminService=!1,_.isBoolean(n.isAdminService)&&(this.adminService=n.isAdminService)},getBoardModel:function(){return new r.Model(this.get("board"))},setBoardAttrs:function(e,t){if(!this.isBoardNode())return;var n=this.getBoardModel();n.set.apply(n,arguments),this.set("board",n.toJSON())},getNodeId:function(){return this.get("id")},getBoardId:function(){if(this.isBoardNode()||this.isCompanyShareNode())return this.getBoardModel().get("id");return},getBoardName:function(){if(!this.isBoardNode())return;return this.getBoardModel().get("name")},getNodeType:function(){return this.get("nodeType")},getNodeValue:function(){return this.get("nodeValue")},getParentId:function(){return this.get("parentId")},getSharedFlag:function(){return!1},isFolderNode:function(){return this.get("nodeType")===s},isBoardNode:function(){return this.get("nodeType")===u},isSeperatorNode:function(){return this.get("nodeType")===o},isCompanyShareNode:function(){return this.get("nodeType")===a},getCompanyNameByCompanyShares:function(){if(this.isCompanyShareNode()){var e=this.get("companyShares");return e.length>0?"("+this.get("originalCompanyName")+")":""}},isManagable:function(){return this.isBoardNode()&&this.get("actions")&&this.get("actions").managable},isPrivateBoard:function(){return this.isBoardNode()&&this.getBoardModel().isPrivateBoard()},isSharedBoard:function(){return this.isBoardNode()&&this.getSharedFlag()},isAnonymBoard:function(){return this.isBoardNode()&&this.getBoardModel().get("anonymFlag")},hasBoardNewPost:function(){return(this.isBoardNode()||this.isCompanyShareNode())&&this.getBoardModel().hasNewPost()},isHomeExposureBoard:function(){return console.log(this.getBoardModel().get("homeExposureFlag")),this.isBoardNode()&&this.getBoardModel().get("homeExposureFlag")},isDeptShared:function(){return this.get("deptSharedFlag")},hasCompanyShare:function(){return console.log("hasCompanyShare"),this.get("companyShares")?this.get("companyShares").length>0:!1},isAdminService:function(){return this.adminService}}),p=e.Collection.extend({model:h,status:null,adminService:!1,comparator:"seq",initialize:function(e,t){var n=t||{};this.companyId=null,n.hasOwnProperty("companyId")&&this.setCompanyId(n.companyId),this.status=null,n.hasOwnProperty("status")&&this.setStatus(n.status),this.adminService=!1,_.isBoolean(n.isAdminService)&&(this.adminService=n.isAdminService)},getNodes:function(e){return this.filter(function(t){var n=t.get("parentId");return e?n===e:!n})},getChildrenCount:function(e){return this.getNodes(e).length||0},hasChildren:function(e){return this.getChildrenCount(e)>0},getStatus:function(){return this.status},setStatus:function(e){this._validateStatus(e)&&(this.status=e)},getCompanyId:function(){return this.companyId},setCompanyId:function(e){this.companyId=e},createNode:function(e,n,r){var i=this,s={nodeType:e,nodeValue:n};return r&&(s.parentId=r),t.promise(function(e,t){i.create(s,{success:e,error:function(e,n){return t(n)}})})},destroyNode:function(e){var n=this,r=this.get(e);return t.promise(function(e,t){r.destroy({success:function(t){n.remove(t),e(t)},error:function(e){t()}})})},createBoardNode:function(e,t){return this.createNode(u,e,t)},createFolderNode:function(e,t){return this.createNode(s,e,t)},createSeperatorNode:function(e,t){return this.createNode(o,e,t)},findByBoardId:function(e){return this.filter(function(t){return t.isBoardNode()&&t.getBoardModel().get("id")===parseInt(e)})[0]},isAdminService:function(){return this.adminService},_validateStatus:function(e){return _.indexOf([l,c],e)>-1}});return{NODETYPE_FOLDER:s,NODETYPE_SEPERATOR:o,NODETYPE_BOARD:u,NODETYPE_COMPANY_SHARE:a,STATUS_ACTIVE:l,STATUS_CLOSED:c,Model:h,Collection:p}});