(function(){define(["app","jquery","backbone","i18n!nls/commons","i18n!board/nls/board","hgn!board/templates/mobile/m_post_attaches","GO.m.util"],function(e,t,n,r,i,s){var o=null,u={save:r["\uc800\uc7a5"],preview:r["\ubbf8\ub9ac\ubcf4\uae30"],download:r["\ub2e4\uc6b4\ub85c\ub4dc"]},a=n.View.extend({initialize:function(e){this.options=e||{},this.options.el||(this.tagName="div"),this.attaches=this.options.attaches,this.boardId=this.options.boardId,this.postId=this.options.postId,this.images=[],this.files=[]},events:{"vclick ul.feed_img a.imageview":"showImages","vclick ul.file_wrap a.filedown":"showFiles","vclick ul.file_wrap a[data-type=preview]":"preview"},render:function(){var e=this,n="length_",r=0;return t.each(this.attaches,function(t,n){n.byteSize=n.size,n.size=GO.util.getHumanizedFileSize(n.size),n.thumbSmall&&GO_config.__config__.mobileConfig.useMobilePreview?e.images.push(n):(GO.util.fileExtentionCheck(n.extention)||(n.extention="def"),e.files.push(n))}),this.$el.html(s({lang:u,hasFiles:this.files.length?!0:!1,files:this.files,useMobilePreview:GO_config.__config__.mobileConfig.useMobilePreview,useMobileSecurity:GO_config.__config__.mobileConfig.useMobileSecurity,isMobileApp:GO_config.__config__.isMobileApp,contextRoot:GO.contextRoot,hasImages:this.images.length?!0:!1,getImageClass:function(){return e.images.length<=4?n+e.images.length:e.images.length==5?n+3:e.images.length==6?n+3:n+4},midImageSize:function(){return e.images.length==1?!0:!1},smallImageSize:function(){return e.images.length>1?!0:!1},isGif:function(){return this.extention.toLowerCase()=="gif"?!0:!1},reoffsetImg:function(){return e.images.length==1?!1:"if($(this).parents('li').height() > this.height) { this.style.marginTop = ($(this).parents('li').height()-this.height)/2 + 'px'; } "},images:this.images,postId:this.postId,boardId:this.boardId})),this.$el.html()},showFiles:function(e){var n=t(e.currentTarget),r=location.protocol+"//"+window.location.host,i=GO.contextRoot+"api/board/"+n.attr("data-boardId")+"/post/"+n.attr("data-postId")+"/attaches/"+n.attr("data-id"),s=n.attr("title"),o=n.attr("data-size");return GO.util.attachFiles(r+i,s,o),!1},preview:function(e){var n=t(e.currentTarget);return GO.util.preview(n.attr("data-id")),!1},showImages:function(e){var n=[],r=0;return postImages={},$eTarget=t(e.currentTarget),selectedId=$eTarget.attr("data-id"),dataGroup=$eTarget.attr("data-group"),dataGroup&&(postImages=$eTarget.parents("ul.feed_img").find('a[data-group="'+dataGroup+'"]'),t.each(postImages,function(e,i){var s=t(i);n.push({fileName:s.attr("title"),url:GO.contextRoot+"api/board/"+s.attr("data-boardId")+"/post/"+s.attr("data-postId")+"/attaches/"+s.attr("data-id")}),s.attr("data-id")==selectedId&&(r=e)})),GO.util.attachImages(n,r),!1},resize:function(e){if(!e)return!1;var n=t.Deferred(),r=e.find(".feed_img >li[data-resize!=true]"),i=r.length;return i&&t(r).each(function(e,n){var r=t(n),s=r.find("img");s.attr("src",s.attr("data-src")),i>1&&r.attr("data-resize",!0)}),n.resolveWith(this,[this]),n}});return{render:function(e){return o=new a(e),o.render()},resize:function(e){o&&o.resize(e)},initImageView:function(e){e&&o&&(this.resize(e),e.off("vclick","ul.feed_img a.imageview"),e.off("vclick","ul.file_wrap a.filedown"),e.off("vclick","li a[data-type=preview]"),e.on("vclick","ul.feed_img a.imageview",t.proxy(o.showImages,this)),e.on("vclick","ul.file_wrap a.filedown",t.proxy(o.showFiles,this)),e.on("vclick","li a[data-type=preview]",t.proxy(o.preview,this)))}}})}).call(this);