define(["jquery","backbone","app","hgn!board/templates/board_title","i18n!board/nls/board","i18n!nls/commons","board/views/detail_search_layer","dashboard/views/search/detail_search_popup","jquery.go-sdk","jquery.go-validation","jquery.placeholder"],function(e,t,n,r,i,s,o,u){var a=null,f={favorite:s["\uc990\uaca8\ucc3e\uae30"],search_detail:s["\uc0c1\uc138\uac80\uc0c9"],search:s["\ud50c\ub808\uc774\uc2a4\ud640\ub354\uac80\uc0c9"],searchtitle:s["\uac80\uc0c9"],total:s["\uc804\uccb4"],postCount:i["\ucd1d 0\uac74"],alert_keyword:s["\uac80\uc0c9\uc5b4\ub97c \uc785\ub825\ud558\uc138\uc694."],alert_length:i["0\uc790\uc774\uc0c1 0\uc774\ud558 \uc785\ub825\ud574\uc57c\ud569\ub2c8\ub2e4."],alert_date:s["\ub0a0\uc9dc\ub97c \uc9c0\uc815\ud558\uc138\uc694."],search_result:s["\uac80\uc0c9\uacb0\uacfc"],add:i["\ucd94\uac00\ud558\uae30"],clean:i["\ud574\uc81c\ud558\uae30"],app_search:s["\uc571\uac80\uc0c9"],unified_search:s["\ud1b5\ud569\uac80\uc0c9"],detail:s["\uc0c1\uc138"]},l=t.View.extend({unbindEvent:function(){this.$el.off("click","#boardFavorite"),this.$el.off("click","#detailSearch"),this.$el.off("click","#simpleSearch"),this.$el.off("keydown","#simpleInput")},bindEvent:function(){this.$el.on("click","#boardFavorite",e.proxy(this.favoriteBoard,this)),this.$el.on("click","#detailSearch",e.proxy(this.detailSearch,this)),this.$el.on("click","#simpleSearch",e.proxy(this.simpleSearch,this)),this.$el.on("keydown","#simpleInput",e.proxy(this.simpleInputKeyEvent,this))},events:{},initialize:function(e){this.options=e||{}},detailInputKeyEvent:function(e){e.keyCode==13&&this.searchAction()},simpleInputKeyEvent:function(e){e.keyCode==13&&this.simpleSearch()},render:function(){this.unbindEvent(),this.bindEvent(),this.el=this.options.el,this.dataset=this.options.dataset,this.isCommunity=this.options.isCommunity||!1;var t=this.isCommunity;this.$el.html(r({dataset:this.dataset,"postCount?":function(){return this.dataset.hasOwnProperty("postCount")?!0:!1},"isCommunity?":function(){return this.dataset.hasOwnProperty("masterOwner")&&this.dataset.masterOwner.ownerType=="Community"},"isDepartment?":function(){return this.dataset.hasOwnProperty("masterOwner")&&this.dataset.masterOwner.ownerType=="Department"},postCountParser:function(){return n.i18n(f.postCount,"arg1",this.dataset.postCount==""?0:this.dataset.postCount)},lang:f,appSearchName:function(){return t?s["\ucee4\ubba4\ub2c8\ud2f0"]:s["\uac8c\uc2dc\ud310"]}}));if(!_.isUndefined(this.dataset.masterOwner)){var i=Hogan.compile(this.dataset.masterOwner.ownerInfo.replace(/\|/g,'<span class="part">/</span>'));this.$el.find(".from").append(i.render())}return e("input[placeholder]").placeholder(),this.el},simpleSearch:function(t){t&&t.preventDefault();var r=e("#simpleInput"),i=e.trim(e("#simpleInput").val());if(i==""){e.goError(f.alert_keyword),r.focus();return}if(!e.goValidation.isCheckLength(2,64,i)){e.goMessage(n.i18n(f.alert_length,{arg1:"2",arg2:"64"}));return}if(e.goValidation.isInValidEmailChar(i)){e.goMessage(s["\uba54\uc77c \uc0ac\uc6a9 \ubd88\uac00 \ubb38\uc790"]);return}var o=GO.util.toISO8601("1970/01/01"),u=GO.util.toISO8601(new Date),a={stype:"simple",keyword:i,fromDate:o,toDate:u,isCommunity:this.isCommunity,searchType:"simple"},l=e("#searchType").val();l=="appSearch"?n.router.navigate((this.isCommunity?"community":"board")+"/search?"+this._serializeObj(a),!0):(a.offset=5,a.page=0,a.searchTerm="all",delete a.searchType,n.router.navigate("unified/search?"+this._serializeObj(a),!0))},detailSearch:function(t){var n=e("#searchType").val();if(n!="appSearch"){this.detailPopup(t);return}var r=e(t.currentTarget).offset(),i=this;e.goSearch({header:f.search_detail,modal:!0,offset:{top:parseInt(r.top+30,10),right:7},callback:function(){i.searchAction()}}),o.render({isCommunity:this.isCommunity,callback:this.searchAction})},searchAction:function(t){t&&t.preventDetail();var r=e.trim(e("#stext").val()),i=e.trim(e("#detail_writer").val()),o=e(".go_popup #select_board"),u=[],a=[];if(r==""&&i==""){e.goError(f.alert_keyword,e("#searchMessage"));return}e.goError("",e("#searchMessage"),!0);var l=[i,r];for(var c=0;c<l.length;c++)if(l[c]!=""){if(!e.goValidation.isCheckLength(2,64,l[c])){e.goError(n.i18n(f.alert_length,{arg1:"2",arg2:"64"}));return}if(e.goValidation.isInValidEmailChar(l[c])){e.goMessage(s["\uba54\uc77c \uc0ac\uc6a9 \ubd88\uac00 \ubb38\uc790"]);return}}var h=!1;e("input[type=checkbox]").each(function(){this.checked&&(h=!0)});if(r&&!h){e.goError(s["\uac80\uc0c9\uc5b4 \uad6c\ubd84\uc744 \uc120\ud0dd\ud574\uc8fc\uc138\uc694."]);return}o.val()=="all"?e.each(e(".go_popup #select_board option[data-bbstype]"),function(e,t){u.push(t.value),a.push(t.text)}):(u.push(o.val()),a.push(o.val()?o.children("option:selected").text():""));var p=e('input:radio[name="searchType"]:checked').val(),d,v,m,g,y=0,b=!1;if(p=="detail_term_all"){var w=GO.util.shortDate(new Date);d=GO.util.toISO8601("1970/01/01"),v=GO.util.searchEndDate(w),b=!0}else if(p=="detail_term_custom"){m=e("#searchStartDate"),g=e("#searchEndDate"),m.val()?m.removeClass("error"):(y++,e.goError(f.alert_date,m.parents(".wrap_dateselect")),m.addClass("error")),g.val()?g.removeClass("error"):(y++,e.goError(f.alert_date,g.parents(".wrap_dateselect")),g.addClass("error"));if(y>0)return!1;d=GO.util.toISO8601(m.val()),v=GO.util.searchEndDate(g.val())}else{var w=GO.util.shortDate(new Date),E=e('input:radio[name="searchType"]:checked'),S=E.attr("data-key"),x=E.attr("data-amount");d=GO.util.calDate(w,S,x),v=GO.util.searchEndDate(w)}GO.EventEmitter.trigger("common","layout:setOverlay",!0);var T={stype:"detail",content:e("#detail_content").attr("checked")?r:"",comments:e("#detail_comment").attr("checked")?r:"",attachFileNames:e("#detail_attachFileName").attr("checked")?r:"",attachFileContents:e("#detail_attachFileContents").attr("checked")?r:"",userName:i,boardIds:u,fromDate:d,toDate:v,searchType:"detail",boardName:a.join(","),isCommunity:this.isCommunity,allSearch:b},N=e("#searchType").val();N=="appSearch"?n.router.navigate((this.isCommunity?"community":"board")+"/search?"+this._serializeObj(T),!0):n.router.navigate("unified/search?"+this._serializeObj(T),{trigger:!0,pushState:!0})},search:function(t){var r=e("#searchType").val();r=="appSearch"?n.router.navigate((this.isCommunity?"community":"board")+"/search?"+this._serializeObj(t),!0):n.router.navigate("unified/search?"+this._serializeObj(t),{trigger:!0,pushState:!0})},_serializeObj:function(e){var t=[];for(var n in e)t.push(encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t.join("&")},favoriteBoard:function(t){this.favoriteModel=this.options.favoriteModel;var n=this,r=e(t.currentTarget),i=function(e,t){t.code==200&&(t.favorite?r.removeClass("ic_star_off").attr("title",f.favorite+" "+f.clean):r.addClass("ic_star_off").attr("title",f.favorite+" "+f.add),n.dataset.favorite=t.favorite,GO.EventEmitter.trigger("board","changed:favorite",!0))};this.favoriteModel.set({boardId:this.dataset.id,id:this.dataset.id},{silent:!0}),this.dataset.favorite?this.favoriteModel.destroy({success:function(e,t){t.favorite=!1,i(e,t)}}):this.favoriteModel.save({},{type:"POST",success:function(e,t){t.favorite=!0,i(e,t,!0)}})},detailPopup:function(t){var n=this,r=new u,i=e(t.currentTarget).offset();this.searchPopup=e.goSearch({modal:!0,header:s["\uc0c1\uc138\uac80\uc0c9"],offset:{top:parseInt(i.top+30,10),right:7},callback:function(){r.validate()&&n.search(r.getSearchParam())}}),this.searchPopup.find(".content").html(r.el),r.render()}},{render:function(e){return a=new l(e),a.render(),a}});return l});