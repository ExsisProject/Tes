(function(){define(["jquery","backbone","app","hogan","i18n!nls/commons","i18n!board/nls/board","board/collections/dept_list","board/collections/board_list","community/collections/boards"],function(e,t,n,r,i,s,o,u,a){var f=!1,l={all:i["\uc804\uccb4"],company_board:s["\uc804\uc0ac\uac8c\uc2dc\ud310"],department_board:s["\ubd80\uc11c"],board_list_null:s["\uc120\ud0dd\uac00\ub2a5\ud55c \uac8c\uc2dc\ud310\uc774 \uc5c6\uc2b5\ub2c8\ub2e4."],community:i["\ucee4\ubba4\ub2c8\ud2f0"],header:s["\ub9d0\uba38\ub9ac"],dept:s["\ubd80\uc11c"],board:i["\uac8c\uc2dc\ud310"],board_select:s["\uac8c\uc2dc\ud310 \uc120\ud0dd"],board_add_check:s["\uac8c\uc2dc\ud310\uc740 10\uac1c\uae4c\uc9c0\ub9cc \ucd94\uac00\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4."],board_add:s["\uac8c\uc2dc\ud310 \ucd94\uac00 \uc120\ud0dd"],board_add_desc:s["(10\uac1c\uae4c\uc9c0 \uac00\ub2a5)"],write_noti:s["\uacf5\uc9c0\ub85c \ub4f1\ub85d"]},c=t.View.extend({events:{"change select#dept_select":"changeDeptList","change select.dept_select":"changeDeptListCopy","click #boardCopyTable .ic_del":"deleteTr","click #boardAdd":"boardAdd","click input[id=write_noti]":"notiCheck"},initialize:function(e){this.options=e||{},this.el=this.options.id,this.boardList=this.options.boardList||!1,this.communityId=this.options.communityId||"",this.deptId=this.options.deptId||"",this.boardId=this.options.boardId||"",this.boardType=this.options.boardType,this.postId=this.options.postId||"",this.selectClass=this.options.selectClass||"wfix_large",this.type=this.options.type||"",this.isCommunity=this.options.isCommunity||!1,this.isMove=this.options.isMove||!1,this.isCopy=this.options.isCopy||!1,this.isOrgServiceOn=GO.session("useOrg"),this.checkStickable=this.options.checkStickable||!1,this.allSelectUse=this.options.allSelectUse||!1,this.tplDeptList=['{{#isOrgServiceOn}}<select id="dept_select" {{#selectClass}}class="{{selectClass}}"{{/selectClass}}>','{{#allSelectUse}}<option value="all">{{lang.all}}</option>{{/allSelectUse}}','{{#dataSet}}{{#isCompany}}<option value="{{ownerId}}" data-ownertype="{{ownerType}}">{{lang.company_board}}</option>{{/isCompany}}','{{^isCompany}}<option value="{{#ownerId}}{{ownerId}}{{/ownerId}}{{^ownerId}}{{id}}{{/ownerId}}" data-ownertype="{{ownerType}}">{{#isDepartment}}[{{lang.department_board}}]{{/isDepartment}}{{name}}</option>{{/isCompany}}','{{/dataSet}}</select>{{/isOrgServiceOn}}<span id="board_select_wrap"></span>'],this.tplDeptListMove=["<dl>","{{#isOrgServiceOn}}<dt>{{#isCommunity}}{{lang.community}}{{/isCommunity}}{{^isCommunity}}{{lang.dept}}{{/isCommunity}}</dt>",'<dd><select id="dept_select" {{#selectClass}}class="{{selectClass}}"{{/selectClass}}>','{{#allSelectUse}}<option value="all">{{lang.all}}</option>{{/allSelectUse}}',"{{#dataSet}}",'{{#isCompany}}<option value="{{ownerId}}" data-ownertype="{{ownerType}}">{{lang.company_board}}</option>{{/isCompany}}','{{^isCompany}}{{#isOrgServiceOn}}{{#isDepartment}}<option value="{{ownerId}}" data-ownertype="{{ownerType}}">[{{lang.department_board}}]{{/isDepartment}}{{/isOrgServiceOn}}','{{#isCommunity}}<option value="{{id}}" data-ownertype="community">{{/isCommunity}}',"{{name}}</option>{{/isCompany}}","{{/dataSet}}",'</select></dd>{{/isOrgServiceOn}}<dt>{{lang.board}}</dt><dd id="board_select_wrap"></dd><dt id="header_dt" style="display:none">{{lang.header}}</dt>','<dd id="board_header_wrap" ></dd>',"{{#checkStickable}}",'<dd><span class="btn_action action_off"><input id="write_noti" type="checkbox"><label for="write_noti">{{lang.write_noti}}</label></span></dd>',"{{/checkStickable}}"],this.tplMdeptList=['<tr><td><select id="dept_select" {{#selectClass}}class="{{selectClass}}"{{/selectClass}}>','{{#allSelectUse}}<option value="all">{{lang.all}}</option>{{/allSelectUse}}','{{#dataSet}}{{#isCompany}}<option value="{{ownerId}}" data-ownertype="{{ownerType}}">{{lang.company_board}}</option>{{/isCompany}}','{{#isOrgServiceOn}}{{^isCompany}}<option value="{{#ownerId}}{{ownerId}}{{/ownerId}}{{^ownerId}}{{id}}{{/ownerId}}" data-ownertype="{{ownerType}}">{{#isDepartment}}[{{lang.department_board}}]{{/isDepartment}}{{name}}</option>{{/isCompany}}{{/isOrgServiceOn}}',"{{/dataSet}}</select></td></tr>",'<tr><td id="board_select_wrap"></td></tr>'],this.tplBoardList=['<select id="select_board" {{#selectClass}}class="{{selectClass}}"{{/selectClass}}>','{{#allSelectUse}}<option value="all">{{lang.all}}</option>{{/allSelectUse}}',"{{#dataset}}","{{^allSelectUse}}",'{{#actions.writable}}<option value="{{id}}" data-bbstype="{{type}}"{{#header}} data-headerFlag="{{header.headerFlag}}" data-headerRequiredFlag="{{header.headerRequiredFlag}}"{{/header}}>{{name}}</option>{{/actions.writable}}',"{{/allSelectUse}}","{{#allSelectUse}}",'<option value="{{id}}" data-bbstype="{{type}}"{{#header}} data-headerFlag="{{header.headerFlag}}" data-headerRequiredFlag="{{header.headerRequiredFlag}}"{{/header}}>{{name}}</option>',"{{/allSelectUse}}","{{/dataset}}",'{{^dataset}}<option value="" style="color:red">{{lang.board_list_null}}</option>{{/dataset}}</select>','<input type="hidden" id="writePostId" value=""/><input type="hidden" id="writeType" value=""/><span id="board_header_wrap"></span>'],this.tplBoardListMove=['<select id="select_board" {{#selectClass}}class="{{selectClass}}"{{/selectClass}}>','{{#allSelectUse}}<option value="all">{{lang.all}}</option>{{/allSelectUse}}','<option value="" selected = "selected">{{lang.board_select}}</option>','{{#dataset}}{{#actions.writable}}<option value="{{id}}" data-bbstype="{{type}}"{{#header}} data-headerFlag="{{header.headerFlag}}" data-headerRequiredFlag="{{header.headerRequiredFlag}}"{{/header}}>{{name}}</option>{{/actions.writable}}{{/dataset}}','{{^dataset}}<option value="" style="color:red">{{lang.board_list_null}}</option>{{/dataset}}</select>','<input type="hidden" id="writePostId" value=""/><input type="hidden" id="writeType" value=""/>'],this.tplDeptListCopy=['<div class="t_title">','{{#isOrgServiceOn}}<span class="title">{{#isCommunity}}{{lang.community}}{{/isCommunity}}{{^isCommunity}}{{lang.dept}}{{/isCommunity}}</span>{{/isOrgServiceOn}}','<span class="title">{{lang.board}}</span>','<span class="title" id="headerSelectPart">{{lang.header}}</span>',"</div>",'<div class="scroll_wrap_t">','<table class="table_form_mini" id="boardCopyTable">',"</table>","</div>",'<span class="btn_wrap" id="boardAdd">','<span class="ic_form ic_addlist"></span>','<span class="txt">{{lang.board_add}}</span>','<span class="add">{{lang.board_add_desc}}</span>',"</span>"],this.tplBoardListCopy=['<select class="select_board wfix_medi">','<option value="" selected = "selected">{{lang.board_select}}</option>','{{#dataset}}{{#actions.writable}}<option value="{{id}}" data-bbstype="{{type}}"{{#header}} data-headerFlag="{{header.headerFlag}}" data-headerRequiredFlag="{{header.headerRequiredFlag}}"{{/header}}>{{name}}</option>{{/actions.writable}}{{/dataset}}','{{^dataset}}<option value="" style="color:red">{{lang.board_list_null}}</option>{{/dataset}}</select>','<input type="hidden" id="writePostId" value=""/><input type="hidden" id="writeType" value=""/>'],this.tplBoardCopyTr=["<tr>","<td>",'<select class="wfix_medi dept_select">',"{{#dataSet}}",'{{#isCompany}}<option value="{{ownerId}}" data-ownertype="{{ownerType}}">{{lang.company_board}}</option>{{/isCompany}}',"{{^isCompany}}","{{#isOrgServiceOn}}",'{{#isDepartment}}<option value="{{ownerId}}" data-ownertype="{{ownerType}}">[{{lang.department_board}}]{{/isDepartment}}',"{{/isOrgServiceOn}}",'{{#isCommunity}}<option value="{{id}}" data-ownertype="community">{{/isCommunity}}',"{{name}}</option>","{{/isCompany}}","{{/dataSet}}","</select>","</td>","<td>",'<div class="board_select_wrap"></div>',"</td>","<td>",'<div class="board_header_wrap"></div>',"</td>",'<td class="w30">','<span class="btn_wrap"><span class="ic_classic ic_del" title="\uc0ad\uc81c" evt-rol="delete-attach"></span></span>',"</td>","</tr>"],this.hogan={tplDeptList:r.compile(this.tplDeptList.join("")),tplDeptListMove:r.compile(this.tplDeptListMove.join("")),tplMdeptList:r.compile(this.tplMdeptList.join("")),tplBoardList:r.compile(this.tplBoardList.join("")),tplBoardListMove:r.compile(this.tplBoardListMove.join("")),tplDeptListCopy:r.compile(this.tplDeptListCopy.join("")),tplBoardListCopy:r.compile(this.tplBoardListCopy.join("")),tplBoardCopyTr:r.compile(this.tplBoardCopyTr.join(""))}},render:function(){if(this.communityId!=""){var t=u.getBoardList({isCommunity:!0,deptid:this.communityId,ownerType:"Community",boardType:this.boardType}),n=t.toJSON(),r;this.allSelectUse?r=n:r=_.reject(n,function(e){return e.actions?!e.actions.writable:!0});var i=this.hogan.tplBoardList.render({dataset:r,allSelectUse:this.allSelectUse,selectClass:this.selectClass,lang:l,hasBoard:n.length<1?!1:!0});this.$el.prepend(i),this.boardId&&(e("#select_board").val(this.boardId),this.$el.find("option[value='"+parseInt(this.options.boardId)+"']").attr("selected","selected")),this.postId?(e("#writePostId").val(this.postId),e("#writeType").val(this.type),e("#select_board").attr("disabled",!0)):e("#select_board").removeAttr("disabled");return}this.collection=o.getDeptList({isCommunity:this.isCommunity});if(this.collection.options.retry)var s=e.each(this.collection.toJSON(),function(e,t){t.ownerId=t.id,t.ownerType="Department"});var a={dataSet:this.collection.options.retry?s:this.collection.toJSON(),allSelectUse:this.allSelectUse,selectClass:this.selectClass,isDepartment:function(){return this.ownerType=="Department"},isCompany:function(){return this.ownerType=="Company"},lang:l,isCommunity:this.isCommunity,isOrgServiceOn:this.isOrgServiceOn,checkStickable:this.checkStickable},f=this.hogan.tplDeptList.render(a);GO.util.callMetaTagDevice()=="mobile"&&(f=this.hogan.tplMdeptList.render(a)),this.isMove&&(f=this.hogan.tplDeptListMove.render(a)),this.isCopy&&(f=this.hogan.tplDeptListCopy.render(a)),this.$el.prepend(f);if(this.deptId){var c=e('#dept_select option[value="'+this.deptId+'"]');c.length>0?c.attr("selected","selected"):e("#dept_select option[data-ownertype='Company']").attr("selected","selected")}this.boardList&&(this.isCopy?this.changeDeptListByCopy(a):this.changeDeptList());return},notiCheck:function(t){var n=e(t.target),r=n.is(":checked");n.siblings("label").parent().toggleClass("action_off",!r)},changeDeptListByCopy:function(t){var n=this.hogan.tplBoardCopyTr.render(t);e("#boardCopyTable").append(n);var r=e("#boardCopyTable .dept_select option:selected"),i=e("#boardCopyTable .dept_select option:selected").attr("data-ownertype"),s=u.getBoardList({isCommunity:this.isCommunity,deptid:r.val(),ownerType:i,boardType:this.boardType}),o=s.toJSON(),a=_.reject(o,function(e){return!e.actions.writable}),f={dataset:a,allSelectUse:this.allSelectUse,selectClass:this.selectClass,lang:l,hasBoard:o.length<1?!1:!0},c=this.options.boardId||this.options.communityId;tplBoardList=this.hogan.tplBoardListCopy.render(f),e("#boardCopyTable .board_select_wrap").html(tplBoardList)},changeDeptListCopy:function(t){var n=e(t.currentTarget).parents("tr").first(),r=n.find(".dept_select option:selected"),i=n.find(".dept_select option:selected").attr("data-ownertype"),s=u.getBoardList({isCommunity:this.isCommunity,deptid:r.val(),ownerType:i,boardType:this.boardType}),o=s.toJSON(),a=_.reject(o,function(e){return!e.actions.writable}),f={dataset:a,allSelectUse:this.allSelectUse,selectClass:this.selectClass,lang:l,hasBoard:o.length<1?!1:!0},c=this.options.boardId||this.options.communityId;tplBoardList=this.hogan.tplBoardListCopy.render(f),n.find(".board_select_wrap").html(tplBoardList)},changeDeptList:function(){if(this.boardList){var t=e("#dept_select option:selected"),n=e("#dept_select option:selected").attr("data-ownertype"),r=u.getBoardList({isCommunity:this.isCommunity,deptid:t.val(),ownerType:n,boardType:this.boardType}),i=r.toJSON(),s;this.allSelectUse?s=i:s=_.reject(i,function(e){return e.actions?!e.actions.writable:!0});if(t.val()=="all"){e("#board_select_wrap").html("");return}var o={dataset:s,allSelectUse:this.allSelectUse,selectClass:this.selectClass,lang:l,hasBoard:i.length<1?!1:!0},a=this.options.boardId||this.options.communityId,f=this.hogan.tplBoardList.render(o);this.isMove&&(f=this.hogan.tplBoardListMove.render(o)),e("#board_select_wrap").html(f),a&&!this.isMove&&(this.$el.find("#select_board").find("option[value="+parseInt(a)+"]").attr("selected","selected"),this.options.boardId=null,this.options.communityId=null),e("#writePostId").val(""),e("#writeType").val(""),this.postId?(e("#writePostId").val(this.postId),e("#writeType").val(this.type),e("#dept_select").attr("disabled",!0),e("#select_board").attr("disabled",!0)):(e("#dept_select").removeAttr("disabled"),e("#select_board").removeAttr("disabled"));var c=e("#dept_select option:selected").attr("data-ownertype");c=="Company"?e("#notiFlag").hide():e("#notiFlag").show()}},deleteTr:function(t){var n=e(t.currentTarget);console.log(e("#boardCopyTable tr").length),e("#boardCopyTable tr").length>1&&n.parents("tr").first().remove()},boardAdd:function(){if(e("#boardCopyTable tr").length==10){e.goSlideMessage(l.board_add_check,"caution");return}e("#boardCopyTable tr").first().clone().appendTo("#boardCopyTable")}});return{render:function(e){var t=new c({el:e.id,boardList:e.boardList,communityId:e.communityId,deptId:e.deptId,boardId:e.boardId,boardType:e.boardType,postId:e.postId,type:e.type,selectClass:e.selectClass,allSelectUse:e.allSelectUse,isCommunity:e.isCommunity,isMove:e.isMove,isCopy:e.isCopy,isOrgServiceOn:e.isOrgServiceOn,checkStickable:e.checkStickable});return t.render()}}})}).call(this);