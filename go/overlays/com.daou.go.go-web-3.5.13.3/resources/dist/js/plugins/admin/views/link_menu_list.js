(function(){define(["jquery","backbone","app","admin/models/link_menu","admin/views/link_menu_create","hgn!admin/templates/link_menu_list","hgn!admin/templates/link_menu_create","hgn!admin/templates/link_menu_update","admin/models/install_info","i18n!nls/commons","i18n!admin/nls/admin","jquery.go-validation","jquery.go-popup"],function(e,t,n,r,i,s,o,u,a,f,l){var c={label_quick_link_setting:l["\ubc14\ub85c\uac00\uae30 \ubc84\ud2bc \uc124\uc815"],label_quick_link_tip:l["PC \uba54\uc2e0\uc800 \ubc14\ub85c\uac00\uae30 \ubc84\ud2bc \uc124\uba85"],label_button:l["\ubc84\ud2bc\uba85"],label_url:l["\ubc14\ub85c\uac00\uae30 URL"],label_confirm:f["\ud655\uc778"],label_sucess:f["\uc800\uc7a5\ub418\uc5c8\uc2b5\ub2c8\ub2e4."],label_fail:f["\uc2e4\ud328"],label_failDesc:f["\uc2e4\ud328\ud588\uc2b5\ub2c8\ub2e4."],label_edit:f["\uc218\uc815"],label_ok:f["\uc800\uc7a5"],label_cancel:f["\ucde8\uc18c"],label_use:l["\uc0ac\uc6a9\ud568"],label_notuse:f["\uc0ac\uc6a9\ud558\uc9c0 \uc54a\uc74c"],label_delete:f["\uc0ad\uc81c"],label_order:l["\uc21c\uc11c \ubc14\uafb8\uae30"],label_setting:f["\uc124\uc815"],label_able:l["\uc0ac\uc6a9\uc5ec\ubd80"],label_add:f["\ucd94\uac00"],label_location:l["\ud654\uba74 \ud45c\uc2dc"],label_status:l["\ud65c\uc131\ud654 \uc5ec\ubd80"],label_empty_list:l["\uc124\uc815\ub41c \ubc84\ud2bc\uc774 \uc5c6\uc2b5\ub2c8\ub2e4."]},h=n.BaseView.extend({el:"#customConfigArea",initialize:function(){this.release(),this.$el.off(),this.model=new t.Model,this.model.url="/ad/api/messenger/links"},events:{"click #btn_create":"createLinkMenu","click .linkMenuSetting":"setLinkMenu","click #btn_delete":"deleteLinkMenu",'click form[name="formLinkMenuConfig"] input:checkbox':"toggleCheckbox","click span#btnReorderLinkMenus":"reorderLinkMenus","change #useQuickLink":"updateUseQuickLink"},render:function(){this.model.fetch({async:!1});var e=this.model.toJSON().links,t=a.read().toJSON().language,n=s({lang:c,data:e,useQuick:function(){return this.useQuickLink?f["\uc0ac\uc6a9"]:f["\uc0ac\uc6a9\ud558\uc9c0 \uc54a\uc74c"]},locationName:function(){return this.location=="new"?l["\ube0c\ub77c\uc6b0\uc800"]:this.location=="exe"?l["\uc2e4\ud589\ud30c\uc77c"]:l["\ud31d\uc5c5"]},menuName:function(){return t=="ja"?this.jpname:this.koname}});this.$el.html(n)},createLinkMenu:function(t){t.stopPropagation(),t.preventDefault();var n=this,r=e.goPopup({pclass:"layer_normal",header:l["\ubc14\ub85c\uac00\uae30 \ucd94\uac00"],modal:!0,width:"640px",contents:"",buttons:[{btype:"confirm",btext:f["\ud655\uc778"],autoclose:!1,callback:function(e){GO.EventEmitter.trigger("admin","changed:saveLinkMenu",e),n.model.fetch({async:!1}),n.render()}},{btype:"close",btext:f["\ucde8\uc18c"]}]});i.render(),r.reoffset()},setLinkMenu:function(t){var n=this,r=e(t.currentTarget).parents("tr"),s=r.attr("data-id");if(e(t.currentTarget).parents("tbody:eq(0)").hasClass("ui-sortable"))return e.goMessage(l["\uc21c\uc11c \ubc14\uafb8\uae30 \uc644\ub8cc\ud6c4 \uc124\uc815"]),!1;var o=e.goPopup({pclass:"layer_normal",header:l["\ubc14\ub85c\uac00\uae30 \uc124\uc815"],modal:!0,width:"640px",contents:"",buttons:[{btype:"confirm",btext:f["\uc218\uc815"],autoclose:!1,callback:function(e){GO.EventEmitter.trigger("admin","changed:saveLinkMenu",e),n.model.fetch({async:!1}),n.render()}},{btype:"close",btext:f["\ucde8\uc18c"]}]});i.render({linkMenuId:s}),o.reoffset()},deleteLinkMenu:function(){var t=this,n=new Array,r=this.$el.find("form[name=formLinkMenuConfig]"),i=r.find('input[type="checkbox"]:checked'),s=i.parents("tr");if(i.size()==0){e.goMessage(l["\uc0ad\uc81c\ud560 \uba54\ub274\ub97c \uc120\ud0dd\ud558\uc138\uc694."]);return}s.attr("data-id",function(e,t){t!=null&&n.push(t)}),e.goCaution(l["\uba54\ub274\uc0ad\uc81c \ud655\uc778"],l["\uc0ad\uc81c\uacbd\uace0"],function(){e.go(GO.contextRoot+"ad/api/messenger/link",JSON.stringify({ids:n}),{qryType:"DELETE",contentType:"application/json",responseFn:function(n){n.code==200&&(e.goMessage(f["\uc0ad\uc81c\ub418\uc5c8\uc2b5\ub2c8\ub2e4."]),t.render())},error:function(t){var n=JSON.parse(t.responseText);n!=null?e.goAlert(n.message):e.goMessage(c.label_failDesc)}})})},toggleCheckbox:function(t){e(t.currentTarget).attr("id")=="menu_all"&&e(t.currentTarget).is(":checked")?this.$el.find("input:checkbox").attr("checked",!0):e(t.currentTarget).attr("id")=="menu_all"&&!e(t.currentTarget).is(":checked")?this.$el.find("input:checkbox").attr("checked",!1):e(t.currentTarget).is(":checked")?e(t.currentTarget).attr("checked",!0):(this.$el.find("#menu_all").attr("checked",!1),e(t.currentTarget).attr("checked",!1))},saveLinkMenu:function(t){var n=e(t.currentTarget).attr("value"),i=e(t.currentTarget).parents("tr").attr("data-id");this.menuLinkModel=r.create(),this.menuLinkModel.set("id",i),this.menuLinkModel.set("useQuickLink",n),this.menuLinkModel.save({},{type:"PUT",success:function(t,n){n.code=="200"&&e.goMessage(f["\uc800\uc7a5\ub418\uc5c8\uc2b5\ub2c8\ub2e4."])},error:function(t,n){var r=JSON.parse(n.responseText);e.goMessage(r.message)}})},updateUseQuickLink:function(t){console.log(e(t.currentTarget).find("option:selected").attr("value"));var n=e(t.currentTarget).find("option:selected").attr("value"),r=e(t.currentTarget).parents("tr").attr("data-id"),i=GO.contextRoot+"ad/api/messenger/usage/link/"+r,s={useQuickLink:n};e.go(i,JSON.stringify(s),{contentType:"application/json",qryType:"PUT",responseFn:function(t){t.code=="200"&&e.goMessage(f["\uc800\uc7a5\ub418\uc5c8\uc2b5\ub2c8\ub2e4."])},error:function(t){var n=JSON.parse(t.responseText);e.goMessage(n.message)}})},reorderLinkMenus:function(t){var n=this,r=e(t.currentTarget).hasClass("btn_save");e("#btn_setting").unbind("click");if(r){this.$el.find("#linkMenuTable").find("tbody").sortable("destroy").removeAttr("class");var i=new Array,s=this.$el.find("form[name=formLinkMenuConfig]"),o=s.find('input[type="checkbox"]'),u=o.parents("tr");u.attr("data-id",function(e,t){t!=null&&i.push(t)}),i.reverse(),e.go(GO.contextRoot+"ad/api/messenger/reorder",JSON.stringify({ids:i}),{async:!1,qryType:"PUT",contentType:"application/json",responseFn:function(t){t.code==200&&e.goMessage(f["\ubcc0\uacbd\ub418\uc5c8\uc2b5\ub2c8\ub2e4."]),t.code!=200&&(e.goMessage(c.label_failDesc),n._reloadMemberTables())}}),e(t.currentTarget).text(l["\uc21c\uc11c \ubc14\uafb8\uae30"]).removeClass("btn_save").find(" ~ span").remove(),e("#btn_add").show(),e("#btn_delete").show()}else e("#btn_add").hide(),e("#btn_delete").hide(),this.$el.find("#btnReorderLinkMenus").addClass("btn_save").text(l["\uc21c\uc11c\ubc14\uafb8\uae30 \uc644\ub8cc"]).after('&nbsp;<span class="vertical_wrap desc">'+l["\uba54\ub274 \uc21c\uc11c \ubcc0\uacbd \uc124\uba85"]+"</span>"),this.$el.find("#linkMenuTable").find("tbody").sortable({opacity:"1",delay:100,cursor:"move",items:">tr",containment:".admin_content",hoverClass:"ui-state-hover",placeholder:"ui-sortable-placeholder",start:function(t,n){n.placeholder.html(n.helper.html()),n.placeholder.find("td").css("padding","5px 10px"),e(this).find("tr#sub_"+e(n.item[0]).attr("data-id")).hide()},stop:function(t,n){var r=e(n.item[0]).attr("data-id"),i=e(n.item[0]).find("td.title span.btn_s"),s=null;i&&i.hasClass("btn_closeSubMenu")&&(s=e(this).find("tr#sub_"+r),e(this).find("tr[data-id = "+r+"]").after(s),s.show())}});this.$el.find("input[type=checkbox]").attr({checked:!1,disabled:!r})},release:function(){this.$el.off(),this.$el.empty()}});return h})}).call(this);