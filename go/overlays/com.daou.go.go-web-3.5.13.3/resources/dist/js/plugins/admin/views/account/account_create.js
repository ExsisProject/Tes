(function(){define(["jquery","backbone","app","views/layouts/admin_default","i18n!nls/commons","i18n!admin/nls/admin","admin/views/account/account_form","hgn!admin/templates/account_create","admin/models/mail_domain_group"],function(e,t,n,r,i,s,o,u,a){var f=o.prototype,l=o.extend({events:function(){return _.extend({},f.events,{"submit form":"formSubmit","click.account #saveAction":"saveAction","click.account #saveContinue":"saveContinue"})},initialize:function(e){f.initialize.call(this,e),r.render(),this.model=new Backbone.Model,this.model.url=GO.contextRoot+"ad/api/user";var t=new Backbone.Model;t.url=GO.contextRoot+"ad/api/systeminfo",t.fetch({async:!1}),this.systemInfo=t.toJSON(),this.mailDomainGroup=a.read("default"),this.systemMailSetting=new Backbone.Model,this.systemMailSetting.url=GO.contextRoot+"ad/api/mailsetting",this.systemMailSetting.fetch({async:!1}),this.companyMailService=new Backbone.Model,this.companyMailService.url=GO.contextRoot+"ad/api/company/mailservice",this.companyMailService.fetch({async:!1});var n=new Backbone.Model;n.url=GO.contextRoot+"ad/api/siteconfig",n.fetch({async:!1}),this.mailDomainConfigModel=n.toJSON(),this.$parentEl=e.$parentEl},render:function(){var t=this.mailDomainConfigModel.profileVisibleInfos,n=["directTel","mobileNo","repTel","fax","selfInfo","job","location","homePage","messanger","birthday","anniversary","address","memo"],r=_.pick(t,n),i=this.positions.toJSON(),s=this.grades.toJSON(),o=this.duties.toJSON();thumbnail_path=GO.contextRoot+"resources/images/admin/sample_photo.jpg",locale=this.__setLocale(),timeZone=this.__setTimeZone(),mailGroups=this.__setMailGroup(),userVirtualDomains=this.__setUserVirtualDomains(),systemMailSetting=this.__setSystemMailSetting(),isOrgServiceOn=this.__setOrgService(),instalLocale=this.systemInfo.language,tmpl=u({type:this.type,timeZone:timeZone,locale:locale,positions:i,grades:s,duties:o,thumbnail_path:thumbnail_path,mailGroups:mailGroups,userVirtualDomains:userVirtualDomains,systemMailSetting:systemMailSetting,companyInfo:this.companyInfo,instalLocale:instalLocale,isJpInstall:instalLocale=="ja",isOrgServiceOn:isOrgServiceOn,hasApproval:this.hasApproval,isKoLocale:instalLocale=="ko",isEnLocale:instalLocale=="en",isJpLocale:instalLocale=="ja",isZhcnLocale:instalLocale=="zhcn",isZhtwLocale:instalLocale=="zhtw",isViLocale:instalLocale=="vi",profileVisibleInfos:t,hasDeptInfo:this.options.hasOwnProperty("deptId"),hasMoreInfo:function(){var e=_.filter(r,function(e){if(e)return!0});return _.contains(e,!0)}}),this.$el.html(tmpl),this.datePickerInit(),this.initProfileUpload(),this.setBirthday();if(this.hasApproval){this.initApprovalUpload();var a=_.max(this.approvalLevels.toJSON(),function(e){return e.level});this.setApprovalConfig({approvalLevel:a.level})}return this.inheritMailGroupConfig(this.mailDomainGroup.toJSON()),this.inheritDomainMailServiceConfig(this.companyMailService.toJSON()),this.mailDomainConfigModel.otpService=="on"&&e("tr#otp").show(),this.mailDomainConfigModel.useAbbroadIpCheck=="on"&&e("tr#useAbbroadIpCheck").show(),this.changeRepresentationEmail(),setTimeout(e.proxy(function(){e("#loginId").val(""),e("input[name='password']").val("")},this),300),this.customFieldRender(),this.hideDetailArea(),this},type:function(){return _.extend({},f.type,{save_and_continue:s["\uc800\uc7a5 \ud6c4 \uacc4\uc18d\ud574\uc11c \ucd94\uac00"],account_add:s["\uacc4\uc815 \ucd94\uac00 \ub4f1\ub85d"],save:i["\uc800\uc7a5"],detail_input:s["\uc0c1\uc138 \uc785\ub825"],multi_lang:s["\ub2e4\uad6d\uc5b4"],open:i["\uc5f4\uae30"]})}(),formSubmit:function(e){e.preventDefault();return},save:function(t){var n=this;try{this.isFormInvalid({password:!0,apprPassword:!1}),this.model.attributes=e.extend({},this.model.attributes,this.accountBuilder(this.options.deptId))}catch(r){return console.log("accountBuilder Error :: "+r)}this.model.save(null,{success:function(){n.$parentEl&&n.$parentEl.trigger("orgChanged"),e.goMessage(GO.i18n(s["\uba64\ubc84\uac00 \uc800\uc7a5\ub418\uc5c8\uc2b5\ub2c8\ub2e4."],{name:n.model.attributes.name})),n.model.clear(),t()},error:function(e,t){f.errorMessage(t)}})},saveAction:function(){this.save(this.goList)},saveContinue:function(){this.save(this.reset)},showDetail:function(){this.$el.find("span#show_detail_btn").hide(),this.$el.find("div.detail_area").show(),this.$el.find("tr.detail_area").show(),this.mailDomainConfigModel.useAbbroadIpCheck!="on"&&this.$el.find("tr#useAbbroadIpCheck").hide()},toggleMultiLang:function(){var e=this.$el.find("span#btnMultiLang i");e.hasClass("ic_accordion_s")?(e.removeClass("ic_accordion_s").addClass("ic_accordion_c").attr("title",i["\ub2eb\uae30"]),this.$el.find('tr[id$="NameInput"]').show()):(e.removeClass("ic_accordion_c").addClass("ic_accordion_s").attr("title",this.type.open),this.$el.find('tr[id$="NameInput"]').hide())},reset:function(){var t=e("#userCreateForm"),n=e("#thumbnail_image"),r=e("#approval_sign_img");t[0].reset(),t.find(".dept_member").remove(),t.find("#group_members li").not("li.creat").remove(),t.find("ul.list_option li").remove(),t.find("input[name='name']").focus(),n.attr("src",GO.contextRoot+"resources/images/photo_profile_large.jpg"),n.removeAttr("data-filepath"),n.removeAttr("data-filename"),r.attr("src",GO.contextRoot+"resources/images/stamp_approved.png"),r.removeAttr("data-filepath"),r.removeAttr("data-filename")},cancel:function(){this.goList()},__setSystemMailSetting:function(){var e=this.systemMailSetting.toJSON(),t=e.limitSendmailSize;return t=="on"?!0:!1},__setMailGroup:function(){var t=this.mailDomainGroups.toJSON();return e.each(t,function(){if(this.mailGroup=="default"){this["isSelected?"]=!0;return}}),t},__setUserVirtualDomains:function(){var t=this.userVirtualDomains.toJSON();return e.each(t,function(){}),t},datePickerInit:function(){var t=e("#mailExpireDate"),n=e("#anniversaryDate");e.datepicker.setDefaults(e.datepicker.regional[GO.config("locale")]),t.datepicker({defaultDate:"+1w",dateFormat:"yymmdd",changeMonth:!0,changeYear:!0,yearSuffix:""}),n.datepicker({defaultDate:"+1w",dateFormat:"yy-mm-dd",changeMonth:!0,changeYear:!0,yearSuffix:""})},__setTimeZone:function(){var e=this.systemInfo.timeZoneName;e=="ROK"&&(e="Asia/Seoul");for(var t=0;t<this.timeZone.length;t++)if(this.timeZone[t].location==e){this.timeZone[t]["isTimeZone?"]=!0,timeZoneFlag=!1;break}return this.timeZone},__setLocale:function(){var e=[{value:"ko",text:this.type.ko},{value:"en",text:this.type.en},{value:"ja",text:this.type.jp},{value:"zh_CN",text:this.type.zh_cn},{value:"zh_TW",text:this.type.zh_tw},{value:"vi",text:this.type.vi}];for(var t=0;t<e.length;t++)if(e[t].value==this.systemInfo.language){e[t]["isLocale?"]=!0;break}return e},customFieldRender:function(){var t=this;e.go(GO.contextRoot+"ad/api/customprofile/use/config",{},{qryType:"GET",async:!1,responseFn:function(n){if(n.data.length==0){t.$el.find("#customInfo").remove();return}var r="",i=[];e.each(n.data,function(e,t){t.dataType=="String"?r+='<tr><th><span class="title">'+t.name+"</span></th>"+'<td><input class="w200 input" type="text" name="'+t.profileName+'" id="'+t.profileName+'"/></td>'+"</tr>":(r+='<tr><th><span class="title">'+t.name+"</span></th>"+'<td><input class="w200 input" type="text" name="'+t.profileName+'" id="'+t.profileName+'"/></td>'+"</tr>",i.push(t.profileName))}),t.$el.find("#customInfo table.detail").append(r),e.each(i,function(e,n){t.$el.find("#"+n).datepicker({defaultDate:"+1w",dateFormat:"yy-mm-dd",changeMonth:!0,changeYear:!0,yearSuffix:""})})},error:function(t){var n=JSON.parse(t.responseText);e.goMessage(n.message)}})},hideDetailArea:function(){this.$el.find(".detail_area").hide()},__setOrgService:function(){return GO.util.isUseOrgService(!0)}});return l})}).call(this);