define("admin/views/attnd_code_manage",function(require){var e=require("jquery"),t=require("app"),n=require("backbone"),r=require("admin/models/attnd_code"),i=require("admin/models/attnd_ext_config"),s=require("hgn!admin/templates/attnd_code_list"),o=require("hgn!admin/templates/attnd_code_layer"),u=require("i18n!nls/commons"),a=require("i18n!admin/nls/admin");require("jquery.go-popup"),require("jquery.go-grid");var f={label_add_code:a["\ucd94\uac00"],label_code:a["\uadfc\ud0dc \uc720\ud615 \ucf54\ub4dc"],label_code_name:a["\uadfc\ud0dc \uc720\ud615 \uba85\uce6d"],label_attnd_type:a["\uadfc\ud0dc \uc720\ud615 \ud0c0\uc785"],label_use_yn:a["\uc0ac\uc6a9\uc5ec\ubd80"],label_attnd_manage:a["\uadfc\ud0dc \uc720\ud615 \ub4f1\ub85d"],label_attnd_modify:a["\uadfc\ud0dc \uc720\ud615 \uc124\uc815"],label_empty_list:a["\ub4f1\ub85d\ub41c \uadfc\ud0dc\uad00\ub9ac\ucf54\ub4dc\uac00 \uc5c6\uc2b5\ub2c8\ub2e4."],label_caution_code:a["\uadfc\ud0dc \uc720\ud615 \ucf54\ub4dc\ub294 \ud544\uc218\uc785\ub825\uac12\uc785\ub2c8\ub2e4."],label_caution_name:a["\uadfc\ud0dc \uc720\ud615 \uba85\uce6d\uc740 \ud544\uc218\uc785\ub825\uac12\uc785\ub2c8\ub2e4."],label_caution_total:a["\ucd5c\ub300 30\uac1c\uae4c\uc9c0\ub9cc \ucd94\uac00\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4."],label_date:a["\ub0a0\uc9dc"],label_time:a["\uc2dc\uac04"],label_setting:a["\uc124\uc815"],label_use:a["\uc0ac\uc6a9"],label_unuse:a["\ubbf8\uc0ac\uc6a9"],label_use_yn_tooltip:a["\uc0ac\uc6a9 \uccb4\ud06c\uc2dc \uadfc\ud0dc \ud604\ud669 \ud654\uba74\uc5d0\uc11c \ud655\uc778 \ubc0f \uc0ac\uc6a9\uc774 \uac00\ub2a5\ud569\ub2c8\ub2e4."],label_code_check:u["\ucf54\ub4dc \uc785\ub825\uac12 \uccb4\ud06c"]},l=n.View.extend({events:{"click #btnManageControllCode #addCode":"_addCode"},initialize:function(e){this.attndExtConfig=new i},render:function(){var t=this;this.$el.html(s({lang:f}));var n=this.attndExtConfig.fetch().promise();e.when(n).done(_.bind(function(){this._renderCodeDataTables()},this))},_renderCodeDataTables:function(){var n=this;this.codeDataTable=e.goGrid({el:"#attndCodeManageTable",bDestory:!0,method:"GET",url:t.contextRoot+"ad/api/ehr/attnd/code",params:{},emptyMessage:"<p class='data_null'> <span class='ic_data_type ic_no_data'></span><span class='txt'>"+f.label_empty_list+"</span>"+"</p>",defaultSorting:[],pageUse:!1,sDomUse:!1,checkbox:!1,sDomType:"admin",columns:[{mData:null,sClass:"align_c",bSortable:!1,sWidth:"100px",fnRender:function(e){var t=e.aData.attndCode;return t==undefined||t==""?"-":t}},{mData:null,sClass:"align_c",bSortable:!1,sWidth:"100px",fnRender:function(e){var t=e.aData.name;return t==undefined?"-":t}},{mData:null,sClass:"align_c",bSortable:!1,sWidth:"100px",fnRender:function(e){return n._attndTypeConverter(e.aData.type)}},{mData:null,sClass:"align_c",bSortable:!1,sWidth:"100px",fnRender:function(e){return n._attndUseYNConverter(e.aData.useYN)}},{mData:null,sClass:"set align_c",bSortable:!1,sWidth:"60px",fnRender:function(e){var t="<span id='settingCode' class='btn_fn7 btn-board-admin' data-id='"+e.aData.id+"'>"+a["\uc124\uc815"]+"</span>";return t}}],fnDrawCallback:function(t,r,i){n.$el.find("tr>td:nth-child(5) span").click(function(t){var r=e(t.currentTarget).data("id");n._editCode(t,r)})}}),this.codeList=this.codeDataTable.tables.fnGetData()},_codeTableReload:function(){this.codeDataTable.tables.reload()},_addCode:function(t){var n=this;this.codeList=this.codeDataTable.tables.fnGetData();if(this.codeList.length>=30){e.goAlert(a["\ucd5c\ub300 30\uac1c\uae4c\uc9c0\ub9cc \ucd94\uac00\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4."]);return}this._callPopupAttndCode()},_editCode:function(e,t){var n=this;this._callPopupAttndCode(t)},_callPopupAttndCode:function(n){var i=this.attndExtConfig.get("syncActive");this.codeList=this.codeDataTable.tables.fnGetData(),this.editId=n;var s=this,l=o({lang:f,isEditable:!0,checked:!0});n&&(this.code=new r,this.code.set("id",n),this.code.fetch({async:!1}),l=o({lang:f,id:this.code.get("id"),isEditable:!0,isAttndType:this.code.get("type")=="date"?!0:!1,checked:this.code.get("useYN")==1?!0:!1,attndCode:this.code.get("attndCode")==undefined?"":this.code.get("attndCode"),name:this.code.get("name"),isSyncActive:i})),this.groupPopup=e.goPopup({pclass:"layer_normal layer_code_add",header:n==null?f.label_attnd_manage:f.label_attnd_modify,modal:!0,width:"320px",contents:l,buttons:[{btext:u["\uc800\uc7a5"],btype:"confirm",autoclose:!1,callback:function(n){var i=n.find("input#attndCode").val(),o=n.find("input#name").val(),l=n.find("select#attndType.selectBox").val(),c=n.find("input#useYN[type='checkbox']").is(":checked"),h=!0,p=/^[a-zA-Z0-9-_]*$/;if(!p.test(i)){e("#stateNameValidate").text(f.label_code_check),e("input#attndCode").focus();return}if(o==""){e("#stateNameValidate").text(f.label_caution_name),e("input#name").focus();return}if(!e.goValidation.isCheckLength(2,10,o)){e("#stateNameValidate").text(t.i18n(u["0\uc790\uc774\uc0c1 0\uc774\ud558 \uc785\ub825\ud574\uc57c\ud569\ub2c8\ub2e4."],{arg1:"2",arg2:"10"})),e("input#name").focus();return}if(s.codeList.length>0){e.each(s.codeList,function(t,n){if(i&&n.attndCode==i){if(s.editId&&s.editId==n.id)return!0;e("#stateNameValidate").text(f.label_code+" : "+a["\uc774\ubbf8 \ucd94\uac00\ub418\uc5b4 \uc788\uc2b5\ub2c8\ub2e4."]),h=!1;return}});if(!h){e("input#attndCode").focus();return}e.each(s.codeList,function(t,n){if(n.name==o){if(s.editId&&s.editId==n.id)return!0;e("#stateNameValidate").text(f.label_code_name+" : "+a["\uc774\ubbf8 \ucd94\uac00\ub418\uc5b4 \uc788\uc2b5\ub2c8\ub2e4."]),h=!1;return}});if(!h){e("input#name").focus();return}}n.find("span.title").data("id")?s.code.set("id",n.find("span.title").data("id")):s.code=new r,s.code.set("attndCode",i),s.code.set("name",o),s.code.set("type",l),s.code.set("useYN",c),n.close(),t.EventEmitter.trigger("common","layout:setOverlay",""),s.code.save({},{success:function(e,n){s._codeTableReload(),t.EventEmitter.trigger("common","layout:clearOverlay",!0)},error:function(n,r){r&&r.responseJSON&&r.responseJSON.message?e.goSlideMessage(r.responseJSON.message,"caution"):e.goSlideMessage(u["\uc2e4\ud328\ud588\uc2b5\ub2c8\ub2e4."],"caution"),t.EventEmitter.trigger("common","layout:clearOverlay",!0)}})}},{btext:u["\ucde8\uc18c"],btype:"cancel"}]},this)},_attndTypeConverter:function(e){var t=this;return e=="date"?f.label_date:f.label_time},_attndUseYNConverter:function(e){var t=this;return e==1?f.label_use:f.label_unuse}});return l});