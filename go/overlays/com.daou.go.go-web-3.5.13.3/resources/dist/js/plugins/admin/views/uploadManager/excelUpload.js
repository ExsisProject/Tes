define("admin/views/uploadManager/excelUpload",function(require){var e=require("backbone"),t=require("app"),n=require("hgn!admin/templates/uploadManager/excelUpload"),r=require("i18n!nls/commons"),i=require("i18n!admin/nls/admin"),s=require("file_upload");require("GO.util"),require("jquery.go-grid"),require("jquery.go-preloader");var o={select_upload_file:i["\uc77c\uad04\ub4f1\ub85d \ud30c\uc77c\uc120\ud0dd"],upload_file:i["\uc77c\uad04 \ub4f1\ub85d \ud30c\uc77c"],download_upload_form:i["\uc77c\uad04 \ub4f1\ub85d \ud30c\uc77c \uc591\uc2dd \ub2e4\uc6b4\ub85c\ub4dc"],upload:i["\uc77c\uad04 \ub4f1\ub85d"],dept_upload_result:i["\uc77c\uad04 \ub4f1\ub85d \ud30c\uc77c \uc5c5\ub85c\ub4dc \ud604\ud669"],download_all_result:i["\uc804\uccb4 \ucc98\ub9ac \uacb0\uacfc \ub2e4\uc6b4\ub85c\ub4dc"],download_fail_result:i["\uc624\ub958 \ubaa9\ub85d \ub2e4\uc6b4\ub85c\ub4dc"],upload_form_help:i["\uc5c5\ub85c\ub4dc \uc591\uc2dd \ub3c4\uc6c0\ub9d0"]},u=e.View.extend({events:{"click #downloadUploadForm":"downloadUploadForm","click #fileComplete .ic_del":"deleteFile","click #upload":"upload","click #download_all":"downloadAllResult","click #download_fail":"downloadFailResult"},initialize:function(e){this.subjectLang=e.subjectLang,this.downloadFormUrl=e.downloadFormUrl,this.uploadUrl=e.uploadUrl,this.uploadResultUrl=e.uploadResultUrl,this.downloadAllResultUrl=e.downloadAllResultUrl,this.downloadFailResultUrl=e.downloadFailResultUrl},render:function(){$.extend(o,{subject:this.subjectLang}),this.$el.html(n({lang:o})),this.initFileUpload()},initFileUpload:function(){var e=this,n={el:"#swfupload-control",context_root:t.contextRoot,button_text:"<span class='buttonText'>"+i["\ud30c\uc77c \ucc3e\uae30"]+"</span>",button_style:"cursor:pointer;font-size:12px;text-align: center;vertical-align: middle;font-family:Noto Sans KR;",progressBarUse:!0,url:"ad/api/file?GOAdminSSOcookie="+$.cookie("GOAdminSSOcookie")};(new s(n)).queue(function(e,t){}).start(function(n,i){var s=new RegExp("(.xls|.xlsx)","gi"),o=i.type.toLowerCase();if(!s.test(o))return $.goAlert(t.i18n(r["{{extension}} \ud30c\uc77c\ub9cc \ub4f1\ub85d \uac00\ub2a5\ud569\ub2c8\ub2e4."],{extension:"exel"})),e.$el.find("#progressbar").hide(),!1}).progress(function(e,t){}).success(function(n,r,i){if(t.util.fileUploadErrorCheck(r))return $.goAlert(t.util.serverMessage(r)),!1;var s=r.data,o=s.fileName,u=s.filePath,a=s.hostId,f=t.util.getHumanizedFileSize(s.fileSize),l=s.fileExt,c="<li id='item_file'><span class='item_file'><span class='ic_file ic_def'></span><span class='name'>"+o+"</span>"+"<span class='size'>("+f+")</span>"+"<span class='btn_wrap' title='\uc0ad\uc81c'>"+"<span class='ic_classic ic_del'></span>"+"</span>"+"</span>"+"<input type='hidden' value='"+u+"' id='file_path'/>"+"<input type='hidden' value='"+o+"' id='file_name'/>"+"<input type='hidden' value='"+a+"' id='host_id'/>"+"<input type='hidden' value='"+l+"' id='file_ext'/>"+"</li>";e.$el.find("#fileComplete").html(c)}).complete(function(e,t){console.info(t)}).error(function(e,t){console.info(t)})},downloadUploadForm:function(){window.location.href=t.contextRoot+this.downloadFormUrl},deleteFile:function(){this.$el.find("#fileComplete").empty()},upload:function(){this.preloader=$.goPreloader(),this.preloader.render();var e=this,n=t.contextRoot+this.uploadUrl,i={fileName:$("#file_name").val(),filePath:$("#file_path").val(),hostId:$("#host_id").val(),fileExt:$("#file_ext").val()};if(i.fileName==undefined||i.filePath==undefined){$.goError(r["\ucca8\ubd80\ud30c\uc77c\uc744 \ub4f1\ub85d\ud574 \uc8fc\uc138\uc694."]),this.preloader.$el.hide();return}$.go(n,JSON.stringify(i),{qryType:"POST",timeout:0,contentType:"application/json",responseFn:function(t){e.getUploadStatus()},error:function(t){var n=JSON.parse(t.responseText);n.message!=null?$.goError(n.message):$.goError(r["\uc5c5\ub85c\ub4dc\uc5d0 \uc2e4\ud328\ud558\uc600\uc2b5\ub2c8\ub2e4."]),e.preloader.release()}})},getUploadStatus:function(){var e=this;$.ajax({url:t.contextRoot+this.uploadResultUrl,dataType:"json",timeout:3e4,success:function(t){e.preloader.release(),e.changeUIWithUploadStatus(t.data)},error:function(){$.goAlert(r["\uc5c5\ub85c\ub4dc\uc5d0 \uc2e4\ud328\ud558\uc600\uc2b5\ub2c8\ub2e4."]),e.preloader.release()}})},changeUIWithUploadStatus:function(e){var n=this,r={boxImage:t.contextRoot+"resources/images/progressbar.gif",barImage:t.contextRoot+"resources/images/progressbg_green_200.gif",width:200,max:100},s=e.jobStatus,o=e.size,u=e.successCount,a=e.failCount,f=t.util.basicDate3(e.startedAt),l=t.util.basicDate3(e.endedAt),c=u+a;s=="DONE"?($("#progressbar").hide(),$("#progressbar").progressBar(0,r),$("#progress_content").empty(),$("#upload").show(),$("#select_file").show(),$("#swfupload-control").show(),$("#upload_progress").show(),$("#upload_progress div.header").html('<h2 style="margin-top: 0;">'+i["\ucd5c\uadfc \uc77c\uad04 \ub4f1\ub85d \uacb0\uacfc"]+"</h2>"),$("#upload_result").show(),$("#progress_content").append('<div class="desc" style="color:red;">'+i["\uacc4\uc815 \ub4f1\ub85d \uacb0\uacfc \ub3c4\uc6c0\ub9d0"]+"</div>"),$("#progress_content").append("<div>"+i["\ub4f1\ub85d\uc77c"]+": "+f+"</div>"),$("#progress_content").append("<div>"+i["\uc885\ub8cc\uc77c"]+": "+l+"</div>"),$("#progress_content").append("<div>"+i["\ucd1d \uac74\uc218"]+": "+c+"</div>"),$("#progress_content").append("<div>"+i["\uc2e4\ud328 \uac74\uc218"]+": "+a+"</div>"),$("#progress_content").append("<div>"+i["\uc131\uacf5 \uac74\uc218"]+": "+u+"</div>"),$("#rightButton").show(),$(document).scrollTop($(document).height()),this.initFileUpload()):s=="WAIT"?this.initFileUpload():s=="DOING"?($("#upload").hide(),$("#item_file").remove(),$("#swfupload-control").hide(),$("#upload_progress").show(),$("#progress_content").empty(),$("#upload_result").hide(),$("#upload_progress div.header").html('<h2 style="margin-top: 0;">'+i["\uacc4\uc815 \uc77c\uad04 \ub4f1\ub85d \ud30c\uc77c \uc5c5\ub85c\ub4dc \ud604\ud669"]+"</h2>"),$("#progressbar").show(),$("#progressbar").progressBar(c/o*100,r),window.setTimeout(function(){n.getUploadStatus()},1500),$(document).scrollTop($(document).height())):s=="PREPARE"?($("#upload").hide(),$("#item_file").remove(),$("#swfupload-control").hide(),$("#upload_progress").show(),$("#progress_content").empty(),window.setTimeout(function(){n.getUploadStatus()},1500),$(document).scrollTop($(document).height())):(this.initializeFileUpload(),$("#progressbar").hide(),$("#upload").show(),$("#select_file").show(),$("#swfupload-control").show(),$("#upload_progress").show(),$("#upload_progress div.header").html('<h2 style="margin-top: 0;">'+i["\ucd5c\uadfc \uc77c\uad04 \ub4f1\ub85d \uacb0\uacfc"]+"</h2>"),$("#upload_result").show(),$("#progress_content").append('<p class="go_alert">'+i["\uacc4\uc815\uc77c\uad04\ub4f1\ub85d \uc911\uc9c0"]+"</p>"),$("#progress_content").append("<div>"+i["\ub4f1\ub85d\uc77c"]+": "+f+"</div>"),$("#progress_content").append("<div>"+i["\uc885\ub8cc\uc77c"]+": "+l+"</div>"),$("#progress_content").append("<div>"+i["\ucd1d \uac74\uc218"]+": "+c+"</div>"),$("#progress_content").append("<div>"+i["\uc2e4\ud328 \uac74\uc218"]+": "+a+"</div>"),$("#progress_content").append("<div>"+i["\uc131\uacf5 \uac74\uc218"]+": "+u+"</div>"),$(document).scrollTop($(document).height()))},downloadAllResult:function(){window.location.href=t.contextRoot+this.downloadAllResultUrl},downloadFailResult:function(){window.location.href=t.contextRoot+this.downloadFailResultUrl}});return u});