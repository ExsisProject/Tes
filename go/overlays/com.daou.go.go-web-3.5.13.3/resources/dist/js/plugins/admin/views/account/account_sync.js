define(["jquery","backbone","app","hgn!admin/templates/account_sync","hgn!admin/templates/account_sync_item_head","i18n!admin/nls/admin","i18n!nls/commons","jquery.go-grid","GO.util"],function(e,t,n,r,i,s,o){var u={deleteJob:o["\uc0ad\uc81c"],detailJob:o["\uc0c1\uc138"],doSyncJob:o["\uc218\ud589"]},a=t.View.extend({events:{"click #sync_start":"syncStart","click #sync_detail":"syncDetail","click #sync_delete":"syncDelete","click #redo_checked_item":"syncCheckedJobItem","click #redo_all_failed_item":"syncAllFailedJobItem","click #redo_all_data_change":"syncAllDataChange"},initialize:function(){console.info("sync call !!!!")},render:function(){var t=this;this.$el.empty();var n=r({lang:u});return this.$el.html(n),this.renderSyncAdminJob(),e(".breadcrumb .path").html(s["AdminJob \uad00\ub9ac"]),this.$el},syncStart:function(){e.go(GO.contextRoot+"ad/api/sync/job","",{qryType:"post",async:!1,contentType:"application/json",responseFn:function(){e.goMessage(s["\uc218\ud589\uc774 \uc644\ub8cc\ub418\uc5c8\uc2b5\ub2c8\ub2e4."]),n.router.navigate("account/synchronization",{trigger:!0})},error:function(t){e.goMessage(t.responseJSON.message)}})},syncDetail:function(){var t=e("#admin_job_list tbody input[type=checkbox]:checked");if(t.length==0)return e.goMessage(s["\ud56d\ubaa9\uc774 \uc120\ud0dd\ub418\uc9c0 \uc54a\uc558\uc2b5\ub2c8\ub2e4."]);if(t.length>1)return e.goMessage(s["\ud56d\ubaa9\uc740 \ud55c\uac1c\ub9cc \uc120\ud0dd\uac00\ub2a5\ud569\ub2c8\ub2e4."]);var n=t[0].value,r=t.parent().parent().find("td:last").text();this.adminJobItemList&&this.adminJobItemList.tables.fnDestroy(),this.renderAdminJobItemList(n,"all",r),e("#admin_job_item_list").attr("job_id",n)},syncDelete:function(){var t=this,r=e("#admin_job_list tbody input[type=checkbox]:checked");if(r.length==0)return e.goMessage(s["\ud56d\ubaa9\uc774 \uc120\ud0dd\ub418\uc9c0 \uc54a\uc558\uc2b5\ub2c8\ub2e4."]);if(r.length>1)return e.goMessage(s["\ud56d\ubaa9\uc740 \ud55c\uac1c\ub9cc \uc120\ud0dd\uac00\ub2a5\ud569\ub2c8\ub2e4."]);var i=r[0].value;e.go(GO.contextRoot+"ad/api/adminjob/"+i,"",{qryType:"delete",async:!1,contentType:"application/json",responseFn:function(){e.goMessage(s["\uc0ad\uc81c\uac00 \uc644\ub8cc\ub418\uc5c8\uc2b5\ub2c8\ub2e4."]),n.router.navigate("account/synchronization",{trigger:!0})},error:function(t){e.goMessage(t.responseJSON.message)}})},syncCheckedJobItem:function(t){var r={},i=[],o=e("#admin_job_item_list").attr("job_id"),u=this.adminJobItemList.tables.getCheckedIds();if(u.length==0){e.goMessage(s["\ud56d\ubaa9\uc774 \uc120\ud0dd\ub418\uc9c0 \uc54a\uc558\uc2b5\ub2c8\ub2e4."]);return}for(var a=0;a<u.length;a++)i[a]=e("textarea[id="+u[a]+"]").val();r={itemIds:u,data:i},e.go(GO.contextRoot+"ad/api/adminjob/retry/site/"+o,JSON.stringify(r),{qryType:"post",async:!1,contentType:"application/json",responseFn:function(){e.goMessage(s["\uc218\ud589\uc774 \uc644\ub8cc\ub418\uc5c8\uc2b5\ub2c8\ub2e4."]),n.router.navigate("account/synchronization",{trigger:!0})},error:function(t){e.goMessage(t.responseJSON.message)}})},syncAllFailedJobItem:function(t){var r=e("#admin_job_item_list").attr("job_id"),i=e("textarea[name=FAIL]").map(function(t,n){return e(n).val()}).get(),o=JSON.stringify(i);e.go(GO.contextRoot+"ad/api/adminjob/retry/all/site/"+r,o,{qryType:"post",async:!1,contentType:"application/json",responseFn:function(){e.goMessage(s["\uc218\ud589\uc774 \uc644\ub8cc\ub418\uc5c8\uc2b5\ub2c8\ub2e4."]),n.router.navigate("account/synchronization",{trigger:!0})},error:function(t){e.goMessage(t.responseJSON.message)}})},getJobItem:function(t){var n=e.Deferred();return e.go(GO.contextRoot+"ad/api/adminjob/item/"+t,"",{qryType:"get",async:!1,contentType:"application/json",responseFn:function(e){n.resolve(e.data)},error:function(t){e.goMessage(t.responseJSON.message)}}),n.promise()},renderSyncAdminJob:function(){var t=this;this.$tableEl=this.$el.find("#admin_job_list"),this.adminJobList=e.goGrid({el:"#admin_job_list",method:"GET",destroy:!0,url:GO.contextRoot+"ad/api/site/adminjob/list",params:this.searchParams,emptyMessage:"<p class='data_null'> <span class='ic_data_type ic_no_data'></span><span class=\"txt\">"+o["\uc5c6\uc74c"]+"</span>"+"</p>",defaultSorting:[[6,"desc"]],sDomType:"admin",checkbox:!0,checkboxData:"jobId",columns:[{mData:"jobId",sWidth:"100px",bSortable:!1},{mData:"companyId",sWidth:"100px",bSortable:!0},{mData:"size",sWidth:"100px",bSortable:!0},{mData:"successCount",sWidth:"100px",bSortable:!0},{mData:"failCount",sWidth:"100px",bSortable:!0},{mData:"startedAt",bSortable:!0,fnRender:function(e){return GO.util.basicDate(e.aData.startedAt)}},{mData:"endedAt",bSortable:!0,fnRender:function(e){return GO.util.basicDate(e.aData.endedAt)}},{mData:null,sWidth:"150px",bSortable:!1,fnRender:function(e){return e.aData.operator!=undefined?e.aData.operator.name:""}},{mData:"jobName",bSortable:!0}],fnDrawCallback:function(e,n,r){t.$el.find("#admin_job_list_wrapper .toolbar_top .custom_header").append(t.$el.find("#controlButtons1").show())}})},renderAdminJobItemList:function(t,r){var u=this,a='<div id="controlButtons3" style="display: none"><span class="btn_tool" id="redo_checked_item">'+s["\uc120\ud0dd\ub370\uc774\ud130 \uc7ac\uc218\ud589"]+"</span>"+'<span class="btn_tool" id="redo_all_failed_item">'+s["\ubaa8\ub4e0 \uc2e4\ud328\ub370\uc774\ud130 \uc7ac\uc218\ud589"]+"</span>";this.$el.find("#admin_job_item_container").append(a),this.$tableEl=this.$el.find("#admin_job_item_list"),this.$tableEl.html(""),this.$tableEl.append(i()),this.adminJobItemList=e.goGrid({el:"#admin_job_item_list",method:"GET",destroy:!0,url:GO.contextRoot+"ad/api/adminjob/"+t+"/item/"+r,params:this.searchParams,checkbox:!0,checkboxData:"id",emptyMessage:'<p class=\'data_null\'> <span class="ic_data_type ic_no_data"></span><span class="txt">'+o["\uc5c6\uc74c"]+"</span>"+"</p>",defaultSorting:[[1,"asc"]],sDomType:"admin",displayLength:n.session("adminPageBase"),columns:[{mData:"id",sWidth:"100px",bSortable:!0},{mData:"jobId",sWidth:"100px",bSortable:!0},{mData:"orgItemId",sWidth:"100px",bSortable:!0},{mData:"status",sWidth:"100px",bSortable:!0},{mData:"data",bSortable:!0,fnRender:function(e){return'<textarea class="txtarea w_max" name="'+e.aData.status+'" id="'+e.aData.id+'" cols="80" rows="2" style="width: 700px">'+e.aData.data+"</textarea>"}},{mData:"message",bSortable:!0}],fnDrawCallback:function(e){u.$el.find("#admin_job_item_list_wrapper .toolbar_top .custom_header").append(u.$el.find("#controlButtons3").show())}}),console.log(this.adminJobItemList)}});return a});