define(function(require){var e=require("app"),t=require("underscore"),n=require("backbone"),r=require("i18n!admin/nls/admin"),i=require("i18n!nls/commons"),s=require("hgn!admin/templates/contact/company_form"),o=require("hgn!admin/templates/contact/company_empty"),u=require("views/circle_tableTmpl"),a=require("views/circle");require("jquery.go-popup");var f={"\uc8fc\uc18c\ub85d \uba85":r["\uc8fc\uc18c\ub85d \uba85"],"\uc6b4\uc601\uc790":r["\uc6b4\uc601\uc790"],"\uc5f4\ub78c\uc790 \uc124\uc815":r["\uc5f4\ub78c\uc790 \uc124\uc815"],"\uc608\uc678\uc790 \uc124\uc815":r["\uc608\uc678\uc790 \uc124\uc815"],"\uacf5\uc6a9 \uc8fc\uc18c\ub85d\uc744 \uc120\ud0dd\ud574 \uc8fc\uc138\uc694":r["\uacf5\uc6a9 \uc8fc\uc18c\ub85d\uc744 \uc120\ud0dd\ud574 \uc8fc\uc138\uc694"],"\uc804\uc0ac \uc8fc\uc18c\ub85d":r["\uc804\uc0ac \uc8fc\uc18c\ub85d"],"\uc800\uc7a5\ub418\uc5c8\uc2b5\ub2c8\ub2e4.":i["\uc800\uc7a5\ub418\uc5c8\uc2b5\ub2c8\ub2e4."],"\ucde8\uc18c\ub418\uc5c8\uc2b5\ub2c8\ub2e4.":i["\ucde8\uc18c\ub418\uc5c8\uc2b5\ub2c8\ub2e4."],"\uc800\uc7a5":i["\uc800\uc7a5"],"\ucde8\uc18c":i["\ucde8\uc18c"]},l=n.Model.extend({defaults:{},isSiteAdmin:!0,initialize:function(e){this.isSiteAdmin=t.isUndefined(e.isSiteAdmin)?this.isSiteAdmin:e.isSiteAdmin},urlRoot:function(){return this.isSiteAdmin?e.contextRoot+"ad/api/contact/companyfolder/manage":e.contextRoot+"api/contact/companyfolder/manage"}}),c=n.View.extend({className:"col2",events:{"click #save":"save","click #cancel":"cancel"},isAdmin:!0,isSiteAdmin:!0,initialize:function(e){this.accessTargetView=null,this.exceptionTargetView=null,this.isAdmin=t.isUndefined(e.isAdmin)?this.isAdmin:e.isAdmin,this.isSiteAdmin=t.isUndefined(e.isSiteAdmin)?this.isSiteAdmin:e.isSiteAdmin,this.model=new l({isSiteAdmin:this.isSiteAdmin})},render:function(n){this.model.set({id:n}),this.model.fetch({async:!1}),t.isUndefined(this.model.get("id"))?this.$el.html(o({lang:f})):this.$el.html(s({lang:f,name:this.model.get("name")}));var r=e.util.isUseOrgService(this.isSiteAdmin);this.renderAdminView(r),this.renderAccessTargetView(r),this.renderExceptionTargetView(r)},cancel:function(){$.goSlideMessage(f["\ucde8\uc18c\ub418\uc5c8\uc2b5\ub2c8\ub2e4."]),this.trigger("company_form.refresh")},save:function(){var e=this.$el,t=e.find("#name").val(),n=this.accessTargetView.getData(),r=this.exceptionTargetView.getData(),i=this.adminView.getData();this.model.set({name:t,accessTarget:n,exceptionTarget:r,admins:i},{silent:!0}),this.model.save().done($.proxy(function(){$.goMessage(f["\uc800\uc7a5\ub418\uc5c8\uc2b5\ub2c8\ub2e4."]),this.trigger("company_form.refresh")},this))},renderAdminView:function(e){var n=["user","position","grade","usergroup"];e&&(n=["user","department","position","grade","duty","usergroup"]),this.model.get("manager")!=null&&(this.model.get("manager").nodes=t.sortBy(this.model.get("manager").nodes,"nodeType")),this.adminView=new a({selector:"#admin",isAdmin:this.isSiteAdmin,isWriter:!0,circleJSON:this.model.get("admins"),nodeTypes:n}),this.adminView.render()},renderEmpty:function(){this.$el.html(o({lang:f}))},renderAccessTargetView:function(e){var n=["company","user","position","grade","usergroup"];e&&(n=["company","user","department","position","grade","duty","usergroup"]),this.model.get("accessTarget")!=null&&(this.model.get("accessTarget").nodes=t.sortBy(this.model.get("accessTarget").nodes,"nodeType")),this.accessTargetView=new u({selector:"#accessTarget",isAdmin:this.isSiteAdmin,isWriter:!0,circleJSON:this.model.get("accessTarget"),nodeTypes:n}),this.accessTargetView.render()},renderExceptionTargetView:function(e){var n=["user","position","grade","usergroup"];e&&(n=["user","department","position","grade","duty","usergroup"]),this.model.get("exceptionTarget")!=null&&(this.model.get("exceptionTarget").nodes=t.sortBy(this.model.get("exceptionTarget").nodes,"nodeType")),this.exceptionTargetView=new u({selector:"#exceptionTarget",isExceptionList:!0,isAdmin:this.isSiteAdmin,isWriter:!0,circleJSON:this.model.get("exceptionTarget"),nodeTypes:n}),this.exceptionTargetView.render()}});return c});