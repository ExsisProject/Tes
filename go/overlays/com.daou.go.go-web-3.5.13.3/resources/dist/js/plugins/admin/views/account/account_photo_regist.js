define(["jquery","underscore","backbone","app","hgn!admin/templates/account_photo_regist","i18n!nls/commons","i18n!approval/nls/approval","i18n!admin/nls/admin","file_upload","swfupload","swfupload.plugin","jquery.progressbar"],function(e,t,n,r,i,s,o,u,a){var f=n.Model.extend({url:function(){return"/ad/api/account/photo/regist"}}),l={photo_regist:u["\uc0ac\uc9c4 \uc77c\uad04\ub4f1\ub85d"],id:o["\uc544\uc774\ub514\ub85c \uad6c\ubd84"],empno:o["\uc0ac\ubc88\uc73c\ub85c \uad6c\ubd84"],select_file:u["\ud30c\uc77c \ucc3e\uae30"],start_regist:o["\ub4f1\ub85d\uc2dc\uc791"],save:s["\uc800\uc7a5"],cancel:s["\ucde8\uc18c"],upload_must_zipfile:u["\uc0ac\uc9c4 \uc77c\uad04\ub4f1\ub85d \uc124\uba85"],default_setting:o["\uae30\ubcf8 \uc124\uc815"]},c={boxImage:r.contextRoot+"resources/images/progressbar.gif",barImage:r.contextRoot+"resources/images/progressbg_green_200.gif",width:200,max:100},h=n.View.extend({events:{"click.photoReg #add_photo":"uploadStart","click.photoReg span.ic_del":"deleteFile"},initialize:function(){},render:function(t){return this.$el.html(i({lang:l})),this.initFileUpload(),e("#photoResultDiv").hide(),this},deleteFile:function(){e("#fileComplete").html("")},uploadStart:function(){var t=this,n=e(':radio[name="photoType"]:checked').attr("id");if(!n)return e.goError(o["\uad6c\ubd84\uc744 \uc120\ud0dd \ud558\uc9c0 \uc54a\uc558\uc2b5\ub2c8\ub2e4."]),!1;if(!e("#file_name").val())return e.goError(u["\uc77c\uad04\ub4f1\ub85d \ud30c\uc77c \uc120\ud0dd"]),!1;var i=new f;e.goConfirm(o["\uc800\uc7a5\ud558\uc2dc\uaca0\uc2b5\ub2c8\uae4c?"],"",function(){i.set({fileName:e("#file_name").val(),filePath:e("#file_path").val(),hostId:e("#host_id").val(),signType:n},{silent:!0}),r.EventEmitter.trigger("common","layout:setOverlay",u["\ub85c\ub529\uc911"]),i.save({},{type:"PUT",success:function(n,i){r.EventEmitter.trigger("common","layout:clearOverlay",!0),i.code==200&&(e.goMessage(o["\uc800\uc7a5\uc774 \uc644\ub8cc\ub418\uc5c8\uc2b5\ub2c8\ub2e4."]),t.drawSuccessList(i.data),t.deleteFile())},error:function(n,i){var s=JSON.parse(i.responseText);return r.EventEmitter.trigger("common","layout:clearOverlay",!0),s.message?(e.goError(u["\ub4f1\ub85d\uc5d0 \uc2e4\ud328\ud588\uc2b5\ub2c8\ub2e4."]),t.drawFileUploadFailView(i.data),t.deleteFile(),!1):(e.goError(u["\ub4f1\ub85d\uc5d0 \uc2e4\ud328\ud588\uc2b5\ub2c8\ub2e4."]),t.drawFileUploadFailView(i.data),t.deleteFile(),!1)}})})},drawSuccessList:function(t){e("#photoResultDiv").show();var n="";n+='<li><span class="txt">'+u["\uc774\ubbf8\uc9c0 \ud30c\uc77c"]+" "+e("#file_name").val()+" "+u["\uc5c5\ub85c\ub4dc \uc644\ub8cc"]+"</span></li>",e("#photoResultDiv ul").empty(),e("#photoResultDiv ul").append(n),e.each(t,function(t,r){r.resultFlag?n='<li><span class="txt">'+r.zipFileName+" "+s["\uc800\uc7a5"]+" ["+r.userName+" ] "+"</span></li>":n='<li><span class="txt">'+r.zipFileName+" "+s["\uc2e4\ud328"]+"</span></li>",e("#photoResultDiv ul").append(n)})},drawFileUploadFailView:function(t){e("#photoResultDiv").show();var n="";n+='<li><span class="txt">'+u["\uc774\ubbf8\uc9c0 \ud30c\uc77c"]+" "+e("#file_name").val()+" "+u["\uc5c5\ub85c\ub4dc \uc2e4\ud328"]+"</span></li>",e("#photoResultDiv ul").empty(),e("#photoResultDiv ul").append(n)},initFileUpload:function(){var t=u["\ud30c\uc77c \ucc3e\uae30"],n=this,i={el:"#swfupload-control",context_root:r.contextRoot,button_text:"<span class='buttonText'>"+t+"</span>",progressBarUse:!0,url:"ad/api/file?GOAdminSSOcookie="+e.cookie("GOAdminSSOcookie")};(new a(i)).queue(function(e,t){}).start(function(t,n){var r=new RegExp("(.zip)","gi"),i=n.type.toLowerCase();if(!r.test(i))return e.goAlert(o["zip \ud30c\uc77c\ub9cc \ub4f1\ub85d \uac00\ub2a5\ud569\ub2c8\ub2e4."]),e("#progressbar").hide(),!1}).progress(function(e,t){}).success(function(t,n,i){if(r.util.fileUploadErrorCheck(n))return e.goAlert(r.util.serverMessage(n)),!1;e("#photoResultDiv").hide();var o=n.data,u=o.fileName,a=o.filePath,f=o.hostId,l=r.util.getHumanizedFileSize(o.fileSize),c="<li id='item_file'><span class='item_file'><span class='ic_file ic_def'></span><span class='name'>"+u+"</span>"+"<span class='size'>("+l+")</span>"+"<span class='btn_wrap' title='"+s["\uc0ad\uc81c"]+"'>"+"<span class='ic_classic ic_del'></span>"+"</span>"+"</span>"+"<input type='hidden' value='"+a+"' id='file_path'/>"+"<input type='hidden' value='"+u+"' id='file_name'/>"+"<input type='hidden' value='"+f+"' id='host_id'/>"+"</li>";e("#fileComplete").html(c)}).complete(function(e,t){console.info(t)}).error(function(e,t){console.info(t)})},release:function(){this.$el.off(),this.$el.empty()}});return h});