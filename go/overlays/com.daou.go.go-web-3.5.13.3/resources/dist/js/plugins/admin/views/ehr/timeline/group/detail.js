define("admin/views/ehr/timeline/group/detail",function(require){var e=require("backbone"),t=require("admin/views/ehr/timeline/group/rest_time_range"),n=require("admin/views/ehr/timeline/group/noti/noti_settings"),r=require("hgn!admin/templates/ehr/timeline/group/detail"),i=require("views/circle"),s=require("admin/models/ehr/timeline/group"),o=require("i18n!admin/nls/admin"),u=require("i18n!timeline/nls/timeline"),a=require("i18n!nls/commons"),f=require("app"),l=require("underscore");require("jquery.go-popup");var c=require("admin/views/info_layer"),h=require("admin/views/ehr/timeline/group/work_place"),p=24,d=60,v=60,m=l.range(0,p).map(function(e){return e<10?"0"+e:e}),g=l.range(0,d).map(function(e){return e<10?"0"+e:e}),y=l.range(0,v).map(function(e){return e<10?"0"+e:e}),b={FIXED_WORKING_TIME:["CLOCKIN","CLOCKOUT","OVER_TIME_40_BEFORE","OVER_TIME_52_BEFORE","REST_TIME"],FLEXIBLE_WORKING_TIME:["OVER_TIME_40_BEFORE","OVER_TIME_52_BEFORE","REST_TIME"],SELECTIVE_WORKING_TIME:["CLOCKIN","CLOCKOUT","REST_TIME","OVER_TIME_MONTH_MINIMUM_BEFORE","OVER_TIME_MONTH_MINIMUM_AFTER","OVER_TIME_MONTH_EXTENSION_MAXIMUM_BEFORE","OVER_TIME_MONTH_EXTENSION_MAXIMUM_AFTER"]},w=e.View.extend({events:{"change input:radio[name='workingTime']":"changeWorkingType","click #working_days button.btn_toggle":"toggleWorkingDay","click #device_check button.btn_toggle":"toggleDeviceCheck","click #save":"save","click .btn_wrap #remove":"remove","click .page_action #remove":"removeGroup","click #cancel":"cancel","click .onOffToggle":"onOffToggle"},initialize:function(){this.options.model?this.model=this.options.model:this.model=new s,this.extModel=this.options.extModel,this.restTimeRangeViews=this.makeRestPeriodViews(this.model),this.notiSettinsView=new n({collection:this.model.get("notiSettings"),hideNotis:b[this.model.getWorkingType()]}),this.workPlaceView=new h({group:this.model})},render:function(){var e=this;this.$el.html(r({AdminLang:o,CommonLang:a,TimeLineLang:u,syncActive:this.extModel.get("syncActive"),HOUR:m,MINUTE:g,SECOND:y,isNew:this.model.isNew(),data:this.model.toJSON(),workDay:this.model.getWorkDay(),isFixedWorkingType:this.model.isFixedWorkingTimeType(),isFlexibleWorkingTimeType:this.model.isFlexibleWorkingTimeType(),isSelectiveWorkingTimeType:this.model.isSelectiveWorkingTimeType(),isWorkStartHour:function(){return e.model.isWorkStartHour(this)},isWorkStartMinute:function(){return e.model.isWorkStartMinute(this)},isWorkStartSecond:function(){return e.model.isWorkStartSecond(this)},isWorkEndHour:function(){return e.model.isWorkEndHour(this)},isWorkEndMinute:function(){return e.model.isWorkEndMinute(this)},isWorkEndSecond:function(){return e.model.isWorkEndSecond(this)},enableDutyTime:this.model.enableDutyTime(),isDutyStartHour:function(){return e.model.isDutyStartHour(this)},isDutyStartMinute:function(){return e.model.isDutyStartMinute(this)},isDutyStartSecond:function(){return e.model.isDutyStartSecond(this)},isDutyEndHour:function(){return e.model.isDutyEndHour(this)},isDutyEndMinute:function(){return e.model.isDutyEndMinute(this)},isDutyEndSecond:function(){return e.model.isDutyEndSecond(this)},isIgnoreBeforeStart:function(){return e.model.isIgnoreBeforeStart()},isIgnoreAfterStart:function(){return e.model.isIgnoreAfterStart()},isIgnoreAfterEnd:function(){return e.model.isIgnoreAfterEnd()},isAutoClockOutDisable:function(){return e.model.isAutoClockOutDisable()},isAutoClockOutFixedTime:function(){return e.model.isAutoClockOutFixedTime()},isAutoClockOutFixedTimeHour:function(){return e.model.isAutoClockOutFixedTimeHour(this)},isAutoClockOutFixedTimeMinute:function(){return e.model.isAutoClockOutFixedTimeMinute(this)},isAutoClockOutFixedTimeSecond:function(){return e.model.isAutoClockOutFixedTimeSecond(this)},isAutoClockOutRelativeTime:function(){return e.model.isAutoClockOutRelativeTime()},isAutoClockOutRelativeTimeHour:function(){return e.model.isAutoClockOutRelativeTimeHour(this)},isAutoClockOutRelativeTimeSecond:function(){return e.model.isAutoClockOutRelativeTimeSecond(this)},isNightStartHour:function(){return e.model.isNightStartHour(this)},isNightStartMinute:function(){return e.model.isNightStartMinute(this)},isNightStartSecond:function(){return e.model.isNightStartSecond(this)},isNightEndHour:function(){return e.model.isNightEndHour(this)},isNightEndMinute:function(){return e.model.isNightEndMinute(this)},isNightEndSecond:function(){return e.model.isNightEndSecond(this)},isMobileAllow:function(){return e.model.isMobileAllow()},useMobileGps:function(){return e.model.useMobileGps()},usePeriodSetting:function(){return e.model.usePeriodSetting()},isAccessBlack:function(){return e.model.isAccessBlack()},isAccessWhite:function(){return e.model.isAccessWhite()},isConsensusHoursPerDay:function(){return e.model.isConsensusHoursPerDay(this)},useWarningCheck:e.model.useWarningCheck(),privateIpAutoSave:e.model.usePrivateIpAutoSave()})),this.renderRestTimeRange(),this.renderPeriod(),this.renderAccessUserView(),this.renderExceptionUserView(),this.renderNotiSettings(),this.appendInfoLayer(),this.renderWorkPlaceView()},renderWorkPlaceView:function(){this.$el.find("#workPlaceSetting").html(this.workPlaceView.$el),this.workPlaceView.render()},appendInfoLayer:function(){this.infoLayer=new c({target:this.$el.closest(".admin_content").find("header.content_top > div"),title:u["\uadfc\ubb34 \uadf8\ub8f9 \uc124\uba85 \ud0c0\uc774\ud2c0"],title_desc:u["\uadfc\ubb34 \uadf8\ub8f9 \uc124\uba85 \uc11c\ube0c \ud0c0\uc774\ud2c0"],contents:[{title:u["\uadfc\ubb34 \uadf8\ub8f9 \uc124\uc815"],sub_titles:[{info:u["\uadfc\ubb34 \uadf8\ub8f9 \uc124\uc815 \uc124\uba85 \ud0c0\uc774\ud2c0"]},{info:u["\uadfc\ubb34 \uadf8\ub8f9 \uc124\uc815 \uc124\uba85 \ud0c0\uc774\ud2c0B"]}],description:[{info:u["\uadfc\ubb34 \uadf8\ub8f9 \uc124\uc815 \uc124\uba85A"]},{info:u["\uadfc\ubb34 \uadf8\ub8f9 \uc124\uc815 \uc124\uba85B"]}]},{title:u["\uadfc\ubb34 \uc77c\uc815"],sub_titles:[{info:u["\uadfc\ubb34\uc77c\uc815 \ud0c0\uc774\ud2c0"]}],description:[{info:u["\uadfc\ubb34\uc77c\uc815 \uc124\uba85A"]},{info:u["\uadfc\ubb34\uc77c\uc815 \uc124\uba85B"]},{info:u["\uadfc\ubb34\uc77c\uc815 \uc124\uba85C"]}]},{title:u["\uadfc\ubb34\uc2dc\uac04 \uc0b0\uc815"],sub_titles:[{info:u["\uadfc\ubb34\uc2dc\uac04 \uc0b0\uc815 \ud0c0\uc774\ud2c0A"]},{info:u["\uadfc\ubb34\uc2dc\uac04 \uc0b0\uc815 \ud0c0\uc774\ud2c0B"]}],description:[{info:u["\uadfc\ubb34\uc2dc\uac04 \uc124\uba85A"]},{info:u["\uadfc\ubb34\uc2dc\uac04 \uc124\uba85B"]}]},{title:u["\ucd94\uac00 \uad00\ub9ac\uae30\ub2a5"],sub_titles:[],description:[{info:u["\ucd94\uac00 \uad00\ub9ac\uae30\ub2a5 \uc124\uba85A"]},{info:u["\ucd94\uac00 \uad00\ub9ac\uae30\ub2a5 \uc124\uba85B"]},{info:u["\ucd94\uac00 \uad00\ub9ac\uae30\ub2a5 \uc124\uba85C"]},{info:u["\ucd94\uac00 \uad00\ub9ac\uae30\ub2a5 \uc124\uba85D"]}]}]}),this.infoLayer.render()},makeRestPeriodViews:function(e){return l.chain(e.get("restperiods")).map(function(e){return new t({data:e})}).value()},save:function(){var e=this;this.model.save(this.getVariable(),{success:function(t,n){n.code=="200"&&($.goMessage(a["\uc800\uc7a5\ub418\uc5c8\uc2b5\ub2c8\ub2e4."]),f.EventEmitter.trigger("timeline","changed:groups",""),f.EventEmitter.trigger("common","layout:clearOverlay",!0),e.trigger("change",t.get("originGroupId")))},error:function(e,t){$.goMessage(a["\uc800\uc7a5\uc5d0 \uc2e4\ud328 \ud558\uc600\uc2b5\ub2c8\ub2e4."]),f.EventEmitter.trigger("common","layout:clearOverlay",!0)}})},removeGroup:function(){var e=this;$.goConfirm(a["\uc0ad\uc81c\ud558\uc2dc\uaca0\uc2b5\ub2c8\uae4c?"],"",l.bind(function(){this.model.destroy({success:function(){f.EventEmitter.trigger("timeline","changed:groups",""),$.goMessage(a["\uc0ad\uc81c\ub418\uc5c8\uc2b5\ub2c8\ub2e4."]),e.trigger("deleted")}})},this))},cancel:function(){$.goMessage(a["\ucde8\uc18c\ub418\uc5c8\uc2b5\ub2c8\ub2e4."]),this.restTimeRangeViews=this.makeRestPeriodViews(this.model),this.render()},renderNotiSettings:function(){this.$el.find("#noti_setting").html(this.notiSettinsView.$el),this.notiSettinsView.render()},renderRestTimeRange:function(){var e=this.$el.find("#restTimeRange");e.empty(),l.chain(this.restTimeRangeViews).map(function(n,r){function s(e){e.on("add",function(e){var n=new t;$(e.$el).after(n.$el),n.render(!0),this.restTimeRangeViews.splice(this.restTimeRangeViews.indexOf(e)+1,0,n),s.call(this,n)},this),e.on("remove",function(e){if(this.restTimeRangeViews.length<2)throw $.goError(o["\ucd5c\uc18c 1\uac1c\ub294 \uc874\uc7ac\ud574\uc57c \ud569\ub2c8\ub2e4."]),new Error(o["\ucd5c\uc18c 1\uac1c\ub294 \uc874\uc7ac\ud574\uc57c \ud569\ub2c8\ub2e4."]);this.restTimeRangeViews=l.without(this.restTimeRangeViews,e)},this)}e.append(n.$el);var i=r>0;n.render(i),s.call(this,n)},this).value()},renderPeriod:function(){$.datepicker.setDefaults($.datepicker.regional[f.config("locale")]);var e=this.$el.find("#startDate"),t=this.$el.find("#endDate");this.model.isNew()?(e.val(f.util.now().format("YYYY-MM-DD")),t.val(f.util.now().format("YYYY-MM-DD"))):(e.val(this.model.getPeriodStartDate()),t.val(this.model.getPeriodEndDate())),e.datepicker({dateFormat:"yy-mm-dd",changeMonth:!0,changeYear:!0,yearSuffix:"",onSelect:function(e){t.datepicker("option","minDate",e)}}),t.datepicker({dateFormat:"yy-mm-dd",changeMonth:!0,changeYear:!0,yearSuffix:"",onSelect:function(t){e.datepicker("option","maxDate",t)}})},renderAccessUserView:function(){var e=["user","position","grade","usergroup"];f.util.isUseOrgService(!0)&&(e=["user","department","position","grade","duty","usergroup"]),this.accessTarget=new i({selector:"#groupAccessUser",isAdmin:!0,isWriter:!0,circleJSON:this.model.get("circleSetting").accessTarget,nodeTypes:e}),this.accessTarget.render()},renderExceptionUserView:function(){var e=["user","position","grade","usergroup"];f.util.isUseOrgService(!0)&&(e=["user","department","position","grade","duty","usergroup"]),this.exceptionTarget=new i({selector:"#groupExceptionUser",isAdmin:!0,isWriter:!0,circleJSON:this.model.get("circleSetting").exceptionTarget,nodeTypes:e}),this.exceptionTarget.render()},changeWorkingType:function(e){var t=$(e.currentTarget).val(),n=this.$el.find("[data-option='timeFixed']"),r=this.$el.find('[data-option="selectiveOption"]');t=="FLEXIBLE_WORKING_TIME"?(n.hide(),r.hide()):t=="SELECTIVE_WORKING_TIME"?(n.show(),r.show()):(n.show(),r.hide()),this.notiSettinsView.renderNotiList(b[t])},toggleWorkingDay:function(e){$(e.currentTarget).toggleClass("on")},toggleDeviceCheck:function(e){var t=$(e.currentTarget),n=t.data("type");if(n=="PC_WEB")return;t.toggleClass("on"),t.hasClass("on")||this.$el.find("#useMobileGps").removeAttr("checked"),this.$el.find("#useGpsArea").toggle()},getVariable:function(){function n(){var e=t.workingType;return e=="FLEXIBLE_WORKING_TIME"?["CLOCKIN","CLOCKOUT","OVER_TIME_MONTH_MINIMUM_BEFORE","OVER_TIME_MONTH_MINIMUM_AFTER","OVER_TIME_MONTH_EXTENSION_MAXIMUM_BEFORE","OVER_TIME_MONTH_EXTENSION_MAXIMUM_AFTER"]:e=="SELECTIVE_WORKING_TIME"?["OVER_TIME_40_BEFORE","OVER_TIME_52_BEFORE"]:e=="FIXED_WORKING_TIME"?["OVER_TIME_MONTH_MINIMUM_BEFORE","OVER_TIME_MONTH_MINIMUM_AFTER","OVER_TIME_MONTH_EXTENSION_MAXIMUM_BEFORE","OVER_TIME_MONTH_EXTENSION_MAXIMUM_AFTER"]:[]}function r(t){if(t["workingType"]=="FLEXIBLE_WORKING_TIME"){t.fixedOption={workDay:JSON.stringify(l.chain(["Mon","Tue","Wed","Thu","Fri","Sat","Sun"]).map(function(t){var n={};return n[t]=e.find("#working_days button[name="+t+"]").hasClass("on"),n}).reduce(function(e,t){return l.extend(e,t)}).value())};return}var n=t["workingType"]=="SELECTIVE_WORKING_TIME";t.fixedOption={workDay:JSON.stringify(l.chain(["Mon","Tue","Wed","Thu","Fri","Sat","Sun"]).map(function(t){var n={};return n[t]=e.find("#working_days button[name="+t+"]").hasClass("on"),n}).reduce(function(e,t){return l.extend(e,t)}).value()),autoSetWorkTime:{ignoreBeforeStart:e.find("#ignoreBeforeStart").is(":checked"),ignoreAfterStart:e.find("#ignoreAfterStart").is(":checked"),ignoreAfterEnd:e.find("#ignoreAfterEnd").is(":checked")},workTimeRange:{workStartTime:e.find("#workStartHour").val()+":"+e.find("#workStartMinute").val()+":"+e.find("#workStartSecond").val(),workEndTime:e.find("#workEndHour").val()+":"+e.find("#workEndMinute").val()+":"+e.find("#workEndSecond").val(),enableDutyTime:n?e.find("#enableDutyTime").is(":checked"):null,dutyStartTime:n?e.find("#dutyStartHour").val()+":"+e.find("#dutyStartMinute").val()+":"+e.find("#dutyStartSecond").val():null,dutyEndTime:n?e.find("#dutyEndHour").val()+":"+e.find("#dutyEndMinute").val()+":"+e.find("#dutyEndSecond").val():null,nightStartTime:e.find("#nightStartHour").val()+":"+e.find("#nightStartMinute").val()+":"+e.find("#nightStartSecond").val(),nightEndTime:e.find("#nightEndHour").val()+":"+e.find("#nightEndMinute").val()+":"+e.find("#nightEndSecond").val()},autoClockOut:{type:e.find("input:radio[name='timelineAutoClockOut']:checked").val(),fixedTime:e.find("#autoClockOutfixedTimeHour").val()+":"+e.find("#autoClockOutfixedTimeMinute").val()+":"+e.find("#autoClockOutfixedTimeSecond").val(),relativeHour:e.find("#autoClockOutRelativeTimeHour").val()}}}var e=this.$el,t={};return t.oldGroupId="",t.name=e.find("#group_name").val(),t.description=e.find("#groupDesc").val(),t.workingType=e.find("input[name='workingTime']:checked").val(),t.consensusHoursPerDay=e.find("#consensusHoursPerDay").val(),r(t),t.usagePeriod={usePeriodSetting:e.find("#usePeriodSetting").is(":checked"),startDate:this.model.isDefaultGroup()?null:f.util.toISO8601(f.util.toMoment(e.find("#startDate").val())),endDate:this.model.isDefaultGroup()?null:f.util.toISO8601(f.util.toMoment(e.find("#endDate").val()).add(1,"days").add(-1,"seconds"))},t.restperiods=l.chain(this.restTimeRangeViews).map(function(e){return e.getVariable()}).value(),t.circleSetting={accessSetting:e.find("input[name='accessSetting']:checked").val(),accessTarget:this.accessTarget.getData(),exceptionTarget:this.exceptionTarget.getData()},t.deviceSetting={allowDevice:l.chain(e.find("#device_check button.on")).map(function(e){return $(e).data("type")}).value(),useMobileGps:e.find("#useMobileGps").is(":checked"),privateIpAutoSave:e.find("#privateIpAutoSave").is(".on")},t.notiSettings=this.notiSettinsView.getData(n()),t.workPlaces=this.workPlaceView.getSelectedWorkPlaces(),t.warningCheck=e.find("#useWarningCheck").is(".on"),t},onOffToggle:function(e){var t=$(e.currentTarget);t.hasClass("on")||(t.closest(".wrap_btn_toggle").find(".on").removeClass("on"),t.addClass("on"))}});return w});