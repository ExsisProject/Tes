(function(){define(["jquery","underscore","backbone","app","i18n!nls/commons","i18n!admin/nls/admin","hgn!admin/templates/report_forms","views/form_editor","admin/models/report_company_form","components/form_component_manager/report_form_manager","jquery.go-grid","jquery.go-popup","GO.util"],function(e,t,n,r,i,s,o,u,a,f){function h(e,t,n){}var l={save:i["\uc800\uc7a5"],cancel:i["\ucde8\uc18c"],remove_msg:i["\uc0ad\uc81c\ub418\uc5c8\uc2b5\ub2c8\ub2e4."],remove:i["\uc0ad\uc81c"],created_at:i["\ub4f1\ub85d\uc77c"],selection:i["\uc120\ud0dd"],search:i["\uac80\uc0c9"],preview:s["\ubbf8\ub9ac\ubcf4\uae30"],form_manage:s["\uc591\uc2dd \uad00\ub9ac"],remove_selection_alert:s["\uc0ad\uc81c\ud560 \uc591\uc2dd\uc744 \uc120\ud0dd\ud574 \uc8fc\uc138\uc694."],form_remove:s["\uacf5\uc6a9 \uc591\uc2dd \uc0ad\uc81c"],form_remove_alert:s["\uc120\ud0dd\ud55c \uacf5\uc6a9 \uc591\uc2dd\uc744 \uc0ad\uc81c \ud558\uc2dc\uaca0\uc2b5\ub2c8\uae4c?"],new_form_add:s["\uc0c8 \uc591\uc2dd \ucd94\uac00"],edit_form:s["\uc591\uc2dd \uc218\uc815"],save_form_msg:s["\uc591\uc2dd\uc774 \ucd94\uac00\ub418\uc5c8\uc2b5\ub2c8\ub2e4."],edit_form_msg:s["\uc591\uc2dd\uc774 \ubcc0\uacbd\ub418\uc5c8\uc2b5\ub2c8\ub2e4."],form_copy_alert:s["\uc0ac\ubcf8\uc744 \ub9cc\ub4e4 \uc591\uc2dd\uc744 \uc120\ud0dd\ud574 \uc8fc\uc138\uc694."],form_copy_msg:s["\uc591\uc2dd\uc774 \ubcf5\uc0ac \ub418\uc5c8\uc2b5\ub2c8\ub2e4."],form_empty_msg:s["\uacf5\uc6a9 \uc591\uc2dd\uc774 \uc5c6\uc2b5\ub2c8\ub2e4."],new_form:s["\uc0c8 \uc591\uc2dd"],copy_form:s["\uc0ac\ubcf8 \ub9cc\ub4e4\uae30"],form_name:s["\uc591\uc2dd \uc81c\ubaa9"]},c=n.View.extend({el:"#layoutContent",events:{"click #controlButtons span.remove":"remove","click #controlButtons span.create":"create","click #controlButtons span.copy":"copy","click input:checkbox":"toggleCheckbox","keydown #reportSearch input":"searchKeyboardEvent","click #reportSearch span.btn_search":"search"},initialize:function(){this.$el.off()},render:function(){var t=this;this.$el.html(o({lang:l})),reportFormGrid=e.goGrid({el:"#reportFormTable",method:"GET",sDomType:"admin",checkbox:!0,dstroy:!0,checkboxData:"id",params:{property:"createdAt",direction:"desc"},url:r.contextRoot+"ad/api/report/form/company",emptyMessage:"<p class='data_null'> <span class='ic_data_type ic_no_data'></span><span class='txt'>"+l.form_empty_msg+"</span>"+"</p>",defaultSorting:[[0,"asc"]],displayLength:r.session("adminPageBase"),columns:[{mData:"createdAt",sWidth:"250px",sClass:"status",bSortable:!1,fnRender:function(e){return r.util.basicDate3(e.aData.createdAt)}},{mData:"name",sClass:"title",bSortable:!1,fnRender:function(e){var t=e.aData;return'<span data-id="'+t.id+'">'+t.name+"</span>"}},{mData:null,sWidth:"450px",sClass:"status",bSortable:!1,fnRender:function(e){var t=e.aData;return'<span class="form_preview" data-id="'+t.id+'"><a class="btn_fn7">'+l.preview+"</a></span>"}}],fnDrawCallback:function(n,r,i){t.$el.find(".toolbar_top .custom_header").append(t.$el.find("#controlButtons").show()),t.$el.find("tr>td:nth-child(3) span").css("cursor","pointer").click(function(n){var r=e(n.currentTarget),i=a.get(r.attr("data-id"));t.renderFormEditView(i.get("content"),i.get("name"),i.get("id"))}),t.$el.find("tr>td:nth-child(4) span").css("cursor","pointer").click(function(t){var n=e(t.currentTarget),r=a.get(n.attr("data-id"));u.preview(r.get("content"),"")})}}),this.reportFormsTable=reportFormGrid.tables},toggleCheckbox:function(t){e(t.currentTarget).is(":checked")?e(t.currentTarget).attr("checked",!0):(this.$el.find("#checkedAll").attr("checked",!1),e(t.currentTarget).attr("checked",!1))},remove:function(){var t=this;ids=this.getCheckedIds();if(ids.length==0){e.goMessage(l.remove_selection_alert);return}e.goConfirm(l.form_remove,l.form_remove_alert,function(){var n=r.contextRoot+"ad/api/report/form";e.go(n,JSON.stringify({ids:ids}),{qryType:"DELETE",contentType:"application/json",responseFn:function(n){t.reload.call(t),e.goMessage(l.remove_msg)},error:function(e){}})})},getCheckedIds:function(){var t=[];return e.each(e("#reportFormTable td input:checkbox:checked"),function(n,r){t.push(e(r).val())}),t},renderFormEditView:function(n,r,i){var s=this,o=function(t,n){var r={name:t||"-",content:n};i&&(r.id=i);var o=new a;o.save(r,{success:function(){e.goMessage(i?l.edit_form_msg:l.save_form_msg),s.reload.call(s)}})},u=e(".tWrap"),c=new f(t.extend({lang:"ko"},{title:r,content:n,saveCallback:o,toggleEl:u,useLoadForm:!1}));u.hide(),e("body").append(c.render().el)},create:function(){this.renderFormEditView("")},copy:function(){var t=r.contextRoot+"ad/api/report/form/copy",n=this,i=this.getCheckedIds();if(i.length==0){e.goMessage(l.form_copy_alert);return}e.go(t,JSON.stringify({ids:this.getCheckedIds()}),{qryType:"POST",contentType:"application/json",responseFn:function(t){e.goMessage(l.form_copy_msg),n.reload.call(n)},error:function(e){}})},release:function(){this.childView.release(),this.$el.off(),this.$el.empty(),this.remove()},reload:function(){this.reportFormsTable.reload()},searchKeyboardEvent:function(e){e.keyCode==13&&this.search()},search:function(){var e=this,t=this.$el.find('#reportSearch input[type="text"]'),n=t.val();this.reportFormsTable.search(this.$el.find("#searchSelect").val(),n,t)}},{__instance__:null,create:function(){return this.__instance__===null&&(this.__instance__=new this.prototype.constructor),this.__instance__}});return c})})();