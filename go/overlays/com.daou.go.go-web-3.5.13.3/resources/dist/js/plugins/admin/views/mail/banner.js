(function(){define(["jquery","backbone","app","admin/models/mail_banner","hgn!admin/templates/mail/banner","hgn!admin/templates/mail/banner_edit","i18n!nls/commons","i18n!admin/nls/admin","content_viewer","GO.util","go-webeditor/jquery.go-webeditor"],function(e,t,n,r,i,s,o,u,a){var f=null,l={bannerDisplay:u["\ubc30\ub108\ud45c\uc2dc"],bannerSetting:u["\ubc30\ub108\uc124\uc815"],bannerConfigInfo:u["\uba54\uc77c \ubc30\ub108 \ud45c\uc2dc \uc548\ub0b4"],bannerNotFound:u["\ub4f1\ub85d\ub41c \ubc30\ub108\uac00 \uc5c6\uc2b5\ub2c8\ub2e4."],yes:o["\uc0ac\uc6a9"],no:u["\uc0ac\uc6a9 \uc548\ud568"],save:o["\uc800\uc7a5"],cancel:o["\ucde8\uc18c"],preview:o["\ubbf8\ub9ac\ubcf4\uae30"],edit:o["\ud3b8\uc9d1"],remove:o["\uc0ad\uc81c"],editMode:u["\ud3b8\uc9d1\uae30 \uc120\ud0dd"]},c=t.View.extend({el:"#layoutContent",initialize:function(){this.configModel=new t.Model,this.configModel.url=GO.contextRoot+"ad/api/mail/bannerconfig",this.configModel.fetch({async:!1}),this.bannerModel=new r},render:function(){this.bannerModel.fetch({async:!1});var e=this.configModel.toJSON();e.isBannerDisplayOn=e.bannerDisplay==="on"?!0:!1;var t=this.bannerModel.toJSON();this.isEditMode=!1,this.isCreate=this.bannerModel.has("content")?!1:!0,this.contentType=t.contentType?t.contentType:"HTML";var n=i({lang:l,config:e,banner:t,isCreate:this.isCreate});this.$el.html(n),this.contentViewer=a.init({$el:this.$("#bannerContentArea"),content:this.bannerModel.get("content")}),this.toggleDeleteButton()},delegateEvents:function(t){this.$el.on("click","#btnModifyBanner",e.proxy(this.modifyBanner,this)),this.$el.on("click","#btnDeleteBanner",e.proxy(this.deleteBanner,this)),this.$el.on("click","#btnSaveBanner",e.proxy(this.saveBanner,this)),this.$el.on("click",".btn_nega",e.proxy(this.cancel,this))},undelegateEvents:function(){this.$el.off()},saveBannerConfig:function(){var t=GO.util.serializeForm(this.$el.find("#frmBannerConfig"));this.configModel.save(t,{async:!1,success:function(e,t){return!0},error:function(t,n){return GO.EventEmitter.trigger("common","layout:clearOverlay",!0),n.message?e.goAlert(n.message):e.goMessage(o["\uc2e4\ud328\ud588\uc2b5\ub2c8\ub2e4."]),!1}})},modifyBanner:function(){this.isEditMode=!0;var t=s({lang:l});this.$el.find("#trBannerContent").html(t),this.$el.off("change","#selContentType"),this.$el.on("change","#selContentType",e.proxy(this.selectContentType,this));var n=this.bannerModel.get("content");this.$el.find("#bannerContent").val(this.contentType==="TEXT"?n:""),this.initEditor(this.contentType==="HTML"?n:""),this.changeContentType()},saveBanner:function(){var t=this;if(t.contentType==="TEXT"&&!GO.Editor.getInstance("editor").validate())return e.goError(commonLang["\ub9c8\uc784 \uc0ac\uc774\uc988 \ucd08\uacfc"]),!1;GO.EventEmitter.trigger("common","layout:setOverlay","");var n=GO.util.serializeForm(this.$el.find("#frmBannerConfig")),t=this;this.configModel.save(n,{success:function(n,r){if(t.isEditMode){var i="";t.contentType==="TEXT"?i=t.$el.find("#bannerContent").val():i=t.getContent();if(t.isContentEmpty(i))t.autoDeleteBanner(),GO.EventEmitter.trigger("common","layout:clearOverlay",!0),e.goMessage(o["\uc800\uc7a5\ub418\uc5c8\uc2b5\ub2c8\ub2e4."]);else{var s={contentType:t.contentType,content:i};t.bannerModel.save(s,{success:function(){t.render(),GO.EventEmitter.trigger("common","layout:clearOverlay",!0),e.goMessage(o["\uc800\uc7a5\ub418\uc5c8\uc2b5\ub2c8\ub2e4."])},error:function(n,r){t.render(),GO.EventEmitter.trigger("common","layout:clearOverlay",!0),r.message?e.goAlert(r.message):e.goMessage(o["\uc2e4\ud328\ud588\uc2b5\ub2c8\ub2e4."])}})}}else t.render(),GO.EventEmitter.trigger("common","layout:clearOverlay",!0),e.goMessage(o["\uc800\uc7a5\ub418\uc5c8\uc2b5\ub2c8\ub2e4."])},error:function(t,n){return GO.EventEmitter.trigger("common","layout:clearOverlay",!0),n.message?e.goAlert(n.message):e.goMessage(o["\uc2e4\ud328\ud588\uc2b5\ub2c8\ub2e4."]),!1}})},deleteBanner:function(){GO.EventEmitter.trigger("common","layout:setOverlay","");var t=this;e.goConfirm(u["\uba54\uc77c \ubc30\ub108 \uc0ad\uc81c \uc54c\ub9bc"],u["\uba54\uc77c \ubc30\ub108 \uc0ad\uc81c \uc54c\ub9bc \ub0b4\uc6a9"],function(){t.bannerModel.destroy({success:function(n){t.bannerModel=new r,t.render(),GO.EventEmitter.trigger("common","layout:clearOverlay",!0),e.goMessage(u["\uba54\uc77c \ubc30\ub108\ub97c \uc0ad\uc81c \ud558\uc600\uc2b5\ub2c8\ub2e4."])},error:function(n,r){t.render(),GO.EventEmitter.trigger("common","layout:clearOverlay",!0),r.message?e.goAlert(r.message):e.goMessage(o["\uc2e4\ud328\ud588\uc2b5\ub2c8\ub2e4."])}})})},autoDeleteBanner:function(){var t=this;this.bannerModel.destroy({success:function(e){t.bannerModel=new r,t.render()},error:function(n,r){t.render(),r.message?e.goAlert(r.message):e.goMessage(o["\uc2e4\ud328\ud588\uc2b5\ub2c8\ub2e4."])}})},cancel:function(){var t=this;e.goCaution(o["\ucde8\uc18c"],o["\ubcc0\uacbd\ud55c \ub0b4\uc6a9\uc744 \ucde8\uc18c\ud569\ub2c8\ub2e4."],function(){t.render(),e.goMessage(o["\ucde8\uc18c\ub418\uc5c8\uc2b5\ub2c8\ub2e4."])},o["\ud655\uc778"])},initEditor:function(e){var t=GO.session("locale");this.$el.find("#editor").goWebEditor({lang:t,editorValue:e,contextRoot:GO.config("contextRoot")})},selectContentType:function(){var t=this.contentType,n=this;e.goConfirm(u["\ud3b8\uc9d1 \ubaa8\ub4dc \ubcc0\uacbd"],u["\ud3b8\uc9d1 \ubaa8\ub4dc \ubcc0\uacbd \uc54c\ub9bc"],function(){n.contentType=e("#selContentType").val(),n.clearContent(),n.changeContentType()},o["\ud655\uc778"],function(){n.$el.find("#selContentType").val(t)})},changeContentType:function(){this.contentType==="TEXT"?(this.$el.find("#selContentType").val("TEXT"),this.$el.find("#trTextContent").show(),this.$el.find("#trEditorContent").hide()):(this.$el.find("#selContentType").val("HTML"),this.$el.find("#trTextContent").hide(),this.$el.find("#trEditorContent").show())},getContent:function(){return this.contentType==="TEXT"?this.$el.find("#bannerContent").val():GO.Editor.getInstance("editor").getContent()},clearContent:function(){this.contentType==="TEXT"?GO.Editor.getInstance("editor").setContent(" "):this.$el.find("#bannerContent").val("")},isContentEmpty:function(e){return e=e.split(" ").join(""),e=e.split("<br>").join(""),e=e.split("&nbsp;").join(""),e=e.split("<p>").join(""),e=e.split("</p>").join(""),e=e.replace(/\r\n/g,""),e=e.replace(/\n/g,""),e=e.replace(/\r/g,""),e==""?!0:!1},toggleDeleteButton:function(){this.isCreate?this.$el.find("#btnDeleteBanner").hide():this.$el.find("#btnDeleteBanner").show()}});return c})}).call(this);