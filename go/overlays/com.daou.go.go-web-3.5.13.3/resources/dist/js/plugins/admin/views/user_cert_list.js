define(["jquery","backbone","app","hgn!admin/templates/user_cert_list","admin/collections/position_list","i18n!nls/commons","i18n!admin/nls/admin","jquery.go-sdk","GO.util","jquery.go-popup","jquery.go-grid"],function(e,t,n,r,i,s,o){var u={use_cert_list:o["\uc778\uc99d\uc11c \uc0ac\uc6a9 \uacc4\uc815"],unuse_cert_list:o["\uc778\uc99d\uc11c \ube44\uc0ac\uc6a9 \uacc4\uc815"],goto_unuse:o["\uc778\uc99d\uc11c \ube44\uc0ac\uc6a9 \uacc4\uc815\uc73c\ub85c \ubcc0\uacbd"],goto_use:o["\uc778\uc99d\uc11c \uc0ac\uc6a9 \uacc4\uc815\uc73c\ub85c \ubcc0\uacbd"],name:s["\uc774\ub984"],position:o["\uc9c1\uc704"],email:s["\uc774\uba54\uc77c"],registedate:o["\uc778\uc99d\uc11c \ub4f1\ub85d\uc77c"],search:s["\uac80\uc0c9"]},a=null,f=t.View.extend({el:"#certListPage",unbindEvent:function(){this.$el.off("click","#tabControll li"),this.$el.off("change","#position"),this.$el.off("click","span.btn_search"),this.$el.off("keydown","span.search_wrap input"),this.$el.off("click","span#goto_unuse"),this.$el.off("click","span#goto_use")},bindEvent:function(){this.$el.on("click","#tabControll li",e.proxy(this.changeTab,this)),this.$el.on("change","#position",e.proxy(this.positionFilter,this)),this.$el.on("click","span.btn_search",e.proxy(this.search,this)),this.$el.on("keydown","span.search_wrap input",e.proxy(this.searchKeyboardEvent,this)),this.$el.on("click","span#goto_unuse",e.proxy(this.goToUnUseCert,this)),this.$el.on("click","span#goto_use",e.proxy(this.goToUseCert,this))},initialize:function(){this.unbindEvent(),this.bindEvent(),this.type="USE",this.positions=i.getCollection()},render:function(e){this.dataTable=null;var t=function(){return e=="USE"?!0:!1},n=r({positions:this.positions.toJSON(),isUse:t,lang:u});this.$el.html(n),this.renderDataTables()},renderDataTables:function(){var t=this;this.dataTable=e.goGrid({el:"#certDataTable",method:"GET",destroy:!0,url:GO.contextRoot+"ad/api/cert/user/"+this.type,emptyMessage:"<p class='data_null'> <span class='ic_data_type ic_no_data'></span><span class='txt'>"+o["\ub4f1\ub85d\ub41c \uacc4\uc815\uc774 \uc5c6\uc2b5\ub2c8\ub2e4."]+"</span>"+"</p>",defaultSorting:[[1,"asc"]],sDomType:"admin",checkbox:!0,checkboxData:"id",displayLength:n.session("adminPageBase"),params:{page:this.page,offset:this.offset},columns:[{mData:"name",sClass:"title",bSortable:!0},{mData:"position",sClass:"align_c",sWidth:"200px",bSortable:!1},{mData:"email",sClass:"title",bSortable:!0},{mData:null,sClass:"align_c",sWidth:"200px",bSortable:!1,fnRender:function(e){return e.aData.registeredDate==null||e.aData.registeredDate==""?s["\uc5c6\uc74c"]:GO.util.basicDate(e.aData.registeredDate)}}],fnDrawCallback:function(e,n,r){t.$el.find(".toolbar_top .custom_header").append(t.$el.find("#controlButtons").show())}})},positionFilter:function(e){this.changeFilter(e,"positionFilter")},changeFilter:function(t,n){var r=e(t.currentTarget).val();console.log(this.dataTable.tables.setParam),typeof this.dataTable.tables.setParam=="function"&&this.dataTable.tables.setParam(n,r)},search:function(){var e=this.$el.find('.table_search input[type="text"]'),t=e.val();this.dataTable.tables.search(this.$el.find(".table_search select").val(),t,e)},searchKeyboardEvent:function(e){e.keyCode==13&&this.search()},changeTab:function(t){var n=e(t.currentTarget);this.type=n.attr("data-type"),this.render(this.type)},goToUnUseCert:function(e){this.changeUseCert("UNUSE")},goToUseCert:function(e){this.changeUseCert("USE")},changeUseCert:function(t){var n=this.getCheckedIds(),r=this;if(n.length==0){e.goMessage(o["\uacc4\uc815\uc744 \uc120\ud0dd\ud558\uc138\uc694."]);return}var i="",u="";t=="USE"?(i=o["\uc778\uc99d\uc11c \uc0ac\uc6a9 \uacc4\uc815\uc73c\ub85c \ubcc0\uacbd"],u=o["\uc778\uc99d\uc11c \ub85c\uadf8\uc778 \uc774\ub3d9 \uc0c1\uc138"]):(i=o["\uc778\uc99d\uc11c \ube44\uc0ac\uc6a9 \uacc4\uc815\uc73c\ub85c \ubcc0\uacbd"],u=o["\uc608\uc678\uacc4\uc815 \uc774\ub3d9 \uc0c1\uc138"]),e.goConfirm(i,u,function(){e.ajax({type:"PUT",async:!0,data:JSON.stringify({ids:n}),dataType:"json",contentType:"application/json",url:GO.config("contextRoot")+"ad/api/cert/user/"+t}).done(function(t){e.goMessage(s["\uc800\uc7a5\ub418\uc5c8\uc2b5\ub2c8\ub2e4."]),r.render(r.type)})})},getCheckedIds:function(){var t=this.$el.find("#certDataTable input:checkbox:checked").not("#checkedAll");return checkedIds=[],t.each(function(){checkedIds.push(e(this).val())}),checkedIds}},{create:function(e){return a=new f,a.render("USE")}});return{render:function(){var e=f.create();return e}}});