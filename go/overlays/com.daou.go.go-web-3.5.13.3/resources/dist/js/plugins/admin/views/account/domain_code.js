define("admin/views/account/domain_code",function(require){var e=require("jquery"),t=require("backbone"),n=require("app"),r=require("admin/models/install_info"),i=require("admin/models/domain_code"),s=require("admin/models/domain_code_by_id"),o=require("admin/views/account/domain_code_sample"),u=require("components/backdrop/backdrop"),a=require("hgn!admin/templates/domain_code_example"),f=require("hgn!admin/templates/domain_code"),l=require("hgn!admin/templates/domain_code_create"),c=require("hgn!admin/templates/domain_code_update"),h=require("hgn!admin/templates/list_empty"),p=require("i18n!nls/commons"),d=require("i18n!admin/nls/admin");require("jquery.go-grid"),require("jquery.go-validation"),require("jquery.go-popup"),require("jquery.go-sdk"),require("jquery.go-grid"),require("GO.util");var v={label_position:d["\uc9c1\uc704"],label_duty:d["\uc9c1\ucc45"],label_grade:d["\uc9c1\uae09"],label_usergroup:d["\uc0ac\uc6a9\uc790\uadf8\ub8f9"],label_position_desc:d["\uc9c1\uc704 \uc124\uba85"],label_duty_desc:d["\uc9c1\ucc45 \uc124\uba85"],label_grade_desc:d["\uc9c1\uae09 \uc124\uba85"],label_usergroup_desc:d["\uc0ac\uc6a9\uc790\uadf8\ub8f9 \uc124\uba85"],label_list:p["\ubaa9\ub85d"],label_downloadExcelBatchRegist:d["\uc5d1\uc140 \ub0b4\ub824\ubc1b\uae30/\uc77c\uad04\ub4f1\ub85d"],label_add:d["\ucd94\uac00"],label_delete:p["\uc0ad\uc81c"],label_order:d["\uc21c\uc11c \ubc14\uafb8\uae30"],label_name:d["\uba85\uce6d"],label_code:d["\ucf54\ub4dc"],label_account:d["\uc0ac\uc6a9\uba64\ubc84(\uba85)"],label_ok:p["\uc800\uc7a5"],label_cancel:p["\ucde8\uc18c"],label_fail:p["\uc2e4\ud328"],label_useTemplateSuggestion:d["\uc6b0\uce21 \ud15c\ud50c\ub9bf\uc5d0\uc11c \ud56d\ubaa9\uc744 \uc120\ud0dd\ud558\uc5ec \uc9c1\uc704 \uccb4\uacc4\ub97c \uc124\uacc4\ud558\uc138\uc694"],label_failDesc:p["\uc2e4\ud328\ud588\uc2b5\ub2c8\ub2e4."],label_edit:p["\uc218\uc815"],label_open:p["\uc5f4\uae30"],label_close:p["\ub2eb\uae30"],label_multi_lang:d["\ub2e4\uad6d\uc5b4"],label_ko:d.KO,label_en:d.EN,label_jp:d.JP,label_zhcn:d["ZH-CN"],label_zhtw:d["ZH-TW"],label_vi:d.VI,label_info_add:d["\ud56d\ubaa9\ucd94\uac00"],label_info_add_select:d["\ucd94\uac00\ud560 \ud56d\ubaa9\uc744 \uc120\ud0dd\ud558\uc138\uc694."],label_alert:d["0\uc790\uc774\uc0c1 0\uc774\ud558 \uc785\ub825\ud574\uc57c\ud569\ub2c8\ub2e4."],label_save:p["\uc800\uc7a5\ub418\uc5c8\uc2b5\ub2c8\ub2e4."],label_used_delete:d["\uc0ac\uc6a9\uc911\uc778\ub3c4\uba54\uc778\ucf54\ub4dc\uc0ad\uc81c\ubd88\uac00"],label_bring_item:d["\ud56d\ubaa9 \uac00\uc838\uc624\uae30"],example_layer_title:d["\uc608\uc2dc\ub97c \ud1b5\ud574 \uc27d\uac8c \uc774\ud574\ud558\ub294 \uc9c1\uc704 \uccb4\uacc4"],example_layer_desc:d["\uc608\uc2dc\ub97c \ud1b5\ud574 \uc27d\uac8c \uc774\ud574\ud558\ub294 \uc9c1\uc704 \uccb4\uacc4 \uc124\uba85"],position_example:d["\uc9c1\uc704 \uc608\uc2dc"],position_example_desc:d["\uc9c1\uc704 \uc608\uc2dc \uc124\uba85"],position_example_desc_detail_1:d["\uc9c1\uc704 \uc608\uc2dc \uc124\uba85 \uc138\ubd801"],position_example_desc_detail_2:d["\uc9c1\uc704 \uc608\uc2dc \uc124\uba85 \uc138\ubd802"],duty_example:d["\uc9c1\ucc45 \uc608\uc2dc"],duty_example_desc:d["\uc9c1\ucc45 \uc608\uc2dc \uc124\uba85"],duty_example_desc_detail_1:d["\uc9c1\ucc45 \uc608\uc2dc \uc124\uba85 \uc138\ubd801"],duty_example_desc_detail_2:d["\uc9c1\ucc45 \uc608\uc2dc \uc124\uba85 \uc138\ubd802"],grade_example:d["\uc9c1\uae09 \uc608\uc2dc"],grade_example_desc:d["\uc9c1\uae09 \uc608\uc2dc \uc124\uba85"],grade_example_desc_detail_1:d["\uc9c1\uae09 \uc608\uc2dc \uc124\uba85 \uc138\ubd801"],grade_example_desc_detail_2:d["\uc9c1\uae09 \uc608\uc2dc \uc124\uba85 \uc138\ubd802"],usergroup_example:d["\uc0ac\uc6a9\uc790\uadf8\ub8f9 \uc608\uc2dc"],usergroup_example_desc:d["\uc0ac\uc6a9\uc790\uadf8\ub8f9 \uc608\uc2dc \uc124\uba85"],usergroup_example_desc_detail_1:d["\uc0ac\uc6a9\uc790\uadf8\ub8f9 \uc608\uc2dc \uc124\uba85 \uc138\ubd801"],usergroup_example_desc_detail_2:d["\uc0ac\uc6a9\uc790\uadf8\ub8f9 \uc608\uc2dc \uc124\uba85 \uc138\ubd802"]},m=n.BaseView.extend({events:{"click ul li":"changeTab","click span#btn_add":"addCode","click span#btn_delete":"deleteCode","click form[name='formCodeList'] input:checkbox":"toggleCheckbox","click span#btnReorderCodes":"setOrderCode","click span#setSampleItemBtn":"setSampleItem","click a#batchRegisterShortcut":"goToBatchRegisterLink"},initialize:function(){this.dataTable=null},render:function(){this.appendMenuExample(),this.$el.empty().html(f({lang:v,isUseOrgService:n.util.isUseOrgService(!0)}));var e=this.getInstallLocale();this.$el.find("#btn_add").attr("data-locale",e),this.type=this.$el.find("li.active").children().attr("id"),this.renderCodeList(this.type),this.domainCodeSampleView=new o(e),this.domainCodeSampleView.render(this.type)},getInstallLocale:function(){var e=r.read().toJSON().language;return e=="ja"?"jp":e=="zh_CN"?"zhcn":e=="zh_TW"?"zhtw":e},appendMenuExample:function(){var t=this.$el.closest(".admin_content").find("header.content_top > div");t.append(a({lang:v})),e("span#menuDescBtn").on("click",this.toggleMenuDesc),e("span#menuDescBtn ul.tab_v span.menu").on("mouseover",this.showExampleByDomainCode),this.showMenuExampleIfFirstVisit()},showMenuExampleIfFirstVisit:function(){n.util.store.get(n.session("id")+"-show-domain-code-example-layer")||(n.util.store.set(n.session("id")+"-show-domain-code-example-layer",!0,"local"),e("span#menuDescBtn").trigger("click"))},toggleMenuDesc:function(){this.backdropView||(this.backdropView=new u,this.backdropView.backdropToggleEl=e("div[el-backdrop]"),this.backdropView.linkBackdrop(e("#menuDescBtn")))},showExampleByDomainCode:function(t){var n=e("span#menuDescBtn ul.tab_v li");n.find("span.menu").removeClass("on"),n.find("div.tab_v_content").hide(),e(t.currentTarget).addClass("on"),e(t.currentTarget).closest("li").find("div.tab_v_content").show()},changeModify:function(t){var n=e(t.currentTarget).parent();n&&n.attr("data-formname")&&(e(t.currentTarget).hide(),n.html(['<input type="input" name="',n.attr("data-formname"),'"id="',n.attr("data-formname"),'" class="input w_full" value="',n.attr("data-value"),'" />'].join("")).find("input").focusin())},changeTab:function(t){var n=e(t.currentTarget),r=n.find("span").attr("id");if(this.type==r)return;this.type=r,this.$el.find("ul.tab_menu span.type").parent().attr("class",""),n.attr("class","active"),this.offReorderMode();try{this.dataTable.tables.find("tbody").sortable("destroy")}catch(i){}this.renderCodeList(r),this.domainCodeSampleView.render(r)},toggleCheckbox:function(t){e(t.currentTarget).is(":checked")?e(t.currentTarget).attr("checked",!0):(this.$el.find("#checkedAll").attr("checked",!1),e(t.currentTarget).attr("checked",!1))},toggleMultiLang:function(t){var n=e(t.currentTarget).parents("form"),r=n.find("span#btnMultiLang i");r.hasClass("ic_accordion_s")?(r.removeClass("ic_accordion_s").addClass("ic_accordion_c").attr("title",v.close),n.find('tr[id$="NameInput"]').show()):(r.removeClass("ic_accordion_c").addClass("ic_accordion_s").attr("title",v.open),n.find('tr[id$="NameInput"]').hide()),n.attr("id")==="formCreateCode"?this.addCodePopupEl.reoffset():this.updateCodePopupEl.reoffset()},renderCodeList:function(t){var r=this,i=this.$el.find("#btn_add").attr("data-locale"),s=i+"Name",o=null;switch(t){case"position":o=n.contextRoot+"ad/api/position/sort/list";break;case"duty":o=n.contextRoot+"ad/api/duty/sort/list";break;case"grade":o=n.contextRoot+"ad/api/grade/sort/list";break;case"usergroup":o=n.contextRoot+"ad/api/usergroup/sort/list"}this.$el.find("#domainCodeType").text(v["label_"+t]+" "+v.label_list),this.$el.find("#domainCodeTypeDesc").text(v["label_"+t+"_desc"]),this.dataTable!=null&&this.dataTable.tables.fnDestroy(),this.dataTable=e.goGrid({el:r.$el.find("#codeList"),method:"GET",url:o,emptyMessage:h({label_desc:v.label_useTemplateSuggestion}),defaultSorting:[],pageUse:!1,sDomUse:!1,checkbox:!0,sDomType:"admin",checkboxData:"id",displayLength:999,columns:[{mData:null,bSortable:!0,fnRender:function(e){var t=e.aData[s];return t==null||t==""?"-":t}},{mData:"code",bSortable:!0},{mData:"userCount",bSortable:!0}],fnDrawCallback:function(){var e=r.$el.find("form[name='formCodeList']");e.find("tr>td:nth-child(2)").attr("data-locale",e.find("#btn_add").attr("data-locale")),e.find("tr>td:nth-child(2)").css("cursor","pointer").click(function(e){r.modifyCode(e)}),e.find("#checkedAll").attr("checked",!1)}})},setOrderCode:function(t){var r=this,i=e(t.currentTarget).hasClass("on");if(this.dataTable.tables.isEmpty())return e.goSlideMessage(v.label_useTemplateSuggestion),!1;if(i){this.$el.find("#codeList").find("tbody").sortable("destroy");var s=new Array,o=this.$el.find("form[name=formCodeList]"),u=o.find('input[type="checkbox"]');u.attr("value",function(e,t){t!=null&&t!="on"&&s.push(t)});var a=n.contextRoot+"ad/api/domaincode/order/"+r.type;e.go(a,JSON.stringify({ids:s}),{async:!1,qryType:"PUT",contentType:"application/json",responseFn:function(t){if(t.code==200)e.goSlideMessage(p["\ubcc0\uacbd\ub418\uc5c8\uc2b5\ub2c8\ub2e4."]);else if(t.code!=200){var n=JSON.parse(t.responseText);n.message!=null?e.goSlideMessage(n.message):e.goSlideMessage(v.label_failDesc),r._reloadMemberTables()}}}),this.offReorderMode()}else this.onReorderMode(),this.$el.find("#codeList").find("tbody").sortable({opacity:"1",delay:100,cursor:"move",items:"tr",containment:".admin_content",hoverClass:"ui-state-hover",placeholder:"ui-sortable-placeholder",start:function(e,t){t.placeholder.html(t.helper.html()),t.placeholder.find("td").css("padding","5px 10px")}});this.$el.find("input[type=checkbox]").attr({checked:!1,disabled:!i})},offReorderMode:function(){var e=this;this.$el.find("#btnReorderCodes").removeClass("on"),this.$el.find("#btnReorderCodes").parent().find(".desc").remove(),this.$el.find("#btnReorderCodes .txt").text(d["\uc21c\uc11c \ubc14\uafb8\uae30"]),this.$el.find("form[name='formCodeList'] tr>td:nth-child(2)").css("cursor","pointer").click(function(t){e.modifyCode(t)}),this.$el.find("#btn_add").show(),this.$el.find("#btn_delete").show(),this.$el.find(".column_func").show(),this.$el.find(".template_oganization").show()},onReorderMode:function(){this.$el.find("#btn_add").hide(),this.$el.find("#btn_delete").hide(),this.$el.find(".column_func").hide(),this.$el.find(".template_oganization").hide(),this.$el.find("#btnReorderCodes").addClass("on").before('<span class="vertical_wrap desc">'+d["\ubaa9\ub85d \uc21c\uc11c\ubcc0\uacbd"]+"&nbsp;</span>"),this.$el.find("#btnReorderCodes .txt").text(d["\uc21c\uc11c\ubc14\uafb8\uae30 \uc644\ub8cc"]),this.$el.find("form[name='formCodeList'] tr>td:nth-child(2)").css("cursor","").off("click")},modifyCode:function(t){var r=e(t.currentTarget).parent().find('input[type="checkbox"]'),i=r.val();if(e(t.currentTarget).parents("tbody:eq(0)").hasClass("ui-sortable"))return e.goSlideMessage(d["\uc21c\uc11c \ubc14\uafb8\uae30 \uc644\ub8cc\ud6c4 \uc218\uc815"]),!1;this.model=s.read(i);var o=e(t.currentTarget).attr("data-locale"),u=this,a=c({lang:v,popupmodel:this.model.toJSON(),isKoLocale:o=="ko",isEnLocale:o=="en",isJpLocale:o=="jp",isZhcnLocale:o=="zhcn",isZhtwLocale:o=="zhtw",isViLocale:o=="vi",companyLocale:o});this.updateCodePopupEl=e.goPopup({pid:"updateCodePopupLayer",width:400,targetEl:".admin_body",header:d["\ud56d\ubaa9\uc218\uc815"],modal:!0,buttons:[{btext:v.label_ok,btype:"confirm",autoclose:!1,callback:function(){f(u,o);return}},{btext:v.label_cancel}]}),this.updateCodePopupEl.find(".content").append(a),this.updateCodePopupEl.reoffset(),this.popupUnbindEvents(this.updateCodePopupEl),this.popupBindEvents(this.updateCodePopupEl);var f=function(t,r){var i=t.updateCodePopupEl,s=!0,o=i.find("form#formUpdateCode");e(".go_alert").remove(),e.each(o.serializeArray(),function(i,o){if(!e.goValidation.isCheckLength(1,32,o.value))if(o.name=="code"||o.name==r+"Name")return s=!1,e("#"+o.name).focus(),e("#"+o.name).parent().after('<p class="go_alert">'+n.i18n(v.label_alert,{arg1:"1",arg2:"32"})+"</p>"),e("#"+o.name).click(function(){e(".go_alert").remove()}),e("#"+o.name).keydown(function(){e(".go_alert").remove()}),!1;t.model.set(o.name,o.value,{silent:!0})});if(!s)return!1;t.model.save({},{success:function(n,r){r.code=="200"&&(e.goSlideMessage(v.label_save),i.close(),t.renderCodeList(t.type))},error:function(e,n){t.__errorFunction(n,"modify")}})}},popupUnbindEvents:function(e){e.off()},popupBindEvents:function(t){t.on("click","span.btn_box[data-btntype='changeform']",e.proxy(this.changeModify,this)),t.on("click","#btnMultiLang",e.proxy(this.toggleMultiLang,this))},addCode:function(t){this.model=new i({type:this.type});var r=e(t.currentTarget).attr("data-locale"),s=this,o=l({lang:v,isKoLocale:r=="ko",isEnLocale:r=="en",isJpLocale:r=="jp",isZhcnLocale:r=="zhcn",isZhtwLocale:r=="zhtw",isViLocale:r=="vi",companyLocale:r});this.addCodePopupEl=e.goPopup({pid:"addCodePopupLayer",targetEl:".admin_body",header:d["\ud56d\ubaa9\ucd94\uac00"],width:600,modal:!0,buttons:[{btext:v.label_ok,btype:"confirm",autoclose:!1,callback:function(){u(s,r);return}},{btext:v.label_cancel}]}),this.addCodePopupEl.find(".content").append(o),this.popupUnbindEvents(this.addCodePopupEl),this.popupBindEvents(this.addCodePopupEl);var u=function(t,r){var i=t.addCodePopupEl,s=!0,o=i.find("form#formCreateCode");e(".go_alert").remove(),e.each(o.serializeArray(),function(i,o){if(!e.goValidation.isCheckLength(1,32,o.value))if(o.name=="code"||o.name==r+"Name")return s=!1,e("#"+o.name).focus(),e("#"+o.name).after('<p class="go_alert">'+n.i18n(v.label_alert,{arg1:"1",arg2:"32"})+"</p>"),e("#"+o.name).click(function(){e(".go_alert").remove()}),e("#"+o.name).keydown(function(){e(".go_alert").remove()}),!1;t.model.set(o.name,o.value,{silent:!0})});if(!s)return!1;t.model.save({},{success:function(n,r){r.code=="200"&&(e.goSlideMessage(v.label_save),i.close(),t.renderCodeList(t.type))},error:function(e,n){t.alertErrorMsg(n.responseJSON)}})}},__errorFunction:function(t,n){var r=this;if(t.status=="400"){var i=JSON.parse(t.responseText),s=i.message,o=i.name;o=="invalid.code"||o=="duplicated.code"||o=="invalid.max.length.code"||o=="invalid.min.length.code"?r.__errorMessage("code",s,n):o=="duplicated.ko.name"||o=="invalid.max.length.code.koname"||o=="invalid.min.length.code.koname"||o=="exclude.char.code.koname"?r.__errorMessage("koName",s,n):o=="duplicated.en.name"||o=="invalid.max.length.code.enname"||o=="invalid.min.length.code.enname"||o=="exclude.char.code.enname"?r.__errorMessage("enName",s,n):o=="duplicated.jp.name"||o=="invalid.max.length.code.jpname"||o=="invalid.min.length.code.jpname"||o=="exclude.char.code.jpname"?r.__errorMessage("jpName",s,n):o=="duplicated.zhcn.name"||o=="invalid.max.length.code.zhcnname"||o=="invalid.min.length.code.zhcnname"||o=="exclude.char.code.zhcnname"?r.__errorMessage("zhcnName",s,n):o=="duplicated.zhtw.name"||o=="invalid.max.length.code.zhtwname"||o=="invalid.min.length.code.zhtwname"||o=="exclude.char.code.zhtwname"?r.__errorMessage("zhtwName",s,n):o=="duplicated.vi.name"||o=="invalid.max.length.code.viname"||o=="invalid.min.length.code.viname"||o=="exclude.char.code.viname"?r.__errorMessage("viName",s,n):e.goAlert("",p["\ubaa8\ub4e0 \ud56d\ubaa9\uc758 \uc870\uac74\uc744 \ud655\uc778\ud574 \uc8fc\uc138\uc694."])}else{var i=JSON.parse(t.responseText);i.message!=null?e.goAlert(v.label_fail,i.message):e.goAlert(v.label_fail,v.label_failDesc)}},__errorMessage:function(t,n,r){e(".go_alert").remove(),e("#"+t).focus(),e("#"+t).length>0?e("#"+t).parent().after('<p class="go_alert">'+n+"</p>"):this.updateCodePopupEl.find("form#formUpdateCode").append('<p class="go_alert">'+n+"</p>"),e("#"+t).click(function(){e(".go_alert").remove()}),e("#"+t).keydown(function(){e(".go_alert").remove()})},alertErrorMsg:function(t){var n=t.message;t.code=="400"?e.goError(n):e.goError(p["\uc2e4\ud328"],n!=null?n:p["\uc2e4\ud328\ud588\uc2b5\ub2c8\ub2e4."])},deleteCode:function(){var t=this,r=new Array,s=this.$el.find("form[name=formCodeList]"),o=s.find('input[type="checkbox"]:checked');if(o.size()==0){e.goSlideMessage(d["\uc0ad\uc81c\ud560 \ud56d\ubaa9\uc744 \uc120\ud0dd\ud558\uc138\uc694."]);return}o.attr("value",function(e,t){t!="on"&&t!=null&&r.push(t)}),e.goPopup({width:500,title:d["\uc120\ud0dd\ud55c \ud56d\ubaa9\uc744 \uc0ad\uc81c\ud558\uc2dc\uaca0\uc2b5\ub2c8\uae4c?"],message:d["\ud56d\ubaa9\uc744 \uc0ad\uc81c\ud558\uba74 \ubcf5\uad6c\ub418\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4."],modal:!0,buttons:[{btext:p["\uc0ad\uc81c"],btype:"caution",autoclose:!0,callback:function(){this.model=new i;var s=n.contextRoot+"ad/api/domaincode/";e.go(s,JSON.stringify({ids:r}),{qryType:"DELETE",contentType:"application/json",responseFn:function(n){n.code==200&&(e.goSlideMessage(p["\uc0ad\uc81c\ub418\uc5c8\uc2b5\ub2c8\ub2e4."]),t.renderCodeList(t.type))},error:function(t){var n=JSON.parse(t.responseText);n.name=="can.not.remove.domain.code"?e.goSlideMessage(n.message):e.goSlideMessage(v.label_used_delete)}})}},{btext:p["\ucde8\uc18c"]}]})},setSampleItem:function(){this.domainCodeSampleView.setSampleItem(),this.renderCodeList(this.type)},goToBatchRegisterLink:function(){e.goPopup({width:500,title:"",pclass:"layer_confim",contents:"<p class='q'>"+n.i18n(d["\uba54\ub274\ub85c \uc774\ub3d9\ud558\uc2dc\uaca0\uc2b5\ub2c8\uae4c"],{menuName:d["\uc77c\uad04 \ub4f1\ub85d"]})+"</p>",buttons:[{btext:p["\ud655\uc778"],btype:"confirm",autoclose:!0,callback:function(){n.router.navigate("account/batch/regist",!0)}},{btext:p["\ucde8\uc18c"]}]})}});return m});