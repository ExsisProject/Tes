define("admin/views/ehr/common/ehr_basic_config",function(require){var e=require("backbone"),t=require("app"),n=require("hgn!admin/templates/ehr/common/ehr_basic_config"),r=require("admin/models/ehr_basic_config_model"),i=require("hgn!approval/templates/add_org_member"),s=require("views/circle"),o=require("i18n!nls/commons"),u=require("i18n!admin/nls/admin"),a=require("i18n!timeline/nls/timeline");require("GO.util"),require("jquery.go-orgslide");var f={label_ok:o["\uc800\uc7a5"],label_cancel:o["\ucde8\uc18c"],label_defaultSetting:u["\uae30\ubcf8 \uc124\uc815"],label_timeline:u["\uadfc\ud0dc\uad00\ub9ac"],label_vacation:u["\uc5f0\ucc28\uad00\ub9ac"],label_welfare:u["\ubcf5\uc9c0\ud3ec\uc778\ud2b8"],label_hrCard:u["\uc778\uc0ac\uce74\ub4dc"],label_setting:u["\uadfc\ud0dc\uad00\ub9ac \uc124\uc815"],label_manager:u["\uc6b4\uc601\uc790"],label_menuActive:u["\uba54\ub274 \ud65c\uc131\ud654 \uc5ec\ubd80"],label_add_manager:u["\uc6b4\uc601\uc790 \ucd94\uac00"],label_attendance_fix_permissions:u["\uadfc\ud0dc \uc218\uc815 \uad8c\ud55c"],label_item:u["\ud56d\ubaa9"],label_fix_permissions:u["\ub4f1\ub85d/\uc218\uc815 \uad8c\ud55c"],label_time:u["\uc2dc\uac04"],label_status:u["\ud0c0\uc784\ub77c\uc778 \uc0c1\ud0dc"],label_timeline_status_tooltip:u["\ud0c0\uc784\ub77c\uc778 \uc0c1\ud0dc \ud234\ud301"],label_chief:u["\ubd80\uc11c\uc7a5"],label_vice_chief:u["\ubd80\ubd80\uc11c\uc7a5"],label_member:u["\ubd80\uc11c\uc6d0(\ubcf8\uc778)"],label_open_state:a["\ubd80\uc11c \uadfc\ud0dc \ud604\ud669\ud1b5\uacc4"],label_open_state_stats:u["\ubd80\uc11c \ud604\ud669 \ubc0f \ud1b5\uacc4 \uacf5\uac1c"],label_open_state_caption:a["\ubd80\uc11c \uadfc\ud0dc \ud604\ud669\ud1b5\uacc4 \uc124\uba85"],label_actionLogs:o["\ubcc0\uacbd\uc774\ub825"],label_use_charge_history_tooltip:u["\ubcc0\uacbd\uc774\ub825 \uc0ac\uc6a9\uc5ec\ubd80 \ud234\ud301"],label_use:u["\uc0ac\uc6a9"],label_no_use:u["\uc0ac\uc6a9\uc548\ud568"],label_modify:u["\uc218\uc815"],label_sync_noti:u["\uadfc\ud0dc\ub3d9\uae30\ud654 \uacbd\uace0"],label_restrict_setting:u["\ub3d9\uae30\ud654 \ub370\uc774\ud130 \uc218\uc815\uc81c\ud55c \uc124\uc815"],label_restrict_desc:u["\uadfc\ud0dc\uad00\ub9ac \ub3d9\uae30\ud654 \uc124\uba85"],label_timeline_sync:u["\uadfc\ud0dc\uad00\ub9ac \uc5f0\ub3d9"],label_restrict_guide:u["\uac00\uc774\ub4dc"],label_sync_data:u["\ub3d9\uae30\ud654 \ub370\uc774\ud130"],label_modify_restrict:u["\uc218\uc815 \uc81c\ud55c"],label_working_status_setting:a["\uadfc\ud0dc\uc815\ubcf4 \ub178\ucd9c \uc124\uc815"],label_working_status_setting_tooltip:a["\uadfc\ud0dc\uc815\ubcf4 \ub178\ucd9c \uc124\uc815 \ud234\ud301"],label_display_working_status:a["\uadfc\ud0dc\uc815\ubcf4 \ub178\ucd9c \uae30\ub2a5 \uc0ac\uc6a9"],label_display_working_status_range:a["\uadfc\ud0dc\uc815\ubcf4 \ub178\ucd9c \uae30\ub2a5"],label_display_vacation_range:a["\uc5f0\ucc28\uc815\ubcf4 \ub178\ucd9c \uae30\ub2a5"],label_all:u["\uc804\uccb4 \ud5c8\uc6a9"],label_partial:u["\uc77c\ubd80\ub9cc \ud5c8\uc6a9"]},l=e.View.extend({events:{"click .onOffToggle":"onOffToggle","click .onOffChange":"onOffChange","click .addAdmin":"showOrgSlide","click .ic_del":"removeManager","click #saveBasicSetting":"saveBasicSetting","click #cancelBasicSetting":"cancelBasicSetting","click span#restrictGuide":"showPopupGuideLayer","click #activeSync":"inactiveTimePermission","click #deactivateSync":"activeTimePermission","click input[name='workingStatus']":"toggleDisplayTimeline","click input[name='statusRange']":"changeRangeOfDisplayWorkingStatus","click input[name='vacationRange']":"changeRangeOfDisplayVacation"},initialize:function(){this.model=new r},render:function(){return this.model.fetch({async:!1}),this.$el.html(n({lang:f,data:this.model.toJSON(),timeEditAuthData:$.parseJSON(this.model.get("timeEditAuth")),statusEditAuthData:this.model.get("statusEditAuth"),serviceAdminMode:this.isServiceMode,isSaaS:t.session().brandName=="DO_SAAS",timelineDisplaySettingModel:this.model.get("timelineDisplaySettingModel")})),this.createCircleView(),this},createCircleView:function(){var e=["user","position","grade","usergroup"];t.util.isUseOrgService(!0)&&(e=["user","department","position","grade","duty","usergroup"]),this.statusClassSelectorView=new s({selector:"#statusDisplaySettingModel",isAdmin:!0,isWriter:!0,circleJSON:this.model.get("timelineDisplaySettingModel").statusCircle,nodeTypes:e}),this.vacationClassSelectorView=new s({selector:"#vacationDisplaySettingModel",isAdmin:!0,isWriter:!0,circleJSON:this.model.get("timelineDisplaySettingModel").vacationCircle,nodeTypes:e}),this.statusClassSelectorView.render(),this.vacationClassSelectorView.render(),this.toggleDisplayTimeline(),this.changeRangeOfDisplayWorkingStatus(),this.changeRangeOfDisplayVacation()},toggleDisplayTimeline:function(){var e=this.$el.find('input[name="workingStatus"]:checked').val();e=="true"?this.$el.find("#timelineDisplayOption").show():this.$el.find("#timelineDisplayOption").hide(),this.toggleDisplayWorkingStatus(),this.toggleDisplayVacation()},toggleDisplayWorkingStatus:function(){var e=this.$el.find('input[name="workingStatus"]:checked').val(),t=this.$el.find('input[name="statusRange"]');e=="true"?(_.forEach(t,function(e){$(e).removeAttr("disabled")}),this.changeRangeOfDisplayWorkingStatus()):(_.forEach(t,function(e){$(e).attr("disabled","true")}),this.statusClassSelectorView.hide())},toggleDisplayVacation:function(){var e=this.$el.find('input[name="workingStatus"]:checked').val(),t=this.$el.find('input[name="vacationRange"]');e=="true"?(_.forEach(t,function(e){$(e).removeAttr("disabled")}),this.changeRangeOfDisplayVacation()):(_.forEach(t,function(e){$(e).attr("disabled","true")}),this.vacationClassSelectorView.hide())},changeRangeOfDisplayWorkingStatus:function(){var e=this.$el.find('input[name="statusRange"]:checked').val();e=="true"?this.statusClassSelectorView.hide():this.statusClassSelectorView.show()},changeRangeOfDisplayVacation:function(){var e=this.$el.find('input[name="vacationRange"]:checked').val();e=="true"?this.vacationClassSelectorView.hide():this.vacationClassSelectorView.show()},onOffToggle:function(e){var t=$(e.currentTarget);t.hasClass("on")||(t.closest(".wrap_btn_toggle").find(".on").removeClass("on"),t.addClass("on"))},onOffChange:function(e){var t=$(e.currentTarget);t.hasClass("on")?t.removeClass("on"):t.addClass("on")},showOrgSlide:function(e){$.goOrgSlide({header:u["\uc6b4\uc601\uc790 \ucd94\uac00"],desc:"",callback:$.proxy(function(t){this.addAdmin(t,e)},this),target:e,isAdmin:!0,contextRoot:t.contextRoot})},addAdmin:function(e,t){var n=$(t.currentTarget).closest("ul");e&&!n.find('li[data-id="'+e.id+'"]').length?n.find("li.addAdmin").before(i(e)):$.goMessage(commonLang["\uc774\ubbf8 \uc120\ud0dd\ub418\uc5c8\uc2b5\ub2c8\ub2e4."])},createTimelineDisplaySettingModel:function(){var e={};return e.enable=this.$el.find('input[name="workingStatus"]:checked').val()==="true",e.permitAllStatus=this.$el.find('input[name="statusRange"]:checked').val()==="true",e.permitAllVacation=this.$el.find('input[name="vacationRange"]:checked').val()==="true",e.statusCircle=e.permitAllStatus?{}:this.statusClassSelectorView.getData(),e.vacationCircle=e.permitAllVacation?{}:this.vacationClassSelectorView.getData(),this.isValidStatusDisplaySetting(e)||(e.permitAllStatus=!0),this.isValidVacationDisplaySetting(e)||(e.permitAllVacation=!0),e},isValidStatusDisplaySetting:function(e){return e.enable=="false"?!0:e.permitAllStatus||e.statusCircle!={}&&e.statusCircle.nodes.length!=0},isValidVacationDisplaySetting:function(e){return e.enable=="false"?!0:e.permitAllVacation||e.vacationCircle!={}&&e.vacationCircle.nodes.length!=0},saveBasicSetting:function(){var e=this.getAdministrators($("#timelineAdministrators li")),n=this.getAdministrators($("#vacationAdministrators li")),r=this.getAdministrators($("#hrAdministrators li")),i=this.getAdministrators($("#welfareAdministrators li"));this.model.set("timelineAdministrators",e,{silent:!0}),this.model.set("vacationAdministrators",n,{silent:!0}),this.model.set("hrAdministrators",r,{silent:!0}),this.model.set("welfareAdministrators",i,{silent:!0}),this.model.set("timelineMenuActive",$("#timelineMenuActive").is(".on"),{silent:!0}),this.model.set("vacationMenuActive",$("#vacationMenuActive").is(".on"),{silent:!0}),this.model.set("hrMenuActive",$("#hrMenuActive").is(".on"),{silent:!0}),this.model.set("welfareMenuActive",$("#welfareMenuActive").is(".on"),{silent:!0}),this.model.set("statusEditAuth",{manager:$("#statusManager").is(".on"),master:$("#statusMaster").is(".on"),moderator:$("#statusModerator").is(".on"),member:$("#statusMember").is(".on")},{silent:!0}),this.model.set("useTimelineActivityLogs",$("#useTimelineActivityLogs").is(".on"),{silent:!0}),this.model.set("useDeptSituationAndStats",$("#useDeptSituationAndStats").is(".on"),{silent:!0}),this.model.set("syncActive",$("#activeSync").is(".on"),{silent:!0});var s=this.createTimelineDisplaySettingModel();this.model.set("timelineDisplaySettingModel",s,{silent:!0}),t.EventEmitter.trigger("common","layout:setOverlay",""),this.model.save({},{type:"POST",contentType:"application/json",dataType:"json",success:function(e){e.code=="200"&&($.goMessage(o["\uc800\uc7a5\ub418\uc5c8\uc2b5\ub2c8\ub2e4."]),t.EventEmitter.trigger("common","layout:clearOverlay",!0),self.render())},error:function(e,n){n&&n.responseJSON&&n.responseJSON.message?$.goMessage(n.responseJSON.message):$.goMessage(o["\uc800\uc7a5\uc5d0 \uc2e4\ud328 \ud558\uc600\uc2b5\ub2c8\ub2e4."]),t.EventEmitter.trigger("common","layout:clearOverlay",!0)}})},getAdministrators:function(e){var t=[];return $.each(e,function(e,n){var r=$(n).attr("data-id");r!=undefined&&t.push({userId:$(n).attr("data-id")})}),t},cancelBasicSetting:function(){this.render()},removeManager:function(e){$(e.currentTarget).closest("li").remove()},showPopupGuideLayer:function(){var e=t.contextRoot+"resources/guide/attnd/start.htm";window.open(e,"attndGuide","resizable=yes,scrollbars=yes,width=820,height=700")},inactiveTimePermission:function(){_.chain(this.$el.find("#statusEditAuth button")).forEach(_.bind(function(e){$(e).attr("disabled","disabled"),$(e).removeClass("on")},this)).value(),this.$el.find("#statusManager").addClass("on"),$("#alertMessage").show()},activeTimePermission:function(){$("#statusManager").removeAttr("disabled"),$("#statusMaster").removeAttr("disabled"),$("#statusModerator").removeAttr("disabled"),$("#statusMember").removeAttr("disabled"),$("#alertMessage").hide()}});return l});