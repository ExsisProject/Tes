define(["jquery","underscore","backbone","app","calendar/libs/util","views/pagination","views/pagesize","collections/paginated_collection","admin/views/document/manage_doclist_item","approval/models/doclist_item","hgn!approval/templates/doclist_empty","hgn!admin/templates/appr_document_list","approval/collections/apprFormCoreCollection","i18n!nls/commons","i18n!approval/nls/approval","i18n!admin/nls/admin"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v){var m={"\ubd80\uc11c\uba85":p["\ubd80\uc11c\uba85"],"\uae30\uc548\uc790":d["\uae30\uc548\uc790"],"\uac80\uc0c9":p["\uac80\uc0c9"],"\uc804\uccb4":d["\uc804\uccb4"],"\uc9c4\ud589\uc911":d["\uc9c4\ud589\uc911"],"\uc644\ub8cc":d["\uc644\ub8cc"],"\ubc18\ub824":d["\ubc18\ub824"],"\uc0c1\ud0dc":v["\uc0c1\ud0dc"],"\uae30\uc548\uc77c \uae30\uc900":v["\uae30\uc548\uc77c \uae30\uc900"],"\uac80\uc0c9":p["\uac80\uc0c9"],"\ubaa9\ub85d \ub2e4\uc6b4\ub85c\ub4dc":v["\ubaa9\ub85d \ub2e4\uc6b4\ub85c\ub4dc"],"\uae30\uc548\uc77c":d.\uae30\uc548\uc77c,"\uacb0\uc7ac\uc591\uc2dd":d.\uacb0\uc7ac\uc591\uc2dd,"\uae30\uc548\uc790":d.\uae30\uc548\uc790,"\uc81c\ubaa9":p.\uc81c\ubaa9,"\ucca8\ubd80":d.\ucca8\ubd80,"\uacb0\uc7ac\uc0c1\ud0dc":d.\uacb0\uc7ac\uc0c1\ud0dc,"\uacb0\uc7ac\uc77c":d.\uacb0\uc7ac\uc77c,"\ubb38\uc11c\ubc88\ud638":d.\ubb38\uc11c\ubc88\ud638,"\uac80\uc0c9 \uae30\uac04":d["\uac80\uc0c9 \uae30\uac04"],"\uae30\uc548\ubd80\uc11c":d["\uae30\uc548\ubd80\uc11c"],"\uacb0\uc7ac\uc120":d["\uacb0\uc7ac\uc120"],"\ubb38\uc11c \uad6c\ubd84":d["\ubb38\uc11c \uad6c\ubd84"],"\uacb0\uc7ac \uc0c1\ud0dc":d["\uacb0\uc7ac \uc0c1\ud0dc"],"\uc77c\ubc18 \uacb0\uc7ac\ubb38\uc11c":d["\uc77c\ubc18 \uacb0\uc7ac\ubb38\uc11c"],"\uc218\uc2e0 \uacb0\uc7ac\ubb38\uc11c":d["\uc218\uc2e0 \uacb0\uc7ac\ubb38\uc11c"],"\uc811\uc218\ub300\uae30":d["\uc811\uc218\ub300\uae30"],"\uc811\uc218":d["\uc811\uc218"],"\ubc18\uc1a1":d["\ubc18\uc1a1"],"\uc0c1\uc2e0\ucde8\uc18c":d["\uc0c1\uc2e0\ucde8\uc18c"],"\uacb0\uc7ac\ubb38\uc11c\ud68c\uc218":d["\uacb0\uc7ac\ubb38\uc11c\ud68c\uc218"],"\uae30\uc548\uc77c\uc774 \uc5c6\ub294 \ubb38\uc11c\ub294 \uc0dd\uc131\uc77c \uae30\uc900\uc73c\ub85c \uac80\uc0c9\ub429\ub2c8\ub2e4":d["\uae30\uc548\uc77c\uc774 \uc5c6\ub294 \ubb38\uc11c\ub294 \uc0dd\uc131\uc77c \uae30\uc900\uc73c\ub85c \uac80\uc0c9\ub429\ub2c8\ub2e4"],"\uc5f0\ub3d9 \uc5ec\ubd80":d["\uc5f0\ub3d9 \uc5ec\ubd80"],"\uc77c\ubc18\ubb38\uc11c(N)":d["\uc77c\ubc18\ubb38\uc11c(N)"],"\uc5f0\ub3d9\ubb38\uc11c(Y)":d["\uc5f0\ub3d9\ubb38\uc11c(Y)"],"\uc5f0\ub3d9 \uc5ec\ubd80\ub97c \uc120\ud0dd\ud574\uc8fc\uc138\uc694.":d["\uc5f0\ub3d9 \uc5ec\ubd80\ub97c \uc120\ud0dd\ud574\uc8fc\uc138\uc694."],"\uc218\uc2e0 \uc811\uc218\ub300\uae30 / \uc811\uc218 / \ubc18\uc1a1 \ubb38\uc11c\ub97c \uc870\ud68c\ud569\ub2c8\ub2e4":d["\uc218\uc2e0 \uc811\uc218\ub300\uae30 / \uc811\uc218 / \ubc18\uc1a1 \ubb38\uc11c\ub97c \uc870\ud68c\ud569\ub2c8\ub2e4"],"\ubb38\uc11cID":d["\ubb38\uc11cID"],"\uc0dd\uc131\uc77c":d["\uc0dd\uc131\uc77c"],"\uc5f0\ub3d9\uc5ec\ubd80":d["\uc5f0\ub3d9\uc5ec\ubd80"],"\uacb0\uc7ac\uc694\uccad\uc2dc \uc0dd\uc131\ub418\ub294 \uace0\uc720\uc758 ID\uc785\ub2c8\ub2e4":d["\uacb0\uc7ac\uc694\uccad\uc2dc \uc0dd\uc131\ub418\ub294 \uace0\uc720\uc758 ID\uc785\ub2c8\ub2e4"],"DocID\ub294 \uc22b\uc790\ub9cc \uc785\ub825\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4":d["DocID\ub294 \uc22b\uc790\ub9cc \uc785\ub825\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4"]},g=n.View.extend({initialize:function(t){this.$el=e(t),this.isAdmin=!0,this.collection=new h(this.isAdmin)},render:function(t){this.collection.fetch({success:e.proxy(function(e,n,i){var s=[];s.push(['<option value="',0,'" selected="selected">',m["\uc804\uccb4"],"</option>"].join("")),e.each(function(e){s.push(['<option value="',e.get("id"),'">',e.get("name"),"</option>"].join(""))}),this.$el.html(s.join("\n"));var o=r.router.getSearch(),u=o.formId&&o.formId.length==1?o.formId[0]:"0";u&&this.$el.val(u),t()},this)},this)},getSelectedFormIdList:function(){var e=this.$el.find("option:selected").val();return e==0?null:e}}),y=u.extend({model:f,url:function(){var t={startAt:this.startAt,endAt:this.endAt,drafterName:this.drafterName,drafterDeptName:this.drafterDeptName,activityUserName:this.activityUserName,docId:this.docId,docNum:this.docNum,title:this.title,"docStatus[]":this.docStatusList,"docType[]":this.docTypeList,"formId[]":this.formIdList,page:this.pageNo,offset:this.pageSize,property:this.property,direction:this.direction,"integration[]":this.integrationList,apprStatus:this.apprStatus};return r.contextRoot+"ad/api/approval/manage/document"+"?"+e.param(t)},setSearch:function(e){this.startAt=e.startAt,this.endAt=e.endAt,this.drafterName=e.drafterName,this.drafterDeptName=e.drafterDeptName,this.activityUserName=e.activityUserName,this.docId=e.docId,this.docNum=e.docNum,this.title=e.title,this.docTypeList=e.docType,this.docStatusList=e.docStatus,this.formIdList=e.formId,this.pageNo=e.page,this.pageSize=e.offset,this.property=e.property,this.direction=e.direction,this.integrationList=e.integration,this.apprStatus=e.apprStatus},setSort:function(e,t){this.property=e,this.direction=t,this.pageNo=0}}),b=n.View.extend({el:"#layoutContent",columns:{count:10},initialize:function(){t.bindAll(this,"render","renderPageSize","renderPages"),this.collection=new y,this.collection.bind("reset",this.resetList,this)},delegateEvents:function(t){this.undelegateEvents(),n.View.prototype.delegateEvents.call(this,t),this.$el.on("click.manage","#btn_search_document",e.proxy(this.docManageSearch,this,!1)),this.$el.on("click.manage","#apprManageCvsDown",e.proxy(this.cvsDownLoad,this)),this.$el.on("click",".sorting",e.proxy(this.sort,this)),this.$el.on("click",".sorting_desc",e.proxy(this.sort,this)),this.$el.on("click",".sorting_asc",e.proxy(this.sort,this)),this.$el.on("click","input[name=docStatCheck]",e.proxy(this.toggleDocStatCheckbox,this)),this.$el.on("click","input[name=docTypeCheck]",e.proxy(this.toggleDocTypeCheckbox,this)),this.$el.on("click","input[name=docIntegrationCheck]",e.proxy(this.toggleDocIntegrationCheckbox,this))},undelegateEvents:function(){return n.View.prototype.undelegateEvents.call(this),this.$el.off(),this},_initDate:function(){e.datepicker.setDefaults(e.datepicker.regional[r.config("locale")]);var t=this.$el.find("#startDate"),n=this.$el.find("#endDate");return this.$el.find("#startDate").val(r.util.fromNow("days",-7).format("YYYY-MM-DD")),this.$el.find("#endDate").val(r.util.now().format("YYYY-MM-DD")),t.datepicker({dateFormat:"yy-mm-dd",changeMonth:!0,changeYear:!0,yearSuffix:"",onClose:function(e){n.datepicker("option","minDate",e)}}),n.datepicker({dateFormat:"yy-mm-dd",changeMonth:!0,changeYear:!0,yearSuffix:"",minDate:t.val()}),this},_initStatus:function(){this.$el.find("input[type=checkbox][name=docStatCheck]").prop("checked",!0)},_initType:function(){this.$el.find("input[type=checkbox][name=docTypeCheck]").prop("checked",!0)},_initIntegration:function(){this.$el.find("input[type=checkbox][name=docIntegrationCheck]").prop("checked",!0)},toggleDocStatCheckbox:function(t){if(e(t.currentTarget).attr("id")=="docStatAllCheck"){var n=this.$el.find("#docStatAllCheck").is(":checked");e('input[type="checkbox"][name="docStatCheck"]').attr("checked",n)}else{var n=e(t.currentTarget).is(":checked");e(t.currentTarget).attr("checked",n),n||e("#docStatAllCheck").attr("checked",!1)}},toggleDocTypeCheckbox:function(t){if(e(t.currentTarget).attr("id")=="docTypeAllCheck"){var n=this.$el.find("#docTypeAllCheck").is(":checked");e('input[type="checkbox"][name="docTypeCheck"]').attr("checked",n)}else{var n=e(t.currentTarget).is(":checked");e(t.currentTarget).attr("checked",n),n||e("#docTypeAllCheck").attr("checked",!1)}},toggleDocIntegrationCheckbox:function(t){if(e(t.currentTarget).attr("id")=="docIntegrationAllCheck"){var n=this.$el.find("#docIntegrationAllCheck").is(":checked");e('input[type="checkbox"][name="docIntegrationCheck"]').attr("checked",n)}else{var n=e(t.currentTarget).is(":checked");e(t.currentTarget).attr("checked",n),n||e("#docIntegrationAllCheck").attr("checked",!1)}},cvsDownLoad:function(){var e="ad/api/approval/manage/document/download?",t=this.getParam();r.util.downloadCsvFile(e+r.util.jsonToUrlParam(t))},render:function(t){return this.$el.empty(),this.$el.html(c({lang:m,columns:this.columns})),this.setInitSort(this.initProperty,this.initDirection),this._initDate(),this._initStatus(),this._initType(),this._initIntegration(),this.formSelectView=new g("#formId"),this.formSelectView.render(e.proxy(this.docManageSearch,this)),this.renderPageSize(),this.$el},getParam:function(){var n=r.util.toISO8601(r.util.toMoment(e("#startDate").val())),i=r.util.toISO8601(r.util.toMoment(e("#endDate").val()).add("days",1).subtract("seconds",1)),s=e.trim(e("#drafterName").val()),o=e.trim(e("#drafterDeptName").val()),u=e.trim(e("#activityUserName").val()),a=e.trim(e("#docId").val()),f=e.trim(e("#docNum").val()),l=e.trim(e("#title").val().replace(/\+/gi," ")),c=this.formSelectView.getSelectedFormIdList(),h="",p=[];t.each(e("input[type=checkbox][name=docStatCheck]:checked"),function(t){e(t).attr("id")!="docStatAllCheck"&&(e(t).val()=="cancel_draft"?(p.push("draft_waiting"),p.push("tempsave"),h="cancel"):p.push(e(t).val()))});var d=[];t.each(e("input[type=checkbox][name=docTypeCheck]:checked"),function(t){e(t).attr("id")!="docTypeAllCheck"&&d.push(e(t).val())});var v=[];t.each(e("input[type=checkbox][name=docIntegrationCheck]:checked"),function(t){e(t).attr("id")!="docIntegrationAllCheck"&&v.push(e(t).val())});var m={startAt:n,endAt:i,drafterName:s,drafterDeptName:o,activityUserName:u,docId:a,docNum:f,title:l,docType:d,docStatus:p,formId:c,page:0,offset:this.collection.pageSize,property:this.property,direction:this.direction,integration:v,apprStatus:h};return m},docManageSearch:function(){var t=this.getParam();if(t.docStatus.length==0){e.goError(d["\ubb38\uc11c \uc0c1\ud0dc\ub97c \uc120\ud0dd\ud574\uc8fc\uc138\uc694."]);return}if(t.docType.length==0){e.goError(d["\ubb38\uc11c \uad6c\ubd84\uc744 \uc120\ud0dd\ud574\uc8fc\uc138\uc694."]);return}if(t.integration.length==0){e.goError(d["\uc5f0\ub3d9 \uc5ec\ubd80\ub97c \uc120\ud0dd\ud574\uc8fc\uc138\uc694."]);return}if(e.trim(t.docId)!=""&&!e.isNumeric(t.docId)){e.goError(d["DocID\ub294 \uc22b\uc790\ub9cc \uc785\ub825\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4"]);return}this.collection.setSearch(t),this.setInitSort(this.initProperty,this.initDirection),this.collection.fetch()},renderPageSize:function(){this.pageSizeView=new o({pageSize:this.collection.pageSize}),this.pageSizeView.render(),this.pageSizeView.bind("changePageSize",this.selectPageSize,this)},renderPages:function(){this.pageView=new s({pageInfo:this.collection.pageInfo()}),this.pageView.bind("paging",this.selectPage,this),this.$el.find("div.tool_absolute > div.dataTables_paginate").remove(),this.$el.find("div.tool_absolute").append(this.pageView.render().el)},resetList:function(t){e(".tb_admin_approval > tbody").empty();var n=this.columns;t.each(function(t){var r=new a({model:t,columns:n});e(".tb_admin_approval > tbody").append(r.render().el)}),t.length==0&&e(".tb_admin_approval > tbody").html(l({columns:this.columns,lang:{doclist_empty:p["\uac80\uc0c9\uacb0\uacfc\uc5c6\uc74c"]}})),this.renderPages()},selectPage:function(e){this.collection.setPageNo(e),this.collection.fetch()},selectPageSize:function(e){this.collection.setPageSize(e),this.collection.fetch()},setInitSort:function(t,n){var r=null,i=this.$el.find("th");i.each(function(){e(this).attr("sort-id")==t&&(r=e(this).attr("id")),e(this).attr("class")!="sorting_disabled"&&e(this).attr("class","sorting")}),e("#"+r).attr("class","sorting_"+n)},sort:function(t){var n="#"+e(t.currentTarget).attr("id"),r=e(n).attr("class"),i=e(n).attr("sort-id"),s="desc",o=this.$el.find("th");o.each(function(){e(this).attr("class")!="sorting_disabled"&&e(this).attr("class","sorting")}),r=="sorting"?e(n).attr("class","sorting_desc"):r=="sorting_desc"?(e(n).attr("class","sorting_asc"),s="asc"):r=="sorting_asc"?e(n).attr("class","sorting_desc"):e.goMessage("Sorting Error."),this.property=i,this.direction=s,this.collection.setSort(i,s),this.collection.fetch()},release:function(){this.$el.off(),this.$el.empty()}});return b});