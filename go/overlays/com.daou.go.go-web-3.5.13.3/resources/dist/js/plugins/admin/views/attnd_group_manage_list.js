(function(){define(["jquery","backbone","app","hgn!admin/templates/attnd_group_manage_list","i18n!nls/commons","i18n!admin/nls/admin","jquery.go-sdk"],function(e,t,n,r,i,s){function a(e,t,n){}var o={label_group_manage_top_caption:s["\ud55c \uc0ac\uc6a9\uc790\uac00 \ub450 \uac1c \uc774\uc0c1\uc758 \uadf8\ub8f9\uc5d0 \uc911\ubcf5 \ub4f1\ub85d\ub41c \uacbd\uc6b0, \uac00\uc7a5 \uc0c1\uc704\uc5d0 \ub4f1\ub85d\ub41c \uadf8\ub8f9\uc73c\ub85c \ucd9c\ud1f4\uadfc\uc2dc\uac04\uc774 \uc801\uc6a9\ub429\ub2c8\ub2e4."],label_add_group:s["\uadf8\ub8f9\ucd94\uac00"],label_delete:i["\uc0ad\uc81c"],label_reorder:s["\uc21c\uc11c\ubc14\uafb8\uae30"],label_group_name:s["\uadf8\ub8f9\uba85"],label_commute_time:s["\ucd9c\ud1f4\uadfc \uc2dc\uac04"],label_effective_period:s["\uc801\uc6a9 \uae30\uac04"],label_create_at:s["\uc0dd\uc131\uc77c"],label_setting:s["\uc124\uc815"],label_delete_group:s["\uadf8\ub8f9 \uc0ad\uc81c"],label_delete_caption:s["\uadfc\ud0dc\uad00\ub9ac \uadf8\ub8f9 \uc0ad\uc81c \uc124\uba85"],label_empty_list:s["\ub4f1\ub85d\ub41c \uadfc\ud0dc\uad00\ub9ac \uadf8\ub8f9\uc774 \uc5c6\uc2b5\ub2c8\ub2e4."],label_flexible_time:s["\uc790\uc728 \ucd9c\ud1f4\uadfc\uc81c"]},u=t.View.extend({events:{"click #btn_create":"addAttndGroup","click #btn_delete":"deleteAttndGroup","click #btnReorderGroups":"reOrderAttndGroups","click input:checkbox":"toggleCheckbox","click .groupManageSetting":"moveGroupSettingDetail"},initialize:function(){this.collection=new t.Collection,this.collection.url=n.contextRoot+"ad/api/ehr/attnd/groups"},render:function(){this.collection.fetch({async:!1}),this.$el.html(r({lang:o,data:this.collection.toJSON()}))},addAttndGroup:function(){n.router.navigate("ehr/group/create",!0)},deleteAttndGroup:function(){var t=this,r=new Array,o=this.$el.find("form[name=formAttndGroupManage]"),u=o.find('input[type="checkbox"]:checked'),a=u.parents("tr");if(u.size()==0){e.goMessage(s["\uc0ad\uc81c\ud560 \uadfc\ud0dc\uad00\ub9ac \uadf8\ub8f9\uc744 \uc120\ud0dd\ud558\uc138\uc694."]);return}a.attr("data-id",function(e,t){t!=null&&r.push(t)}),e.goCaution(s["\uadf8\ub8f9 \uc0ad\uc81c"],s["\uadfc\ud0dc\uad00\ub9ac \uadf8\ub8f9 \uc0ad\uc81c \uc124\uba85"],function(){e.go(n.contextRoot+"ad/api/ehr/attnd/groups",JSON.stringify({ids:r}),{qryType:"DELETE",contentType:"application/json",responseFn:function(n){n.code==200&&(e.goMessage(i["\uc0ad\uc81c\ub418\uc5c8\uc2b5\ub2c8\ub2e4."]),t.render())},error:function(t){var n=JSON.parse(t.responseText);n!=null?e.goAlert(n.message):e.goMessage(i["\uc2e4\ud328\ud588\uc2b5\ub2c8\ub2e4."])}})})},reOrderAttndGroups:function(t){var r=this,o=e(t.currentTarget).hasClass("btn_save");e("#btn_setting").unbind("click");if(o){this.$el.find("#attndGroupManageTable").find("tbody").sortable("destroy").removeAttr("class");var u=new Array,a=this.$el.find("form[name=formAttndGroupManage]"),f=a.find('input[type="checkbox"]'),l=f.parents("tr");l.attr("data-id",function(e,t){t!=null&&u.push(t)}),u.reverse(),e.go(n.contextRoot+"ad/api/ehr/attnd/group/sort",JSON.stringify({ids:u}),{async:!1,qryType:"PUT",contentType:"application/json",responseFn:function(t){t.code==200&&e.goMessage(i["\ubcc0\uacbd\ub418\uc5c8\uc2b5\ub2c8\ub2e4."]),t.code!=200&&(e.goMessage(i["\uc2e4\ud328\ud588\uc2b5\ub2c8\ub2e4."]),r.render())}}),e(t.currentTarget).text(s["\uc21c\uc11c \ubc14\uafb8\uae30"]).removeClass("btn_save").find(" ~ span").remove(),e("#btn_add").show(),e("#btn_delete").show()}else e("#btn_add").hide(),e("#btn_delete").hide(),this.$el.find("#btnReorderGroups").addClass("btn_save").text(s["\uc21c\uc11c\ubc14\uafb8\uae30 \uc644\ub8cc"]).after('&nbsp;<span class="vertical_wrap desc">'+s["\uba54\ub274 \uc21c\uc11c \ubcc0\uacbd \uc124\uba85"]+"</span>"),this.$el.find("#attndGroupManageTable").find("tbody").sortable({opacity:"1",delay:100,cursor:"move",items:">tr",containment:".admin_content",hoverClass:"ui-state-hover",placeholder:"ui-sortable-placeholder",start:function(e,t){t.placeholder.html(t.helper.html()),t.placeholder.find("td").css("padding","5px 10px")},stop:function(e,t){}});this.$el.find("input[type=checkbox]").attr({checked:!1,disabled:!o})},toggleCheckbox:function(t){e(t.currentTarget).attr("id")=="group_all"&&e(t.currentTarget).is(":checked")?this.$el.find("input:checkbox").attr("checked",!0):e(t.currentTarget).attr("id")=="group_all"&&!e(t.currentTarget).is(":checked")?this.$el.find("input:checkbox").attr("checked",!1):e(t.currentTarget).is(":checked")||e("#group_all").attr("checked",!1)},moveGroupSettingDetail:function(t){n.router.navigate("ehr/group/"+e(t.currentTarget).closest("tr").attr("data-id"),!0)}});return u})})();