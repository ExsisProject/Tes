(function(){define(["jquery","backbone","app","hgn!admin/templates/list_empty","hgn!admin/templates/calendar_holiday_list","hgn!admin/templates/calendar_holiday_create","i18n!nls/commons","i18n!admin/nls/admin","i18n!calendar/nls/calendar","jquery.go-validation","jquery.go-popup","jquery.go-sdk","jquery.go-grid","GO.util"],function(e,t,n,r,i,s,o,u,a){var f={label_add:u["\uc2e0\uaddc \ucd94\uac00"],label_delete:o["\uc0ad\uc81c"],label_download:u["\ubaa9\ub85d \ub2e4\uc6b4\ub85c\ub4dc"],label_calendar:u["\ub2ec\ub825"],label_date:u["\ub0a0\uc9dc"],label_title:o["\uc81c\ubaa9"],label_status:u["\ud734\uc77c\uc5ec\ubd80"],selectMonth:[{value:"1"},{value:"2"},{value:"3"},{value:"4"},{value:"5"},{value:"6"},{value:"7"},{value:"8"},{value:"9"},{value:"10"},{value:"11"},{value:"12"}],selectDate_31:[{value:"1"},{value:"2"},{value:"3"},{value:"4"},{value:"5"},{value:"6"},{value:"7"},{value:"8"},{value:"9"},{value:"10"},{value:"11"},{value:"12"},{value:"13"},{value:"14"},{value:"15"},{value:"16"},{value:"17"},{value:"18"},{value:"19"},{value:"20"},{value:"21"},{value:"22"},{value:"23"},{value:"24"},{value:"25"},{value:"26"},{value:"27"},{value:"28"},{value:"29"},{value:"30"},{value:"31"}],selectDate_29:[{value:"1"},{value:"2"},{value:"3"},{value:"4"},{value:"5"},{value:"6"},{value:"7"},{value:"8"},{value:"9"},{value:"10"},{value:"11"},{value:"12"},{value:"13"},{value:"14"},{value:"15"},{value:"16"},{value:"17"},{value:"18"},{value:"19"},{value:"20"},{value:"21"},{value:"22"},{value:"23"},{value:"24"},{value:"25"},{value:"26"},{value:"27"},{value:"28"},{value:"29"}],selectDate_30:[{value:"1"},{value:"2"},{value:"3"},{value:"4"},{value:"5"},{value:"6"},{value:"7"},{value:"8"},{value:"9"},{value:"10"},{value:"11"},{value:"12"},{value:"13"},{value:"14"},{value:"15"},{value:"16"},{value:"17"},{value:"18"},{value:"19"},{value:"20"},{value:"21"},{value:"22"},{value:"23"},{value:"24"},{value:"25"},{value:"26"},{value:"27"},{value:"28"},{value:"29"},{value:"30"}],selectWeek:[{value:"1"},{value:"2"},{value:"3"},{value:"4"},{value:"5"}],selectDay:[{text:a["\uc6d4\uc694\uc77c"],value:"MO"},{text:a["\ud654\uc694\uc77c"],value:"TU"},{text:a["\uc218\uc694\uc77c"],value:"WE"},{text:a["\ubaa9\uc694\uc77c"],value:"TH"},{text:a["\uae08\uc694\uc77c"],value:"FR"},{text:a["\ud1a0\uc694\uc77c"],value:"SA"},{text:a["\uc77c\uc694\uc77c"],value:"SU"}]},l=n.BaseView.extend({el:"#layoutContent",initialize:function(){this.listEl="#holidayList",this.dataTable=null,this.unbindEvent(),this.bindEvent()},unbindEvent:function(){this.$el.off("click","span#btn_add"),this.$el.off("click","span#btn_delete"),this.$el.off("click","span#btn_down"),this.$el.off("click","form[name='formHolidayList'] input:checkbox")},bindEvent:function(){this.$el.on("click","span#btn_add",e.proxy(this.addHoliday,this)),this.$el.on("click","span#btn_delete",e.proxy(this.deleteHoliday,this)),this.$el.on("click","span#btn_down",e.proxy(this.downHolidayList,this)),this.$el.on("click","form[name='formHolidayList'] input:checkbox",e.proxy(this.toggleCheckbox,this))},toggleCheckbox:function(t){e(t.currentTarget).is(":checked")?e(t.currentTarget).attr("checked",!0):(this.$el.find("#checkedAll").attr("checked",!1),e(t.currentTarget).attr("checked",!1))},downHolidayList:function(){var e="ad/api/calendar/holiday/download",t=this.dataTable.listParams;GO.util.downloadCsvFile(e)},render:function(){this.$el.empty(),this.$el.html(i({lang:f})),this.renderHolidayList()},renderHolidayList:function(){var t=this;this.dataTable!=null&&this.dataTable.tables.fnDestroy(),this.dataTable=e.goGrid({el:this.listEl,method:"GET",url:GO.contextRoot+"ad/api/calendar/holiday",emptyMessage:r({label_desc:u["\uacf5\ud734\uc77c\uc5c6\uc74c"]}),pageUse:!1,sDomUse:!1,checkbox:!0,sDomType:"admin",checkboxData:"id",displayLength:999,defaultSorting:[[2,"asc"]],columns:[{mData:"phase",bSortable:!1,sClass:"calendar",sWidth:"80px",fnRender:function(e){return e.aData.phase=="solar"?u["\uc591\ub825"]:u["\uc74c\ub825"]}},{mData:"recurrence",bSortable:!0,sClass:"date",sWidth:"150px",fnRender:function(e){var t=e.aData.recurrence.split(";"),n=t[1].split("="),r=t[2].split("="),i=n[1]+a["\uc6d4"]+" ";if(r[0]=="BYMONTHDAY")i+=r[1]+a["\uc77c"];else{var s=r[1],o=s[1]+s[2];i+=s[0]+u["\ubc88\uc9f8"]+" "+u[o]}return i}},{mData:"summary",bSortable:!0,sClass:"subject"},{mData:"type",bSortable:!1,sClass:"align_c state",sWidth:"100px",fnRender:function(e){return e.aData.type=="holiday"?u["\ud734\uc77c"]:u["\uae30\ub150\uc77c"]}}],fnDrawCallback:function(e){t.$el.find("#checkedAll").attr("checked",!1),t.$el.find(".toolbar_top").append(t.$el.find("#controlButtons").show())}})},modifyHoliday:function(e){this.popupUnbindEvents(popupEl),this.popupBindEvents(popupEl)},popupUnbindEvents:function(e){e.off()},popupBindEvents:function(t){t.on("change","select#selectMonth",e.proxy(this.changeDateSelector,this))},changeDateSelector:function(t){var n=t.currentTarget.value;e("select#selectDate").empty(),n=="2"?e.each(f.selectDate_29,function(t,n){e("select#selectDate").append(['<option value="',n.value,'">',n.value,a["\uc77c"],"</option>"].join(""))}):n=="1"||n=="3"||n=="5"||n=="7"||n=="8"||n=="10"||n=="12"?e.each(f.selectDate_31,function(t,n){e("select#selectDate").append(['<option value="',n.value,'">',n.value,a["\uc77c"],"</option>"].join(""))}):e.each(f.selectDate_30,function(t,n){e("select#selectDate").append(['<option value="',n.value,'">',n.value,a["\uc77c"],"</option>"].join(""))})},addHoliday:function(){this.model=new t.Model,this.model.url=GO.contextRoot+"ad/api/calendar/holiday";var r=this,i=s({label_calendar:u["\ub2ec\ub825"],label_solar:u["\uc591\ub825"],label_lunar:u["\uc74c\ub825"],label_date:u["\ub0a0\uc9dc"],label_date_select:u["\ub0a0\uc9dc \uc9c0\uc815"],label_day_select:u["\uc694\uc77c \uc9c0\uc815"],label_title:o["\uc81c\ubaa9"],label_status:u["\ud734\uc77c\uc5ec\ubd80"],label_holiday:u["\ud734\uc77c"],label_non_holiday:u["\uae30\ub150\uc77c"],label_times:u["\ubc88\uc9f8"],label_month:a["\uc6d4"],label_day:a["\uc77c"],selectMonth:f.selectMonth,selectDate:f.selectDate_31,selectWeek:f.selectWeek,selectDay:f.selectDay}),l=e.goPopup({targetEl:".admin_body",header:u["\uae30\ub150\uc77c/\uacf5\ud734\uc77c \ucd94\uac00"],modal:!0,width:"500px",buttons:[{btext:o["\uc800\uc7a5"],btype:"confirm",autoclose:!1,callback:function(){c(r);return}},{btext:o["\ucde8\uc18c"]}]});l.find(".content").append(i);var c=function(t){var r=l,i=!0,s=r.find("form#formCreateHoliday");e.each(s.serializeArray(),function(r,s){if(!e.goValidation.isCheckLength(1,32,s.value)&&s.name=="summary")return i=!1,e("#"+s.name).focus(),e("#"+s.name).after('<p class="go_alert">'+n.i18n(u["0\uc790\uc774\uc0c1 0\uc774\ud558 \uc785\ub825\ud574\uc57c\ud569\ub2c8\ub2e4."],{arg1:"1",arg2:"32"})+"</p>"),e("#"+s.name).click(function(){e(".go_alert").remove()}),e("#"+s.name).keydown(function(){e(".go_alert").remove()}),!1;if(s.value=="dateSelect"){var o="BYMONTH="+e("#selectMonth_date>option:selected").val(),a="BYMONTHDAY="+e("#selectDate_date>option:selected").val(),f="FREQ=YEARLY;"+o+";"+a;t.model.set("recurrence",f,{silent:!0})}else if(s.value=="daySelect"){var o="BYMONTH="+e("#selectMonth_day>option:selected").val(),l="BYDAY="+e("#selectWeek_day>option:selected").val()+e("#selectDay_day>option:selected").val(),f="FREQ=YEARLY;"+o+";"+l;t.model.set("recurrence",f,{silent:!0})}t.model.set("timeType","allday",{silent:!0}),t.model.set("visibility","public",{silent:!0}),t.model.set("startTime",new Date("2000","0","01"),{silent:!0}),t.model.set("endTime",new Date("2000","0","01"),{silent:!0}),s.name!="dateOrDay"&&t.model.set(s.name,s.value,{silent:!0})});if(!i)return!1;t.model.save({},{success:function(n,i){i.code=="200"&&(e.goMessage(o["\uc800\uc7a5\ub418\uc5c8\uc2b5\ub2c8\ub2e4."]),r.close(),t.renderHolidayList())},error:function(t,n){n.responseJSON.message=="UnsupportedLunarConversionException."?e.goAlert(o["\uc2e4\ud328"],a["\uc720\ud6a8\ud558\uc9c0 \uc54a\uc740 \uc74c\ub825\ub0a0\uc9dc \uc785\ub2c8\ub2e4."]):e.goAlert(o["\uc2e4\ud328"],o["\uc2e4\ud328\ud588\uc2b5\ub2c8\ub2e4."])}})};this.popupUnbindEvents(l),this.popupBindEvents(l)},deleteHoliday:function(){var t=this,n=new Array,r=this.$el.find("form[name=formHolidayList]"),i=r.find('input[type="checkbox"]:checked');if(i.size()==0){e.goAlert(u["\uc0ad\uc81c\uacf5\ud734\uc77c\uc120\ud0dd"]);return}i.attr("value",function(e,t){t!="on"&&t!=null&&n.push(t)}),e.goCaution(u["\uacf5\ud734\uc77c\uc0ad\uc81c\uc9c8\ubb38"],u["\uc0ad\uc81c\uacbd\uace0"],function(){var r=GO.contextRoot+"ad/api/calendar/holiday";e.go(r,JSON.stringify({ids:n}),{qryType:"DELETE",contentType:"application/json",responseFn:function(n){n.code==200&&(e.goMessage(o["\uc0ad\uc81c\ub418\uc5c8\uc2b5\ub2c8\ub2e4."]),t.renderHolidayList())},error:function(t){var n=JSON.parse(t.responseText);n.message!=null?e.goMessage(n.message):e.goMessage(o["\uc2e4\ud328\ud588\uc2b5\ub2c8\ub2e4."])}})})}},{__instance__:null});return l})}).call(this);