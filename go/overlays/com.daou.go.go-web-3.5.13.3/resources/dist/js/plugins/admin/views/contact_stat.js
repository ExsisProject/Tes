(function(){define(["jquery","backbone","app","hgn!admin/templates/contact_stat","hgn!admin/templates/list_empty","i18n!nls/commons","i18n!admin/nls/admin","jquery.go-grid","jquery.go-validation"],function(e,t,n,r,i,s,o){var u={label_down:o["\ubaa9\ub85d \ub2e4\uc6b4\ub85c\ub4dc"],label_search:s["\uac80\uc0c9"],label_company_cnt:o["\uc804\uc0ac\uc8fc\uc18c\ub85d \uc5f0\ub77d\ucc98 \uac1c\uc218"],label_private_cnt:o["\uac1c\uc778\uc8fc\uc18c\ub85d \uc5f0\ub77d\ucc98 \uac1c\uc218"],label_user:o["\uc0ac\uc6a9\uc790"],label_contact_cnt:o["\uc5f0\ub77d\ucc98 \uac1c\uc218(\uac1c)"],label_count:o["\uac1c"]},a=n.BaseView.extend({el:"#layoutContent",events:{"click .wrap_action":"onClickedWrapAction"},initialize:function(){this.listEl="#contactList",this.dataTable=null,this.unbindEvent(),this.bindEvent()},unbindEvent:function(){this.$el.off("click","#csvDownLoadBtn"),this.$el.off("click","span.btn_search"),this.$el.off("keydown","span.search_wrap input")},bindEvent:function(){this.$el.on("click","#csvDownLoadBtn",e.proxy(this.csvDownLoad,this)),this.$el.on("click","span.btn_search",e.proxy(this.search,this)),this.$el.on("keydown","span.search_wrap input",e.proxy(this.searchKeyboardEvent,this))},render:function(){this.$el.empty();var e=this.getContactTotalCnt();this.$el.html(r({lang:u,companyContactCnt:e.companyTotalCount,privateContactCnt:e.personalTotalCount})),this.renderContactCompanyList()},onClickedWrapAction:function(){this.$el.find(".wrap_action").toggle(),this.$el.find(".info_summary li").not(".first").toggle()},getContactTotalCnt:function(){var t={},n=GO.contextRoot+"ad/api/contact/stat/count";return e.go(n,"",{async:!1,qryType:"GET",contentType:"application/json",responseFn:function(e){e.code==="200"&&(t=e.data)},error:function(t){e.goAlert(type.error)}}),t},renderContactCompanyList:function(){this.dataTable!=null&&this.dataTable.tables.fnDestroy();var t=this;this.dataTable=e.goGrid({el:this.listEl,method:"GET",url:GO.contextRoot+"ad/api/contact/stat/user",emptyMessage:i({label_desc:o["\ubaa9\ub85d\uc5c6\uc74c"]}),sDomType:"admin",defaultSorting:[[1,"desc"]],params:{page:this.page},displayLength:n.session("adminPageBase"),columns:[{mData:"name",bSortable:!1,fnRender:function(e){return e.aData.name+" "+e.aData.positionName}},{mData:"contactCount",bSortable:!0,sWidth:"230px"}],fnDrawCallback:function(e){t.$el.find(".toolbar_top .custom_header").append(t.$el.find("#csvDownLoad").show())}})},csvDownLoad:function(){var e="ad/api/contact/stat/user/download?",t=this.dataTable.listParams,n={property:t.property,direction:t.direction,type:t.type,searchtype:t.searchtype,keyword:t.keyword};GO.util.downloadCsvFile(e+GO.util.jsonToUrlParam(n))},search:function(){var e=this.$el.find('.table_search input[type="text"]'),t=e.val();this.dataTable.tables.search(this.$el.find(".table_search select").val(),t,e)},searchKeyboardEvent:function(e){e.keyCode==13&&this.search()}},{__instance__:null});return a})}).call(this);