(function(){define(["jquery","app","views/circle","i18n!nls/commons","i18n!admin/nls/admin","admin/models/task_config","hgn!admin/templates/task_config","jquery.go-popup","jquery.go-sdk","jquery.go-orgslide"],function(e,t,n,r,i,s,o){var u={label_ok:r["\uc800\uc7a5"],label_cancel:r["\ucde8\uc18c"],label_base:i["\uc5c5\ubb34 \uae30\ubcf8\uc124\uc815"],label_side:i["Side \uc6b0\uc120 \uc124\uc815"],label_dept:i["\ubd80\uc11c \uc5c5\ubb34 \ud3f4\ub354"],label_company:i["\uc804\uc0ac \uc5c5\ubb34 \ud3f4\ub354"],label_attach_limit:i["\ucca8\ubd80\ud30c\uc77c \uc6a9\ub7c9\uc81c\ud55c"],label_attach_limit_desc:i["\ud30c\uc77c1\uac1c"],label_non_limit:i["\uc81c\ud55c\uc5c6\uc74c"],label_limit_size:i["\uc6a9\ub7c9\uc81c\ud55c"],label_limit_number:i["\uac1c\uc218\uc81c\ud55c"],label_mb:i.MB,label_attach_num_limit:i["\ucca8\ubd80\ud30c\uc77c \uac1c\uc218\uc81c\ud55c"],label_attach_num_limit_desc:i["\uc5c5\ubb34\ub2f9"],label_count:i["\uac1c"],label_under:i["\uc774\ud558"],label_exclude:i["\uc5c5\ub85c\ub4dc \ubd88\uac00 \ud30c\uc77c"],label_desc:i["\uc5c5\ub85c\ub4dc \uc81c\ud55c"],label_org_view:i["\uc870\uc9c1\ub3c4\ubcc4 \uc5c5\ubb34 \ud604\ud669 \ubcf4\uae30"],label_view_desc:i["\uc870\uc9c1\ub3c4\ubcc4\uc5c5\ubb34\ud604\ud669 \uc124\uba85"],label_cal_view:i["\uce98\ub9b0\ub354 \ubdf0 \uc0ac\uc6a9\uc790"],label_detail_view:i["\uc5c5\ubb34 \uc0c1\uc138 \ubcf4\uae30 \ud5c8\uc6a9"]},a=t.BaseView.extend({events:{"click form[name='formTaskConfig'] input:radio":"toggleRadio","click span#btn_ok":"taskConfigSave","click span#btn_cancel":"taskConfigCancel","click span.btn_box[data-btntype='changeform']":"changeModifyForm","click span#data":"changeModifyForm","click span#data":"changeModifyForm","keyup input[name='excludeExtension']":"keyUPValidator","keyup span#maxAttachSize input":"keyUPValidator","keyup span#maxAttachNumber input":"keyUPValidator","focusout span#maxAttachSize input":"inputValidator","focusout span#maxAttachNumber input":"inputValidator","submit form":"formSubmit"},initialize:function(){this.model=s.read({admin:!0})},render:function(){var e=this,t=this.model.toJSON(),n=o({lang:u,model:t,hasExcludeExtension:function(){return t.excludeExtension==null||t.excludeExtension==""?!0:!1},isOrgServiceOn:GO.util.isUseOrgService(!0)});return this.$el.html(n),e.model.get("attachSizeLimit")||this.$("#maxAttachSize").hide(),e.model.get("attachNumberLimit")||this.$("#maxAttachNumber").hide(),this._renderViewer(),this},_renderViewer:function(){var e=["user","position","grade","usergroup"];GO.util.isUseOrgService(!0)&&(e=["user","department","position","grade","duty","usergroup"]),this.taskCalendarView=new n({selector:"#viewer",isAdmin:!0,isWriter:!0,circleJSON:this.model.get("viewers"),nodeTypes:e}),this.taskCalendarView.render(),this.taskCalendarView.show()},formSubmit:function(e){e.preventDefault();return},keyUPValidator:function(t){var n=t.currentTarget.value,r=t.currentTarget.id,s=e(t.currentTarget).parent(),o=s.parent().parent().find(".go_alert");o.html("");if(r=="excludeExtension"){if(!n.match(new RegExp("^[a-zA-Z0-9,]*$")))return o.html(i["\uc601\uc5b4, \uc27c\ud45c, \uc22b\uc790\ub9cc \uc785\ub825\uac00\ub2a5"]),t.currentTarget.focus(),t.currentTarget.value="",!1}else{if(n==0||n=="")return o.html(i["\uc81c\ud55c \uac12\uc744 \uc785\ub825\ud558\uc138\uc694."]),t.currentTarget.focus(),t.currentTarget.value="",!1;if(!(t.keyCode>=96&&t.keyCode<=105||t.keyCode>=48&&t.keyCode<=57||t.keyCode==46||t.keyCode==13||t.keyCode==8))return o.html(i["\uc22b\uc790\ub9cc \uc785\ub825\ud558\uc138\uc694."]),t.currentTarget.value="",!1}},changeModifyForm:function(t){var n=e(t.currentTarget).parent();n&&n.attr("data-formname")=="excludeExtension"?n.html(['<input type="input" name="',n.attr("data-formname"),'"id="',n.attr("data-formname"),'" class="input w_large" value="',n.attr("data-value"),'" />'].join("")).find("input").focusin():(e(t.currentTarget).hide(),n.html(['<input type="input" name="',n.attr("data-formname"),'"id="',n.attr("data-formname"),'" class="input t_num" value="',n.attr("data-value"),'" />'].join("")).find("input").focusin())},inputValidator:function(t){var n=t.currentTarget.value,r=t.currentTarget.id,s=e(t.currentTarget).parent(),o=s.parent().parent().find(".go_alert"),u=this.$("input#size_false").is(":checked"),a=this.$("input#number_false").is(":checked");o.html("");if(u==0&&r=="maxAttachSize"&&n>999)return o.html(i["1~999"]),t.currentTarget.focus(),!1;if(a==0&&r=="maxAttachNumber"&&n>99)return o.html(i["1~99"]),t.currentTarget.focus(),!1},toggleRadio:function(t){e(t.currentTarget).attr("value")=="true"?e(t.currentTarget).is(':radio[name="attachSizeLimit"]')?(this.$("#maxAttachSize").show(),this.$('input[name="maxAttachSize"]').focus()):e(t.currentTarget).is(':radio[name="attachNumberLimit"]')&&(this.$("#maxAttachNumber").show(),this.$('input[name="maxAttachNumber"]').focus()):e(t.currentTarget).attr("value")=="false"&&(e(t.currentTarget).is(':radio[name="attachSizeLimit"]')?(this.$("#maxAttachSize").hide(),this.$("#maxAttachSizeAlert").html("")):e(t.currentTarget).is(':radio[name="attachNumberLimit"]')&&(this.$("#maxAttachNumber").hide(),this.$("#maxAttachNumberAlert").html("")))},taskConfigSave:function(){var t=this,n=!0;form=this.$el.find("form[name=formTaskConfig]"),e.each(form.serializeArray(),function(e,r){var s=r.value,o=r.name,u=t.$("#"+r.name+"Alert");u.html("");if(o=="excludeExtension"){if(!s.match(new RegExp("^[a-zA-Z0-9,]*$")))return u.html(i["\uc601\uc5b4, \uc27c\ud45c, \uc22b\uc790\ub9cc \uc785\ub825\uac00\ub2a5"]),t.$('input[name="'+o+'"]').focus(),n=!1,!1;r.value=r.value.toLowerCase()}else{var a=t.$("input#size_false").is(":checked"),f=t.$("input#number_false").is(":checked");if(!(s!=0&&s!=""||a!=0&&f!=0))return u.html(i["\uc81c\ud55c \uac12\uc744 \uc785\ub825\ud558\uc138\uc694."]),t.$('input[name="'+o+'"]').focus(),n=!1,!1;if(a==0&&o=="maxAttachSize"&&s>999)return u.html(i["1~999"]),t.$('input[name="'+o+'"]').focus(),n=!1,!1;if(f==0&&o=="maxAttachNumber"&&s>99)return u.html(i["1~99"]),t.$('input[name="'+o+'"]').focus(),n=!1,!1}if(!n)return!1;t.model.set(r.name,r.value,{silent:!0})});var s=t.taskCalendarView.getData();t.model.set("viewers",s),t.model.set("detailView",t.$("#detailView").is(":checked"));if(!n)return!1;t.model.save({},{success:function(n,i){i.code=="200"&&(e.goMessage(r["\uc800\uc7a5\ub418\uc5c8\uc2b5\ub2c8\ub2e4."]),t.render())},error:function(t,n){var i=JSON.parse(n.responseText);i.message!=null?e.goMessage(i.message):e.goMessage(r["\uc2e4\ud328\ud588\uc2b5\ub2c8\ub2e4."])}})},taskConfigCancel:function(){var t=this;e.goCaution(r["\ucde8\uc18c"],r["\ubcc0\uacbd\ud55c \ub0b4\uc6a9\uc744 \ucde8\uc18c\ud569\ub2c8\ub2e4."],function(){t.render(),e.goMessage(r["\ucde8\uc18c\ub418\uc5c8\uc2b5\ub2c8\ub2e4."])},r["\ud655\uc778"])}});return a})}).call(this);