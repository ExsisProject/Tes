(function(){define(["jquery","backbone","app","hogan","hgn!admin/templates/community_all","hgn!admin/templates/community_summary_info","hgn!admin/templates/list_empty","i18n!nls/commons","i18n!admin/nls/admin","jquery.go-popup","jquery.go-sdk","jquery.go-grid","jquery.go-validation","GO.util"],function(e,t,n,r,i,s,o,u,a){var f={label_total_community:a["\ucd1d \ucee4\ubba4\ub2c8\ud2f0 \uc218"],label_count:a["\uac1c"],label_mb:a.MB,label_total_storage:a["\ucd1d \uc0ac\uc6a9\ub7c9"],label_down:a["\ubaa9\ub85d \ub2e4\uc6b4\ub85c\ub4dc"],label_name:a["\ucee4\ubba4\ub2c8\ud2f0 \uba85"],label_master:a["\ub9c8\uc2a4\ud130"],label_created:a["\uc0dd\uc131\uc77c"],label_members:a["\ud68c\uc6d0\uc218(\uba85)"],label_posts:a["\uac8c\uc2dc\ubb3c \uc218(\uac1c)"],label_storage:a["\uc0ac\uc6a9\ub7c9(MB)"],label_search:u["\uac80\uc0c9"],label_used:u["\uc0ac\uc6a9"],label_wait:a["\uac1c\uc124\ub300\uae30"],label_stop:a["\uc911\uc9c0"],label_usage_desc:a["\uc0ac\uc6a9\ub7c9\uc815\ubcf4 \uc548\ub0b4"]},l=n.BaseView.extend({el:"#layoutContent",events:{"click .wrap_action":"onClickedWrapAction"},unbindEvent:function(){this.$el.off("click","span.btn_search"),this.$el.off("keydown","span.search_wrap input"),this.$el.off("click","span#btn_down")},bindEvent:function(){this.$el.on("click","span.btn_search",e.proxy(this.search,this)),this.$el.on("keydown","span.search_wrap input",e.proxy(this.searchKeyboardEvent,this)),this.$el.on("click","span#btn_down",e.proxy(this.downCommunityList,this))},initialize:function(){this.unbindEvent(),this.bindEvent(),this.listEl="#communityList",this.dataTable=null,this.model=new t.Model,this.model.url=GO.contextRoot+"ad/api/community/used"},render:function(){var e=this;this.$el.empty(),this.$el.html(i({lang:f,selectType:[{name:a["\ucee4\ubba4\ub2c8\ud2f0 \uba85"],value:"name"},{name:a["\ub9c8\uc2a4\ud130"],value:"masterUser"}]})),this.model.fetch().done(function(){e.renderInfo()}),this.renderCommunityList()},renderInfo:function(){var e=this.model.toJSON();this.$el.find("communityCount").val(this.model.get("communityOnlineCount"));var t=s({lang:f,model:e,totalCount:function(){return e.communityOnlineCount+e.communityWaitCount+e.communityStopCount},totalSize:function(){return GO.util.byteToMega(e.communityTotalSize)}});this.$el.find(".content_info").html(t)},renderCommunityList:function(){var t=this;this.dataTable=e.goGrid({el:this.listEl,method:"GET",url:GO.contextRoot+"ad/api/community/list/all",emptyMessage:o({label_desc:a["\ucee4\ubba4\ub2c8\ud2f0\uac00 \uc5c6\uc2b5\ub2c8\ub2e4."]}),defaultSorting:[[2,"desc"]],sDomType:"admin",displayLength:n.session("adminPageBase"),columns:[{mData:"name",bSortable:!0,sClass:"align_l",fnRender:function(e){return"<span data-id="+e.aData.id+">"+e.aData.name+"</span>"}},{mData:"masterUser",sWidth:"120px",mData:"masterUser",mRender:function(e){return e?e:""},bSortable:!0,fnRender:function(e){return e.aData.masterUser?e.aData.masterUser+" "+e.aData.masterPosition:"<td></td>"}},{mData:"createdAt",sClass:"align_c",sWidth:"120px",fnRender:function(e){return GO.util.shortDate(e.aData.createdAt)}},{mData:"memberCount",sClass:"align_r",sWidth:"120px",bSortable:!0},{mData:"postCount",sClass:"align_r",sWidth:"130px",bSortable:!0},{mData:"totalSize",sClass:"align_r",sWidth:"130px",bSortable:!0,fnRender:function(e){return GO.util.byteToMega(e.aData.totalSize)}}],fnDrawCallback:function(r,i){t.$el.find(".toolbar_top .custom_header").append(t.$el.find("#controlButtons").show()),i._iRecordsTotal>0&&t.$el.find("tr>td:nth-child(1)").css("cursor","pointer").click(function(t){n.router.navigate("community/detail/"+e(t.currentTarget).find("span").attr("data-id"),{trigger:!0})})}})},search:function(){var t=this.$el.find(".table_search input"),r=t.val();t.trigger("focusout").blur();if(e.trim(r)==""){e.goAlert(u["\uac80\uc0c9\uc5b4\ub97c \uc785\ub825\ud558\uc138\uc694."]);return}if(!e.goValidation.isCheckLength(2,32,r)){e.goAlert(n.i18n(a["0\uc790\uc774\uc0c1 0\uc774\ud558 \uc785\ub825\ud574\uc57c\ud569\ub2c8\ub2e4."],{arg1:"2",arg2:"32"}));return}this.dataTable.tables.search(this.$el.find(".table_search select").val(),r)},searchKeyboardEvent:function(e){e.keyCode==13&&this.search()},downCommunityList:function(){var e="ad/api/community/download/list?",t=this.dataTable.listParams,n={property:t.property,direction:t.direction,keyword:t.keyword,searchtype:t.searchtype};GO.util.downloadCsvFile(e+GO.util.jsonToUrlParam(n))},onClickedWrapAction:function(){this.$el.find(".wrap_action").toggle(),this.$el.find(".info_summary li").not(".first").toggle()}},{__instance__:null});return l})}).call(this);