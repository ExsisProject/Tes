define(["jquery","backbone","app","i18n!nls/commons","i18n!admin/nls/admin","hgn!admin/templates/board_statistics","hgn!admin/templates/board_statistics_top","hgn!admin/templates/board_null","i18n!admin/nls/admin","jquery.go-sdk","jquery.go-popup","jquery.go-grid","jquery.ui","GO.util","jquery.go-validation"],function(e,t,n,r,i,s,o,u,i){var a={board_null:i["\ub4f1\ub85d\ub41c \uac8c\uc2dc\ud310\uc774 \uc5c6\uc2b5\ub2c8\ub2e4."],BBS:i["\ud074\ub798\uc2dd"],STREAM:i["\ud53c\ub4dc"],count:i["\uac1c"],mb:i.MB,total_board:i["\ucd1d \uac8c\uc2dc\ud310 \uc218"],total_post:i["\ucd1d \uac8c\uc2dc\ubb3c \uc218"],total_size:i["\ucd1d \uc0ac\uc6a9\ub7c9"],board_statistics:i["\uc804\uccb4 \uac8c\uc2dc\ud310 \ud1b5\uacc4"],title:r["\uc81c\ubaa9"],dept:i["\uc18c\uc720\ubd80\uc11c"],board_type:i["\uc804\uccb4\uc720\ud615"],board_bbs:i["\ud074\ub798\uc2dd \ud0c0\uc785"],board_feed:i["\ud53c\ub4dc \ud0c0\uc785"],post_count:i["\uac8c\uc2dc\ubb3c \uac1c\uc218"],usage:i["\uc0ac\uc6a9\ub7c9(MB)"],board_create:i["\uc0dd\uc131\uc77c"],board_title:i["\uac8c\uc2dc\ud310 \uc81c\ubaa9"],search:r["\uac80\uc0c9"],alert_keyword:r["\uac80\uc0c9\uc5b4\ub97c \uc785\ub825\ud558\uc138\uc694."],alert_length:i["0\uc790\uc774\uc0c1 0\uc774\ud558 \uc785\ub825\ud574\uc57c\ud569\ub2c8\ub2e4."],label_down:i["\ubaa9\ub85d \ub2e4\uc6b4\ub85c\ub4dc"],status:i["\uc0c1\ud0dc"],active:i["\uc815\uc0c1"],closed:i["\uc911\uc9c0"],loading:i["\ub85c\ub529\uc911"]},f=null,l=t.View.extend({events:{"click .wrap_action":"onClickedWrapAction"},unbindEvent:function(){this.$el.off("click","span.btn_search"),this.$el.off("click","#csvDownLoadBtn"),this.$el.off("keydown","span.search_wrap input"),this.$el.off("change","#boardType"),this.$el.off("change","#boardStatus")},bindEvent:function(){this.$el.on("click","span.btn_search",e.proxy(this.search,this)),this.$el.on("click","#csvDownLoadBtn",e.proxy(this.csvDownLoad,this)),this.$el.on("keydown","span.search_wrap input",e.proxy(this.searchKeyboardEvent,this)),this.$el.on("change","#boardType",e.proxy(this.boardTypeFilter,this)),this.$el.on("change","#boardStatus",e.proxy(this.boardStatusFilter,this))},csvDownLoad:function(){var e="ad/api/company/statistic/boards/download?",t=this.dataTableStatistics.listParams,n={property:t.property,direction:t.direction,type:t.type,searchtype:t.searchtype,keyword:t.keyword,statusFilter:t.statusFilter};GO.util.downloadCsvFile(e+GO.util.jsonToUrlParam(n))},search:function(){var e=this.$el.find('.table_search input[type="text"]'),t=e.val();this.dataTableStatistics.tables.search(this.$el.find(".table_search select").val(),t,e)},searchKeyboardEvent:function(e){e.keyCode==13&&this.search()},initialize:function(){},onClickedWrapAction:function(){this.$el.find(".wrap_action").toggle(),this.$el.find(".info_summary li").not(".first").toggle()},renderStatistics:function(){var e=this.statisticsModel.toJSON(),t=function(){return i["\uc815\uc0c1"]+" : "+this.totalActiveBoard},n=function(){return i["\uc911\uc9c0"]+" : "+this.totalClosedBoard},r=function(){return i["\ud074\ub798\uc2dd"]+" : "+this.totalBbsPost},s=function(){return i["\ud53c\ub4dc"]+" : "+this.totalStreamPost},u=function(){return GO.util.byteToMega(this.totalAttachSize)},f=function(){return GO.util.byteToMega(this.activeAttachSize)},l=function(){return GO.util.byteToMega(this.closedAttachSize)},c=o({dataset:this.statisticsModel.toJSON(),boardActionParse:t,boardClosedParse:n,bbsCountParse:r,feedCountParse:s,totalSize:u,activeSize:f,closedSize:l,lang:a});this.$el.find("#content_top").html(c)},render:function(){var e=this;this.companyId=GO.session().companyId,this.dataTableStatistics=null,this.unbindEvent(),this.bindEvent(),this.statisticsModel=new t.Model,this.statisticsModel.url=GO.contextRoot+"ad/api/company/statistic/board",this.statisticsModel.fetch({async:!0,success:function(){e.renderStatistics()}});var n=s({lang:a});this.$el.html(n),this.renderDataTables()},boardTypeFilter:function(t){var n=e(t.currentTarget).val();this.changeFilter("type",n)},boardStatusFilter:function(t){var n=e(t.currentTarget).val();this.changeFilter("statusFilter",n)},changeFilter:function(e,t){typeof this.dataTableStatistics.tables.setParam=="function"&&this.dataTableStatistics.tables.setParam(e,t)},renderDataTables:function(){var t=this;this.dataTableStatistics=e.goGrid({el:"#bbsDataTable",type:"admin",method:"GET",url:GO.contextRoot+"ad/api/company/statistic/boards",emptyMessage:u({lang:a}),defaultSorting:[[5,"desc"]],sDomType:"admin",params:{page:this.page},columns:[{mData:"name",sClass:"title",bSortable:!0},{mData:"sortOwnerInfos",sClass:"title",bSortable:!0,fnRender:function(e){var t,n=e.aData.owners;return _.each(n,function(e){e.ownerShip==="MASTER"&&(t=e.ownerInfo)}),t}},{mData:"type",bSortable:!1,sWidth:"120px",fnRender:function(e){return e.aData.type=="CLASSIC"?a.BBS:a.STREAM}},{mData:null,bSortable:!1,sWidth:"120px",fnRender:function(e){return e.aData.status=="ACTIVE"?a.active:a.closed}},{mData:"postCount",sClass:"align_r",bSortable:!0,sWidth:"140px"},{mData:"totalSize",sClass:"align_r",bSortable:!0,sWidth:"140px",fnRender:function(e){return GO.util.byteToMega(e.aData.totalSize)}},{mData:"createdAt",sClass:"align_c",sWidth:"120px",bSortable:!0,fnRender:function(e){return GO.util.shortDate(e.aData.createdAt)}}],fnDrawCallback:function(n,r,i){t.$el.find(".toolbar_top .custom_header").append(t.$el.find("#csvDownLoad").show()),e(".tool_bar .dataTables_length").hide()}})}});return l});