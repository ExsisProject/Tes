(function(){define(["backbone","app","hgn!admin/templates/notice/list","hgn!admin/templates/notice/reader_list","admin/libs/recurrence_parser","i18n!nls/commons","i18n!admin/nls/admin","jquery.go-grid","GO.util","jquery.go-preloader"],function(e,t,n,r,i,s,o){function f(e,t,n){}var u={add_notice:o["\uacf5\uc9c0 \ucd94\uac00"],remove_notice:s["\uc0ad\uc81c"],name:s["\uc81c\ubaa9"],term:o["\uacf5\uc9c0 \uae30\uac04"],state:s["\uc0c1\ud0dc"],hidden:o["\uc0ac\uc6a9\ud558\uc9c0 \uc54a\uc74c"],normal:o["\uc0ac\uc6a9"],creator:o["\ub4f1\ub85d\uc790"],createdAt:o["\ub4f1\ub85d\uc77c"],config:s["\uc124\uc815"],search:s["\uac80\uc0c9"],empty_data:o["\ub4f1\ub85d\ub41c \uacf5\uc9c0\uac00 \uc5c6\uc2b5\ub2c8\ub2e4."],not_select:o["\uacf5\uc9c0\uc0ac\ud56d\uc744 \uc120\ud0dd\ud574\uc8fc\uc138\uc694."],delete_success:s["\uc0ad\uc81c\ub418\uc5c8\uc2b5\ub2c8\ub2e4."],delete_title:o["\ud31d\uc5c5 \uacf5\uc9c0 \uc0ad\uc81c"],delete_confirm:o["\ud31d\uc5c5 \uacf5\uc9c0 \uc0ad\uc81c \uc54c\ub9bc"],no_title:s["\uc81c\ubaa9\uc5c6\uc74c"],read:s["\uc870\ud68c"],show:s["\ubcf4\uae30"],device:o["\ub514\ubc14\uc774\uc2a4"],web:o["\uc6f9"],mobile:o["\ubaa8\ubc14\uc77c"]},a=e.View.extend({el:"#layoutContent",events:{"click #add_notice":"addNotice","click #remove_notice":"removeNotice","change #type_select":"stateFilter","click span.btn_search":"search","keydown span.search_wrap input":"searchKeyboardEvent","click input:checkbox":"toggleCheckbox"},initialize:function(){},render:function(){this.$el.html(n({lang:u})),this.makeGrid()},makeGrid:function(){var e=this;this.noticeGrid=$.goGrid({el:"#notice_table",method:"GET",destroy:!0,url:t.contextRoot+"ad/api/notice/all",params:this.searchParams,emptyMessage:"<p class='data_null'> <span class='ic_data_type ic_no_data'></span><span class='txt'>"+u.empty_data+"</span>"+"</p>",defaultSorting:[[6,"desc"]],sDomType:"admin",checkbox:!0,checkboxData:"id",displayLength:t.session("adminPageBase"),columns:[{mData:"title",sClass:"subject",bSortable:!0,fnRender:function(e){var t=e.aData.title;return $.trim(t).length==0&&(t=u.no_title),"<span data-type='title' data-id='"+e.aData.id+"'>"+t+"</span>"}},{mData:"startTime",sClass:"period",bSortable:!1,fnRender:function(e){if(e.aData.recurrence!=undefined&&e.aData.recurrence!=""){var t=new i,n=e.aData.recurrence;return t.parse(n).humanize()}var r=moment(e.aData.startTime).format("YYYY-MM-DD"),s=moment(e.aData.endTime).format("YYYY-MM-DD");return r+" ~ "+s}},{mData:"showWeb",sClass:"device",bSortable:!1,fnRender:function(e){var t=e.aData.showWeb,n=e.aData.showMobile;if(t&&n)return u.web+", "+u.mobile;if(t==1&&n==0)return u.web;if(t==0&&n==1)return u.mobile}},{mData:"state",sClass:"",bSortable:!1,fnRender:function(e){var t={};return t.hidden=u.hidden,t.normal=u.normal,t[e.aData.state]}},{mData:"creator",sClass:"name",bSortable:!0,fnRender:function(e){var t=e.aData.creator;return t.name+" "+t.position}},{mData:"createdAt",sClass:"date",bSortable:!0,fnRender:function(e){return t.util.customDate(e.aData.createdAt,"YYYY-MM-DD")}},{mData:null,sClass:"action reader",bSortable:!1,fnRender:function(e){return"<span class='btn_s' data-id='"+e.aData.id+"'>"+u.show+"</span>"}},{mData:null,sClass:"last action",bSortable:!1,fnRender:function(e){return"<span class='btn_s' data-id='"+e.aData.id+"'>"+u.config+"</span>"}}],fnDrawCallback:function(n,r,i){e.$el.find(".toolbar_top .custom_header").append(e.$el.find("#controlButtons").show()),e.$el.find("#checkedAll").attr("checked",!1),e.$el.find(this.el+" tr>td.reader span.btn_s").css("cursor","pointer").click(function(t){e._popupReader($(t.currentTarget).attr("data-id"))}),e.$el.find(this.el+" tr>td.last span.btn_s").css("cursor","pointer").click(function(e){var n="company/notice/"+$(e.currentTarget).attr("data-id");t.router.navigate(n,{trigger:!0})}),e.$el.find(this.el+" tr>td.subject span[data-type='title']").css("cursor","pointer").click(function(e){var n="company/notice/"+$(e.currentTarget).attr("data-id");t.router.navigate(n,{trigger:!0})})}}).tables},_popupReader:function(e){var n=null;n=$.goPopup({pclass:"layer_normal layer_count",header:s["\uc870\ud68c"],contents:r(),buttons:[{btype:"confirm",btext:s["\ud655\uc778"]}]}),$.goGrid({el:"#readerList",url:t.contextRoot+"ad/api/notice/"+e+"/reader",displayLength:10,displayLengthSelect:!1,emptyMessage:"<p class='data_null'><span class='ic_data_type ic_no_data'></span><span class='txt'>"+o["\ubaa9\ub85d\uc5c6\uc74c"]+"</span></p>",numbersShowPages:10,method:"GET",defaultSorting:[],sDom:'rt<"tool_bar"<"critical custom_bottom">p>',bProcessing:!1,columns:[{mData:null,sWidth:"100px",bSortable:!1,sClass:"align_l",fnRender:function(e){var t=e.aData,n=[t.reader.name," ",t.reader.position];return n.join("")}},{mData:null,sClass:"align_l",bSortable:!1,fnRender:function(e){var n=e.aData;return["<span class='date'>",t.util.basicDate(n.createdAt),"</span>"].join("")}}],fnDrawCallback:function(e,t,r){var i=n.find(".tool_bar");t._iRecordsTotal==0?($(this.el).find("tr:last-child>td").css("border-bottom",0),i.hide()):(i.show(),i.find("div.dataTables_paginate").css("margin-top",0)),n.find(".dataTables_wrapper").css("margin-bottom",0),n.reoffset()}})},toggleCheckbox:function(e){$(e.currentTarget).attr("id")=="checkedAll"&&$(e.currentTarget).is(":checked")?this.$el.find("input:checkbox").attr("checked",!0):$(e.currentTarget).attr("id")=="checkedAll"&&!$(e.currentTarget).is(":checked")?this.$el.find("input:checkbox").attr("checked",!1):$(e.currentTarget).is(":checked")?$(e.currentTarget).attr("checked",!0):(this.$el.find("#checkedAll").attr("checked",!1),$(e.currentTarget).attr("checked",!1))},addNotice:function(){t.router.navigate("company/notice/create",{trigger:!0})},stateFilter:function(e){this.changeFilter(e,"state")},searchKeyboardEvent:function(e){e.keyCode==13&&this.search()},search:function(){var e=this.$el.find('.table_search input[type="text"]'),t=e.val();this.noticeGrid.search(this.$el.find(".table_search select").val(),t,e)},changeFilter:function(e,t){var n=$(e.currentTarget).val();typeof this.noticeGrid.setParam=="function"&&this.noticeGrid.setParam(t,n)},removeNotice:function(){var e=this.noticeGrid.getCheckedIds(),n=t.contextRoot+"ad/api/notice",r=this,i=$("#notice_table").find('tbody input[type="checkbox"]:checked').length;if(i!=e.length)return;if(e.length==0){$.goMessage(u.not_select);return}$.goConfirm(u.delete_title,u.delete_confirm,function(){var t=$.goPreloader();t.render(),$.ajax({type:"DELETE",async:!0,data:JSON.stringify({ids:e}),dataType:"json",contentType:"application/json",url:n}).done(function(e){t.release(),$.goMessage(u.delete_success),r.noticeGrid.reload()}).fail(function(){$.goError(s["\uc800\uc7a5\uc5d0 \uc2e4\ud328 \ud558\uc600\uc2b5\ub2c8\ub2e4."]),t.release()})})}},{render:function(){var e=new a;return e.render()}});return a})})();