define("admin/views/ehr/timeline/status/code_manage",function(require){var e=require("jquery"),t=require("app"),n=require("backbone"),r=require("admin/models/ehr/timeline/code"),i=require("admin/models/ehr/timeline/ext_config"),s=require("hgn!admin/templates/ehr/timeline/status/code_list"),o=require("hgn!admin/templates/ehr/timeline/status/code_layer"),u=require("i18n!nls/commons"),a=require("i18n!admin/nls/admin");require("jquery.go-popup"),require("jquery.go-grid");var f={label_add_code:a["\ucd94\uac00"],label_code:a["\ucf54\ub4dc"],label_code_name:a["\ud56d\ubaa9"],label_timeline_type:a["\uadfc\ud0dc \uc720\ud615 \ud0c0\uc785"],label_include_working_time:a["\uadfc\ubb34\uc2dc\uac04"],label_use_yn:a["\uc0ac\uc6a9\uc5ec\ubd80"],label_timeline_manage:a["\uadfc\ud0dc \uc720\ud615 \ub4f1\ub85d"],label_timeline_modify:a["\uadfc\ud0dc \uc720\ud615 \uc124\uc815"],label_empty_list:a["\ub4f1\ub85d\ub41c \uadfc\ud0dc\uad00\ub9ac\ucf54\ub4dc\uac00 \uc5c6\uc2b5\ub2c8\ub2e4."],label_caution_code:a["\uadfc\ud0dc \uc720\ud615 \ucf54\ub4dc\ub294 \ud544\uc218\uc785\ub825\uac12\uc785\ub2c8\ub2e4."],label_caution_name:a["\uadfc\ud0dc \uc720\ud615 \uba85\uce6d\uc740 \ud544\uc218\uc785\ub825\uac12\uc785\ub2c8\ub2e4."],label_date:a["\ub0a0\uc9dc"],label_time:a["\uc2dc\uac04"],label_setting:a["\uc124\uc815"],label_use:a["\uc0ac\uc6a9"],label_unuse:a["\ubbf8\uc0ac\uc6a9"],label_include_y:a["\ud3ec\ud568"],label_include_n:a["\ud3ec\ud568\uc548\ud568"],label_use_yn_tooltip:a["\uc0ac\uc6a9 \uccb4\ud06c\uc2dc \uadfc\ud0dc \ud604\ud669 \ud654\uba74\uc5d0\uc11c \ud655\uc778 \ubc0f \uc0ac\uc6a9\uc774 \uac00\ub2a5\ud569\ub2c8\ub2e4."],label_code_check:u["\ucf54\ub4dc \uc785\ub825\uac12 \uccb4\ud06c"]},l=n.View.extend({events:{"click #btnManageControllCode #addCode":"_addCode","click span#onIncludeWorkingTime":"_onIncludeWorkingTime","click span#offIncludeWorkingTime":"_offIncludeWorkingTime","click span#onUse":"_onUse","click span#offUse":"_offUse"},initialize:function(e){this.timelineExtConfig=new i},render:function(){this.$el.html(s({lang:f}));var t=this.timelineExtConfig.fetch().promise();e.when(t).done(_.bind(function(){this._renderCodeDataTables()},this))},_renderCodeDataTables:function(){var n=this;this.codeDataTable=e.goGrid({el:"#timelineCodeManageTable",bDestory:!0,method:"GET",url:t.contextRoot+"ad/api/timeline/status/all",params:{},emptyMessage:"<p class='data_null'> <span class='ic_data_type ic_no_data'></span><span class='txt'>"+f.label_empty_list+"</span>"+"</p>",defaultSorting:[],pageUse:!1,sDomUse:!1,checkbox:!1,sDomType:"admin",columns:[{mData:null,sClass:"align_c",bSortable:!1,sWidth:"100px",fnRender:function(e){var t=e.aData.timelineCode;return t==undefined||t==""?"-":t}},{mData:null,sClass:"align_c",bSortable:!1,sWidth:"100px",fnRender:function(e){var t=e.aData.name;return t==undefined?"-":t}},{mData:null,sClass:"align_c",bSortable:!1,sWidth:"100px",fnRender:function(e){return n._timelineWorkingTimeConverter(e.aData.includeWorkingTime)}},{mData:null,sClass:"align_c",bSortable:!1,sWidth:"100px",fnRender:function(e){return n._timelineUseYNConverter(e.aData.useYN)}},{mData:null,sClass:"set align_c",bSortable:!1,sWidth:"60px",fnRender:function(e){if(e&&e.aData.defaultStatus)return"";var t="<span id='settingCode' class='btn_s' data-id='"+e.aData.id+"'>"+a["\uc124\uc815"]+"</span>";return t}}],fnDrawCallback:function(t,r,i){n.$el.find("tr>td:nth-child(5) span").click(function(t){var r=e(t.currentTarget).data("id");n._editCode(t,r)})}}),this.codeList=this.codeDataTable.tables.fnGetData()},_codeTableReload:function(){this.codeDataTable.tables.reload()},_addCode:function(e){this._callPopupTimelineCode()},_editCode:function(e,t){this._callPopupTimelineCode(t)},_callPopupTimelineCode:function(n){var i=this.timelineExtConfig.get("syncActive");this.codeList=this.codeDataTable.tables.fnGetData(),this.editId=n;var s=this,l=o({lang:f,isEditable:!0,useOnOff:!0,includeWorkingTimeOnOff:!0});n&&(this.code=new r,this.code.set("id",n),this.code.fetch({async:!1}),l=o({lang:f,id:this.code.get("id"),isEditable:!0,isTimelineType:this.code.get("type")=="date"?!0:!1,timelineCode:this.code.get("timelineCode")==undefined?"":this.code.get("timelineCode"),includeWorkingTimeOnOff:this.code.get("includeWorkingTime")==1?!0:!1,useOnOff:this.code.get("useYN")==1?!0:!1,name:this.code.get("name"),isSyncActive:i})),this.codePopup=e.goPopup({pclass:"layer_normal layer_ehr_kind",header:n==null?f.label_timeline_manage:f.label_timeline_modify,modal:!0,width:"320px",contents:l,buttons:[{btext:u["\uc800\uc7a5"],btype:"confirm",autoclose:!1,callback:function(n){var i=n.find("input#timelineCode").val(),o=n.find("input#name").val(),l=n.find("button#onUse").hasClass("on"),c=n.find("button#onIncludeWorkingTime").hasClass("on"),h=!0,p=/^[a-zA-Z0-9-_]*$/;if(!p.test(i)){e("#stateNameValidate").text(f.label_code_check),e("input#timelineCode").focus();return}if(o==""){e("#stateNameValidate").text(f.label_caution_name),e("input#name").focus();return}if(!e.goValidation.isCheckLength(2,10,o)){e("#stateNameValidate").text(t.i18n(u["0\uc790\uc774\uc0c1 0\uc774\ud558 \uc785\ub825\ud574\uc57c\ud569\ub2c8\ub2e4."],{arg1:"2",arg2:"10"})),e("input#name").focus();return}if(s.codeList.length>0){e.each(s.codeList,function(t,n){if(i&&n.timelineCode==i){if(s.editId&&s.editId==n.id)return!0;e("#stateNameValidate").text(f.label_code+" : "+a["\uc774\ubbf8 \ucd94\uac00\ub418\uc5b4 \uc788\uc2b5\ub2c8\ub2e4."]),h=!1;return}});if(!h){e("input#timelineCode").focus();return}e.each(s.codeList,function(t,n){if(n.name==o){if(s.editId&&s.editId==n.id)return!0;e("#stateNameValidate").text(f.label_code_name+" : "+a["\uc774\ubbf8 \ucd94\uac00\ub418\uc5b4 \uc788\uc2b5\ub2c8\ub2e4."]),h=!1;return}});if(!h){e("input#name").focus();return}}n.find("span.title").data("id")?s.code.set("id",n.find("span.title").data("id")):s.code=new r,s.code.set("timelineCode",i),s.code.set("name",o),s.code.set("type","time"),s.code.set("useYN",l),s.code.set("includeWorkingTime",c),n.close(),t.EventEmitter.trigger("common","layout:setOverlay",""),s.code.save({},{success:function(e,n){s._codeTableReload(),t.EventEmitter.trigger("common","layout:clearOverlay",!0)},error:function(n,r){r&&r.responseJSON&&r.responseJSON.message?e.goSlideMessage(r.responseJSON.message,"caution"):e.goSlideMessage(u["\uc2e4\ud328\ud588\uc2b5\ub2c8\ub2e4."],"caution"),t.EventEmitter.trigger("common","layout:clearOverlay",!0)}})}},{btext:u["\ucde8\uc18c"],btype:"cancel"}]},this),this._popUpLayerEventBind()},_popUpLayerEventBind:function(){var t=this;this.codePopup.off("click","button#onIncludeWorkingTime"),this.codePopup.off("click","button#offIncludeWorkingTime"),this.codePopup.off("click","button#onUse"),this.codePopup.off("click","button#offUse"),this.codePopup.on("click","button#onIncludeWorkingTime",e.proxy(this._setOnIncludeWorkingTime,this)),this.codePopup.on("click","button#offIncludeWorkingTime",e.proxy(this._setOffIncludeWorkingTime,this)),this.codePopup.on("click","button#onUse",e.proxy(this._setOnUse,this)),this.codePopup.on("click","button#offUse",e.proxy(this._setOffUse,this))},_setOnIncludeWorkingTime:function(t){var n=this;e("button#onIncludeWorkingTime").addClass("on"),e("button#offIncludeWorkingTime").removeClass("on")},_setOffIncludeWorkingTime:function(t){var n=this;e("button#onIncludeWorkingTime").removeClass("on"),e("button#offIncludeWorkingTime").addClass("on")},_setOnUse:function(t){var n=this;e("button#onUse").addClass("on"),e("button#offUse").removeClass("on")},_setOffUse:function(t){var n=this;e("button#onUse").removeClass("on"),e("button#offUse").addClass("on")},_timelineTypeConverter:function(e){return e=="date"?f.label_date:f.label_time},_timelineUseYNConverter:function(e){return e==1?f.label_use:f.label_unuse},_timelineWorkingTimeConverter:function(e){return e==1?f.label_include_y:f.label_include_n}});return l});