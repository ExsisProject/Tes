define(["jquery","backbone","app","hgn!admin/templates/dept_config","i18n!admin/nls/admin","i18n!nls/commons","GO.util","jquery.go-grid"],function(e,t,n,r,i,s){var o={count:i["\uac1c"],total_dept:i["\ucd1d \ubd80\uc11c \uc218"],dept_unit:i["\ub2e8\uc704 \ubd80\uc11c"],dept_name:i["\ubd80\uc11c\uba85"],dept_manager:i["\ubd80\uc11c\uc7a5"],dept_manager_name:i["\ubd80\uc11c\uc7a5 \uc774\ub984"],dept_member:i["\ubd80\uc11c\uc6d0(\uba85)"],dept_sub:i["\ud558\uc704\ubd80\uc11c(\uac1c)"],dept_createat:i["\uc0dd\uc131\uc77c"],dept_usage:i["\uc0ac\uc6a9\ub7c9(MB)"],move_to_org:i["\uc870\uc9c1\ub3c4\uc5d0\uc11c \ubd80\uc11c \ucd94\uac00\ud558\uae30"],list_to_csv:i["\ubaa9\ub85d \ub2e4\uc6b4\ub85c\ub4dc"],search:s["\uac80\uc0c9"],not_exist_depts:i["\ubd80\uc11c\uc5c6\uc74c"]},u=t.View.extend({initialize:function(e){this.options=e||{},this.deptId=this.options.deptId},events:{"click span#btn_down":"downloadDeptList","click #deptConfigSearch span.btn_search":"search","keydown #deptConfigSearch input[type=text]":"searchKeyboardEvent"},render:function(){return this.listEl=null,this.searchParams=this.getSearchParams(),this.$el.html(r({org_href:GO.contextRoot+"admin/dept/org",lang:o})),this.searchParams.keyword&&this.$el.find("#deptConfigSearch input[type=text]").val(this.searchParams.keyword),this.deptId?(e("span#btn_down").attr("data-id",this.deptId),this.renderDeptList("ad/api/dept/children/"+this.deptId)):this.renderDeptList("ad/api/departments"),this},searchParamKeys:["page","offset","searchtype","keyword","sortkey","sortdir"],renderDeptList:function(t){var r=this;this.listEl=e.goGrid({el:this.$("#deptList"),method:"GET",url:GO.contextRoot+t,emptyMessage:"<p class='data_null'> <span class='ic_data_type ic_no_data'></span><span class='txt'>"+o.not_exist_depts+"</span>"+"</p>",params:this.searchParams,defaultSorting:[[0,"asc"]],sDomType:"admin",displayLength:n.session("adminPageBase"),columns:[{mData:"name",bSortable:!0,fnRender:function(e){return'<span data-id="'+e.aData.id+'">'+e.aData.name+"</span>"}},{mData:"masterName",sWidth:"150px",bSortable:!0,fnRender:function(e){return'<span data-id="'+e.aData.masterUserId+'">'+e.aData.masterName+" "+e.aData.masterPositionName+"</span>"}},{mData:"memberCount",sClass:"align_r",sWidth:"120px",bSortable:!0,sWidth:"100px"},{mData:"childrenCount",sClass:"align_r",sWidth:"120px",bSortable:!0,fnRender:function(e){return'<span data-id="'+e.aData.id+'">'+e.aData.childrenCount+"</span>"}},{mData:"createdAt",sClass:"align_c",sWidth:"100px",fnRender:function(e){return GO.util.shortDate(e.aData.createdAt)}}],fnDrawCallback:function(t,i,s){r.$el.find(".toolbar_top .custom_header").append(r.$el.find("#controlButtons").show()),r.$el.find("#deptTotalCount").html(i._iRecordsTotal),r.$el.find("tr>td:nth-child(1)").css("cursor","pointer").click(function(t){n.router.navigate("dept/"+e(t.currentTarget).find("span").attr("data-id"),{trigger:!0})}),r.$el.find("tr>td:nth-child(2)").css("cursor","pointer").click(function(t){e(t.currentTarget).find("span").attr("data-id")!==""&&n.router.navigate("account/"+e(t.currentTarget).find("span").attr("data-id"),{trigger:!0})}),r.$el.find("tr>td:nth-child(4)").css("cursor","pointer").click(function(t){n.router.navigate("dept/children/"+e(t.currentTarget).find("span").attr("data-id"),{trigger:!0})})}})},_addSearchParam:function(t,r){var i=n.router.getUrl(),s=this.getSearchParams(),t=t;e.each(this.searchParamKeys,function(e,n){t.hasOwnProperty(n)&&(s[n]=t[n])}),n.router.navigate(i.split("?")[0]+"?"+this._serializeObj(s))},_serializeObj:function(e){var t=[];for(var n in e)t.push(encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t.join("&")},getSearchParams:function(){var e=n.router.getSearch(),t=e||{};return t.page=parseInt(e.page,10)||0,t.offset=e.offset||"",t},searchKeyboardEvent:function(e){e.keyCode==13&&this.search()},search:function(){var e=this.$el.find('.table_search input[type="text"]'),t=e.val();this.listEl.tables.search(this.$el.find(".table_search select").val(),t,e)},downloadDeptList:function(t){var n=e(t.currentTarget).attr("data-id"),r=null;n==null?r="ad/api/departments/download?":r="ad/api/dept/children/download/"+n+"?";var i=this.listEl.listParams,s={property:i.property,direction:i.direction,searchtype:i.searchtype,keyword:i.keyword};GO.util.downloadCsvFile(r+GO.util.jsonToUrlParam(s))}});return u});