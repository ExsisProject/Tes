(function(){define(["backbone","app","hgn!admin/templates/attnd_ip_manage","i18n!admin/nls/admin","i18n!nls/commons","jquery.go-grid","jquery.go-sdk"],function(e,t,n,r,i){function u(e,t,n){}var s={label_title:r["\uc811\uc18d \ud5c8\uc6a9 IP"],label_guide:r["\uc811\uc18d \ud5c8\uc6a9 IP \uc124\uba85"],label_ip_name:r["\uc811\uc18d IP \uc774\ub984"],label_ip:r.IP,label_use:i["\uc0ac\uc6a9"],label_not_use:i["\uc0ac\uc6a9\ud558\uc9c0 \uc54a\uc74c"],label_ok:i["\uc800\uc7a5"],label_cancel:i["\ucde8\uc18c"],label_add:i["\ucd94\uac00"],label_delete:i["\uc0ad\uc81c"]},o=e.View.extend({events:{"click #ok":"saveIpConfig","click #cancel":"reset","click #add_ip":"addAccessIp","click #delete_ip":"deleteAccessIp","click input:checkbox":"toggleCheckbox"},initialize:function(){this.model=new e.Model,this.model.url=t.contextRoot+"ad/api/ehr/attnd/ip/manage/config"},render:function(){return this.model.fetch({async:!1}),this.$el.html(n({lang:s,model:this.model.toJSON()})),this.renderIpTable(),this},renderIpTable:function(){var e=this;this.noticeGrid=$.goGrid({el:"#accessIpTable",method:"GET",destroy:!0,url:t.contextRoot+"ad/api/ehr/attnd/ip/list",params:this.searchParams,emptyMessage:"<p class='data_null'> <span class='ic_data_type ic_no_data'></span><span class='txt'>"+r["\ub4f1\ub85d\ub41c \uc811\uc18d \ud5c8\uc6a9 IP\uac00 \uc5c6\uc2b5\ub2c8\ub2e4."]+"</span>"+"</p>",defaultSorting:[[0,"desc"]],sDomType:"admin",checkbox:!0,checkboxData:"id",displayLength:t.session("adminPageBase"),columns:[{mData:"ipName",sClass:"ip_name",sWidth:"200px",bSortable:!1,fnRender:function(e){return"<span data-id='"+e.aData.id+"'>"+e.aData.ipName+"</span>"}},{mData:"ipRange",sClass:"",bSortable:!1,fnRender:function(e){return"<span>"+e.aData.ipRange+"</span>"}}],fnDrawCallback:function(n,r,i){e.$el.find(".toolbar_top .custom_header").append(e.$el.find("#controlButtons").show()),e.$el.find("tr>td.ip_name").css("cursor","pointer").click(function(e){var n="ehr/ip/modify/"+$(e.currentTarget).find("span").attr("data-id");t.router.navigate(n,{trigger:!0})})}}).tables},addAccessIp:function(){t.router.navigate("ehr/ip/create",!0)},deleteAccessIp:function(){var e=this,n=new Array,s=$("form[name=attndIpConfig]"),o=s.find('#accessIpTable tbody input[type="checkbox"]:checked');if(o.size()==0){$.goMessage(r["\uc0ad\uc81c\ud560 \uc811\uadfc \ud5c8\uc6a9 IP \uadf8\ub8f9\uc744 \uc120\ud0dd\ud558\uc138\uc694."]);return}o.attr("value",function(e,t){t!=null&&n.push(t)}),$.goCaution(r["\uc811\uadfc \ud5c8\uc6a9 IP \uc0ad\uc81c"],"",function(){$.go(t.contextRoot+"ad/api/ehr/attnd/ip/delete",JSON.stringify({ids:n}),{qryType:"DELETE",contentType:"application/json",responseFn:function(t){t.code==200&&($.goMessage(i["\uc0ad\uc81c\ub418\uc5c8\uc2b5\ub2c8\ub2e4."]),e.render())},error:function(e){var t=JSON.parse(e.responseText);t!=null?$.goAlert(t.message):$.goMessage(i["\uc2e4\ud328\ud588\uc2b5\ub2c8\ub2e4."])}})})},toggleCheckbox:function(e){$(e.currentTarget).attr("id")=="checkedAll"&&$(e.currentTarget).is(":checked")?this.$el.find("input:checkbox").attr("checked",!0):$(e.currentTarget).attr("id")=="checkedAll"&&!$(e.currentTarget).is(":checked")?this.$el.find("input:checkbox").attr("checked",!1):$(e.currentTarget).is(":checked")?$(e.currentTarget).attr("checked",!0):(this.$el.find("#checkedAll").attr("checked",!1),$(e.currentTarget).attr("checked",!1))},saveIpConfig:function(e){this.model.set("useAccessAllowIp",$("#onUseAccessAllowIp").is(":checked"),{silent:!0}),t.EventEmitter.trigger("common","layout:setOverlay",""),this.model.save({},{type:"PUT",success:function(e,n){n.code=="200"&&($.goMessage(i["\uc800\uc7a5\ub418\uc5c8\uc2b5\ub2c8\ub2e4."]),t.EventEmitter.trigger("common","layout:clearOverlay",!0))},error:function(e,n){var r=JSON.parse(n.responseText);$.goMessage(r.message),arg.close(),t.EventEmitter.trigger("common","layout:clearOverlay",!0)}})},reset:function(){this.render()}});return o})})();