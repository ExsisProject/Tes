(function(){define(["backbone","app","hgn!admin/templates/attnd_ip_create","hgn!admin/templates/attnd_ip_modify","admin/models/attnd_access_ip","i18n!admin/nls/admin","i18n!nls/commons","jquery.go-sdk"],function(e,t,n,r,i,s,o){function f(e,t,n){}var u={label_access_allow_ip_info:s["\uc811\uc18d \ud5c8\uc6a9 IP \uc815\ubcf4"],label_ip_name:s["\uc811\uc18d IP \uc774\ub984"],label_ip:s["\uc811\uc18d IP \ub300\uc5ed"],label_save:o["\uc800\uc7a5"],label_cancel:o["\ucde8\uc18c"],label_modify:o["\uc218\uc815"]},a=e.View.extend({events:{"click #btn_save":"saveIp","click #btn_cancel":"reset","keyup #ipName":"clearAlert"},initialize:function(e){this.options=e||{},this.ipId=this.options.ipId,this.model=i.create()},render:function(){if(this.ipId!=undefined){this.model=i.read(this.ipId);var e=this.model.toJSON(),t=e.ipRange.split("-");e.ip1=t[0].split(".")[0],e.ip2=t[0].split(".")[1],e.ip3=t[0].split(".")[2],e.ip4=t[0].split(".")[3],e.ip5=t[1],this.$el.html(r({lang:u,model:e}))}else this.$el.html(n({lang:u}));return this},saveIp:function(){var e=this,n="POST",r=!0,i=$("form[name=formIpCreate]");this.ipId&&(i=$("form[name=formIpModify]"),n="PUT");var u=$("#ipName").val();if(!$.goValidation.isCheckLength(1,255,u))r=!1,$("#ipNameAlert").html(t.i18n(s["0\uc790\uc774\uc0c1 0\uc774\ud558 \uc785\ub825\ud574\uc57c\ud569\ub2c8\ub2e4."],{arg1:"1",arg2:"255"})),$("#ipName").focus();else if(!$.goValidation.isNumber($("#ip1").val())||!$.goValidation.isNumber($("#ip2").val())||!$.goValidation.isNumber($("#ip3").val())||!$.goValidation.isNumber($("#ip4").val())||!$.goValidation.isNumber($("#ip5").val()))r=!1,$("#ipAlert").html(s["\uc22b\uc790\ub9cc \uc785\ub825\ud558\uc138\uc694."]);else if($("#ip1").val()<0||$("#ip1").val()>255||$("#ip2").val()<0||$("#ip2").val()>255||$("#ip3").val()<0||$("#ip3").val()>255||$("#ip4").val()<0||$("#ip4").val()>255||$("#ip5").val()<0||$("#ip5").val()>255)r=!1,$("#ipAlert").html("0~255 \uc0ac\uc774\uc758 \uac12\uc744 \uc785\ub825\ud574\uc8fc\uc138\uc694.");var a=$("#ip1").val()+"."+$("#ip2").val()+"."+$("#ip3").val()+"."+$("#ip4").val()+"-"+$("#ip5").val();r&&(r=this.validateIpRange(a));if(!r)return!1;e.model.set("ipName",$("#ipName").val(),{silent:!0}),e.model.set("ipRange",a,{silent:!0}),t.EventEmitter.trigger("common","layout:setOverlay",""),this.model.save({},{type:n,success:function(e,n){n.code=="200"&&($.goMessage(o["\uc800\uc7a5\ub418\uc5c8\uc2b5\ub2c8\ub2e4."]),t.EventEmitter.trigger("common","layout:clearOverlay",!0),t.router.navigate("ehr/workplace/manage",{trigger:!0}))},error:function(e,n){var r=JSON.parse(n.responseText);$.goMessage(r.message),t.EventEmitter.trigger("common","layout:clearOverlay",!0)}})},clearAlert:function(){$("#ipName").val().length&&$("#ipNameAlert").html("")},reset:function(){this.render()},validateIpRange:function(e){var n=!1;return $.go(t.contextRoot+"ad/api/ehr/attnd/ip/check?ip="+e+"&excludeip="+this.model.attributes.ipRange,"",{async:!1,qryType:"GET",contentType:"application/json",responseFn:function(e){n=!0},error:function(e){var t=JSON.parse(e.responseText);$.goMessage(s["\uc811\uc18d IP \ub300\uc5ed\uc774 \uc911\ubcf5\ub418\uc5c8\uc2b5\ub2c8\ub2e4."]),n=!1}}),n}});return a})})();