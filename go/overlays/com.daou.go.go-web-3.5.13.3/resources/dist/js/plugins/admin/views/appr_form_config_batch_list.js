define(["jquery","underscore","backbone","app","hogan","views/pagination","admin/views/approval/batch_list_layout","admin/views/approval/batch_list_item","collections/paginated_collection","admin/models/approval/batch_list_item","approval/collections/security_levels","when","i18n!approval/nls/approval","i18n!nls/commons","i18n!admin/nls/admin","jquery.ui","jquery.go-validation","jquery.go-preloader"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d){lang={head_title:h["\uacb0\uc7ac \uc591\uc2dd \ucd94\uac00"],caption:p["\ub4f1\ub85d\uc815\ubcf4"],title:p["\uc81c\ubaa9"],form_name:p["\uc81c\ubaa9"],edit_template:h["\uc591\uc2dd \ud3b8\uc9d1"],template_editor:h["\uc591\uc2dd \ud3b8\uc9d1\uae30"],template_preview:p["\ubbf8\ub9ac\ubcf4\uae30"],load_another_template:h["\ub2e4\ub978 \uc591\uc2dd \ubd88\ub7ec\uc624\uae30"],load_template_title:h["\ub2e4\ub978 \uc591\uc2dd \uc870\ud68c"],state:d["\uc0ac\uc6a9\uc5ec\ubd80"],hidden:d["\uc228\uae40"],normal:d["\uc815\uc0c1"],empty_msg:h["\ub4f1\ub85d\ub41c \uc591\uc2dd\uc774 \uc5c6\uc2b5\ub2c8\ub2e4."],creation_success_msg:h["\uc800\uc7a5\ub418\uc5c8\uc2b5\ub2c8\ub2e4. \uc591\uc2dd \ubaa9\ub85d\uc73c\ub85c \uc774\ub3d9\ud569\ub2c8\ub2e4."],creation_fail_msg:p["\uc800\uc7a5\ud560 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4."],cancel_and_go_to_list_msg:h["\ucde8\uc18c\ud558\uc168\uc2b5\ub2c8\ub2e4. \uc774\uc804 \ud654\uba74\uc73c\ub85c \uc774\ub3d9\ud569\ub2c8\ub2e4."],msg_cannot_preview_html:h["\ud604\uc7ac \uc77c\uc2dc\uc801\uc778 \ubb38\uc81c\ub85c \uc591\uc2dd\uc744 \ubbf8\ub9ac\ubcf4\uae30 \ud560 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4. \uc7a0\uc2dc \ud6c4 \ub2e4\uc2dc \uc2dc\ub3c4\ud574\uc8fc\uc138\uc694."],select:p["\uc120\ud0dd"],add:p["\ucd94\uac00"],"delete":p["\uc0ad\uc81c"],save:p["\uc800\uc7a5"],cancel:p["\ucde8\uc18c"],folder_name:p["\ud3f4\ub354\uba85"],description:h["\uc591\uc2dd \ub3c4\uc6c0\ub9d0"],reception:d["\ubb38\uc11c \uc218\uc2e0"],receiverEditable:d["\uc0ac\uc6a9\uc790\uac00 \uc218\uc2e0\ucc98 \uc218\uc815 \uac00\ub2a5"],reader:d["\ubb38\uc11c \uc5f4\ub78c\uc790"],reference:d["\ubb38\uc11c \ucc38\uc870\uc790"],referrerEditable:d["\uae30\uc548\uc790\uac00 \ucc38\uc870\uc790 \uc218\uc815 \uac00\ub2a5"],system_integration:d["\uc2dc\uc2a4\ud15c \uc5f0\ub3d9"]};var v=a.extend({model:f,url:function(){var e=r.contextRoot+"ad/api/approval/allapprform";return e}});return ApprFormConfigBatchListView=n.View.extend({popupEl:null,dataTable:null,selectCallback:null,popUpTableId:"template_table",securityLevels:null,initialize:function(e){e=t.extend({},e),this.selectCallback=e.selectCallback,this.collection=new v,this.collection.bind("reset",this.resetList,this),this.securityLevels=new l},fetchSecurity:function(){var e=this,t=c.defer();return c(this.securityLevels.fetch({success:function(){t.resolve()},error:function(){t.reject()}})).otherwise(function(t){console.log(t.stack)}),t.promise},render:function(){this._renderPopup(),this._renderPopupContent()},close:function(){isListViewOpen=!1,this.dataTable&&this.dataTable.tables.remove(),this.popupEl&&this.popupEl.close(),this.remove()},_renderPopup:function(){var t=[],n=this;this.popupEl=e.goPopup({header:d["\uc77c\uad04\uc124\uc815"],modal:!0,width:800,pclass:"layer_normal table_large_layer",contents:"",buttons:[{btext:p["\ud655\uc778"],autoclose:!1,btype:"confirm",callback:function(e){n.saveApprConfigBatchList()}},{btext:p["\ucde8\uc18c"],btype:"cancel"}]}),this.layoutView=new o,this.layoutView.render(),this.listenTo(this.layoutView,"getListBySearch",this.getListBySearch),this.popupEl.reoffset()},getListBySearch:function(e){this.collection.fetch({data:e})},saveApprConfigBatchList:function(){var t=this,n=e.goPreloader(),i=this.collection.clone(),s=[];i.each(function(e){e.hasChanged()||s.push(e)}),i.remove(s),i.fetch({type:"PUT",dataType:"json",contentType:"application/json",data:JSON.stringify(i),beforeSend:function(){n.render()},statusCode:{403:function(){r.util.error("403")},404:function(){r.util.error("404",{msgCode:"400-common"})},500:function(){r.util.error("500")}}}).done(function(){e.goMessage(p["\uc800\uc7a5\ub418\uc5c8\uc2b5\ub2c8\ub2e4."]),n.release(),t.popupEl.close()}).fail(function(){e.goError(p["\uc800\uc7a5\uc5d0 \uc2e4\ud328 \ud558\uc600\uc2b5\ub2c8\ub2e4."]),n.release()})},_renderPopupContent:function(){var t=e.goPreloader();this.collection.fetch({beforeSend:function(){t.render()},statusCode:{403:function(){r.util.error("403")},404:function(){r.util.error("404",{msgCode:"400-common"})},500:function(){r.util.error("500")}}}).done(function(){t.release()})},resetList:function(e){this.popupEl.find("#template_table > tbody").empty(),e.each(function(e){var t=new u({model:e,securityLevels:this.securityLevels.clone()});this.popupEl.find("#template_table > tbody").append(t.render().el)},this),e.length==0&&this.popupEl.find("#template_table > tbody").html(this._renderSearchEmptyTmpl())},_closeTemplate:function(){isListViewOpen=!1,this.dataTable&&this.dataTable.tables.remove(),this.remove()},_renderSearchEmptyTmpl:function(){var e=[];e.push("    <tr>"),e.push('        <td colspan="19">'),e.push('            <p class="data_null">'),e.push('                <span class="ic_data_type ic_no_data"></span>'),e.push('                <span class="txt">'+h["\ub4f1\ub85d\ub41c \uacb0\uc7ac \uc591\uc2dd\uc774 \uc5c6\uc2b5\ub2c8\ub2e4."]+"</span>"),e.push("            </p>"),e.push("        </td>"),e.push("    </tr>");var t=i.compile(e.join("\n"));return t.render()}}),ApprFormConfigBatchListView});