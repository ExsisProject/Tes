define(["app","i18n!nls/commons","i18n!admin/nls/admin","hgn!admin/templates/mobile_auth_access_config","hgn!admin/templates/list_empty","models/mobile_config","jquery.go-validation","jquery.go-popup","jquery.go-sdk","jquery.go-grid","GO.util"],function(e,t,n,r,i,s){var o={label_ok:t["\uc800\uc7a5"],label_cancel:t["\ucde8\uc18c"],label_not_use:n["\uc0ac\uc6a9\uc548\ud568"],label_use:t["\uc0ac\uc6a9"],label_mobile_access:n["\ubaa8\ubc14\uc77c \uc811\uadfc \uc81c\ud55c"],label_empty:n["\ub4f1\ub85d\ub41c \ubaa8\ubc14\uc77c \uae30\uae30 \uc815\ubcf4\uac00 \uc5c6\uc2b5\ub2c8\ub2e4."],label_search:t["\uac80\uc0c9"],label_delete:t["\uc0ad\uc81c"],label_add:t["\ucd94\uac00"],label_email:t["\uc774\uba54\uc77c"],label_name:t["\uc774\ub984"],label_deviceid:n.DeviceId,label_all:n["\uc811\uadfc\ud5c8\uc6a9\ubaa8\ubc14\uc77c\uae30\uae30\uad00\ub9ac"],label_ostype:n["OS\ud0c0\uc785"],label_deviceModel:n["\ubaa8\ub378\uba85"],label_status:n["\uc0c1\ud0dc"],label_approval:n["\uc694\uccad\uc2b9\uc778"],label_reject:n["\uc694\uccad\ubc18\ub824"],uuid_desc:n["uuid\uc124\uba85"],access_enabled_users:n["\uc811\uadfc\ud5c8\uc6a9\ubaa8\ubc14\uc77c\uae30\uae30"],access_request_users:n["\uc811\uadfc\uc694\uccad\ubaa8\ubc14\uc77c\uae30\uae30"],request:n["\uc2b9\uc778\uc694\uccad"],approval:n["\uc2b9\uc778"],reject:n["\ubc18\ub824"]},u=Backbone.View.extend({initialize:function(){this.model=new s({adminContext:!0}),this.listEl="#mobileAccessList"},events:{"click span#btn_ok":"_mobileConfigSave","click span#btn_cancel":"_mobileConfigCancel","click span#btn_delete":"_deleteDeviceId","click span#btn_approval":"_approvalDeviceId","click span#btn_reject":"_rejectDeviceId","click span.btn_search":"_search","click li#access_enabled_users":"_onAccessEnabledUser","click li#access_request_users":"_onAccessRequestUser","click div#mobileAccessList_wrapper input:checkbox":"_toggleCheckbox","click input:radio[name='mobileAccessControl']":"_toggleMobileAccessControl","keydown span.search_wrap input":"_searchKeyboardEvent"},render:function(){this.model.fetch().done($.proxy(function(){this.$el.html(r({lang:o,model:this.model.toJSON()})),this._renderMobileAccessList()},this))},_renderMobileAccessList:function(){$("input:radio[name='mobileAccessControl']").val()=="false"&&$("#mobile_access_management_wrap").hide();var t=this.$("#access_enabled_users").hasClass("active")?"enabled":"disabled",n=this;this.dataTable=$.goGrid({el:this.listEl,method:"GET",bDestroy:!0,type:"admin",url:GO.contextRoot+"ad/api/mobile/access/"+t,emptyMessage:i({label_desc:o.label_empty}),params:{page:this.page},defaultSorting:[[1,"acs"]],pageUse:!0,checkbox:!0,sDomType:"admin",checkboxData:"id",displayLength:e.session("adminPageBase"),columns:[{mData:"name",bSortable:!0,sWidth:"180px"},{mData:"email",bSortable:!0,sWidth:"200px"},{mData:"osType",bSortable:!0,sWidth:"100px"},{mData:"deviceModel",bSortable:!0,sWidth:"120px"},{mData:"deviceId",bSortable:!1},{mData:"status",bSortable:!0,sWidth:"120px",fnRender:function(e){if(e.aData.status=="approval")return o.approval;if(e.aData.status=="reject")return o.reject;if(e.aData.status=="request")return o.request}}],fnDrawCallback:function(e){var r=[];r.push('<span class="btn_tool txt_caution" id="btn_delete">'),r.push(o.label_delete),r.push("</span>"),t=="disabled"&&(r.push('<span class="btn_tool" id="btn_approval">'),r.push(o.label_approval),r.push("</span>"),r.push('<span class="btn_tool" id="btn_reject">'),r.push(o.label_reject),r.push("</span>")),n.$el.find(".toolbar_top .custom_header").html(r.join("\n")),n.$el.find("#checkedAll").attr("checked",!1)}})},_toggleCheckbox:function(e){e.stopPropagation(),$(e.currentTarget).is(":checked")?$(e.currentTarget).attr("checked",!0):(this.$el.find("#checkedAll").attr("checked",!1),$(e.currentTarget).attr("checked",!1))},_toggleMobileAccessControl:function(e){$(e.currentTarget).val()=="true"?$("#mobile_access_management_wrap").show():$("#mobile_access_management_wrap").hide()},_addDeviceId:function(t){t.stopPropagation(),e.router.navigate("mobile/access/create",!0)},_deleteDeviceId:function(e){e.stopPropagation();var r=this,i=$("#mobileAccessList input[type=checkbox]:checked");if(i.length==0)return $.goAlert("",n["\uc0ad\uc81c\ud560 \ud56d\ubaa9\uc744 \uc120\ud0dd\ud558\uc138\uc694."]);$.goCaution("",n["\uc0ad\uc81c\uacbd\uace0"],function(){var e=GO.contextRoot+"ad/api/mobile/access",n={ids:[]};for(var s=0;s<i.length;s++){if(i[s].value=="on")continue;n.ids.push(parseInt(i[s].value))}if(n.ids.length==0)return;$.go(e,JSON.stringify(n),{qryType:"DELETE",contentType:"application/json",responseFn:function(e){$.goMessage(t["\uc0ad\uc81c\ub418\uc5c8\uc2b5\ub2c8\ub2e4."]),r._renderMobileAccessList()},error:function(e){$.goMessage(t["\uc2e4\ud328\ud588\uc2b5\ub2c8\ub2e4."])}})})},_approvalDeviceId:function(e){e.stopPropagation(),this._requestDeviceStatus("approval")},_rejectDeviceId:function(e){e.stopPropagation(),this._requestDeviceStatus("reject")},_requestDeviceStatus:function(e){var r=this,i=$("#mobileAccessList input[type=checkbox]:checked");if(i.length==0)return $.goAlert("",t["\uc120\ud0dd\ub41c \ud56d\ubaa9\uc774 \uc5c6\uc2b5\ub2c8\ub2e4."]);$.goConfirm("",n["\uc2b9\uc778\uc694\uccad"],function(){var n=GO.contextRoot+"ad/api/mobile/access/"+e,s={ids:[]};for(var o=0;o<i.length;o++){if(i[o].value=="on")continue;s.ids.push(parseInt(i[o].value))}if(s.ids.length==0)return;$.go(n,JSON.stringify(s),{qryType:"PUT",contentType:"application/json",responseFn:function(e){$.goMessage(t["\uc218\uc815\ub418\uc5c8\uc2b5\ub2c8\ub2e4."]),r._renderMobileAccessList()},error:function(e){$.goMessage(t["\uc2e4\ud328\ud588\uc2b5\ub2c8\ub2e4."])}})})},_search:function(e){e.stopPropagation();var t=this.$el.find('.table_search input[type="text"]'),n=t.val();this.dataTable.tables.search(this.$el.find(".table_search select").val(),n,t)},_searchKeyboardEvent:function(e){e.keyCode==13&&this._search()},_onAccessEnabledUser:function(e){this.$("#access_enabled_users").addClass("active"),this.$("#access_request_users").removeClass("active"),this._renderMobileAccessList()},_onAccessRequestUser:function(e){this.$("#access_enabled_users").removeClass("active"),this.$("#access_request_users").addClass("active"),this._renderMobileAccessList()},_mobileConfigSave:function(e){e.stopPropagation();var n=this,r=this.$el.find("form[name=formMobileConfig]"),i=r.find('input[type="radio"]:checked'),s={mobileAccessControl:i.attr("value")};n.model.save(s,{success:function(e,r){r.code=="200"&&($.goMessage(t["\uc800\uc7a5\ub418\uc5c8\uc2b5\ub2c8\ub2e4."]),n.render())},error:function(e,n){var r=JSON.parse(n.responseText);r.message!=null?$.goMessage(r.message):$.goMessage(t["\uc2e4\ud328\ud588\uc2b5\ub2c8\ub2e4."])}})},_mobileConfigCancel:function(e){e.stopPropagation();var n=this;$.goCaution(t["\ucde8\uc18c"],t["\ubcc0\uacbd\ud55c \ub0b4\uc6a9\uc744 \ucde8\uc18c\ud569\ub2c8\ub2e4."],function(){n.render(),$.goMessage(t["\ucde8\uc18c\ub418\uc5c8\uc2b5\ub2c8\ub2e4."])},t["\ud655\uc778"])}},{attachTo:function(e){var t=new u;return e.empty().append(t.el),t.render(),t}});return u});