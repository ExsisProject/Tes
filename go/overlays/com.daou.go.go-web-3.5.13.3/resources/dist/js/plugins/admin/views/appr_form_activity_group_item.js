define("admin/views/appr_form_activity_group_item",function(require){var e=require("i18n!nls/commons"),t=require("i18n!admin/nls/admin"),n=require("i18n!approval/nls/approval"),r={order:e["\uc21c\uc11c"],name:e["\uc774\ub984"],count:e["\uac1c"],person:e["\uba85"],approval_type:n["\uacb0\uc7ac"],agreement_type:n["\ud569\uc758"],check_type:n["\ud655\uc778"],inspection_type:n["\uac10\uc0ac"],max_approver:n["\ucd5c\ub300 \uacb0\uc7ac\uc790"],appr_line_caption:n["\uacb0\uc7ac \ub77c\uc778"],predefined_approver:n["\uc9c0\uc815 \uacb0\uc7ac\uc790"],add_approval_user:n["\uacb0\uc7ac \ucd94\uac00"],add_agreement_user:n["\ud569\uc758 \ucd94\uac00"],add_check_user:n["\ud655\uc778 \ucd94\uac00"],add_inspection_user:"\uac10\uc0ac \ucd94\uac00",already_added:e["\uc774\ubbf8 \ucd94\uac00\ub418\uc5b4 \uc788\uc2b5\ub2c8\ub2e4."],is_over_max_approval_count:n["\uc9c0\uc815 \uacb0\uc7ac\uc790\uac00 \ucd5c\ub300 \uacb0\uc7ac\uc790 \uc778\uc6d0\uc218\ub97c \ucd08\uacfc\ud558\uc600\uc2b5\ub2c8\ub2e4."],is_over_approval_count_ten:n["\uc9c0\uc815 \uacb0\uc7ac\uc790\ub294 10\uac1c\ub97c \ucd08\uacfc \ud558\uc2e4 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4"],msg_not_belong_to_department_user:n["\ubd80\uc11c\uac00 \uc5c6\ub294 \uc0ac\uc6a9\uc790\ub294 \ucd94\uac00\ud560 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4."],appr_type:n["\uacb0\uc7ac \ud0c0\uc785"],"\ubcc0\uacbd":e["\ubcc0\uacbd"],"\uc790\ub3d9\uacb0\uc7ac\uc120":t["\uc790\ub3d9\uacb0\uc7ac\uc120"]},i=require("approval/models/activity"),s=require("hgn!admin/templates/appr_form_activity_group"),o=require("hgn!admin/templates/appr_form_activity");return Backbone.View.extend({tagName:"tr",_APPROVER_COUNTS:[1,2,3,4,5,6,7,8,9,10],events:{"focusout input.w_full":"setName","change select#selectApproverCount":"setMaxApproverCount","click input[name=typeOpApproval], input[name=typeOpAgreement], input[name=typeOpCheck], input[name=typeOpInspection]":"_toggleTypeOp"},initialize:function(e){this._setBindings(),this.model=e.model,this.companyIds=e.companyIds,this.allowAgreement=e.allowAgreement,this.agreementAllowType=e.agreementAllowType,this.allowCheck=e.allowCheck,this.allowInspection=e.allowInspection,this.apprlineruleModel=e.apprlineruleModel},_setBindings:function(){this.$el.off("click","#approval_user_add"),this.$el.off("click","#agreement_user_add"),this.$el.off("click","#check_user_add"),this.$el.off("click","#inspection_user_add"),this.$el.off("click",".btn_delete_activity"),this.$el.on("click","#approval_user_add",$.proxy(this.addApprovementUser,this)),this.$el.on("click","#agreement_user_add",$.proxy(this.addAgreementUser,this)),this.$el.on("click","#check_user_add",$.proxy(this.addCheckUser,this)),this.$el.on("click","#inspection_user_add",$.proxy(this.addInspectionUser,this)),this.$el.on("click",".btn_delete_activity",$.proxy(this.deleteActivity,this))},render:function(){var e=_.extend(this.model.toJSON(),{approverCounts:_.map(this._APPROVER_COUNTS,function(e){return{value:e,label:e+r.person,isSelected:e==this.model.get("maxApprovalCount")}},this),lang:r,allowAgreement:this.allowAgreement,allowCheck:this.allowCheck,allowInspection:this.allowInspection,useApprLineRule:$("#useApprLineRule").is(":checked")});e.seq++;var t=this.apprlineruleModel&&this.apprlineruleModel.get("id")?this.apprlineruleModel.get("id"):"",n=this.apprlineruleModel&&this.apprlineruleModel.get("name")?this.apprlineruleModel.get("name"):"";return e["seq"]==1&&(e=_.extend(e,{setLineRule:!0,selectedLineRuleId:t,selectedLineRuleName:n}),$("#useApprLineRule").is(":checked")&&_.extend(e,{hideUserAdd:!0})),this.$el.html(s({data:e,lang:r})),this._renderActivities(),this.$el},setName:function(e){var t=$(e.currentTarget);this.model.set("name",t.val())},setMaxApproverCount:function(e){var t=$(e.target);this.model.set("maxApprovalCount",t.val()*1)},addApprovementUser:function(){this.addActivity("APPROVAL","USER",r.add_approval_user)},addAgreementUser:function(){this.addActivity("AGREEMENT","USER",r.add_agreement_user)},addCheckUser:function(){this.addActivity("CHECK","USER",r.add_check_user)},addInspectionUser:function(){this.addActivity("INSPECTION","USER",r.add_inspection_user)},addActivity:function(e,t,n){var s=function(t){var n;t.type=="org"?n={type:e,userId:null,userName:null,position:null,deptId:t.id,deptName:t.name,displayName:t.name}:n={type:e,userId:t.id,userName:t.name,position:t.position,deptId:t.deptId,deptName:t.deptName,displayName:t.displayName};if(this.model.isExistActivity(n)){$.goAlert(r.already_added);return}if(this.model.getActivityCollection().length+1>this.model.getMaxApprovalCount()){$.goAlert(r.is_over_max_approval_count);return}if(this.model.getActivityCollection().length+1>10){$.goAlert(r.is_over_approval_count_ten);return}if(!i.validate(n))return $.goMessage(r.msg_not_belong_to_department_user),!1;this.model.addActivity(n),this._renderActivities()},o="node";e=="AGREEMENT"?this.agreementAllowType=="DEPARTMENT"?o="department":this.agreementAllowType=="USER"&&(o="list"):o=_.contains(["APPROVAL","CHECK","INSPECTION"],e)?"list":"node";var u={header:n,callback:$.proxy(s,this),contextRoot:GO.contextRoot,type:o,isAdmin:!0};_.isArray(this.companyIds)&&(u.companyIds=this.companyIds),$.goOrgSlide(u)},deleteActivity:function(e){var t=$(e.target).parent().parent(),n=t.attr("data-userId"),r=t.attr("data-deptId");this.model.removeActivityByUserIdAndDeptId(n,r),this._renderActivities()},_renderActivities:function(){var e=this,t=[],n=[{type:"APPROVAL",model:_.filter(this.model.get("activities"),function(e){return e.type=="APPROVAL"})},{type:"AGREEMENT",model:_.filter(this.model.get("activities"),function(e){return e.type=="AGREEMENT"})},{type:"CHECK",model:_.filter(this.model.get("activities"),function(e){return e.type=="CHECK"})},{type:"INSPECTION",model:_.filter(this.model.get("activities"),function(e){return e.type=="INSPECTION"})}];$("li:not(#add_btn_container)",this.$el.find("ul.name_tag")).remove(),_.each(n,function(n){_.each(n.model,function(n){var i=e._getActivityTypeName(n.type);t.push(o({userId:n.userId,deptId:n.deptId,name:n.displayName+"("+i+")",lang:r}))}),e.$el.find("ul."+n.type+"_nameTag").prepend(t.join("\n")),t=[]})},_getActivityTypeName:function(e){switch(e){case"APPROVAL":return n["\uacb0\uc7ac"];case"AGREEMENT":return n["\ud569\uc758"];case"INSPECTION":return n["\uac10\uc0ac"];default:return n["\ud655\uc778"]}},_toggleTypeOp:function(e){var t=this,r={};$(e.currentTarget).attr("name")=="typeOpApproval"?r=_.extend(r,{apprAppointUserAdder:"approval_user_add",appointListTypeText:"("+n["\uacb0\uc7ac"]+")",checkModelName:"useApproval"}):$(e.currentTarget).attr("name")=="typeOpAgreement"?r=_.extend(r,{apprAppointUserAdder:"agreement_user_add",appointListTypeText:"("+n["\ud569\uc758"]+")",checkModelName:"useAgreement"}):$(e.currentTarget).attr("name")=="typeOpCheck"?r=_.extend(r,{apprAppointUserAdder:"check_user_add",appointListTypeText:"("+n["\ud655\uc778"]+")",checkModelName:"useCheck"}):$(e.currentTarget).attr("name")=="typeOpInspection"&&(r=_.extend(r,{apprAppointUserAdder:"inspection_user_add",appointListTypeText:"("+n["\uac10\uc0ac"]+")",checkModelName:"useInspection"}));if($(e.currentTarget).attr("checked"))this.$("#"+r.apprAppointUserAdder).css("display","inline-block"),this.model.set(r.checkModelName,!0);else{this.$("#"+r.apprAppointUserAdder).css("display","none"),this.model.set(r.checkModelName,!1);var i=this.$(".name_tag").find('li:not("#add_btn_container")');_.each(i,function(e){$(e).find(".name").text().indexOf(r.appointListTypeText)!=-1&&t.model.removeActivityByUserIdAndDeptId($(e).attr("data-userid"),$(e).attr("data-deptid"))}),t._renderActivities()}}})});