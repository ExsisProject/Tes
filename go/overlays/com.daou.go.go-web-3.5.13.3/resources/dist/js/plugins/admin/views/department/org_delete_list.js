define(["jquery","backbone","app","hgn!admin/templates/department/dept_delete_list","hgn!admin/templates/org_delete_list","hgn!admin/templates/account_delete_list","hgn!admin/templates/list_empty","i18n!admin/nls/admin","i18n!nls/commons","jquery.go-grid","GO.util"],function(e,t,n,r,i,s,o,u,a){var f={search:a["\uac80\uc0c9"],count:u["\uac1c"],total_dept:u["\ucd1d \ubd80\uc11c \uc218"],total_attach:u["\ucd1d \uc0ac\uc6a9\ub7c9"],dept_unit:u["\ub2e8\uc704 \ubd80\uc11c"],dept_name:u["\ubd80\uc11c\uba85"],dept_manager:u["\ubd80\uc11c\uc7a5"],dept_manager_name:u["\ubd80\uc11c\uc7a5 \uc774\ub984"],dept_createat:u["\uc0dd\uc131\uc77c"],dept_deletedat:u["\uc0ad\uc81c\uc77c"],dept_deleted_admin:u["\uc0ad\uc81c \uad00\ub9ac\uc790"],list_to_csv:u["\ubaa9\ub85d \ub2e4\uc6b4\ub85c\ub4dc"],delete_list_null:u["\uc0ad\uc81c\ub41c \ubd80\uc11c\uac00 \uc5c6\uc2b5\ub2c8\ub2e4."],attach_size:u["\uc0ac\uc6a9\ub7c9(MB)"],remove_attach:u["\ucca8\ubd80\ud30c\uc77c \uc0ad\uc81c"],no_select_dept:u["\ubd80\uc11c\ub97c \uc120\ud0dd\ud574 \uc8fc\uc2ed\uc2dc\uc624."],remove_attach_success:u["\ucca8\ubd80\ud30c\uc77c\uc774 \uc0ad\uc81c\ub418\uc5c8\uc2b5\ub2c8\ub2e4."],remove_attach_confirm:u["\ubd80\uc11c \ucca8\ubd80\ud30c\uc77c \uc0ad\uc81c \uc54c\ub9bc"],complete_deletion:u["\uc644\uc804 \uc0ad\uc81c"],reset_dept:u["\ubcf5\uad6c"],delete_dept_confirm:u["\uc120\ud0dd\ud55c \ubd80\uc11c\ub97c \uc644\uc804 \uc0ad\uc81c\ud558\uc2dc\uaca0\uc2b5\ub2c8\uae4c"],delete_dept_comfirm_desc:u["\uc0ad\uc81c\ud55c \ubd80\uc11c \uc0ad\uc81c \uacbd\uace0 \uba54\uc2dc\uc9c0"],delete_dept_success:a["\uc131\uacf5\ud588\uc2b5\ub2c8\ub2e4."],label_download:u["\ubaa9\ub85d \ub2e4\uc6b4\ub85c\ub4dc"],label_id:u["\ubc88\ud638"],label_name:a["\uc774\ub984"],label_position:u["\uc9c1\uc704"],label_email:a["\uc774\uba54\uc77c"],label_deleteDate:u["\uc0ad\uc81c\uc77c"],label_delete_admin:u["\uc0ad\uc81c \uad00\ub9ac\uc790"],label_search:a["\uac80\uc0c9"]},l=t.View.extend({events:{"click span#btn_down":"downAccountDeleteList","keydown span.search_wrap input":"searchKeyboardEvent","click span.btn_search":"search","click span#btn_down_delete":"downDeptDeleteList","click span#btn_data_remove":"removeDeptAttachData","click span#btn_delete_dept":"deleteDeletedDept","click span#btn_reset_dept":"resetDept","click ul.tab_menu li":"changeTab"},initialize:function(){var e=t.Model.extend({url:GO.contextRoot+"ad/api/department/delete"});this.deleteDeptAttach=new e},render:function(){return this.listEl=null,this.$el.html(i({lang:{deleted_dept:u["\uc0ad\uc81c \ubd80\uc11c"],deleted_member:u["\uc0ad\uc81c \uba64\ubc84"]}})),this.renderDeptTmpl(),this},changeTab:function(t){var n=e(t.currentTarget),r=n.find("span").data("type");n.parents("ul.tab_menu").find("li").removeClass("active"),n.addClass("active"),r==="dept"?this.renderDeptTmpl():this.renderUserTpl()},renderDeptTmpl:function(){this.$el.find("#tab_content").html(r({org_href:GO.contextRoot+"admin/dept/org",lang:f})),this.deleteDeptAttach.fetch({async:!0,success:e.proxy(function(){this._setTotalAttachSize()},this)}),this.renderDeptDeleteList()},renderDeptDeleteList:function(){var t=this;this.listEl=e.goGrid({el:this.$("#deleteDeptList"),method:"GET",url:GO.contextRoot+"ad/api/deletedepts",emptyMessage:'<p class="data_null"><span class="ic_data_type ic_no_data"></span><span class="txt">'+f.delete_list_null+"</span></p>",defaultSorting:[[4,"desc"]],sDomType:"admin",checkbox:!0,checkboxData:"deptId",displayLength:n.session("adminPageBase"),columns:[{mData:"name",bSortable:!0,fnRender:function(e){return'<span data-id="'+e.aData.deptId+'">'+e.aData.name+"</span>"}},{mData:"attachSize",sClass:"align_c",sWidth:"120px",fnRender:function(e){var t=e.aData.attachSize;return GO.util.byteToMega(t)},bSortable:!1},{mData:"createdAt",sClass:"align_c",bSortable:!0,sWidth:"120px",fnRender:function(e){return e.aData.createdAt==null||e.aData.createdAt==""?"-":GO.util.shortDate(e.aData.createdAt)}},{mData:"deletedAt",sClass:"align_c",bSortable:!0,sWidth:"120px",fnRender:function(e){return e.aData.deletedAt==null||e.aData.deletedAt==""?"-":GO.util.shortDate(e.aData.deletedAt)}},{mData:function(e){if(!e)return null;var t=e.deleteAdminName||"",n=t+" "+e.deleteAdminPosition;return n==" "?"-":n},bSortable:!1,sWidth:"130px",fnRender:function(e){}}],fnDrawCallback:function(r,i){t.$el.find(".header_tb").remove(),t.$el.find("#deptTotalCount").html(i._iRecordsTotal),t.$el.find("tr>td:nth-child(2)").css("cursor","pointer").click(function(t){var r=e(t.currentTarget).find("span"),i=r.attr("data-id");n.router.navigate("dept/delete/"+i,{trigger:!0})})}})},downDeptDeleteList:function(){var e="ad/api/deletedepts/download?",t=this.listEl.listParams,n={property:t.property,direction:t.direction,searchtype:t.searchtype,keyword:t.keyword};GO.util.downloadCsvFile(e+GO.util.jsonToUrlParam(n))},removeDeptAttachData:function(){var t=GO.contextRoot+"ad/api/department/delete/attach",n=this.listEl.tables.getCheckedIds(),r=this;if(n.length==0){e.goMessage(f.no_select_dept);return}e.goConfirm(f.remove_attach,f.remove_attach_confirm,function(){e.ajax({type:"DELETE",async:!0,dataType:"json",contentType:"application/json",data:JSON.stringify({ids:r.listEl.tables.getCheckedIds()}),url:t}).done(function(t){e.goMessage(f.remove_attach_success),r.listEl.tables.reload(),r.$el.find("#checkedAll").attr("checked",null)})})},deleteDeletedDept:function(){var t=GO.contextRoot+"ad/api/department/complate/delete",n=this.listEl.tables.getCheckedIds(),r=this;if(n.length==0){e.goMessage(f.no_select_dept);return}e.goConfirm(f.delete_dept_confirm,f.delete_dept_comfirm_desc,function(){e.ajax({type:"DELETE",async:!0,dataType:"json",contentType:"application/json",data:JSON.stringify({ids:r.listEl.tables.getCheckedIds()}),url:t}).done(function(){e.goMessage(f.delete_dept_success),r.listEl.tables.reload(),r.$el.find("#checkedAll").attr("checked",null)})})},resetDept:function(){var t=GO.contextRoot+"ad/api/department/reset",n=this.listEl.tables.getCheckedIds(),r=this;if(n.length==0){e.goMessage(f.no_select_dept);return}e.goPopup({title:u["\uc0ad\uc81c \ubd80\uc11c \ubcf5\uad6c"],message:GO.i18n(u["\uc0ad\uc81c \ubd80\uc11c \ubcf5\uad6c \uc124\uba85"],{term:GO.config("orgSyncWaitMin")}),buttons:[{btype:"confirm",btext:a["\ud655\uc778"],callback:function(){e.ajax({type:"put",async:!0,dataType:"json",contentType:"application/json",data:JSON.stringify({ids:r.listEl.tables.getCheckedIds()}),url:t}).done(function(){e.goMessage(f.delete_dept_success),r.listEl.tables.reload(),r.$el.find("#checkedAll").attr("checked",null)}).fail(function(t,n,r){e.goAlert(t.responseJSON.message)})}},{btype:"cancel",btext:a["\ucde8\uc18c"]}]})},_setTotalAttachSize:function(){var e=GO.util.byteToMega(this.deleteDeptAttach.get("totalAttachSize"));this.$el.find("#deptTotalAttach").html(e)},renderUserTpl:function(){this.$el.find("#tab_content").html(s({lang:f,selectType:[{name:a["\uc774\ub984"],value:"name"},{name:a["\uc774\uba54\uc77c"],value:"email"},{name:u["\uc0ad\uc81c \uad00\ub9ac\uc790"],value:"actorName"}]})),this.renderDeleteUser()},renderDeleteUser:function(){var t=this;this.listEl=e.goGrid({el:this.$("#deleteList"),method:"GET",url:GO.contextRoot+"ad/api/deleteuser/list",emptyMessage:o({label_desc:u["\uc0ad\uc81c\ub41c \uacc4\uc815\uc774 \uc5c6\uc2b5\ub2c8\ub2e4."]}),defaultSorting:[[3,"desc"]],sDomType:"admin",checkbox:!1,lengthMenu:[20,40,60,80],displayLength:n.session("adminPageBase"),columns:[{mData:function(e){return e.name==null||e.name==""?"-":e.name},sClass:"align_c",sWidth:"160px",bSortable:!1,fnRender:function(e){}},{mData:function(e){return e?e.position==null||e.position==""?"-":e.position:"position"},sClass:"align_c",sWidth:"150px",bSortable:!1,fnRender:function(e){}},{mData:function(e){return e.email==null||e.email==""?"-":e.email},sClass:"align_c",bSortable:!1},{mData:function(e){return e?e.deletedDate==null||e.deltedDate==""?"-":GO.util.shortDate(e.deletedDate):"deletedDate"},sClass:"align_c",bSortable:!0,sWidth:"180px",fnRender:function(e){}},{mData:function(e){if(e.adminName==null||e.adminName=="")return"-";var t=e.adminName+" ";return e.adminPosition==null?t=t:t+=e.adminPosition,t},sClass:"align_c",sWidth:"250px",bSortable:!1,fnRender:function(e){}}],fnDrawCallback:function(e){t.$el.find(".header_tb").remove()}})},search:function(){var e=this.$el.find('.table_search input[type="text"]'),t=e.val();this.listEl.tables.search(this.$el.find(".table_search select").val(),t,e)},searchKeyboardEvent:function(e){e.keyCode==13&&this.search()},downAccountDeleteList:function(){var e="ad/api/deleteuser/download/list?",t=this.listEl.listParams,n={property:"deletedDate",direction:t.direction,searchtype:t.searchtype,keyword:t.keyword};GO.util.downloadCsvFile(e+GO.util.jsonToUrlParam(n))}});return l});