(function(){define(["jquery","backbone","app","i18n!nls/commons","i18n!admin/nls/admin","admin/models/community_base_config","admin/collections/community_wait","hgn!admin/templates/community_base_config","jquery.go-popup","jquery.go-sdk"],function(e,t,n,r,i,s,o,u){var a={label_ok:r["\uc800\uc7a5"],label_cancel:r["\ucde8\uc18c"],label_base:i["\ucee4\ubba4\ub2c8\ud2f0 \uae30\ubcf8\uc124\uc815"],label_open:i["\ucee4\ubba4\ub2c8\ud2f0 \uac1c\uc124\ubc29\uc2dd"],label_approval:i["\uad00\ub9ac\uc790 \uc2b9\uc778 \ud6c4 \uac1c\uc124"],label_non_approval:i["\uad00\ub9ac\uc790 \uc2b9\uc778\uc5c6\uc774 \uac1c\uc124"],label_board:i["\ucee4\ubba4\ub2c8\ud2f0 \uac8c\uc2dc\ud310 \uc124\uc815"],label_attach_limit:i["\ucca8\ubd80\ud30c\uc77c \uc6a9\ub7c9\uc81c\ud55c"],label_attach_limit_desc:i["\ud30c\uc77c1\uac1c"],label_non_limit:i["\uc81c\ud55c\uc5c6\uc74c"],label_limit_size:i["\uc6a9\ub7c9\uc81c\ud55c"],label_limit_number:i["\uac1c\uc218\uc81c\ud55c"],label_mb:i.MB,label_attach_num_limit:i["\ucca8\ubd80\ud30c\uc77c \uac1c\uc218\uc81c\ud55c"],label_attach_num_limit_desc:i["\uac8c\uc2dc\ubb3c\ub2f9"],label_count:i["\uac1c"],label_under:i["\uc774\ud558"],label_exclude:i["\uc5c5\ub85c\ub4dc \ubd88\uac00 \ud30c\uc77c"],label_desc:i["\uc5c5\ub85c\ub4dc \uc81c\ud55c"],label_online:i["\uad00\ub9ac\uc790 \uc2b9\uc778\uc5c6\uc774 \uac1c\uc124"],label_wait:i["\ubaa8\ub4e0 \ucee4\ubba4\ub2c8\ud2f0 \uc2b9\uc778"]},f=n.BaseView.extend({el:"#layoutContent",unbindEvent:function(){this.$el.off("click","form[name='formCommunityConfig'] input:radio"),this.$el.off("click","span#btn_ok"),this.$el.off("click","span#btn_cancel"),this.$el.off("focusout","span#maxAttachSize input"),this.$el.off("focusout","span#maxAttachNumber input"),this.$el.off("keyup","input[name='excludeExtension']"),this.$el.off("click","span.btn_box[data-btntype='changeform']"),this.$el.off("click","span#data"),this.$el.off("keyup","span#maxAttachSize input"),this.$el.off("keyup","span#maxAttachNumber input"),this.$el.off("click","span#data"),this.$el.off("submit","form")},bindEvent:function(){this.$el.on("click","form[name='formCommunityConfig'] input:radio",e.proxy(this.toggleRadio,this)),this.$el.on("click","span#btn_ok",e.proxy(this.communityConfigSave,this)),this.$el.on("click","span#btn_cancel",e.proxy(this.communityConfigCancel,this)),this.$el.on("focusout","span#maxAttachSize input",e.proxy(this.inputValidator,this)),this.$el.on("focusout","span#maxAttachNumber input",e.proxy(this.inputValidator,this)),this.$el.on("keyup","input[name='excludeExtension']",e.proxy(this.keyUPValidator,this)),this.$el.on("click","span.btn_box[data-btntype='changeform']",e.proxy(this.changeModifyForm,this)),this.$el.on("click","span#data",e.proxy(this.changeModifyForm,this)),this.$el.on("keyup","span#maxAttachSize input",e.proxy(this.keyUPValidator,this)),this.$el.on("keyup","span#maxAttachNumber input",e.proxy(this.keyUPValidator,this)),this.$el.on("click","span#data",e.proxy(this.changeModifyForm,this)),this.$el.on("submit","form",e.proxy(this.formSubmit,this))},formSubmit:function(e){e.preventDefault();return},keyUPValidator:function(t){var n=t.currentTarget.value,r=t.currentTarget.id,s=e(t.currentTarget).parent(),o=s.parent().parent().find(".go_alert");o.html("");if(r=="excludeExtension"){if(!n.match(new RegExp("^[a-zA-Z0-9,]*$")))return o.html(i["\uc601\uc5b4, \uc27c\ud45c, \uc22b\uc790\ub9cc \uc785\ub825\uac00\ub2a5"]),t.currentTarget.focus(),t.currentTarget.value="",!1}else{if(n==0||n=="")return o.html(i["\uc81c\ud55c \uac12\uc744 \uc785\ub825\ud558\uc138\uc694."]),t.currentTarget.focus(),t.currentTarget.value="",!1;if(!(t.keyCode>=96&&t.keyCode<=105||t.keyCode>=48&&t.keyCode<=57||t.keyCode==46||t.keyCode==13||t.keyCode==8))return o.html(i["\uc22b\uc790\ub9cc \uc785\ub825\ud558\uc138\uc694."]),t.currentTarget.value="",!1}},changeModifyForm:function(t){var n=e(t.currentTarget).parent();n&&n.attr("data-formname")=="excludeExtension"?n.html(['<input type="input" name="',n.attr("data-formname"),'"id="',n.attr("data-formname"),'" class="input w_large" value="',n.attr("data-value"),'" />'].join("")).find("input").focusin():(e(t.currentTarget).hide(),n.html(['<input type="input" name="',n.attr("data-formname"),'"id="',n.attr("data-formname"),'" class="input t_num" value="',n.attr("data-value"),'" />'].join("")).find("input").focusin())},inputValidator:function(t){var n=t.currentTarget.value,r=t.currentTarget.id,s=e(t.currentTarget).parent(),o=s.parent().parent().find(".go_alert"),u=e("input#size_false").is(":checked"),a=e("input#number_false").is(":checked");o.html("");if(u==0&&r=="maxAttachSize"&&n>99)return o.html(i["1~99"]),t.currentTarget.focus(),t.currentTarget.value="",!1;if(a==0&&r=="maxAttachNumber"&&n>9)return o.html(i["1~9"]),t.currentTarget.focus(),t.currentTarget.value="",!1},initialize:function(){this.model=s.read({admin:!0}),this.unbindEvent(),this.bindEvent()},render:function(){this.$el.empty();var t=this,n=this.model.toJSON(),r=u({lang:a,model:n,hasExcludeExtension:function(){return n.excludeExtension==null||n.excludeExtension==""?!0:!1}});this.$el.html(r),t.model.get("attachSizeLimit")||e("#maxAttachSize").hide(),t.model.get("attachNumberLimit")||e("#maxAttachNumber").hide()},toggleRadio:function(t){e(t.currentTarget).attr("value")=="true"?e(t.currentTarget).is(':radio[name="attachSizeLimit"]')?(e("#maxAttachSize").show(),e('input[name="maxAttachSize"]').focus()):e(t.currentTarget).is(':radio[name="attachNumberLimit"]')&&(e("#maxAttachNumber").show(),e('input[name="maxAttachSize"]').focus()):e(t.currentTarget).attr("value")=="false"&&(e(t.currentTarget).is(':radio[name="attachSizeLimit"]')?(e("#maxAttachSize").hide(),e("#maxAttachSizeAlert").html("")):e(t.currentTarget).is(':radio[name="attachNumberLimit"]')&&(e("#maxAttachNumber").hide(),e("#maxAttachNumberAlert").html("")))},communityConfigSave:function(){var t=this,n=!0,s=this.$el.find("form[name=formCommunityConfig]"),u=t.model.get("approvalOpen")+"";e.each(s.serializeArray(),function(r,s){var o=s.value,u=s.name,a=e("#"+s.name+"Alert");a.html("");if(u=="excludeExtension"){o=o.split(" ").join("");if(!o.match(new RegExp("^[a-zA-Z0-9,]*$")))return a.html(i["\uc601\uc5b4, \uc27c\ud45c, \uc22b\uc790\ub9cc \uc785\ub825\uac00\ub2a5"]),e('input[name="'+u+'"]').focus(),n=!1,!1;s.value=s.value.toLowerCase().split(" ").join("")}else{var f=e("input#size_false").is(":checked"),l=e("input#number_false").is(":checked");if(!(o!=0&&o!=""||f!=0&&l!=0))return a.html(i["\uc81c\ud55c \uac12\uc744 \uc785\ub825\ud558\uc138\uc694."]),e('input[name="'+u+'"]').focus(),n=!1,!1;if(f==0&&u=="maxAttachSize"&&o>99)return a.html(i["1~99"]),e('input[name="'+u+'"]').focus(),n=!1,!1;if(l==0&&u=="maxAttachNumber"&&o>9)return a.html(i["1~9"]),e('input[name="'+u+'"]').focus(),n=!1,!1}t.model.set(s.name,s.value,{silent:!0})});if(!n)return!1;t.model.get("approvalOpen")=="true"?t.model.save({},{success:function(n,i){i.code=="200"&&(e.goMessage(r["\uc800\uc7a5\ub418\uc5c8\uc2b5\ub2c8\ub2e4."]),t.render())},error:function(t,n){responseData.message!=null?e.goMessage(responseData.message):e.goMessage(r["\uc2e4\ud328\ud588\uc2b5\ub2c8\ub2e4."])}}):u!=t.model.get("approvalOpen")?e.goConfirm(i["\uad00\ub9ac\uc790 \uc2b9\uc778\uc5c6\uc774 \uac1c\uc124"],i["\ubaa8\ub4e0 \ucee4\ubba4\ub2c8\ud2f0 \uc2b9\uc778"],function(){this.collection=o.getCollection();var n=this.collection.toJSON(),i=new Array;e.each(n,function(e,t){i.push(t.id)}),i.length>0&&e.go(GO.contextRoot+"ad/api/community/status/online",JSON.stringify({communityIds:i}),{qryType:"PUT",contentType:"application/json",responseFn:function(n){n.code==200?(t.collection=o.getCollection(),e.goMessage(r["\uc800\uc7a5\ub418\uc5c8\uc2b5\ub2c8\ub2e4."]),t.render()):e.goAlert(r["\uc2e4\ud328"],r["\uc2e4\ud328\ud558\uc600\uc2b5\ub2c8\ub2e4."])}}),t.model.save({},{success:function(n,i){i.code=="200"&&(e.goMessage(r["\uc800\uc7a5\ub418\uc5c8\uc2b5\ub2c8\ub2e4."]),t.render())},error:function(t,n){var i=JSON.parse(n.responseText);i.message!=null?e.goMessage(i.message):e.goMessage(r["\uc2e4\ud328\ud588\uc2b5\ub2c8\ub2e4."])}})},"\ud655\uc778"):t.model.save({},{success:function(n,i){i.code=="200"&&(t.render(),e.goMessage(r["\uc800\uc7a5\ub418\uc5c8\uc2b5\ub2c8\ub2e4."]))},error:function(t,n){var i=JSON.parse(n.responseText);i.message!=null?e.goMessage(i.message):e.goMessage(r["\uc2e4\ud328\ud588\uc2b5\ub2c8\ub2e4."])}})},communityConfigCancel:function(){var t=this;e.goCaution(r["\ucde8\uc18c"],r["\ubcc0\uacbd\ud55c \ub0b4\uc6a9\uc744 \ucde8\uc18c\ud569\ub2c8\ub2e4."],function(){t.render(),e.goMessage(r["\ucde8\uc18c\ub418\uc5c8\uc2b5\ub2c8\ub2e4."])},r["\ud655\uc778"])}},{__instance__:null});return f})}).call(this);