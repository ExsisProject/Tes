define(["jquery","underscore","backbone","app","hogan","hgn!admin/templates/manage_security_level","hgn!admin/templates/manage_security_level_list","i18n!approval/nls/approval","i18n!nls/commons","i18n!admin/nls/admin","jquery.ui","jquery.go-validation"],function(e,t,n,r,i,s,o,u,a,f){var l=n.Model.extend({url:r.contextRoot+"ad/api/approval/securitylevel",validate:function(t,n){var r=[];e(t.securityLevel).each(function(e,t){r.push(t.attributes.level)});var i=e.unique(r).length==t.securityLevel.length;if(!i)return"isNotUnique"}}),c=l.extend({validate:function(e,n){var r=/[ \{\}\[\]\/?.,;:|\)*~`!^\-_+\u253c<>@\#$%&\'\"\\\(\=]/gi;if(!t.isEmpty(e.id)&&t.isEmpty(e.name))return"name_required";if(!t.isEmpty(e.name)&&e.name.length>=20)return"name_invalid_length";if(r.test(e.name))return"name_invalid_string"},haveIdAndName:function(){return t.isEmpty(this.attributes.id)&&t.isEmpty(this.attributes.name)?!1:!0}}),h=n.Collection.extend({url:r.contextRoot+"ad/api/approval/securitylevel",model:c}),p={name_required:f["\uc774\ub984\uc744 \uc785\ub825\ud558\uc138\uc694."],name_invalid_length:f["\uc774\ub984\uc740 20\uc790 \ubbf8\ub9cc\uc785\ub2c8\ub2e4."],isNotUnique:f["\uc911\ubcf5\ub41c \uac12\uc774 \uc788\uc2b5\ub2c8\ub2e4."],name_invalid_string:f["\ubcf4\uc548\ub4f1\uae09 \uc774\ub984\uc5d0 \uacf5\ubc31\uc774\ub098 \ud2b9\uc218\ubb38\uc790\ub294 \uc0ac\uc6a9\ud560\uc218 \uc5c6\uc2b5\ub2c8\ub2e4"],"\uc800\uc7a5":a["\uc800\uc7a5"],"\ucde8\uc18c":a["\ucde8\uc18c"],"\ubcf4\uc548\ub4f1\uae09 \uc774\ub984":a["\ubcf4\uc548\ub4f1\uae09 \uc774\ub984"],"\ubcf4\uc548\ub4f1\uae09 \uad00\ub828 \ud5e4\ub354":f["\ubcf4\uc548\ub4f1\uae09 \uad00\ub828 \ud5e4\ub354"],"\ubcf4\uc548\ub4f1\uae09":f["\ubcf4\uc548\ub4f1\uae09"],"\ubcf4\uc548\ub4f1\uae09 \uc774\ub984":f["\ubcf4\uc548\ub4f1\uae09 \uc774\ub984"],"\uc0ac\uc6a9\uc5ec\ubd80":f["\uc0ac\uc6a9\uc5ec\ubd80"]},d=n.View.extend({securityLevels:null,model:null,listOffset:10,el:"#layoutContent",initialize:function(){this.collection=new h,this.collection.fetch({async:!1,statusCode:{403:function(){r.util.error("403")},404:function(){r.util.error("404",{msgCode:"400-common"})},500:function(){r.util.error("500")}}}),this.model=new l},delegateEvents:function(t){this.undelegateEvents(),n.View.prototype.delegateEvents.call(this,t),this.$el.on("click.securityLevel","#btn_securityLevel_save",e.proxy(this._doSave,this)),this.$el.on("click.securityLevel","#btn_securityLevel_cancel",e.proxy(this._doCancel,this))},undelegateEvents:function(){return n.View.prototype.undelegateEvents.call(this),this.$el.off(".securityLevel"),this},render:function(){this.$el.html(s({lang:p})),this.renderItemList()},renderItemList:function(){this._renderEmptyList(this.listOffset),this._renderDBListReplaceWithEmptyList(),this.$el.find("tr:last").addClass("last")},_renderEmptyList:function(e){var t=this;this._makeOptionsTag();var n=1,r=e,i,s;if(n<=r)for(n;n<=r;n++)i=n,s=t._makeOptionsTag(i),this.$el.find("tbody").append(o({level:i,optionsTag:s}))},_makeOptionsTag:function(e){var t=this.listOffset,n=1,r=t,i,s="";if(n<=r)for(n;n<=r;n++)i=n,e==i?s+='<option value="'+i+' " selected>'+i+"</option>":s+='<option value="'+i+' ">'+i+"</option>";return s},_renderDBListReplaceWithEmptyList:function(){var e=this;targetEl=this.$el.find("#securityLevel_tbody > tr"),t.each(this.collection.models,function(n,r){this.$el.find("tr[data-level="+n.get("level")+"]").replaceWith(o(t.extend({optionsTag:e._makeOptionsTag(n.get("level"))},n.toJSON())))},this)},_makeData:function(){var t,n=[];for(var r=0;r<this.listOffset;r++){t=this.$el.find("#securityLevel_tbody > tr").eq(r),this.securityLevels=new c,this.securityLevels.set("id",e(t).attr("data-id")),this.securityLevels.set("level",e(t).find("td select option:selected").val()),this.securityLevels.set("name",e(t).find("input[name=securityName]").val()),this.securityLevels.set("useFlag",e(t).find("input[name=useFlag]").is(":checked"));if(!this.securityLevels.isValid())return e.goMessage(p[this.securityLevels.validationError]),e(t).find("input[name=securityName]").select(),!1;if(!this.securityLevels.haveIdAndName())continue;n.push(this.securityLevels)}return n},_doSave:function(){var t=this._makeData(),n=this;if(!t)return!1;this.model.set("securityLevel",t);if(!this.model.isValid())return e.goMessage(p[this.model.validationError]),!1;r.EventEmitter.trigger("common","layout:setOverlay",""),this.model.save({},{type:"POST",async:!1,success:function(t,i){i.code=="200"&&(r.EventEmitter.trigger("common","layout:clearOverlay",!0),e.goAlert(a["\uc800\uc7a5\ub418\uc5c8\uc2b5\ub2c8\ub2e4."],"",function(){n.collection.fetch({asnyc:!1,success:function(){n.render()}})}))},error:function(t,n){var i=JSON.parse(n.responseText);return r.EventEmitter.trigger("common","layout:clearOverlay",!0),i.message?(e.goError(i.message),!1):(e.goError(a["\uc800\uc7a5\uc5d0 \uc2e4\ud328 \ud558\uc600\uc2b5\ub2c8\ub2e4."]),!1)}})},_doCancel:function(){this.render()},release:function(){this.$el.off(),this.$el.empty()}});return d});