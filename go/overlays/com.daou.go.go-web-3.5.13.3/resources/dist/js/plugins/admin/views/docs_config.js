define("admin/views/docs_config",function(require){var e=require("app"),t=require("i18n!nls/commons"),n=require("i18n!admin/nls/admin"),r=require("i18n!approval/nls/approval"),i=require("i18n!docs/nls/docs"),s=require("hgn!admin/templates/docs_config"),o=require("hgn!admin/templates/docs_config_form"),u=require("underscore"),a=require("views/circle_tableTmpl"),f=require("views/circle"),l=require("admin/views/docs_folder_tree"),c=require("admin/models/docs_folder");require("jquery.go-orgslide");var h={cannot_create_under_hidden:n["\uc228\uae40\ucc98\ub9ac\ub41c \ud3f4\ub354\ub294 \ud558\uc704\ud3f4\ub354\ub97c \uc0dd\uc131\ud560 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4."],folder_detail:i["\ubb38\uc11c\ud568 \uc0c1\uc138\uc815\ubcf4"],add:t["\ucd94\uac00"],"delete":t["\uc0ad\uc81c"],folder_name:n["\ubb38\uc11c\ud568 \uba85"],admin:n["\uc6b4\uc601\uc790"],docsYear:i["\ubcf4\uc874\uc5f0\ud55c"],docNum:i["\ubb38\uc11c\ubc88\ud638"],use:n["\uc0ac\uc6a9"],unuse:n["\uc0ac\uc6a9\ud558\uc9c0 \uc54a\uc74c"],use_approval:i["\ub4f1\ub85d\uc2b9\uc778\uae30\ub2a5"],access_target:i["\uc5f4\ub78c\uc790 \uc124\uc815"],exception_target:i["\uc608\uc678\uc790 \uc124\uc815"],status:n["\uc0ac\uc6a9\uc5ec\ubd80"],hidden:n["\uc228\uae40"],normal:n["\uc815\uc0c1"],save:t["\uc800\uc7a5"],cancel:t["\ucde8\uc18c"]},p=Backbone.Model.extend({initialize:function(e){this.option=e||{docYear:5}}},{PRESERVE_YEARS:[1,3,5,10,0]}),d=Backbone.View.extend({events:{"click span[data-btntype='publicDelete']":"deletePublicRange","click span.btn_add":"folderAdd","click span.btn_delete":"folderDelete","click #docsConfigSubmit":"submit","click #docsConfigCancel":"cancel"},initialize:function(e){},render:function(){this.$el.html(s({lang:h})),this.renderFolderList()},renderFolderList:function(){this.treeView=new l({isAdmin:!0,treeElementId:"orgTree",selectCallback:$.proxy(function(e){this.$(".tb_wrap");if(e.type=="root"){var t='<div class="header_group"><h3>'+i["\uc804\uc0ac \ubb38\uc11c\ud568"]+"</h3></div>"+'<table class="detail tb_admin_doc_folder">'+"<tbody>"+'<tr class="odd">'+'<td valign="top" colspan="2" class="dataTables_empty align_c">'+'<p class="data_null">'+'<span class="ic_data_type ic_no_data"></span>'+'<span class="txt">'+i["\ubb38\uc11c\ud568\uc744 \uc120\ud0dd\ud574 \uc8fc\uc138\uc694."]+"</span>"+"</p>"+"</td>"+"</tr>"+"</tbody>"+"</table>";this.$(".tb_wrap").html(t)}else this.renderDetailForm(e.id)},this)}),this.treeView.render()},renderForm:function(){this.renderAdminView(),this.renderAccessUserView(),this.renderExceptionUserView()},deletePublicRange:function(e){$(e.currentTarget).parents("li").first().remove()},makeDocInfo:function(e){this.yearsModel=new p({docYear:e});var t=u.map(p.PRESERVE_YEARS,function(e){return{value:e,label:e==0?r["\uc601\uad6c"]:e+r["\ub144"],isSelected:this.yearsModel.get("docYear")*1==e*1?!0:!1}},this);return t},renderAdminView:function(){var e=["user","position","grade","usergroup"];GO.util.isUseOrgService(!0)&&(e=["user","department","position","grade","duty","usergroup"]),this.model.get("admin")!=null&&(this.model.get("admin").nodes=u.sortBy(this.model.get("admin").nodes,"nodeType")),this.adminView=new f({selector:"#admin",isAdmin:!0,isWriter:!0,circleJSON:this.model.get("admin"),nodeTypes:e}),this.adminView.render()},renderAccessUserView:function(){var e=["company","user","position","grade","usergroup"];GO.util.isUseOrgService(!0)&&(e=["company","user","department","position","grade","duty","usergroup"]),this.model.get("accessTarget")!=null&&(this.model.get("accessTarget").nodes=u.sortBy(this.model.get("accessTarget").nodes,"nodeType")),this.accessUserView=new a({selector:"#accessUser",isAdmin:!0,isWriter:!0,circleJSON:this.model.get("accessTarget"),nodeTypes:e}),this.accessUserView.render()},renderExceptionUserView:function(){var e=["user","position","grade","usergroup"];GO.util.isUseOrgService(!0)&&(e=["user","department","position","grade","duty","usergroup"]),this.model.get("exceptionTarget")!=null&&(this.model.get("exceptionTarget").nodes=u.sortBy(this.model.get("exceptionTarget").nodes,"nodeType")),this.exceptionUserView=new a({selector:"#exceptionUser",isExceptionList:!0,isAdmin:!0,isWriter:!0,circleJSON:this.model.get("exceptionTarget"),nodeTypes:e}),this.exceptionUserView.render()},renderDetailForm:function(e){$.goOrgSlide("close");if(e){this.model=new c,this.model.set("id",e),this.model.fetch({async:!1,statusCode:{403:function(){GO.util.error("403")},404:function(){GO.util.error("404",{msgCode:"400-common"})},500:function(){GO.util.error("500")}}});var t=this.model.toJSON();this.$(".tb_wrap").html(o({preserveYears:this.makeDocInfo(t.docYear),data:t,isNormalState:t.state=="NORMAL",lang:h}))}else this.$(".tb_wrap").html(o({preserveYears:this.makeDocInfo(5)}));this.renderForm()},folderAdd:function(){$.goOrgSlide("close");if(!this.validBeforeFolderCreate())return!1;this.treeView.renderNewFolderInput(h.folder_name)},folderDelete:function(){$.goOrgSlide("close"),this.treeView.deleteSelectedFolder()},validBeforeFolderCreate:function(){return this.model!=undefined&&this.model.get("state")=="HIDDEN"?($.goError(h.cannot_create_under_hidden),!1):!0},submit:function(){$.goOrgSlide("close");var n=this,r=$("#name").val(),s=$("#enableDocNum").attr("checked")?!0:!1,o=$("#enableDocEnrollConfirm").attr("checked")?!0:!1,u=$("#disableDoc").attr("checked")?"HIDDEN":"NORMAL",a=n.accessUserView.getData(),f=n.exceptionUserView.getData(),l=n.adminView.getData(),c=$.trim(r);if(c.length>100||c.length<2){var h=e.i18n(i["0\uc740 0\uc790\uc774\uc0c1 0\uc790\uc774\ud558 \uc785\ub825\ud574\uc57c \ud569\ub2c8\ub2e4."],{arg0:i["\ubb38\uc11c\ud568 \uc774\ub984"],arg1:"2",arg2:"100"});return $.goError(h,$("#name"),!1,!0),!1}var p=document.getElementById("docYear");n.model.set("name",r,{silent:!0}),n.model.set("useDocNum",s,{silent:!0}),n.model.set("useApproved",o,{silent:!0}),n.model.set("docYear",p.options[p.selectedIndex].value*1,{silent:!0}),n.model.set("state",u,{silent:!0}),n.model.set("admin",l,{silent:!0}),n.model.set("accessTarget",a,{silent:!0}),n.model.set("exceptionTarget",f,{silent:!0}),GO.EventEmitter.trigger("common","layout:setOverlay",""),n.model.save({},{type:"PUT",success:function(e,n){n.code=="200"&&($.goMessage(t["\uc800\uc7a5\ub418\uc5c8\uc2b5\ub2c8\ub2e4."]),GO.EventEmitter.trigger("common","layout:clearOverlay",!0),GO.router.navigate("docs",{trigger:!0}))},error:function(e,n){$.goMessage(t["\uc800\uc7a5\uc5d0 \uc2e4\ud328 \ud558\uc600\uc2b5\ub2c8\ub2e4."]),GO.EventEmitter.trigger("common","layout:clearOverlay",!0)}})},cancel:function(){$.goOrgSlide("close"),this.render()},setOwners:function(){var e=[],t=$("#groupUl").find("li");if(t.length<1)return;return t.each(function(){e.push({ownerShip:"JOINT",ownerType:$(this).attr("data-type")?$(this).attr("data-type"):"DomainCode",ownerId:$(this).attr("data-code"),scope:"ALL",permission:"3",sharedType:$(this).attr("data-sharedtype")?$(this).attr("data-sharedtype"):"NONE"})}),e}});return d});