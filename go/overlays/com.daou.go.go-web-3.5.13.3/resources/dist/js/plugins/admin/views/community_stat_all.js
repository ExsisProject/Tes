define(["jquery","backbone","app","hgn!admin/templates/community_stat_all","hgn!admin/templates/list_empty","i18n!nls/commons","i18n!admin/nls/admin","jquery.go-popup","jquery.go-sdk","jquery.go-grid","GO.util","jquery.go-validation"],function(e,t,n,r,i,s,o){var u=null,a={label_total_community:o["\ucd1d \ucee4\ubba4\ub2c8\ud2f0 \uc218"],label_community:o["\uc18c\uc18d \ucee4\ubba4\ub2c8\ud2f0"],label_total_board:o["\ucd1d \uac8c\uc2dc\ud310 \uc218"],label_total_post:o["\ucd1d \uac8c\uc2dc\ubb3c \uc218"],label_online:o["\uc815\uc0c1"],label_stop:o["\uc911\uc9c0"],label_classic:o["\ud074\ub798\uc2dd"],label_feed:o["\ud53c\ub4dc"],label_count:o["\uac1c"],label_mb:o.MB,label_total_storage:o["\ucd1d \uc0ac\uc6a9\ub7c9"],label_down:o["\ubaa9\ub85d \ub2e4\uc6b4\ub85c\ub4dc"],label_name:o["\ucee4\ubba4\ub2c8\ud2f0 \uba85"],label_master:o["\ub9c8\uc2a4\ud130"],label_created:o["\uc0dd\uc131\uc77c"],label_members:o["\ud68c\uc6d0\uc218(\uba85)"],label_board:s["\uac8c\uc2dc\ud310"],label_boards:o["\uac8c\uc2dc\ud310 \uc218(\uac1c)"],label_posts:o["\uac8c\uc2dc\ubb3c \uc218(\uac1c)"],label_storage:o["\uc0ac\uc6a9\ub7c9(MB)"],label_search:s["\uac80\uc0c9"],label_all:o["\uc804\uccb4\uc720\ud615"],label_bbs:o["\ud074\ub798\uc2dd \ud0c0\uc785"],label_stream:o["\ud53c\ub4dc \ud0c0\uc785"],label_usage_desc:o["\uc0ac\uc6a9\ub7c9\uc815\ubcf4 \uc548\ub0b4"]},f=t.View.extend({el:"#layoutContent",events:{"click .wrap_action":"onClickedWrapAction"},unbindEvent:function(){this.$el.off("click","span.btn_search"),this.$el.off("keydown","span.search_wrap input"),this.$el.off("change","#boardType"),this.$el.off("click","span#btn_down_all")},bindEvent:function(){this.$el.on("click","span.btn_search",e.proxy(this.search,this)),this.$el.on("keydown","span.search_wrap input",e.proxy(this.searchKeyboardEvent,this)),this.$el.on("change","#boardType",e.proxy(this.boardTypeFilter,this)),this.$el.on("click","span#btn_down_all",e.proxy(this.csvDownloadCommunityAll,this))},initialize:function(){this.listEl="#communityList",this.dataTable=null,this.model=new t.Model,this.model.url=GO.contextRoot+"ad/api/community/statistic/all",this.model.fetch({async:!1}),this.unbindEvent(),this.bindEvent()},onClickedWrapAction:function(){this.$el.find(".wrap_action").toggle(),this.$el.find(".info_summary li").not(".first").toggle()},csvDownloadCommunityAll:function(){var e="ad/api/community/statistic/boards/download?",t=this.dataTable.listParams,n={property:t.property,direction:t.direction,type:t.type,keyword:t.keyword,searchtype:t.searchtype};GO.util.downloadCsvFile(e+GO.util.jsonToUrlParam(n))},render:function(){this.$el.empty();var e=this.model.toJSON();this.$el.html(r({model:e,lang:a,selectType:[{name:s["\uac8c\uc2dc\ud310"],value:"name"},{name:o["\uc18c\uc18d \ucee4\ubba4\ub2c8\ud2f0"],value:"sortOwnerInfos"}],totalSize:function(){return GO.util.byteToMega(e.totalAttachSize)}})),this.renderCommunityList()},renderCommunityList:function(){var t=this;this.dataTable=e.goGrid({el:this.listEl,method:"GET",url:GO.contextRoot+"ad/api/community/statistic/boards",emptyMessage:i({label_desc:o["\ucee4\ubba4\ub2c8\ud2f0\uac00 \uc5c6\uc2b5\ub2c8\ub2e4."]}),defaultSorting:[[0,"desc"]],sDomType:"admin",displayLength:n.session("adminPageBase"),columns:[{mData:"name",bSortable:!0,sClass:"align_l"},{mData:"sortOwnerInfos",sWidth:"150px",bSortable:!0},{mData:null,sWidth:"120px",bSortable:!1,fnRender:function(e){return e.aData.type=="CLASSIC"?o["\ud074\ub798\uc2dd"]:o["\ud53c\ub4dc"]}},{mData:"postCount",sClass:"align_r",sWidth:"130px",bSortable:!0},{mData:"totalSize",sClass:"align_r",sWidth:"130px",bSortable:!0,fnRender:function(e){return GO.util.byteToMega(e.aData.totalSize)}},{mData:"createdAt",sClass:"align_c",sWidth:"130px",bSortable:!0,fnRender:function(e){return GO.util.shortDate(e.aData.createdAt)}}],fnDrawCallback:function(e){t.$el.find(".toolbar_top .custom_header").append(t.$el.find("#btn_down_all").show())}})},search:function(){var t=this.$el.find('.table_search input[type="text"]'),r=t.val();t.trigger("focusout").blur();if(e.trim(r)==""){e.goAlert(s["\uac80\uc0c9\uc5b4\ub97c \uc785\ub825\ud558\uc138\uc694."]);return}if(!e.goValidation.isCheckLength(2,32,r)){e.goAlert(n.i18n(o["0\uc790\uc774\uc0c1 0\uc774\ud558 \uc785\ub825\ud574\uc57c\ud569\ub2c8\ub2e4."],{arg1:"2",arg2:"32"}));return}this.dataTable.tables.search(this.$el.find(".table_search select").val(),r)},searchKeyboardEvent:function(e){e.keyCode==13&&this.search()},boardTypeFilter:function(t){var n=e(t.currentTarget).val();typeof this.dataTable.tables.setParam=="function"&&this.dataTable.tables.setParam("type",n)}});return f});