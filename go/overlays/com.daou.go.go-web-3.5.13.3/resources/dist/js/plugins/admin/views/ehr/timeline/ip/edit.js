define("admin/views/ehr/timeline/ip/edit",function(require){function a(e,t,n){}var e=require("backbone"),t=require("app"),n=require("hgn!admin/templates/ehr/timeline/ip/edit"),r=require("admin/models/ehr/timeline/access_ip"),i=require("i18n!admin/nls/admin"),s=require("i18n!nls/commons");require("jquery.go-sdk");var o={label_access_allow_ip_info:i["\uc811\uc18d \ud5c8\uc6a9 IP \uc815\ubcf4"],label_ip_name:i["\uc811\uc18d IP \uc774\ub984"],label_ip:i["\uc811\uc18d IP \ub300\uc5ed"],label_save:s["\uc800\uc7a5"],label_cancel:s["\ucde8\uc18c"],label_modify:s["\uc218\uc815"]},u=e.View.extend({events:{"click #btn_save":"saveIp","click #btn_cancel":"reset","keyup #ipName":"clearAlert"},initialize:function(e){this.options=e||{},this.workPlaceId=this.options.workPlaceId,this.ipId=this.options.ipId,this.ipId?this.model=new r({id:this.ipId}):this.model=new r({workPlaceId:this.workPlaceId})},render:function(){if(this.ipId){this.model.fetch({async:!1});var e=this.model.toJSON(),t=e.ipRange.split("-");e.ip1=t[0].split(".")[0],e.ip2=t[0].split(".")[1],e.ip3=t[0].split(".")[2],e.ip4=t[0].split(".")[3],e.ip5=t[1]}return this.$el.html(n({lang:o,model:e})),this},saveIp:function(){var e=this,n=!0,r=$("form[name=formIpEdit]"),o=r.find("#ipName").val();if(!$.goValidation.isCheckLength(1,255,o))n=!1,r.find("#ipNameAlert").html(t.i18n(i["0\uc790\uc774\uc0c1 0\uc774\ud558 \uc785\ub825\ud574\uc57c\ud569\ub2c8\ub2e4."],{arg1:"1",arg2:"255"})),r.find("#ipName").focus();else if(!$.goValidation.isNumber(r.find("#ip1").val())||!$.goValidation.isNumber(r.find("#ip2").val())||!$.goValidation.isNumber(r.find("#ip3").val())||!$.goValidation.isNumber(r.find("#ip4").val())||!$.goValidation.isNumber(r.find("#ip5").val()))n=!1,r.find("#ipAlert").html(i["\uc22b\uc790\ub9cc \uc785\ub825\ud558\uc138\uc694."]);else if(r.find("#ip1").val()<0||r.find("#ip1").val()>255||r.find("#ip2").val()<0||r.find("#ip2").val()>255||r.find("#ip3").val()<0||r.find("#ip3").val()>255||r.find("#ip4").val()<0||r.find("#ip4").val()>255||r.find("#ip5").val()<0||r.find("#ip5").val()>255)n=!1,r.find("#ipAlert").html("0~255 \uc0ac\uc774\uc758 \uac12\uc744 \uc785\ub825\ud574\uc8fc\uc138\uc694.");var u=r.find("#ip1").val()+"."+r.find("#ip2").val()+"."+r.find("#ip3").val()+"."+r.find("#ip4").val()+"-"+r.find("#ip5").val();n&&(n=this.validateIpRange(u));if(!n)return!1;e.model.set("ipName",$("#ipName").val(),{silent:!0}),e.model.set("ipRange",u,{silent:!0}),t.EventEmitter.trigger("common","layout:setOverlay",""),this.model.save({},{success:function(e,n){n.code=="200"&&($.goMessage(s["\uc800\uc7a5\ub418\uc5c8\uc2b5\ub2c8\ub2e4."]),t.EventEmitter.trigger("common","layout:clearOverlay",!0),t.router.navigate("ehr/workplace/manage",{trigger:!0}))},error:function(e,n){var r=JSON.parse(n.responseText);$.goMessage(r.message),t.EventEmitter.trigger("common","layout:clearOverlay",!0)}})},clearAlert:function(){$("#ipName").val().length&&$("#ipNameAlert").html("")},reset:function(){t.router.navigate("ehr/workplace/manage",!0)},validateIpRange:function(e){var n=!1;return $.go(t.contextRoot+"ad/api/timeline/ip/check?workplaceid="+this.workPlaceId+"&ip="+e+"&excludeip="+this.model.attributes.ipRange,"",{async:!1,qryType:"GET",contentType:"application/json",responseFn:function(e){n=!0},error:function(e){var t=JSON.parse(e.responseText);$.goMessage(i["\uc811\uc18d IP \ub300\uc5ed\uc774 \uc911\ubcf5\ub418\uc5c8\uc2b5\ub2c8\ub2e4."]),n=!1}}),n}});return u});