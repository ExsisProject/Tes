(function(){define(["backbone","i18n!nls/commons","i18n!admin/nls/admin","i18n!task/nls/task","hgn!admin/templates/task_type_list","admin/models/task_type","jquery.go-grid"],function(e,t,n,r,i,s){var o={SHOW:r["\uc815\uc0c1"],HIDDEN:r["\uc228\uae40"],typeName:n["\uc720\ud615\uba85"],statusSetting:n["\uc124\uc815 \uc0c1\ud0dc"],applyFolder:n["\uc801\uc6a9 \ud3f4\ub354"],isEnable:n["\uc0ac\uc6a9\uc5ec\ubd80"],createdAt:n["\ub4f1\ub85d\uc77c"],administration:t["\uad00\ub9ac"],typeName:n["\uc720\ud615\uba85"],statusName:n["\uc0c1\ud0dc\uba85"],search:t["\uac80\uc0c9"]},u=e.View.extend({events:{"keypress #searchKeyword":"enterEventHandler","click span[data-type=setting]":"moveToSetting","click #init":"typeInit","click #moveToCreate":"moveToCreate","click #checkAll":"checkAll","click #destroy":"destroy","click #search":"search","click #copy":"movoToCopy"},initialize:function(){this.listOption={page:0,size:20}},render:function(){return this.$el.html(i({lang:o})),this.typeInit("GET"),this},typeInit:function(e){var t=e=="GET"?e:"POST",n=this;$.ajax({url:GO.contextRoot+"ad/api/task/config/init",type:t,async:!1,success:function(e){t=="GET"?n.beforeInit(e):n.afterInit()}})},beforeInit:function(e){this.isInit=e.data.init,this.renderList(),this.renderButton()},afterInit:function(){this.dataTable.tables.fnClearTable(),this.$("#init").hide()},renderList:function(){var e=this;this.dataTable=$.goGrid({el:this.$("#typeList"),url:GO.contextRoot+"ad/api/task/type",displayLength:e.listOption.size,emptyMessage:'<tr style="display:"><td colspan="6"><p class="data_null"> <span class="ic_data_type ic_no_contents"></span><span class="txt">'+r["\ubaa9\ub85d\uc774 \uc5c6\uc2b5\ub2c8\ub2e4"]+"</span>"+"</p>"+"</td>"+"</tr>",defaultSorting:[],sDomUse:!0,columns:[{mData:null,sClass:"check",bSortable:!1,fnRender:function(e){return'<input data-typeid="'+e.aData.id+'" type="checkbox" data-folders="'+e.aData.appliedFolders+'">'}},{mData:"name",sClass:"state",bSortable:!0,fnRender:function(e){return'<span data-type="setting" data-id="'+e.aData.id+'" style="cursor:pointer;">'+e.aData.name+"</span>"}},{mData:null,sClass:"set",bSortable:!1,fnRender:function(e){var t=new s(e.aData);return t.statusLabel()}},{mData:"appliedFolders",sClass:"folder",bSortable:!0,fnRender:function(e){return e.aData.appliedFolders}},{mData:"status",sClass:"",bSortable:!0,fnRender:function(e){return o[e.aData.status]}},{mData:"createdAt",sClass:"date",bSortable:!0,fnRender:function(e){return GO.util.customDate(e.aData.createdAt,"YYYY-MM-DD")}},{mData:null,sClass:"last action",bSortable:!1,fnRender:function(e){return'<td class="action last"><span class="btn_s btn_setting" data-id="'+e.aData.id+'" data-type="setting">'+n["\uc124\uc815"]+"</span> "+'<span class="btn_s btn_setting" id="copy" data-id="'+e.aData.id+'">'+t["\ubcf5\uc0ac"]+"</span>"+"</td>"}}],fnDrawCallback:function(e,t,n){}})},renderButton:function(){var e=['<span class="btn_tool" id="moveToCreate">'+t["\ucd94\uac00"]+"</span>",'<span class="btn_tool txt_caution" id="destroy">'+t["\uc0ad\uc81c"]+"</span>"];this.isInit||e.unshift('<span class="btn_tool" id="init">'+n["\uae30\ubcf8 \uc720\ud615 \ucd94\uac00"]+"</span>"),this.$("div.tool_bar").first().removeClass("toolbar").addClass("toolbar_top header_tb"),this.$("div.custom_header").append(e.join(""))},checkAll:function(e){var t=$(e.currentTarget).is(":checked");this.$("input[data-typeid]").attr("checked",t)},getIds:function(e){var t=[];return _.each(e,function(e){t.push($(e).attr("data-typeid"))}),{ids:t}},validate:function(e){var t=!0;return e.length||($.goError(r["\uc720\ud615\uc744 \uc120\ud0dd\ud574 \uc8fc\uc138\uc694."]),t=!1),_.each(e,function(e){$(e).attr("data-folders")>0&&($.goError(r["\uc720\ud615\uc774 \uc801\uc6a9\ub41c \ud3f4\ub354\uac00 \uc788\uc73c\uba74 \uc0ad\uc81c\ud560 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4."]),t=!1)}),t},destroy:function(){var e=this.$("input[data-typeid]:checked");if(!this.validate(e))return;var n=this;$.go(GO.contextRoot+"ad/api/task/type",JSON.stringify(n.getIds(e)),{contentType:"application/json",qryType:"DELETE",async:!1,responseFn:function(e){n.render(),$.goMessage(t["\uc0ad\uc81c\ub418\uc5c8\uc2b5\ub2c8\ub2e4."])},error:function(e){$.goError(e.responseJSON.message)}})},enterEventHandler:function(e){e.which==13&&this.search()},search:function(){var e=this.$("#searchKeyword").val();if(!e){$.goMessage(r["\uac80\uc0c9\uc5b4\ub97c \uc785\ub825\ud574\uc8fc\uc138\uc694."]);return}this.listOption.keywordType=this.$("#searchType").val(),this.listOption.keyword=this.$("#searchKeyword").val(),this.dataTable.tables.fnSettings().sAjaxSource=this.getSearchUrl(),this.dataTable.tables.fnClearTable()},getSearchUrl:function(){return GO.contextRoot+"ad/api/task/type?"+$.param(this.listOption)},moveToSetting:function(e){var t=$(e.currentTarget).attr("data-id");GO.router.navigate("task/type/"+t,{trigger:!0,pushState:!0})},moveToCreate:function(){GO.router.navigate("task/type",{trigger:!0,pushState:!0})},movoToCopy:function(e){var t=$(e.currentTarget).attr("data-id");GO.router.navigate("task/type/copy/"+t,{trigger:!0,pushState:!0})}});return u})}).call(this);