define("admin/views/account/batch_upload",function(require){var e=require("jquery"),t=require("backbone"),n=require("app"),r=require("hgn!admin/templates/attached_file"),i=require("hgn!admin/templates/batch_upload"),s=require("hgn!admin/templates/batch_upload_result"),o=require("i18n!nls/commons"),u=require("i18n!admin/nls/admin"),a=require("file_upload"),f=require("admin/views/org_sync_button");require("GO.util"),require("jquery.go-grid"),require("jquery.go-preloader");var l={upload:u["\uc77c\uad04 \ub4f1\ub85d"],upload_form_help:u["\uc5c5\ub85c\ub4dc \uc591\uc2dd \ub3c4\uc6c0\ub9d0"],password_setting:u["\ube44\ubc00\ubc88\ud638 \uad00\ub9ac \uc124\uc815"],password_setting_desc:n.i18n(u["\ube44\ubc00\ubc88\ud638 \uad00\ub9ac \uc124\uc815 \uc124\uba85"],"arg1","<a class='goToPwSettingLink'>["+u["\ube44\ubc00\ubc88\ud638 \uad00\ub9ac \uc124\uc815"]+"]</a>"),upload_result:u["\uc77c\uad04 \ub4f1\ub85d \uacb0\uacfc"],upload_result_guide:u["\ud30c\uc77c\uc744 \ub4f1\ub85d\ud558\uba74, \uc544\ub798 \ud654\uba74\uc5d0\uc11c \ucd94\uac00\ud55c \ub0b4\uc6a9\uc744 \ud655\uc778 \ubc0f \uc815\uc815\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4."],upload_result_cnt:u["\ud30c\uc77c\uc5d0\uc11c \ud655\uc778\ud55c \ucd1d 0\uac74 \uc911 \uc815\uc0c1 0\uac1c, \uc624\ub958 0\uac1c \uc785\ub2c8\ub2e4"],upload_result_table_desc:u["\uc77c\uad04\ub4f1\ub85d \uacb0\uacfc \ud14c\uc774\ube14 \uc124\uba85"],reupload:u["\uc7ac\ub4f1\ub85d"],list_download:u["\ubaa9\ub85d \ub2e4\uc6b4\ub85c\ub4dc"],status:u["\uc0c1\ud0dc"],excel_sheet_name:u["\uc5d1\uc140\uc2dc\ud2b8\uba85"],code:u["\ucf54\ub4dc"],ko_name:u["\ud55c\uae00\uba85"],en_name:u["\uc601\ubb38\uba85"],jp_name:u["\uc77c\ubb38\uba85"],zhcn_name:u["\uc911\ubb38 \uac04\uccb4\uba85"],zhtw_name:u["\uc911\ubb38 \ubc88\uccb4\uba85"],vi_name:u["\ubca0\ud2b8\ub0a8\uc5b4\uba85"],max1000:u["\ud55c\ubc88\uc5d0 \ucd5c\ub300 1,000\uac74\uc758 \uc815\ubcf4\ub97c \uc77c\uad04 \ucd94\uac00\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4."],dept_code:u["\ubd80\uc11c\ucf54\ub4dc"],parent_dept_code:u["\uc0c1\uc704 \ubd80\uc11c"]+u["\ucf54\ub4dc"],order_code:u["\uc815\ub82c\ucf54\ub4dc"],dept_name_ko:u["\ubd80\uc11c\uba85 (\ud55c\uae00)"],dept_name_en:u["\ubd80\uc11c\uba85 (\uc601\ubb38)"],dept_name_jp:u["\ubd80\uc11c\uba85 (\uc77c\ubb38)"],dept_name_zhcn:u["\ubd80\uc11c\uba85 (\uc911\ubb38 \uac04\uccb4)"],dept_name_zhtw:u["\ubd80\uc11c\uba85 (\uc911\ubb38 \ubc88\uccb4)"],dept_name_vi:u["\ubd80\uc11c\uba85 (\ubca0\ud2b8\ub0a8\uc5b4)"],dept_mail_id:u["\ubd80\uc11c\uba54\uc77c\uc544\uc774\ub514"],dept_acronym:u["\ubd80\uc11c\uc57d\uc5b4"],name_ko:u["\uc774\ub984 (\ud55c\uae00)"],name_en:u["\uc774\ub984 (\uc601\ubb38)"],name_jp:u["\uc774\ub984 (\uc77c\ubb38)"],name_zhcn:u["\uc774\ub984 (\uc911\ubb38 \uac04\uccb4)"],name_zhtw:u["\uc774\ub984 (\uc911\ubb38 \ubc88\uccb4)"],name_vi:u["\uc774\ub984 (\ubca0\ud2b8\ub0a8\uc5b4)"],password:u["\ube44\ubc00\ubc88\ud638"],id:u["\uc544\uc774\ub514"],emp_no:u["\uc0ac\ubc88"],mail_group:u["\uba54\uc77c\uadf8\ub8f9"],dept_code:u["\ubd80\uc11c\ucf54\ub4dc"],member_type:u["\uba64\ubc84\ud0c0\uc785"],position:u["\uc9c1\uc704"],grade:u["\uc9c1\uae09"],duty:u["\uc9c1\ucc45"],user_group:u["\uc0ac\uc6a9\uc790\uadf8\ub8f9"],id_alias:u["\uac00\uc0c1 \uba54\uc77c \uc544\uc774\ub514"],dir_phone:u["\uc9c1\ud1b5\uc804\ud654"],mobile:u["\ud734\ub300\ud3f0"],rep_phone:u["\ub300\ud45c\uc804\ud654"],fax:u["\ud329\uc2a4"],address_home:u["\uc8fc\uc18c(\uc9d1)"],homepage:u["\ud648\ud398\uc774\uc9c0"],messenger:u["\uba54\uc2e0\uc800"],birthday:u["\uc0dd\uc77c"],anniversary:u["\uae30\ub150\uc77c"],memo:u["\uba54\ubaa8"],concurrent_dept:u["\uacb8\uc9c1 \ubc0f \uc9c1\ucc45"],manual_sync:u["\ucc44\ub110 \uc989\uc2dc \ub3d9\uae30\ud654"]},c=t.View.extend({id:"batch_upload",tagName:"span",events:{"click #fileComplete .ic_del":"deleteFile","click #upload":"upload","click #reupload":"reupload","click #listDownload":"downloadList","click #checkAll":"checkAll","click a.goToPwSettingLink":"goToPasswordSettingLink"},initialize:function(e){this.subject=e.subject,this.upload_desc=e.upload_desc,this.uploadUrl=e.uploadUrl,this.passwordSettingUrl=e.passwordSettingUrl,this.passwordMenuAccessible=e.passwordMenuAccessible,this.uploadResultUrl=e.uploadResultUrl,this.uploadFailResultUrl=e.uploadFailResultUrl,this.reuploadUrl=e.reuploadUrl,this.downloadListUrl=e.downloadListUrl,this.uploadResultThTmpl=e.uploadResultThTmpl,this.uploadResultTdTmpl=e.uploadResultTdTmpl;var r=new t.Model;r.url=n.contextRoot+"ad/api/systeminfo",r.fetch({async:!1}),this.installLocale=r.toJSON().language,this.orgSyncable=n.config("orgSyncWaitMin")>0,this.$el.on("orgChanged",_.bind(this.handleOrgChanged,this))},render:function(){e.extend(l,{subject:this.subject,upload_desc:this.upload_desc}),this.$el.html(i({lang:l,isMemberType:this.passwordSettingUrl?!0:!1})),this.initResultEl(),this.initFileUpload()},initResultEl:function(){this.$el.find("#resultArea").html(s({lang:l,orgSyncable:this.orgSyncable})),this.$el.find("#uploadResultTh").html(this.uploadResultThTmpl({lang:l,isKoLocale:this.installLocale==="ko",isEnLocale:this.installLocale==="en",isJpLocale:this.installLocale==="ja",isZhcnLocale:this.installLocale==="zhcn",isZhtwLocale:this.installLocale==="zhtw",isViLocale:this.installLocale==="vi"})),this.$el.find("#uploadResultList").html(this.getColspanTmpl(l.max1000)),this.orgSyncButton=new f({description:n.i18n(u["\uc870\uc9c1\uc77c\uad04\ub4f1\ub85d \ub3d9\uae30\ud654 \uc124\uba85"],{term:n.config("orgSyncWaitMin")})}),this.orgSyncButton.setElement(this.$("#manualSync")),this.orgSyncButton.render()},getColspanTmpl:function(e){var t=this.$el.find("#uploadResultTh th").size();return"<tr class='null_data'><td colspan="+t+"><span class='txt'>"+e+"</span></td></tr>"},initFileUpload:function(){var t=this,i={el:"#swfupload-control",context_root:n.contextRoot,button_text:"<span class='buttonText' style='font-family: notosanskr'> "+u["\ud30c\uc77c \ucc3e\uae30"]+"</span>",button_style:"cursor:pointer;font-size:12px;text-align: center;vertical-align: middle;",accept:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",progressBarUse:!0,progressEl:"#progressBarWrap",url:"ad/api/file?GOAdminSSOcookie="+e.cookie("GOAdminSSOcookie")};(new a(i)).queue(function(e,t){}).start(function(r,i){var s=new RegExp("(.xls|.xlsx)","gi"),u=i.type.toLowerCase();if(!s.test(u))return e.goAlert(n.i18n(o["{{extension}} \ud30c\uc77c\ub9cc \ub4f1\ub85d \uac00\ub2a5\ud569\ub2c8\ub2e4."],{extension:"excel"})),t.$el.find("#progressbar").hide(),!1}).progress(function(e,t){}).success(function(i,s,u){if(n.util.fileUploadErrorCheck(s))return e.goAlert(n.util.serverMessage(s)),!1;var a=s.data;a.fileSize=n.util.getHumanizedFileSize(a.fileSize),a.deleteTxt=o["\uc0ad\uc81c"],t.$el.find("#fileComplete").html(r({data:a})),t.initResultEl()}).complete(function(e,t){}).error(function(e,t){})},getBatchUploadFailResults:function(){var t={};return e.ajax({url:n.contextRoot+this.uploadFailResultUrl,type:"GET",async:!1,success:function(e){t=e.data}}),t},renderBatchUploadResult:function(){var t=this,n=this.$el.find("#batchUploadResultTable");n.find("#uploadResultList").empty();var r=this.getBatchUploadFailResults();e.each(r,function(e,r){_.extend(r,{errorText:o["\uc624\ub958"]}),r.codeType&&(r.sheetName=t.convertTypeToSheetName(r.codeType)),n.append(t.uploadResultTdTmpl({data:r}))})},deleteFile:function(){this.$el.find("#fileComplete").empty()},convertTypeToSheetName:function(e){switch(e){case"POSITION":return u["\uc9c1\uc704"];case"GRADE":return u["\uc9c1\uae09"];case"DUTY":return u["\uc9c1\ucc45"];case"USERGROUP":return u["\uc0ac\uc6a9\uc790\uadf8\ub8f9"]}},reupload:function(){var t=this,r=this.$el.find("#uploadResultList tr").not("[class*='error']"),i=[];e.each(r,function(t,n){var r={},s=e(n).closest("tr").find("input[type='text']");e.each(s,function(t,n){var i={};i[n.name]=e(n).data("type")?e(n).data("type"):n.value,_.extend(r,i)}),i.push(r)}),e.ajax({url:n.contextRoot+this.reuploadUrl,type:"POST",contentType:"application/json",data:JSON.stringify(i),success:function(e){t.getUploadStatus()}})},upload:function(){this.preloader=e.goPreloader(),this.preloader.render();var t=this,r=n.contextRoot+this.uploadUrl,i={fileName:this.$el.find("#file_name").val(),filePath:this.$el.find("#file_path").val(),hostId:this.$el.find("#host_id").val(),fileExt:this.$el.find("#file_ext").val()};if(i.fileName==undefined||i.filePath==undefined){e.goError(u["\uc77c\uad04\ub4f1\ub85d \ud30c\uc77c \uc120\ud0dd"]),this.preloader.$el.hide();return}e.go(r,JSON.stringify(i),{qryType:"POST",timeout:0,contentType:"application/json",responseFn:function(e){t.getUploadStatus()},error:function(n){e.goError(n.responseJSON?n.responseJSON.message:o["\uc5c5\ub85c\ub4dc\uc5d0 \uc2e4\ud328\ud558\uc600\uc2b5\ub2c8\ub2e4."]),t.preloader.release()}})},getUploadStatus:function(){var t=this;e.ajax({url:n.contextRoot+this.uploadResultUrl,dataType:"json",timeout:3e4,success:function(e){t.preloader.release(),t.changeUIWithUploadStatus(e.data)},error:function(){e.goAlert(o["\uc5c5\ub85c\ub4dc\uc5d0 \uc2e4\ud328\ud558\uc600\uc2b5\ub2c8\ub2e4."]),t.preloader.release()}})},changeUIWithUploadStatus:function(t){var r=this,i={boxImage:n.contextRoot+"resources/images/progressbar.gif",barImage:n.contextRoot+"resources/images/progressbg_green_200.gif",width:200,max:100},s=t.jobStatus,o=t.size,a=t.successCount,f=t.failCount,c=a+f;s=="DONE"?(this.$("#manualSync").toggle(a>0),this.$el.trigger("orgChanged"),e("#progressbar").hide(),e("#progressbar").progressBar(0,i),e("#upload").show(),e("#swfupload-control").show(),this.initFileUpload(),e("div.file_upload_result .desc").hide(),f>0?(e("div.file_upload_result .info_type1").show(),e("#resultTotal").text(c),e("#successCnt").text(a),e("#failCnt").text(f),e("#reupload").show(),e("#listDownload").hide(),e("div.file_upload_result p.tit").empty().append(n.i18n(l.upload_result_cnt,{totalCnt:c,successCnt:a,failCnt:f})),this.renderBatchUploadResult()):(e("div.file_upload_result .info_type1").hide(),e("#reupload").hide(),e("#listDownload").show(),e("#batchUploadResultTable tbody").empty().html(this.getColspanTmpl(u["\ud30c\uc77c\uc758 \ubaa8\ub4e0 \uc815\ubcf4\uac00 \uc815\uc0c1\uc801\uc73c\ub85c \uc77c\uad04\ub4f1\ub85d\ub418\uc5c8\uc2b5\ub2c8\ub2e4."])))):s=="WAIT"?this.initFileUpload():s=="DOING"?(e("#upload").hide(),e("#item_file").remove(),e("#swfupload-control").hide(),e("#progressbar").show(),e("#progressbar").progressBar(c/o*100,i),window.setTimeout(function(){r.getUploadStatus()},1500)):s=="PREPARE"?(e("#upload").hide(),e("#item_file").remove(),e("#swfupload-control").hide(),e("#progressbar").show(),e("#progress_content").empty(),window.setTimeout(function(){r.getUploadStatus()},1500)):(this.initFileUpload(),e("#progressbar").hide(),e("#upload").show(),e("#swfupload-control").show())},downloadList:function(){window.location.href=n.contextRoot+this.downloadListUrl},goToPasswordSettingLink:function(){var t=this,r=u["\ud574\ub2f9 \ud654\uba74\uc73c\ub85c \uc774\ub3d9\ud558\uae30 \uc704\ud55c \uad8c\ud55c\uc774 \uc5c6\uc2b5\ub2c8\ub2e4."],i=[];this.passwordMenuAccessible&&(r=n.i18n(u["\uba54\ub274\ub85c \uc774\ub3d9\ud558\uc2dc\uaca0\uc2b5\ub2c8\uae4c"],{menuName:u["\ube44\ubc00\ubc88\ud638"]}),i=[{btext:o["\ud655\uc778"],btype:"confirm",autoclose:!0,callback:function(){n.router.navigate(t.passwordSettingUrl,!0)}},{btext:o["\ucde8\uc18c"]}]),e.goPopup({width:600,title:"",pclass:"layer_confim",contents:"<p class='q'>"+r+"</p>",buttons:i})},handleOrgChanged:function(){this.orgSyncButton.disable()}});return c});