(function(){define(["backbone","i18n!nls/commons","i18n!admin/nls/admin","i18n!works/nls/works","hgn!admin/templates/works/applets_stats","admin/models/applets_stats","collections/paginated_collection","grid"],function(e,t,n,r,i,s,o,u){var a={count:t["\uac1c"],title:t["\uc81c\ubaa9"],"\uc6b4\uc601\uc790":n["\uc6b4\uc601\uc790"],"\uc0dd\uc131\uc77c":n["\uc0dd\uc131\uc77c"],"\ub370\uc774\ud130 \ub4f1\ub85d \uc218":r["\ub370\uc774\ud130 \ub4f1\ub85d \uc218"],"\uc0dd\uc131\uc790":r["\uc0dd\uc131\uc790"],"\uc571\uba85":r["\uc571\uba85"],"\ucd1d \uc571 \uac1c\uc218":r["\ucd1d \uc571 \uac1c\uc218"],"\ucd1d \ub370\uc774\ud130 \uc218":r["\ucd1d \ub370\uc774\ud130 \uc218"]},f=o.extend({url:function(){return GO.contextRoot+"ad/api/works/applets?"+this.makeParam()},csvUrl:function(){return GO.contextRoot+"ad/api/works/applets/download?"+this.makeParam()}}),l=e.View.extend({events:{"click #search":"search","click #download":"download","click .wrap_action":"onClickedWrapAction"},initialize:function(e){this.stats=new s,this.stats.fetch({async:!1}),this.collection=new f},render:function(){return this.$el.html(i({lang:a,stats:this.stats.toJSON(),totalAppletCount:GO.util.numberWithCommas(this.stats.totalAppletCount()),totalDocCount:GO.util.numberWithCommas(this.stats.totalDocCount())})),this.renderList(),this.renderButton(),this},renderList:function(){this.listView=new u({tableClass:"chart size",useToolbar:!0,checkbox:!1,collection:this.collection,isAdmin:!0,columns:[{name:"name",className:"sorting title",label:r["\uc571\uba85"],sortable:!0,render:function(e){return'<a><span data-id="'+e.get("id")+'">'+e.get("appletName")+"</span></a>"}},{name:"docCount",className:"sorting_disable part",label:r["\ub370\uc774\ud130 \ub4f1\ub85d \uc218"],sortable:!1,render:function(e){return GO.util.numberWithCommas(e.get("docCount"))}},{name:"createdBy",className:"sorting state",label:r["\uc0dd\uc131\uc790"],sortable:!0,render:function(e){return e.get("createdBy")?e.get("createdBy").name+" "+e.get("createdBy").position:"-"}},{name:"admins",className:"sorting_disable state",label:n["\uc6b4\uc601\uc790"],sortable:!1,render:function(e){return e.get("adminInfo")}},{name:"createdAt",className:"sorting last date",label:n["\uc0dd\uc131\uc77c"],sortable:!0,render:function(e){return GO.util.shortDate(e.get("createdAt"))}}],searchOptions:[{value:"name",label:r["\uc571\uba85"]},{value:"createdBy",label:r["\uc0dd\uc131\uc790"]},{value:"admins",label:n["\uc6b4\uc601\uc790"]}]}),this.$("#appletList").html(this.listView.render().el),this.collection.fetch(),this.listView.$el.on("navigate:grid",$.proxy(function(e,t){GO.router.navigate("works/applets/"+t,!0)},this))},renderButton:function(){this.$("div.tool_bar").first().removeClass("toolbar").addClass("toolbar_top header_tb"),this.$("div.custom_header").append('<span class="btn_tool" id="download">'+n["\ubaa9\ub85d \ub2e4\uc6b4\ub85c\ub4dc"]+"</span>")},enterEventHandler:function(e){e.which==13&&this.search()},search:function(){var e=this.$("#searchKeyword").val();if(!e){$.goMessage(t["\uac80\uc0c9\uc5b4\ub97c \uc785\ub825\ud574\uc8fc\uc138\uc694."]);return}this.listOption.keywordType=this.$("#searchType").val(),this.listOption.keyword=this.$("#searchKeyword").val(),this.dataTable.tables.fnSettings().sAjaxSource=this.getSearchUrl(),this.dataTable.tables.fnClearTable()},getSearchUrl:function(){return GO.contextRoot+"ad/api/works/applets?"+$.param(this.listOption)},download:function(){console.log("download"),window.location.href=this.collection.csvUrl()},onClickedWrapAction:function(){this.$el.find(".wrap_action").toggle(),this.$el.find(".info_summary li").not(".first").toggle()}});return l})}).call(this);