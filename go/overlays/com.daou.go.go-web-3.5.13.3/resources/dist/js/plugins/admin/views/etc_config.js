(function(){define(["jquery","backbone","app","admin/collections/etc_config","hgn!admin/templates/etc_config","hgn!admin/templates/ci_upload","i18n!nls/commons","i18n!admin/nls/admin","file_upload","jquery.go-validation","jquery.go-popup","jquery.go-sdk"],function(e,t,n,r,i,s,o,u,a){var f={label_save:o["\ud655\uc778"],label_sucess:o["\uc800\uc7a5\ub418\uc5c8\uc2b5\ub2c8\ub2e4."],label_fail:o["\uc2e4\ud328"],label_failDesc:o["\uc2e4\ud328\ud588\uc2b5\ub2c8\ub2e4."],label_edit:o["\uc218\uc815"],label_ok:o["\uc800\uc7a5"],label_cancel:o["\ucde8\uc18c"],label_config:u["\uae30\ubcf8 \uc124\uc815"],label_use:u["\uc0ac\uc6a9\ud568"],label_notuse:o["\uc0ac\uc6a9\ud558\uc9c0 \uc54a\uc74c"],label_month:u["\uac1c\uc6d4"],label_menu_url:u["\uba54\ub274 URL \uc8fc\uc18c"],label_location:u["\ud398\uc774\uc9c0 \uc774\ub3d9"],label_setting:o["\uc124\uc815"],label_display:u["\ud654\uba74 \uafb8\ubbf8\uae30"],label_logo:u["\ub85c\uace0 \uc124\uc815"],label_upload:o["\uc0ac\uc9c4 \uc62c\ub9ac\uae30"],label_desc_img:u["\ub85c\uace0 \ub3c4\uc6c0\ub9d0"],label_skin:u["\uc2a4\ud0a8 \uc120\ud0dd"],label_user:u["\uc0ac\uc6a9\uc790\uac00 \uc9c1\uc811 \uc120\ud0dd"],label_admin:u["\uad00\ub9ac\uc790\uac00 \uc120\ud0dd (\uc0ac\uc6a9\uc790 \ubcc0\uacbd \ubd88\uac00\ub2a5)"],label_web_title:u["\uc6f9 \ud0c0\uc774\ud2c0"],label_web_copy:u["\uc6f9 \uc800\uc791\uad8c"],label_mobile_title:u["\ubaa8\ubc14\uc77c \ud0c0\uc774\ud2c0"],label_mobile_copy:u["\ubaa8\ubc14\uc77c \uc800\uc791\uad8c"],label_noti_config:u["\uc54c\ub9bc \uc124\uc815"],label_noti_base:u["\uc54c\ub9bc \uae30\ubcf8 \uc124\uc815"],label_perior:u["\uc54c\ub9bc \uc800\uc7a5 \uae30\uac04"],label_button:u["\ud30c\uc77c \ucc3e\uae30"],label_validate:u["0\uc790\uc774\uc0c1 0\uc774\ud558 \uc785\ub825\ud574\uc57c\ud569\ub2c8\ub2e4."],label_close:o["\ub2eb\uae30"],label_block_pwd_change:u["\uc0ac\uc6a9\uc790 \ube44\ubc00\ubc88\ud638 \ubcc0\uacbd \uac10\ucd94\uae30"],label_confirm:o["\ud5c8\uc6a9"],label_unconfirm:o["\ud5c8\uc6a9\ud558\uc9c0 \uc54a\uc74c"],label_style:u["\uae30\ubcf8 \uc2a4\ud0a8 \uc120\ud0dd"],label_login:u["\ub85c\uadf8\uc778 \uc774\ubbf8\uc9c0"],label_mobile:u["\ubaa8\ubc14\uc77c\uc6f9 \ub85c\uadf8\uc778 \uc774\ubbf8\uc9c0"],label_favicon:u["\ud30c\ube44\ucf58"],label_login_desc:n.i18n(u["0 \ud30c\uc77c\ub85c 0x0 \uc0ac\uc774\uc988\ub85c \ub4f1\ub85d\ud558\uc138\uc694."],{arg1:"png",arg2:300,arg3:150}),label_mobile_desc:n.i18n(u["0 \ud30c\uc77c\ub85c 0x0 \uc0ac\uc774\uc988\ub85c \ub4f1\ub85d\ud558\uc138\uc694."],{arg1:"png",arg2:80,arg3:80}),label_favicon_desc:n.i18n(u["0 \ud30c\uc77c\ub85c 0x0 \uc0ac\uc774\uc988\ub85c \ub4f1\ub85d\ud558\uc138\uc694."],{arg1:"ico",arg2:16,arg3:16}),label_classic_desc:n.i18n(u["0x0 \uc0ac\uc774\uc988"],{arg1:200,arg2:40}),label_advanced_desc:n.i18n(u["0x(0~0) \uc0ac\uc774\uc988"],{arg1:150,arg2:36,arg3:100}),label_favicon_preview:u["\ud30c\ube44\ucf58\ubbf8\ub9ac\ubcf4\uae30\uc124\uba85"],"\ud68c\uc0c9 \ub85c\uace0 \uad8c\uc7a5":u["\ud68c\uc0c9 \ub85c\uace0 \uad8c\uc7a5"],"\ud770\uc0c9 \ub85c\uace0 \uad8c\uc7a5":u["\ud770\uc0c9 \ub85c\uace0 \uad8c\uc7a5"],"\uc124\uc815\ub41c \ud14c\ub9c8\uc5d0 \ub530\ub77c, \uc704\uc758 \ub85c\uace0\ub97c \ud45c\uc2dc\ud569\ub2c8\ub2e4":u["\uc124\uc815\ub41c \ud14c\ub9c8\uc5d0 \ub530\ub77c, \uc704\uc758 \ub85c\uace0\ub97c \ud45c\uc2dc\ud569\ub2c8\ub2e4."],"\uba54\ub274 \ud14c\ub9c8 \uc124\uc815":o["\uba54\ub274 \ud14c\ub9c8 \uc124\uc815"],"\uc0ad\uc81c":o["\uc0ad\uc81c"]},l=n.BaseView.extend({el:"#layoutContent",initialize:function(){this.collection=r.getCollection(),this.unbindEvent(),this.bindEvent()},unbindEvent:function(){this.$el.off("click","span#btn_ok"),this.$el.off("click","span#btn_cancel"),this.$el.off("click","span.btn_edit_logo"),this.$el.off("click","span#delete_logo"),this.$el.off("click","span.btn_box[data-btntype='changeform']"),this.$el.off("click","span#data"),this.$el.off("click","span.ic_classic"),this.$el.off("submit","form")},bindEvent:function(){this.$el.on("click","span#btn_ok",e.proxy(this.etcConfigSave,this)),this.$el.on("click","span#btn_cancel",e.proxy(this.etcConfigCancel,this)),this.$el.on("click","span.btn_edit_logo",e.proxy(this.uploadCI,this)),this.$el.on("click","span#delete_logo",e.proxy(this.deleteCI,this)),this.$el.on("click","span.btn_box[data-btntype='changeform']",e.proxy(this.changeModifyForm,this)),this.$el.on("click","span#data",e.proxy(this.changeModifyForm,this)),this.$el.on("click","span.ic_classic",e.proxy(this.deleteFile,this)),this.$el.on("submit","form",e.proxy(this.formSubmit,this))},formSubmit:function(e){e.preventDefault();return},deleteFile:function(){e("#fileComplete").html("<input type='hidden' value='true' id='favicon-data-delete'/>")},initFileUpload:function(t,n,r,i){var s=this,f={el:t,context_root:GO.contextRoot,button_text:"<span class='buttonText'>"+n+"</span>",button_style:"text-align:center;font-weight:bold",button_width:75,button_height:20,progressBarUse:!1,multiple:!1,accept:"image/*",url:"ad/api/file/logo?GOAdminSSOcookie="+e.cookie("GOAdminSSOcookie")};(new a(f)).queue(function(e,t){}).start(function(e,t){}).progress(function(e,t){}).success(function(t,n,a){if(GO.util.fileUploadErrorCheck(n))return e.goMessage(GO.util.serverMessage(n)),!1;var f=n.data,l=f.fileName,c=f.filePath,h=f.thumbnail,p=f.fileExt.toLowerCase(),d=f.hostId,v=i=="favicon_thumnail_image"?new RegExp("(ico)","gi"):new RegExp("(jpeg|jpg|gif|png|bmp)","gi"),m=v.test(p),g=80,y=80;i=="login_thumnail_image"?(g=300,y=150):i=="favicon_thumnail_image"?(g=16,y=16):i=="thumnail_image"&&(g=190,y=40),m?r?(e(".logo_img").find("img").attr("src",h),e(".logo_img").find("img").attr("data-tempname",c),e(".logo_img").find("img").attr("data-name",l),e(".logo_img").find("img").attr("data-hostid",d),e(".logo_img").find("img").attr("data-delete",!1)):(templete=["<p>",u["\ubbf8\ub9ac\ubcf4\uae30"],"</p>",'<form name="formCI">','<div class="content"> <div class="upload_action logo_img">','<img src="',h,'"/>',"</div></div>",'<div class="btn_file btn_minor_s" id="swfupload-control2"></div>',"</form>"].join(""),e("#pre_upload").remove(),e("#upload").append(templete),e(".logo_img").find("img").attr("data-tempname",c),e(".logo_img").find("img").attr("data-name",l),e(".logo_img").find("img").attr("data-hostid",d),e(".logo_img").find("img").attr("data-delete",!1),s.initFileUpload("#swfupload-control2",o["\ud30c\uc77c \ucca8\ubd80"],!0,i)):i=="favicon_thumnail_image"?e.goMessage(u["ico\ud3ec\ub9f7\uacbd\uace0"]):e.goMessage(o["\ud3ec\uba67 \uacbd\uace0"])}).complete(function(e,t){console.info(t)}).error(function(e,t){console.info(t)})},initFileUploadForFavicon:function(t,n,r){var i=u["\ud30c\uc77c \ucc3e\uae30"],s={el:"#swfupload-control_favicon",context_root:GO.contextRoot,button_text:"<span class='buttonText'>"+i+"</span>",progressBarUse:!0,multiple:!1,accept:".ico",url:"ad/api/file/logo?GOAdminSSOcookie="+e.cookie("GOAdminSSOcookie")};(new a(s)).queue(function(e,t){}).start(function(t,n){var r=new RegExp("(.ico)","gi"),i=n.type.toLowerCase();if(!r.test(i))return e.goMessage(u["ico\ud3ec\ub9f7\uacbd\uace0"]),e("#progressbar").hide(),!1}).progress(function(e,t){}).success(function(t,n,r){e("#fileComplete").children().remove();if(GO.util.fileUploadErrorCheck(n))return e.goAlert(GO.util.serverMessage(n)),!1;var i=n.data,s=i.fileName,o=i.filePath,u=i.hostId,a=GO.util.getHumanizedFileSize(i.fileSize),f="<li id='item_file'><span class='item_file'><span class='ic_file ic_def'></span><span class='name'>"+s+"</span>"+"<span class='size'>("+a+")</span>"+"<span class='btn_wrap' title='\uc0ad\uc81c'>"+"<span class='ic_classic ic_del'></span>"+"</span>"+"</span>"+"<input type='hidden' value='"+o+"' id='file_path'/>"+"<input type='hidden' value='"+s+"' id='file_name'/>"+"<input type='hidden' value='"+u+"' id='host_id'/>"+"</li>";e("#fileComplete").html(f)}).complete(function(e,t){console.info(t)}).error(function(e,t){console.info(t)})},deleteCI:function(t){var n=e(t.currentTarget).attr("data-target-id"),r=e(t.currentTarget).attr("data-basic-src"),i=e("#"+n);i.attr("src",r).removeAttr("data-tempname").removeAttr("data-name").attr("data-delete",!0)},uploadCI:function(t){var n=e(t.currentTarget).siblings().attr("id"),r=n=="favicon_thumnail_image"?u["\ud30c\ube44\ucf58 \ud3ec\ub9f7"]:u["\uc774\ubbf8\uc9c0\ud3ec\uba67"],i={label_text:u["\uc774\ubbf8\uc9c0 \ud30c\uc77c \uc120\ud0dd"],label_desc:r,label_button:u["\ud30c\uc77c \ucc3e\uae30"]},o=s({lang:i}),a=e.goPopup({targetEl:".admin_body",header:u["\uc774\ubbf8\uc9c0 \ub4f1\ub85d"],modal:!0,buttons:[{btext:f.label_save,btype:"confirm",autoclose:!0,callback:function(){var t=a,r=t.find(".logo_img").find("img").attr("src"),i=t.find(".logo_img").find("img").attr("data-tempname"),s=t.find(".logo_img").find("img").attr("data-name");hostId=t.find(".logo_img").find("img").attr("data-hostid");var o=e("#"+n);o.attr("src",r).attr("data-tempname",i).attr("data-name",s).attr("data-hostid",hostId).attr("data-delete",!1)}},{btext:f.label_cancel}]});a.find(".content").append(o),this.initFileUpload("#swfupload-control",u["\ud30c\uc77c \ucc3e\uae30"],!1,n)},changeModifyForm:function(t){var r=e(t.currentTarget).parent();if(r&&r.attr("data-formname")){e(t.currentTarget).hide(),r.html(['<input type="input" name="',r.attr("data-formname"),'" class="input w_medium" value="',r.attr("data-value"),'" />'].join("")).find("input").focusin();var i=r.parent().find("#webTitleValidate");r.find("input").keyup(function(t){e.goValidation.isCheckLength(1,32,e(t.currentTarget).val())?i.empty():i.html(n.i18n(f.label_validate,{arg1:"1",arg2:"32"}))})}},render:function(){var t=this;this.$el.empty();var n=this.collection.toJSON(),r=n[0].displayConfigModel,s=n[0].notiConfigModel,o=i({lang:f,selectTime:[{value:"1"},{value:"2"},{value:"3"},{value:"4"},{value:"5"},{value:"6"}],selectStyle:[{value:"basic",name:u["\uae30\ubcf8"]},{value:"blue",name:"BLUE"},{value:"orange",name:"ORANGE"},{value:"red",name:"RED"},{value:"yellow",name:"YELLOW"},{value:"green",name:"GREEN"}],dataset:n});return this.$el.html(o),t.$el.find("#storagePerior").val(s.storagePerior),t.$el.find("#style").val(r.style),e('input[name="skin"][value="'+r.skin+'"]').attr("checked",!0),e('input[name="theme"][value="'+r.theme+'"]').attr("checked",!0),e('input[name="welcomeScreen"][value="'+r.welcomeScreen+'"]').attr("checked",!0),e('input[name="blockPasswordChange"][value="'+r.blockPasswordChange+'"]').attr("checked",!0),this.initFileUploadForFavicon("#swfupload-control_favicon",u["\ud30c\uc77c \ucc3e\uae30"],!1),this.$el},etcConfigSave:function(){var i=this,s=this.$el.find('form[name="formBaseConfig"]'),o=e("#login_thumnail_image"),u=e("#mobile_thumnail_image"),a=e("#thumnail_image"),l=e("#thumnail_image_advanced"),c=!0;i.model=new t.Model,i.model.url=GO.contextRoot+"ad/api/etcconfig",i.model.set("webTitle",i.collection.models[0].get("displayConfigModel").webTitle,{silent:!0}),e.each(s.serializeArray(),function(t,r){if(r.name=="webTitle"&&!e.goValidation.isCheckLength(1,32,r.value))return c=!1,e("#webTitle").focus(),this.$el.find("#webTitleValidate").html(n.i18n(f.label_validate,{arg1:"1",arg2:"32"})),!1;i.model.set(r.name,r.value,{silent:!0})}),i.model.set("useNoti",!0,{silent:!0}),i.model.set({loginTmpName:o.attr("data-tempname"),loginOriginalName:o.attr("data-name"),loginHostId:o.attr("data-hostid"),loginDeleteFlag:o.attr("data-delete")}),i.model.set({mobileTmpName:u.attr("data-tempname"),mobileOriginalName:u.attr("data-name"),mobileHostId:u.attr("data-hostid"),mobileDeleteFlag:u.attr("data-delete")}),i.model.set({tmpName:a.attr("data-tempname"),originalName:a.attr("data-name"),hostId:a.attr("data-hostid"),deleteFlag:a.attr("data-delete")}),i.model.set({advancedTmpName:l.attr("data-tempname"),advancedOriginalName:l.attr("data-name"),advancedHostId:l.attr("data-hostid"),advancedDeleteFlag:l.attr("data-delete")}),i.model.set({faviconTmpName:e("#file_path").val(),faviconOriginalName:e("#file_name").val(),faviconHostId:e("#host_id").val(),faviconDeleteFlag:e("#favicon-data-delete").val()});if(!c)return!1;i.model.save({},{success:function(t,n){n.code=="200"&&(e.goMessage(f.label_sucess),i.collection=r.getCollection(),i.render())},error:function(e,t){i._errorFunction(t)}})},_errorFunction:function(t){var n=this,r=JSON.parse(t.responseText),i=r.message,s=r.name,o=s.split("."),u=o[o.length-1];r!=null?u=="webtitle"?n._errorMessage("webTitle",i):e.goAlert(f.label_fail,r.message):e.goMessage(f.label_failDesc)},_errorMessage:function(t,n){e("#"+t).focus(),e.goAlert(f.label_fail,n)},etcConfigCancel:function(){var t=this;e.goCaution(f.label_cancel,o["\ubcc0\uacbd\ud55c \ub0b4\uc6a9\uc744 \ucde8\uc18c\ud569\ub2c8\ub2e4."],function(){t.render(),e.goMessage(o["\ucde8\uc18c\ub418\uc5c8\uc2b5\ub2c8\ub2e4."])},f.label_save)}},{__instance__:null});return l})}).call(this);