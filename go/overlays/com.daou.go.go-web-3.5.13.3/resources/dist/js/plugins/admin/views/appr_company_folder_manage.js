define(["jquery","underscore","backbone","app","approval/views/apprform/admin_company_folder_tree","views/circle","admin/models/appr_company_folder_manage","hgn!admin/templates/appr_company_folder_manage","hgn!admin/templates/appr_company_folder_manage_form","hgn!approval/templates/add_org_member","i18n!nls/commons","i18n!admin/nls/admin","jquery.go-popup","jquery.go-orgslide","jquery.go-validation"],function(e,t,n,r,i,s,o,u,a,f,l,c){var h={head_title:c["\uacb0\uc7ac \uc591\uc2dd \uad00\ub9ac"],appr_form_folder_list:c["\uacb0\uc7ac\uc591\uc2dd \ud3f4\ub354 \ubaa9\ub85d"],folder_name:c["\ud3f4\ub354\uba85"],folder_add:c["\ud3f4\ub354 \ucd94\uac00"],folder_delete:l["\uc0ad\uc81c"],selected_folder:c["\uc120\ud0dd\ub41c \ud3f4\ub354"],form_add:c["\uc591\uc2dd \ucd94\uac00"],form_delete:c["\uc591\uc2dd \uc0ad\uc81c"],reorder:c["\uc21c\uc11c\ubc14\uafb8\uae30"],reorder_done:c["\uc21c\uc11c\ubc14\uafb8\uae30 \uc644\ub8cc"],folder_delete_message:c["\ud3f4\ub354 \uc0ad\uc81c"],folder_delete_confirm:c["\ud3f4\ub354\ub97c \uc0ad\uc81c\ud558\uc2dc\uaca0\uc2b5\ub2c8\uae4c?"],null_data:c["\ub4f1\ub85d\ub41c \uacb0\uc7ac \uc591\uc2dd\uc774 \uc5c6\uc2b5\ub2c8\ub2e4."],select_folder:c["\ud3f4\ub354\ub97c \uc120\ud0dd\ud574 \uc8fc\uc2ed\uc2dc\uc624."],cannot_update:c["\ucd5c\uc0c1\uc704 \ud3f4\ub354\ub97c \uc218\uc815\ud560 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4."],hidden:c["\uc228\uae40"],normal:c["\uc815\uc0c1"],cannot_delete_root:l["\ucd5c\uc0c1\uc704 \ud3f4\ub354\ub294 \uc0ad\uc81c\ud560 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4."],cannot_delete:c["\uc0ad\uc81c\ud560 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4."],cannot_delete_parent:c["\uc591\uc2dd\uc774 \uc788\uac70\ub098 \ud558\uc704 \ud3f4\ub354\uac00 \uc788\ub294 \uacbd\uc6b0\ub294 \uc0ad\uc81c\ud560 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4."],cannot_change_hidden:c["\ud558\uc704\ud3f4\ub354\uac00 \uc788\ub294\uacbd\uc6b0 \uc228\uae40\ucc98\ub9ac\ub97c \ud560 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4."],cannot_create_under_hidden:c["\uc228\uae40\ucc98\ub9ac\ub41c \ud3f4\ub354\ub294 \ud558\uc704\ud3f4\ub354\ub97c \uc0dd\uc131\ud560 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4."],save_success:l["\uc800\uc7a5\ub418\uc5c8\uc2b5\ub2c8\ub2e4."],already_used_name:c["\uc774\ubbf8 \uc0ac\uc6a9\uc911\uc778 \uc774\ub984\uc785\ub2c8\ub2e4."],name_required:c["\uc81c\ubaa9\uc744 \uc785\ub825\ud558\uc138\uc694."],alias_required:c["\uc591\uc2dd\uc57d\uc5b4\ub97c \uc785\ub825\ud558\uc138\uc694."],name_invalid_length:c["\uc81c\ubaa9\uc740 20\uc790\uae4c\uc9c0 \uc785\ub825\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4."],name_invalid_character:c["\uc720\ud6a8\ud558\uc9c0 \uc54a\uc740 \ubb38\uc790\uc5f4 \uc785\ub2c8\ub2e4."],"\ucde8\uc18c":l["\ucde8\uc18c"],state:c["\uc0ac\uc6a9\uc5ec\ubd80"],name_required:c["\uc774\ub984\uc744 \uc785\ub825\ud558\uc138\uc694."],"\ubb38\uc11c\ud568 \uc0c1\uc138\uc815\ubcf4":c["\ubb38\uc11c\ud568 \uc0c1\uc138\uc815\ubcf4"],"\ucd94\uac00":l["\ucd94\uac00"],"\uc0ad\uc81c":l["\uc0ad\uc81c"],"\uc804\uc0ac \ubb38\uc11c\ud568 \ud3f4\ub354 \ucd94\uac00":c["\uc804\uc0ac \ubb38\uc11c\ud568 \ud3f4\ub354 \ucd94\uac00"],"\ubb38\uc11c\ud568 \uc774\ub984":c["\ubb38\uc11c\ud568 \uc774\ub984"],"\ubb38\uc11c\ud568 \uba85":c["\ubb38\uc11c\ud568 \uba85"],"\ubb38\uc11c\ud568 \uc124\uba85":c["\ubb38\uc11c\ud568 \uc124\uba85"],"\uc811\uadfc \uad8c\ud55c":c["\uc811\uadfc \uad8c\ud55c"],"\uc804\uccb4 \uc0ac\uc6a9\uc790":c["\uc804\uccb4 \uc0ac\uc6a9\uc790"],"\uc77c\ubd80 \uc0ac\uc6a9\uc790":c["\uc77c\ubd80 \uc0ac\uc6a9\uc790"],"\uc800\uc7a5":l["\uc800\uc7a5"],"\ucde8\uc18c":l["\ucde8\uc18c"]},p=n.View.extend({el:"#layoutContent",treeView:null,folderUserView:null,initialize:function(){},delegateEvents:function(t){this.undelegateEvents(),n.View.prototype.delegateEvents.call(this,t),this.$el.on("click.companyFolder","span.btn_add",e.proxy(this.folderAdd,this)),this.$el.on("click.companyFolder","span.btn_delete",e.proxy(this.folderDelete,this)),this.$el.on("click.companyFolder","span#companyFolerSave",e.proxy(this.saveManage,this)),this.$el.on("click.companyFolder","span#companyFolerCancel",e.proxy(this.cancel,this)),this.$el.on("click.companyFolder","input[name=folderUserScope]",e.proxy(this._onFolderUserScopeChanged,this))},undelegateEvents:function(){return n.View.prototype.undelegateEvents.call(this),this.$el.off(".companyFolder"),this},renderDetailForm:function(t){if(t){this.model=new o,this.model.set("id",t),this.model.fetch({async:!1,statusCode:{403:function(){r.util.error("403")},404:function(){r.util.error("404",{msgCode:"400-common"})},500:function(){r.util.error("500")}}});var n=this.model.toJSON();this.$el.find(".tb_wrap").html(a({data:n,lang:h}))}else this.$el.find(".tb_wrap").html(a({lang:h}));this.model.get("root")&&e(this.el).find("#tb_admin_doc_folder input[data-name=name]").attr("readonly",!0),this.model.get("state")=="NORMAL"?this.$el.find(':radio[name="state"]:radio[value="NORMAL"]').attr("checked",!0):this.model.get("state")=="HIDDEN"&&this.$el.find(':radio[name="state"]:radio[value="HIDDEN"]').attr("checked",!0),this._renderFolderUserView()},_renderFolderUserView:function(){var e=["user","position","grade","usergroup"];r.util.isUseOrgService(!0)&&(e=["user","department","position","grade","duty","usergroup"]),this.folderUserView=new s({selector:"#folderUser",isAdmin:!0,circleJSON:this.model.get("folderUser"),nodeTypes:e}),this.folderUserView.render(),this.model.get("folderUserScope")=="ALL"?this.$el.find(':radio[name="folderUserScope"]:radio[value="ALL"]').attr("checked",!0):this.model.get("folderUserScope")=="SPECIFIC"&&this.$el.find(':radio[name="folderUserScope"]:radio[value="SPECIFIC"]').attr("checked",!0),this.model.get("folderUserScope")=="ALL"?this.folderUserView.hide():this.folderUserView.show()},render:function(){var t=this;this.$el.html(u({lang:h})),this.treeView=new i({isAdmin:!0,treeElementId:"orgTree",selectCallback:e.proxy(function(e){this.renderDetailForm(e.id)},this)}),this.treeView.render()},folderAdd:function(){if(!this.validBeforeFolderCreate())return!1;this.treeView.renderNewFolderInput(h.folder_name)},folderDelete:function(){this.treeView.deleteSelectedFolder()},validBeforeFolderCreate:function(){return this.model.get("state")=="HIDDEN"?(e.goError(h.cannot_create_under_hidden),!1):!0},_onFolderUserScopeChanged:function(t){var n=e(t.currentTarget).val();n=="SPECIFIC"?this.folderUserView.show():(this.folderUserView.hide(),this.model.set("folderUser",{}))},validBeforeSaveManage:function(){var t=e(this.el).find("#tb_admin_doc_folder input[data-name=name]").val(),n=e(this.el).find("#tb_admin_doc_folder input[name=state]:checked").val(),r=this.treeView._checkUniqueTextOnRename(t);return r?!0:(e.goError(h.already_used_name),!1)},saveManage:function(){var t=this,n=e(this.el).find("#tb_admin_doc_folder input[data-name=name]").val(),i=e(this.el).find("#tb_admin_doc_folder textarea[data-name=description]").val(),s=e(this.el).find("#tb_admin_doc_folder input[name=state]:checked").val();if(!this.validBeforeSaveManage())return!1;this.model.set({name:n,desc:i,state:s},{silent:!0}),this.model.set("folderUserScope",this.$el.find("input[name=folderUserScope]:checked").val());var o=this.model.get("folderUserScope")=="SPECIFIC"?this.folderUserView.getData():{nodes:[]};this.model.set("folderUser",o);if(!this.model.isValid())return this.model.validationError=="name_invalid_length"?(e.goError(r.i18n(l["0\uc790\uc774\uc0c1 0\uc774\ud558 \uc785\ub825\ud574\uc57c\ud569\ub2c8\ub2e4."],{arg1:2,arg2:100})),this.$el.find(":input[data-name=name]").select()):e.goError(h[this.model.validationError]),!1;this.model.save({},{type:"PUT",async:!1,success:function(n,r){r.code=="200"&&(e.goMessage(l["\uc218\uc815\ub418\uc5c8\uc2b5\ub2c8\ub2e4."]),t.render())},error:function(t,n){var r=JSON.parse(n.responseText);return r.message?(e.goError(r.message),!1):(e.goError(l["\uc800\uc7a5\uc5d0 \uc2e4\ud328 \ud558\uc600\uc2b5\ub2c8\ub2e4."]),!1)}})},cancel:function(){this.renderDetailForm(this.model.get("id"))}});return p});