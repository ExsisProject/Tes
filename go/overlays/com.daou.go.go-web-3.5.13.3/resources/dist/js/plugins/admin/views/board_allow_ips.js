define(["jquery","backbone","app","hogan","hgn!admin/templates/board_allow_ips","i18n!nls/commons","i18n!admin/nls/admin"],function(e,t,n,r,i,s,o){var u={label_access_control:o["IP \uc811\uadfc\uc124\uc815"],label_enable:o["\uc0ac\uc6a9\uc5ec\ubd80"],label_use:o["\uc0ac\uc6a9\ud568"],label_unuse:o["\uc0ac\uc6a9\ud558\uc9c0 \uc54a\uc74c"],label_ip_address:o["IP \uc8fc\uc18c"],label_access_desc:o["\uac8c\uc2dc\ud310 \uc811\uadfc \ud5c8\uc6a9 IP \uc124\uba85"]},a=t.Model.extend({defaults:{configValue:"false"},initialize:function(e){this.option=e||{},this.appName=this.option.appName,this.targetId=this.option.targetId},url:function(){return[n.contextRoot+"ad/api",this.appName,"allowIps",this.targetId].join("/")}},{IP_RANGE_CONCATOR:"-",validateIp:function(e){var t=/^(\d|[1-9]\d|1\d\d|2([0-4]\d|5[0-5]))\.(\d|[1-9]\d|1\d\d|2([0-4]\d|5[0-5]))\.(\d|[1-9]\d|1\d\d|2([0-4]\d|5[0-5]))\.(\d|[1-9]\d|1\d\d|2([0-4]\d|5[0-5]))$/;if(e.indexOf(a.IP_RANGE_CONCATOR)>0){var n=e.split(a.IP_RANGE_CONCATOR)[1];if(!t.test(n))return!1}return t.test(e.split(a.IP_RANGE_CONCATOR)[0])}}),f=t.View.extend({events:{"click input[name='ipConfigEnable']":"ipConfigEnableClicked","click #ip_addBtn":"ipAddActionClicked","click #ip_removeBtn":"ipRemoveActionClicked"},initialize:function(e){this.option=e||{},this.model=new a(this.option),this.bind("saveConfig",this.save,this)},render:function(){return this.model.fetch().done(e.proxy(function(){this.$el.html(i({data:this.model.toJSON(),lang:u})),this.renderIpConfigEnable(),this.renderAccessIps()},this)),this},ipConfigEnableClicked:function(t){console.log("ipConfigEnableClicked..");var n=e(t.currentTarget).val()=="true";this.model.set("configValue",n),this.setIpRangeInput(n)},renderIpConfigEnable:function(){this.setIpRangeInput(this.model.get("ipEnable"))},setIpRangeInput:function(e){var t=!e;this.$("tr.IP_SETTINGS input, tr.IP_SETTINGS select").attr("disabled",t),t?(this.clearInputIps(),this.$("tr.IP_SETTINGS").hide()):this.$("tr.IP_SETTINGS").show()},ipAddActionClicked:function(){var t=_.pluck(e("input[name*='ip_from']"),"value").join("."),n=_.pluck(e("input[name*='ip_to']"),"value"),r=t;_.size(_.compact(n))==4&&(r=_.compact([t,n.join(".")]).join("-"));if(!a.validateIp(r)){e.goAlert(s["IP \uc720\ud6a8\ud558\uc9c0 \uc54a\uc74c"]);return}if(_.contains(this.model.get("accessIps"),r)){e.goAlert(s["IP \uc911\ubcf5"]);return}this.model.get("accessIps").push(r),this.renderAccessIps(),this.clearInputIps()},renderAccessIps:function(){var e=this.$('select[name="ipRanges"]'),t={ips:this.model.get("accessIps")},n=[];n.push("{{#ips}}"),n.push('    <option value="{{.}}">{{.}}'),n.push("{{/ips}}"),e.html(r.compile(n.join("")).render(t))},clearInputIps:function(){this.$("input[name*='ip_from']").val(""),this.$("input[name*='ip_to']").val("")},ipRemoveActionClicked:function(){var t=this.$('select[name="ipRanges"]').val();if(_.isNull(t)){e.goAlert(s["IP \uc120\ud0dd\ub418\uc9c0 \uc54a\uc74c"]);return}var n=_.pull(this.model.get("accessIps"),t.toString());this.model.set("accessIps",n),this.renderAccessIps()},save:function(t){var n=this,r=e.extend(!0,this.option,t);this.model.set("appName",r.appName),this.model.set("targetId",r.targetId),this.model.get("configValue")==""&&this.model.set("configValue",!1),this.model.save()}});return f});