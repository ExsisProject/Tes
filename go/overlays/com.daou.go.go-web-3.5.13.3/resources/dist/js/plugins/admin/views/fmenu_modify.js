define(function(require){var e=require("jquery");require("jquery.go-sdk"),require("jquery.go-validation"),require("jquery.go-popup"),require("jquery.go-orgslide");var t=require("backbone"),n=require("app"),r=require("admin/models/fmenu_config"),i=require("hgn!admin/templates/fmenu_update"),s=require("admin/views/org_group_list"),o=require("admin/views/link_menu_list"),u=require("admin/views/custom_org_web"),a=require("views/circle"),f=require("i18n!nls/commons"),l=require("i18n!admin/nls/admin"),c={add_org_access_deny:l["\uc811\uadfc\uc81c\ud55c \ud074\ub798\uc2a4 \ucd94\uac00"],label_ok:f["\uc800\uc7a5"],label_cancel:f["\ucde8\uc18c"],use:f["\uc0ac\uc6a9"],not_use:f["\uc0ac\uc6a9\ud558\uc9c0 \uc54a\uc74c"],use_label:l["\uc0ac\uc6a9\uc5ec\ubd80"],label_base:l["\uae30\ubcf8 \uc815\ubcf4"],label_access:l["\uba54\ub274 \uc811\uadfc \uc124\uc815"],label_fmenu:l["\uae30\ub2a5 \uba54\ub274"],label_status:l["\uba54\ub274 \ud65c\uc131\ud654 \uc5ec\ubd80"],label_online:l["\ud574\ub2f9 \uba54\ub274\ub97c \ud65c\uc131\ud654 \ud569\ub2c8\ub2e4."],label_stop:l["\ud574\ub2f9 \uba54\ub274\ub97c \ube44\ud65c\uc131\ud654 \ud569\ub2c8\ub2e4. \uc678\ubd80\uc5d0 \ub178\ucd9c\ud558\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4."],label_white:l["\uacf5\uac1c"],label_black:l["\ube44\uacf5\uac1c"],label_policy:l["\uc815\ucc45 \uc124\uc815"],label_addAccessDenyClass:l["\uc811\uadfc \ucc98\ub358 \ud074\ub798\uc2a4 \ucd94\uac00"],label_addAccessAllowedClass:l["\uc811\uadfc \ud5c8\uc6a9 \ud074\ub798\uc2a4 \ucd94\uac00"],label_selectClass:l["\ucc28\ub2e8\ud560 \ud074\ub798\uc2a4 \uc120\ud0dd"],label_addExceptionClass:l["\ud5c8\uc6a9\ud560 \ud074\ub798\uc2a4 \uc120\ud0dd"],"\uc124\uc815":l["\uc124\uc815"]},h=null,p=t.View.extend({accessUserView:null,exceptionUserView:null,unbindEvent:function(){this.$el.off("click","span.btn[data-btntype='submit_modify']"),this.$el.off("click","span.btn_nega[data-btntype='cancel']"),this.$el.off("click","#selectAccessPolicy input:radio"),this.$el.off("click","input:radio[name='status']"),this.$el.off("click","span[data-btntype='publicModify']"),this.$el.off("click","span[data-btntype='publicDelete']")},bindEvent:function(){this.$el.on("click","span.btn[data-btntype='submit_modify']",e.proxy(this.save,this)),this.$el.on("click","span.btn_nega[data-btntype='cancel']",e.proxy(this.cancel,this)),this.$el.on("click","#selectAccessPolicy input:radio",e.proxy(this.changePolicyLabel,this)),this.$el.on("click","input:radio[name='status']",e.proxy(this.toggleStatus,this)),this.$el.on("click","span[data-btntype='publicModify']",e.proxy(this.modifyPublicRange,this)),this.$el.on("click","span[data-btntype='publicDelete']",e.proxy(this.deletePublicRange,this))},initialize:function(e){this.options=e||{},this.fmenuId=this.options.fmenuId,this.release(),this.unbindEvent(),this.bindEvent()},cancel:function(){n.router.navigate("/company/function",!0)},render:function(){var t;if(this.fmenuId){var n=this;this.model!=null&&this.model.clear(),this.model=r.read(this.fmenuId),t=i({lang:c,data:this.model.toJSON(),nameValue:function(){if(this.name=="org")return l["\uc870\uc9c1\ub3c4 - \uc6f9\uc11c\ube44\uc2a4"];if(this.name=="org_mobile")return l["\uc870\uc9c1\ub3c4 - \ubaa8\ubc14\uc77c"];if(this.name=="org_pc")return l["\uc870\uc9c1\ub3c4 - PC \uba54\uc2e0\uc800"];if(this.name=="chat")return l["\ub300\ud654"];if(this.name=="messenger")return l["PC \uba54\uc2e0\uc800"];if(this.name=="mobileapp")return l["\ubaa8\ubc14\uc77c \uc571"];if(this.name=="note")return l["\ucabd\uc9c0"];if(this.name=="pubsubcircle")return l["\uacf5\uc9c0\ud1a1"]},isOnline:function(){return this.status=="online"?!0:!1},makeNodeValue:function(){return this.nodeType=="position"?"["+l["\uc9c1\uc704"]+" : "+this.nodeValue+"]":this.nodeType=="grade"?"["+l["\uc9c1\uae09"]+" : "+this.nodeValue+"]":this.nodeType=="duty"?"["+l["\uc9c1\ucc45"]+" : "+this.nodeValue+"]":this.nodeType=="usergroup"?"["+l["\uc0ac\uc6a9\uc790\uadf8\ub8f9"]+" : "+this.nodeValue+"]":this.nodeValue}}),this.$el.html(t),this.renderAccessUserView(),this.renderExceptionUserView(),this.customConfigRender()}e(":input:radio[name='status']:checked").val()=="online"?e("#accessControll").show():e("#accessControll").hide(),s.render({id:"#partPublicWrap",type:"add"}),e(":radio[name='apply']:checked").val()=="false"&&e("#configOff").parents("tr").addClass("last");var o=n.model.get("accessSetting");e('input[name="accessSetting"][value="'+o+'"]').attr("checked",!0),"black"==o?(e("#selectedClass").text(l["\ucc28\ub2e8\ud560 \ud074\ub798\uc2a4 \uc120\ud0dd"]),e("#exceptedClass").text(l["\uc608\uc678 \ud5c8\uc6a9 \ud074\ub798\uc2a4 \uc120\ud0dd"]),e("#exceptedClassToolTip").text(l["\uc608\uc678\ud5c8\uc6a9 \ud074\ub798\uc2a4 \uc120\ud0dd \ud234\ud301"])):(e("#selectedClass").text(l["\ud5c8\uc6a9\ud560 \ud074\ub798\uc2a4 \uc120\ud0dd"]),e("#exceptedClass").text(l["\uc608\uc678 \ucc28\ub2e8 \ud074\ub798\uc2a4 \uc120\ud0dd"]),e("#exceptedClassToolTip").text(l["\uc608\uc678\ucc28\ub2e8 \ud074\ub798\uc2a4 \uc120\ud0dd \ud234\ud301"]))},toggleStatus:function(t){e(t.target).val()=="stop"?(e("#accessControll").hide(),e("#customFunctionMenu").hide()):e(t.target).val()=="online"&&(e("#accessControll").show(),e("#customConfigArea").children().length>0&&e("#customFunctionMenu").show())},save:function(t){var n=this.customConfigSave();if(n.success){var r=this;r.model.set("status",e(":radio[name='status']:checked").val()),r.model.set("accessSetting",e(":radio[name='accessSetting']:checked").val());var i=this.accessUserView.getData();r.model.set("accessTarget",i);var s=this.exceptionUserView.getData();r.model.set("exceptionTarget",s),GO.util.preloader(r.model.save({},{type:"PUT",success:function(t,n){n.code=="200"&&e.goMessage(f["\uc800\uc7a5\ub418\uc5c8\uc2b5\ub2c8\ub2e4."])},error:function(t,n){var r=JSON.parse(n.responseText);r!=null?e.goAlert(f["\uc624\ub958"],r.message):e.goMessage(f["\uc2e4\ud328\ud588\uc2b5\ub2c8\ub2e4."])}}))}else{var o=n.message;o!=null?e.goAlert(f["\uc624\ub958"],o):e.goMessage(f["\uc2e4\ud328\ud588\uc2b5\ub2c8\ub2e4."])}return},getAccessTargetInfo:function(){var t=[];return e("#groupUl li").each(function(){t.push({nodeId:e(this).attr("data-code"),nodeType:e(this).attr("data-type")})}),t},changePolicyLabel:function(t){e(t.target).val()=="black"?(e("#selectedClass").text(l["\ucc28\ub2e8\ud560 \ud074\ub798\uc2a4 \uc120\ud0dd"]),e("#exceptedClass").text(l["\uc608\uc678 \ud5c8\uc6a9 \ud074\ub798\uc2a4 \uc120\ud0dd"]),e("#exceptedClassToolTip").text(l["\uc608\uc678\ud5c8\uc6a9 \ud074\ub798\uc2a4 \uc120\ud0dd \ud234\ud301"])):(e("#selectedClass").text(l["\ud5c8\uc6a9\ud560 \ud074\ub798\uc2a4 \uc120\ud0dd"]),e("#exceptedClass").text(l["\uc608\uc678 \ucc28\ub2e8 \ud074\ub798\uc2a4 \uc120\ud0dd"]),e("#exceptedClassToolTip").text(l["\uc608\uc678\ucc28\ub2e8 \ud074\ub798\uc2a4 \uc120\ud0dd \ud234\ud301"])),this.confirmDeleteTarget(t)},confirmDeleteTarget:function(t){var n=this,r=function(){e(t.target).val()=="black"?(e('input[name="accessSetting"][value="white"]').attr("checked",!0),e("#selectedClass").text(l["\ud5c8\uc6a9\ud560 \ud074\ub798\uc2a4 \uc120\ud0dd"]),e("#exceptedClass").text(l["\uc608\uc678 \ucc28\ub2e8 \ud074\ub798\uc2a4 \uc120\ud0dd"]),e("#exceptedClassToolTip").text(l["\uc608\uc678\ucc28\ub2e8 \ud074\ub798\uc2a4 \uc120\ud0dd \ud234\ud301"])):(e('input[name="accessSetting"][value="black"]').attr("checked",!0),e("#selectedClass").text(l["\ucc28\ub2e8\ud560 \ud074\ub798\uc2a4 \uc120\ud0dd"]),e("#exceptedClass").text(l["\uc608\uc678 \ud5c8\uc6a9 \ud074\ub798\uc2a4 \uc120\ud0dd"]),e("#exceptedClassToolTip").text(l["\uc608\uc678\ud5c8\uc6a9 \ud074\ub798\uc2a4 \uc120\ud0dd \ud234\ud301"]))},i=function(){n.accessUserView.deleteAllData(),n.exceptionUserView.deleteAllData()};e.goConfirm(l["\uc815\ucc45 \uc124\uc815 \ubcc0\uacbd \ud655\uc778"],"",i,r,f["\ud655\uc778"])},modifyPublicRange:function(t){e(t.currentTarget).parents("li").first().after("<li></li>"),s.render({id:e(t.currentTarget).parents("li").first().next("li"),type:"save"}),e(t.currentTarget).parents("li").first().find("span.btn_border").css("display","none")},deletePublicRange:function(t){e(t.currentTarget).parents("li").first().remove()},renderAccessUserView:function(){var e=["user","position","grade","usergroup"];GO.util.isUseOrgService(!0)&&(e=["user","department","position","grade","duty","usergroup"]),this.accessUserView=new a({selector:"#accessUser",isAdmin:!0,isWriter:!0,circleJSON:this.model.get("accessTarget"),nodeTypes:e}),this.accessUserView.render()},renderExceptionUserView:function(){var e=["user","position","grade","usergroup"];GO.util.isUseOrgService(!0)&&(e=["user","department","position","grade","duty","usergroup"]),this.exceptionUserView=new a({selector:"#exceptionUser",isAdmin:!0,isWriter:!0,circleJSON:this.model.get("exceptionTarget"),nodeTypes:e}),this.exceptionUserView.render()},release:function(){this.$el.off(),this.$el.empty()},customConfigRender:function(){var t=this.model.toJSON().name;t=="messenger"?(this.LinkMenuListView=new o,this.LinkMenuListView.render()):t=="org"&&(this.CustomOrgWebView=new u,this.CustomOrgWebView.render()),e("#online").is(":checked")&&e("#customConfigArea").children().length>0&&e("#customFunctionMenu").show()},customConfigSave:function(){var e={success:!0,message:null},t=this.model.toJSON().name;return t=="org"&&(e=this.CustomOrgWebView.save()),e}});return p});