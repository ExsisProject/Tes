(function(){define(["backbone","app","hgn!admin/templates/calendar_form","i18n!admin/nls/admin","i18n!nls/commons","hgn!board/templates/board_create_manager","admin/views/board_group_list","views/circle","jquery.go-orgslide"],function(e,t,n,r,i,s,o,u){var a={"\uce98\ub9b0\ub354 \ub4f1\ub85d\uc815\ubcf4":r["\uce98\ub9b0\ub354 \ub4f1\ub85d\uc815\ubcf4"],"\uce98\ub9b0\ub354 \uc81c\ubaa9":r["\uce98\ub9b0\ub354 \uc81c\ubaa9"],"\uacf5\uac1c \ubc94\uc704":r["\uacf5\uac1c \ubc94\uc704"],"\uacf5\uac1c":r["\uacf5\uac1c"],"\uc77d\uae30":r["\uc77d\uae30"],"\ube44\uacf5\uac1c":r["\ube44\uacf5\uac1c"],"\uc6b4\uc601\uc790":r["\uc6b4\uc601\uc790"],"\uc6b4\uc601\uc790 \ucd94\uac00":r["\uc6b4\uc601\uc790 \ucd94\uac00"],"\uc800\uc7a5":i["\uc800\uc7a5"],"\ucde8\uc18c":i["\ucde8\uc18c"]},f=e.Model.extend({defaults:{visibility:"public"},urlRoot:t.contextRoot+"ad/api/calendar",isPublic:function(){return this.get("visibility")=="public"}}),l=e.View.extend({el:"#layoutContent",events:{"click #selectManager":"addManager","click input[name=share]:radio":"togglePublicRadio","click #cal_actions span[data-btntype='save']":"save","click #cal_actions span[data-btntype='cancel']":"cancel","click #calendarManagerList span.ic_del":"removeManager"},initialize:function(e){this.$el.off(),_.isUndefined(e)?this.model=new f:(this.model=new f,this.model.set({id:e.calendarId}),this.model.fetch({async:!1}))},render:function(){return this.$el.html(n({lang:a,isPublic:this.model.isPublic(),data:this.model.toJSON()})),this.renderAccess(),this.$el},renderAccess:function(){var e=["user","position","grade","usergroup"];t.util.isUseOrgService(!0)&&(e=["user","department","position","grade","duty","usergroup"]),this.accessUserView=new u({selector:"#accessUser",isAdmin:!0,isWriter:!0,circleJSON:this.model.get("accessTarget"),nodeTypes:e,useAction:!0}),this.accessUserView.render(),this.accessUserView.$el.find("span.vertical_wrap").prepend(r["\uad8c\ud55c\uc790 \ucd94\uac00"]+" ")},save:function(){var e=this;this.model.set(this.getData()),this.model.save(null,{success:function(){$.goMessage(i["\uc800\uc7a5\ub418\uc5c8\uc2b5\ub2c8\ub2e4."]),e.goList()}})},cancel:function(){this.goList()},goList:function(){t.router.navigate("/calendar",!0)},getData:function(){var e=this,t={name:this.$el.find("#title").val(),visibility:this.$el.find("input:radio[name='share']:checked").val(),accessTarget:this.accessUserView.getData(),managers:function(){var t=[];return e.$el.find("#calendarManagerList li").not(".creat").each(function(){t.push({userId:$(this).data("id")})}),t}()};return t},addManager:function(e){var n=this,i=$.goOrgSlide({header:r["\uc6b4\uc601\uc790 \uc120\ud0dd"],desc:"",callback:n.setManager,target:e,isAdmin:!0,contextRoot:t.contextRoot})},removeManager:function(e){var t=$(e.currentTarget);t.closest("li").remove()},setManager:function(e){var t=$("#calendarManagerList");e&&!t.find('li[data-id="'+e.id+'"]').length?t.find("li.creat").before(s($.extend(e,{lang:a}))):$.goAlert(i["\uc624\ub958"],r["\uc774\ubbf8 \uc6b4\uc601\uc790\ub85c \uc9c0\uc815"])},togglePublicRadio:function(e){var t=this.$el.find("input[name=share]:radio:checked").val();t=="PUBLIC"?$("#accessUser").hide():$("#accessUser").show()}},{render:function(e){var t=new l(e);return t.render()}});return l})})();