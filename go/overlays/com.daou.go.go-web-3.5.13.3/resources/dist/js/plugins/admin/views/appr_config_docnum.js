define(["jquery","underscore","backbone","app","hgn!admin/templates/appr_config_docnum","hgn!admin/templates/add_config_list","i18n!nls/commons","i18n!approval/nls/approval","i18n!admin/nls/admin","jquery.go-validation"],function(e,t,n,r,i,s,o,u,a){var f={"\uc804\uc790\uacb0\uc7ac \ubb38\uc11c\ubc88\ud638 \uc124\uc815":a["\uc804\uc790\uacb0\uc7ac \ubb38\uc11c\ubc88\ud638 \uc124\uc815"],"\ubb38\uc11c\ubc88\ud638 \uaddc\uce59\uc124\uc815":a["\ubb38\uc11c\ubc88\ud638 \uaddc\uce59\uc124\uc815"],"\ubb38\uc11c\ubc88\ud638 \ucd08\uae30\uac12":a["\ubb38\uc11c\ubc88\ud638 \ucd08\uae30\uac12"],"\ubb38\uc11c\ubc88\ud638 \uaddc\uce59":a["\ubb38\uc11c\ubc88\ud638 \uaddc\uce59"],"\uc608\uc2dc":a["\uc608\uc2dc"],"\uad6c\ubd84":a["\uad6c\ubd84"],"\uc720\ud6a8\ud558\uc9c0 \uc54a\uc740 \ubb38\uc790\uc5f4 \uc785\ub2c8\ub2e4.":a["\uc720\ud6a8\ud558\uc9c0 \uc54a\uc740 \ubb38\uc790\uc5f4 \uc785\ub2c8\ub2e4."],"\uc790\ub9ac\uc218":a["\uc790\ub9ac\uc218"],"\uc0ac\uc6a9\uc790\ubb38\uc790\uc5f4":u["\uc0ac\uc6a9\uc790\ubb38\uc790\uc5f4"],"\ud68c\uc0ac\uba85":u["\ud68c\uc0ac\uba85"],"\ud68c\uc0ac\uba85 \uc57d\uc5b4":u["\ud68c\uc0ac\uba85 \uc57d\uc5b4"],"\ubd80\uc11c\uba85":u["\ubd80\uc11c\uba85"],"\ubd80\uc11c\uba85 \uc57d\uc5b4":u["\ubd80\uc11c\uba85 \uc57d\uc5b4"],"\ubb38\uc11c\uc591\uc2dd\uba85":u["\ubb38\uc11c\uc591\uc2dd\uba85"],"\ubb38\uc11c\uc591\uc2dd\uc57d\uc5b4\uba85":u["\ubb38\uc11c\uc591\uc2dd\uc57d\uc5b4\uba85"],"\ub4f1\ub85d\ub144\ub3c41":u["\ub4f1\ub85d\ub144\ub3c41"],"\ub4f1\ub85d\ub144\ub3c42":u["\ub4f1\ub85d\ub144\ub3c42"],"\ub4f1\ub85d\ub144\uc6d4":u["\ub4f1\ub85d\ub144\uc6d4"],"\ub4f1\ub85d\ub144\ub3c4\uc6d4":u["\ub4f1\ub85d\ub144\ub3c4\uc6d4"],"\ub4f1\ub85d\uc6d4\uc77c":u["\ub4f1\ub85d\uc6d4\uc77c"],"\ub4f1\ub85d\uc6d4":u["\ub4f1\ub85d\uc6d4"],"\ub4f1\ub85d\uc77c":u["\ub4f1\ub85d\uc77c"],"\ub4f1\ub85d\uc2dc\ubd84\ucd08":u["\ub4f1\ub85d\uc2dc\ubd84\ucd08"],"\uc77c\ub828\ubc88\ud638 3\uc790\ub9ac":u["\uc77c\ub828\ubc88\ud638 3\uc790\ub9ac"],"\uc77c\ub828\ubc88\ud638 5\uc790\ub9ac":u["\uc77c\ub828\ubc88\ud638 5\uc790\ub9ac"],"\uc77c\ub828\ubc88\ud638 7\uc790\ub9ac":u["\uc77c\ub828\ubc88\ud638 7\uc790\ub9ac"],"\uad6c\ubd84\uc7901":u["\uad6c\ubd84\uc7901"],"\uad6c\ubd84\uc7902":u["\uad6c\ubd84\uc7902"],"\ud68c\uc0ac\uba85\uc0d8\ud50c":u["\ud68c\uc0ac\uba85\uc0d8\ud50c"],"\ud68c\uc0ac\uba85\uc57d\uc5b4\uc0d8\ud50c":u["\ud68c\uc0ac\uba85\uc57d\uc5b4\uc0d8\ud50c"],"\ubd80\uc11c\uba85\uc0d8\ud50c":u["\ubd80\uc11c\uba85\uc0d8\ud50c"],"\ubd80\uc11c\uba85\uc57d\uc5b4\uc0d8\ud50c":u["\ubd80\uc11c\uba85\uc57d\uc5b4\uc0d8\ud50c"],"\ubb38\uc11c\uc591\uc2dd\uba85\uc0d8\ud50c":u["\ubb38\uc11c\uc591\uc2dd\uba85\uc0d8\ud50c"],alert_length:a["0\uc790\uc774\uc0c1 0\uc774\ud558 \uc785\ub825\ud574\uc57c\ud569\ub2c8\ub2e4."],"\ubb38\uc11c\uc591\uc2dd\uc57d\uc5b4\uba85\uc0d8\ud50c":u["\ubb38\uc11c\uc591\uc2dd\uc57d\uc5b4\uba85\uc0d8\ud50c"],"\ub4f1\ub85d\ub144\ub3c41\uc0d8\ud50c":u["\ub4f1\ub85d\ub144\ub3c4\uc0d8\ud50c1"],"\ub4f1\ub85d\ub144\ub3c42\uc0d8\ud50c":u["\ub4f1\ub85d\ub144\ub3c4\uc0d8\ud50c2"],"\ub4f1\ub85d\ub144\ub3c4\uc6d4\uc0d8\ud50c":u["\ub4f1\ub85d\ub144\ub3c4\uc6d4\uc0d8\ud50c"],"\ub4f1\ub85d\ub144\uc6d4\uc0d8\ud50c":u["\ub4f1\ub85d\ub144\uc6d4\uc0d8\ud50c"],"\ub4f1\ub85d\uc6d4\uc77c\uc0d8\ud50c":u["\ub4f1\ub85d\uc6d4\uc77c\uc0d8\ud50c"],"\ub4f1\ub85d\uc6d4\uc0d8\ud50c":u["\ub4f1\ub85d\uc6d4\uc0d8\ud50c"],"\ub4f1\ub85d\uc77c\uc0d8\ud50c":u["\ub4f1\ub85d\uc77c\uc0d8\ud50c"],"\ub4f1\ub85d\uc2dc\ubd84\ucd08\uc0d8\ud50c":u["\ub4f1\ub85d\uc2dc\ubd84\ucd08\uc0d8\ud50c"],"\uc77c\ub828\ubc88\ud638 3\uc790\ub9ac\uc0d8\ud50c":u["\uc77c\ub828\ubc88\ud638 3\uc790\ub9ac\uc0d8\ud50c"],"\uc77c\ub828\ubc88\ud638 5\uc790\ub9ac\uc0d8\ud50c":u["\uc77c\ub828\ubc88\ud638 5\uc790\ub9ac\uc0d8\ud50c"],"\uc77c\ub828\ubc88\ud638 7\uc790\ub9ac\uc0d8\ud50c":u["\uc77c\ub828\ubc88\ud638 7\uc790\ub9ac\uc0d8\ud50c"],"\uad6c\ubd84\uc7901\uc0d8\ud50c":u["\uad6c\ubd84\uc7901\uc0d8\ud50c"],"\uad6c\ubd84\uc7902\uc0d8\ud50c":u["\uad6c\ubd84\uc7902\uc0d8\ud50c"],"\uc0ac\uc6a9\uc790\ubb38\uc790\uc5f4\uc0d8\ud50c":u["\uc0ac\uc6a9\uc790\ubb38\uc790\uc5f4\uc0d8\ud50c"],"\ucd94\uac00":o["\ucd94\uac00"],"\ubaa9\ub85d":o["\ubaa9\ub85d"],"\uc800\uc7a5":o["\uc800\uc7a5"],"\uc0ad\uc81c":o["\uc0ad\uc81c"],"\ucde8\uc18c":o["\ucde8\uc18c"]},l=n.Model.extend({defaults:{useFlag:!1}}),c=n.Collection.extend({model:l,findByType:function(e){var t=this.find(function(t){return e==t.get("type")});return t},removeByType:function(e){var t=this.find(function(t){return e==t.get("type")});this.remove(t)},getCountCheckList:function(e){var n=this,r=0;return t.each(e,function(e){var t=n.find(function(t){return e==t.get("type")});t&&r++}),r},isSeqLast:function(e){var n,r=0,i=t.size(this);return this.each(function(r,s){i-1==s&&(console.log(r.get("type")),n=t.indexOf(e,r.get("type")))}),n==-1?!1:!0}}),h=n.Model.extend({initialize:function(e){this.options=e||{},t.isArray(this.options.uniqueCheckList)&&(this.uniqueCheckList=this.options.uniqueCheckList),t.isArray(this.options.noCheckUniqueList)&&(this.noCheckUniqueList=this.options.noCheckUniqueList),t.isNumber(this.options.maxUserStr)&&(this.maxUserStr=this.options.maxUserStr)},url:"/ad/api/approval/admin/config/docnum",getDocNumCollection:function(){return new c(this.get("config"))},addDocNum:function(e){var t=this.getDocNumCollection();t.add(e),this.set("config",t.toJSON())},hasDocNum:function(n){if(e.inArray(n,this.noCheckUniqueList)>-1)return!1;var r=this.getDocNumCollection();return t.isUndefined(r.findByType(n))?!1:!0},removeDocNum:function(e){var t=this.getDocNumCollection();t.removeByType(e),this.set("config",t.toJSON())},validate:function(e,t){var n=this.getDocNumCollection(),r=n.getCountCheckList(this.uniqueCheckList),i=n.isSeqLast(this.uniqueCheckList);if(r<1)return u["\uc77c\ub828\ubc88\ud638\ub294 \ud544\uc218 \uc0ac\ud56d\uc785\ub2c8\ub2e4."];if(r>1)return u["\ud558\ub098\uc758 \uc77c\ub828\ubc88\ud638\ub9cc \uac00\ub2a5 \ud569\ub2c8\ub2e4."];if(!i)return u["\ub9c8\uc9c0\ub9c9 \ubb38\uc11c\uaddc\uce59\uc740 \uc77c\ub828\ubc88\ud638\ub9cc \uac00\ub2a5 \ud569\ub2c8\ub2e4."]}}),p=n.View.extend({el:"#layoutContent",model:null,maxUserStr:null,initialize:function(){this.maxUserStr=20,this.model=new h({uniqueCheckList:["SEQ3","SEQ5","SEQ7"],maxUserStr:this.maxUserStr,noCheckUniqueList:["DELIMITER1","DELIMITER2"]}),this.model.fetch({async:!1,statusCode:{403:function(){r.util.error("403")},404:function(){r.util.error("404",{msgCode:"400-common"})},500:function(){r.util.error("500")}}})},delegateEvents:function(t){this.undelegateEvents(),n.View.prototype.delegateEvents.call(this,t),this.$el.on("click.docNum",".list_doc_rule .chart.tb_admin_doc_rule td.add > span",e.proxy(this.onAddDocNumRule,this)),this.$el.on("click.docNum","#attendee-list .ic_del",e.proxy(this.deleteItem,this)),this.$el.on("click.docNum","span#docnumSave",e.proxy(this.saveDocNum,this)),this.$el.on("click.docNum","span#docnumCancel",e.proxy(this.cancelDocNum,this)),this.$el.on("keyup.docNum","input#userStr",e.proxy(this.setUserStr,this))},undelegateEvents:function(){return n.View.prototype.undelegateEvents.call(this),this.$el.off(".docNum"),this},keyUPValidator:function(n){var i=e(n.currentTarget).val(),s=e(n.currentTarget).parent(),o=s.parent().find("#docNumSequenceAlert");o.html("");if(!t.isEmpty(i)&&!e.goValidation.isNumber(i))return o.html(a["\uc22b\uc790\ub9cc \uc785\ub825\ud558\uc138\uc694."]),n.currentTarget.focus(),n.currentTarget.value="",!1;if(i.length>this.maxDocNumSequence)return o.html(r.i18n(u["{{max}}\uc790 \uc774\ud558\ub85c \uc785\ub825\ud574 \uc8fc\uc2ed\uc2dc\uc624"],{max:this.maxDocNumSequence})),!1},_checkUserStr:function(){var t=e("#userStr").val();return this._testInvalidStr(t)?f["\uc720\ud6a8\ud558\uc9c0 \uc54a\uc740 \ubb38\uc790\uc5f4 \uc785\ub2c8\ub2e4."]:t.length>this.maxUserStr?r.i18n(u["{{max}}\uc790 \uc774\ud558\ub85c \uc785\ub825\ud574 \uc8fc\uc2ed\uc2dc\uc624"],{max:this.maxUserStr}):!1},_testInvalidStr:function(e){var t=/[ \{\}\[\]\/?.,;:|\)*~`!^\-_+\u253c<>@\#$%&\'\"\\\(\=]/gi;return t.test(e)},setUserStr:function(t){var n=e(t.currentTarget).val(),r=e(t.currentTarget).parent(),i=r.parent().find("#userStrAlert");i.html("");var s=this._checkUserStr();if(s)return i.html(s),!1;this._renderExampleDocNum()},onAddDocNumRule:function(t){var n=e(t.currentTarget),i=n.parent(),s=i.attr("data-type"),u=i.attr("seqType"),a=i.parent().find(".part").text(),l=i.parent().find(".num").text();if(s=="USERSTR"){if(!e.goValidation.isCheckLength(1,this.maxUserStr,e("#userStr").val()))return e.goError(r.i18n(f.alert_length,{arg1:"1",arg2:this.maxUserStr})),e("#userStr").select(),!1;var c=this._checkUserStr();if(c)return e.goError(c),e("#userStr").select(),!1}if(!!this.model.hasDocNum(s))return e.goError(o["\uc774\ubbf8 \uc120\ud0dd\ub418\uc5c8\uc2b5\ub2c8\ub2e4."]),!1;this.addDocNumRule(a,s,u,l)},addDocNumRule:function(e,t,n,r){this.model.addDocNum(new l({type:t,seqFlag:n,digit:r,name:e})),this._renderDocNumList()},deleteItem:function(t){var n=e(t.currentTarget).closest("li").attr("data-type");this.model.removeDocNum(n),this._renderDocNumList()},saveDocNum:function(){var t=this,n=this._checkUserStr();if(n)return e.goError(n),e("#userStr").select(),!1;this.model.set("userStr",this.$el.find("#userStr").val());if(!this.model.isValid())return e.goError(this.model.validationError),!1;r.EventEmitter.trigger("common","layout:setOverlay",""),this.model.save({},{type:"POST",success:function(n,i){r.EventEmitter.trigger("common","layout:clearOverlay",!0),i.code=="200"&&(e.goMessage(o["\uc800\uc7a5\ub418\uc5c8\uc2b5\ub2c8\ub2e4."]),t.model.fetch({async:!1}),t.render())},error:function(t,n){r.EventEmitter.trigger("common","layout:clearOverlay",!0);var i=JSON.parse(n.responseText);return i.message?(e.goError(i.message),!1):(e.goError(o["\uc800\uc7a5\uc5d0 \uc2e4\ud328 \ud558\uc600\uc2b5\ub2c8\ub2e4."]),!1)}})},cancelDocNum:function(){e.goCaution(o["\ucde8\uc18c"],o["\ubcc0\uacbd\ud55c \ub0b4\uc6a9\uc744 \ucde8\uc18c\ud569\ub2c8\ub2e4."],e.proxy(function(){this.model.fetch({async:!1}),this.render(),e.goMessage(o["\ucde8\uc18c\ub418\uc5c8\uc2b5\ub2c8\ub2e4."])},this),o["\ud655\uc778"])},render:function(){this.$el.empty(),this.$el.html(i({lang:f,userStr:this.model.get("userStr")})),this._renderDocNumList()},_renderExampleDocNum:function(){var t=[],n=this.$el.find(".list_doc_rule");this.model.getDocNumCollection().each(function(e){t.push(e.toJSON().type)});var r=[],i="";e(t).each(function(e,t){i=n.find("td[data-type = "+t+"]").parent().find(".sample").text(),t=="USERSTR"&&(i=n.find("#userStr").val()),r.push(i)}),e("#exampleTxt").text(a["\uc608\uc2dc"]+") "+e(r).get().join(""))},_renderDocNumList:function(){var e=this.$el.find("#attendee-list");e.empty(),this.model.getDocNumCollection().each(function(t){e.append(s(t.toJSON()))}),this._renderExampleDocNum()},release:function(){this.$el.off(),this.$el.empty()}});return p});