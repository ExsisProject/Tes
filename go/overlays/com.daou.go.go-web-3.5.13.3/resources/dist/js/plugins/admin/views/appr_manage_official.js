define(["jquery","underscore","backbone","app","when","hgn!admin/templates/appr_manage_official","hgn!admin/templates/appr_manage_official_item","i18n!approval/nls/approval","i18n!nls/commons","i18n!admin/nls/admin","jquery.ui","jquery.go-sdk"],function(e,t,n,r,i,s,o,u,a,f){var l=r.contextRoot+"ad/api/",c={"\uc2dc\ud589\ubb38 \uc591\uc2dd \uad00\ub9ac":f["\uc2dc\ud589\ubb38 \uc591\uc2dd \uad00\ub9ac"],"\ubc1c\uc2e0 \uba85\uc758 \uad00\ub9ac":f["\ubc1c\uc2e0 \uba85\uc758 \uad00\ub9ac"],"\uc9c1\uc778 \uad00\ub9ac":f["\uc9c1\uc778 \uad00\ub9ac"],"\uc81c\ubaa9":u["\uc81c\ubaa9"],"\uc0ac\uc6a9\uc5ec\ubd80":f["\uc0ac\uc6a9\uc5ec\ubd80"],"\ucd94\uac00":a["\ucd94\uac00"],"\uc0ad\uc81c":a["\uc0ad\uc81c"],empty_msg:u["\uc790\ub8cc\uac00 \uc5c6\uc2b5\ub2c8\ub2e4"],delete_success_msg:a["\uc0ad\uc81c\ud558\uc600\uc2b5\ub2c8\ub2e4."],delete_fail_msg:a["\uc0ad\uc81c\ud558\uc9c0 \ubabb\ud588\uc2b5\ub2c8\ub2e4."]},h=n.Model.extend(),p=n.Collection.extend({model:h,url:function(){var t={direction:this.direction,property:this.property};return l+"approval/manage/official/form"+"?"+e.param(t)},setSort:function(e,t){this.property=e,this.direction=t}}),d=n.Model.extend(),v=n.Collection.extend({model:d,url:function(){var t={direction:this.direction,property:this.property};return l+"approval/manage/official/sender"+"?"+e.param(t)},setSort:function(e,t){this.property=e,this.direction=t}}),m=n.Model.extend(),g=n.Collection.extend({model:m,url:function(){var t={direction:this.direction,property:this.property};return l+"approval/manage/official/sign"+"?"+e.param(t)},setSort:function(e,t){this.property=e,this.direction=t}}),y=n.View.extend({el:"#layoutContent",initialize:function(){this.formCollection=new p,this.senderCollection=new v,this.signCollection=new g,this.initProperty="name",this.initDirection="desc"},delegateEvents:function(t){this.undelegateEvents(),n.View.prototype.delegateEvents.call(this,t),this.$el.on("click.manageofficial","#btnFormAdd",e.proxy(this._addOfficialForm,this)),this.$el.on("click.manageofficial","#btnSenderAdd",e.proxy(this._addOfficialSender,this)),this.$el.on("click.manageofficial","#btnSignAdd",e.proxy(this._addOfficialSign,this)),this.$el.on("click.manageofficial","#btnFormDelete",e.proxy(this._delOfficialForm,this)),this.$el.on("click.manageofficial","#btnSenderDelete",e.proxy(this._delOfficialSender,this)),this.$el.on("click.manageofficial","#btnSignDelete",e.proxy(this._delOfficialSign,this)),this.$el.on("click.manageofficial","[name=check_all]",e.proxy(this._checkAllItem,this)),this.$el.on("click.manageofficial","[name=officialItemTitle]",e.proxy(this._detailView,this)),this.$el.on("click",".sorting",e.proxy(this.sort,this)),this.$el.on("click",".sorting_desc",e.proxy(this.sort,this)),this.$el.on("click",".sorting_asc",e.proxy(this.sort,this))},undelegateEvents:function(){return n.View.prototype.undelegateEvents.call(this),this.$el.off(),this},render:function(){i(this.renderLayout.call(this)).then(t.bind(this.loadFormList,this)).then(t.bind(this.loadSenderList,this)).then(t.bind(this.loadSignList,this)).then(t.bind(function(){this.setInitSort(this.initProperty,this.initDirection)},this)).otherwise(function(t){console.log(t.stack)})},renderLayout:function(){this.$el.html(s({lang:c}))},loadFormList:function(){i(this.fetchFormList.call(this)).then(t.bind(this.renderFormList,this)).otherwise(function(t){console.log(t.stack)})},fetchFormList:function(){var e=i.defer();return this.formCollection.fetch({success:e.resolve,error:e.reject,statusCode:{403:function(){r.util.error("403")},404:function(){r.util.error("404",{msgCode:"400-common"})},500:function(){r.util.error("500")}}}),e.promise},renderFormList:function(e){var t="#manage_official_form_tbl > tbody";this._renderList("form",t,e)},loadSenderList:function(){i(this.fetchSenderList.call(this)).then(t.bind(this.renderSenderList,this)).otherwise(function(t){console.log(t.stack)})},fetchSenderList:function(){var e=i.defer();return this.senderCollection.fetch({success:e.resolve,error:e.reject,statusCode:{403:function(){r.util.error("403")},404:function(){r.util.error("404",{msgCode:"400-common"})},500:function(){r.util.error("500")}}}),e.promise},renderSenderList:function(e){var t="#manage_official_sender_tbl > tbody";this._renderList("sender",t,e)},loadSignList:function(){i(this.fetchSignList.call(this)).then(t.bind(this.renderSignList,this)).otherwise(function(t){console.log(t.stack)})},fetchSignList:function(){var e=i.defer();return this.signCollection.fetch({success:e.resolve,error:e.reject,statusCode:{403:function(){r.util.error("403")},404:function(){r.util.error("404",{msgCode:"400-common"})},500:function(){r.util.error("500")}}}),e.promise},renderSignList:function(e){var t="#manage_official_sign_tbl > tbody";this._renderList("sign",t,e)},_renderList:function(t,n,r){e(n).empty(),r.length==0?e(n).append(this._renderEmptyTmpl({lang:c})):e(r.toJSON()).each(function(r,i){var s={id:i.id,name:i.name,state:i.state=="NORMAL"?u["\uc0ac\uc6a9"]:u["\ubbf8\uc0ac\uc6a9"],type:t};e(n).append(o({data:s}))})},_renderEmptyTmpl:function(e){var t=[];t.push("    <tr>"),t.push('        <td colspan="3">'),t.push('            <p class="data_null">'),t.push('                <span class="ic_data_type ic_no_data"></span>'),t.push('                <span class="txt">{{lang.empty_msg}}</span>'),t.push("            </p>"),t.push("        </td>"),t.push("    </tr>");var n=Hogan.compile(t.join("\n"));return n.render(e)},_addOfficialForm:function(){return r.router.navigate("approval/manage/official/form/new",{trigger:!0}),!1},_addOfficialSender:function(){return r.router.navigate("approval/manage/official/sender/new",{trigger:!0}),!1},_addOfficialSign:function(){return r.router.navigate("approval/manage/official/sign/new",{trigger:!0}),!1},_delOfficialForm:function(){this._delOfficialItems("#manage_official_form_tbl input:checked","approval/manage/official/form")},_delOfficialSender:function(){this._delOfficialItems("#manage_official_sender_tbl input:checked","approval/manage/official/sender")},_delOfficialSign:function(){this._delOfficialItems("#manage_official_sign_tbl input:checked","approval/manage/official/sign")},_delOfficialItems:function(t,n){var r=this,i=[];this.$el.find(t).each(function(t){e(this).attr("name")=="id"&&i.push(e(this).val())});if(i.length==0)return e.goMessage(u["\uc120\ud0dd\ub41c \ub300\uc0c1\uc774 \uc5c6\uc2b5\ub2c8\ub2e4."]),!1;e.goConfirm(f["\uc0ad\uc81c\ud558\uc2dc\uaca0\uc2b5\ub2c8\uae4c?"],"",function(){e.go(l+n,JSON.stringify({ids:i}),{qryType:"DELETE",contentType:"application/json",async:!1,responseFn:function(t){e.goMessage(c.delete_success_msg),r.render()},error:function(t){e.goMessage(c.delete_fail_msg),r.render()}})})},_detailView:function(t){var n=e(t.currentTarget),i=e(n).attr("data-type"),s=e(n).attr("data-id");return r.router.navigate("approval/manage/official/"+i+"/"+s+"/show",{trigger:!0}),!1},_checkAllItem:function(t){var n=e(t.currentTarget);checkboxes=n.closest("table").find("input:checkbox"),n.is(":checked")?checkboxes.attr("checked","checked"):checkboxes.removeAttr("checked")},setInitSort:function(t,n){var r=null,i=this.$el.find("th:not(.sorting_disable)");i.each(function(){e(this).attr("class")!="sorting_disabled"&&e(this).attr("class","sorting"),e(this).attr("sort-id")==t&&(r=e(this).attr("id"),e("#"+r).attr("class","sorting_"+n))})},sort:function(t){var n="#"+e(t.currentTarget).attr("id"),r=e(n).attr("class"),i=e(n).attr("sort-id"),s="desc",o=e(t.currentTarget).closest("table"),u=o.find("th:not(.sorting_disable)");u.each(function(){e(this).attr("class")!="sorting_disabled"&&e(this).attr("class","sorting")}),r=="sorting"?e(n).attr("class","sorting_desc"):r=="sorting_desc"?(e(n).attr("class","sorting_asc"),s="asc"):r=="sorting_asc"?e(n).attr("class","sorting_desc"):e.goMessage("Sorting Error."),e(t.currentTarget).attr("sort-type")=="form"?(this.formCollection.setSort(i,s),this.loadFormList()):e(t.currentTarget).attr("sort-type")=="sender"?(this.senderCollection.setSort(i,s),this.loadSenderList()):e(t.currentTarget).attr("sort-type")=="sign"&&(this.signCollection.setSort(i,s),this.loadSignList())},release:function(){this.$el.off(),this.$el.empty()}});return y});