define(["backbone","admin/models/menu"],function(e,t){var n=e.Model.extend({url:function(){return"/ad/api/menu/all"},getMenus:function(){return this.get("menuConfigModel")},getSystemMenus:function(){return _.filter(this.getAllMenus(),function(e){return e.systemMenu})},getActiveMenusTree:function(){return _.filter(this.get("menuConfigModel"),function(e){var t=_.filter(e.subMenu,function(e){return e.status=="online"});return e.activeSubMenu=_.sortBy(t,function(e){return e.seq}),e.status=="online"})},getAllMenus:function(){var e=this.getMenus(),t=_.flatten(_.map(e,function(e){return e.subMenu}));return _.union(t,e)},getActiveMenus:function(){var e=[];return _.each(this.get("menuConfigModel"),function(t){t.status=="online"&&e.push(t),_.each(t.subMenu,function(t){t.status=="online"&&e.push(t)})}),e},leaveParent:function(e){var t=Number(e);return $.ajax({type:"PUT",url:GO.contextRoot+"ad/api/menu/leave/"+t,dataType:"json",contentType:"application/json",success:function(e){console.log(e.data)}})},getMenu:function(e){var t=this.getAllMenus(),n=_.find(t,function(t){return t.id==e});return n},getMenuModel:function(e){return new t(this.getMenu(e))},isActive:function(e){var t=_.map(this.getActiveMenus(),function(e){return e.id});return _.contains(t,parseInt(e))},setInitialMenu:function(e){var t=this;return $.ajax({type:"POST",url:GO.contextRoot+"ad/api/menu/initmenu/"+e,dataType:"json",contentType:"application/json; charset=utf-8",data:$.param({initial:!0}),success:function(e){t.set("menuConfigModel",e.data)}})},updateMenu:function(e,t){var n=this.getMenuModel(e);return $.ajax({type:"PUT",url:GO.contextRoot+"ad/api/menu/"+e,data:JSON.stringify(_.extend(n.toJSON(),t)),dataType:"json",contentType:"application/json;",success:function(e){console.log(e)}})},deleteMenu:function(e){return $.ajax({type:"DELETE",url:GO.contextRoot+"ad/api/menu",data:JSON.stringify({ids:[e]}),dataType:"json",contentType:"application/json;",success:function(e){console.log(e)}})},setOrder:function(e){var t=this;return $.ajax({type:"PUT",url:GO.contextRoot+"ad/api/menu/order",data:JSON.stringify({ids:e}),dataType:"json",contentType:"application/json;",success:function(e){t.set("menuConfigModel",e.data)}})},hasOneActive:function(){return this.getActiveMenus().length==1},getInitMenu:function(){return _.find(this.getActiveMenus(),function(e){return e.initial})}});return n});