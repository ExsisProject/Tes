(function(){define(["jquery","backbone","app","hgn!admin/templates/survey_all","hgn!admin/templates/list_empty","i18n!nls/commons","i18n!admin/nls/admin","i18n!survey/nls/survey","jquery.go-popup","jquery.go-sdk","jquery.go-grid","jquery.go-orgslide","jquery.go-validation","GO.util"],function(e,t,n,r,i,s,o,u){var a={label_id:o["\uc77c\ub828\ubc88\ud638"],search:s["\uac80\uc0c9"],label_delete:s["\uc0ad\uc81c"],label_progress:s["\uc9c4\ud589\uc911"],progress:s["\uc9c4\ud589"],label_stop:s["\uc911\uc9c0"],label_finish:s["\uc644\ub8cc"],label_tmp:s["\uc784\uc2dc\uc800\uc7a5"],label_ready:s["\uc900\ube44\uc911"],label_no:o["\ubc88\ud638"],label_status:o["\uc0c1\ud0dc"],label_title:s["\uc81c\ubaa9"],label_perior:s["\uc124\ubb38 \uae30\uac04"],label_writer:s["\uc791\uc131\uc790"]},f=t.View.extend({el:"#layoutContent",initialize:function(){this.listEl="#surveyList",this.dataTable=null,this.unbindEvent(),this.bindEvent()},unbindEvent:function(){this.$el.off("click","#search_survey"),this.$el.off("keydown","span.search_wrap input"),this.$el.off("click","span#btn_progress"),this.$el.off("click","span#btn_stop"),this.$el.off("click","span#btn_finished"),this.$el.off("click","span#btn_delete"),this.$el.off("click","div#surveyList_wrapper input:checkbox")},bindEvent:function(){this.$el.on("click","#search_survey",e.proxy(this.search,this)),this.$el.on("keydown","span.search_wrap input",e.proxy(this.searchKeyboardEvent,this)),this.$el.on("click","span#btn_progress",e.proxy(this.changeSurveyStatus,this)),this.$el.on("click","span#btn_stop",e.proxy(this.changeSurveyStatus,this)),this.$el.on("click","span#btn_finished",e.proxy(this.changeSurveyStatus,this)),this.$el.on("click","span#btn_delete",e.proxy(this.deleteSurvey,this)),this.$el.on("click","div#surveyList_wrapper input:checkbox",e.proxy(this.toggleCheckbox,this))},search:function(){var t=this.$el.find(".table_search input[type='text']"),r=t.val();if(r.length>64){e.goAlert(n.i18n(o["0\uc790\uc774\uc0c1 0\uc774\ud558 \uc785\ub825\ud574\uc57c\ud569\ub2c8\ub2e4."],{arg1:"1",arg2:"64"}));return}this.dataTable.tables.search(this.$el.find(".table_search select").val(),r,t)},searchKeyboardEvent:function(e){e.keyCode==13&&this.search()},changeSurveyStatus:function(t){var n=e(t.currentTarget).attr("data-status"),r=this,i=this.$el.find('input[type="checkbox"]:checked');if(i.size()==0){e.goAlert(s["\uc124\ubb38\uc744 \uc120\ud0dd\ud558\uc138\uc694."]);return}var o=GO.contextRoot+"ad/api",a={ids:[]};for(var f=0;f<i.length;f++){if(i[f].value=="on")continue;a.ids.push(parseInt(i[f].value))}if(a.ids.length==0)return;if(n=="progress")e.go(o+"/survey/status/progress",JSON.stringify(a),{qryType:"POST",contentType:"application/json",responseFn:function(t){e.goMessage(s["\ubcc0\uacbd\ub418\uc5c8\uc2b5\ub2c8\ub2e4."]),r.render()},error:function(t){e.goMessage(s["\uc2e4\ud328\ud588\uc2b5\ub2c8\ub2e4."])}});else if(n=="stop")e.go(o+"/survey/status/stop",JSON.stringify(a),{qryType:"POST",contentType:"application/json",responseFn:function(t){e.goMessage(s["\ubcc0\uacbd\ub418\uc5c8\uc2b5\ub2c8\ub2e4."]),r.render()},error:function(t){e.goMessage(s["\uc2e4\ud328\ud588\uc2b5\ub2c8\ub2e4."])}});else{if(n!="finished")return;e.goConfirm(u["\uc124\ubb38 \ub9c8\uac10 \ud655\uc778 \ud0c0\uc774\ud2c0"],"",function(){e.go(o+"/survey/status/finished",JSON.stringify(a),{qryType:"POST",contentType:"application/json",responseFn:function(t){e.goMessage(s["\ubcc0\uacbd\ub418\uc5c8\uc2b5\ub2c8\ub2e4."]),r.render()},error:function(t){e.goMessage(s["\uc2e4\ud328\ud588\uc2b5\ub2c8\ub2e4."])}})})}},deleteSurvey:function(){var t=this,n=this.$el.find('input[type="checkbox"]:checked');if(n.size()==0){e.goAlert(s["\uc124\ubb38\uc744 \uc120\ud0dd\ud558\uc138\uc694."]);return}var r=GO.contextRoot+"ad/api/survey",i={ids:[]};for(var u=0;u<n.length;u++){if(n[u].value=="on")continue;i.ids.push(parseInt(n[u].value))}if(i.ids.length==0)return;e.goCaution(o["\uc124\ubb38\uc0ad\uc81c\uc9c8\ubb38"],o["\uc0ad\uc81c\uacbd\uace0"],function(){var n=GO.contextRoot+"ad/api/survey";e.go(n,JSON.stringify(i),{qryType:"DELETE",contentType:"application/json",responseFn:function(n){e.goMessage(s["\uc0ad\uc81c\ub418\uc5c8\uc2b5\ub2c8\ub2e4."]),t.render()},error:function(t){e.goMessage(s["\uc2e4\ud328\ud588\uc2b5\ub2c8\ub2e4."])}})})},toggleCheckbox:function(t){var n=this,r=e(t.currentTarget),i=this.$el.find('input[type="checkbox"]:checked');r.is(":checked")?r.attr("checked",!0):(this.$el.find("#checkedAll").attr("checked",!1),r.attr("checked",!1));var s=n.$el.find("#btn_progress"),o=n.$el.find("#btn_stop"),u=n.$el.find("#btn_finished");s.css("display",""),o.css("display",""),u.css("display",""),i.attr("data-value",function(e,t){console.log(t),t=="progress"?s.css("display","none"):t=="stop"?(o.css("display","none"),u.css("display","none")):t=="temp"||t=="finished"?(s.css("display","none"),o.css("display","none"),u.css("display","none")):t=="ready"&&(o.css("display","none"),u.css("display","none"))})},render:function(){this.$el.empty(),this.$el.html(r({lang:a})),this.renderSurveyAllList()},renderSurveyAllList:function(){var t=this,r=[],s=[],u=[],f=[],l=[];this.$tableEl=this.$el.find("#surveyList"),this.dataTable=e.goGrid({el:this.listEl,method:"GET",url:GO.contextRoot+"ad/api/survey/all",emptyMessage:i({label_desc:o["\uc124\ubb38 \uc5c6\uc74c"]}),defaultSorting:[[1,"desc"]],pageUse:!0,checkbox:!0,sDomType:"admin",checkboxData:"id",displayLength:n.session("adminPageBase"),columns:[{mData:null,sWidth:"80px",bSortable:!1,fnRender:function(e){var t=e.oSettings;return t._iRecordsTotal-t._iDisplayStart-e.iDataRow}},{mData:"status",sClass:"align_c",sWidth:"100px",bSortable:!0,fnRender:function(e){var t=e.aData.status;return t=="progress"?(r.push(e.aData.id),a.label_progress):t=="stop"?(s.push(e.aData.id),a.label_stop):t=="finished"?(u.push(e.aData.id),a.label_finish):t=="ready"?(f.push(e.aData.id),a.label_ready):(l.push(e.aData.id),a.label_tmp)}},{mData:"title",sClass:"title",bSortable:!0,fnRender:function(e){return e.aData.title}},{mData:null,bSortable:!0,sWidth:"350px",sClass:"align_c",fnRender:function(e){return GO.util.basicDate(e.aData.startTime)+" ~ "+GO.util.basicDate(e.aData.endTime)}},{mData:"creatorName",sWidth:"200px",sClass:"title",bSortable:!0,fnRender:function(e){return e.aData.creatorName+" "+e.aData.creator.position}}],fnDrawCallback:function(n){t.$el.find(".toolbar_top .custom_header").append(t.$el.find("#controlButtons").show()),e(l).each(function(e,n){t.$tableEl.find('input[type="checkbox"][name="id"][value="'+n+'"]').attr("data-value","temp")}),e(r).each(function(e,n){t.$tableEl.find('input[type="checkbox"][name="id"][value="'+n+'"]').attr("data-value","progress")}),e(s).each(function(e,n){t.$tableEl.find('input[type="checkbox"][name="id"][value="'+n+'"]').attr("data-value","stop")}),e(u).each(function(e,n){t.$tableEl.find('input[type="checkbox"][name="id"][value="'+n+'"]').attr("data-value","finished")}),e(f).each(function(e,n){t.$tableEl.find('input[type="checkbox"][name="id"][value="'+n+'"]').attr("data-value","ready")})}})}});return f})}).call(this);