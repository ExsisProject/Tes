define(["jquery","underscore","backbone","app","hgn!admin/templates/appr_line_rule_list","hgn!admin/templates/appr_line_rule_list_item","hgn!approval/templates/doclist_empty","i18n!approval/nls/approval","i18n!nls/commons","i18n!admin/nls/admin","jquery.ui","jquery.go-sdk"],function(e,t,n,r,i,s,o,u,a,f){var l=r.contextRoot+"ad/api/",c={"\uc790\ub3d9\uacb0\uc7ac\uc120 \uba85":u["\uc790\ub3d9\uacb0\uc7ac\uc120 \uba85"],"\uc801\uc6a9\ub41c \uc591\uc2dd\uc218":f["\uc801\uc6a9\ub41c \uc591\uc2dd\uc218"],"\uacb0\uc7ac\uc120":u["\uacb0\uc7ac\uc120"],"\uc790\ub3d9\uacb0\uc7ac\uc120 \uc124\uc815":f["\uc790\ub3d9\uacb0\uc7ac\uc120 \uc124\uc815"],"\uc21c\uc11c\ubc14\uafb8\uae30":a["\uc21c\uc11c\ubc14\uafb8\uae30"],"\uc21c\uc11c\ubc14\uafb8\uae30 \uc644\ub8cc":a["\uc21c\uc11c\ubc14\uafb8\uae30 \uc644\ub8cc"],"\ucd94\uac00":a["\ucd94\uac00"],"\uc0ad\uc81c":a["\uc0ad\uc81c"],reorder_changed:a["\ubcc0\uacbd\ub418\uc5c8\uc2b5\ub2c8\ub2e4."],empty_msg:u["\uc790\ub8cc\uac00 \uc5c6\uc2b5\ub2c8\ub2e4"],delete_success_msg:a["\uc0ad\uc81c\ud558\uc600\uc2b5\ub2c8\ub2e4."],delete_fail_msg:a["\uc0ad\uc81c\ud558\uc9c0 \ubabb\ud588\uc2b5\ub2c8\ub2e4."]},h=n.Model.extend(),p=n.Collection.extend({model:h,url:function(){return r.contextRoot+"ad/api/approval/apprlinerule"}}),d=n.View.extend({el:"#layoutContent",initialize:function(){this.collection=new p,this.collection.bind("reset",this.resetList,this)},delegateEvents:function(t){this.undelegateEvents(),n.View.prototype.delegateEvents.call(this,t),this.$el.on("click.addLineRule","#btnAdd",e.proxy(this._addLineRule,this)),this.$el.on("click.delLineRule","#btnDelete",e.proxy(this._delLineRule,this)),this.$el.on("click.changeOrder","#btnReorder",e.proxy(this._changeOrder,this)),this.$el.on("click.saveOrder","#btnReorderSave",e.proxy(this._saveOrder,this)),this.$el.on("click.viewLineRule","td.name span.txt a",e.proxy(this._viewLineRule,this)),this.$el.on("click.checkLineRull","#check_all",e.proxy(this._checkLineRull,this))},undelegateEvents:function(){return n.View.prototype.undelegateEvents.call(this),this.$el.off(),this},_checkLineRull:function(t){var n=e(t.currentTarget),r=this.$el.find("input:checkbox");n.is(":checked")?r.attr("checked","checked"):r.removeAttr("checked")},_viewLineRule:function(t){var n=e(t.currentTarget).closest("tr").find("input:checkbox").val();r.router.navigate("approval/apprlinerule/"+n,{trigger:!0})},_addLineRule:function(){return r.router.navigate("approval/apprlinerule/create",{trigger:!0}),!1},_delLineRule:function(){var t=this,n=[],r=!1,i=this.$el.find("input[name=id]:checked");if(i.length==0)return e.goMessage(u["\uc591\uc2dd\uc744 \uc120\ud0dd\ud574 \uc8fc\uc138\uc694."]),!1;i.each(function(t,i){n.push(e(this).val()),e(i).closest("tr").find("td:eq(2)").text()!="0"&&(r=!0)});if(r)return e.goMessage(u["\uc774\ubbf8 \uc591\uc2dd\uc5d0 \uc801\uc6a9\uc911\uc778 \uc790\ub3d9\uacb0\uc7ac\uc120\uc740 \uc0ad\uc81c\ud560 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4"]),!1;e.goConfirm(f["\uc0ad\uc81c\ud558\uc2dc\uaca0\uc2b5\ub2c8\uae4c?"],"",function(){e.go(l+"approval/apprlinerule",JSON.stringify({ids:n}),{qryType:"DELETE",contentType:"application/json",async:!1,responseFn:function(n){e.goMessage(c.delete_success_msg),t.render()},error:function(n){e.goMessage(c.delete_fail_msg),t.render()}})})},_changeOrder:function(){e("#btnReorder").hide(),e("#btnReorderSave").show(),this._renderForReorderView()},_renderForReorderView:function(){if(this.$("table tbody tr").length==0)return e.goMessage(c.empty_msg),!1;this.$("table tbody").sortable({opacity:"1",delay:100,cursor:"move",items:"tr",containment:".content_page",hoverClass:"ui-state-hover",helper:"clone",placeholder:"ui-sortable-placeholder",cancel:".disabled",start:function(e,t){t.placeholder.html(t.helper.html()),t.placeholder.find("td").css("padding","5px 10px")}}),this._sortableSwitch("on")},_saveOrder:function(){var t=l+"approval/apprlinerule/sort",n,r;n=this.$("table tbody tr").map(function(t,n){return e(n).find('input[name="id"]').val()}).get(),r=function(t){t.code==200?(e.goMessage(c.reorder_changed),e("#btnReorder").show(),e("#btnReorderSave").hide(),this._sortableSwitch("off")):t.code!=200&&(e.goMessage(t.message),this.render())},e.go(t,JSON.stringify({ids:n}),{async:!1,qryType:"PUT",contentType:"application/json",responseFn:e.proxy(r,this)})},_sortableSwitch:function(e){e=="on"?(this.$("table tbody").addClass("ui-sortable"),this.$("table tbody tr").removeClass("disabled")):e=="off"&&(this.$("table tbody").removeClass("ui-sortable"),this.$("table tbody tr").addClass("disabled"))},render:function(){this.$el.html(i({lang:c})),e("#btnReorderSave").hide(),this.collection.fetch({statusCode:{403:function(){r.util.error("403")},404:function(){r.util.error("404",{msgCode:"400-common"})},500:function(){r.util.error("500")}},reset:!0})},resetList:function(t){e(".chart.tb_admin_autoApproveLine > tbody").empty(),t.length==0?e(".chart.tb_admin_approval > tbody").append(this._renderEmptyTmpl({lang:c})):e(t.toJSON()).each(function(t,n){var r={id:n.id,name:n.name,adjustedFormCount:n.adjustedFormCount,apprLineSummary:n.apprLineSummary};e(".chart.tb_admin_autoApproveLine > tbody").append(s({data:r}))})},_renderEmptyTmpl:function(e){var t=[];t.push("    <tr>"),t.push('        <td colspan="4">'),t.push('            <p class="data_null">'),t.push('                <span class="ic_data_type ic_no_data"></span>'),t.push('                <span class="txt">{{lang.empty_msg}}</span>'),t.push("            </p>"),t.push("        </td>"),t.push("    </tr>");var n=Hogan.compile(t.join("\n"));return n.render(e)},release:function(){this.$el.off(),this.$el.empty()}});return d});