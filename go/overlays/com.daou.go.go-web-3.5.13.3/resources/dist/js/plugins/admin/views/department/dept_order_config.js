(function(){define(["jquery","backbone","hgn!admin/templates/department/dept_order_config","i18n!nls/commons","i18n!admin/nls/admin","GO.util"],function(e,t,n,r,i){var s={use:i["\uc0ac\uc6a9\ud568"],disUse:r["\uc0ac\uc6a9\ud558\uc9c0 \uc54a\uc74c"],defaultConfigUse:i["\uae30\ubcf8 \uc124\uc815\uac12\uc744 \uc0ac\uc6a9\ud569\ub2c8\ub2e4."],orderPriority:i["\uc815\ub82c \uc21c\uc11c"],allDeptApply:i["\uc804\uccb4 \ubd80\uc11c\uc5d0 \uc801\uc6a9\ub429\ub2c8\ub2e4."],memberType:i["\uba64\ubc84\ud0c0\uc785"],positionCode:i["\uc9c1\uc704"],gradeCode:i["\uc9c1\uae09"],titleCode:i["\uc9c1\ucc45"],empCode:i["\uc0ac\ubc88"]+"/"+i["\ud559\ubc88"],email:r["\uc774\uba54\uc77c"],add:r["\ucd94\uac00"],remove:r["\uc0ad\uc81c"]},o=t.View.extend({events:{"click #btnAddOrderItem":"addOrderItem","click #btnDeleteOrderItem":"deleteOrderItem"},initialize:function(e){this.$parentEl=e.$parentEl,this.deptOrderConfigModel=new t.Model,this.deptOrderConfigModel.url=GO.contextRoot+"ad/api/department/orderconfig"},render:function(e){this.deptOrderConfigModel.fetch({async:!1});var t=this.deptOrderConfigModel.toJSON();return t.isOrderUse=t.use==="on"?!0:!1,this.$el.html(n({lang:s,config:t,getItemValue:function(){return s[this]}})),this.$el.find(".title").css("margin","10px 0px"),this.$el.find("#divOrderPriority").sortable({opacity:"1",delay:100,cursor:"move",items:"li",containment:"#divOrderPriority",hoverClass:"ui-state-hover",placeholder:"ui-sortable-placeholder",start:function(e,t){t.helper.addClass("move")},stop:function(e,t){t.item.removeClass("move")}}),this.customFieldRender(),this},formSubmit:function(e){e.preventDefault();return},addOrderItem:function(t){var n=this.$el.find("#selAddOrderItem").val(),r=this.$el.find("#selAddOrderItem option:selected").text(),o=this.getOrderItems();if(e.inArray(n,o)>-1){this.$el.find("#message").text(i["\uc774\ubbf8 \ucd94\uac00\ub41c \ud56d\ubaa9\uc785\ub2c8\ub2e4."]),this.$el.find("#message").show();var u=this;setTimeout(function(){u.$el.find("#message").hide(),u.$el.find("#message").text("")},1e3);return}var a='<li id="li'+n+'">';a+='<input name="orderItems" type="hidden" value="'+n+'" />',a+='<span class="txt">'+r+"</span>",a+='<span class="btn_wrap"><span id="btnDeleteOrderItem" class="ic_dashboard2 ic_d_delete" title="'+s.remove+'"></span></span>',a+="</li>",this.$el.find("#ulSelectedOrderPriority").append(a)},deleteOrderItem:function(t){var n=e(t.currentTarget);e("#ulSelectedOrderPriority li").length>1?n.parent("span").parent("li").remove():e.goAlert("\uc815\ub82c \uc21c\uc11c\ub294 \ud55c \uac1c\uc774\uc0c1 \uc124\uc815\ub418\uc5b4\uc57c \ud569\ub2c8\ub2e4.")},saveOrderConfig:function(){var t=this,n=GO.util.serializeForm(this.$el.find("#frmDeptOrderConfig")),s=this.getOrderItems();if(n.use=="on"&&s.length<1){this.$el.find("#message").show(),this.$el.find("#message").text(i["\uc815\ub82c \uc21c\uc11c\ub97c \ucd94\uac00\ud574 \uc8fc\uc2ed\uc2dc\uc624."]),setTimeout(function(){t.$el.find("#message").hide(),t.$el.find("#message").text("")},1e3);return}n.orderItems=s,this.deptOrderConfigModel.save(n,{async:!1,success:function(){t.$parentEl&&t.$parentEl.trigger("orgChanged"),e.goMessage(r["\uc800\uc7a5\ub418\uc5c8\uc2b5\ub2c8\ub2e4."]),e.goPopup.close()},error:function(t,n){n.message?e.goAlert(n.message):e.goMessage(r["\uc2e4\ud328\ud588\uc2b5\ub2c8\ub2e4."])}})},getOrderItems:function(){var e=GO.util.serializeForm(this.$el.find("#frmDeptOrderConfig")),t=[];return e.orderItems&&(typeof e.orderItems=="string"?t[0]=e.orderItems:t=e.orderItems),t},customFieldRender:function(){var t=this;e.go(GO.contextRoot+"ad/api/customprofile/use/config/order",{},{qryType:"GET",async:!1,responseFn:function(n){e.each(n.data,function(e,n){t.$("#selAddOrderItem").append('<option value="'+n.profileName+'">'+n.name+"</option>"),t.$("#li"+n.profileName)!=undefined&&t.$("#li"+n.profileName).find("span.txt").text(n.name)})},error:function(t){var n=JSON.parse(t.responseText);e.goMessage(n.message)}})}});return o})}).call(this);