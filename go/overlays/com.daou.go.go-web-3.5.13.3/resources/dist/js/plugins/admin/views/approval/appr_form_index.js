(function(){define(["jquery","backbone","app","i18n!nls/commons","i18n!admin/nls/admin","i18n!approval/nls/approval","hgn!admin/templates/appr_form_index","admin/views/appr_form_list","admin/views/appr_form_config_batch_list","approval/views/apprform/appr_form_tree","jquery.go-sdk","jquery.jstree","jquery.go-popup","jquery.go-grid","jquery.go-orgslide","jquery.go-validation"],function(e,t,n,r,i,s,o,u,a,f){var l,c={head_title:s["\uacb0\uc7ac \uc591\uc2dd \uad00\ub9ac"],appr_form_folder_list:s["\uacb0\uc7ac\uc591\uc2dd \ud3f4\ub354 \ubaa9\ub85d"],folder_name:r["\ud3f4\ub354\uba85"],folder_add:r["\ud3f4\ub354 \ucd94\uac00"],folder_modify:r["\uc218\uc815"],folder_delete:r["\uc0ad\uc81c"],selected_folder:r["\uc120\ud0dd\ub41c \ud3f4\ub354"],form_add:s["\uc591\uc2dd \ucd94\uac00"],form_delete:s["\uc591\uc2dd \uc0ad\uc81c"],reorder:i["\uc21c\uc11c\ubc14\uafb8\uae30"],reorder_done:i["\uc21c\uc11c\ubc14\uafb8\uae30 \uc644\ub8cc"],folder_delete_message:r["\ud3f4\ub354 \uc0ad\uc81c"],folder_delete_confirm:r["\ud3f4\ub354\ub97c \uc0ad\uc81c\ud558\uc2dc\uaca0\uc2b5\ub2c8\uae4c?"],null_data:s["\ub4f1\ub85d\ub41c \uacb0\uc7ac \uc591\uc2dd\uc774 \uc5c6\uc2b5\ub2c8\ub2e4."],select_folder:r["\ud3f4\ub354\ub97c \uc120\ud0dd\ud574 \uc8fc\uc2ed\uc2dc\uc624."],cannot_update:r["\ucd5c\uc0c1\uc704 \ud3f4\ub354\ub97c \uc218\uc815\ud560 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4."],cannot_delete:r["\uc0ad\uc81c\ud560 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4."],cannot_delete_root:r["\ucd5c\uc0c1\uc704 \ud3f4\ub354\ub294 \uc0ad\uc81c\ud560 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4."],cannot_delete_parent:s["\uc591\uc2dd\uc774 \uc788\uac70\ub098 \ud558\uc704 \ud3f4\ub354\uac00 \uc788\ub294 \uacbd\uc6b0\ub294 \uc0ad\uc81c\ud560 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4."],save_success:r["\uc800\uc7a5\ub418\uc5c8\uc2b5\ub2c8\ub2e4."],already_used_name:r["\uc774\ubbf8 \uc0ac\uc6a9\uc911\uc778 \uc774\ub984\uc785\ub2c8\ub2e4."],"\uc800\uc7a5":r["\uc800\uc7a5"],"\uc0ac\uc6a9\uc5ec\ubd80":i["\ud3f4\ub354 \ub178\ucd9c \uc5ec\ubd80"],"\uc6b4\uc601\uc790":i["\uc6b4\uc601\uc790"],"\uc0ac\uc6a9\uc5ec\ubd80 \ud234\ud301":i["\uacb0\uc7ac\uc591\uc2dd \uad00\ub9ac \uc0ac\uc6a9\uc5ec\ubd80 \ud234\ud301"],"\uc815\uc0c1":i["\uc815\uc0c1"],"\uc228\uae40":i["\uc228\uae40"],"\uc77c\uad04\uc124\uc815":i["\uc77c\uad04\uc124\uc815"],form_input:i["\uc591\uc2dd \uc81c\ubaa9\uc744 \uc785\ub825\ud558\uc138\uc694."]};return l=t.View.extend({treeView:null,formListView:null,batchListView:null,initialize:function(){this._initEventBinding()},_initEventBinding:function(){this.$el.off(),this.$el.on("click","span#btnFolderCreate",e.proxy(this._beforeCreate,this)),this.$el.on("click","span#btnFolderUpdate",e.proxy(this._beforeUpdate,this)),this.$el.on("click","span#btnFolderDelete",e.proxy(this._beforeDelete,this)),this.$el.on("click","span#btnFormCreate",e.proxy(this._goToFormCreate,this)),this.$el.on("click","span#btnFormDelete",e.proxy(this._deleteForm,this)),this.$el.on("click","span#btnFormReorder",e.proxy(this._renderFormReorderView,this)),this.$el.on("click","span#btnFormReorderUpdate",e.proxy(this._updateReorderedList,this)),this.$el.on("click","span#folderStateSave",e.proxy(this._folderStateSave,this)),this.$el.on("click","span#popupSetting",e.proxy(this.popupSetting,this)),this.$el.on("keyup","input#search",e.proxy(this.searchNode,this))},searchNode:function(t){var n=e(t.currentTarget),r=this;if(t.keyCode==13){r._renderTreeView();return}clearTimeout(this.clearTimeOut),this.clearTimeOut=setTimeout(function(){if(t){var i=e.trim(n.val());i!=""&&(r.keyword=i,r._renderTreeView()),i==""&&r._renderTreeView()}},500)},render:function(){return this.$el.html(o({lang:c})),this._renderTreeView(),this},popupSetting:function(){var e=this;this.batchListView=new a,this.batchListView.fetchSecurity().done(function(){e.batchListView.render()})},_renderTreeView:function(){var t={select:function(e){this._renderFormListView(e)},rename:function(e){this.$el.find("#appr_form_list .header_group .critical h3").text(e)}};this.treeView=new f({isAdmin:!0,keyword:this.$el.find("#search").val().trim(),treeElementId:"folderTree",selectCallback:e.proxy(t.select,this),renameCallback:e.proxy(t.rename,this)}),this.treeView.render();var n=this;setTimeout(function(){var t=GO.util.store.get("appr_form_index:folderId"),r=n.treeView.getSelectedNodeData();GO.util.store.set("appr_form_index:folderId",null),t&&t!=r.id&&e("a[nodeid='"+t+"']").trigger("click")},1e3)},_renderFormListView:function(t){var n=this.$el.find("#tool_bar"),r=n.next();r.length>0&&r.empty();var i=e("a.jstree-hovered").attr("id");i!=undefined&&(i=i.replace("form_","")),this.formListView=new u({folderId:t.id,formId:i}),n.after(this.formListView.$el),this.$el.find("#appr_form_list .header_group .critical h3").text(t.folderName),t.folderState=="HIDDEN"?this.$("#folderState_HIDDEN").prop("checked",!0):this.$("#folderState_NORMAL").prop("checked",!0),this.$("#appr_option_group").toggle(t.type!="ROOT"),this.formListView.render(e.proxy(this._makeFormDraggableToFolder,this))},_folderStateSave:function(){var t=this,n=this.treeView.getSelectedNodeData(),i=n.id,s=this.$('input[name="folderState"]:checked').val();e.go(GO.contextRoot+"ad/api/approval/formfolder"+"/"+n.id,JSON.stringify({id:i,folderState:s}),{qryType:"PUT",contentType:"application/json",async:!1,responseFn:function(n){e.goMessage(r["\uc800\uc7a5\ub418\uc5c8\uc2b5\ub2c8\ub2e4."]);var s=jQuery.jstree._reference(t.treeView._getTreeElement()),o=s._get_node(null,!1),u=s._get_parent(o);s.refresh(u),_.delay(function(){e("a[nodeid='"+i+"']").trigger("click")},500)},error:function(t){e.goMessage(r["\uc800\uc7a5\uc5d0 \uc2e4\ud328 \ud558\uc600\uc2b5\ub2c8\ub2e4."])}})},_makeFormDraggableToFolder:function(){var t=this;if(!this.formListView)return!1;this.draggable=this.formListView.getDraggable();if(this.formListView.dataTable.tables.isEmpty())return;e(this.draggable.selector).draggable({cursorAt:{top:5},helper:"clone",revert:"invalid",start:this.draggable.startCallback});var n=this.treeView.getDroppable();e(n.selector).droppable({over:function(t,r){var i=n.overCallback(e(r.draggable),e(this));i.done(this.draggable.markAsDroppable),i.fail(this.draggable.markAsNotDroppable)},out:function(t,r){var i=n.outCallback(e(r.draggable),e(this));i.always(this.draggable.markAsNotDroppable)},drop:function(r,i){var s=n.dropCallback(e(i.draggable),e(this));if(!s)return;s.done(function(){t.formListView.refreshList(),t.treeView.render()})}})},_beforeCreate:function(){this.treeView.renderNewFolderInput(c.folder_name)},_beforeUpdate:function(){this.treeView.renderRenameFolderInput()},_beforeDelete:function(){if(!this.formListView.isEmpty())return e.goMessage(c.cannot_delete_parent),!1;this.treeView.deleteSelectedFolder()},_goToFormCreate:function(){var t=this.treeView.getSelectedNodeData();return t.id?(GO.router.navigate("approval/formfolder/"+t.id+"/apprform/new",!0),!1):(e.goMessage(c.select_folder),!1)},_deleteForm:function(){this.formListView.deleteSelected()},_renderFormReorderView:function(t){e(this.draggable.selector).unbind(),this.$el.find("#btnFormCreate").hide(),this.$el.find("#btnFormDelete").hide(),this.$el.find("#btnFormReorder").hide(),this.$el.find("#btnFormReorderUpdate").show(),this.formListView.renderForReorderView()},_updateReorderedList:function(e){this.$el.find("#btnFormCreate").show(),this.$el.find("#btnFormDelete").show(),this.$el.find("#btnFormReorder").show(),this.$el.find("#btnFormReorderUpdate").hide(),this.formListView.saveReorderedList(),this.formListView.refreshList(),this.treeView.render()}}),l})}).call(this);