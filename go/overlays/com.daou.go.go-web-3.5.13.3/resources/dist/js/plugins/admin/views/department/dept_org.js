(function(){define(["jquery","underscore","backbone","app","admin/models/department","system/models/licenseModel","admin/views/department/dept_org_member_duty","admin/views/department/dept_org_member_type","admin/views/department/dept_order_config","admin/views/department/org_exposure_config","admin/views/department/mail_exposure_config","admin/views/account/account_create","admin/views/account/account_detail","admin/views/department/dept_detail","admin/views/department/add_dept","admin/views/department/org_list","admin/views/department/dept_file","admin/views/org_sync_button","hgn!admin/templates/dept_org","hgn!admin/templates/dept_org_title","hgn!admin/templates/dept_fail_alert","hgn!admin/templates/_edit_dept","hgn!admin/templates/_add_dept_member","hgn!admin/templates/org_member","i18n!admin/nls/admin","i18n!nls/commons","go-ignoreduplicatemethod","jquery.go-sdk","jquery.jstree.hotkeys","jquery.jstree","jquery.go-popup","jquery.go-grid","jquery.go-orgslide","jquery.go-validation","jquery.go-preloader","GO.util"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C){var k=GO.contextRoot+"ad/api/",L={edit:N["\uc218\uc815"],add:N["\ucd94\uac00"],add_member:T["\ubd80\uc11c\uc6d0 \ucd94\uac00"],download:T["\ub2e4\uc6b4\ub85c\ub4dc"],"delete":N["\uc0ad\uc81c"],ok:N["\ud655\uc778"],cancel:N["\ucde8\uc18c"],org:T["\uc870\uc9c1\ub3c4"],dept_s:T["\ubd80\uc11c_\uc904\uc784"],dept:T["\ubd80\uc11c"],dept_org:T["\uc870\uc9c1\ub3c4 \uad00\ub9ac"],dept_list:T["\uc870\uc9c1\ub3c4 \ubaa9\ub85d"],dept_name:T["\ubd80\uc11c\uba85"],dept_delete:T["\ubd80\uc11c \uc0ad\uc81c"],dept_delete_confirm:T["\ubd80\uc11c\uc0ad\uc81c?"],dept_migration:T["\ub370\uc774\ud130 \uc774\uad00 \ubc14\ub85c\uac00\uae30"],member_name:T["\uc774\ub984 (\uc774\uba54\uc77c)"],member_grade:T["\uc9c1\uc704"],member_email:T["\uc774\uba54\uc77c"],member_duty:T["\uc9c1\ucc45"],dept_info:T["\ubd80\uc11c \uc815\ubcf4"],dept_member_list:T["\ubd80\uc11c\uc6d0 \ubaa9\ub85d"],dept_file:T["\ubd80\uc11c \uc790\ub8cc"],member_type:T["\uba64\ubc84\ud0c0\uc785"],dept_mail_id:T["\ubd80\uc11c\uba54\uc77c\uc544\uc774\ub514"]+"\u3000\u3000\u3000",dept_code_id:T["\ubd80\uc11c\ucf54\ub4dc"]+"\u3000\u3000\u3000",dept_alias_id:T["\ubd80\uc11c\uc57d\uc5b4"]+"\u3000\u3000\u3000",dept_mail_id_explanation:T["\ubd80\uc11c\uba54\uc77c\uc544\uc774\ub514"],dept_code_id_explanation:T["\ubd80\uc11c\ucf54\ub4dc"],dept_alias_id_explanation:T["\ubd80\uc11c\uc57d\uc5b4"],dept_mail_invalid_msg:T["\uc0ac\uc6a9\ud560 \uc218 \uc5c6\ub294 \uc774\uba54\uc77c\uc785\ub2c8\ub2e4."],dept_mail_already_msg:T["\uc774\ubbf8 \uc0ac\uc6a9\uc911\uc778 \uc774\uba54\uc77c\uc785\ub2c8\ub2e4."],dept_code_invalid_msg:T["\uc0ac\uc6a9\ud560 \uc218 \uc5c6\ub294 \ubd80\uc11c\ucf54\ub4dc\uc785\ub2c8\ub2e4."],dept_code_already_msg:T["\uc774\ubbf8 \uc0ac\uc6a9\uc911\uc778 \ubd80\uc11c\ucf54\ub4dc\uc785\ub2c8\ub2e4."],dept_alias_invalid_msg:T["\uc0ac\uc6a9\ud560 \uc218 \uc5c6\ub294 \ubd80\uc11c\uc57d\uc5b4\uc785\ub2c8\ub2e4."],dept_alias_already_msg:T["\uc774\ubbf8 \uc0ac\uc6a9\uc911\uc778 \ubd80\uc11c\uc57d\uc5b4\uc785\ub2c8\ub2e4."],check_validation:T["0\uc790\uc774\ud558 \uc785\ub825\ud574\uc57c\ud569\ub2c8\ub2e4."],dept_member_select_msg:T["\ubd80\uc11c\uc6d0\uc744\uc120\ud0dd\ud558\ub77c"],member_reorder_desc:T["\ubd80\uc11c \ub610\ub294 \uc21c\uc11c\ubcc0\uacbd"],org_add_desc:T["\ubd80\uc11c\uc6d0 \ucd94\uac00 \uc124\uba85"],none:T["\ubbf8\uc9c0\uc815"],dept_member_move_success:T["\ub561\ub561\ub2d8\uc774 \ub561\ub599\ubd80\uc11c\ub85c \uc774\ub3d9\ub418\uc5c8\uc2b5\ub2c8\ub2e4."],dept_member_move_error:T["\uc774\ub3d9\uc5d0 \uc2e4\ud328\ud558\uc600\uc2b5\ub2c8\ub2e4."],already_added_member:T["\uc774\ubbf8 \ubd80\uc11c\uc6d0"],org_master_changed:T["\ubd80\uc11c\uc7a5 \ubcc0\uacbd"],no_select_dept_mgs:T["\ubd80\uc11c\ub97c \uc120\ud0dd\ud574 \uc8fc\uc2ed\uc2dc\uc624."],save_success:N["\uc800\uc7a5\ub418\uc5c8\uc2b5\ub2c8\ub2e4."],MASTER:T["\ubd80\uc11c\uc7a5"],MODERATOR:T["\ubd80\ubd80\uc11c\uc7a5"],MEMBER:T["\ubd80\uc11c\uc6d0"],select_file:T["\ud30c\uc77c\uc120\ud0dd"],duplicate_data:T["\uc911\ubcf5\ub370\uc774\ud130 \ucc98\ub9ac"],ignore:T["\ucd94\uac00\ud558\uc9c0 \uc54a\uc74c"],dept_member_manage:T["\ubd80\uc11c\uc6d0 \uad00\ub9ac"],dept_org_import_fail:T["\ub4f1\ub85d\uc774 \uc2e4\ud328\ud55c \uc870\uc9c1 \ubaa9\ub85d \ub2e4\uc6b4\ub85c\ub4dc"],dept_member_import_fail:T["\ub4f1\ub85d\uc774 \uc2e4\ud328\ud55c \ubd80\uc11c\uc6d0 \ubaa9\ub85d \ub2e4\uc6b4\ub85c\ub4dc"],"export":T["\ub0b4\ubcf4\ub0b4\uae30"],"import":T["\uac00\uc838\uc624\uae30"],close:N["\ub2eb\uae30"],orderConfig:T["\uc815\ub82c \uc124\uc815"],orderInit:T["\uc124\uc815\uac12\uc73c\ub85c \uc7ac\uc815\ub82c"],org_desc:T["\uc870\uc9c1\ub3c4 \uc124\uba85"],mail_exposure_config:T["\uba54\uc77c \uc8fc\uc18c \ub178\ucd9c \uc124\uc815"],dept_member_order_config:T["\ubd80\uc11c\uc6d0 \uc790\ub3d9 \uc815\ub82c \uc124\uc815"],org_exposure_config:T["\uc0ac\uc774\ud2b8 \uc870\uc9c1\ub3c4 \ub178\ucd9c \uc124\uc815"],dept_add:T["\ubd80\uc11c \ucd94\uac00"],dept_delete:T["\ubd80\uc11c \uc0ad\uc81c"],search:N["\uac80\uc0c9"],siteName_use_config:T["\uc0ac\uc774\ud2b8\uba85 \uc0ac\uc6a9 \uc5ec\ubd80"],orgUnfold_use_config:T["\uc870\uc9c1\ub3c4 \ud3bc\uce68 \uc5ec\ubd80"],org_unfold:T["\ud3bc\uce68"],org_fold:T["\ud3bc\uce58\uc9c0 \uc54a\uc74c"],siteName_use_config_tool_tip:T["\uc870\uc9c1\ub3c4\uc5d0 \uc0ac\uc774\ud2b8\uba85 \ub178\ucd9c\uc5ec\ubd80\ub97c \uc124\uc815\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4."],orgOpen_use_config_tool_tip:T["\ub85c\uadf8\uc778\ud6c4, \uc870\uc9c1\ub3c4 \ud3bc\uce68\uc5ec\ubd80\ub97c \uc124\uc815\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4."],org_exposure_config_ok:N["\uc800\uc7a5"],org_exposure_config_cancel:N["\ucde8\uc18c"],label_use:T["\uc0ac\uc6a9\ud568"],label_notuse:N["\uc0ac\uc6a9\ud558\uc9c0 \uc54a\uc74c"],"delete":N["\uc0ad\uc81c"],create_new_member:T["\uc2e0\uaddc \uba64\ubc84 \uc0dd\uc131"],create_new_dept_Member:T["\uc2e0\uaddc \ubd80\uc11c\uc6d0 \uc0dd\uc131"],dept_unspecified_member:T["\ubd80\uc11c \ubbf8\uc9c0\uc815 \uba64\ubc84"],download_batch_register:T["\ub0b4\ub824\ubc1b\uae30/\uc77c\uad04\ub4f1\ub85d"],manual_sync:T["\ucc44\ub110 \uc989\uc2dc \ub3d9\uae30\ud654"]},A=n.View.extend({events:{"click #orgDeptCreate":"addDept","click #orgDeptDelete":"_deleteDept","click table#deptMembers span.btn_member_job":"addDutyChangeView","click table#deptMembers span.btn_member_type":"addTypeChangeView","click span#btnAddDeptMembers":"addDeptMembers","click #btnOrderConfig":"openOrderConfigPopup","click #btnOrgExposureConfig":"openOrgExposureConfigPopup","click #btnMailExposureConfig":"openMailExposureConfigPopup","click #closeAlert":"removeFailResult","click span#btn_ok":"orgExposureConfigSave","click span#btn_cancel":"orgExposureConfigCancel","click a#createNewMember":"createNewMember","click a#downloadBatchRegister":"goToBatchRegisterLink","click a#deptUnspecifiedMember":"showDeptUnspecifiedMember","click .content_tab li":"changeTab","click #orgSetting":"orgSettingToggle","click #searchInputReset":"resetSearchInput","keyup #search":"searchNode","focus #search":"focusSearch","focusout #search":"focusOutSearch","click .jstree-leaf":"clickNode"},initialize:function(e){this.options=e||{},this.searchDeptId=this.options.opt1||"",this.menus=this.options.menus,this.model=new n.Model,this.model.url=GO.contextRoot+"ad/api/department/csv";var r=new n.Model;r.url=GO.contextRoot+"ad/api/systeminfo",r.fetch({async:!1}),this.systemInfo=r.toJSON(),this.licenseModel=s.read(),this.deptModel=new i,this.orgSyncable=GO.config("orgSyncWaitMin")>0,this.$el.on("orgChanged",t.bind(this.handleOrgChanged,this))},render:function(){GO.EventEmitter.on("admin","refreshHeader",this.refreshHeader,this),this.treeEl=null,this.listEl=null;var t=this,n=e.cookie("jstree_select")=="#unspecified_-1";return this.getDeptRoot(),this.$el.html(y({lang:L,rootDeptName:this.rootDeptName,rootDeptCount:this.rootDeptCount,isUnspecified:n,orgSyncable:this.orgSyncable})),this.orgSyncButton=new g({description:GO.i18n(T["\uc870\uc9c1 \uc124\uacc4 \ub3d9\uae30\ud654 \uc124\uba85"],{term:GO.config("orgSyncWaitMin")})}),this.orgSyncButton.setElement(this.$("#manualSync")),this.orgSyncButton.render(),this.orgListView=new v,this.$el.find("#contentArea").append(this.orgListView.$el),this.orgListView.render(),this.renderTree(this.searchDeptId),this._updateUnspecifiedMemberCount(),this.bindResizing(),this.$el.on("click",function(n){var r=e(n.target);!r.parents().hasClass("layer_mini")&&!r.hasClass("layer_mini")&&t.prevSettingViewStatus==="block"&&e("#orgSettingView").hide(),t.prevSettingViewStatus=e("#orgSettingView").css("display")}),this},renderTree:function(n){var r=this,i=this.$el.find("#search").val(),s=k+"organization/admin/list";i?(this.keyword="",s=s+"?"+e.param({search:i})):n&&(e.removeCookie("jstree_select",{path:GO.contextRoot+"admin"}),e.removeCookie("jstree_select",{path:GO.contextRoot+"admin/dept"}),s=s+"?"+e.param({searchDeptId:n})),this.treeEl=this.$el.find("#orgMemTree").jstree({plugins:["themes","json_data","ui","crrm","cookies","dnd","types","hotkeys","search"],json_data:{ajax:{url:s,data:function(e){if(typeof e.data=="function")var t=e.data();return{deptid:t?t.id:r.loadId}},cache:!0,async:!0,success:function(e){}}},search:{case_sensitive:!1,show_only_matches:!0},core:{animation:120,strings:{loading:"&nbsp;"}},types:{valid_children:"none",types:{root:{valid_children:"all"},unspecified:{valid_children:["MEMBER"]},MEMBER:{valid_children:"none"},MASTER:{valid_children:"none"},MODERATOR:{valid_children:"none"}}},crrm:{move:{check_move:function(e){return!(e.o.attr("rel")==="unspecified"||e.np.attr("rel")==="root"&&e.p!=="last"&&e.np.data("childrenCount")+e.np.data("memberCount")<e.cp)}}},"defaults ":{html_titles:!1,move_node:!1,ccp:!0,width:200},ui:{select_limit:-1},hotkeys:{del:r._deleteDept,f2:function(){return!1},space:function(){return!1}}}).bind("loaded.jstree",function(i,s){n?r.treeEl.jstree("select_node",e("#orgMemTree li[nodeid="+n+"][rel!='MODERATOR'][rel!='MEMBER'][rel!='MASTER']"),!0):(t.isEmpty(e.cookie("jstree_select"))||e.cookie("jstree_select")=="#-1")&&r.treeEl.jstree("select_node",r._getRootNode(),!0)}).bind("load_node.jstree",function(e,t){r.treeEl.find('a[href="#"]').attr("data-bypass",1)}).bind("move_node.jstree",e.proxy(this._moveNode,this)).bind("select_node.jstree",function(t,n){e.goOrgSlide("close"),r.selectedObj=n.rslt.obj,r.selectedRel=r.selectedObj.attr("rel"),r.selectedObj.isModifyAlias=!1,r.selectedObj.isModifycode=!1,r.selectedObj.isModifyEmail=!1;var i=r.selectedObj.data("id"),s=r.selectedObj.parents("li:eq(0)");if(r.isMember(r.selectedRel))r.isClickedMember=!0,r.deptId=r.selectedObj.data("deptId"),this.deptModel=r.getDeptModelById(r.deptId),s.attr("rel")!=="unspecified"&&r.$el.find(".content_tab li [data-type='member_list']").trigger("click"),r.orgListView.onPreparedMemberListRendering(),r.orgListView.renderMember(i),r.treeEl.jstree("select_node",s,!0);else if(r.selectedRel==="unspecified")r.deptId=r.selectedObj.data("id"),this.deptModel=r.getDeptModelById(r.deptId),r.$el.find(".content_tab li [data-type='member_list']").trigger("click");else{if(r.isClickedMember){r.isClickedMember=!1;return}this.deptModel=r.getDeptModel(r.selectedObj.data());var o=r.$el.find("ul.content_tab li.active");n.rslt.e&&n.rslt.e.type=="click"?r.$el.find(".content_tab li [data-type='dept_info']").trigger("click"):o.trigger("click")}r._setDeptTitle(this.deptModel.toJSON())}).bind("refresh.jstree",function(e,t){GO.EventEmitter.trigger("admin","refreshFinish")})},bindResizing:function(){var t=this,n=new C(100);e(window).resize(function(r){if(!e.isWindow(r.target))return;n.bind(function(){t.resizeContent()})}),this.resizeContent()},resizeContent:function(){e("#leftContainer").height(e(window).height()-140),e("#rightContainer").height(e(window).height()-140),e("#treeContainer").height(e(window).height()-226),e("#deptMemberDiv").height(e(window).height()-295),e("#accountDetail").height(e(window).height()-387)},refreshHeader:function(e){this.deptModel=this.getDeptModelById(e),this._setDeptTitle(this.deptModel.toJSON())},getSelectedNode:function(){return this.treeEl.jstree("get_selected")},getSelectedDeptData:function(e){var n=this,r=n.getSelectedNode(),i={};return t.isEmpty(r.data())?(i.id=this.$el.find("#deptName").data("id"),i.name=this.$el.find("#deptName").text(),i):(this.isMember(r.attr("rel"))?(i.id=r.data("deptId"),i.name=r.data("deptName")):i=r.data(),i.rel=r.attr("rel"),typeof e!="undefined"?i[e]:i)},isMember:function(e){return e==="MEMBER"||e==="MASTER"||e==="MODERATOR"},openOrderConfigPopup:function(){this.orgSettingToggle();var t=this,n=e.goPopup({pclass:"layer_normal layer_set_orgview",header:T["\ubd80\uc11c\uc6d0 \uc790\ub3d9 \uc815\ub82c \uc124\uc815"],modal:!0,contents:'<div id="divOrderConfigPopup"></div>',buttons:[{btype:"confirm",btext:N["\uc218\uc815"],autoclose:!0,callback:function(e){t.orderConfigView.saveOrderConfig(),t.treeEl.jstree("refresh",t.getSelectedNode()),t.refreshTab("member_list")}},{btype:"close",btext:N["\ucde8\uc18c"]}]});this.orderConfigView=new a({$parentEl:this.$el}),n.find("#divOrderConfigPopup").html(this.orderConfigView.render({parent:t}).el),n.reoffset()},openOrgExposureConfigPopup:function(t){this.orgSettingToggle();var n=this,r=e.goPopup({pclass:"layer_normal layer_set_orgview",width:600,header:T["\uc0ac\uc774\ud2b8 \uc870\uc9c1\ub3c4 \ub178\ucd9c \uc124\uc815"],modal:!0,contents:'<div id="orgExposureConfigPopup"></div>',buttons:[{btype:"confirm",btext:N["\uc218\uc815"],autoclose:!0,callback:function(e){n.orgConfigView.orgExposureConfigSave()}},{btype:"close",btext:N["\ucde8\uc18c"]}]});this.orgConfigView=new f,r.find("#orgExposureConfigPopup").html(this.orgConfigView.render({parent:n}).el),r.reoffset()},openMailExposureConfigPopup:function(t){this.orgSettingToggle();var n=this,r=e.goPopup({pclass:"layer_normal layer_set_orgview",header:T["\uba54\uc77c \uc8fc\uc18c \ub178\ucd9c \uc124\uc815"],modal:!0,headerHtml:'<p class="desc">'+T["\uba54\uc77c\uc8fc\uc18c\ub178\ucd9c \ud31d\uc5c5\uc124\uba851"]+'</p><p class="desc">'+T["\uba54\uc77c\uc8fc\uc18c\ub178\ucd9c \ud31d\uc5c5\uc124\uba852"]+"</p>",contents:'<div id="mailExposureConfigPopup"></div>',buttons:[{btype:"confirm",btext:N["\uc218\uc815"],autoclose:!0,callback:function(e){n.mailConfigView.save()}},{btype:"close",btext:N["\ucde8\uc18c"]}]});this.mailConfigView=new l,r.find("#mailExposureConfigPopup").html(this.mailConfigView.render({parent:n}).el),r.reoffset()},_moveNode:function(t,n){var r=this,i=n.rslt.op,s=n.rslt.o,o=s.attr("rel"),u=n.rslt.np,a=u.data("id"),f=n.rslt.cp+1;i.data("id")==a&&n.rslt.cp>n.rslt.cop&&(f=n.rslt.cp);if(o==="org"){e("#orgMemTree").jstree("deselect_all",!0);var l=k+"/department/"+s.data("id")+"/move",c="PUT",h={targetParentId:a,sortOrder:f-u.data("memberCount")}}else if(u.attr("rel")==="unspecified")var l=k+"/deptmember/"+s.attr("nodeid")+"/related",c="DELETE";else if(i.attr("rel")==="unspecified")var l=k+"/department/"+u.attr("nodeid")+"/member",c="POST",h={userId:s.data("id")};else var l=k+"/deptmember/"+s.find("a").attr("nodeid")+"/move",c="PUT",h={targetDeptId:a,sortOrder:f};e.go(l,JSON.stringify(h),{qryType:c,contentType:"application/json",responseFn:function(t){t.code==200?(r.$el.trigger("orgChanged"),r.refreshTab(),c==="DELETE"&&t.data&&(r.refreshTab("member_list"),t.data.forEach(function(t){var n=e("#orgMemTree li[nodeid="+t+"]");n.length>0&&r.treeEl.jstree("refresh",n)})),r.treeEl.jstree("refresh",u),this._updateUnspecifiedMemberCount()):e.jstree.rollback(n.rlbk)}})},_getRootNode:function(){return this.$("#orgMemTree li:first")},_deleteDept:function(t){t.stopPropagation();var n=this,r=this.getSelectedDeptData();if(r.rel==="root"||r.rel==="unspecified")return e.goMessage(T["\uc0ad\uc81c\ud560 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4."]),!1;if(this.isMember(r.rel))return e.goMessage(L.no_select_dept_mgs),!1;if(r.id)var i=e.goPopup({header:L.dept_delete,width:500,modal:!0,message:L.dept_delete_confirm,buttons:[{btype:"caution",btext:L["delete"],autoclose:!1,callback:function(t){e.go(k+"department/"+r.id,{},{qryType:"DELETE",contentType:"application/json",responseFn:function(e){n.$el.trigger("orgChanged");var t=n.getSelectedNode(),r=t.parents("li:eq(0)");n.treeEl.jstree("refresh",r),n.treeEl.jstree("select_node",r,!0),i.close()}})}},{btype:"close",btext:N["\ucde8\uc18c"]},{btype:"confirm",btext:L.dept_migration,autoclose:!0,callback:function(e){n.$el.find(".content_tab li [data-type='dept_file']").trigger("click")}}]});else e.goMessage(L.no_select_dept_mgs)},getDeptModel:function(e){return this.deptModel.set({id:e.id}),e.id===-1?(this.deptModel.set({name:e.name}),this.deptModel.set({memberCount:this._getUnspecifiedMemberCount()})):(this.deptModel.set({emailId:""}),this.deptModel.set({deptAlias:""}),this.deptModel.fetch({async:!1}),this.deptModel.setModifyFlag()),this.deptModel},getDeptModelById:function(e){return this.deptModel.set({id:e}),e===-1?(this.deptModel.set({name:T["\ubd80\uc11c \ubbf8\uc9c0\uc815 \uba64\ubc84"]}),this.deptModel.set({memberCount:this._getUnspecifiedMemberCount()})):(this.deptModel.set({emailId:""}),this.deptModel.set({deptAlias:""}),this.deptModel.fetch({async:!1}),this.deptModel.setModifyFlag()),this.deptModel},_setDeptTitle:function(t){var n=this,r=null,i=!1,s=this.$el.find("#controlBtnGroup");this.$el.find("#deptName").text(t.name),this.$el.find("#deptName").data("id",t.id),this.$el.find("#deptMemCount").text(" ("+t.memberCount+")"),this._updateUnspecifiedMemberCount(),this._UpdateCreateNewBtnName(),this.licenseModel.get("approvalServicePack")&&(i=!0),jQuery("#emailId").val()===L.dept_mail_id&&(t.isModifyEmail=!0),jQuery("#code").val()===L.dept_code_id&&(t.isModifyCode=!0),jQuery("#deptAlias").val()===L.dept_alias_id&&(t.isModifyAlias=!0),this.$el.find(".option_group .op_group").html(b({"isUnspecifiedDept?":t.id===-1,"isModifyEmail?":t.isModifyEmail||!1,"isModifyCode?":t.isModifyCode||!1,"isModifyAlias?":t.isModifyAlias||!1,"hasApprovalServicePack?":i||!1,id:t.id,email:t.email,emailId:t.emailId==""?null:t.emailId,code:t.code==""?null:t.code,deptAlias:t.deptAlias==""?null:t.deptAlias,name:t.name,lang:L,preEmailId:t.preEmailId,preCode:t.preCode,preDeptAlias:t.preDeptAlias,preIsModifyEmail:t.isModifyEmail,preIsModifyCode:t.isModifyCode,preIsModifyDeptAlias:t.isModifyAlias})),this.orgListView.changeOrder(!t.sortFlag),e("input[placeholder]").placeholder(),(t.isModifyEmail||!t.emailId)&&n.$el.find(".option_group .op_group").find('input[name="emailId"]').bind("keyup.emailValidate",function(i){var s=function(){var r="",s=e(i.target).val();n._checkDeptEmail(s),e.go(k+"department/"+t.id+"/emailcheck",{emailId:s},{qryType:"GET",contentType:"application/json",responseFn:function(e){n.$el.find(".go_alert").html(r)},error:function(e){r=L.dept_mail_already_msg,n.$el.find(".go_alert").html(r)}})};i.keyCode===13?s():(clearTimeout(r),r=setTimeout(s,700))}),(t.isModifyCode||!t.code)&&n.$el.find(".option_group .op_group").find('input[name="code"]').bind("keyup.codeValidate",function(i){var s=function(){var r="",s=e(i.target).val();n._checkDeptEmail(s),e.go(k+"department/"+t.id+"/codecheck",{code:s},{qryType:"GET",contentType:"application/json",responseFn:function(e){n.$el.find(".go_alert").html(r)},error:function(e){r=L.dept_code_already_msg,n.$el.find(".go_alert").html(r)}})};i.keyCode===13?s():(clearTimeout(r),r=setTimeout(s,700))}),(t.isModifyAlias||!t.deptAlias)&&n.$el.find(".option_group .op_group").find('input[name="deptAlias"]').bind("keyup.deptAliasValidate",function(i){var s=function(){var r="",s=e(i.target).val();n._checkDeptEmail(s),e.go(k+"department/"+t.id+"/aliascheck",{alias:s},{qryType:"GET",contentType:"application/json",responseFn:function(e){n.$el.find(".go_alert").html(r)},error:function(e){r=L.dept_alias_already_msg,n.$el.find(".go_alert").html(r)}})};i.keyCode===13?s():(clearTimeout(r),r=setTimeout(s,700))}),t.id===-1?s.hide():s.show()},getDeptRoot:function(){var t=this;e.go(k+"/organization/root",{},{qryType:"GET",async:!1,contentType:"application/json",responseFn:function(e){t.rootDeptName=e.data.name,t.rootDeptCount=e.data.memberCount}})},_checkDeptEmail:function(t){var n="";return t==L["dept_mail_id"]?n=T["\ubd80\uc11c\uc774\uba54\uc77c\uc785\ub825\uacbd\uace0"]:t.length>0&&!e.goValidation.isValidEmailId(t)&&(n=L.dept_mail_invalid_msg),this.$el.find(".go_alert").html(n),n!=""?!1:!0},addDeptMembers:function(t){t.stopPropagation();var n=this,r=this.getSelectedDeptData();if(r===null){e.goMessage(L.no_select_dept_mgs);return}e.goOrgSlide({contextRoot:GO.contextRoot,header:L.org,desc:L.org_add_desc,isAdmin:!0,target:t,callback:function(t){e.go(k+"department/"+r.id+"/member",JSON.stringify({userId:t.id}),{qryType:"POST",contentType:"application/json",responseFn:function(e){n.refreshTab("member_list")},error:function(t){var n=JSON.parse(t.responseText);n.name=="already_added_member"&&e.goMessage(L.already_added_member)}})}})},addDutyChangeView:function(t){t.stopPropagation();var n=e(t.currentTarget),r=new o({el:n.parent("td"),dutyCode:n.attr("data-code"),memberId:n.attr("data-id")});r.render()},addTypeChangeView:function(t){t.stopPropagation();var n=e(t.currentTarget),r=new u({el:n.parent("td"),type:n.attr("data-type"),memberId:n.attr("data-id")});r.render()},_UpdateCreateNewBtnName:function(){var e=this.getSelectedDeptData().rel==="unspecified"?T["\uc2e0\uaddc \uba64\ubc84 \uc0dd\uc131"]:T["\uc2e0\uaddc \ubd80\uc11c\uc6d0 \uc0dd\uc131"];this.$el.find("#createNewMember span.txt").text(e)},_updateUnspecifiedMemberCount:function(){this.$el.find("#deptUnspecifiedMemberCount").text("("+this._getUnspecifiedMemberCount()+")")},_getUnspecifiedMemberCount:function(){var t=0;return e.go(k+"department/unspecified/member/count",{},{qryType:"GET",async:!1,contentType:"application/text",responseFn:function(e){t=e.data}}),t},goToBatchRegisterLink:function(){e.goPopup({width:500,title:"",pclass:"layer_confim",contents:"<p class='q'>"+GO.i18n(T["\uba54\ub274\ub85c \uc774\ub3d9\ud558\uc2dc\uaca0\uc2b5\ub2c8\uae4c"],{menuName:T["\uc77c\uad04 \ub4f1\ub85d"]})+"</p>",buttons:[{btext:N["\ud655\uc778"],btype:"confirm",autoclose:!0,callback:function(){GO.router.navigate("account/batch/regist/dept",!0)}},{btext:N["\ucde8\uc18c"]}]})},showDeptUnspecifiedMember:function(){this.$el.find("#orgMemTree a[rel='unspecified']").trigger("click")},attachCntBadge:function(t){var n=e(t).find("footer a").first();if(n.hasClass("badge")){var r=e(n).find(".com_badge .txt"),i=r.text();i<99?r.text(++i):r.text("99+")}else n.addClass("badge"),n.append("<span class='com_badge'><span class='txt'>1</span></span>")},changeTab:function(t){var n=e(t.currentTarget),r=n.find("span").data("type");this.$el.find("ul.content_tab li").removeClass("active"),n.addClass("active"),this.renderContents(r)},refreshTab:function(e){var t=this.$el.find("ul.content_tab li.active"),n=t.find("span").data("type");e?e===n&&this.renderContents(e):this.renderContents(n),GO.EventEmitter.trigger("admin","refreshHeader",this.getSelectedDeptData().id)},renderContents:function(e){var t=this.getSelectedDeptData();this.arrangeTabAndBtns(t.id);if(e==="dept_info"){this.$el.find("#deptMemberContent").hide(),this.$el.find("#deptInfoContent").show();var n=new p({deptId:t.id});this.$el.find("#deptInfoContent").html(n.$el),n.render(),this.$el.find("#toolBar").hide()}else if(e==="member_list")this.$el.find("#deptInfoContent").hide(),this.$el.find("#deptMemberContent").show(),this.$el.find("#toolBar").show(),this.orgListView.renderDeptMemberList(t.id);else{this.$el.find("#deptMemberContent").hide(),this.$el.find("#deptInfoContent").show();var r=new m({deptId:t.id,approvalMenuAccessible:this.menus.findMenuFromHref("approval/deptfolder").accessible});this.$el.find("#deptInfoContent").html(r.$el),r.render(),this.$el.find("#toolBar").hide()}},arrangeTabAndBtns:function(e){e===-1?(this.$el.find("ul.content_tab").hide(),this.$el.find('li[data-type="duty"]').hide(),this.$el.find("#delegateBtnArea").hide(),this.$el.find("li#deleteDeptMembers").hide(),this.$el.find("#deptCtr").hide(),this.$el.find(".wrap_order").hide(),this.$el.find(".moveDeptMembers span.txt").text(T["\ubd80\uc11c \uc9c0\uc815"])):(this.$el.find("ul.content_tab").show(),this.$el.find('li[data-type="duty"]').show(),this.$el.find("#delegateBtnArea").show(),this.$el.find("li#deleteDeptMembers").show(),this.$el.find("#deptCtr").show(),this.$el.find(".wrap_order").show(),this.$el.find(".moveDeptMembers span.txt").text(T["\ubd80\uc11c \uc774\ub3d9"]))},addDept:function(t){var n=this.getSelectedDeptData(),r=this.getSelectedNode();if(!n||!n.id)return e.goMessage(L.no_select_dept_mgs),!1;if(n.rel==="unspecified"||this.isMember(n.rel))return e.goMessage(L.no_select_dept_mgs),!1;var i=this,s=new d,o=e.goPopup({header:T["\ubd80\uc11c \ucd94\uac00"],contents:'<div id="addDeptArea"></div>',width:"500",modal:!0,buttons:[{btext:T["\uc800\uc7a5 \ud6c4 \uacc4\uc18d \uc0dd\uc131"],btype:"confirm",autoclose:!1,callback:function(){s.deptSave=e.Deferred(),s.save(r.data().id),s.deptSave.promise().done(function(){s.reset(),i.treeEl.jstree("refresh",r),i.refreshTab("dept_info"),i.attachCntBadge(o),i.$el.trigger("orgChanged")})}},{btext:N["\uc800\uc7a5"],btype:"confirm",autoclose:!1,callback:e.proxy(function(t){var n=i.treeEl.jstree("get_path").length;if(n>=10){e.goMessage(T["\ud558\uc704\ubd80\uc11c\ub294 \ucd5c\ub300 9\uac1c\uae4c\uc9c0\ub9cc \ucd94\uac00 \uac00\ub2a5\ud569\ub2c8\ub2e4."]);return}s.deptSave=e.Deferred(),s.save(r.data().id),s.deptSave.promise().done(function(){i.treeEl.jstree("refresh",r),i.refreshTab("dept_info"),i.$el.trigger("orgChanged"),t.close()})},i)},{btext:N["\ucde8\uc18c"],btype:"cancel"}]});o.find("#addDeptArea").html(s.render(this.systemInfo.language).el),o.reoffset()},getCreateNewMemberTitleTpl:function(e){return['<span class="wrap_group">','<span class="txt light"> / </span>','<span class="ic_adm ic_folder_s"></span>','<span class="txt light">',e,"</span>","</span>"].join("")},createNewMember:function(){function i(e){return e&&e.id!=-1}var t=this,n=this.getSelectedDeptData(),r=i(n)?{deptId:n.id}:{};this.accountCreateView=new c(r),this.createMemberPopup=e.goPopup({header:i(n)?T["\ubd80\uc11c\uc6d0 \uc0dd\uc131"]+t.getCreateNewMemberTitleTpl(n.name):T["\uba64\ubc84 \uc0dd\uc131"],width:800,pclass:"layer_add_member layer_normal ui-draggable",modal:!0,contents:'<div id="accountCreateArea"></div>',buttons:[{btext:T["\uc800\uc7a5 \ud6c4 \uacc4\uc18d \uc0dd\uc131"],btype:"confirm",autoclose:!1,callback:function(){t.accountCreateView.save(e.proxy(function(){this.refreshDeptNode(this.getSelectedNode()),this.refreshTab(),this.accountCreateView.reset(),this.attachCntBadge(this.createMemberPopup),this.$el.trigger("orgChanged")},t))}},{btext:N["\uc800\uc7a5"],btype:"confirm",autoclose:!1,callback:function(){t.accountCreateView.save(e.proxy(function(){this.createMemberPopup.close(),this.refreshDeptNode(this.getSelectedNode()),this.refreshTab(),this.$el.trigger("orgChanged")},t))}},{btext:N["\ucde8\uc18c"],btype:"cancel"}]}),this.createMemberPopup.find("#accountCreateArea").html(this.accountCreateView.el),this.accountCreateView.render(),this.createMemberPopup.reoffset(),this.createMemberPopup.find("#btnMultiLang").on("click",function(e,n){t.accountCreateView.toggleMultiLang(),t.createMemberPopup.reoffset()}),this.createMemberPopup.find("#show_detail_btn").on("click",function(e,n){t.accountCreateView.showDetail(),t.createMemberPopup.addClass("expand"),t.createMemberPopup.find(">.content").height("500px"),t.createMemberPopup.reoffset()})},refreshDeptNode:function(e){e.size()>0?this.$el.find("#orgMemTree").jstree("refresh",e):this.$el.find("#orgMemTree").jstree("refresh",this._getRootNode())},orgSettingToggle:function(){this.$el.find("#orgSettingView").toggle()},searchNode:function(t){var n=e(t.currentTarget),r=this;if(t.keyCode==13){r.renderTree();return}clearTimeout(this.clearTimeOut),this.clearTimeOut=setTimeout(function(){if(t){var i=e.trim(n.val());i!=""&&r.keyword!=i&&(r.$el.find("#searchInputReset").show(),r.keyword=i,r.renderTree()),i==""&&(r.$el.find("#searchInputReset").hide(),r.renderTree())}},500)},focusSearch:function(){this.$el.find(".search_micro").addClass("focus"),this.$el.find("#search").attr("placeholder",T["\ubd80\uc11c/\uba64\ubc84\ub97c \uac80\uc0c9\ud558\uc138\uc694."])},focusOutSearch:function(){if(this.$el.find("#search").val())return;this.$el.find(".search_micro").removeClass("focus"),this.$el.find("#search").attr("placeholder","")},resetSearchInput:function(){this.$el.find("#search").val(""),this.$el.find("#searchInputReset").hide(),this.$el.find(".search_micro").removeClass("focus"),this.$el.find("#search").attr("placeholder",""),this.renderTree()},handleOrgChanged:function(){this.orgSyncButton.disable()}});return A})}).call(this);