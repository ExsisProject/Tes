define(["jquery","backbone","app","approval/models/activity_group","approval/collections/activity_groups","admin/views/appr_form_activity_group_item","i18n!nls/commons","i18n!admin/nls/admin","i18n!approval/nls/approval","hgn!admin/templates/appr_form_activity_group_app","jquery.go-popup","jquery.go-sdk","jquery.go-grid","jquery.go-orgslide","jquery.go-validation","GO.util"],function(e,t,n,r,i,s,o,u,a,f){var l,c={order:o["\uc21c\uc11c"],name:o["\uc774\ub984"],count:o["\uac1c"],person:o["\uba85"],approval_type:a["\uacb0\uc7ac"],agreement_type:a["\ud569\uc758"],check_type:a["\ud655\uc778"],inspection_type:a["\uac10\uc0ac"],max_approver:a["\ucd5c\ub300 \uacb0\uc7ac\uc790"],appr_line_caption:a["\uacb0\uc7ac \ub77c\uc778"],predefined_approver:a["\uc9c0\uc815 \uacb0\uc7ac\uc790"],add_approval_user:a["\uacb0\uc7ac \ucd94\uac00"],add_agreement_user:a["\ud569\uc758 \ucd94\uac00"],add_check_user:a["\ud655\uc778 \ucd94\uac00"],add_inspection_user:a["\uac10\uc0ac \ucd94\uac00"],already_added:o["\uc774\ubbf8 \ucd94\uac00\ub418\uc5b4 \uc788\uc2b5\ub2c8\ub2e4."],is_over_max_approval_count:a["\uc9c0\uc815 \uacb0\uc7ac\uc790\uac00 \ucd5c\ub300 \uacb0\uc7ac\uc790 \uc778\uc6d0\uc218\ub97c \ucd08\uacfc\ud558\uc600\uc2b5\ub2c8\ub2e4."],is_over_approval_count_ten:a["\uc9c0\uc815 \uacb0\uc7ac\uc790\ub294 10\uac1c\ub97c \ucd08\uacfc \ud558\uc2e4 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4"],msg_not_belong_to_department_user:a["\ubd80\uc11c\uac00 \uc5c6\ub294 \uc0ac\uc6a9\uc790\ub294 \ucd94\uac00\ud560 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4."],appr_type:a["\uacb0\uc7ac \ud0c0\uc785"],"\ubcc0\uacbd":o["\ubcc0\uacbd"],"\uc790\ub3d9\uacb0\uc7ac\uc120":u["\uc790\ub3d9\uacb0\uc7ac\uc120"]};return l=t.View.extend({initialize:function(e){e=_.extend({},e),this.companyIds=null,_.isArray(e.companyIds)&&(this.companyIds=e.companyIds),e.groups&&(this.collection=e.groups);var n=t.Model.extend();e.apprlinerule&&(this.apprlineruleModel=new n(e.apprlinerule))},render:function(e){var t=this;if(!e)this.collection.length<1&&this.collection.add(new r);else{var n=e-this.collection.length;if(n>0)for(var i=0;i<n;i++)this.collection.push(new r({useApproval:!0,useAgreement:!1,useCheck:!1}));else if(n<0)for(var i=0;i<-n;i++)this.collection.pop()}return this.$el.empty(),this.collection.each(function(e,n){e.set("seq",n);var r=new s({companyIds:this.companyIds,model:e,allowAgreement:t.options.allowAgreement,agreementAllowType:t.options.agreementAllowType,allowCheck:t.options.allowCheck,allowInspection:t.options.allowInspection,apprlineruleModel:this.apprlineruleModel});this.$el.append(r.render())},this),this.$el.contents()},getListAsJSON:function(){return this.collection.toJSON()},isOverMaxApprovalCount:function(){var t=!1,n=e("#includeAgreement").is(":checked");return this.collection.each(function(e){var r=e.get("activities");r=_.filter(r,function(e){return n?e.type=="APPROVAL"||e.type=="AGREEMENT":e.type=="APPROVAL"}),r.length>e.get("maxApprovalCount")&&(t=!0)},this),t},isNothingCheckedApprType:function(){var t=!1,n=e("#appr_line_tbl").find(".tb_approval_line");return e(n).each(function(n,r){var i=e(r).find("[name=typeOpApproval]").is(":checked"),s=e(r).find("[name=typeOpAgreement]").is(":checked"),o=e(r).find("[name=typeOpCheck]").is(":checked"),u=e(r).find("[name=typeOpInspection]").is(":checked");!i&&!s&&!o&&!u&&(t=!0)}),t},isAppointmentOfNotSelectedType:function(){var t=!1,n=e("#appr_line_tbl").find("tr");return e(n).each(function(n,r){var i=e(r).find("[name=typeOpAgreement]").length,s=e(r).find("[name=typeOpCheck]").length,o=e(r).find(".name_tag").find('li:not("#add_btn_container")');i==0&&_.each(o,function(n){e(n).find(".name").text().indexOf("("+a["\ud569\uc758"]+")")!=-1&&(t=!0)}),s==0&&_.each(o,function(n){e(n).find(".name").text().indexOf("("+a["\ud655\uc778"]+")")!=-1&&(t=!0)})}),t}}),t.View.extend({groupListView:null,apprLineCounts:[],events:{"change #select_appr_line_counts":"_onApprLineCountSelected"},initialize:function(e){e=_.extend({},e),this.companyIds=null,_.isArray(e.companyIds)&&(this.companyIds=e.companyIds);var t={companyIds:this.companyIds,allowAgreement:e.allowAgreement,allowCheck:e.allowCheck,allowInspection:e.allowInspection};_.isUndefined(e.groups)||_.extend(t,{groups:e.groups,apprlinerule:e.apprlinerule,agreementAllowType:e.agreementAllowType,formid:e.formid}),this.groupListView=new l(t),this.apprLineCounts=_.map([1,2,3,4,5,6,7,8,9,10],function(t){return{value:t,label:t+c.count,selected:e.groups&&e.groups.length==t?"selected":""}},this)},render:function(){return this.$el.html(f({apprLineCounts:this.apprLineCounts,lang:c})),this.$el.find("tbody#appr_line_tbl").html(this.groupListView.render()),this.$el},getListAsJSON:function(){return this.groupListView.getListAsJSON()},isOverMaxApprovalCount:function(){return this.groupListView.isOverMaxApprovalCount()},isNothingCheckedApprType:function(){return this.groupListView.isNothingCheckedApprType()},isAppointmentOfNotSelectedType:function(){return this.groupListView.isAppointmentOfNotSelectedType()},_onApprLineCountSelected:function(t){var n=e(t.target).val();this.$el.find("tbody#appr_line_tbl").html(this.groupListView.render(n))}})});