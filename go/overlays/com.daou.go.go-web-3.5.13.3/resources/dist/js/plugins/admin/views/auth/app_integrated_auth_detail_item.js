define("admin/views/auth/app_integrated_auth_detail_item",function(require){var e=require("underscore"),t=require("jquery"),n=require("backbone"),r=require("app"),i=require("hgn!admin/templates/auth/app_integrated_auth_detail_item"),s=require("admin/models/auth/app_integrated_auth"),o=require("views/circle"),u=require("i18n!nls/commons"),a=require("i18n!admin/nls/admin"),f=[{type:"CompanyAssetManager",lang:a["\uc790\uc0b0\uc744 \uba3c\uc800 \ucd94\uac00\ud574\uc8fc\uc138\uc694"],link:"/asset"},{type:"CompanyDocsOperator",lang:a["\ubb38\uc11c\ud568\uc744 \uba3c\uc800 \ucd94\uac00\ud574\uc8fc\uc138\uc694"],link:"/docs"},{type:"CommunityMaster",lang:a["\uc0dd\uc131\ub41c \ucee4\ubba4\ub2c8\ud2f0\uac00 \uc5c6\uc2b5\ub2c8\ub2e4"],link:null},{type:"WorksAppOperator",lang:a["\uc0dd\uc131\ub41c Works\uc571\uc774 \uc5c6\uc2b5\ub2c8\ub2e4"],link:null}];return n.View.extend({tagName:"tr",events:{"click .add_admin":"addAdmin","click .add_action":"addAction","click .auth_checkbox":"updateAction","click .ic_del":"_removeAdmin","click .content_link":"moveContentPage","click .sel_auth_item":"updateSelectedRow","click .shortcut":"moveOriginSettingPage"},initialize:function(e,t){this.model=e,this.viewOpt=t,this.contentId=this.model.contentId?this.model.contentId:"",this.isMyLevel=this.model.authLevel===this.viewOpt.appAuthLevel,this.authId=this.model.appAuthType+"-auth-detail"+this.contentId},renderAuthData:function(){var e=this.model.authDataType;if(this.model.authLevel!==this.viewOpt.appAuthLevel)return this.renderContentAuthLink();if(e==="USER")return this.renderUserTypeAuthData();if(e==="USER_ACTION")return this.renderUserActionAuthData();if(e==="CIRCLE")return this.renderCircle();if(e==="CIRCLE_ACTION")return this.renderUserActionAuthData()},renderContentAuthLink:function(){var e=this.getContentLinkInfo();return!!e&&this.model.isEmptyContent()?'<span data-link="(data-link)" class="btn_tool light content_link">'.replace("(data-link)",e.link?e.link:"none")+'<span class="ic_adm ic_accordion_s_folded"></span>'+'<span class="txt">(txt)</span>'.replace("(txt)",e.lang)+"</span>":'<span value="(menuKey)" class="btn_tool light content_link">'.replace("(menuKey)",this.model.appAuthType)+'<span class="ic_adm ic_accordion_s_folded"></span>'+'<span class="txt">(menuName)</span>'.replace("(menuName)",this.model.name+" "+u["\uad00\ub9ac"])+"</span>"},getContentLinkInfo:function(){for(var e=0;e<f.length;e++)if(f[e].type===this.model.appAuthType)return f[e];return undefined},renderUserTypeAuthData:function(){var t=this.viewOpt.singleManagerType?a["\ub9c8\uc2a4\ud130 \ubcc0\uacbd"]:a["\uc6b4\uc601\uc790 \ucd94\uac00"],n='<ul class="name_tag">',r=this;return e.forEach(this.model.users,function(e){n+='<li> <span class="name" value="(userId)">(name)</span>'.replace("(userId)",e.id).replace("(name)",e.name),!r.viewOpt.singleManagerType&&r.model.owner&&(n+='<span class="btn_wrap"><span class="ic ic_del" value="(userId)" title="'.replace("(userId)",e.id)+u["\uc0ad\uc81c"]+'"></span></span></li>')}),r.model.owner&&(n+='<li class="creat add_admin"> <span class="btn_wrap"> <span class="ic ic_addlist"></span> '+'<span class="txt">(addtext)</span> </span> </li>'.replace("(addtext)",t)),n+="</ul>",n},renderUserActionAuthData:function(){var t="";e.forEach(this.model.actionModel,function(e){t+='<div class="wrap_row"><span class="cell"><ul class="name_tag"> <li>'+'<span class="name">(name)</span>'.replace("(name)",e.user.name)+'<span class="btn_wrap">'+'<span class="ic ic_del" value="(userId)" title="(delete)"></span>'.replace("(delete)",u["\uc0ad\uc81c"]).replace("(userId)",e.user.id)+"</span> </li> </ul>"+'<div class="wrap_sub">'+'<span class="option_wrap">'+'<input type="checkbox" class="auth_checkbox" name="(userId)" value="write, manage" checked>'.replace("checked",e.write?"checked":"").replace("(userId)",e.user.id)+"<label>"+a["\uc218\uc815 \uad8c\ud55c"]+"</label>"+"</span>"+'<span class="option_wrap">'+'<input type="checkbox" class="auth_checkbox" name="(userId)" value="remove" checked>'.replace("checked",e.remove?"checked":"").replace("(userId)",e.user.id)+"<label>"+a["\uc0ad\uc81c \uad8c\ud55c"]+"</label>"+"</span> </div> </span></div>"});var n=this.model.authDataType==="CIRCLE_ACTION"?a["\uc6b4\uc601\uc790 \ucd94\uac00"]:a["\uad00\ub9ac\uc790 \ucd94\uac00"];return t+='<ul class="name_tag add_action"><li class="creat"><span class="btn_wrap"><span class="ic ic_addlist"></span><span class="txt">'+n+"</span>"+"</span> </li> </ul>",t},refresh:function(){var e=this.model.authDataType;e==="CIRCLE"&&this.renderCircle()},renderCircle:function(){var e=this.model.authDataType;if(e!=="CIRCLE")return;var n=["user","position","grade","usergroup"];return GO.util.isUseOrgService(!0)&&(n=["user","department","position","grade","duty","usergroup"]),this.circleView=new o({selector:"#"+this.authId,isAdmin:!0,isWriter:!0,id:this.authId,changeCallback:this.circleCb,circleJSON:this.model.circle,nodeTypes:n}),this.circleView.render(),this.circleView.show(),t("body").off(this.authId+"circle.data.updated"),t("body").on(this.authId+"circle.data.updated",t.proxy(this._updateCircle,this)),""},circleCb:function(e){t("body").trigger(this.id+"circle.data.updated")},_updateCircle:function(){this.viewOpt.viewSaveButton?this.model.updateCircleData(this.circleView.getData()):this.model.updateCircle(this.circleView.getData())},getSaveUpdatedModel:function(){if(!this.model.updated)return;return this.model.getSaveModel()},render:function(){var e=this.viewOpt.menus.findMenuFromHref(this.model.originLink),t=!1,n=this.model.name;e&&(n=e.getTitle(),t=e.accessible);var r=this.model.tooltip&&this.model.tooltip.length>0;this.$el.html(i({contextRoot:GO.contextRoot,AdminLang:a,CommonLang:u,name:this.model.name,groupName:this.model.groupName,groupKey:this.model.groupKey,authId:this.authId,authType:this.model.appAuthType,contentKey:this.model.contentKey,viewCkbox:this.isMyLevel&&this.viewOpt.useCheckBox&&this.model.owner,contentName:this.model.contentName,originLink:this.model.originLink,isContentAuthView:this.viewOpt.isContentAuthView,isAppAuthView:this.viewOpt.isAppAuthView,isCompanyShare:this.model.companyShare,isContent:this.model.appAuthLevel==="AppContentOperator",hasTooltip:r,linkName:n,tooltip:this.model.tooltip,isAccessible:t}));var s=this.$el.find("#"+this.authId);return s.append(this.renderAuthData()),this},showOrgSlide:function(e,n){var r=this;if(this.model.appAuthType==="CommunityMaster"){var i=this.model.contentId;t.goOrgSlide({header:a["\ub9c8\uc2a4\ud130 \ubcc0\uacbd"],type:"community",contextRoot:GO.contextRoot,callback:t.proxy(function(t){n(r,t,e)},this),loadId:i,isAdmin:!0,accessOrg:!0})}else t.goOrgSlide({header:this.model.authDataType!=="USER_ACTION"?a["\uc6b4\uc601\uc790 \ucd94\uac00"]:a["\uad00\ub9ac\uc790 \ucd94\uac00"],desc:"",callback:t.proxy(function(t){n(r,t,e)},this),target:e,isAdmin:!0,contextRoot:GO.contextRoot})},addAction:function(e){this.showOrgSlide(t(e.currentTarget),this._saveAction)},updateAction:function(e){var n=t(e.currentTarget),r=n.attr("value"),i=n.attr("name"),s=!!n.attr("checked"),o=this.model.findAction(i);o.read=!0,o.write=r.indexOf("write")>=0?s:o.write,o.remove=r.indexOf("remove")>=0?s:o.remove,o.manage=r.indexOf("manage")>=0?s:o.manage,this._saveAction(this,o.user)},_saveAction:function(e,t,n){e.model.addUser(t),console.log(e.model),e.render()},addAdmin:function(e){this.showOrgSlide(t(e.currentTarget),this._addAdmin)},_addAdmin:function(e,t,n){e.model.addUser(t),console.log(e.model),e.render()},_removeAdmin:function(e){var n=t(e.currentTarget),r=n.attr("value");this.model.removeUser({id:r}),this.render()},updateSelectedRow:function(e){t("body").trigger("auth.selected.updated")},moveContentPage:function(e){var n=t(e.currentTarget),i=n.attr("data-link");if(!!i){if(i==="none")return;r.router.navigate(i,{trigger:!0,pushState:!0});return}var s=n.attr("value"),o="/auth/app/"+s;r.router.navigate(o,{trigger:!0,pushState:!0})},moveOriginSettingPage:function(e){r.router.navigate(this.model.originLink,{trigger:!0,pushState:!0})}})});