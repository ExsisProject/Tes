define(["jquery","underscore","backbone","app","approval/views/doclist/doclist_item_info","hgn!admin/templates/document/manage_doclist_item","hgn!admin/templates/document/document_attach","i18n!nls/commons","i18n!approval/nls/approval"],function(e,t,n,r,i,s,o,u,a){var f=n.Model.extend({url:function(){return"/ad/api/approval/manage/document/"+this.docId},initialize:function(e){this.docId=e}}),l=n.Collection.extend({model:n.Model.extend(),url:function(){return["/ad/api/approval/manage/document",this.docId,"attach"].join("/")},initialize:function(e){this.docId=e.docId}}),c=n.View.extend({tagName:"tr",events:{"click .attach":"showAttach","click span.read":"showApprFlow","click span.notyet":"showApprFlow","click span.finish":"showApprFlow","click span.temp":"showApprFlow"},initialize:function(e){this.options=e||{},t.bindAll(this,"render","showApprFlow","showAttach"),this.columns=this.options.columns,this.deptId=this.options.deptId,this.files=[]},render:function(){var e={id:this.model.getDocumentId(),draftedAt:this.model.getDraftedAt(),formName:this.model.get("formName"),title:this.model.get("title"),hasAttach:this.model.hasAttach(),attachCount:this.model.get("attachCount"),drafterId:this.model.get("drafterId"),drafterName:this.model.get("drafterName"),docStatus:this.model.getDocStatusName(),isComplete:this.model.isCompleted(),statusClass:this.model.getDocStatusClass(),completedAt:this.model.getCompletedAt(),docNum:this.model.get("docNum"),docId:this.model.get("documentId"),createdAt:this.model.get("createdAt")?r.util.shortDate(this.model.get("createdAt")):"-",useIntegration:this.model.get("useIntegration")==1?"Y":"N"};return this.$el.html(s({doc:e,columns:this.columns,deptId:this.deptId,isActivePopup:this.isActivePopup(),isReceive:this.model.get("docType")=="RECEIVE"?!0:!1,lang:a})),this},isActivePopup:function(){return this.model.get("docStatus")=="DRAFT_WAITING"||this.model.get("docStatus")=="RECV_RETURNED"||this.model.get("docStatus")=="RECV_WAITING"||this.model.get("docStatus")=="TEMPSAVE"&&this.model.get("apprStatus")=="CANCEL"?!1:!0},showAttach:function(t){t.stopPropagation(),this.files=[];var n=this,i=new l({docId:this.model.getDocumentId()});i.fetch({async:!1});if(!i.length)return!1;var s=i.toJSON();e.each(s,function(e,t){var i=new RegExp("(zip|doc|docx|ppt|pptx|xls|xlsx|hwp|pdf|txt|html|htm|jpg|jpeg|png|gif|tif|tiff|bmp|exe|avi|mp3|mp4|mov|mpg|mpeg|lzh|xml|log|csv|eml)","gi"),s=t.extention.toLowerCase();t.size=r.util.getHumanizedFileSize(t.size),t.extention=i.test(s)?s:"def",n.files.push(t)});var f=o({dataset:this.files,contextRoot:r.config("contextRoot")});e.goPopup({pclass:"layer_normal layer_list_attach",header:a["\ucca8\ubd80 \ud30c\uc77c \ubaa9\ub85d"],modal:!0,width:"400px",contents:f,buttons:[{btext:u["\ud655\uc778"],btype:"confirm",callback:function(){}}]})},showApprFlow:function(e){e.stopPropagation(),e.preventDefault();if(!this.isActivePopup())return;var t=new i({docId:this.model.getDocumentId(),isAdmin:!0});t.render()}});return c});