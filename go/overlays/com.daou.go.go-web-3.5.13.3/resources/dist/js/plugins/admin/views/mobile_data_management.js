define(["jquery","backbone","app","i18n!nls/commons","i18n!admin/nls/admin","collections/paginated_collection","hgn!admin/templates/chat_attach_config","hgn!admin/templates/list_empty","hgn!admin/templates/chat_attach_error_list","grid","jquery.go-validation","jquery.go-grid","jquery.go-popup","jquery.go-sdk","GO.util"],function(e,t,n,r,i,s,o,u,a,f){var l={label_ok:r["\uc800\uc7a5"],label_cancel:r["\ucde8\uc18c"],label_mb:i.MB,label_chat_keep_setting:i["\ubcf4\uad00\uae30\uac04 \uc124\uc815"],label_chat_delete_period:i["\ub300\ud654\ub0b4\uc6a9 \ubcf4\uad00 \uae30\uac04"],label_chat_delete_setting:i["\ub300\ud654\ub0b4\uc6a9 \uc0ad\uc81c \uc124\uc815"],label_delete_all:i["\ubaa8\ub450 \uc0ad\uc81c \ucca8\ubd80\ud30c\uc77c \ubc0f \ub300\ud654 \uba54\uc138\uc9c0"],label_delete_attaches:i["\ucca8\ubd80\ud30c\uc77c\ub9cc \uc0ad\uc81c"],label_delete_desc:i["\uae30\uac04\uc774 \uc9c0\ub098\uba74 \uc124\uc815\uc5d0 \ub530\ub77c \uc790\ub3d9\uc73c\ub85c \uc0ad\uc81c\ub418\uba70 \ubcf5\uad6c\ub418\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4"],label_attach_info:i["\ucca8\ubd80\ud30c\uc77c \ud604\ud669"],label_total_attach_size:i["\uba54\uc2e0\uc800 \uc571 \ub300\ud654 \ucd1d \ucca8\ubd80\ud30c\uc77c \uc6a9\ub7c9"],label_delete_attach:i["\ucca8\ubd80\ud30c\uc77c \uc0ad\uc81c"],label_attach_name:i["\ucca8\ubd80\ud30c\uc77c\uba85"],label_size:r["\uc6a9\ub7c9"],label_created_at:i["\ub4f1\ub85d\uc77c"],label_creator:i["\ub4f1\ub85d\uc790"],label_validation_input:i["(1~999 \uc785\ub825\uac00\ub2a5)"],label_direct_input:i["\uc9c1\uc811 \uc785\ub825"],label_months:i["\uac1c\uc6d4"],label_days:i["\uc77c\ub2e8\uc704"],label_years:i["\ub144\ub2e8\uc704"],label_none:i["\uc120\ud0dd\uc548\ud568"],label_period:i["\uae30\uac04"],label_delete_caution_desc:i["\uc784\uc9c1\uc6d0\uc5d0\uac8c \ud544\uc694\ud55c \ud30c\uc77c \uc77c\uc218 \uc788\uc73c\ub2c8 \uc0ad\uc81c \uc2dc \uc8fc\uc758\ud558\uc2dc\uae30 \ubc14\ub78d\ub2c8\ub2e4"],label_sync_caution_desc:i["\ucca8\ubd80\ud30c\uc77c \uc0ad\uc81c \ud6c4 \uc6a9\ub7c9 \ubcc0\uacbd\uc0ac\ud56d\uc744 \uc801\uc6a9\ud558\uae30 \uc704\ud574\uc11c\ub294 \uc6a9\ub7c9 \uad00\ub9ac\uc5d0\uc11c \ub3d9\uae30\ud654\ub97c \uc218\ud589\ud574\uc57c \ud569\ub2c8\ub2e4."],label_attach_error_delete:i["\uc624\ub958\ud30c\uc77c \uc0ad\uc81c"],label_attach_error_delete_desc:i["\uc804\uc1a1 \uc624\ub958\uac00 \ubc1c\uc0dd\ud55c \ud30c\uc77c\uc744 \uc0ad\uc81c\ud569\ub2c8\ub2e4."],label_unlimited_archive:i["\ubb34\uc81c\ud55c \ubcf4\uad00"],label_attach_delete_period:i["\ucca8\ubd80\ud30c\uc77c \ubcf4\uad00 \uae30\uac04"],label_tool_tip:i["\ubcf4\uad00 \uae30\uac04 \uc124\uc815 \ub3c4\uc6c0\ub9d0"],label_unfold:r["\ud3bc\uce58\uae30"],label_fold:r["\uc811\uae30"],label_message_delete:i["\ub300\ud654 \uc0ad\uc81c \uae30\ub2a5"],label_message_delete_desc:i["\ub300\ud654 \uc0ad\uc81c \uae30\ub2a5 \uc124\uba85"],label_message_delete_subtitle:i["\ub300\ud654 \uc0ad\uc81c \uae30\ub2a5 \uc0ac\uc6a9"],label_used:r["\uc0ac\uc6a9"],label_unused:r["\uc0ac\uc6a9\uc548\ud568"]},c=s.extend({url:function(){return GO.contextRoot+"ad/api/chat/attach/list?"+this.makeParam()},setDuration:function(e,t){t||(t={});var n=e||"";if(n=="period")this.fromDate=GO.util.toISO8601(t.fromDate),this.toDate=GO.util.searchEndDate(t.toDate);else if(n!=""&&n!="all"){var r=GO.util.shortDate(new Date),i=GO.util.calDate(r,"months",n);this.fromDate=GO.util.toISO8601(i),this.toDate=GO.util.searchEndDate(r)}else this.fromDate=null,this.toDate=null},makeParam:function(){var t={},n=e.param({page:this.pageNo,offset:this.pageSize});return this.keyword&&(n+="&keyword="+encodeURIComponent(this.keyword)),this.property&&(t.property=this.property),this.direction&&(t.direction=this.direction),this.searchType&&(t.searchType=this.searchType),this.fromDate&&(t.fromDate=this.fromDate),this.toDate&&(t.toDate=this.toDate),_.isEmpty(t)||(n+="&"+e.param(t)),n},_getParam:function(){var e={pageNo:this.pageNo,pageSize:this.pageSize,keyword:this.keyword,property:this.property,direction:this.direction,searchType:this.searchType,fromDate:this.fromDate,toDate:this.toDate};return e}}),h=t.Model.extend({url:GO.contextRoot+"ad/api/chat/attach/error/list"}),p=t.View.extend({initialize:function(){this.model=new t.Model,this.model.url=GO.contextRoot+"ad/api/chat/attach/config",this.model.fetch({async:!1}),this.chatMessageConfigModel=new t.Model,this.chatMessageConfigModel.url=GO.contextRoot+"ad/api/chat/message/config",this.chatMessageConfigModel.fetch({async:!1}),this.chatAttachConfigModel=new t.Model,this.chatAttachConfigModel.url=GO.contextRoot+"ad/api/storagePeriod",this.chatAttachConfigModel.fetch({async:!1}),this.listEl="#chatAttachList",this.collection=new c,this.collection.setDuration()},events:{"click #saveChatAttachConfig":"saveChatAttachConfig","click .deleteAttaches":"deleteAttaches","keydown #chatAttachSearchInput":"searchKeyboardEvent","click #searchChatAttach":"search","click #deleteErrorAttaches":"deleteErrorAttaches","click #checkErrorlistAll":"_checkErrorlistAll","click #unlimitedChat":"togglePeriodCheckbox","click #unlimitedChatAttach":"togglePeriodCheckbox","click .wrap_action":"onClickedWrapAction"},render:function(){this.$el.html(o({lang:l,model:this.model.toJSON(),chatMessageConfigModel:this.chatMessageConfigModel.toJSON(),isDeleteAll:function(){return this.model.deleteType=="ALL"?!0:!1}})),this.selectedValueFromModel(),this._renderDataTables(),this.renderButton()},_renderErrorAttachList:function(){var e=this,t=new h;t.fetch({async:!1,success:function(t,n){var r=n.data;_.size(r)>0&&e._drawErrorList(r)}})},_getUnique:function(e){var t=_.uniq(e,"id");return t},_drawErrorList:function(e){var t=this,e=this._getUnique(e);this.$el.append(a({lang:l,data:e,sizeCal:function(){return GO.util.getHumanizedFileSize(this.size)},created:function(){return GO.util.basicDate3(this.createdAt)}}))},_checkErrorlistAll:function(t){var n=e(t.currentTarget),r=e("#chatErrorAttachList input");n.is(":checked")?r.attr("checked",!0):r.attr("checked",!1)},togglePeriodCheckbox:function(t){var n=e(t.currentTarget),r=n.attr("id")=="unlimitedChat"?"chatPeriod":"chatAttachPeriod";e("#"+r).val(""),n.is(":checked")?e("#"+r).attr("disabled",!0):e("#"+r).attr("disabled",!1)},saveChatAttachConfig:function(){var t=this,s=Number(t.$("#chatPeriod").val()),o=Number(t.$("#chatAttachPeriod").val()),u=t.model.attributes.brandName,a=u=="DO_INSTALL"?999:180,f=u=="DO_INSTALL"?999:180,l=99999,c=t.$('input[name="messageDeleteOption"]:checked').val();u=="DO_INSTALL"&&(t.$("#unlimitedChat").is(":checked")&&(s=l,a=l),t.$("#unlimitedChatAttach").is(":checked")&&(o=l,f=l));if(isNaN(s)||isNaN(o))return e.goError(n.i18n(i["\uc22b\uc790\ub9cc \uc785\ub825\ud558\uc138\uc694."])),!1;if(!s||s>a)return e.goError(n.i18n(i["\uc785\ub825\uac12\uc740 0~0\uc774\uc5b4\uc57c \ud569\ub2c8\ub2e4."],{arg1:"1",arg2:a})),!1;if(!o||o>f)return e.goError(n.i18n(i["\uc785\ub825\uac12\uc740 0~0\uc774\uc5b4\uc57c \ud569\ub2c8\ub2e4."],{arg1:"1",arg2:f})),!1;if(o>s)return e.goError(n.i18n(i["\ub300\ud654\ub0b4\uc6a9 ge \ucca8\ubd80\ud30c\uc77c \ubcf4\uad00\uae30\uac04"])),!1;t.model.set("chatPeriod",s,{silent:!0}),t.model.set("chatAttachPeriod",o,{silent:!0}),t.model.save({},{type:"PUT",success:function(n){t.chatMessageConfigModel.set("messageDelete",c,{silent:!0}),t.chatMessageConfigModel.save({},{type:"PUT",success:function(t,n){e.goMessage(r["\uc800\uc7a5\ub418\uc5c8\uc2b5\ub2c8\ub2e4."])},error:function(t,n){var i=JSON.parse(n.responseText);i.message!=null?e.goMessage(i.message):e.goMessage(r["\uc2e4\ud328\ud588\uc2b5\ub2c8\ub2e4."])}})},error:function(t){e.goMessage(responseData.message)}})},selectedValueFromModel:function(){var t=this,n=this.model.attributes.chatPeriod,r=this.model.attributes.chatAttachPeriod,i=this.model.attributes.brandName,s=99999,o=this.chatMessageConfigModel.attributes.messageDelete;o?t.$("#messageDelete_true").attr("checked",!0):t.$("#messageDelete_false").attr("checked",!0),t.$("#chatPeriod").val(n),t.$("#chatAttachPeriod").val(r);if(i=="DO_SAAS")t.$("#unlimitedChat").closest("span").hide(),t.$("#unlimitedChatAttach").closest("span").hide();else{if(n==0||n==s)t.$("#chatPeriod").val(""),t.$("#chatPeriod").attr("disabled",!0),t.$("#unlimitedChat").attr("checked",!0);if(r==0||r==s)t.$("#chatAttachPeriod").val(""),t.$("#chatAttachPeriod").attr("disabled",!0),t.$("#unlimitedChatAttach").attr("checked",!0)}var u=this.chatAttachConfigModel.attributes.applyType;u=="ALL"&&e('form[name="formChatAttachConfig"]').hide()},_renderDataTables:function(){var e=this;this.gridView=new f({el:this.listEl,collection:this.collection,tableClass:"chart size",checkbox:!0,usePeriod:!0,useToolbar:!0,isAdmin:!0,useBottomButton:!1,columns:[{name:"fileName",className:"title",label:i["\ucca8\ubd80\ud30c\uc77c\uba85"],sortable:!0,render:function(e){return e.get("fileName")}},{name:"fileSize",className:"num",label:r["\uc6a9\ub7c9"],sortable:!0,render:function(e){return GO.util.getHumanizedFileSize(e.get("fileSize"))}},{name:"createdAt",className:"align_c",label:i["\ub4f1\ub85d\uc77c"],sortable:!0,render:function(e){return GO.util.basicDate3(e.get("createdAt"))}},{name:"userName",className:"align_c sorting_disabled",label:i["\ub4f1\ub85d\uc790"],sortable:!1,render:function(e){return e.get("positionName")?e.get("userName")+" "+e.get("positionName"):e.get("userName")}}],drawCallback:function(e){},searchOptions:[{value:"userName",label:i["\ub4f1\ub85d\uc790"]},{value:"fileName",label:i["\ucca8\ubd80\ud30c\uc77c\uba85"]}]}),this.gridView.render(),this.collection.fetch()},renderButton:function(){this.$("div.tool_bar").first().removeClass("toolbar").addClass("toolbar_top header_tb"),this.$("div.custom_header").append('<span class="btn_tool txt_caution deleteAttaches" data-type="deleteAttaches">'+i["\ucca8\ubd80\ud30c\uc77c \uc0ad\uc81c"]+"</span>")},deleteAttaches:function(t){var n=this,s=[],o=e(t.currentTarget),u={targetId:"#chatAttachList",apiUrl:"ad/api/chat/attach/delete"};o.attr("data-type")=="deleteErrorAttaches"&&(u={targetId:"#chatErrorAttachList",apiUrl:"ad/api/chat/attach/error/delete"}),e(u.targetId+" :checkbox:checked").each(function(){e(this).attr("data-id")!=undefined&&s.push(e(this).attr("data-id"))});if(s.length<1)return e.goMessage(i["\uc0ad\uc81c\ud560 \ud56d\ubaa9\uc744 \uc120\ud0dd\ud558\uc138\uc694."]),!1;e.goCaution(i["\ud30c\uc77c \uc0ad\uc81c \uc2dc \ubcf5\uad6c\ub418\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4. \uc0ad\uc81c\ud558\uc2dc\uaca0\uc2b5\ub2c8\uae4c"],"",function(){e.go(GO.config("contextRoot")+u.apiUrl,JSON.stringify({ids:s}),{qryType:"DELETE",contentType:"application/json",responseFn:function(t){t.code==200&&(e.goMessage(r["\uc0ad\uc81c\ub418\uc5c8\uc2b5\ub2c8\ub2e4."]),n.render())},error:function(t){var n=JSON.parse(t.responseText);n!=null?e.goAlert(n.message):e.goMessage(r["\uc2e4\ud328\ud588\uc2b5\ub2c8\ub2e4."])}})})},search:function(){var t=this.$el.find(".table_search input[type='text']"),r=t.val();if(r.length>64){e.goAlert(n.i18n(i["0\uc790\uc774\uc0c1 0\uc774\ud558 \uc785\ub825\ud574\uc57c\ud569\ub2c8\ub2e4."],{arg1:"1",arg2:"64"}));return}this.dataTable.tables.search(this.$el.find(".table_search select").val(),r,t)},searchKeyboardEvent:function(e){e.keyCode==13&&this.search()},onClickedWrapAction:function(){this.$el.find(".wrap_action").toggle(),this.$el.find(".info_summary li").not(".first").toggle()}},{attachTo:function(e){var t=new p;return e.empty().append(t.el),t.render(),t}});return p});