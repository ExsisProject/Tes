(function(){define(["jquery","backbone","app","hgn!admin/templates/board_group_list","admin/collections/board_group_list","i18n!nls/commons","i18n!admin/nls/admin"],function(e,t,n,r,i,s,o){var u={manager_add:o["\ud074\ub798\uc2a4 \uc120\ud0dd"],manager_modify:o["\uc5f4\ub78c\uc790 \uc218\uc815 : "],department:o["\ubd80\uc11c"],user:o["\uc0ac\uc6a9\uc790"],position:o["\uc9c1\uc704"],rank:o["\uc9c1\uae09"],duty:o["\uc9c1\ucc45"],user_group:o["\uc0ac\uc6a9\uc790\uadf8\ub8f9"],writable:o["\uc4f0\uae30\uac00\ub2a5"],submit:o["\ub4f1\ub85d"],save:s["\uc800\uc7a5"],read:o["\uc77d\uae30"],write:o["\uc4f0\uae30"],modify:s["\uc218\uc815"],del:s["\uc0ad\uc81c"],duplicatePermission:o["\uc774\ubbf8 \ucd94\uac00\ub41c \uc5f4\ub78c\uc790 \uc785\ub2c8\ub2e4."],additional_warining_manager:o["\uc5f4\ub78c\uc790 \ucd94\uac00 \uacbd\uace0"],low_dept:o["\ud558\uc704 \ubd80\uc11c \ud3ec\ud568"]},a=null,f=!1,l=t.View.extend({initialize:function(e){this.options=e||{},this.type=this.options.type;var t=r({lang:u,isOrgServiceOn:GO.util.isUseOrgService(!0)});this.$el.html(t),this.unbindEvent(),this.bindEvent()},unbindEvent:function(){this.$el.off("change","select.baseJobList"),this.$el.off("click","span[data-btntype='addBtn']"),this.$el.off("click","span[data-btntype='saveBtn']"),this.$el.off("click","span[data-btntype='cancelBtn']")},bindEvent:function(){this.$el.on("change","select.baseJobList",e.proxy(this.changeGroupList,this)),this.$el.on("click","span[data-btntype='addBtn']",e.proxy(this.addBtn,this)),this.$el.on("click","span[data-btntype='saveBtn']",e.proxy(this.saveBtn,this)),this.$el.on("click","span[data-btntype='cancelBtn']",e.proxy(this.cancelBtn,this))},addBtn:function(t){var n=this.$el.find(".baseJobList option:selected");if(n.val()=="department"){this.addDept();return}if(n.val()=="user"){this.addUser();return}var r=this.$el.find(".groupListSelect option:selected"),i=u.read,s="1",o="",a="NONE";if(r.html()==undefined){e.goMessage(u.additional_warining_manager);return}this.$el.find(".writePossible").is(":checked")&&(i=u.read+"/"+u.write,s="3"),e("#sharedType").is(":checked")&&(o="("+u.low_dept+")",a="TO_SUB"),this.validateDuplicatePermission(r.val(),n.val(),s);var f="";f="<li data-code='"+r.val()+"' data-permission='"+s+"'>"+"<span class='major'>["+n.html()+" : "+r.html()+"]</span>"+"<span class='minor'>"+i+"</span>"+"<span class='btn_border'><span class='ic ic_delete' title='"+u.del+"' data-btntype='publicDelete'></span></span>"+"</li>",e("#groupUl").addClass("list_option").append(f)},validateDuplicatePermission:function(t,n,r){var i=e("#groupUl li"),s=[];i.each(function(){var t=e(this);s.push({data_code:t.attr("data-code"),data_type:t.attr("data-type")})}),e.each(s,function(){if(this["data_code"]==t&&this["data_type"]==n)throw e.goMessage(u.duplicatePermission),new Error})},saveBtn:function(t){var n=e(t.currentTarget).parents("li").first(),r=e(t.currentTarget).parents("li").first().prev("li");if(e(t.currentTarget).parent("li").find(".baseJobList").val()=="department"){this.addDept(t,n,r);return}if(e(t.currentTarget).parent("li").find(".baseJobList").val()=="user"){this.addUser(t,n,r);return}var i=n.find(".baseJobList option:selected").html(),s=n.find(".groupListSelect option:selected"),o=n.find(".writePossible").is(":checked")?u.read+"/"+u.write:u.read,a=n.find(".writePossible").is(":checked")?"3":"1",f=n.find(".sharedType").is(":checked")?"TO_SUB":"NONE";r.attr("data-code",s.val()),r.attr("data-permission",a),r.attr("data-type",i.val()),r.attr("data-sharedType",f),r.find("span.major").html("["+i+" : "+s.html()+"]"),r.find("span.minor").html(o),r.find("span.btn_border").css("display",""),n.remove()},cancelBtn:function(t){var n=e(t.currentTarget).parents("li");n.prev().find("span.btn_border").show(),n.remove()},changeGroupList:function(t){var n=this.$el.find(".baseJobList option:selected");"department"==n.val()||"user"==n.val()?t!=undefined?(e(t.currentTarget).parent().find(".groupListSelect").hide(),"department"==n.val()?e(t.currentTarget).parent().find("#sharedType").parent("span").show():e(t.currentTarget).parent().find("#sharedType").parent("span").hide()):e(".groupListSelect").hide():t!=undefined?(e(t.currentTarget).parent().find(".groupListSelect").show(),e(t.currentTarget).parent().find("#sharedType").parent("span").hide()):e(".groupListSelect").show();var r="";if(n.val()!="department"&&n.val()!="user"){var s=i.getGroupList({groupValue:n.val()});e.each(s.toJSON(),function(e,t){r+="<option value="+t.id+">"+t.name+"</option>"})}this.type=="add"?this.$el.find(".groupListSelect").html(r):(this.$el.find(".groupListSelect").html(r),this.$el.find(".addBtn").hide(),this.$el.find(".saveBtn").show(),this.$el.find(".publicAdd").html(u.manager_modify))},addCollback:function(t,n,r,i){var s=this,a=u.read,f=1,l="",c="NONE";e(".writePossible").is(":checked")&&(a=u.read+"/"+u.write,f=3),n=="Department"&&(e("#sharedType").is(":checked")&&(l="("+u.low_dept+")",c="TO_SUB"),r!=undefined&&(l=r.find(".sharedType").is(":checked")?u.low_dept:"",c=r.find(".sharedType").is(":checked")?"TO_SUB":"NONE")),r==undefined&&s.validateDuplicatePermission(t.id,n,c);var h=n=="User"?o["\uc0ac\uc6a9\uc790"]:o["\ubd80\uc11c"],p="";p="<li data-code='"+t.id+"' data-type='"+n+"' data-permission='"+f+"' data-sharedType ='"+c+"'>"+"<span class='major'>["+h+" : "+t.name+"]</span>"+"<span class='minor'>"+a+" "+l+"</span>"+"<span class='btn_border'><span class='ic ic_delete' title='"+u.del+"' data-btntype='publicDelete'></span></span>"+"</li>",e("#groupUl").addClass("list_option").append(p),r!=undefined&&(r.remove(),i.remove(),r=null,i=null)},addUser:function(t,n,r){var i=this;e.goOrgSlide({target:t,header:o["\uc0ac\uc6a9\uc790 \ucd94\uac00"],desc:"",contextRoot:GO.contextRoot,callback:e.proxy(function(e){i.addCollback(e,"User",n,r)},this),isAdmin:!0})},addDept:function(t,n,r){var i=this;e.goOrgSlide({target:t,header:o["\ubd80\uc11c \ucd94\uac00"],type:"department",desc:o["\ubd80\uc11c\ub97c \uc120\ud0dd\ud574 \uc8fc\uc2ed\uc2dc\uc624."],contextRoot:GO.contextRoot,callback:e.proxy(function(e){i.addCollback(e,"Department",n,r)},this),isAdmin:!0})},render:function(){return this.changeGroupList(),this}});return{render:function(e){return this.boardList=f,a=new l({el:e.id,type:e.type}),a.render()},init:function(){return l}}})}).call(this);