(function(){define(["jquery","backbone","app","admin/models/install_info","admin/models/link_menu","attach_file","hgn!admin/templates/link_menu_create","hgn!admin/templates/link_menu_update","i18n!nls/commons","i18n!admin/nls/admin","file_upload","jquery.go-validation","jquery.go-popup"],function(e,t,n,r,i,s,o,u,a,f,l){var c={label_quick_link_setting:f["\ubc14\ub85c\uac00\uae30 \ubc84\ud2bc \uc124\uc815"],label_quick_link_tip:f["PC \uba54\uc2e0\uc800 \ubc14\ub85c\uac00\uae30 \ubc84\ud2bc \uc124\uba85"],label_button:f["\ubc84\ud2bc\uba85"],label_url:f["\ubc14\ub85c\uac00\uae30 URL"],label_confirm:a["\ud655\uc778"],label_sucess:a["\uc800\uc7a5\ub418\uc5c8\uc2b5\ub2c8\ub2e4."],label_fail:a["\uc2e4\ud328"],label_failDesc:a["\uc2e4\ud328\ud588\uc2b5\ub2c8\ub2e4."],label_edit:a["\uc218\uc815"],label_ok:a["\uc800\uc7a5"],label_cancel:a["\ucde8\uc18c"],label_use:f["\uc0ac\uc6a9\ud568"],label_notuse:a["\uc0ac\uc6a9\ud558\uc9c0 \uc54a\uc74c"],label_delete:a["\uc0ad\uc81c"],label_order:f["\uc21c\uc11c \ubc14\uafb8\uae30"],label_setting:a["\uc124\uc815"],label_able:f["\uc0ac\uc6a9\uc5ec\ubd80"],label_icon:f["\uc544\uc774\ucf58"],label_btn_name:f["\ubc84\ud2bc\uba85"],label_add_btn_name:f["\ubc84\ud2bc\uba85 \uc5b8\uc5b4\ud56d\ubaa9 \ucd94\uac00"],label_location:f["\ubc14\ub85c\uac00\uae30 \uc774\ub3d9 \ubc29\uc2dd"],label_new:f["\uc0c8 \ube0c\ub77c\uc6b0\uc800 \uc0ac\uc6a9"],label_popup:f["\ud31d\uc5c5\ucc3d \uc0ac\uc6a9"],label_exe:f["\uc2e4\ud589\ud30c\uc77c \uc0ac\uc6a9"],label_exe_name:f["\uc2e4\ud589\ud30c\uc77c\uba85"],label_ko:f.KO,label_en:f.EN,label_jp:f.JP,label_zhcn:f["ZH-CN"],label_zhtw:f["ZH-TW"],label_vi:f.VI,label_img_size_info:f["\uc774\ubbf8\uc9c0 \ub9ac\uc0ac\uc774\uc988 \uc124\uba85"],label_info_add_select:f["\ucd94\uac00\ud560 \ud56d\ubaa9\uc744 \uc120\ud0dd\ud558\uc138\uc694."],label_popup_size_exam:f["\u203b \ud06c\uae30\ub294 \ucd5c\uc18c 100x100 \ubd80\ud130, \ucd5c\ub300 1024x768 \uae4c\uc9c0 \uac00\ub2a5\ud569\ub2c8\ub2e4."],label_locaion_exam:f["\ud398\uc774\uc9c0\uac00 \ub098\ud0c0\ub098\uc9c0 \uc54a\uc744 \ub54c http:// \ud3ec\ud568 \uc124\uba85"],label_status:f["\ud65c\uc131\ud654 \uc5ec\ubd80"]},h=n.BaseView.extend({el:".layer_normal .content",events:{"change #more_link_name":"addMoreLinkName",'click span.btn_box[data-btntype="changepopupname"]':"changeModifyName",'click span.btn_box[data-btntype="changepopupurl"]':"changeModifyUrl","click #delete_icon":"deleteIcon","click input:radio":"toggleRadio","keyup input:text":"countAlphabet"},initialize:function(e){this.options=e||{},this.linkMenuId=this.options.linkMenuId,this.release(),this.model=i.create(),GO.EventEmitter.off("admin"),GO.EventEmitter.on("admin","changed:saveLinkMenu",function(){this.saveLinkMenu(arguments[0])},this)},render:function(){var t,n,s=r.read().toJSON().language;s=="ja"?n="jp":s=="zh_CN"?n="zhcn":s=="zh_TW"?n="zhtw":n=s;if(this.linkMenuId){var a=this;this.model!=null&&this.model.clear(),this.model=i.read(this.linkMenuId),t=u({lang:c,popupmodel:this.model.toJSON(),isKoLocale:function(){return a.getCompanyLocale(n,"ko")},isEnLocale:function(){return a.getCompanyLocale(n,"en")},isJpLocale:function(){return a.getCompanyLocale(n,"jp")},isZhcnLocale:function(){return a.getCompanyLocale(n,"zhcn")},isZhtwLocale:function(){return a.getCompanyLocale(n,"zhtw")},isViLocale:function(){return a.getCompanyLocale(n,"vi")},icon:function(){if(a.model.get("attach"))return a.model.get("attach").thumbLarge},id:function(){if(a.model.get("attach"))return a.model.get("attach").id},isSystemLink:function(){return a.model.get("systemLink")}}),this.$el.html(t);var f=this.model.get("location");e('input[name="location"][value="'+f.toLowerCase()+'"]').attr("checked",!0),this.model.get("location")=="new"&&e("#popupSize").hide(),this.model.get("location")=="exe"&&(e("#popupSize").hide(),e("#exeLabel").show(),e("#urlLabel").hide(),e("#urlDesc").hide());var l=this.model.get("useQuickLink");e('input[name="useQuickLink"][value="'+l+'"]').attr("checked",!0),this.setModifyMenuData(this.model.toJSON())}else{var a=this;t=o({lang:c,isKoLocale:function(){return a.getCompanyLocale(n,"ko")},isEnLocale:function(){return a.getCompanyLocale(n,"en")},isJpLocale:function(){return a.getCompanyLocale(n,"jp")},isZhcnLocale:function(){return a.getCompanyLocale(n,"zhcn")},isZhtwLocale:function(){return a.getCompanyLocale(n,"zhtw")},icon:function(){return GO.contextRoot+"/resources/images/pc_msg/icon_rink.png"}}),this.$el.html(t)}this.initProfileUpload()},getCompanyLocale:function(e,t){return e==t?!0:!1},setModifyMenuData:function(t){t.koname&&(e('tr[data-id="konameInput"]').show(),e('#more_link_name > option[value="koname"]').remove()),t.enname&&(e('tr[data-id="ennameInput"]').show(),e('#more_link_name > option[value="enname"]').remove()),t.jpname&&(e('tr[data-id="jpnameInput"]').show(),e('#more_link_name > option[value="jpname"]').remove()),t.zhcnname&&(e('tr[data-id="zhcnnameInput"]').show(),e('#more_link_name > option[value="zhcnname"]').remove()),t.zhtwname&&(e('tr[data-id="zhtwnameInput"]').show(),e('#more_link_name > option[value="zhtwname"]').remove()),t.viname&&(e('tr[data-id="vinameInput"]').show(),e('#more_link_name > option[value="viname"]').remove()),e("#more_link_name option").size()==1&&e('tr[data-id="addMenuName"]').hide()},addMoreLinkName:function(t){e('[data-id="'+t.target.value+'Input"]').show(),e(t.target).find(":selected").remove(),e("#more_link_name option").size()==1&&e('[data-id="addMenuName"]').hide()},saveLinkMenu:function(t){var i=this,s="POST",o=!0,u=r.read().toJSON().language,l=e('input[name="location"][value="popup"]').is(":checked"),c=e('input[name="location"][value="exe"]').is(":checked"),h=e("form[name=formCreateLinkMenu]");this.linkMenuId&&(h=e("form[name=formUpdateLinkMenu]"),s="PUT"),e.each(h.serializeArray(),function(t,r){var s=e("#"+u+"nameValidate");if(r.name==u+"name"&&!e.goValidation.isCheckLength(1,16,r.value))return o=!1,s.html(n.i18n(f["0\uc790\uc774\uc0c1 0\uc774\ud558 \uc785\ub825\ud574\uc57c\ud569\ub2c8\ub2e4."],{arg1:"1",arg2:"16"})),e("#"+r.name).focus(),!1;if(r.name.indexOf("name")>-1&&r.value.length>0&&!e.goValidation.isCheckLength(1,16,r.value)){o=!1;var a=e("#"+r.name+"Validate");return a.html(n.i18n(f["0\uc790\uc774\uc0c1 0\uc774\ud558 \uc785\ub825\ud574\uc57c\ud569\ub2c8\ub2e4."],{arg1:"1",arg2:"16"})),e("#"+r.name).focus(),!1}s.empty();if(r.name=="url"&&r.value=="")return o=!1,c?e("#exeValidate").html(f["\uc2e4\ud589\ud30c\uc77c\uba85\uc744 \uc785\ub825\ud558\uc138\uc694."]):e("#urlValidate").html(f["url\uc744 \uc785\ub825\ud574\uc8fc\uc138\uc694."]),e("#"+r.name).focus(),!1;e("#urlValidate").empty();if(r.name=="popupWidth"&&l&&!e.goValidation.isNumber(r.value))return o=!1,e("#"+r.name+"Validate").html(f["\uc22b\uc790\ub9cc \uc785\ub825\ud558\uc138\uc694."]),e("#"+r.name).focus(),!1;if(r.name=="popupWidth"&&l&&r.value=="")return o=!1,e("#"+r.name+"Validate").html(f["\ud06c\uae30\ub97c \ubcc0\uacbd\ud574\uc8fc\uc138\uc694."]),e("#"+r.name).focus(),!1;if(r.name=="popupWidth"&&l&&(r.value<100||r.value>1024))return o=!1,e("#"+r.name+"Validate").html(f["\ud06c\uae30\ub97c \ubcc0\uacbd\ud574\uc8fc\uc138\uc694."]),e("#"+r.name).focus(),!1;e("#"+r.name+"Validate").empty();if(r.name=="popupHeight"&&l&&!e.goValidation.isNumber(r.value))return o=!1,e("#"+r.name+"Validate").html(f["\uc22b\uc790\ub9cc \uc785\ub825\ud558\uc138\uc694."]),e("#"+r.name).focus(),!1;if(r.name=="popupHeight"&&l&&r.value=="")return o=!1,e("#"+r.name+"Validate").html(f["\ud06c\uae30\ub97c \ubcc0\uacbd\ud574\uc8fc\uc138\uc694."]),e("#"+r.name).focus(),!1;if(r.name=="popupHeight"&&l&&(r.value<100||r.value>1024))return o=!1,e("#"+r.name+"Validate").html(f["\ud06c\uae30\ub97c \ubcc0\uacbd\ud574\uc8fc\uc138\uc694."]),e("#"+r.name).focus(),!1;e("#"+r.name+"Validate").empty(),i.model.set(r.name,r.value,{silent:!0})});if(!o)return!1;this.model.set("attach",this.getAttach()),this.model.save({},{type:s,success:function(n,r){r.code=="200"&&(e.goMessage(a["\uc800\uc7a5\ub418\uc5c8\uc2b5\ub2c8\ub2e4."]),t.close(),GO.EventEmitter.trigger("common","layout:clearOverlay",!0))},error:function(n,r){var i=JSON.parse(r.responseText);e.goMessage(i.message),t.close(),GO.EventEmitter.trigger("common","layout:clearOverlay",!0)}})},deleteIcon:function(t){var n=e(t.currentTarget).parents("td").find("span.img_appicon img");console.log(this.model.toJSON()),console.log(this.model.toJSON().defaultIcon),n.attr("src",this.model.toJSON().defaultIcon),n.attr("data-id","")},getAttach:function(){var t=e(".img_appicon img"),n={id:t.attr("data-id")||null,path:t.attr("data-filepath"),name:t.attr("data-filename"),hostId:t.attr("data-hostId")};return n},changeModifyName:function(t){var r=e(t.currentTarget).parent(),i=r.val(),s=e(t.currentTarget).attr("data-locale"),o=s!=undefined?s+"Name":"";if(r&&r.attr("data-formname")){e(t.currentTarget).hide(),r.html(['<input type="text" name="',r.attr("data-formname"),'" class="input w_space_r " value="',r.attr("data-value"),'" /> <span class="alphabetCount">',r.attr("data-value").length," / 16</span>"].join("")).find("input").focusin();var u=r.parent().find("#"+r.attr("data-formname")+"Validate");r.find("input").keyup(function(t){r.attr("data-formname")==o&&!e.goValidation.isCheckLength(1,16,e(t.currentTarget).val())?u.html(n.i18n(f["0\uc790\uc774\uc0c1 0\uc774\ud558 \uc785\ub825\ud574\uc57c\ud569\ub2c8\ub2e4."],{arg1:"1",arg2:"16"})):r.attr("data-formname")!=o&&e(t.currentTarget).val().length>0&&!e.goValidation.isCheckLength(1,16,e(t.currentTarget).val())?u.html(n.i18n(f["0\uc790\uc774\uc0c1 0\uc774\ud558 \uc785\ub825\ud574\uc57c\ud569\ub2c8\ub2e4."],{arg1:"1",arg2:"16"})):u.empty()})}},changeModifyUrl:function(t){var r=e(t.currentTarget).parent();if(r&&r.attr("data-formname")){e(t.currentTarget).hide(),r.html(['<input type="input" name="',r.attr("data-formname"),'" class="input w_full" value="',r.attr("data-value"),'" />'].join("")).find("input").focusin();var i=r.parent().find("#"+r.attr("data-formname")+"Validate");r.find("input").keyup(function(t){e.goValidation.isCheckLength(1,128,e(t.currentTarget).val())?i.empty():i.html(n.i18n(c.label_validate,{arg1:"1",arg2:"128"}))})}},toggleRadio:function(t){e(t.currentTarget).attr("value")=="new"?(e("#popupSize").hide(),e("#exeLabel").hide(),e("#urlLabel").show(),e("#urlDesc").show()):e(t.currentTarget).attr("value")=="popup"?(e("#popupSize").show(),e("#exeLabel").hide(),e("#urlLabel").show(),e("#urlDesc").show()):e(t.currentTarget).attr("value")=="exe"&&(e("#popupSize").hide(),e("#exeLabel").show(),e("#urlLabel").hide(),e("#urlDesc").hide())},countAlphabet:function(t){var n=e(t.currentTarget).attr("value").length;e(t.currentTarget).parents("td").find(".alphabetCount").html(n+" / 16"),n>15?e(t.currentTarget).parents("td").find(".alphabetCount").addClass("go_alert"):e(t.currentTarget).parents("td").find(".alphabetCount").removeClass("go_alert")},initProfileUpload:function(){var t=this,n={el:"#swfupload-control",context_root:GO.contextRoot,button_text:"<span class='buttonText'>\ucc3e\uc544\ubcf4\uae30</span>",button_style:"text-align:center; color:#9f9f9f; font-weight:bold; font-size:12px; display:inline-block; background:#fff; border:1px solid #cfcfcf; cursor:pointer; font-family:gulim;",button_height:"22px",button_width:"60px",top_padding:2,progressBarUse:!1,url:"ad/api/file?GOAdminSSOcookie="+e.cookie("GOAdminSSOcookie")};(new l(n)).queue(function(e,t){}).start(function(e,t){}).progress(function(e,t){}).success(function(t,n,r){if(GO.util.fileUploadErrorCheck(n))return e.goMessage(GO.util.serverMessage(n)),!1;var i=n.data,s=i.fileName,o=i.filePath,u=i.hostId,f=i.thumbnail,l=i.fileExt.toLowerCase(),c=new RegExp("(jpeg|jpg|gif|png|bmp)","gi"),h=c.test(l);h?e("#thumbnail_image").attr("src",f).attr("data-filepath",o).attr("data-filename",s).attr("host-id",u).attr("data-id",null):e.goMessage(a["\ud3ec\uba67 \uacbd\uace0"])}).complete(function(e,t){console.info(t)}).error(function(e,t){console.info(t)})},release:function(){this.$el.off(),this.$el.empty()}},{__instance__:null,create:function(e){var t=new h({linkMenuId:e?e.linkMenuId:""});return t.linkMenuId=e?e.linkMenuId:"",t.render()}});return{render:function(e){var t=h.create(e);return t}}})}).call(this);