define(["jquery","backbone","app","i18n!nls/commons","i18n!admin/nls/admin","i18n!asset/nls/asset","hgn!admin/templates/asset_create","admin/views/asset_group_list","hgn!board/templates/board_create_manager","hgn!admin/templates/asset_modify","admin/models/base_model","jquery.go-orgslide","jquery.go-sdk","jquery.go-validation","jquery.go-popup"],function(e,t,n,r,i,s,o,u,a,f,l){var c={asset_basic_info:i["\uae30\ubcf8\uc815\ubcf4"],asset_add_info:i["\uc790\uc0b0 \ub4f1\ub85d\uc815\ubcf4"],asset_name:i["\uc790\uc0b0\uba85"],book_setting:i["\uc608\uc57d/\ub300\uc5ec \uc124\uc815"],loop_reservation_setting:i["\ubc18\ubcf5\uc608\uc57d \ud5c8\uc6a9"],asset_rent:i["\ub300\uc5ec"],asset_book:i["\uc608\uc57d"],asset_rent_info:i["\ub300\uc5ec\ub85c \uc124\uc815\uc2dc, \ubc18\ub0a9 \uc608\uc815\uc77c\uc744 \uc124\uc815\ud558\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4."],asset_time:i["\uc0ac\uc6a9 \uc2dc\uac04"],asset_week:i["\uc0ac\uc6a9 \uc694\uc77c"],asset_mon:i["\uc6d4"],asset_tue:i["\ud654"],asset_wed:i["\uc218"],asset_thu:i["\ubaa9"],asset_fri:i["\uae08"],asset_sat:i["\ud1a0"],asset_sun:i["\uc77c"],asset_cal:i["\uce98\ub9b0\ub354 \uc5f0\ub3d9"],asset_use:i["\uc0ac\uc6a9\ud568"],asset_no_use:i["\uc0ac\uc6a9\uc548\ud568"],asset_use_info:i["\uce98\ub9b0\ub354\uc5d0\uc11c \uc77c\uc815 \ub4f1\ub85d\uc2dc, \uc790\uc0b0 \uc608\uc57d\uc744 \uc0ac\uc6a9\ud560 \uac83\uc778\uc9c0 \uc124\uc815\ud569\ub2c8\ub2e4."],asset_use_auth:i["\uc774\uc6a9 \uad8c\ud55c"],asset_use_all:i["\uc804\uccb4 \ud5c8\uc6a9"],asset_use_part:i["\uc77c\ubd80\ub9cc \ud5c8\uc6a9"],asset_save:r["\uc800\uc7a5"],asset_cancel:r["\ucde8\uc18c"],asset_manager:i["\uc6b4\uc601\uc790"],asset_manager_select:i["\uc6b4\uc601\uc790 \ucd94\uac00"],alert_admin_add:i["\uc6b4\uc601\uc790\ub97c \ucd94\uac00\ud558\uc154\uc57c \ud569\ub2c8\ub2e4."],alert_no_change:i["\uc608\uc57d/\ub300\uc5ec \uc124\uc815\uc740 \ub098\uc911\uc5d0 \ubcc0\uacbd\ud558\uc2e4 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4."],alert_calendar:i["\uce98\ub9b0\ub354\uc5d0\uc11c \uc77c\uc815 \ub4f1\ub85d\uc2dc, \uc608\uc57d\uc744 \uc0ac\uc6a9\ud560 \uac83\uc778\uc9c0 \uc124\uc815\ud569\ub2c8\ub2e4."],no_title:i["\uc790\uc0b0\uba85\uc744 \uc785\ub825\ud558\uc154\uc57c\ud569\ub2c8\ub2e4."],alert_length:i["0\uc790\uc774\uc0c1 0\uc774\ud558 \uc785\ub825\ud574\uc57c\ud569\ub2c8\ub2e4."],asset_stop:i["\uc0ac\uc6a9 \uc911\uc9c0"],asset_stop_confirm:i["\uae30\uc874\uc5d0 \uc608\uc57d\ud588\ub358 \ub370\uc774\ud130\uac00 \uc0ad\uc81c\ub429\ub2c8\ub2e4.<br>\uc911\uc9c0\ud558\uc2dc\uaca0\uc2b5\ub2c8\uae4c?"],asset_delete:i["\uc790\uc0b0 \uc0ad\uc81c"],asset_delete_confirm:i["\uc790\uc0b0 \ub370\uc774\ud130\uac00 \uc0ad\uc81c\ub429\ub2c8\ub2e4.<br>\uc0ad\uc81c\ud558\uc2dc\uaca0\uc2b5\ub2c8\uae4c?"],asset_delete:r["\uc0ad\uc81c"],asset_modify:r["\uc800\uc7a5"],asset_no_owner:i["\ubbf8\uc9c0\uc815"],asset_stop_alert:i["\uc790\uc0b0\uc758 \uc0ac\uc6a9\uc744 \uc911\uc9c0\ud569\ub2c8\ub2e4."],asset_delete_alert:i["\uc790\uc0b0\uc5d0 \ub300\ud55c \ubaa8\ub4e0 \ub370\uc774\ud130\ub97c \uc0ad\uc81c\ud569\ub2c8\ub2e4."],add_manager_alert:i["\uc5f4\ub78c\uc790\ub97c \ucd94\uac00\ud574\uc8fc\uc138\uc694."],asset_time_alert:i["\uc2dc\uac04 \uc124\uc815"],modify:r["\uc218\uc815"],del:r["\uc0ad\uc81c"],asset_allow_anonym:s["\uc775\uba85\ud5c8\uc6a9"],allow:r["\ud5c8\uc6a9"],disallow:r["\ud5c8\uc6a9\ud558\uc9c0 \uc54a\uc74c"],always_anonym:s["\ud56d\uc0c1 \uc775\uba85\uc73c\ub85c \uc608\uc57d"]},h=null,p=t.View.extend({unbindEvent:function(){this.$el.off("click","input[name=type]:radio"),this.$el.off("click","input[name=share]:radio"),this.$el.off("click","span[data-btntype='publicDelete']"),this.$el.off("click","span[data-btntype='publicModify']"),this.$el.off("click","#selectManager"),this.$el.off("click","ul.name_tag li span.ic_del"),this.$el.off("click","span.btn[data-btntype='submit']"),this.$el.off("click","span.btn[data-btntype='modify']"),this.$el.off("click","span.btn_nega[data-btntype='cancel']"),this.$el.off("click","#deleteFlag"),this.$el.off("click","#statusFlag"),this.$el.off("click","#statusFlag"),this.$el.off("click","input[name=allowAnonym]")},bindEvent:function(){this.$el.on("click","input[name=type]:radio",e.proxy(this.toggleTypeRadio,this)),this.$el.on("click","input[name=share]:radio",e.proxy(this.togglePublicRadio,this)),this.$el.on("click","span[data-btntype='publicDelete']",e.proxy(this.deletePublicRange,this)),this.$el.on("click","span[data-btntype='publicModify']",e.proxy(this.modifyPublicRange,this)),this.$el.on("click","#selectManager",e.proxy(this.addManager,this)),this.$el.on("click","ul.name_tag li span.ic_del",e.proxy(this.deleteMember,this)),this.$el.on("click","span.btn[data-btntype='submit']",e.proxy(this.createAsset,this)),this.$el.on("click","span.btn[data-btntype='modify']",e.proxy(this.modifyAsset,this)),this.$el.on("click","span.btn_nega[data-btntype='cancel']",e.proxy(this.cancelAsset,this)),this.$el.on("click","#deleteFlag",e.proxy(this.checkDeleteFlag,this)),this.$el.on("click","#statusFlag",e.proxy(this.checkStatusFlag,this)),this.$el.on("click","#DayOfWeek span input",e.proxy(this.checkWeek,this)),this.$el.on("click","input[name=allowAnonym]",e.proxy(this._onClickAnonymOption,this))},checkWeek:function(){var t=e("#DayOfWeek span input:checked");t.length<2?t.attr("disabled",!0):t.attr("disabled",!1)},checkStatusFlag:function(){e("#statusFlag").is(":checked")?(e.goConfirm(c.asset_stop,c.asset_stop_confirm,function(){return e("#statusFlag").attr("checked",!0),!1}),e("#statusFlag").attr("checked",!1)):e("#statusFlag").attr("checked",!1)},checkDeleteFlag:function(){e("#deleteFlag").is(":checked")?(e.goCaution(c.asset_delete,c.asset_delete_confirm,function(){return e("#deleteFlag").attr("checked",!0),e("#statusFlag").attr("disabled",!0),!1}),e("#deleteFlag").attr("checked",!1)):e("#statusFlag").attr("disabled",!1)},initialize:function(e){this.options=e||{},this.assetId=this.options.assetId},render:function(){this.unbindEvent(),this.bindEvent(),this.sendCheck=!1;var e;if(this.assetId){this.assetModel=new l({id:this.assetId,urlRoot:GO.contextRoot+"ad/api/asset"}),this.assetModel.fetch({async:!1}),this.assetData=this.assetModel.toJSON();var t=function(){return this.useRental?!1:!0};e=f({dataset:this.assetData,type:t,lang:c}),this.$el.html(e),this.initModifyForm(this.assetData)}else e=o({lang:c}),this.$el.html(e)},initModifyForm:function(t){var n=this;if(t.availabilityDate){e("#startTime").val(t.availabilityDate.startTime),e("#endTime").val(t.availabilityDate.endTime);var r=e("#DayOfWeek").find("input");e.each(t.availabilityDate.ableDays.split(""),function(e,t){t=="1"&&(r[e].checked=!0)}),this.$el.find('input[name="useCalendar"][value="'+t.availabilityDate.useCalendar+'"]').attr("checked",!0),this.checkWeek()}else this.setDisable(!0);this.$el.find('input[name="share"][value="'+t.publicFlag+'"]').attr("checked",!0),e.each(t.managers,function(e,t){n.setManager(t.user)}),t.publicFlag||(e(".option_display").show(),e("#partPublicWrap").show(),e("#groupUl").show(),u.render({id:"#partPublicWrap",type:"add"}),e.each(t.owners,function(e,t){n.setJointOwners(t)})),t.status=="STOP"&&e("#statusFlag").attr("checked",!0),t.allowLoopReservation?e("#allowLoopReservation").trigger("click"):e("#disallowLoopReservation").trigger("click"),t.allowAnonym?(e("#allowAnonym").trigger("click"),e("#alwaysAnonym").prop("checked",!!t.alwaysAnonym)):e("#disallowAnonym").trigger("click")},setManager:function(t){var n=e("#assetManagerList");t&&!n.find('li[data-id="'+t.id+'"]').length?n.find("li.creat").before(a(e.extend(t,{lang:c}))):e.goAlert("",i["\uc774\ubbf8 \uc6b4\uc601\uc790\ub85c \uc9c0\uc815"])},setJointOwners:function(t){var n=e("#groupUl"),r;if(t.ownerShip=="MASTER")return;var i=t.ownerInfo.split("|"),s,o;s=i[0],o=i[1],i==""&&(s=c.asset_no_owner,o=c.asset_no_owner),r="<li data-code='"+t.ownerId+"'>"+"<span class='major'>["+s+" : "+o+"]</span>"+"<span class='btn_border'><span class='ic ic_edit' title='"+c.modify+"' data-btntype='publicModify'></span></span>"+"<span class='btn_border'><span class='ic ic_delete' title='"+c.del+"' data-btntype='publicDelete'></span></span>"+"</li>",n.append(r)},setOwners:function(t){var n=[];if(t=="false"){var r=e("#groupUl").find("li");if(r.length<1)return!1;r.each(function(){n.push({ownerShip:"MODERATOR",ownerType:"DomainCode",ownerId:e(this).attr("data-code")})})}return n},setManagerIds:function(){var t=[],n=e("#assetManagerList").find("li[data-id]");return n.each(function(){t.push(e(this).attr("data-id"))}),t},getAvailabilityData:function(){var t=e("#startTime").val(),n=e("#endTime").val(),r=e("#DayOfWeek").find("input"),i="";r.each(function(){e(this).attr("checked")?i+="1":i+="0"});var s=e("input[name=useCalendar]:radio:checked").val(),o;return o={startTime:t,endTime:n,ableDays:i,useCalendar:s,timeInterval:"A_HOUR"},o},timeIntervalValidator:function(t,n){return t>=n?(e.goMessage(c.asset_time_alert),!1):!0},createAsset:function(){var t=this;if(this.sendCheck)return;this.sendCheck=!0;var r=e.trim(e("#name").val()),i=e('input[name="type"]:radio:checked').val();if(e.trim(r)==""){e.goMessage(c.no_title),this.sendCheck=!1;return}if(!e.goValidation.isCheckLength(2,100,r)){e.goMessage(n.i18n(c.alert_length,{arg1:"2",arg2:"100"})),e("#name").focus(),this.sendCheck=!1;return}var s=this.getAvailabilityData();if(!this.timeIntervalValidator(s.startTime,s.endTime)){this.sendCheck=!1;return}var o=e("input[name=share]:radio:checked").val(),u=this.setOwners(o);if(!u){this.sendCheck=!1,e.goMessage(c.add_manager_alert);return}var a=this.setManagerIds();if(e("#assetManagerList").find("li").length<2){e.goMessage(c.alert_admin_add),this.sendCheck=!1;return}var f=e("#allowAnonym").is(":checked"),l=f&&e("#alwaysAnonym").is(":checked"),h=e("#allowLoopReservation").is(":checked");i==="true"&&(h=!1);var p=GO.contextRoot+"ad/api/asset",d={name:r,useRental:i,availabilityDate:s,publicFlag:o,managerIds:a,owners:u,allowAnonym:f,alwaysAnonym:l,allowLoopReservation:h};e.ajax(p,{type:"POST",contentType:"application/json",data:JSON.stringify(d),success:function(e){e.code==200&&n.router.navigate("/asset",!0)},complete:function(){t.sendCheck=!1}})},modifyAsset:function(){var t=this,r=e("#assetId").val(),i=e("#name").val();if(this.sendCheck)return;this.sendCheck=!0;if(e.trim(i)==""){e.goMessage(c.no_title);return}if(!e.goValidation.isCheckLength(2,100,i)){e.goMessage(n.i18n(c.alert_length,{arg1:"2",arg2:"100"})),e("#name").focus();return}var s="ACTIVE";e("#statusFlag").is(":checked")&&(s="STOP");var o=this.getAvailabilityData();if(!this.timeIntervalValidator(o.startTime,o.endTime))return;var u=e("input[name=share]:radio:checked").val(),a=this.setOwners(u);if(!a){e.goMessage(c.add_manager_alert);return}var f=this.setManagerIds();if(e("#assetManagerList").find("li").length<2){e.goMessage(c.alert_admin_add);return}var l=e("#allowAnonym").is(":checked"),h=l&&e("#alwaysAnonym").is(":checked"),p=e("#allowLoopReservation").is(":checked"),d="PUT",v=GO.contextRoot+"ad/api/asset/"+r,m={};e("#deleteFlag").is(":checked")?(d="DELETE",this.modifyAction(v,d,m)):(m={name:i,status:s,availabilityDate:o,publicFlag:u,managerIds:f,owners:a,allowAnonym:l,alwaysAnonym:h,allowLoopReservation:p},this.modifyAction(v,d,m))},modifyAction:function(t,r,i){var s=this;e.ajax(t,{type:r,contentType:"application/json",data:JSON.stringify(i),success:function(e){e.code==200&&n.router.navigate("/asset",!0)},complete:function(){s.sendCheck=!1}})},cancelAsset:function(){n.router.navigate("/asset",!0)},addManager:function(t){var n=this,r=e.goOrgSlide({header:c.asset_manager_select,desc:"",callback:n.setManager,target:t,isAdmin:!0,contextRoot:GO.contextRoot})},deleteMember:function(t){e(t.currentTarget).parents("li").remove()},modifyPublicRange:function(t){e(t.currentTarget).parents("li").first().after("<li></li>"),u.render({id:e(t.currentTarget).parents("li").first().next("li"),type:"save"}),e(t.currentTarget).parents("li").first().find("span.btn_border").css("display","none")},deletePublicRange:function(t){e(t.currentTarget).parents("li").first().remove()},togglePublicRadio:function(t){var n=this.$el.find("input[name=share]:radio:checked").val();n=="false"?(e(".option_display").show(),e("#partPublicWrap").show(),e("#groupUl").show(),u.render({id:"#partPublicWrap",type:"add"})):(e(".option_display").hide(),e("#partPublicWrap").hide(),e("#groupUl").hide())},toggleTypeRadio:function(t){var n=this.$el.find("input[name=type]:radio:checked").val();n=="false"?(this.setDisable(!1),e("#loopReservation").show()):(this.setDisable(!0),e("#loopReservation").hide())},setDisable:function(t){e("#startTime").attr("disabled",t),e("#endTime").attr("disabled",t),e("#DayOfWeek").find("input").attr("disabled",t),e("input[name=useCalendar]:radio").attr("disabled",t)},_onClickAnonymOption:function(t){var n=e(t.currentTarget);n.val()==="true"?e("#alwaysAnonymOption").show():e("#alwaysAnonymOption").hide()}});return p});