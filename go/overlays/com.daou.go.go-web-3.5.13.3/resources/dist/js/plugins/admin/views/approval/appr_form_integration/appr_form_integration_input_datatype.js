define(["i18n!nls/commons","i18n!admin/nls/admin","i18n!approval/nls/approval","admin/views/approval/appr_form_integration/appr_form_parameter_layer","admin/views/approval/appr_form_integration/appr_form_integration_input_requiredparams","admin/constants/integration_config","admin/models/approval/integration_query","hgn!admin/templates/approval/appr_form_integration/appr_form_integration_input_datatype","hgn!admin/templates/approval/appr_form_integration/appr_form_integration_input_datatype_item"],function(e,t,n,r,i,s,o,u,a){function h(e){return e==="true"||e===!0}var f={"Query\ub97c \uc785\ub825\ud574 \uc8fc\uc138\uc694":n["Query\ub97c \uc785\ub825\ud574 \uc8fc\uc138\uc694"],"Query/Parameter \uc124\uc815\uc774 \uc798\ubabb\ub418\uc5c8\uc2b5\ub2c8\ub2e4":n["Query/Parameter \uc124\uc815\uc774 \uc798\ubabb\ub418\uc5c8\uc2b5\ub2c8\ub2e4"],"\ub370\uc774\ud130 \uc720\ud615 \uba40\ud2f0\uc758 \uc124\uc815 \uac12\uc744 \uc785\ub825\ud574 \uc8fc\uc138\uc694":n["\ub370\uc774\ud130 \uc720\ud615 \uba40\ud2f0\uc758 \uc124\uc815 \uac12\uc744 \uc785\ub825\ud574 \uc8fc\uc138\uc694"],"\uc911\ubcf5\ub41c \uba40\ud2f0 \uac12\uc774 \uc788\uc2b5\ub2c8\ub2e4":n["\uc911\ubcf5\ub41c \uba40\ud2f0 \uac12\uc774 \uc788\uc2b5\ub2c8\ub2e4"],DirectAccess:"DirectAccess",String:"String",Html:"Html","\uacf5\uc6a9":e["\uacf5\uc6a9"],"\uac1c\uc778 (employeeNumber)":e["\uac1c\uc778"]+" (employeeNumber)","key value \uad6c\ubd84\uc790":n["key value \uad6c\ubd84\uc790"],"Data \uad6c\ubd84\uc790":n["Data \uad6c\ubd84\uc790"],"\ud3b8\uc9d1\uac00\ub2a5":e["\ud3b8\uc9d1\uac00\ub2a5"],"\ud3b8\uc9d1\ubd88\uac00":e["\ud3b8\uc9d1\ubd88\uac00"],"\ucd94\uac00":e["\ucd94\uac00"],"\uc0ad\uc81c":e["\uc0ad\uc81c"],Query:"Query",Parameters:"Parameters","\ub370\uc774\ud130 \uc720\ud615":e["\ub370\uc774\ud130 \uc720\ud615"],"\ub2e8\uc77c":e["\ub2e8\uc77c"],"\uba40\ud2f0":e["\uba40\ud2f0"],"Validator Name":"\uc0ac\uc6a9\uc790 \uc815\uc758 \ud074\ub798\uc2a4",bean:"bean","\uc678\ubd80 \uc2dc\uc2a4\ud15c\uc5d0\uc11c \ud638\ucd9c\ub420 \ub54c, \uc544\ub798 \uac12\uc744 \uc785\ub825\ud558\uc138\uc694":n["\uc678\ubd80 \uc2dc\uc2a4\ud15c\uc5d0\uc11c \ud638\ucd9c\ub420 \ub54c, \uc544\ub798 \uac12\uc744 \uc785\ub825\ud558\uc138\uc694."],"\ud544\uc218\uac12 \uc544\ub2d8":n["\ud544\uc218\uac12 \uc544\ub2d8"],"\uc678\ubd80 \uc2dc\uc2a4\ud15c \ud638\ucd9c URL name":n["\uc678\ubd80 \uc2dc\uc2a4\ud15c \ud638\ucd9c URL"],"\uc678\ubd80 \uc2dc\uc2a4\ud15c \ud638\ucd9c URL value":"/app/approval/integration/createdocument?form_code=sample&params=etc"},l=Backbone.View.extend({tagName:"tr",initialize:function(e){this.options=e||{},this.model=this.options.model,this.observer=this.options.observer,this.$el.data("instance",this)},events:{'click [name="dataTypeParamDel"]':"deleteParameter","click [name=dataTypeRowAdd]":"popupAddParameterLayer","keyup [name=inputDataAccessQuery]":"_saveQuery","keyup [name=returnMethod]":"_saveReturnMethod","click .multiRow":"_clickMultiRow"},deleteParameter:function(e){$(e.currentTarget).closest("li").remove()},addParameter:function(t){var n=['<li name="param"><span data-id="paramWrap">','<span class="name" name="input_parameters" data-dataType="{{dataType}}" data-paramName = "{{paramName}}" data-paramType = "{{paramType}}">{{paramName}} ({{dataType}})</span>','<span name="dataTypeParamDel" class="btn_wrap"><span class="ic ic_del" title="'+e["\uc0ad\uc81c"]+'"></span></span></li>'].join("");this.$("li.creat").before(Hogan.compile(n).render(t))},_saveQuery:function(e){var t=$(e.currentTarget);this.model.set("query",t.val())},_saveReturnMethod:function(e){var t=$(e.currentTarget);this.model.set("returnMethod",t.val())},_clickMultiRow:function(e){var t=$(e.currentTarget);this.model.set("multiRow",t.val()),h(t.val())?this.$("[name=returnMethod]").css("display","block"):this.$("[name=returnMethod]").css("display","none")},popupAddParameterLayer:function(){var t=$.goPopup({pclass:"layer_normal parameter_popup",header:"Parameter Config",modal:!0,width:600,allowPrevPopup:!0,contents:"",buttons:[{btext:e["\ucde8\uc18c"],btype:"cancel"}]}),n=new r({model:this.model,observer:this.observer});n.render(),t.reoffset(),n.on("addParameter",_.bind(this.addParameter,this))},render:function(){var e=this,t=e.model.get("parameters");return this.$el.append(a({lang:f,model:e.model.toJSON(),parameters:t,cid:e.model.cid,multiRow:h(this.model.get("multiRow"))})),this},getData:function(){var e=$.map(this.$('span[name="input_parameters"]'),function(e,t){return{dataType:$(e).attr("data-dataType"),paramName:$(e).attr("data-paramName"),paramType:$(e).attr("data-paramType")}});return{id:this.$('textarea[name="inputDataAccessQuery"]').attr("row-id"),query:this.$('textarea[name="inputDataAccessQuery"]').val(),parameters:e,multiRow:this.model.get("multiRow"),returnMethod:this.$('input[name="returnMethod"]').val()}}}),c=Backbone.View.extend({el:"#inputDataType",initialize:function(e){this.options=e||{},this.model=this.options.model,this.observer=this.options.observer},events:{"change #selectInputDataType":"_selectDataType","click .btnRowAdd":"_clickBtnRowAdd","click .btnRowDelete":"_queryItemDelete","click .ic_addlist":"popupAddParameterLayer","click [name=usePublic]":"_clickUsePublic","keyup [name=inputKeyValueSeparator]":"_saveInputKeyValueSeparator","keyup [name=inputElementSeparator]":"_saveInputElementSeparator","click [name=htmlEditable]":"_clickHtmlEditable","click #inputDataTypeAllCheck":"_inputDataTypeAllCheck"},render:function(){this.$el.html(u({lang:f,isStringType:this.model.get("inputDataType")==s.DATA_TYPE.STRING,isHtmlType:this.model.get("inputDataType")==s.DATA_TYPE.HTML,isDirectAccessType:this.model.get("inputDataType")==s.DATA_TYPE.DIRECT_ACCESS,usePublic:h(this.model.get("usePublic")),inputKeyValueSeparator:this.model.get("inputKeyValueSeparator"),inputElementSeparator:this.model.get("inputElementSeparator"),htmlEditable:h(this.model.get("htmlEditable")),validatorBeanName:this.model.get("validatorBeanName")})),this._renderRequiredParamsView(),this.model.get("inputQueries").each(function(e){this._queryItemAdd(e)},this),this.toggleSubView(this.model.get("inputDataType")),this._itemsSortable()},_itemsSortable:function(){this.$el.find("#inputDirectAccessTypeList>tr ul.name_tag").sortable({opacity:"1",delay:100,cursor:"move",items:"li:not('.creat')",hoverClass:"ui-state-hover",forceHelperSize:"true",helper:"clone",placeholder:"ui-sortable-placeholder",start:function(e,t){t.placeholder.html(t.helper.html())}}).sortable("enable")},_renderRequiredParamsView:function(){this.requiredParamsView=new i({model:this.model,observer:this.observer}),this.requiredParamsView.render()},_inputDataTypeAllCheck:function(e){$(e.currentTarget).is(":checked")?_.each(this.$("#inputDirectAccessTypeList input[type=checkbox]"),function(e){$(e).attr("checked",!0)}):_.each(this.$("#inputDirectAccessTypeList input[type=checkbox]"),function(e){$(e).attr("checked",!1)})},_selectDataType:function(e){var t=$(e.currentTarget);this.toggleSubView(t.val())},_clickUsePublic:function(e){var t=$(e.currentTarget);this.model.set("usePublic",t.val())},_saveInputKeyValueSeparator:function(e){var t=$(e.currentTarget);this.model.set("inputKeyValueSeparator",t.val())},_saveInputElementSeparator:function(e){var t=$(e.currentTarget);this.model.set("inputElementSeparator",t.val())},_clickHtmlEditable:function(e){var t=$(e.currentTarget);this.model.set("htmlEditable",t.val())},toggleSubView:function(e){var t=e||s.DATA_TYPE.DIRECT_ACCESS;this.$("#inputStringDataTypeArea").toggle(t==s.DATA_TYPE.STRING),this.$("#inputHtmlDataTypeArea").toggle(t==s.DATA_TYPE.HTML),this.$("#inputDirectAccessDataTypeArea").toggle(t==s.DATA_TYPE.DIRECT_ACCESS),this.$("#publicArea").toggle(t!=s.DATA_TYPE.DIRECT_ACCESS)},_clickBtnRowAdd:function(e){var t=new o;this._queryItemAdd(t),this.model.get("inputQueries").add(t)},_queryItemAdd:function(e){var t=this,n=new l({model:e,observer:t.observer});this.$("#inputDirectAccessTypeList").append(n.render().$el)},_queryItemDelete:function(e){_.each(this.$("#inputDirectAccessTypeList").find("[type=checkbox]"),function(e){if($(e)[0].checked){var t=$(e).closest("tr").data("instance");this.model.get("inputQueries").remove(t.model),t.$el.remove()}},this),$("#inputDataTypeAllCheck").attr("checked",!1)},getData:function(){var e=this.$('input[name="inputKeyValueSeparator"]').val(),t=this.$('input[name="inputElementSeparator"]').val(),n=this.$("#selectInputDataType").val(),r=this.$("[name=usePublic]:checked").val(),i=this.$("[name=htmlEditable]:checked").val(),s=this.$('input[name="validatorBeanName"]').val(),o=[];this.$("#inputDirectAccessTypeList tr").each(function(e,t){var n=$(t).data("instance");o.push(n.getData())});var u=_.extend({inputQueries:o},{inputKeyValueSeparator:e,inputElementSeparator:t,inputDataType:n,usePublic:r,htmlEditable:i,validatorBeanName:s},this.requiredParamsView.getData());return u},validate:function(){var e=!0;this.$("#inputDirectAccessTypeList tr").each(function(t,n){var r=new RegExp(/\?/g),i=$(n).find("[name=inputDataAccessQuery]").val().match(r),s=i&&i.length||0;_.isEmpty($(n).find("[name=inputDataAccessQuery]").val())?($.goMessage(f["Query\ub97c \uc785\ub825\ud574 \uc8fc\uc138\uc694"]),$(n).find("[name=inputDataAccessQuery]").focus(),e=!1):$(n).find(".name_tag [name=param]").length!=s?($.goMessage(f["Query/Parameter \uc124\uc815\uc774 \uc798\ubabb\ub418\uc5c8\uc2b5\ub2c8\ub2e4"]),$(n).find("[name=inputDataAccessQuery]").focus(),e=!1):$(n).find(".multiRow:checked").val()=="true"&&_.isEmpty($(n).find("[name=returnMethod]").val())&&($.goMessage(f["\ub370\uc774\ud130 \uc720\ud615 \uba40\ud2f0\uc758 \uc124\uc815 \uac12\uc744 \uc785\ub825\ud574 \uc8fc\uc138\uc694"]),$(n).find("[name=returnMethod]").focus(),e=!1);if(!e)return!1});if(!e)return e;var t=[];this.$("#inputDirectAccessTypeList tr [name=returnMethod]").each(function(e,n){_.isEmpty($(n).val())||t.push($(n).val())});var n=_.uniq(t);return t.length!=n.length&&($.goMessage(f["\uc911\ubcf5\ub41c \uba40\ud2f0 \uac12\uc774 \uc788\uc2b5\ub2c8\ub2e4"]),e=!1),e}});return c});