define("admin/views/auth/admin_auth_group",function(require){require("jquery.go-orgslide");var e=require("hgn!admin/templates/auth/admin_auth_group"),t=require("hgn!admin/templates/auth/admin_auth_user_list"),n=require("i18n!admin/nls/admin"),r=require("i18n!nls/commons"),i=Backbone.View.extend({el:"#adminAuthGroup",events:{"click #groupSaveBtn":"onGroupSaveBtnClicked","click #groupCancelBtn":"onGroupCancelBtnClicked","click #adminUserAddBtn":"onAdminUserAddBtnClicked","click #adminUserDelBtn":"onAdminUserDelBtnClicked","click .category":"onCategoryClicked","click .title_sort":"onAuthUserSortClicked","click .sideMenu":"onSideMenuClicked","click #allUserSelector":"onAllUserSelectorClicked"},initialize:function(e){this.authGroup=e.authGroup,this.authGroupCollection=e.authGroupCollection,this.authUserListEl="#adminAuthUserList"},render:function(){this.$el.html(e({authGroup:this.authGroup,adminLang:n,commonLang:r})),this.authGroup.sortAuthUsers("userName",!0),this.renderAuthUserList()},renderAuthUserList:function(){this.$el.find(this.authUserListEl).html(t({authGroup:this.authGroup,adminLang:n,commonLang:r}))},remove:function(){this.undelegateEvents(),this.$el.removeData().unbind(),this.$el.html("")},getInaccessibleMenusByPage:function(){var e=this.$el.find(".sideMenu"),t=_.filter(e,function(e){var t=$(e),n=!t.prop("checked"),r=t.hasClass("category");if(r){var i=t.closest(".com_opt_container"),s=i.find(".sideMenu").not(".category");if(s.size()<1)return n;var o=_.every(s,function(e){return!$(e).prop("checked")});return o}return n});return _.map(t,function(e){return $(e).data("id")})},onCategoryClicked:function(e){(function(){var n=$(e.currentTarget),r=n.prop("checked"),i=n.closest(".com_opt_container"),s=i.find(".sideMenu");s.prop("checked",r)})()},onSideMenuClicked:function(e){(function(){var n=$(e.currentTarget);if(n.hasClass("category"))return;var r=n.closest(".com_opt_container"),i=r.find(".category"),s=r.find(".sideMenu").not(".category"),o=_.every(s,function(e){return $(e).prop("checked")});i.prop("checked",o)})()},onGroupSaveBtnClicked:function(){var e=this;$.goPopup({title:n["\uc800\uc7a5\ud558\uc2dc\uaca0\uc2b5\ub2c8\uae4c?"],buttons:[{btype:"confirm",btext:r["\uc800\uc7a5"],callback:function(){GO.util.preloader(e.authGroup.save({inaccessibleMenus:e.getInaccessibleMenusByPage()}))}},{btype:"close",btext:r["\ucde8\uc18c"]}]})},defaultGroupLimitUserErrorType:{ADD:"add",REMOVE:"remove"},defaultGroupLimitUserErrorPopup:function(e){var t=e===this.defaultGroupLimitUserErrorType.ADD?n["\uad00\ub9ac\uc790 \ucd94\uac00 \ubd88\uac00"]:n["\uad00\ub9ac\uc790 \uc0ad\uc81c \ubd88\uac00"];$.goPopup({title:t,contents:n["\uad00\ub9ac\uc790 \uc0ad\uc81c \ubd88\uac00 \uc124\uba85"],buttons:[{btype:"close",btext:r["\ud655\uc778"]}]});return},onAdminUserAddBtnClicked:function(e){var t=this,i=function(e){function f(){var e=[{btype:"confirm",btext:r["\uc0ad\uc81c"],callback:function(){t.addAuthUser(o,!0)}}],i=!t.authGroup.isDefaultGroup(),a=s("defaultGroup")||!1;i&&a&&e.push({btype:"close",btext:r["\uc720\uc9c0"],callback:function(){t.addAuthUser(o,!1)}}),$.goPopup({title:n["\uad00\ub9ac\uc790\uad8c\ud55c \ucd94\uac00 \ud31d\uc5c5 \ud0c0\uc774\ud2c0"],contents:'<span class="title">('+u+")</span>",buttons:e})}function l(){t.addAuthUser(o,!1)}var i=t.authGroupCollection.findAuthUsersByUserId(e.id)[0]||undefined,s=function(e){return _.isUndefined(i)?undefined:i[e]},o=e.id,u=s("authGroupName"),a=t.authGroupCollection.defaultGroupUserList();if(s("domainAdminAuthGroupId"===t.authGroup.id)){$.goMessage(n["\uc774\ubbf8 \ucd94\uac00\ub41c \uc0ac\uc6a9\uc790 \uc785\ub2c8\ub2e4."]);return}if(!t.authGroup.attributes.defaultGroup&&a.length===1&&(s("defaultGroup")||!1)){t.defaultGroupLimitUserErrorPopup(t.defaultGroupLimitUserErrorType.ADD);return}_.isUndefined(i)?l():f()};$.goOrgSlide({header:n["\uad00\ub9ac\uc790 \ucd94\uac00"],callback:i,target:e,isAdmin:!0,contextRoot:GO.contextRoot})},addAuthUser:function(e,t){this.userChangePromiseHandler(this.authGroup.addAuthUser(e,t))},onAdminUserDelBtnClicked:function(){var e=this.$el.find('.authUser input[type="checkbox"]:checked');if(e.size()<1){$.goMessage(r["\ucd5c\uc18c\ud55c 1\uac1c \uc774\uc0c1 \uc120\ud0dd\ud558\uc5ec\uc57c \ud569\ub2c8\ub2e4."]);return}if(!(this.$el.find(".authUser").size()-e.size()>0||!this.authGroup.attributes.defaultGroup)){this.defaultGroupLimitUserErrorPopup(this.defaultGroupLimitUserErrorType.REMOVE);return}var t=function(){var t=this.authGroup.isDefaultGroup()?"userid":"id",n=_.map(e,function(e){return $(e).data(t)});this.userChangePromiseHandler(this.authGroup.deleteAuthUsers(n))};$.goPopup({title:n["\uad00\ub9ac\uc790 \uc0ad\uc81c \uc54c\ub9bc"],buttons:[{btype:"confirm",btext:r["\uc0ad\uc81c"],callback:$.proxy(t,this)},{btype:"close",btext:r["\ucde8\uc18c"]}]})},userChangePromiseHandler:function(e){var t=this;GO.util.preloader(e),e.then(function(){return t.authGroupCollection.fetch()}).then(function(){t.authGroup.sortAuthUsers(t.authGroup.sortKey,t.authGroup.desc),t.renderAuthUserList(),$("#adminAuthList").trigger("renderAdminAuthList",t.authGroup)})},onGroupCancelBtnClicked:function(){$.goMessage(r["\ucde8\uc18c\ub418\uc5c8\uc2b5\ub2c8\ub2e4."]),this.remove(),this.render()},onAuthUserSortClicked:function(e){var t=$(e.currentTarget).data("sortkey"),n=this.authGroup.sortKey==t?!this.authGroup.desc:this.authGroup.desc;this.authGroup.sortAuthUsers(t,n),this.renderAuthUserList()},onAllUserSelectorClicked:function(e){var t=$(e.currentTarget).prop("checked");this.$el.find('.authUser input[type="checkbox"]').prop("checked",t)}});return i});