define("admin/views/ehr/timeline/group/main",function(require){var e=require("hgn!admin/templates/ehr/timeline/group/main"),t=require("admin/views/ehr/timeline/group/list"),n=require("admin/views/ehr/timeline/group/detail"),r=require("backbone"),i=require("admin/collections/ehr/timeline/group"),s=require("admin/models/ehr/timeline/ext_config"),o=require("i18n!admin/nls/admin"),u=require("i18n!admin/nls/admin"),a={"\uadfc\ubb34 \uadf8\ub8f9 \uc124\uc815":o["\uadfc\ubb34 \uadf8\ub8f9 \uc124\uc815"],"\uc2e0\uaddc\ucd94\uac00":o["\uc2e0\uaddc\ucd94\uac00"],"\uc21c\uc11c\ubc14\uafb8\uae30":u["\uc21c\uc11c\ubc14\uafb8\uae30"],"\uc21c\uc11c\ubc14\uafb8\uae30 \uc644\ub8cc":u["\uc21c\uc11c\ubc14\uafb8\uae30 \uc644\ub8cc"]},f=r.View.extend({events:{"click #add_group":"addGroup","click #sort":"sort","click #sort_confirm":"saveSortOrder"},initialize:function(){this.groupCollection=new i,this.extModel=new s,this.selectedOriginGroupId=null,GO.EventEmitter.on("timeline","changed:groups",this.render,this)},render:function(){this.$el.html(e({lang:a}));var t=this.groupCollection.fetch(),n=this.extModel.fetch();$.when(t,n).then(_.bind(function(){this.renderContent();var e=this.selectedOriginGroupId==null?this.groupCollection.at(0).get("originGroupId"):this.selectedOriginGroupId;this.listView.selectGroup(e)},this))},renderContent:function(){this.listView=new t({collection:this.groupCollection}),this.$el.find("#group_list").html(this.listView.el),this.listView.render(),this.listView.on("save",_.bind(function(){this.render()},this)),this.listView.on("selected",$.proxy(function(e){var t=this.groupCollection.findWhere({originGroupId:e});this.renderDetail(t)},this))},renderDetail:function(e){this.detailView=new n({model:e,extModel:this.extModel}),this.$el.find("#group_detail").html(this.detailView.el),this.detailView.render(),this.detailView.on("change",_.bind(function(e){this.selectedOriginGroupId=e,this.groupCollection.fetch({reset:!0})},this)),this.detailView.on("deleted",_.bind(function(){this.selectedOriginGroupId=null,this.groupCollection.fetch({reset:!0})},this))},addGroup:function(){this.renderDetail(null)},sort:function(){this.$el.find("span.before_sort").hide(),this.$el.find("span.after_sort").show(),this.listView.sortable()},saveSortOrder:function(){this.listView.saveSortOrder()}});return f});