(function(){define(["jquery","backbone","app","admin/models/appr_form","hgn!admin/templates/appr_form_list","hgn!admin/templates/list_empty","i18n!nls/commons","i18n!admin/nls/admin","i18n!approval/nls/approval","jquery.go-popup","jquery.go-sdk","jquery.go-grid","jquery.go-orgslide","jquery.go-validation","GO.util"],function(e,t,n,r,i,s,o,u,a){var f=GO.contextRoot+"ad/api/",l={name:o["\uc81c\ubaa9"],creator:u["\ucd5c\uc885 \uc218\uc815\uc790"],admin:u["\uc6b4\uc601\uc790"],form_user_scope:o["\uc791\uc131\uad8c\ud55c"],state:u["\uc0ac\uc6a9\uc5ec\ubd80"],specific_scope:o["\uc81c\ud55c"],all_scope:o["\uc804\uccb4"],hidden:u["\uc228\uae40"],normal:u["\uc815\uc0c1"],reorder_changed:o["\ubcc0\uacbd\ub418\uc5c8\uc2b5\ub2c8\ub2e4."],empty_msg:a["\ub4f1\ub85d\ub41c \uacb0\uc7ac \uc591\uc2dd\uc774 \uc5c6\uc2b5\ub2c8\ub2e4."],delete_success_msg:o["\uc0ad\uc81c\ud558\uc600\uc2b5\ub2c8\ub2e4."],delete_fail_msg:o["\uc0ad\uc81c\ud558\uc9c0 \ubabb\ud588\uc2b5\ub2c8\ub2e4."],"\uc0ac\uc6a9":o["\uc0ac\uc6a9"],"\ubbf8\uc0ac\uc6a9":a["\ubbf8\uc0ac\uc6a9"],mobile_approval:a["\ubaa8\ubc14\uc77c \uae30\uc548 \ud5c8\uc6a9"],enable:o["\ud5c8\uc6a9"],disable:o["\ube44\ud5c8\uc6a9"]},c=t.View.extend({tagName:"div",className:"tb_wrap",folderId:null,formId:null,dataTable:null,tableSelector:"#form_list",initialize:function(e){e=e||{},this.folderId=e.folderId,this.formId=e.formId,this._initEventBinding()},render:function(e){return this.$el.empty().html(i({lang:l})),this._renderFormListView(e),this.$el},refreshList:function(){this.dataTable.tables.fnClearTable()},deleteSelected:function(){var t=[];this.$el.find("input:checked").each(function(n){e(this).attr("name")=="id"&&t.push(e(this).val())});if(t.length==0)return e.goMessage(a["\uc591\uc2dd\uc744 \uc120\ud0dd\ud574 \uc8fc\uc138\uc694."]),!1;var n=this;e.goConfirm(u["\uc0ad\uc81c\ud558\uc2dc\uaca0\uc2b5\ub2c8\uae4c?"],"",function(){e.go(f+"approval/apprform",JSON.stringify({ids:t}),{qryType:"DELETE",contentType:"application/json",async:!1,responseFn:function(t){e.goMessage(l.delete_success_msg),n.render()},error:function(t){e.goMessage(l.delete_fail_msg),n.render()}})})},renderForReorderView:function(){if(this.dataTable.tables.isEmpty())return e.goMessage(l.empty_msg),!1;this.dataTable.tables.find("tbody").sortable({opacity:"1",delay:100,scroll:!1,cursor:"move",items:"tr",containment:".content_page",hoverClass:"ui-state-hover",helper:"clone",placeholder:"ui-sortable-placeholder",start:function(e,t){t.placeholder.html(t.helper.html()),t.placeholder.find("td").css("padding","5px 10px")}})},saveReorderedList:function(){var t=f+"approval/apprformfolder/"+this.folderId+"/apprform/bulkmove",n,r;n=e(this.dataTable.tables.find("tbody>tr")).map(function(t,n){return e(n).find('input[name="id"]').val()}).get(),r=function(t){t.code==200?e.goMessage(l.reorder_changed):t.code!=200&&(e.goMessage(t.message),this.render())},this.dataTable.tables.find("tbody").sortable("destroy"),e.go(t,JSON.stringify({ids:n}),{async:!1,qryType:"PUT",contentType:"application/json",responseFn:e.proxy(r,this)})},isEmpty:function(){return this.dataTable.tables.isEmpty()},getDraggable:function(){return{selector:this.tableSelector+" tbody > tr",startCallback:function(t,n){var r=[];r.push('<div id="dragging-ui" class="org_member_helper"><ins></ins>'),r.push(e(this).find("td:eq(1)").text()),r.push("</div>"),n.helper.html(r.join(""))},markAsDroppable:function(){e("#dragging-ui").addClass("org_move_enable").removeClass("org_move_disable")},markAsNotDroppable:function(){e("#dragging-ui").addClass("org_move_disable").removeClass("org_move_enable")}}},_renderFormListView:function(t){var n=f+"approval/apprformfolder/"+this.folderId+"/apprform",r=this._renderEmptyTmpl({lang:l});this.dataTable=e.goGrid({el:this.tableSelector,url:n,method:"GET",pageUse:!1,sDomUse:!1,emptyMessage:r,checkbox:!0,checkboxData:"id",columns:[{mData:"name",bSortable:!1,sClass:"title",fnRender:function(e){return'<a class="form_name_alink" data-id="'+e.aData.id+'">'+e.aData.name+"</a>"}},{mData:"creator.name",sClass:"uploader",sWidth:"140px",bSortable:!1,fnRender:function(e){return e.aData.creator.name+" "+e.aData.creator.position}},{mData:"adminInfo",sClass:"admin",sWidth:"200px",bSortable:!1,fnRender:function(e){return e.aData.adminInfo?e.aData.adminInfo:"-"}},{mData:"formUserScope",sWidth:"120px",sClass:"power",bSortable:!1,fnRender:function(e){return e.aData.formUserScope=="ALL"?l.all_scope:l.specific_scope}},{mData:"state",sWidth:"120px",sClass:"status",bSortable:!1,fnRender:function(e){return e.aData.state=="HIDDEN"?l["\ubbf8\uc0ac\uc6a9"]:l["\uc0ac\uc6a9"]}},{mData:"allowMobileApproval",sWidth:"100px",sClass:"mobile",bSortable:!1,fnRender:function(e){return console.log(e.aData.allowMobileApproval),e.aData.allowMobileApproval?l.enable:l.disable}}],fnDrawCallback:e.proxy(function(n,r,i){this.$el.find(".toolbar_top .custom_header").append(this.$el.find("#csvDownLoad").show()),e(".tool_bar .dataTables_length").hide(),_.isFunction(t)&&t(),e(this.dataTable.tables.find("tbody")).find("a[data-id="+this.formId+"]").parent().parent().addClass("choice")},this)})},_renderEmptyTmpl:function(e){var t=[];t.push("<tbody>"),t.push("    <tr>"),t.push('        <td colspan="5">'),t.push('            <p class="data_null">'),t.push('                <span class="ic_data_type ic_no_data"></span>'),t.push('                <span class="txt">{{lang.empty_msg}}</span>'),t.push("            </p>"),t.push("        </td>"),t.push("    </tr>"),t.push("</tbody>");var n=Hogan.compile(t.join("\n"));return n.render(e)},_initEventBinding:function(){this.$el.off(),this.$el.on("click",".form_name_alink",e.proxy(this._goToShowForm,this)),this.$el.on("click","#check_all",e.proxy(this._toggleAllCheckboxes,this))},_goToShowForm:function(t){var n=e(t.currentTarget),r=n.attr("data-id");GO.router.navigate("approval/apprform/"+r,{trigger:!0})},_toggleAllCheckboxes:function(t){var n=e(t.currentTarget),r=this.$el.find("input:checkbox");n.is(":checked")?r.attr("checked","checked"):r.removeAttr("checked")}});return c})}).call(this);