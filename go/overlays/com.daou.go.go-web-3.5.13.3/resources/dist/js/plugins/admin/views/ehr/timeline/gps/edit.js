define("admin/views/ehr/timeline/gps/edit",function(require){var e=require("backbone"),t=require("app"),n=require("hgn!admin/templates/ehr/timeline/gps/edit"),r=require("admin/models/ehr/timeline/access_gps"),i=require("i18n!admin/nls/admin"),s=require("i18n!nls/commons");require("jquery.go-sdk");var o={allowed_access_GPS_Info:i["\uc811\uc18d \ud5c8\uc6a9 GPS \uc815\ubcf4"],allowed_access_GPS_Tooltip:i["\uc811\uc18d \ud5c8\uc6a9 GPS \ud234\ud301"],place:i["\uc7a5\uc18c\uba85"],address:i["\uc8fc\uc18c"],address_info:i["\ub3c4\ub85c\uba85 \ub610\ub294 \uc9c0\ubc88 \uc8fc\uc18c\ub97c \uc785\ub825\ud558\uc138\uc694"],search:s["\uac80\uc0c9"],GPS_Warn:i["GPS \uc0ac\uc6a9 \uc8fc\uc758\uc0ac\ud56d"],radius:i["\ubc18\uacbd"],lat:i["\uc704\ub3c4"],"long":i["\uacbd\ub3c4"],radius_setting_info:i["\ubc18\uacbd \uc124\uc815 \uc124\uba85"],network_not_support:i["\ub124\ud2b8\uc6cc\ud06c \uc5f0\uacb0 \ubb38\uc81c\ub85c \uc678\ubd80 \uc0ac\uc774\ud2b8 \uc811\uadfc\uc774 \ucc28\ub2e8\ub418\uc5b4 \uc9c0\ub3c4 \uc11c\ube44\uc2a4 \uc0ac\uc6a9\uc774 \ubd88\uac00\ud569\ub2c8\ub2e4."],label_all:s["\ubaa8\ub450 \ud5c8\uc6a9"],label_part:s["\ubd80\ubd84 \ud5c8\uc6a9"]},u=e.View.extend({events:{"click #addressSearchBtn":"searchAddress","keydown #addressSearchInput":"searchAddressByKey","click #zoomIn":"zoomInKakaoMap","click #zoomOut":"zoomOutKakaoMap","keyup input":"update","click #allOfGPS":"toggleGPSInfo","click #partOfGPS":"toggleGPSInfo"},initialize:function(e){this.options=e||{},this.workPlace=this.options.workPlace,this.useGps=this.workPlace.get("useGps"),this.center={lat:37.332462,lng:127.13706},this.radius=100,this.level=4,this.updated=!1;if(this.workPlace.get("id")){var t=this.workPlace.get("gpsModels");t.length>0&&(this.model=new r(t[0]),this.radius=this.model.get("radius"),this.latitude=this.model.get("latitude"),this.longitude=this.model.get("longitude"),this.center={lat:this.latitude,lng:this.longitude})}},toggleGPSInfo:function(e){$(e.currentTarget).val()==="all"?this.$el.find("#accessGpsBlock").css("display","none"):(this.$el.find("#accessGpsBlock").css("display",""),this.tryLocation(),this.model=new r)},update:function(){this.updated=!0},render:function(){var e=this;return e.$el.html(n({lang:o,model:this.model,useGps:this.useGps,isKaKaoMap:!0})),this.model&&(this.setGpsInfoStr(),this.moveMap(this.center)),this},notSupportViewRender:function(){var e=this;return e.$el.html(n({lang:o,model:this.model,useGps:this.useGps,isKaKaoMap:!1})),e.$el.find("#accessGpsBlock").hide(),this},moveMap:function(e){this.center=e,this.kakaoMap(e,this.radius)},isCheckedUseGps:function(){return this.$el.find("#partOfGPS").prop("checked")},saved:function(){this.updated=!1},validate:function(){if(!this.isCheckedUseGps())return!0;var e=this.$el.find("#gpsName").val();return e?!this.radius||!this.latitude||!this.longitude?($.goMessage(i["\uc9c0\ub3c4\uc5d0\uc11c \ubc94\uc704\ub97c \uc120\ud0dd\ud574\uc8fc\uc138\uc694"]),!1):!0:($.goMessage(i["\uc7a5\uc18c\uba85\uc744 \uc785\ub825\ud574\uc8fc\uc138\uc694"]),!1)},getGpsModel:function(){if(!this.isCheckedUseGps())return;var e=this,t=this.$el.find("#gpsName").val();return e.model.set("name",t),e.model.set("radius",this.radius),e.model.set("latitude",this.latitude),e.model.set("longitude",this.longitude),e.model},zoomInKakaoMap:function(e){this.level>1&&(this.level=this.level-1),this.map.setLevel(this.level)},zoomOutKakaoMap:function(e){this.level<14&&(this.level=this.level+1),this.map.setLevel(this.level)},searchAddressByKey:function(e){e.keyCode===13&&(this.searchAddress(),e.preventDefault())},searchAddress:function(){var e=this,t=$("#addressSearchInput").val();e.geocoder.addressSearch(t,function(t,n){if(n===kakao.maps.services.Status.OK){var r=new kakao.maps.LatLng(t[0].y,t[0].x);e.marker.setPosition(r),e.marker.setMap(e.map),e.map.setCenter(r)}})},kakaoMap:function(e,t){function c(e){if(!f)h(),f=!0,l=e,n.latitude=e.Ha||e.getLat(),n.longitude=e.Ga||e.getLng(),n.setGpsInfoStr();else if(f){var t=Math.round(o.getRadius()),r=p(t);a.setContent(r),n.radius=t,n.setGpsInfoStr(),o.setMap(n.map),u.setMap(n.map),a.setMap(n.map),f=!1,l=null}}function h(){o&&(o.setMap(null),u.setMap(null),a.setMap(null))}function p(e){var t=e/67|0,n='<span class="number">'+t+"</span>"+i["\ubd84"],r='<ul class="info">';return r+="    <li>",r+='        <span class="label">'+i["\ucd1d\uac70\ub9ac"]+'</span><span class="number">'+e+"</span>m",r+="    </li>",r+="    <li>",r+='        <span class="label">'+i["\ub3c4\ubcf4"]+"</span>"+n,r+="    </li>",r+="</ul>",r}function d(e,t){u=new kakao.maps.Polyline({strokeWeight:3,strokeColor:"#00a0e9",strokeOpacity:1,strokeStyle:"solid"}),o=new kakao.maps.Circle({strokeWeight:1,strokeColor:"#00a0e9",strokeOpacity:.1,strokeStyle:"solid",fillColor:"#00a0e9",fillOpacity:.2}),a=new kakao.maps.CustomOverlay({xAnchor:0,yAnchor:0,zIndex:1});if(e&&t){var r=new kakao.maps.LatLng(e.lat,e.lng),i={center:r,radius:t};o.setOptions(i),o.setMap(n.map)}n.marker=new kakao.maps.Marker({position:new kakao.maps.LatLng(e.lat,e.lng),clickable:!0})}if(_.isUndefined(kakao))return;var n=this,r=document.getElementById("map"),s={center:new kakao.maps.LatLng(e.lat,e.lng),level:this.level};this.map=new kakao.maps.Map(r,s),this.geocoder=new kakao.maps.services.Geocoder;var o,u,a,f=!1,l;d(e,t),kakao.maps.event.addListener(n.marker,"click",function(){c(this.getPosition())}),kakao.maps.event.addListener(n.map,"click",function(e){n.update(),c(e.latLng)}),kakao.maps.event.addListener(n.map,"rightclick",function(e){n.radius="",n.latitude="",n.longitude="",n.setGpsInfoStr(),h(),f=!1}),kakao.maps.event.addListener(n.map,"mousemove",function(e){if(f){var t=e.latLng,r=[l,t];u.setPath(r);var s=u.getLength();if(s>0){var c={center:l,radius:s};n.radius=s,o.setOptions(c);var h=Math.round(o.getRadius()),p='<div class="info">'+i["\ubc18\uacbd"]+' <span class="number">'+h+"</span>m</div>";a.setPosition(t),a.setContent(p),o.setMap(n.map),u.setMap(n.map),a.setMap(n.map)}else o.setMap(null),u.setMap(null),a.setMap(null);n.setGpsInfoStr()}})},setGpsInfoStr:function(){!this.radius||!this.latitude||!this.longitude?this.$el.find("#gpsInfoStr").text(""):this.$el.find("#gpsInfoStr").text(this.radius+" m / "+this.latitude+" / "+this.longitude)},tryLocation:function(){var e=this;navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(t){var n={lat:t.coords.latitude,lng:t.coords.longitude};e.moveMap(n)},function(t){e.moveMap(e.center)},{enableHighAccuracy:!1,maximumAge:0,timeout:Infinity})}});return u});