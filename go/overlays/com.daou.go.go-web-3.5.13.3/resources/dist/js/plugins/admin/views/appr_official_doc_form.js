(function(){define(["jquery","backbone","app","i18n!nls/commons","i18n!admin/nls/admin","i18n!approval/nls/approval","admin/views/appr_official_doc_form_template_editor","hgn!admin/templates/appr_official_doc_form"],function(e,t,n,r,i,s,o,u){var a={head_title:i["\uacb0\uc7ac \uc591\uc2dd \ucd94\uac00"],caption:"\uc2dc\ud589\ubb38 \uc591\uc2dd",title:r["\uc81c\ubaa9"],description:i["\uc591\uc2dd\uc124\uba85"],form_name:r["\uc81c\ubaa9"],alias:i["\uc591\uc2dd\uc57d\uc5b4"],edit_template:i["\uc591\uc2dd \ud3b8\uc9d1"],template_editor:r["\uc591\uc2dd \ud3b8\uc9d1\uae30"],template_preview:r["\ubbf8\ub9ac\ubcf4\uae30"],company_doc_folder:i["\uc804\uc0ac \ubb38\uc11c\ud568 \ubcf4\uad00 \ud3f4\ub354"],state:i["\uc0ac\uc6a9\uc5ec\ubd80"],hidden:i["\uc228\uae40"],normal:i["\uc815\uc0c1"],preserve_in_year:s["\ubcf4\uc874\uc5f0\ud55c"],security_level:i["\ubcf4\uc548\ub4f1\uae09"],empty_msg:i["\ub4f1\ub85d\ub41c \uc591\uc2dd\uc774 \uc5c6\uc2b5\ub2c8\ub2e4."],creation_success_msg:i["\uc800\uc7a5\ub418\uc5c8\uc2b5\ub2c8\ub2e4. \uc591\uc2dd \ubaa9\ub85d\uc73c\ub85c \uc774\ub3d9\ud569\ub2c8\ub2e4."],creation_fail_msg:i["\uc800\uc7a5\ud560 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4."],cancel_and_go_to_list_msg:i["\ucde8\uc18c\ud558\uc168\uc2b5\ub2c8\ub2e4. \uc774\uc804 \ud654\uba74\uc73c\ub85c \uc774\ub3d9\ud569\ub2c8\ub2e4."],name_required:i["\uc81c\ubaa9\uc744 \uc785\ub825\ud558\uc138\uc694."],duplicated_name:i["\uc81c\ubaa9\uc774 \uc911\ubcf5\ub418\uc5c8\uc2b5\ub2c8\ub2e4."],alias_required:i["\uc591\uc2dd\uc57d\uc5b4\ub97c \uc785\ub825\ud558\uc138\uc694."],name_invalid_length:i["\uc81c\ubaa9\uc740 20\uc790\uae4c\uc9c0 \uc785\ub825\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4."],alias_invalid_length:i["\uc57d\uc5b4\ub294 20\uc790\uae4c\uc9c0 \uc785\ub825\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4."],description_invalid_length:i["\uc591\uc2dd\uc124\uba85\uc740 500\uc790\uae4c\uc9c0 \uc785\ub825\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4."],folder_required:i["\uc804\uc0ac \ubb38\uc11c\ud568 \ud3f4\ub354\uac00 \uc9c0\uc815\ub418\uc9c0 \uc54a\uc558\uc2b5\ub2c8\ub2e4."],year:s["\ub144"],forever:s["\uc601\uad6c"],modify:r["\uc218\uc815"],select:r["\uc120\ud0dd"],add:r["\ucd94\uac00"],"delete":r["\uc0ad\uc81c"],save:r["\uc800\uc7a5"],cancel:r["\ucde8\uc18c"],use:s["\uc0ac\uc6a9"],unuse:s["\ubbf8\uc0ac\uc6a9"]};return t.View.extend({el:"#layoutContent",templateEditorView:null,model:null,events:{'change input[name="name"]':"_onChangeNameOfView"},initialize:function(e){this.$el.off(),this.model=e.model,this.templateEditorView=new o({model:this.model,official:!0}),this.initBindingEvents(),this.listenTo(this.model,"change:name",_.bind(this._onChangeNameOfModel,this))},initBindingEvents:function(){this.$el.off("click","#load_template_editor"),this.$el.off("click","#preview_template"),this.$el.off("click","#save_btn"),this.$el.off("click","#cancel_btn"),this.$el.on("click","#load_template_editor",e.proxy(this._openTemplateEditor,this)),this.$el.on("click","#preview_template",e.proxy(this._previewTemplate,this)),this.$el.on("click","#save_btn",e.proxy(this._onSaveClicked,this)),this.$el.on("click","#cancel_btn",e.proxy(this._onCancelClicked,this))},render:function(){this.templateEditorView.setContent(this.model.get("html")),this.$el.html(u(this._makeTmplData(this.model)))},_onChangeNameOfView:function(){this.model.set("name",this.$("input[name=name]").val())},_onChangeNameOfModel:function(){this.$("input[name=name]").val(this.model.get("name"))},_makeTmplData:function(e){var t=function(){return function(e){return e.replace('value="'+this.state+'"','value="'+this.state+'" checked')}},n={lang:a,wrappedState:t};return _.extend(n,e.toJSON())},_openTemplateEditor:function(){this.templateEditorView.render()},_previewTemplate:function(){this.templateEditorView.preview(this.templateEditorView.getContent())},_onSaveClicked:function(){var t=this;this.model.set("state",this.$el.find("input[name=state]:checked").val()),this.model.set("html",this.templateEditorView.getContent());if(!this.model.isValid())return this.model.validationError=="name_invalid_length"||this.model.validationError=="name_required"?(e.goMessage(a[this.model.validationError]),this.$el.find(":input[name=name]").select()):e.goMessage(a[this.model.validationError]),!1;if(this.requestProcessing)return;this.requestProcessing=!0,this.model.save({},{url:GO.contextRoot+"ad/api/approval/manage/official/form/",success:e.proxy(function(t,n,r){e.goAlert(a.creation_success_msg,"",this._goToFormListView)},this),error:function(t,n,r){var i=a.creation_fail_msg;return _.contains(n.responseJSON.name,"bad.request")&&(i=a.duplicated_name),e.goMessage(i),!1},complete:function(){t.requestProcessing=!1}})},_onCancelClicked:function(){return e.goAlert(a.cancel_and_go_to_list_msg,"",e.proxy(this._goToFormListView,this)),!1},_goToFormListView:function(){return GO.router.navigate("approval/manage/official",{trigger:!0}),!1}})})}).call(this);