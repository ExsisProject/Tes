define("admin/views/department/dept_file",function(require){var e=require("backbone"),t=require("app"),n=require("hgn!admin/templates/department/dept_file"),r=require("i18n!admin/nls/admin"),i=require("i18n!nls/commons"),s=require("i18n!board/nls/board"),o=require("i18n!approval/nls/approval"),u=require("i18n!task/nls/task"),a=require("i18n!report/nls/report"),f=require("admin/views/department/dept_detail_contact"),l=require("admin/models/system_menu_list"),c={board:i["\uac8c\uc2dc\ud310"],size:r["\uc0ac\uc6a9\ub7c9(MB)"],docCount:r["\ubb38\uc11c \uac1c\uc218"],share:r["\uacf5\uc720"],title:i["\uc81c\ubaa9"],type:r["\uad6c\ubd84"],migration_board:i["\uac8c\uc2dc\ud310 \uc774\uad00"],migration_report:i["\ubcf4\uace0\uc11c \uc774\uad00"],migration_task:i["\ud3f4\ub354 \uc774\uad00"],migration_approval:r["\ubb38\uc11c\ud568 \uc774\uad00"],move_dept_folder:r["\ubb38\uc11c\ud568 \uad00\ub9ac"],check_box_alert:r["\ubd80\uc11c \uc790\ub8cc\ub97c \uc120\ud0dd\ud574\uc8fc\uc138\uc694."],approval:i["\uc804\uc790\uacb0\uc7ac"],task:r["\uc5c5\ubb34"],report:r["\ubcf4\uace0"],dept_amounts_empty:r["\ub4f1\ub85d\ub41c \ubd80\uc11c\uc790\ub8cc\uac00 \uc5c6\uc2b5\ub2c8\ub2e4."],save_success:i["\uc800\uc7a5\ub418\uc5c8\uc2b5\ub2c8\ub2e4."],closed:r["\uc911\uc9c0"],normal:i["\uc815\uc0c1"],total:i["\uc804\uccb4"],contact:i["\uc8fc\uc18c\ub85d"],list_to_csv:r["\ubaa9\ub85d \ub2e4\uc6b4\ub85c\ub4dc"]},h=e.View.extend({events:{"click .file_tab li":"changeTab"},initialize:function(e){this.options=e||{},this.deptId=this.options.deptId,this.approvalMenuAccessible=this.options.approvalMenuAccessible},render:function(){var e=l.read(),t=e.hasApp("task"),r=e.hasApp("report"),i=e.hasApp("approval"),s=e.hasApp("board"),o=e.hasApp("contact");this.$el.html(n({lang:c,hasTask:t,hasReport:r,hasApproval:i,hasBoard:s,hasContact:o}));var u=E.create("Approval",this.deptId,this.approvalMenuAccessible);return this.$el.find("#deptDataList").show().html(u.render().el),this},changeTab:function(e){var t=$(e.currentTarget),n=t.data("content");this.$el.find("ul.file_tab li").removeClass("active"),t.addClass("active");var r=E.create(n,this.deptId,this.approvalMenuAccessible);this.$el.find("#deptDataList").show().html(r.render().el)}}),p=["<div class='dataTables_wrapper'>","<div class='toolbar_top header_tb'>","<div class='critical'>","<span class='btn_tool' id='dept_data_migration'><span class='ic_adm ic_move'></span><span class='txt'>{{lang.migration_button}}</span></span>","</div><div class='optional'>","<span class='btn_tool' id='dept_data_down'><span class='ic_adm ic_down'></span><span class='txt'>{{lang.list_to_csv}}</span></span>","</div>","</div>","<div class='content_tb'><div class='dataTables_wrapper'>","<table class='chart size dataTable'>","<thead>","<tr>","<th class='sorting'><span class='title_sort'>{{lang.title}}<ins class='ic'></ins><span class='selected'></span></span></th>","<th class='sorting_disable'>","<select id='statusFilter' style='width:120px;overflow:hidden;white-space:nowrap;text-overflow:ellipsis'>","<option value='all'>"+c.total+"</option>","<option value='normal'>"+c.normal+"</option>","<option value='stop'>"+c.closed+"</option>","</select>","</th>","<th class='sorting_disable'><span class='title_sort'>{{lang.share}}</span><span class='selected'></span></th>","<th class='sorting_desc last'><span class='title_sort'>{{lang.size}}<ins class='ic'></ins><span class='selected'></span></span></th>","</tr>","</thead>","</table>","</div></div>","</div>"].join(""),d=["<div class='dataTables_wrapper'>","<div class='toolbar_top header_tb'>","<div class='critical'>","<span class='btn_tool' id='dept_data_migration'><span class='ic_adm ic_move'></span><span class='txt'>{{lang.migration_button}}</span></span>","</div><div class='optional'>","<span class='btn_tool' id='move_dept_foler'><span class='ic_adm ic_shortcut'></span><span class='txt'>{{lang.move_dept_folder}}</span></span>","<span class='btn_tool' id='dept_data_down'><span class='ic_adm ic_down'></span><span class='txt'>{{lang.list_to_csv}}</span></span>","</div>","</div>","<div class='content_tb'><div class='dataTables_wrapper'>","<table class='chart size dataTable'>","<thead>","<tr>","<th class='sorting'><span class='title_sort'>{{lang.title}}<ins class='ic'></ins><span class='selected'></span></span></th>","<th class='sorting_desc last'><span class='title_sort'>{{lang.docCount}}<ins class='ic'></ins><span class='selected'></span></span></th>","</tr>","</thead>","</table>","</div></div>","</div>"].join(""),v=e.View.extend({events:{"click #dept_data_down":"download","click #dept_data_migration":"migration","click #move_dept_foler":"moveDeptFolder","change #statusFilter":"statusFilter"},initialize:function(){this.deptId=this.options.id,this.grid=null},render:function(e){var t=Hogan.compile(p).render({lang:$.extend({},c,{migration_button:e.migration_button})});this.$el.html(t)},reload:function(){this.grid.tables.reload()},checkboxValidate:function(e){return e.length==0?($.goAlert(c.check_box_alert),!1):!0}}),m=v.prototype,g=v.extend({initialize:function(){this.deptId=this.options.id,$.extend(this.events,m.events),m.initialize.apply(this,arguments)},render:function(){return m.render.call(this,{migration_button:c.migration_board}),this.makeGrid(),this},download:function(){t.util.downloadCsvFile("ad/api/department/"+this.deptId+"/boards/download")},migration:function(){var e=this.grid.tables.getCheckedIds(),n=this;if(!this.checkboxValidate(e))return;$.goOrgSlide({header:c.migration_board,type:"department",isAdmin:!0,contextRoot:t.contextRoot,callback:$.proxy(function(i){if(i.type=="root")return;if(i.id==n.deptId){$.goMessage(r["\ud604\uc7ac\ubd80\uc11c\ub85c\uc774\uad00\ubabb\ud568"]);return}$.goConfirm(c.migration_board,t.i18n(s["\uac8c\uc2dc\ud310 {{arg1}}\ub85c \uc774\ub3d9"],{arg1:i.name}),function(){var r=i.id,s=t.contextRoot+"ad/api/board/transfer/dept/"+r;$.ajax({url:s,data:JSON.stringify({ids:e}),type:"PUT",async:!0,dataType:"json",contentType:"application/json",success:function(e){n.reload(),$("#layoutContent").trigger("dept_detail:reload"),$.goOrgSlide.close(),$.goMessage(c.save_success)}})})},this)})},makeGrid:function(){var e=t.contextRoot+"ad/api/department/"+this.deptId+"/boards";this.grid=$.goGrid({el:this.$("table"),method:"GET",url:e,emptyMessage:'<p class="data_null"><span class="ic_data_type ic_no_data"></span><span class="txt">'+c.dept_amounts_empty+"</span></p>",defaultSorting:[[1,"asc"]],pageUse:!1,sDomUse:!1,checkbox:!0,checkboxData:"id",displayLength:999,columns:[{mData:"name",sWidth:"250px",bSortable:!0},{mData:null,sWidth:"150px",bSortable:!1,fnRender:function(e){return e.aData.status=="ACTIVE"?c.normal:c.closed}},{mData:null,bSortable:!1,fnRender:function(e){var t=e.aData.owners,n=undefined;n=_.filter(t,function(e){return e.ownerShip=="JOINT"});if(n==undefined)return"";var r=[];return $.each(n,function(){r.push(this.ownerInfo)}),r.join(", ")}},{mData:"attachSize",sClass:"align_r",sWidth:"100px",bSortable:!0,fnRender:function(e){return t.util.byteToMega(e.aData.attachSize)}}],fnDrawCallback:function(e){$(".dataTables_scroll tr>td:last-child, .dataTables_scroll tr>th:last-child, .dataTables_scrollBody tr:last-child").addClass("last")}})},statusFilter:function(e){this.changeFilter(e,"statusFilter")},changeFilter:function(e,t){var n=$(e.currentTarget).val();filterValue="",n=="all"?filterValue="":n=="normal"?filterValue="ACTIVE":filterValue="CLOSED",typeof this.grid.tables.setParam=="function"&&this.grid.tables.setParam(t,filterValue)}}),y=v.extend({initialize:function(){$.extend(this.events,m.events),m.initialize.apply(this,arguments)},render:function(){return m.render.call(this,{migration_button:c.migration_task}),this.makeGrid(),this},download:function(){t.util.downloadCsvFile("ad/api/task/department/"+this.deptId+"/folders/download")},migration:function(){var e=this.grid.tables.getCheckedIds(),n=this;if(!this.checkboxValidate(e))return;$.goOrgSlide({type:"department",isAdmin:!0,contextRoot:t.contextRoot,callback:$.proxy(function(r){if(r.type=="root")return;var i='<p class="add">'+t.i18n(u["\ud3f4\ub354 {{arg1}}\ub85c \uc774\ub3d9"],{arg1:r.name})+"</p>";$.goConfirm(i,"",function(){$.ajax({type:"PUT",async:!0,data:JSON.stringify({ids:e}),dataType:"json",contentType:"application/json",url:t.config("contextRoot")+"ad/api/task/folder/transfer/dept/"+r.id}).done(function(e){n.reload(),$("#layoutContent").trigger("dept_detail:reload"),$.goOrgSlide.close()})})},this)})},makeGrid:function(){var e=t.contextRoot+"ad/api/task/department/"+this.deptId+"/folders",n=this;this.grid=$.goGrid({el:this.$("table"),method:"GET",url:e,emptyMessage:'<p class="data_null"><span class="ic_data_type ic_no_data"></span><span class="txt">'+c.dept_amounts_empty+"</span></p>",defaultSorting:[[1,"asc"]],pageUse:!1,sDomUse:!1,checkbox:!0,checkboxData:"id",displayLength:999,columns:[{mData:"name",sWidth:"250px",bSortable:!0},{mData:null,sWidth:"150px",bSortable:!1,fnRender:function(e){return e.aData.closedAt==undefined?c.normal:c.closed}},{mData:"share",bSortable:!1,fnRender:function(e){var t=e.aData.share.nodes;return sharer=_.filter(t,function(e){return e.nodeId!=n.deptId}),sharerNames=[],sharer.length==0?"":($.each(sharer,function(){sharerNames.push(this.nodeValue)}),sharerNames.join(","))}},{mData:"attachSize",sClass:"align_r",sWidth:"100px",bSortable:!0,fnRender:function(e){return t.util.byteToMega(e.aData.attachSize)}}],fnDrawCallback:function(e){$(".dataTables_scroll tr>td:last-child, .dataTables_scroll tr>th:last-child, .dataTables_scrollBody tr:last-child").addClass("last")}})},statusFilter:function(e){this.changeFilter(e,"statusFilter")},changeFilter:function(e,t){var n=$(e.currentTarget).val();filterValue="",n=="all"?filterValue="":n=="normal"?filterValue="LIVE":filterValue="STOPPED",typeof this.grid.tables.setParam=="function"&&this.grid.tables.setParam(t,filterValue)}}),b=v.extend({initialize:function(){$.extend(this.events,m.events),m.initialize.apply(this,arguments)},render:function(){return m.render.call(this,{migration_button:c.migration_report}),this.makeGrid(),this},download:function(){t.util.downloadCsvFile("ad/api/report/department/"+this.deptId+"/folders/download")},migration:function(){var e=this.grid.tables.getCheckedIds(),n=this;if(!this.checkboxValidate(e))return;$.goOrgSlide({header:c.add_viewer,type:"department",isAdmin:!0,contextRoot:t.contextRoot,callback:$.proxy(function(e){if(e.type=="root")return;var r=this.grid.tables.getCheckedIds();content='<p class="add">'+t.i18n(a["\ud3f4\ub354 \uc774\uad00 \uacbd\uace0"],{arg1:e.name})+"</p>";if(!this.checkboxValidate(r))return;$.goConfirm(content,"",function(){$.ajax({type:"PUT",async:!0,data:JSON.stringify({ids:r}),dataType:"json",contentType:"application/json",url:t.contextRoot+"ad/api/report/folder/department/"+n.deptId+"/transfer/"+e.id}).done(function(e){n.reload(),$("#layoutContent").trigger("dept_detail:reload"),$.goOrgSlide.close()})})},this)})},makeGrid:function(){var e=t.contextRoot+"ad/api/report/department/"+this.deptId+"/folders";this.grid=$.goGrid({el:this.$("table"),method:"GET",url:e,emptyMessage:'<p class="data_null"><span class="ic_data_type ic_no_data"></span><span class="txt">'+c.dept_amounts_empty+"</span></p>",defaultSorting:[[1,"asc"]],pageUse:!1,sDomUse:!1,checkbox:!0,checkboxData:"id",displayLength:999,columns:[{mData:"name",sWidth:"250px",bSortable:!0},{mData:null,sWidth:"150px",bSortable:!1,fnRender:function(e){return e.aData.status=="ACTIVE"?c.normal:c.closed}},{mData:null,bSortable:!1,fnRender:function(e){return""}},{mData:"attachSize",sClass:"align_r",sWidth:"100px",bSortable:!0,fnRender:function(e){return t.util.byteToMega(e.aData.attachSize)}}],fnDrawCallback:function(e){$(".dataTables_scroll tr>td:last-child, .dataTables_scroll tr>th:last-child, .dataTables_scrollBody tr:last-child").addClass("last")}})},statusFilter:function(e){this.changeFilter(e,"statusFilter")},changeFilter:function(e,t){var n=$(e.currentTarget).val();filterValue="",n=="all"?filterValue="":n=="normal"?filterValue="ACTIVE":filterValue="INACTIVE",typeof this.grid.tables.setParam=="function"&&this.grid.tables.setParam(t,filterValue)}}),w=v.extend({initialize:function(){$.extend(this.events,m.events),m.initialize.apply(this,arguments)},render:function(e){var t=Hogan.compile(d).render({lang:$.extend({},c,{migration_button:c.migration_approval,moveDeptFolder_button:c.move_dept_folder})});return this.$el.html(t),this.makeGrid(),this},download:function(){t.util.downloadCsvFile("ad/api/approval/deptfolder/download/"+this.deptId)},moveDeptFolder:function(){var e=this.deptId,n=r["\ud574\ub2f9 \ud654\uba74\uc73c\ub85c \uc774\ub3d9\ud558\uae30 \uc704\ud55c \uad8c\ud55c\uc774 \uc5c6\uc2b5\ub2c8\ub2e4."],s=[];this.options.approvalMenuAccessible&&(n=r["\ubd80\uc11c \ubb38\uc11c\ud568 \uad00\ub9ac\ub85c \uc774\ub3d9\ud558\uc2dc\uaca0\uc2b5\ub2c8\uae4c?"],s=[{btext:i["\ud655\uc778"],btype:"confirm",autoclose:!0,callback:function(){t.router.navigate("approval/deptfolder/"+e,!0)}},{btext:i["\ucde8\uc18c"]}]),$.goPopup({width:600,title:"",pclass:"layer_confim",contents:"<p class='q'>"+n+"</p>",buttons:s})},migration:function(){var e=this.grid.tables.getCheckedIds(),n=this;if(!this.checkboxValidate(e))return;var i=function(){$.goOrgSlide.close()};$.goOrgSlide({type:"department",isAdmin:!0,contextRoot:t.contextRoot,callback:$.proxy(function(s){if(s.type=="root")return;var u=!1,a="";e.forEach(function(e,t,n){if(e=="DRAFT"||e=="RECEPTION"||e=="REFERENCE")u==1&&(a=a.concat(", ")),e=="DRAFT"?a=a.concat(o["\uae30\uc548 \uc644\ub8cc\ud568"]):e=="RECEPTION"?a=a.concat(o["\ubd80\uc11c \uc218\uc2e0\ud568"]):e=="REFERENCE"&&(a=a.concat(o["\ubd80\uc11c \ucc38\uc870\ud568"])),u=!0}),u&&(a=t.i18n(r["<{{arg1}}>\uc740 \ubb38\uc11c\ud568\uc774 \ubcf5\uc0ac \ubb38\uad6c"],{arg1:a})),$.goConfirm(t.i18n(r["\ubb38\uc11c\ud568 {{arg1}}\ub85c \uc774\ub3d9"],{arg1:s.name}),a,function(){t.EventEmitter.trigger("common","layout:setOverlay",""),$.ajax({type:"PUT",timeout:72e5,async:!0,data:JSON.stringify({stringIds:e}),dataType:"json",contentType:"application/json",url:t.config("contextRoot")+"ad/api/approval/deptfolder/transfer/"+s.id+"/"+n.id}).done(function(e){n.reload(),$("#layoutContent").trigger("dept_detail:reload"),$.goOrgSlide.close()}).always(function(e){t.EventEmitter.trigger("common","layout:clearOverlay",!0)})},i)},this)})},makeGrid:function(){var e=t.contextRoot+"ad/api/approval/deptallfolder/"+this.deptId;this.grid=$.goGrid({el:this.$("table"),method:"GET",url:e,emptyMessage:'<p class="data_null"><span class="ic_data_type ic_no_data"></span><span class="txt">'+c.dept_amounts_empty+"</span></p>",defaultSorting:[[1,"asc"]],pageUse:!1,sDomUse:!1,checkbox:!0,checkboxData:"id",deptId:"deptId",folderType:"folderType",displayLength:999,columns:[{mData:null,sWidth:"250px",bSortable:!1,fnRender:function(e){return e.aData.folderName}},{mData:null,sClass:"align_r",sWidth:"100px",bSortable:!1,fnRender:function(e){return e.aData.docCount||0}}],fnDrawCallback:function(e){$(".dataTables_scroll tr>td:last-child, .dataTables_scroll tr>th:last-child, .dataTables_scrollBody tr:last-child").addClass("last")}})},statusFilter:function(e){this.changeFilter(e,"statusFilter")},changeFilter:function(e,t){var n=$(e.currentTarget).val();filterValue="",n=="all"?filterValue="":n=="normal"?filterValue="LIVE":filterValue="STOPPED",typeof this.grid.tables.setParam=="function"&&this.grid.tables.setParam(t,filterValue)}}),E={};return E.create=function(e,t,n){if(e=="Board")return new g({id:t});if(e=="Task")return new y({id:t});if(e=="Report")return new b({id:t});if(e=="Approval")return new w({id:t,approvalMenuAccessible:n});if(e=="Contact")return new f({id:t,__super__:m});throw new Error("400","invalid GridViewFactory type")},h});