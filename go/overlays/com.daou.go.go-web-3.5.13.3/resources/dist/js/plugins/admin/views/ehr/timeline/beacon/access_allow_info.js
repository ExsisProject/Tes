define("admin/views/ehr/timeline/beacon/access_allow_info",function(require){require("jquery.go-orgslide"),require("jquery.go-grid"),require("jquery.go-sdk");var e=require("hgn!admin/templates/ehr/timeline/beacon/access_allow_info"),t=require("hgn!admin/templates/ehr/timeline/beacon/edit"),n=require("i18n!admin/nls/admin"),r=require("i18n!nls/commons"),i=Backbone.View.extend({lang:{label_all:r["\ubaa8\ub450 \ud5c8\uc6a9"],label_part:r["\ubd80\ubd84 \ud5c8\uc6a9"]},events:{"click #beaconAddBtn":"addAccessBeacon","click .beacon_del_btn":"delAccessBeacon","click .beacon_model":"modifyAccessBeacon","click .title_sort":"onSortClicked","click #allOfBeacon":"toggleBeaconInfo","click #partOfBeacon":"toggleBeaconInfo"},initialize:function(e){this.workPlace=e.workPlace,this.useBeacon=this.workPlace.get("useBeacon"),this.beaconModels=this.workPlace.get("beaconModels"),this.workPlace.get("beaconModels")?this.beaconModels=this.workPlace.get("beaconModels").slice():this.beaconModels=new Array,this.updated=!1},render:function(){this.$el.html(e({adminLang:n,commonLang:r,lang:this.lang,beaconModels:this.beaconModels,useBeacon:this.useBeacon}))},saved:function(){this.updated=!1},toggleBeaconInfo:function(e){$(e.currentTarget).val()==="all"?this.$el.find("#accessBeaconsContainer").css("display","none"):this.$el.find("#accessBeaconsContainer").css("display","")},addAccessBeacon:function(e){this.updated=!0,this._callPopupEditBeacon()},modifyAccessBeacon:function(e){this.updated=!0,this._callPopupEditBeacon($(e.currentTarget),!0)},delAccessBeacon:function(e){var t=function(){var t=$(e.currentTarget).attr("data-location"),n=$(e.currentTarget).attr("data-uuid");this.beaconModels.splice(this.beaconModels.findIndex(function(e){return e.uuid===n&&e.location===t}),1),this.refresh(),this.updated=!0};$.goPopup({title:n["\uc120\ud0dd\ud55c \ube44\ucf58 \uc0ad\uc81c \uc54c\ub9bc"],modal:!0,buttons:[{btype:"confirm",btext:r["\uc0ad\uc81c"],callback:$.proxy(t,this)},{btype:"close",btext:r["\ucde8\uc18c"]}]}),e.stopPropagation()},isCheckedUseBeacon:function(){return this.$el.find("#partOfBeacon").prop("checked")},_callPopupEditBeacon:function(e,i){var s={};if(i){var o=e.data("id"),u=e.data("location"),a=e.data("uuid"),f=this.beaconModels.find(function(e){return o?e.id==o:u==e.location&&a==e.uuid});s=f}var l=this,c=t({adminLang:n,commonLang:r,model:s});this.editPopup=$.goPopup({pclass:"layer_normal layer_ehr_kind",header:o==null?n["\uc811\uc18d \ud5c8\uc6a9 \ube44\ucf58 \ucd94\uac00"]:n["\uc811\uc18d \ud5c8\uc6a9 \ube44\ucf58 \uc218\uc815"],modal:!0,width:"320px",contents:c,buttons:[{btext:r["\uc800\uc7a5"],btype:"confirm",autoclose:!1,callback:function(e){var t=!0,r=$("#accessBeaconBlock"),o=r.find("#beaconLocation").val(),u=r.find("#beaconUuid").val(),a=r.find("#beaconMajor").val(),f=r.find("#beaconMinor").val(),c=r.find("#beaconDescription").val();l.initAlertEl();var h=/^[A-Za-z0-9+]*$/;if(!o)return r.find("#beaconLocationAlert").html(n["\uc124\uce58\uc7a5\uc18c\ub97c \uc785\ub825\ud574\uc8fc\uc138\uc694"]),!1;if(!u)return r.find("#beaconUuidAlert").html(n["UUID\ub97c \uc785\ub825\ud574\uc8fc\uc138\uc694"]),!1;if(!h.test(u))return r.find("#beaconUuidAlert").html(n["\uc601\uc5b4,\uc22b\uc790\ub9cc \uc785\ub825 \uac00\ub2a5"]),!1;if(!a)return r.find("#beaconMajorAlert").html(n["Major \uac12\uc744 \uc785\ub825\ud574\uc8fc\uc138\uc694"]),!1;if(a<1||a>65335)return r.find("#beaconMajorAlert").html(n["1~65335 \uc0ac\uc774\uc758 \uac12\uc744 \uc785\ub825\ud574\uc8fc\uc138\uc694"]),!1;if(!f)return r.find("#beaconMinorAlert").html(n["Minor \uac12\uc744 \uc785\ub825\ud574\uc8fc\uc138\uc694"]),!1;if(f<1||f>65335)return r.find("#beaconMinorAlert").html(n["1~65335 \uc0ac\uc774\uc758 \uac12\uc744 \uc785\ub825\ud574\uc8fc\uc138\uc694"]),!1;l.beaconModels.filter(function(e){return e!=s}).forEach(function(e){if(o==e.location){r.find("#beaconLocationAlert").html(n["\uc911\ubcf5\ub41c \uc774\ub984\uc774 \uc874\uc7ac\ud569\ub2c8\ub2e4."]),t=!1;return}if(u==e.uuid){r.find("#beaconUuidAlert").html(n["\uc911\ubcf5\ub41c UUID\uac00 \uc874\uc7ac\ud569\ub2c8\ub2e4"]),t=!1;return}});if(!t)return!1;s.location=o,s.description=c,s.uuid=u,s.major=a,s.minor=f,i||l.beaconModels.push(s),l.useBeacon=l.isCheckedUseBeacon(),l.refresh(),e.close()}},{btext:r["\ucde8\uc18c"],btype:"cancel"}]},this)},initAlertEl:function(){var e=$("#accessBeaconBlock");e.find("#beaconLocationAlert").html(""),e.find("#beaconUuidAlert").html(""),e.find("#beaconMajorAlert").html(""),e.find("#beaconMinorAlert").html("")},refresh:function(){this.remove(),this.render(),this.delegateEvents()},remove:function(){this.undelegateEvents(),this.$el.removeData().unbind(),this.$el.html("")},onSortClicked:function(e){var t=$(e.currentTarget).data("sortkey"),n=t==this.sortKey?!this.desc:!1;this.sortKey=t,this.desc=n,this.sortBeacons(t,n),this.refresh()},sortBeacons:function(e,t){this.beaconModels.sort(function(n,r){var i=0;return!n[e]&&r[e]?i=-1:n[e]&&!r[e]?i=1:n[e]>r[e]?i=1:n[e]<r[e]&&(i=-1),t?-i:i})}});return i});