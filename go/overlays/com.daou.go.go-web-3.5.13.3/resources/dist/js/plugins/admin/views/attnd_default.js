define(["jquery","backbone","app","admin/models/attnd_default_model","admin/models/attnd_status","hgn!admin/templates/attnd_default","views/circle","i18n!nls/commons","i18n!admin/nls/admin","jquery.go-popup","jquery.go-sdk","jquery.go-grid","jquery.go-orgslide","jquery.go-validation","GO.util"],function(e,t,n,r,i,s,o,u,a){var f={label_ok:u["\uc800\uc7a5"],label_cancel:u["\ucde8\uc18c"],label_remove:u["\uc0ad\uc81c"],label_defaultSetting:a["\uae30\ubcf8 \uc124\uc815"],label_attendanceSetting:a["\uadfc\ud0dc\uc790 \uc124\uc815"],label_workingDay:a["\uadfc\ubb34\uc77c"],label_excludeClass:a["\uadfc\ud0dc \ud074\ub798\uc2a4 \ucd94\uac00"],label_selectClass:a["\ud074\ub798\uc2a4 \uc120\ud0dd"],label_addExceptionClass:a["\uc608\uc678 \ud074\ub798\uc2a4 \ucd94\uac00"],label_workingDaySun:a.SU,label_workingDayMon:a.MO,label_workingDayTue:a.TU,label_workingDayWed:a.WE,label_workingDayThu:a.TH,label_workingDayFri:a.FR,label_workingDaySat:a.SA,label_clockInOutTime:a["\ucd9c\ud1f4\uadfc \uc2dc\uac04"],label_clockInTime:a["\ucd9c\uadfc \uc2dc\uac04"],label_clockOutTime:a["\ud1f4\uadfc \uc2dc\uac04"],label_attendanceStatus:a["\uadfc\ud0dc \uc0c1\ud0dc"],label_addAttendanceStatus:a["\ucd94\uac00"],label_statusName:a["\ud56d\ubaa9\uba85"],label_statusType:a["\ud3b8\uc9d1 \uc720\ud615"],label_policySetting:a["\uc815\ucc45 \uc124\uc815"],label_attendanceActive:a["\uadfc\ud0dc\uad00\ub9ac \ud65c\uc131\ud654 \uc5ec\ubd80"],label_menuActive:a["\uba54\ub274 \ud65c\uc131\ud654 \uc5ec\ubd80"],label_menuActiveDesc:a["\ud574\ub2f9 \uba54\ub274\ub97c \ud65c\uc131\ud654 \ud569\ub2c8\ub2e4."],label_menuDectiveDesc:a["\ud574\ub2f9 \uba54\ub274\ub97c \ube44\ud65c\uc131\ud654 \ud569\ub2c8\ub2e4."],label_30_status_alert:a["\ucd5c\ub300 30\uac1c\uae4c\uc9c0\ub9cc \ucd94\uac00\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4."],label_date:a["\ub0a0\uc9dc"],label_time:a["\uc2dc\uac04"],label_useFlexibleTime:a["\uc790\uc728 \ucd9c\ud1f4\uadfc\uc81c \uc774\uc6a9"],label_blackDesc:a["\ucc28\ub2e8 \uc815\ucc45 \uc124\uba85"],label_whiteDesc:a["\ud5c8\uc6a9 \uc815\ucc45 \uc124\uba85"],label_use:a["\uc0ac\uc6a9"],label_unuse:a["\uc0ac\uc6a9\uc548\ud568"],label_mobileapp:a["\ubaa8\ubc14\uc77c \uc571"],label_allow_mobile:a["\uadfc\ud0dc\uccb4\ud06c \ud5c8\uc6a9 \uc5ec\ubd80"],label_mobile_app_ehr:a["\ubaa8\ubc14\uc77c \uc571 \uadfc\ud0dc"],label_record_gps:a["GPS \uae30\ub85d"],label_webservice:a["\uc6f9 \uc11c\ube44\uc2a4"],label_gps_desc:a["GPS \uae30\ub85d \uc124\uba85"],label_flexibleTime_desc:a["*\uc2dc\uac04 \uc124\uc815 \uc5c6\uc774 \uc790\uc720\ub86d\uac8c \uccb4\ud06c\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4."],label_day_after:a["\uc775\uc77c"],label_until:a["\uae4c\uc9c0"],label_all_night_time:a["\ucca0\uc57c\ud1f4\uadfc \uc2dc\uac04"],label_all_night_desc:a["*\ucca0\uc57c \ud1f4\uadfc\uc2dc\uac04 \uc124\uba85"],label_restrict_active:a["\uadfc\ud0dc \ub370\uc774\ud130 \uc218\uc815 \uc81c\ud55c \uc124\uc815"],label_restrict_txt:a["\uadfc\ud0dc \ub370\uc774\ud130 \uc218\uc815 \uc81c\ud55c"],label_restrict_desc:a["\uadfc\ud0dc\ub3d9\uae30\ud654 \uc124\uba85"],label_restrict_tooltip:a["\uadfc\ud0dc\ub3d9\uae30\ud654 \uc124\uba85 \ud234\ud301"],label_restrict_guide:a["\uac00\uc774\ub4dc"]},l=t.View.extend({accessUserView:null,exceptionUserView:null,el:"#layoutContent",initialize:function(){this.$el.off(),this.model=r.get(),this.workDay=JSON.parse(this.model.get("workDay"))},events:{"click #attndDefaultSubmit":"submit","click #attndDefaultCancel":"cancel","change #useFlexibleTime":"useFlexibleTime","click input[name='allowMobile']":"changeAllowMobile","click input#activeSync":"_deActiveMobileCheck","click input#deactivateSync":"_activeMobileCheck","click span#restrictGuide":"_onClickPopupGuideLayer"},render:function(){var t=this,n=[{text:"00",value:"00"},{text:"01",value:"01"},{text:"02",value:"02"},{text:"03",value:"03"},{text:"04",value:"04"},{text:"05",value:"05"},{text:"06",value:"06"},{text:"07",value:"07"},{text:"08",value:"08"},{text:"09",value:"09"},{text:"10",value:"10"},{text:"11",value:"11"},{text:"12",value:"12"},{text:"13",value:"13"},{text:"14",value:"14"},{text:"15",value:"15"},{text:"16",value:"16"},{text:"17",value:"17"},{text:"18",value:"18"},{text:"19",value:"19"},{text:"20",value:"20"},{text:"21",value:"21"},{text:"22",value:"22"},{text:"23",value:"23"}],r=[{text:"00",value:"00"},{text:"01",value:"01"},{text:"02",value:"02"},{text:"03",value:"03"},{text:"04",value:"04"},{text:"05",value:"05"},{text:"06",value:"06"},{text:"07",value:"07"},{text:"08",value:"08"},{text:"09",value:"09"},{text:"10",value:"10"},{text:"11",value:"11"},{text:"12",value:"12"},{text:"13",value:"13"},{text:"14",value:"14"},{text:"15",value:"15"},{text:"16",value:"16"},{text:"17",value:"17"},{text:"18",value:"18"},{text:"19",value:"19"},{text:"20",value:"20"},{text:"21",value:"21"},{text:"22",value:"22"},{text:"23",value:"23"},{text:"24",value:"24"},{text:"25",value:"25"},{text:"26",value:"26"},{text:"27",value:"27"},{text:"28",value:"28"},{text:"29",value:"29"},{text:"30",value:"30"},{text:"31",value:"31"},{text:"32",value:"32"},{text:"33",value:"33"},{text:"34",value:"34"},{text:"35",value:"35"},{text:"36",value:"36"},{text:"37",value:"37"},{text:"38",value:"38"},{text:"39",value:"39"},{text:"40",value:"40"},{text:"41",value:"41"},{text:"42",value:"42"},{text:"43",value:"43"},{text:"44",value:"44"},{text:"45",value:"45"},{text:"46",value:"46"},{text:"47",value:"47"},{text:"48",value:"48"},{text:"49",value:"49"},{text:"50",value:"50"},{text:"51",value:"51"},{text:"52",value:"52"},{text:"53",value:"53"},{text:"54",value:"54"},{text:"55",value:"55"},{text:"56",value:"56"},{text:"57",value:"57"},{text:"58",value:"58"},{text:"59",value:"59"}];this.$el.empty(),this.$el.html(s({lang:f,data:this.model.toJSON(),group:this.model.get("group"),workDay:this.workDay,time_hour:n,time_second:r,isBlackGroup:this.model.get("group").accessSetting=="BLACK"?!0:!1,isServiceAdminMode:GO.session().serviceAdminMode})),e("#allowMobile").is(":checked")?e("#mobileAppEhr").show():(e("#mobileAppEhr").hide(),e("input#recordGps_unuse").attr("checked",!0)),GO.session().serviceAdminMode||e("div#syncActiveMode").hide(),this.model.get("syncActive")?t._deActiveMobileCheck():t._activeMobileCheck(),this.renderInOutAllNightTime(),this.renderAccessUserView(),this.renderExceptionUserView()},renderInOutAllNightTime:function(){var e=this.model.get("group").clockInTime,t=this.model.get("group").clockOutTime,n=this.model.get("group").clockAllNightTime;this.$el.find("#inTimeHour").val(e.split(":")[0]),this.$el.find("#inTimeMin").val(e.split(":")[1]),this.$el.find("#inTimeSec").val(e.split(":")[2]),this.$el.find("#outTimeHour").val(t.split(":")[0]),this.$el.find("#outTimeMin").val(t.split(":")[1]),this.$el.find("#outTimeSec").val(t.split(":")[2]),this.model.get("group").useFlexibleTime&&(this.$el.find("#clockInOutContainer").hide(),this.$el.find("#clockAllNightContainer").hide()),this.$el.find("#allNightTimeHour").val(n.split(":")[0]),this.$el.find("#allNightTimeMin").val(n.split(":")[1]),this.$el.find("#allNightTimeSec").val(n.split(":")[2])},renderAccessUserView:function(){var e=["user","position","grade","usergroup"];GO.util.isUseOrgService(!0)&&(e=["user","department","position","grade","duty","usergroup"]),this.accessUserView=new o({selector:"#accessUser",isAdmin:!0,isWriter:!0,circleJSON:this.model.get("group").accessTarget,nodeTypes:e}),this.accessUserView.render()},renderExceptionUserView:function(){var e=["user","position","grade","usergroup"];GO.util.isUseOrgService(!0)&&(e=["user","department","position","grade","duty","usergroup"]),this.exceptionUserView=new o({selector:"#exceptionUser",isAdmin:!0,isWriter:!0,circleJSON:this.model.get("group").exceptionTarget,nodeTypes:e}),this.exceptionUserView.render()},useFlexibleTime:function(t){var n=e(t.currentTarget).is(":checked");n?(e("#clockInOutContainer").hide(),e("#clockAllNightContainer").hide()):(e("#clockInOutContainer").show(),e("#clockAllNightContainer").show())},changeAllowMobile:function(t){var n=e(t.currentTarget),r=n.is(":checked");r?e("#mobileAppEhr").show():(e("#mobileAppEhr").hide(),e("input#recordGps_unuse").attr("checked",!0))},submit:function(){var t=this,n=[],r=!0,i=60;e("span.go_alert").text("");var s=parseInt(e("#inTimeHour").val())*i*i+parseInt(e("#inTimeMin").val())*i+parseInt(e("#inTimeSec").val()),o=parseInt(e("#outTimeHour").val())*i*i+parseInt(e("#outTimeMin").val())*i+parseInt(e("#outTimeSec").val()),f=parseInt(e("#allNightTimeHour").val())*i*i+parseInt(e("#allNightTimeMin").val())*i+parseInt(e("#allNightTimeSec").val());if(s<f){e.goAlert(a["\ucca0\uc57c\ud1f4\uadfc \uc2dc\uac04\uc740 \uc775\uc77c \ucd9c\uadfc\uc2dc\uac04\uc744 \ub118\uae38\uc218 \uc5c6\uc2b5\ub2c8\ub2e4."]);return}if(!e("#useFlexibleTime").is(":checked")&&s>=o){e("#inOutValidate").text(a["\ud1f4\uadfc \uc2dc\uac04\uc774 \ucd9c\uadfc \uc2dc\uac04\ubcf4\ub2e4 \uc774\uc804\uc77c \uc218 \uc5c6\uc2b5\ub2c8\ub2e4."]);return}if(!r)return;var l=e("#inTimeHour").val()+":"+e("#inTimeMin").val()+":"+e("#inTimeSec").val(),c=e("#outTimeHour").val()+":"+e("#outTimeMin").val()+":"+e("#outTimeSec").val(),h=e("#allNightTimeHour").val()+":"+e("#allNightTimeMin").val()+":"+e("#allNightTimeSec").val();t.model.set("workDay",JSON.stringify({Mon:e("#labelMon").is(":checked"),Tue:e("#labelTue").is(":checked"),Wed:e("#labelWed").is(":checked"),Thu:e("#labelThu").is(":checked"),Fri:e("#labelFri").is(":checked"),Sat:e("#labelSat").is(":checked"),Sun:e("#labelSun").is(":checked")}),{silent:!0}),t.model.set("group",{id:e("#attndDefaultSetting").attr("data-id"),useFlexibleTime:e("#useFlexibleTime").is(":checked"),accessSetting:e("#selectAccessPolicy input[type=radio]:checked").val(),clockInTime:l,clockOutTime:c,clockAllNightTime:h,accessTarget:this.accessUserView.getData(),exceptionTarget:this.exceptionUserView.getData(),name:"default",allowMobile:e("input#allowMobile").is(":checked"),recordGps:e("input#recordGps_use").is(":checked")},{silent:!0}),t.model.set("status",n,{silent:!0}),t.model.set("menuActive",e("input#activeMenu").is(":checked"),{silent:!0}),t.model.set("allowMobile",e("input#allowMobile").is(":checked"),{silent:!0}),t.model.set("recordGps",e("input#recordGps_use").is(":checked"),{silent:!0}),t.model.set("syncActive",e("input#activeSync").is(":checked"),{silent:!0}),GO.EventEmitter.trigger("common","layout:setOverlay",""),t.model.save({},{type:"PUT",success:function(t,n){n.code=="200"&&(e.goMessage(u["\uc800\uc7a5\ub418\uc5c8\uc2b5\ub2c8\ub2e4."]),GO.EventEmitter.trigger("common","layout:clearOverlay",!0),GO.router.navigate("ehr/attnd",{trigger:!0}))},error:function(t,n){e.goMessage(u["\uc800\uc7a5\uc5d0 \uc2e4\ud328 \ud558\uc600\uc2b5\ub2c8\ub2e4."]),GO.EventEmitter.trigger("common","layout:clearOverlay",!0)}})},cancel:function(){this.render()},_activeMobileCheck:function(t){var n=this;e("input#allowMobile").prop("disabled",!1),t&&e("input#useFlexibleTime").prop("checked",!1),e("#clockInOutContainer").show(),e("#clockAllNightContainer").show()},_deActiveMobileCheck:function(t){var n=this;e("input#allowMobile").prop("disabled",!0),e("input#allowMobile").prop("checked",!1),e("#mobileAppEhr").hide(),e("input#recordGps_unuse").prop("checked",!0),t&&(e("input#useFlexibleTime").prop("checked",!0),e("#clockInOutContainer").hide(),e("#clockAllNightContainer").hide())},_onClickPopupGuideLayer:function(){var e=GO.contextRoot+"resources/guide/attnd/start.htm";window.open(e,"attndGuide","resizable=yes,scrollbars=yes,width=820,height=700")}});return l});