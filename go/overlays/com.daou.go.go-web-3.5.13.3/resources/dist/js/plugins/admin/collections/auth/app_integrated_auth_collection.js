define("admin/collections/auth/app_integrated_auth_collection",function(require){var e=require("backbone"),t=require("app"),n=require("underscore"),r=require("admin/models/auth/app_integrated_auth_category"),i=require("admin/models/layout/page_model"),s=e.Collection.extend({initialize:function(e){this.catModel=[],this.detailItems=[],this.checkedCnt=0,this.filterModel=e.filterModel,this.pageModel=new i},refresh:function(){var e=this;this.fetch({async:!1,success:function(t){e.page=t.page,e.appName=t.extParameter}}),this.detailItems=[];if(this.filterModel.appAuthLevel==="AppContentOperator")this.catModel[0]=new r({attributes:{appAuthGroup:this.filterModel.appAuthType,groupName:this.filterModel.appAuthType,appAuthModels:this.models,contentLevel:!0}}),n.forEach(this.catModel[0].appAuthModels,function(t){e.detailItems[e.detailItems.length]=t});else for(var t=0;t<this.length;t++)this.catModel[t]=new r(this.models[t]),n.forEach(this.catModel[t].appAuthModels,function(t){e.detailItems[e.detailItems.length]=t})},updatePage:function(e){if(e.page||e.page===0)this.pageModel.page=e.page;e.offset&&(this.pageModel.offset=e.offset),e.property&&(this.pageModel.property=e.property),e.direction&&(this.pageModel.direction=e.direction)},updatedChecked:function(e){var t=this;return this.checkedCnt=0,n.forEach(this.detailItems,function(n){t.checkedCnt+=n.updatedChecked(e)}),this.checkedCnt},getUpdatedReqModels:function(){var e=[];return n.forEach(this.detailItems,function(t){t.updated&&(e[e.length]=t.getSaveModel())}),e},getCheckedReqModels:function(e,t){var r=[];return n.forEach(this.detailItems,function(n){n.checked&&(r[r.length]=n.getSaveModel(e,t))}),r},clearData:function(){n.forEach(this.detailItems,function(e){e.checked&&e.clearData()})},addAdminData:function(e){n.forEach(this.detailItems,function(t){t.checked&&t.addUserModel(e)})},saveUpdatedItems:function(){var e=this;$.ajax({url:t.contextRoot+"ad/api/auth/saves",data:JSON.stringify(this.getUpdatedReqModels()),type:"POST",async:!1,contentType:"application/json",success:function(e){},error:function(e){}})},addAdmin:function(e){var r=this;$.ajax({url:t.contextRoot+"ad/api/auth/saves",data:JSON.stringify(this.getCheckedReqModels(e,!1)),type:"POST",async:!1,contentType:"application/json",success:function(t){n.forEach(r.detailItems,function(t){t.checked&&t.addUserModel(e)})},error:function(e){}})},removeSelectedUser:function(){var e=[];n.forEach(this.detailItems,function(t){t.checked&&(e=e.concat(t.clearUser()))}),e.length>0&&this.removeAdminModel(e),n.forEach(this.detailItems,function(e){e.checked&&e.clear()})},removeAdminModel:function(e){var n=this;$.ajax({url:t.contextRoot+"ad/api/auth/removes",data:JSON.stringify(e),type:"POST",async:!1,contentType:"application/json"})},removeAdminUser:function(e){var t=this;this.removeAdminModel(this.getCheckedReqModels(e,!0)),n.forEach(t.detailItems,function(t){t.checked&&t.removeUserModel(e)})},getQueryParam:function(){return"?"+$.param({appAuthLevel:this.filterModel.appAuthLevel,userName:this.filterModel.userName,appCategory:this.filterModel.appCategory,appAuthType:this.filterModel.appAuthType,contentName:this.filterModel.contentName})+"&"+this.pageModel.getQueryStr()},url:function(){var e=t.contextRoot+"ad/api/auth/all";return e+=this.filterModel.appAuthLevel==="AppContentOperator"?"/"+this.filterModel.appAuthType:"",e+=this.getQueryParam(),e}});return s});