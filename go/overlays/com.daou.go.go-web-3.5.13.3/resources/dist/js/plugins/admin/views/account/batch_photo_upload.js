define("admin/views/account/batch_photo_upload",function(require){var e=require("backbone"),t=require("app"),n=require("hgn!admin/templates/attached_file"),r=require("hgn!admin/templates/batch_photo_upload"),i=require("file_upload"),s=require("i18n!nls/commons"),o=require("i18n!admin/nls/admin"),u=require("i18n!approval/nls/approval"),a=require("admin/views/org_sync_button");require("GO.util"),require("jquery.go-grid"),require("jquery.go-preloader"),require("swfupload"),require("swfupload.plugin"),require("jquery.progressbar");var f={member_photo_regist:o["\uba64\ubc84\uc0ac\uc9c4 \uc77c\uad04\ub4f1\ub85d"],batch_regist:o["\uc77c\uad04 \ub4f1\ub85d"],id:o["\uc544\uc774\ub514\ub85c \ub9e4\ud551\ud558\uc5ec \ub4f1\ub85d"],id_number:o["\uc778\uc2dd\ubc88\ud638(\uc0ac\ubc88/\ud559\ubc88)\uc73c\ub85c \ub9e4\ud551\ud558\uc5ec \ub4f1\ub85d"],select_file:o["\ud30c\uc77c \ucc3e\uae30"],save:s["\uc800\uc7a5"],cancel:s["\ucde8\uc18c"],upload_must_zipfile:o["\uba64\ubc84\uc0ac\uc9c4 \uc77c\uad04\ub4f1\ub85d \uc124\uba85"],file_standard_extension:o["\uc0ac\uc9c4 \ud30c\uc77c \uaddc\uaca9 \uc885\ub958"],photo_size_info:o["150x150 \uc0ac\uc774\uc988"],impossible_to_see_result_below:o["\uc77c\uad04\ub4f1\ub85d\ud55c \uc0ac\uc9c4\uc740 \uc544\ub798 \uacb0\uacfc\uc5d0\uc11c \ud655\uc778\ud560 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4."],manual_sync:o["\ucc44\ub110 \uc989\uc2dc \ub3d9\uae30\ud654"]},l={boxImage:t.contextRoot+"resources/images/progressbar.gif",barImage:t.contextRoot+"resources/images/progressbg_green_200.gif",width:200,max:100},c=e.Model.extend({url:function(){return"/ad/api/account/photo/regist"}}),h=e.View.extend({id:"batch_photo_upload",tagName:"span",events:{"click.photoReg #add_photo":"uploadStart","click.photoReg span.ic_del":"deleteFile"},initialize:function(e){this.subject=e.subject,this.uploadUrl=e.uploadUrl,this.$el.on("orgChanged",_.bind(this.handleOrgChanged,this)),this.orgSyncable=t.config("orgSyncWaitMin")>0},render:function(){this.$el.html(r({lang:f,orgSyncable:this.orgSyncable})),this.orgSyncButton=new a({description:t.i18n(o["\uc870\uc9c1\uc77c\uad04\ub4f1\ub85d \ub3d9\uae30\ud654 \uc124\uba85"],{term:t.config("orgSyncWaitMin")})}),this.orgSyncButton.setElement(this.$("#manualSync")),this.orgSyncButton.render(),this.initFileUpload(),$("#photoResultDiv").hide()},deleteFile:function(){$("#fileComplete").html("")},uploadStart:function(){var e=this,n=$(':radio[name="photoType"]:checked').attr("id");if(!n)return $.goError(u["\uad6c\ubd84\uc744 \uc120\ud0dd \ud558\uc9c0 \uc54a\uc558\uc2b5\ub2c8\ub2e4."]),!1;if(!$("#file_name").val())return $.goError(o["\uc77c\uad04\ub4f1\ub85d \ud30c\uc77c \uc120\ud0dd"]),!1;var r=new c;$.goConfirm(u["\uc800\uc7a5\ud558\uc2dc\uaca0\uc2b5\ub2c8\uae4c?"],"",function(){r.set({fileName:$("#file_name").val(),filePath:$("#file_path").val(),hostId:$("#host_id").val(),signType:n},{silent:!0}),t.EventEmitter.trigger("common","layout:setOverlay",o["\ub85c\ub529\uc911"]),r.save({},{type:"PUT",success:function(n,r){t.EventEmitter.trigger("common","layout:clearOverlay",!0),r.code==200&&(e.$el.trigger("orgChanged"),$.goMessage(u["\uc800\uc7a5\uc774 \uc644\ub8cc\ub418\uc5c8\uc2b5\ub2c8\ub2e4."]),e.drawSuccessList(r.data),e.deleteFile())},error:function(n,r){return t.EventEmitter.trigger("common","layout:clearOverlay",!0),$.goError(o["\ub4f1\ub85d\uc5d0 \uc2e4\ud328\ud588\uc2b5\ub2c8\ub2e4."]),e.drawFileUploadFailView(r.data),e.deleteFile(),!1}})})},drawSuccessList:function(e){$("#photoResultDiv").show();var t="";t+='<li><span class="txt">'+o["\uc774\ubbf8\uc9c0 \ud30c\uc77c"]+" "+$("#file_name").val()+" "+o["\uc5c5\ub85c\ub4dc \uc644\ub8cc"]+"</span></li>",$("#photoResultDiv ul").empty(),$("#photoResultDiv ul").append(t);var n=!1;$.each(e,function(e,r){r.resultFlag?(t='<li><span class="txt">'+r.zipFileName+" "+s["\uc800\uc7a5"]+" ["+r.userName+" ] "+"</span></li>",n=!0):t='<li><span class="txt">'+r.zipFileName+" "+s["\uc2e4\ud328"]+"</span></li>",$("#photoResultDiv ul").append(t)}),this.orgSyncButton.$el.toggle(n)},drawFileUploadFailView:function(e){$("#photoResultDiv").show();var t='<li><span class="txt">'+o["\uc774\ubbf8\uc9c0 \ud30c\uc77c"]+" "+$("#file_name").val()+" "+o["\uc5c5\ub85c\ub4dc \uc2e4\ud328"]+"</span></li>";$("#photoResultDiv ul").empty().append(t)},initFileUpload:function(){var e={el:"#swfupload-control",context_root:t.contextRoot,button_text:"<span class='buttonText'>"+o["\ud30c\uc77c \ucc3e\uae30"]+"</span>",accept:".zip",progressBarUse:!0,url:"ad/api/file?GOAdminSSOcookie="+$.cookie("GOAdminSSOcookie")};(new i(e)).queue(function(e,t){}).start(function(e,t){var n=new RegExp("(.zip)","gi"),r=t.type.toLowerCase();if(!n.test(r))return $.goAlert(u["zip \ud30c\uc77c\ub9cc \ub4f1\ub85d \uac00\ub2a5\ud569\ub2c8\ub2e4."]),$("#progressbar").hide(),!1}).progress(function(e,t){}).success(function(e,r,i){if(t.util.fileUploadErrorCheck(r))return $.goAlert(t.util.serverMessage(r)),!1;$("#photoResultDiv").hide();var o=r.data;o.fileSize=t.util.getHumanizedFileSize(o.fileSize),o.deleteTxt=s["\uc0ad\uc81c"],$("#fileComplete").html(n({data:o}))}).complete(function(e,t){}).error(function(e,t){})},release:function(){this.$el.off(),this.$el.empty()},handleOrgChanged:function(){this.orgSyncButton.disable()}});return h});