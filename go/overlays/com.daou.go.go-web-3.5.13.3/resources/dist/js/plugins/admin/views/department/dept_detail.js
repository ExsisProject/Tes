(function(){define(["jquery","backbone","app","hogan","admin/models/department","system/models/licenseModel","admin/models/system_menu_list","admin/views/department/dept_org_member_duty","admin/views/department/dept_org_member_type","admin/views/department/dept_detail_contact","hgn!admin/templates/department/dept_detail","hgn!admin/templates/department/dept_detail_info","i18n!admin/nls/admin","i18n!nls/commons","i18n!board/nls/board","i18n!report/nls/report","i18n!task/nls/task","i18n!approval/nls/approval","jquery.go-grid","jquery.go-popup","jquery.go-orgslide","jquery.go-validation","GO.util","jquery.ajaxmock"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g){var y=GO.contextRoot+"ad/api/department/",b={locale_ko:h.KO,locale_en:h.EN,locale_jp:h.JP,locale_zhcn:h["ZH-CN"],locale_zhtw:h["ZH-TW"],locale_vi:h.VI,info_add:h["\ud56d\ubaa9\ucd94\uac00"],none:p["\uc5c6\uc74c"],save:p["\uc800\uc7a5"],cancel:p["\ucde8\uc18c"],edit:p["\uc218\uc815"],default_info:h["\uae30\ubcf8\uc815\ubcf4"],return_to_list:h["\ubaa9\ub85d\uc73c\ub85c \ub3cc\uc544\uac00\uae30"],dept_member_list:h["\ubd80\uc11c\uc6d0 \ubaa9\ub85d"],dept_member_add:h["\ubd80\uc11c\uc6d0 \ucd94\uac00"],dept_member_delete:h["\ubd80\uc11c\uc6d0 \uc81c\uc678"],dept_member_delete_desc:h["\ubd80\uc11c\uc6d0 \uc81c\uc678?"],list_to_csv:h["\ubaa9\ub85d \ub2e4\uc6b4\ub85c\ub4dc"],member_name_position:h["\uc774\ub984(\uc9c1\uc704)"],member_email:p["\uc774\uba54\uc77c"],dept_duty:h["\ubd80\uc11c \ub0b4 \uc9c1\ucc45"],member_last_login:h["\ucd5c\uc885 \ub85c\uadf8\uc778"],member_type:h["\uba64\ubc84\ud0c0\uc785"],dept_files:h["\ubd80\uc11c \uc790\ub8cc"],dept_name:h["\ubd80\uc11c\uba85"],dept_mail_id:h["\ubd80\uc11c\uba54\uc77c\uc544\uc774\ub514"],dept_code:h["\ubd80\uc11c\ucf54\ub4dc"],dept_alias:h["\ubd80\uc11c\uc57d\uc5b4"],created_at:h["\uc0dd\uc131\uc77c"],used_total:h["\uc0ac\uc6a9\ub7c9"],parent_dept:h["\uc0c1\uc704 \ubd80\uc11c"],child_dept:h["\ud558\uc704 \ubd80\uc11c"],dept_delete:h["\ubd80\uc11c \uc0ad\uc81c"],dept_delete_confirm:h["\ubd80\uc11c\uc0ad\uc81c?"],reorder:h["\uc21c\uc11c\ubc14\uafb8\uae30"],reorder_save:h["\uc21c\uc11c\ubc14\uafb8\uae30 \uc644\ub8cc"],dept_member_empty:h["\ub4f1\ub85d\ub41c \ubd80\uc11c\uc6d0\uc774 \uc5c6\uc2b5\ub2c8\ub2e4."],dept_amounts_empty:h["\ub4f1\ub85d\ub41c \ubd80\uc11c\uc790\ub8cc\uac00 \uc5c6\uc2b5\ub2c8\ub2e4."],dept_member_select_msg:h["\ubd80\uc11c\uc6d0\uc744\uc120\ud0dd\ud558\ub77c"],org_add_desc:h["\ubd80\uc11c\uc6d0 \ucd94\uac00 \uc124\uba85"],dept_mail_id_desc:h["\ubd80\uc11c \uba54\uc77c \uc544\uc774\ub514 \uc124\uba85"],dept_code_desc:h["\ubd80\uc11c \ucf54\ub4dc \uc124\uba85"],dept_alias_desc:h["\ubd80\uc11c \uc57d\uc5b4 \uc124\uba85"],org_master_changed:h["\ubd80\uc11c\uc7a5 \ubcc0\uacbd"],none:h["\ubbf8\uc9c0\uc815"],dept_member_sortable_msg:h["\ubd80\uc11c\uc6d0 \uc21c\uc11c\ubcc0\uacbd"],already_added_member:h["\uc774\ubbf8 \ubd80\uc11c\uc6d0\uc73c\ub85c \uc9c0\uc815 \ub418\uc5b4 \uc788\uc2b5\ub2c8\ub2e4."],delete_success:p["\uc0ad\uc81c\ub418\uc5c8\uc2b5\ub2c8\ub2e4."],dept_mail_invalid_msg:h["\uc0ac\uc6a9\ud560 \uc218 \uc5c6\ub294 \uc774\uba54\uc77c\uc785\ub2c8\ub2e4."],mb:h.MB,org:h["\ubd80\uc11c\uc6d0 \ucd94\uac00"],check_validation:p["0\uc790\uc774\uc0c1 0\uc774\ud558 \uc785\ub825\ud574\uc57c\ud569\ub2c8\ub2e4."],dept_code_invalid_msg:h["\uc0ac\uc6a9\ud560 \uc218 \uc5c6\ub294 \ubd80\uc11c\ucf54\ub4dc\uc785\ub2c8\ub2e4."],dept_code_already_msg:h["\uc774\ubbf8 \uc0ac\uc6a9\uc911\uc778 \ubd80\uc11c\ucf54\ub4dc\uc785\ub2c8\ub2e4."],dept_alias_invalid_msg:h["\uc0ac\uc6a9\ud560 \uc218 \uc5c6\ub294 \ubd80\uc11c\uc57d\uc5b4\uc785\ub2c8\ub2e4."],MASTER:h["\ubd80\uc11c\uc7a5"],MODERATOR:h["\ubd80\ubd80\uc11c\uc7a5"],MEMBER:h["\ubd80\uc11c\uc6d0"],count:h["\uac1c"],total_dept:h["\ucd1d \ubd80\uc11c \uc218"],dept_unit:h["\ub2e8\uc704 \ubd80\uc11c"],root_dept_name:h["\uc0c1\uc704 \ubd80\uc11c\uba85"],dept_manager:h["\ubd80\uc11c\uc7a5"],dept_manager_name:h["\ubd80\uc11c\uc7a5 \uc774\ub984"],dept_member:h["\ubd80\uc11c\uc6d0(\uba85)"],dept_sub:h["\ud558\uc704\ubd80\uc11c(\uac1c)"],dept_createat:h["\uc0dd\uc131\uc77c"],dept_usage:h["\uc0ac\uc6a9\ub7c9(MB)"],move_to_org:h["\uc870\uc9c1\ub3c4\uc5d0\uc11c \ubd80\uc11c \ucd94\uac00\ud558\uae30"],list_to_csv:h["\ubaa9\ub85d \ub2e4\uc6b4\ub85c\ub4dc"],search:p["\uac80\uc0c9"],board:p["\uac8c\uc2dc\ud310"],size:h["\uc0ac\uc6a9\ub7c9(MB)"],docCount:h["\ubb38\uc11c \uac1c\uc218"],share:h["\uacf5\uc720"],title:p["\uc81c\ubaa9"],type:h["\uad6c\ubd84"],migration_board:p["\uac8c\uc2dc\ud310 \uc774\uad00"],migration_report:p["\ubcf4\uace0\uc11c \uc774\uad00"],migration_task:p["\ud3f4\ub354 \uc774\uad00"],migration_approval:h["\ubb38\uc11c\ud568 \uc774\uad00"],move_dept_folder:h["[\ubd80\uc11c \ubb38\uc11c\ud568 \uad00\ub9ac]\ub85c \uc774\ub3d9"],check_box_alert:h["\ubd80\uc11c \uc790\ub8cc\ub97c \uc120\ud0dd\ud574\uc8fc\uc138\uc694."],approval:p["\uc804\uc790\uacb0\uc7ac"],task:h["\uc5c5\ubb34"],report:h["\ubcf4\uace0"],board:p["\uac8c\uc2dc\ud310"],save_success:p["\uc800\uc7a5\ub418\uc5c8\uc2b5\ub2c8\ub2e4."],closed:h["\uc911\uc9c0"],normal:p["\uc815\uc0c1"],total:p["\uc804\uccb4"],contact:p["\uc8fc\uc18c\ub85d"],multi_lang:h["\ub2e4\uad6d\uc5b4"],open:p["\uc5f4\uae30"],close:p["\ub2eb\uae30"]},w=t.View.extend({loaderClass:"img_loader_large",memberEl:null,filesEl:null,events:{'click a[data-type="move_dept"]':"pageMoveByDeptId",'click a[data-type="move_upper"]':"pageMoveUpperByDeptId",'click span.btn_box[data-btntype="changeform"]':"changeModifyForm","click span#btnPageReset":"resetDeptInfo","click span#btnPagePut":"putDeptInfo","click ul.tab_menu li":"changeTabs","click span#btnMultiLang":"toggleMultiLang"},initialize:function(e){this.options=e||{},this.deptId=this.options.deptId,this.isOpenLang=!1;var n=new t.Model;n.url=GO.contextRoot+"ad/api/systeminfo",n.fetch({async:!1}),this.systemInfo=n.toJSON(),this.licenseInfo=s.read(),this.model=new i,this.model.clear(),this.model.set("id",this.deptId,{silent:!0}),this.model.fetch({async:!1})},render:function(){return this.renderDeptInfo(),this},toggleMultiLang:function(){var e=this.$el.find("span#btnMultiLang i");e.hasClass("ic_accordion_s")?(this.isOpenLang=!0,e.removeClass("ic_accordion_s").addClass("ic_accordion_c").attr("title",b.close),this.$el.find('tr[id$="NameInput"]').show()):(this.isOpenLang=!1,e.removeClass("ic_accordion_c").addClass("ic_accordion_s").attr("title",b.open),this.$el.find('tr[id$="NameInput"]').hide())},renderDeptInfo:function(){var t=this.model.toJSON(),n=!1,r=this.systemInfo.language;this.licenseInfo.get("approvalServicePack")&&(n=!0),this.$el.html(c({lang:b,data:t,isRootDept:!t.parent,additions:t.additions,isKoLocale:r=="ko",isEnLocale:r=="en",isJpLocale:r=="ja",isZhcnLocale:r=="zhcn",isZhtwLocale:r=="zhtw",isViLocale:r=="vi",isOpenLang:this.isOpenLang,total:function(){return GO.util.byteToMega(t.totalSize)},dateformat:function(){return GO.util.shortDate(t.createdAt)},hasMasterName:function(){return this.masterName!=""},hasApprovalServicePack:n})),e("#more_name option").size()==1&&e("#more_name").hide()},resetDeptInfo:function(){this.$el.find("#btnActionGroup").hide(),this.renderDeptInfo()},changeModifyForm:function(t){var n=e(t.currentTarget).parent(),r=this.$el.find("#btnActionGroup");if(n&&n.attr("data-formname")){e(t.currentTarget).hide(),n.html(['<input type="input" name="',n.attr("data-formname"),'" class="input" value="',n.attr("data-value"),'" />'].join("")).find("input").focusin();if(n.attr("data-formname")=="emailId"){var i=n.parent().find("#deptDetailEmailValidate");n.find("input").keyup(function(t){e("span.go_alert").empty();var n="";e(t.currentTarget).val()?e.goValidation.isValidEmailId(e(t.currentTarget).val())||(n=b.dept_mail_invalid_msg):n="",i.html(n)})}r.css("display")=="none"&&r.show()}},pageMoveByDeptId:function(t){var n=e(t.currentTarget).attr("data-id");n&&e("#orgMemTree").jstree("get_selected").length>0&&e("#orgMemTree").jstree("open_node",e("#orgMemTree").jstree("get_selected"),function(){e("#orgMemTree").find("a[nodeid="+n+"][rel!='MODERATOR'][rel!='MEMBER'][rel!='MASTER']").trigger("click")})},pageMoveUpperByDeptId:function(t){var n=e(t.currentTarget).attr("data-id");n&&e("#orgMemTree").jstree("get_selected").length>0&&e("#orgMemTree").find("a[nodeid="+n+"][rel!='MODERATOR'][rel!='MEMBER'][rel!='MASTER']").trigger("click")},putDeptInfo:function(){var t=this,n=t.model.clone(),r=t.model.get("additions");this.$el.find("span.go_alert").html(""),this.validate();var i=["koName","enName","jpName","zhcnName","zhtwName","viName"];e.each(e("table.table_form_mini :input").serializeArray(),function(n,s){t.model.set(s.name,s.value),_.contains(i,s.name)&&(r[s.name]=e.trim(s.value))}),t.model.set("additions",r),this.model.save({},{success:function(n,r){if(r.code==200){t.$el.trigger("orgChanged"),e.goMessage(b.save_success);var i=e("#orgMemTree").jstree("get_selected").parents("li:eq(0)");i.length>0&&e("#orgMemTree").jstree("refresh",i),t.resetDeptInfo(),GO.EventEmitter.trigger("admin","refreshHeader",n.id)}},error:function(r,i){var s=JSON.parse(i.responseText);e.goMessage(s.message),t.model=n}})},validate:function(){var t=new E;this._validationName(t),this._validationMultiName(t),this._validationEmail(t),this._validationCode(t),this._validationAlias(t);if(t.hasError())throw e.each(t.getErrors(),function(e,t){e==0&&t.el.focus(),t.el.parents(":first").parents(":first").append("<span class='go_alert'>"+t.message+"</span>")}),new Error(400,"validate error")},_validationName:function(t){var r=this.$el.find("input[name='name']");r.length>0&&(e.trim(r.val())==""?t.add(r,p["\ud544\uc218\ud56d\ubaa9\uc744 \uc785\ub825\ud558\uc9c0 \uc54a\uc558\uc2b5\ub2c8\ub2e4."]):e.goValidation.isCheckLength(1,64,r.val())||t.add(r,n.i18n(b.check_validation,{arg1:"1",arg2:"64"})))},_validationMultiName:function(t){var r=this.$el.find("input[name='koName']"),i=r.val();i!=undefined&&i.length>0&&(e.goValidation.isCheckLength(2,64,i)||t.add(r,n.i18n(b.check_validation,{arg1:"2",arg2:"64"})));var s=this.$el.find("input[name='enName']"),o=s.val();o!=undefined&&o.length>0&&(e.goValidation.isCheckLength(2,64,o)||t.add(s,n.i18n(b.check_validation,{arg1:"2",arg2:"64"})));var u=this.$el.find("input[name='jpName']"),a=u.val();a!=undefined&&a.length>0&&(e.goValidation.isCheckLength(2,64,a)||t.add(u,n.i18n(b.check_validation,{arg1:"2",arg2:"64"})));var f=this.$el.find("input[name='zhcnName']"),l=f.val();l!=undefined&&l.length>0&&(e.goValidation.isCheckLength(2,64,l)||t.add(f,n.i18n(b.check_validation,{arg1:"2",arg2:"64"})));var c=this.$el.find("input[name='zhtwName']"),h=c.val();h!=undefined&&h.length>0&&(e.goValidation.isCheckLength(2,64,h)||t.add(c,n.i18n(b.check_validation,{arg1:"2",arg2:"64"})))},_validationEmail:function(t){var r=this.$el.find("input[name='emailId']");r.val()!=undefined&&r.val().length>0&&(e.goValidation.isCheckLength(1,32,r.val())?e.goValidation.isValidEmailId(r.val())||t.add(r,n.i18n(b.dept_mail_invalid_msg)):t.add(r,n.i18n(b.check_validation,{arg1:"1",arg2:"32"})))},_validationCode:function(t){var r=this.$el.find("input[name='code']");r.val()!=undefined&&r.val().length>0&&(e.goValidation.isCheckLength(1,32,r.val())?e.goValidation.isInvalidSrc(r.val())&&t.add(r,n.i18n(b.dept_code_invalid_msg)):t.add(r,n.i18n(b.check_validation,{arg1:"1",arg2:"32"})))},_validationAlias:function(t){var r=this.$el.find("input[name='deptAlias']");r.val()!=undefined&&r.val().length>0&&(e.goValidation.isCheckLength(1,20,r.val())?e.goValidation.isInvalidSrc(r.val())&&t.add(r,b.dept_alias_invalid_msg):t.add(r,n.i18n(b.check_validation,{arg1:"1",arg2:"20"})))}}),E=t.View.extend({initialize:function(){this.errors=[]},add:function(t,n){var r=typeof t=="string"?e(t):t;this.errors.push({el:r,message:n})},hasError:function(){return this.errors.length>0},getErrors:function(){return this.errors}});return w})}).call(this);