(function(){define(["jquery","backbone","app","hgn!admin/templates/password_config","i18n!nls/commons","i18n!admin/nls/admin","jquery.go-validation","jquery.go-popup","jquery.go-validation"],function(e,t,n,r,i,s){var o={label_copy:i["\ubcf5\uc0ac"],label_ok:i["\uc800\uc7a5"],label_cancel:i["\ucde8\uc18c"],label_title:s["\ubcf4\uc548 \uc124\uc815"],label_pwd_manage:s["\ube44\ubc00\ubc88\ud638 \uad00\ub9ac"],label_min_length:s["\ube44\ubc00\ubc88\ud638 \ucd5c\uc18c \uae38\uc774"],label_max_length:s["\ube44\ubc00\ubc88\ud638 \ucd5c\ub300 \uae38\uc774"],label_mandatory:s["\ud544\uc218\ud3ec\ud568 \ubb38\uc790"],label_num:s["\uc22b\uc790"],label_blank:s["\uacf5\ubc31"],label_symbol:s["\ud2b9\uc218\ubb38\uc790"],label_taboo:s["\uc0ac\uc6a9\uae08\uc9c0 \ubb38\uc790"],label_name:i["\uc774\ub984"],label_id:s["\uc544\uc774\ub514"],label_same:s["\ub3d9\uc77c\ubb38\uc790"],label_over:s["\uac1c \uc774\uc0c1"],label_serial:s["\uc5f0\uc18d\ubb38\uc790"],label_input:s["\uc9c1\uc811\uc785\ub825"],label_desc:s["\u203b \uae08\uc9c0\ubb38\uc790\ub294 \ud55c\uc904\uc5d0 \ud55c \uac1c\uc529 \uc785\ub825"],label_perior:s["\ube44\ubc00\ubc88\ud638 \ubcc0\uacbd \uc8fc\uae30"],label_non:s["\uc9c0\uc815\ud558\uc9c0 \uc54a\uc74c"],label_month:s["\uac1c\uc6d4"],label_use:s["\uc0ac\uc6a9\ud568"],label_notuse:i["\uc0ac\uc6a9\ud558\uc9c0 \uc54a\uc74c"],label_fail:s["\ube44\ubc00\ubc88\ud638 \uc624\ub958 \uc124\uc815"],label_fail_count:s["\ube44\ubc00\ubc88\ud638 \uc5f0\uc18d\uc624\ub958"],label_count:s["\ud68c"],label_min:s["\ubd84"],label_select:s["\uc0ac\uc6a9\uc5ec\ubd80"],label_alert:s["\uc785\ub825\uac12\uc740 0~0\uc774\uc5b4\uc57c \ud569\ub2c8\ub2e4."],label_reuse:s["\uc774\uc804 \ube44\ubc00\ubc88\ud638 \uc7ac\uc0ac\uc6a9"],label_enable:i["\ud5c8\uc6a9"],label_disable:i["\ud5c8\uc6a9\ud558\uc9c0 \uc54a\uc74c"],label_limit_password_reuse_count_desc:s["\uc774\uc804 \ube44\ubc00\ubc88\ud638 \uc7ac\uc0ac\uc6a9 \uc124\uba85"],label_time:s["\ud68c"],label_last:s["\ucd5c\uadfc"],label_within:s["\uc774\ub0b4"],label_first_login:s["\uccab \ub85c\uadf8\uc778"],label_force_change:s["\uac15\uc81c \ubcc0\uacbd"],label_force_change_desc:s["\uac15\uc81c \ubcc0\uacbd \uc124\uba85"],label_on:i["\uc0ac\uc6a9"],label_off:i["\uc0ac\uc6a9\ud558\uc9c0 \uc54a\uc74c"],label_password_force_chage_all:s["\uc804\uccb4 \uc0ac\uc6a9\uc790 \ube44\ubc00\ubc88\ud638 \uc7ac\uc124\uc815"],label_password_force_chage_all_tip:s["\uc804\uccb4 \uc0ac\uc6a9\uc790 \ube44\ubc00\ubc88\ud638 \uc7ac\uc124\uc815 \uc124\uba85"],label_resetting:s["\uc7ac\uc124\uc815"],label_Alphabet:s["\ubb38\uc790"],label_password_change:s["\ube44\ubc00\ubc88\ud638 \ubcc0\uacbd"],label_password_change_guide:s["\ube44\ubc00\ubc88\ud638 \uac15\uc81c \ubcc0\uacbd \uc720\ub3c4"],label_last_change_time:s["\ub9c8\uc9c0\ub9c9 \uc124\uc815 \uc2dc\uac04"],label_reset_title:s["\ucd08\uae30\ud654 \ube44\ubc00\ubc88\ud638 \uc124\uc815"],label_password:s["\ube44\ubc00\ubc88\ud638"],label_reset_pwd_desc:s["\ucd08\uae30\ud654 \ube44\ubc00\ubc88\ud638 \uc124\uba85"],label_use_captcha:s["\uc790\ub3d9\uc785\ub825 \ubc29\uc9c0\ubb38\uc790 \uc0ac\uc6a9"],label_captcha_desc:s["\uc790\ub3d9\uc785\ub825 \ubc29\uc9c0\ubb38\uc790 \uc124\uba85"],label_request_change_password:s["\ube44\ubc00\ubc88\ud638 \uac15\uc81c \ubcc0\uacbd"],label_request_change_password_tip:s["\ube44\ubc00\ubc88\ud638 \uac15\uc81c \ubcc0\uacbd \uc124\uba85"],characters:s["\uc790"]},u=n.BaseView.extend({initialize:function(){this.model=new t.Model,this.isServiceMode=GO.session().serviceAdminMode,this.model.url="/ad/api/passwordconfig",this.model.fetch({async:!1})},events:{"click span#btn_ok":"confirmSave","click span#btn_cancel":"passwordConfigCancel","click form[name='formPaswordConfig'] input:checkbox":"toggleCheckbox","click form[name='formPaswordConfig'] input:radio":"toggleRadio","click span#data":"changeModifyForm","click span.btn_box[data-btntype='changeform']":"changeModifyForm","click #pwd_force_resetting":"pwdForceResetting","focusout input[type='input']":"inputValidator","focusout textarea":"inputValidator","keyup #passwordWrap input[type='input']":"keyupValidator","keyup #passwordWrap textarea":"keyupValidator","submit form":"formSubmit","change input[name=passwordReuse]":"toggleReuse"},render:function(){var t=this,n=this.model.toJSON(),i=r({lang:o,selectMonth:[{value:"1"},{value:"2"},{value:"3"},{value:"4"},{value:"5"},{value:"6"},{value:"7"},{value:"8"},{value:"9"},{value:"10"},{value:"11"},{value:"12"}],selectCount:[{value:"3"},{value:"4"},{value:"5"},{value:"6"},{value:"7"},{value:"8"},{value:"9"},{value:"10"}],selectTime:[{value:"10"},{value:"15"},{value:"20"},{value:"25"},{value:"30"},{value:"35"},{value:"40"},{value:"45"},{value:"50"},{value:"55"},{value:"60"}],LimitPasswordReuseCount:[{value:"1"},{value:"2"},{value:"3"},{value:"4"},{value:"5"},{value:"6"},{value:"7"},{value:"8"},{value:"9"},{value:"10"}],model:n,isServiceMode:this.isServiceMode,lastChangeTime:this.getLastChangeTime()});this.$el.html(i);var s=["failCount","changePeriod"];return e.each(s,function(e,n){t.$el.find("#"+n).val(t.model.get(n))}),t.model.get("useSystemPasswordRules")?(t.$el.find("#mandatory_value").text(this.getMandatoryValueForSystem()),t.$el.find("#taboo_value").text(this.getTabooValueForSystem()),t.model.get("usePasswordConfig")?(e('select[name="changePeriod"]').attr("disabled",!1),e('input[name="passwordForcedChange"]').attr("disabled",!1)):(e('select[name="changePeriod"]').attr("disabled",!0),e('input[name="passwordForcedChange"]').attr("disabled",!0))):(t.model.get("tabooCharSame")||e("span#sameCharLength").hide(),t.model.get("tabooCharSerial")||e("span#serialCharLength").hide(),t.model.get("tabooCharInput")||e("span#inputChar").hide(),t.model.get("useCaptcha")?e('select[name="failCount"]').attr("disabled",!1):e('select[name="failCount"]').attr("disabled",!0),t.model.get("usePasswordConfig")?this.usePasswordConfigTrue():this.usePasswordConfigFalse(),this.renderReuse()),this},getMandatoryValueForSystem:function(){var e=[];return this.model.get("mandatoryCharNumber")&&e.push({label:s["\uc22b\uc790"],value:this.model.get("mandatoryCharNumber")}),this.model.get("mandatoryCharBlank")&&e.push({label:s["\uacf5\ubc31"],value:this.model.get("mandatoryCharBlank")}),this.model.get("mandatoryCharAlphabet")&&e.push({label:s["\ubb38\uc790"],value:this.model.get("mandatoryCharAlphabet")}),this.model.get("mandatoryCharSymbol")&&e.push({label:s["\ud2b9\uc218\ubb38\uc790"],value:this.model.get("mandatoryCharSymbol")}),_.map(e,function(e){return e.label}).join(", ")},getTabooValueForSystem:function(){var e=[];return this.model.get("tabooCharName")&&e.push({label:i["\uc774\ub984"],value:this.model.get("tabooCharName")}),this.model.get("tabooCharId")&&e.push({label:s["\uc544\uc774\ub514"],value:this.model.get("tabooCharId")}),this.model.get("tabooCharSame")&&e.push({label:s["\ub3d9\uc77c\ubb38\uc790"],value:this.model.get("tabooCharSame"),length:this.model.get("sameCharLength")}),this.model.get("tabooCharSerial")&&e.push({label:s["\uc5f0\uc18d\ubb38\uc790"],value:this.model.get("tabooCharSerial"),length:this.model.get("serialCharLength")}),this.model.get("tabooCharInput")&&e.push({label:s["\uc9c1\uc811\uc785\ub825"],value:this.model.get("tabooCharInput"),inputChar:this.model.get("inputChar")}),_.map(e,function(e){return e.label===s["\ub3d9\uc77c\ubb38\uc790"]||e.label===s["\uc5f0\uc18d\ubb38\uc790"]?e.label+" "+e.length+s["\uac1c \uc774\uc0c1"]:e.label===s["\uc9c1\uc811\uc785\ub825"]?e.label+"("+e.inputChar+")":e.label}).join(", ")},formSubmit:function(e){e.stopPropagation();return},getLastChangeTime:function(){var e=this.model.toJSON().pwdForcedChangeAll;return e==undefined||e==""?i["\uc5c6\uc74c"]:e.substring(0,e.lastIndexOf(":"))},renderReuse:function(){this.model.get("passwordReuse")||this.$("#limitPasswordReuseCount").val(this.model.get("limitPasswordReuseCount"))},toggleReuse:function(t){t.stopPropagation();var n=!GO.util.toBoolean(e(t.currentTarget).val());this.$("#limitPasswordReuseCount").toggle(n)},keyupValidator:function(t){t.stopPropagation();var n=t.currentTarget.id,r=e(t.currentTarget).parent(),i=r.parent().parent().find(".go_alert");i.html("");if(n!="inputChar"&&!(t.keyCode>=96&&t.keyCode<=105||t.keyCode>=48&&t.keyCode<=57||t.keyCode==46||t.keyCode==13||t.keyCode==8))return i.html(s["\uc22b\uc790\ub9cc \uc785\ub825\ud558\uc138\uc694."]),t.currentTarget.value="",!1},inputValidator:function(t){t.stopPropagation();var r=t.currentTarget.value,i=t.currentTarget.id,u=e(t.currentTarget).parent(),a=e("input#tabooCharSame").is(":checked"),f=e("input#tabooCharSerial").is(":checked"),l=e("input#tabooCharInput").is(":checked"),c=u.parent().parent().find(".go_alert");c.html("");if(i=="minPasswordLength"){var h=e("div.maxPasswordLength").children().attr("data-value");if(r<8||r>15)return c.html(n.i18n(o.label_alert,{arg1:"8",arg2:"15"})),t.currentTarget.focus(),t.currentTarget.value="",!1;if(parseInt(r)>=parseInt(h))return c.html(s["\ucd5c\ub300\uac12\ubcf4\ub2e4 \ud070\uacbd\uc6b0 \uacbd\uace0"]),t.currentTarget.focus(),t.currentTarget.value="",!1;u.attr("data-value",r)}if(i=="maxPasswordLength"){var p=e("div.minPasswordLength").children().attr("data-value");if(r<9||r>16)return c.html(n.i18n(o.label_alert,{arg1:"9",arg2:"16"})),t.currentTarget.focus(),t.currentTarget.value="",!1;if(parseInt(r)<=parseInt(p))return c.html(s["\ucd5c\uc18c\uac12\ubcf4\ub2e4 \uc791\uc740\uacbd\uc6b0 \uacbd\uace0"]),t.currentTarget.focus(),t.currentTarget.value="",!1;u.attr("data-value",r)}if(a&&i=="sameCharLength"||f&&i=="serialCharLength")if(r<3||r>6)return c.html(n.i18n(o.label_alert,{arg1:"3",arg2:"6"})),t.currentTarget.focus(),t.currentTarget.value="",!1;if(l&&i=="inputChar"&&!e.goValidation.isCheckLength(0,100,r))return c.html(n.i18n(s["0\uc790\uc774\uc0c1 0\uc774\ud558 \uc785\ub825\ud574\uc57c\ud569\ub2c8\ub2e4."],{arg1:"1",arg2:"100"})),t.currentTarget.focus(),t.currentTarget.value="",!1;if(i=="resetPassword"){if(r.length==0)return;if(!e.goValidation.isCheckLength(4,16,r))return c.html(n.i18n(s["0\uc790\uc774\uc0c1 0\uc774\ud558 \uc785\ub825\ud574\uc57c\ud569\ub2c8\ub2e4."],{arg1:"4",arg2:"16"})),t.currentTarget.focus(),t.currentTarget.value="",!1}},changeModifyForm:function(t){t.stopPropagation();var n=e(t.currentTarget).parent();n.children().toggle(),n.find("input").focus()},makeOriginalInputData:function(){e('input[id="minPasswordLength"]').val(this.model.get("minPasswordLength")),e('[data-formname = "minPasswordLength"]').attr("data-value",this.model.get("minPasswordLength")),e('input[id="maxPasswordLength"]').val(this.model.get("maxPasswordLength")),e('[data-formname = "maxPasswordLength"]').attr("data-value",this.model.get("maxPasswordLength")),e('textarea[id="inputChar"]').val(this.model.get("inputChar")),e('[data-formname = "inputChar"]').attr("data-value",this.model.get("inputChar")),e('input[id="sameCharLength"]').val(this.model.get("sameCharLength")),e('[data-formname = "sameCharLength"]').attr("data-value",this.model.get("sameCharLength")),e('input[id="serialCharLength"]').val(this.model.get("serialCharLength")),e('[data-formname = "serialCharLength"]').attr("data-value",this.model.get("serialCharLength"))},usePasswordConfigTrue:function(){e(".minPasswordLength").attr("style",""),e(".maxPasswordLength").attr("style",""),e("#tabooCharInput").is(":checked")&&e("span#inputChar").attr("style",""),e("#tabooCharSame").is(":checked")&&e("span#sameCharLength").attr("style",""),e("#tabooCharSerial").is(":checked")&&e("span#serialCharLength").attr("style",""),e("textarea").attr("style",""),e('select[name="changePeriod"]').attr("disabled",!1),e("#tabooCharInput").attr("disabled",!1),e("#tabooCharSerial").attr("disabled",!1),e("#tabooCharSame").attr("disabled",!1),e("#tabooCharName").attr("disabled",!1),e("#tabooCharId").attr("disabled",!1),e("#mandatoryCharNumber").attr("disabled",!1),e("#mandatoryCharBlank").attr("disabled",!1),e("#mandatoryCharAlphabet").attr("disabled",!1),e("#mandatoryCharSymbol").attr("disabled",!1),e('input[name="passwordReuse"]').attr("disabled",!1),e('input[name="passwordForcedChange"]').attr("disabled",!1),e.each(e("#first_tr").siblings(),function(t,n){e(n).attr("style",""),e("#first_tr").removeClass("last")})},usePasswordConfigFalse:function(){e(".minPasswordLength").attr("style","display:none"),e(".maxPasswordLength").attr("style","display:none"),e("span#inputChar").attr("style","display:none"),e("span#sameCharLength").attr("style","display:none"),e("span#serialCharLength").attr("style","display:none"),e("textarea").attr("style","display:none"),e('select[name="changePeriod"]').attr("disabled",!0),e("#tabooCharInput").attr("disabled",!0),e("#tabooCharSerial").attr("disabled",!0),e("#tabooCharSame").attr("disabled",!0),e("#tabooCharName").attr("disabled",!0),e("#tabooCharId").attr("disabled",!0),e("#mandatoryCharNumber").attr("disabled",!0),e("#mandatoryCharBlank").attr("disabled",!0),e("#mandatoryCharAlphabet").attr("disabled",!0),e("#mandatoryCharSymbol").attr("disabled",!0),e('input[name="passwordReuse"]').attr("disabled",!0),e('input[name="passwordForcedChange"]').attr("disabled",!0),e.each(e("#first_tr").siblings(),function(t,n){e(n).attr("style","display:none"),e("#first_tr").addClass("last")})},toggleRadio:function(t){t.stopPropagation(),e(t.currentTarget).attr("value")=="true"&&e(t.currentTarget).attr("name")=="useCaptcha"?e('select[name="failCount"]').attr("disabled",!1):e(t.currentTarget).attr("value")=="false"&&e(t.currentTarget).attr("name")=="useCaptcha"?e('select[name="failCount"]').attr("disabled",!0):e(t.currentTarget).attr("value")=="true"&&e(t.currentTarget).attr("name")=="usePasswordConfig"?this.usePasswordConfigTrue():e(t.currentTarget).attr("value")=="false"&&e(t.currentTarget).attr("name")=="usePasswordConfig"&&(this.usePasswordConfigFalse(),this.makeOriginalInputData(),e.goAlert(s["\ube44\ubc00\ubc88\ud638 \uad00\ub9ac\ub97c \uc0ac\uc6a9\ud558\uc9c0 \uc54a\ub294 \uacbd\uc6b0, \ubcf4\uc548\uc5d0 \ucde8\uc57d\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4."],"","",i["\ud655\uc778"]))},toggleCheckbox:function(t){t.stopPropagation(),e(t.currentTarget).is(":checked")?(e(t.currentTarget).val(!0),e(t.currentTarget).attr("checked",!0),e(t.currentTarget).is(':checkbox[name="tabooCharSame"]')?e("span#sameCharLength").show():e(t.currentTarget).is(':checkbox[name="tabooCharSerial"]')?e("span#serialCharLength").show():e(t.currentTarget).is(':checkbox[name="tabooCharInput"]')&&e("span#inputChar").show()):(e(t.currentTarget).val(!1),e(t.currentTarget).attr("checked",!1),e(t.currentTarget).is(':checkbox[name="tabooCharSame"]')?e("span#sameCharLength").hide():e(t.currentTarget).is(':checkbox[name="tabooCharSerial"]')?e("span#serialCharLength").hide():e(t.currentTarget).is(':checkbox[name="tabooCharInput"]')&&e("span#inputChar").hide())},passwordConfigSave:function(){var t=this,n=this.$el.find("form[name=formPaswordConfig]");e.each(n.serializeArray(),function(e,n){t.model.set(n.name,n.value,{silent:!0})}),e.each(e(n.find('input[type="checkbox"]')).filter(function(t){return e(this).prop("checked")===!1}),function(e,n){t.model.set(n.name,n.value,{silent:!0})}),GO.util.preloader(this.model.save({},{success:function(n,r){r.code=="200"&&(e.goMessage(i["\uc800\uc7a5\ub418\uc5c8\uc2b5\ub2c8\ub2e4."]),t.render())},error:function(t,n){var r=JSON.parse(n.responseText);e.goAlert(i["\uc2e4\ud328"],r.message)}}))},passwordConfigCancel:function(t){t.stopPropagation();var n=this;e.goCaution(i["\ucde8\uc18c"],i["\ubcc0\uacbd\ud55c \ub0b4\uc6a9\uc744 \ucde8\uc18c\ud569\ub2c8\ub2e4."],function(){n.render(),e.goMessage(i["\ucde8\uc18c\ub418\uc5c8\uc2b5\ub2c8\ub2e4."])},i["\ud655\uc778"])},confirmSave:function(t){t.stopPropagation();if(!this.model.get("useSystemPasswordRules")){if(e("#usePasswordConfig_false").is(":checked")){this.passwordConfigSave();return}var n=this,r=e("#mandatoryCharNumber").is(":checked")?!0:!1,o=e("#mandatoryCharBlank").is(":checked")?!0:!1,u=e("#mandatoryCharAlphabet").is(":checked")?!0:!1,a=e("#mandatoryCharSymbol").is(":checked")?!0:!1,f=e("#tabooCharSame").is(":checked")?!0:!1,l=e("#tabooCharSerial").is(":checked")?!0:!1,c=e("#tabooCharInput").is(":checked")?!0:!1,h=e("#tabooCharName").is(":checked")?!0:!1,p=e("#tabooCharId").is(":checked")?!0:!1,d=e('textarea[name="inputChar"]');if(c&&d.length>0){var v=e.trim(d.val());if(_.isEmpty(v))return e.goMessage(s["\uc81c\ud55c \uac12\uc744 \uc785\ub825\ud558\uc138\uc694."]),d.focus(),!1}r||o||u||a||f||l||c||h||p?this.passwordConfigSave():e.goConfirm(s["\ud544\uc218\ud3ec\ud568 \ubb38\uc790 \ub610\ub294 \uc0ac\uc6a9\uae08\uc9c0 \ubb38\uc790\ub97c \uc124\uc815\ud558\uc9c0 \uc54a\uc73c\uba74 \ubcf4\uc548\uc5d0 \ucde8\uc57d\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4."]+"<br>"+s["\uc800\uc7a5\ud558\uc2dc\uaca0\uc2b5\ub2c8\uae4c?"],"",function(){n.passwordConfigSave()},i["\ud655\uc778"],function(){})}else this.passwordConfigSave()},pwdForceResetting:function(t){t.stopPropagation();var n=e.goConfirm(s["\uc804\uccb4 \uc0ac\uc6a9\uc790\uc758 \ube44\ubc00\ubc88\ud638\ub97c \uc7ac\uc124\uc815\ud558\uac8c \ud655\uc778"],"",function(){e.ajax({type:"GET",dataType:"json",url:GO.contextRoot+"ad/api/passwordconfig/pwdforcedall",success:function(t){e.goMessage(i["\uc800\uc7a5\ub418\uc5c8\uc2b5\ub2c8\ub2e4."]);var n=t.data.pwdForcedChangeAll;e("#lastChangeTime").text(n.substring(0,n.lastIndexOf(":")))},error:function(t){e.goError(t.responseJSON.message)}})},i["\ud655\uc778"]);n.css("width","440px")}});return u})}).call(this);