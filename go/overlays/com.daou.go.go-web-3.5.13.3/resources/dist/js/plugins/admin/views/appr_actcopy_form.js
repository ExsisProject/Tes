(function(){define(["jquery","backbone","app","i18n!nls/commons","i18n!admin/nls/admin","i18n!approval/nls/approval","admin/views/appr_form_template_editor","admin/views/admin_doc_type_select","approval/views/security_level_list","hgn!admin/templates/actcopy_form","hgn!admin/templates/appr_form_template_editor","jquery.go-sdk","jquery.jstree","jquery.go-popup","jquery.go-grid","jquery.go-orgslide","jquery.go-validation"],function(e,t,n,r,i,s,o,u,a,f,l){var c,h={head_title:i["\uacb0\uc7ac \uc591\uc2dd \ucd94\uac00"],caption:i["\ub4f1\ub85d\uc815\ubcf4"],title:r["\uc81c\ubaa9"],description:i["\uc591\uc2dd\uc124\uba85"],form_name:r["\uc81c\ubaa9"],alias:i["\uc591\uc2dd\uc57d\uc5b4"],edit_template:i["\uc591\uc2dd \ud3b8\uc9d1"],template_editor:r["\uc591\uc2dd \ud3b8\uc9d1\uae30"],template_preview:r["\ubbf8\ub9ac\ubcf4\uae30"],company_doc_folder:i["\uc804\uc0ac \ubb38\uc11c\ud568 \ubcf4\uad00 \ud3f4\ub354"],state:i["\uc0ac\uc6a9\uc5ec\ubd80"],hidden:i["\uc228\uae40"],normal:i["\uc815\uc0c1"],preserve_in_year:s["\ubcf4\uc874\uc5f0\ud55c"],security_level:i["\ubcf4\uc548\ub4f1\uae09"],empty_msg:i["\ub4f1\ub85d\ub41c \uc591\uc2dd\uc774 \uc5c6\uc2b5\ub2c8\ub2e4."],creation_success_msg:i["\uc800\uc7a5\ub418\uc5c8\uc2b5\ub2c8\ub2e4. \uc591\uc2dd \ubaa9\ub85d\uc73c\ub85c \uc774\ub3d9\ud569\ub2c8\ub2e4."],creation_fail_msg:i["\uc800\uc7a5\ud560 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4."],cancel_and_go_to_list_msg:i["\ucde8\uc18c\ud558\uc168\uc2b5\ub2c8\ub2e4. \uc774\uc804 \ud654\uba74\uc73c\ub85c \uc774\ub3d9\ud569\ub2c8\ub2e4."],name_required:i["\uc81c\ubaa9\uc744 \uc785\ub825\ud558\uc138\uc694."],duplicated_name:i["\uc81c\ubaa9\uc774 \uc911\ubcf5\ub418\uc5c8\uc2b5\ub2c8\ub2e4."],alias_required:i["\uc591\uc2dd\uc57d\uc5b4\ub97c \uc785\ub825\ud558\uc138\uc694."],name_invalid_length:i["\uc81c\ubaa9\uc740 20\uc790\uae4c\uc9c0 \uc785\ub825\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4."],alias_invalid_length:i["\uc57d\uc5b4\ub294 20\uc790\uae4c\uc9c0 \uc785\ub825\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4."],description_invalid_length:i["\uc591\uc2dd\uc124\uba85\uc740 500\uc790\uae4c\uc9c0 \uc785\ub825\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4."],folder_required:i["\uc804\uc0ac \ubb38\uc11c\ud568 \ud3f4\ub354\uac00 \uc9c0\uc815\ub418\uc9c0 \uc54a\uc558\uc2b5\ub2c8\ub2e4."],year:s["\ub144"],forever:s["\uc601\uad6c"],modify:r["\uc218\uc815"],select:r["\uc120\ud0dd"],add:r["\ucd94\uac00"],"delete":r["\uc0ad\uc81c"],save:r["\uc800\uc7a5"],cancel:r["\ucde8\uc18c"]};return c=t.View.extend({el:"#layoutContent",templateEditorView:null,securityLevelsListView:null,model:null,initialize:function(e){this.model=e.model,this.templateEditorView=new o,this.initBindingEvents()},initBindingEvents:function(){this.$el.off("click","#load_template_editor"),this.$el.off("click","#preview_template"),this.$el.off("click","#save_btn"),this.$el.off("click","#cancel_btn"),this.$el.on("click","#load_template_editor",e.proxy(this._openTemplateEditor,this)),this.$el.on("click","#preview_template",e.proxy(this._previewTemplate,this)),this.$el.on("click","#docInfo_btn_edit",e.proxy(this._docTypeSelect,this)),this.$el.on("click","#docInfo_btn_delete",e.proxy(this._docTypeDelete,this)),this.$el.on("click","#save_btn",e.proxy(this._onSaveClicked,this)),this.$el.on("click","#cancel_btn",e.proxy(this._onCancelClicked,this))},render:function(){this.templateEditorView.setContent(this.model.get("templateHtml")),this.$el.html(f(this._makeTmplData(this.model))),this._rednerSecurityLevelListView(),e("#docInfo_txt_form").live("change",e.proxy(this._onChangeCompanyFolder,this)).trigger("change")},_makeTmplData:function(e){var t=_.map([1,3,5,0],function(t){return{value:t,label:t==0?h.forever:n.i18n(r["{{arg1}}\ub144"],{arg1:t}),isSelected:e.get("preserveDurationInYear")*1==t*1?!0:!1}}),i=function(){return function(e){return e.replace('value="'+this.state+'"','value="'+this.state+'" checked')}},s={lang:h,preserveYears:t,wrappedState:i};return _.extend(s,e.toJSON())},_rednerSecurityLevelListView:function(){this.securityLevelsListView=new a({el:this.$el.find("select[name=securityLevel]"),selectedData:this.model.get("securityLevel")}),this.securityLevelsListView.render()},_openTemplateEditor:function(){this.templateEditorView.render()},_previewTemplate:function(){this.templateEditorView.preview()},_docTypeSelect:function(){var t=this,n=e.goPopup({pclass:"layer_normal layer_approval_line_state",header:s["\ubb38\uc11c \ubd84\ub958 \uc120\ud0dd"],modal:!0,width:300,contents:"",buttons:[{btext:r["\ud655\uc778"],autoclose:!1,btype:"confirm",callback:function(e){var n=i.doc_type_confirm();if(!n)return!1;t.$el.find("#docInfo_txt_form").trigger("change"),e.close()}},{btext:r["\ucde8\uc18c"],btype:"cancel"}]}),i=new u;i.render(),n.reoffset()},_docTypeDelete:function(){e("#docInfo_txt_form").text(""),e("#docInfo_txt_form").attr("data-docTypeId",""),e("#docInfo_txt_form").trigger("change")},_onSaveClicked:function(){this.model.set("name",this.$el.find("input[name=name]").val()),this.model.set("alias",this.$el.find("input[name=alias]").val()),this.model.set("description",this.$el.find("textarea[name=description]").val()),this.model.set("preserveDurationInYear",this.$el.find("[name=preserveDurationInYear]").val()),this.model.set("state",this.$el.find("input[name=state]:checked").val()),this.model.set("templateHtml",this.templateEditorView.getContent()),this.model.set("securityLevel",this.securityLevelsListView.getSelectedData());var t=e("#docInfo_txt_form").attr("data-docTypeId");this.model.set("companyDocFolder",t?{id:t}:null);if(!this.model.isValid())return this.model.validationError=="name_invalid_length"||this.model.validationError=="name_required"?(e.goMessage(h[this.model.validationError]),this.$el.find(":input[name=name]").select()):this.model.validationError=="alias_invalid_length"||this.model.validationError=="alias_required"?(e.goMessage(h[this.model.validationError]),this.$el.find(":input[name=alias]").select()):this.model.validationError=="description_invalid_length"?(e.goMessage(GO.i18n(h[this.model.validationError],{arg1:"2",arg2:"255"})),this.$el.find(":input[name=description]").select()):e.goMessage(h[this.model.validationError]),!1;if(this.requestProcessing)return;this.requestProcessing=!0,this.model.save({},{success:e.proxy(function(t,n,r){e.goAlert(h.creation_success_msg,"",this._goToFormListView)},this),error:function(t,n,r){var i=h.creation_fail_msg;return _.contains(n.responseJSON.message,"duplication.name")&&(i=h.duplicated_name),e.goMessage(i),!1},complete:function(){this.requestProcessing=!1}})},_onChangeCompanyFolder:function(t){_.isEmpty(e(t.currentTarget).attr("data-docTypeId"))?e("#docInfo_txt_formAlert").text(h.folder_required):e("#docInfo_txt_formAlert").text("")},_onCancelClicked:function(){return e.goAlert(h.cancel_and_go_to_list_msg,"",e.proxy(this._goToFormListView,this)),!1},_goToFormListView:function(){return GO.router.navigate("approval/actcopyform",{trigger:!0}),!1}}),c})}).call(this);