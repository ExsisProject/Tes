define(function(require){var e=require("app"),t=require("i18n!nls/commons"),n=require("i18n!admin/nls/admin"),r=require("hgn!admin/templates/mobile_attach_config"),i=require("models/mobile_config"),s={label_ok:t["\uc800\uc7a5"],label_cancel:t["\ucde8\uc18c"],label_not_use:n["\uc0ac\uc6a9\uc548\ud568"],label_use:t["\uc0ac\uc6a9"],label_attachment_download:n["\ucca8\ubd80\ud30c\uc77c \ub2e4\uc6b4\ub85c\ub4dc"],label_mobile_attach_config:n["\ubaa8\ubc14\uc77c \ucca8\ubd80\ud30c\uc77c \uc124\uc815"],label_pc_attach_config:n["PC\uba54\uc2e0\uc800 \ucca8\ubd80\ud30c\uc77c \uc124\uc815"],file_preview:n["\ucca8\ubd80\ud30c\uc77c \ubbf8\ub9ac\ubcf4\uae30"],label_chat_exclude_file:n["\ub300\ud654 \uc5c5\ub85c\ub4dc \ubd88\uac00 \ud30c\uc77c"],label_chat_upload_size_limit:n["\ub300\ud654 \uc5c5\ub85c\ub4dc \uc6a9\ub7c9 \uc81c\ud55c"],label_common_config:n["\uacf5\ud1b5 \uc124\uc815"],label_desc:n["\uc5c5\ub85c\ub4dc \uc81c\ud55c"],label_mb:n.MB,label_non_limit:n["\uc81c\ud55c\uc5c6\uc74c"],label_limit_size:n["\uc6a9\ub7c9\uc81c\ud55c"],label_under:n["\uc774\ud558"],label_attach_limit_desc:n["\ud30c\uc77c1\uac1c"]},o=Backbone.View.extend({events:{"click span#btn_ok":"_mobileAttachConfigSave","click span#btn_cancel":"_mobileAttachConfigCancel","click span.btn_box[data-btntype='changeform']":"_changeExcludeExtensionInput","click #size_false":"_hideSizeLimitForm","click #size_true":"_showSizeLimitForm","keyup span#maxAttachSize input":"_keyUpMaxAttachSize","keyup span#pcExcludeExtension input":"_keyUpExcludeExtension","keyup span#mobileExcludeExtension input":"_keyUpExcludeExtension"},initialize:function(){this.mobileConfigModel=new i({adminContext:!0}),this.mobileConfigModel.fetch({async:!1}),this.chatConfigModel=new Backbone.Model,this.chatConfigModel.url="/ad/api/chatconfig",this.chatConfigModel.fetch({async:!1})},render:function(){var e=this,t={mobileConfig:{},chatConfig:{}};t.mobileConfig=this.mobileConfigModel.toJSON(),t.chatConfig=this.chatConfigModel.toJSON(),this.$el.html(r({lang:s,model:t,hasMobileExcludeExtension:function(){return t.mobileConfig.excludeExtension==null||t.mobileConfig.excludeExtension==""?!1:!0},hasPcExcludeExtension:function(){return t.chatConfig.excludeExtension==null||t.chatConfig.excludeExtension==""?!1:!0}})),this.chatConfigModel.get("attachSizeLimit")||e._hideSizeLimitForm()},_mobileAttachConfigSave:function(e){e.stopPropagation();var n=this,r={useMobilePreview:$("form[name='formMobileAttachConfig'] input[name='mobilePreviewOption']:checked").val(),useMobileSecurity:$("form[name='formMobileAttachConfig'] input[name='mobileSecurityOption']:checked").val(),excludeExtension:n._getExcludeExtension("mobileExcludeExtension")},i={attachSizeLimit:$("form[name='formCommonConfig'] input[name='attachSizeLimit']:checked").val(),maxAttachSize:n._getMaxAttachSize(),excludeExtension:n._getExcludeExtension("pcExcludeExtension")};n.mobileConfigModel.save(r,{success:function(e,r){n.chatConfigModel.save(i,{success:function(e,r){$.goMessage(t["\uc800\uc7a5\ub418\uc5c8\uc2b5\ub2c8\ub2e4."]),n.render()},error:function(e,n){var r=JSON.parse(n.responseText);r.message!=null?$.goMessage(r.message):$.goMessage(t["\uc2e4\ud328\ud588\uc2b5\ub2c8\ub2e4."])}})},error:function(e,n){var r=JSON.parse(n.responseText);r.message!=null?$.goMessage(r.message):$.goMessage(t["\uc2e4\ud328\ud588\uc2b5\ub2c8\ub2e4."])}})},_getExcludeExtension:function(e){return e=="mobileExcludeExtension"?$("#mobileExcludeExtension span[id=mobileData]").text()!=""?$("#mobileExcludeExtension span[id=mobileData]").text():$("form[name='formMobileAttachConfig'] input[name='mobileExcludeExtension']").val():e=="pcExcludeExtension"?$("#pcExcludeExtension span[id=pcData]").text()!=""?$("#pcExcludeExtension span[id=pcData]").text():$("form[name='formPcAttachConfig'] input[name='pcExcludeExtension']").val():""},_getMaxAttachSize:function(){var e=$("form[name='formCommonConfig'] input[name='maxAttachSize']").val();return e!=""?e:this.chatConfigModel.get("maxAttachSize")},_mobileAttachConfigCancel:function(e){e.stopPropagation();var n=this;$.goCaution(t["\ucde8\uc18c"],t["\ubcc0\uacbd\ud55c \ub0b4\uc6a9\uc744 \ucde8\uc18c\ud569\ub2c8\ub2e4."],function(){n.render(),$.goMessage(t["\ucde8\uc18c\ub418\uc5c8\uc2b5\ub2c8\ub2e4."])},t["\ud655\uc778"])},_keyUpMaxAttachSize:function(e){if(!e.key.match(new RegExp("^[0-9]$"))&&e.keyCode!=8&&e.keyCode!=46){$("span#maxAttachSizeAlert").text(n["\uc22b\uc790\ub9cc \uc785\ub825\ud558\uc138\uc694."]),$("form[name='formCommonConfig'] input[name='maxAttachSize']").val("");return}if(e.currentTarget.value<1||e.currentTarget.value>999){$("span#maxAttachSizeAlert").text(n["1~999"]),$("form[name='formCommonConfig'] input[name='maxAttachSize']").val("");return}$("span#maxAttachSizeAlert").text("")},_keyUpExcludeExtension:function(e){var t=$("#"+e.currentTarget.name+"Alert");if(e.currentTarget.value.match(new RegExp("^[a-zA-Z0-9,]*$"))==null)return t.html(n["\uc601\uc5b4, \uc27c\ud45c, \uc22b\uc790\ub9cc \uc785\ub825\uac00\ub2a5"]),e.currentTarget.focus(),e.currentTarget.value="",!1;t.html("")},_showSizeLimitForm:function(e){$("#maxAttachSize").show(),$('input[name="maxAttachSize"]').focus()},_hideSizeLimitForm:function(e){$("#maxAttachSize").hide(),$("#maxAttachSizeAlert").html("")},_changeExcludeExtensionInput:function(e){var t=$(e.currentTarget).parent();$(e.currentTarget).hide(),t.html(['<input type="input" name="',t.attr("data-formname"),'" class="input w_large" value="',t.attr("data-value"),'" />'].join("")).find("input").focusin()}});return o});