define(function(require){var e=require("jquery"),t=require("backbone"),n=require("app"),r=require("i18n!nls/commons"),i=require("i18n!admin/nls/admin"),s=require("i18n!board/nls/board"),o=require("hgn!admin/templates/board_create"),u=require("admin/views/board_group_list"),a=require("admin/views/board_public_writer_group_list"),f=require("hgn!board/templates/board_create_manager"),l=require("hgn!admin/templates/board_modify"),c=require("admin/models/base_model"),h=require("hgn!board/templates/board_create_header"),p=require("admin/views/board_allow_ips");require("jquery.go-orgslide"),require("jquery.go-sdk"),require("jquery.go-validation"),require("jquery.go-popup");var d={anonym_flag:s["\uc775\uba85 \uc124\uc815"],anonym_tooltip:s["\uc775\uba85 \uc124\uc815 \ud234\ud301"],anonym_desc:s["\u203b \uc775\uba85 \uc124\uc815\uc740 \ub098\uc911\uc5d0 \ubcc0\uacbd\ud558\uc2e4 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4."],public_writer_for_post:s["\uac8c\uc2dc\ubb3c \uc791\uc131\uc790 \uacf5\uac1c \uc124\uc815 \ud5c8\uc6a9"],public_writer_for_post_comment:s["\ub313\uae00 \uc791\uc131\uc790 \uacf5\uac1c \uc124\uc815 \ud5c8\uc6a9"],all_user_option:i["\uc804\uccb4 \uc0ac\uc6a9\uc790"],specific_user_option:i["\uc77c\ubd80 \uc0ac\uc6a9\uc790"],company_board_add:i["\uc804\uc0ac \uac8c\uc2dc\ud310 \ucd94\uac00"],board_info:i["\uac8c\uc2dc\ud310 \ub4f1\ub85d\uc815\ubcf4"],board_title:i["\uac8c\uc2dc\ud310 \uc81c\ubaa9"],board_description:i["\uac8c\uc2dc\ud310 \uc124\uba85"],board_type:i["\uac8c\uc2dc\ud310 \uc720\ud615"],board_BBS:i["\ud074\ub798\uc2dd \ud0c0\uc785"],board_STREAM:i["\ud53c\ub4dc \ud0c0\uc785"],share_range:i["\uacf5\uac1c \ubc94\uc704"],share_public:i["\uacf5\uac1c (\uc4f0\uae30/\uc77d\uae30)"],share_private:r["\ube44\uacf5\uac1c"],board_manager:i["\uc6b4\uc601\uc790"],board_manager_select:i["\uc6b4\uc601\uc790 \ucd94\uac00"],board_save:r["\uc800\uc7a5"],board_cancel:r["\ucde8\uc18c"],board_add_cancel:r["\ucde8\uc18c"],"delete":r["\uc0ad\uc81c"],BBS:i["\ud074\ub798\uc2dd"],STREAM:i["\ud53c\ub4dc"],add_manager_alert:i["\uc5f4\ub78c\uc790\ub97c \ucd94\uac00\ud574\uc8fc\uc138\uc694."],org:i["\uc870\uc9c1\ub3c4"],company_board_setting:i["\uc804\uc0ac \uac8c\uc2dc\ud310 \uc124\uc815"],board_modify:r["\uc218\uc815"],service_status:i["\uc11c\ube44\uc2a4 \uc0c1\ud0dc"],service_active:i["\uc815\uc0c1"],service_closed:i["\uc911\uc9c0"],service_manager:i["\uad00\ub9ac\uc790"],me:i["\ub098"],read:i["\uc77d\uae30"],write:i["\uc4f0\uae30"],modify:r["\uc218\uc815"],del:r["\uc0ad\uc81c"],position:i["\uc9c1\uc704"],grade:i["\uc9c1\uae09"],duty:i["\uc9c1\ucc45"],usergroup:i["\uc0ac\uc6a9\uc790\uadf8\ub8f9"],no_title:i["\uc81c\ubaa9\uc774 \uc5c6\uc2b5\ub2c8\ub2e4."],alert_length:i["0\uc790\uc774\uc0c1 0\uc774\ud558 \uc785\ub825\ud574\uc57c\ud569\ub2c8\ub2e4."],board_delete:i["\uac8c\uc2dc\ud310 \uc0ad\uc81c"],alert_delete:i["\uac8c\uc2dc\ud310 \uc0ad\uc81c \ud655\uc7782"],header_use:r["\uc0ac\uc6a9"],header_not_use:r["\uc0ac\uc6a9\ud558\uc9c0 \uc54a\uc74c"],header:i["\ub9d0\uba38\ub9ac"],header_placeholder:i["\ub9d0\uba38\ub9ac\uba85 \uc785\ub825"],header_add:i["\ub9d0\uba38\ub9ac \ucd94\uac00"],header_subject:i["\ub9d0\uba38\ub9ac \uc81c\ubaa9"],modify_done:r["\uc218\uc815\uc644\ub8cc"],comment_flag:i["\ub313\uae00 \uc791\uc131"],comment_flag_true:r["\ud5c8\uc6a9"],comment_flag_false:r["\ud5c8\uc6a9\ud558\uc9c0 \uc54a\uc74c"],header_required_option:i["\uac8c\uc2dc\ubb3c \ub4f1\ub85d\uc2dc \ubc18\ub4dc\uc2dc \uc120\ud0dd\ud558\uac8c \ud568"],notification:i["\uc54c\ub9bc \uae30\ub2a5"],board_new:i["\uc0c8\uae00\uc774 \ub4f1\ub85d\ub418\uba74 \uc54c\ub9bc \ubc1c\uc1a1"],board_update:i["\uac8c\uc2dc\uae00\uc774 \uc218\uc815\ub41c \uacbd\uc6b0\ub3c4 \uc54c\ub9bc \ubc1c\uc1a1"],all_user:i["\ubaa8\ub4e0 \uc0ac\uc6a9\uc790\uc5d0\uac8c \uc54c\ub9bc\uc774 \ubc1c\uc1a1\ub429\ub2c8\ub2e4."],send_mail_flag_title:r["\uba54\uc77c\ubc1c\uc1a1 \ud0c0\uc774\ud2c0\uc5b4\ub4dc\ubbfc"],send_mail_flag_tooltip:r["\uba54\uc77c\ubc1c\uc1a1 \ud234\ud301"],yes_value:r["\uc608"],no_value:r["\uc544\ub2c8\uc624"],board_group:s["\uac8c\uc2dc\ud310\uadf8\ub8f9"],select_group:s["\uac8c\uc2dc\ud310\uadf8\ub8f9 \uc120\ud0dd"],duplicatePermission:i["\uc774\ubbf8 \ucd94\uac00\ub41c \uc5f4\ub78c\uc790 \uc785\ub2c8\ub2e4."],add_user:i["\uc0ac\uc6a9\uc790 \ucd94\uac00"]},v=null,m=t.View.extend({unbindEvent:function(){this.$el.off("click","input[name=share]:radio"),this.$el.off("click","span[data-btntype='publicDelete']"),this.$el.off("click","#selectManager"),this.$el.off("click","ul.name_tag li span.ic_del"),this.$el.off("click","span.btn[data-btntype='submit']"),this.$el.off("click","span.btn[data-btntype='modify']"),this.$el.off("click","span.btn_nega[data-btntype='cancel']"),this.$el.off("click","span.editable .btn_box"),this.$el.off("click","span.btn_nega[data-btntype='modifyCancel']"),this.$el.off("click","span.editWrap"),this.$el.off("click","input[name=anonymFlag]:radio"),this.$el.off("click","input[name=type]:radio"),this.$el.off("click","input[name=headerFlag]:radio"),this.$el.off("click","#headerAdd"),this.$el.off("click","span[data-btntype='headerModify']"),this.$el.off("click","span.headerText"),this.$el.off("click","span[data-btntype='headerSave']"),this.$el.off("click","span[data-btntype='headerDelete']"),this.$el.off("click","span[data-btntype='headerCancel']"),this.$el.off("keyup","input#headerName"),this.$el.off("keyup","input#headerName"),this.$el.off("keyup","span.headerInputPart input:text"),this.$el.off("click",".btn-add-select-node"),this.$el.off("click","input#publicWriterSettingForPost"),this.$el.off("click","input#publicWriterSettingForPostComment"),this.$el.off("click","input[name=targetForPost]:radio"),this.$el.off("click","input[name=targetForPostComment]:radio"),this.$el.off("click","#addPostGroup"),this.$el.off("click","#addPostCommentGroup")},bindEvent:function(){this.$el.on("click","input[name=share]:radio",e.proxy(this.togglePublicRadio,this)),this.$el.on("click","span[data-btntype='publicDelete']",e.proxy(this.deletePublicRange,this)),this.$el.on("click","#selectManager",e.proxy(this.addManager,this)),this.$el.on("click","ul.name_tag li span.ic_del",e.proxy(this.deleteMember,this)),this.$el.on("click","span.btn[data-btntype='submit']",e.proxy(this.createCompanyBoard,this)),this.$el.on("click","span.btn[data-btntype='modify']",e.proxy(this.modifyCompanyBoard,this)),this.$el.on("click","span.btn_nega[data-btntype='cancel']",e.proxy(this.cancelCompanyBoard,this)),this.$el.on("click","span.editable .btn_box",e.proxy(this.modifyFormTrans,this)),this.$el.on("click","span.btn_nega[data-btntype='modifyCancel']",e.proxy(this.cancelModifyCompanyBoard,this)),this.$el.on("click","span.editWrap",e.proxy(this.modifyTextFormTrans,this)),this.$el.on("click","input[name=anonymFlag]:radio",e.proxy(this.toggleAnonymFlag,this)),this.$el.on("click","input[name=type]:radio",e.proxy(this.toggleBoardType,this)),this.$el.on("click","input[name=headerFlag]:radio",e.proxy(this.toggleHeaderFlag,this)),this.$el.on("click","#headerAdd",e.proxy(this.headerAdd,this)),this.$el.on("click","span[data-btntype='headerModify']",e.proxy(this.headerModify,this)),this.$el.on("click","span.headerText",e.proxy(this.headerModify,this)),this.$el.on("click","span[data-btntype='headerSave']",e.proxy(this.headerSave,this)),this.$el.on("click","span[data-btntype='headerDelete']",e.proxy(this.headerDelete,this)),this.$el.on("click","span[data-btntype='headerCancel']",e.proxy(this.headerCancel,this)),this.$el.on("keyup","input#headerName",e.proxy(this.addHeaderLengthValidate,this)),this.$el.on("keyup","span.headerInputPart input:text",e.proxy(this.editHeaderLengthValidate,this)),this.$el.on("click",".btn-add-select-node",e.proxy(this._addChildNodesSelect,this)),this.$el.on("click","#publicWriterSettingForPost",e.proxy(this.togglePublicWriterForPost,this)),this.$el.on("click","#publicWriterSettingForPostComment",e.proxy(this.togglePublicWriterForPostComment,this)),this.$el.on("click","input[name=targetForPost]:radio",e.proxy(this.togglePublicWriterPostGroup,this)),this.$el.on("click","input[name=targetForPostComment]:radio",e.proxy(this.togglePublicWriterPostCommentGroup,this)),this.$el.on("click","#addPostGroup",e.proxy(this.addAnonymousTargetForm,this,"#postGroupWrap")),this.$el.on("click","#addPostCommentGroup",e.proxy(this.addAnonymousTargetForm,this,"#postCommentGroupWrap"))},initialize:function(e){this.options=e||{},this.boardId=this.options.boardId,this.unbindEvent(),this.bindEvent()},render:function(){var e;if(this.boardId){this.boardModel=new c({id:this.boardId,urlRoot:n.contextRoot+"ad/api/board"}),this.boardModel.fetch({async:!1}),this.boardData=this.boardModel.toJSON();var t=function(){return this.type=="STREAM"?d.STREAM:d.BBS},r=function(){return this.anonymFlag?d.header_use:d.header_not_use},i=function(){return this.type=="CLASSIC"?!0:!1},s=function(){return _.isArray(this.pathName)&&this.pathName.length>0?n.util.escapeXssFromHtml(this.pathName.join(" &gt; ")):!1};e=l({dataset:this.boardData,boardType:t,isAnonym:r,lang:d,boardTypeByHeader:i,pathInfo:s}),this.$el.html(e),this.setBoardModifyDate(this.boardData),this.allowIp=new p({appName:"board",targetId:this.boardData.id}),this.$el.find("#ipConfigDiv").html(this.allowIp.render().el)}else e=o({lang:d}),this.$el.html(e),this.toggleBoardType(),this.allowIp=new p({appName:"board",targetId:0}),this.$el.find("#ipConfigDiv").html(this.allowIp.render().el)},toggleAnonymFlag:function(){var t=this.$el.find("input[name=anonymFlag]:radio:checked").val(),n=this.$el.find("#notiFlag"),r=e("#boardManagerList").closest("tr"),i=this.$el.find("#anonymFlagOption");t=="true"?(n.hide(),r.addClass("last"),i.show()):(n.show(),r.removeClass("last"),i.hide())},togglePublicWriterForPost:function(){var t=this.$el.find("div[name=publicWriterDetailForPost]");e("#publicWriterSettingForPost").is(":checked")?t.show():t.hide()},togglePublicWriterForPostComment:function(){var t=this.$el.find("div[name=publicWriterDetailForPostComment]");e("#publicWriterSettingForPostComment").is(":checked")?t.show():t.hide()},togglePublicWriterPostGroup:function(t){var n=this.$el.find("input[name=targetForPost]:radio:checked").val();n=="false"?(e("#postGroupWrap").show(),e("#addPostGroup").show()):(e("#postGroupWrap").hide(),e("#addPostGroup").hide())},togglePublicWriterPostCommentGroup:function(t){var n=this.$el.find("input[name=targetForPostComment]:radio:checked").val();n=="false"?(e("#postCommentGroupWrap").show(),e("#addPostCommentGroup").show()):(e("#postCommentGroupWrap").hide(),e("#addPostCommentGroup").hide())},addAnonymousTargetForm:function(t){var s=[],o=[],u=[],a=e("#partPublicWrap").parent().find("#groupUl li");_.each(a,function(t){!e(t).attr("data-type")&&e(t).attr("data-code")?s.push(e(t).attr("data-code")):e(t).attr("data-type")&&e(t).attr("data-type")=="User"&&e(t).attr("data-code")?u.push(e(t).attr("data-code")):e(t).attr("data-type")&&e(t).attr("data-type")=="Department"&&e(t).attr("data-code")&&e(t).attr("data-sharedtype")&&("NONE"==e(t).attr("data-sharedtype")?o.push(""+e(t).attr("data-code")):o.push(""+e(t).attr("data-code")+e(t).attr("data-sharedtype")))});var f=this.$el.find(t).find("ul"),l=this,c=this.$el.find("input[name=share]:radio:checked").val();c=="true"&&a.length!=0?e.goOrgSlide({type:"complex",desc:"",includeLoadIds:s,userIds:u,depts:o,contextRoot:n.contextRoot,callback:e.proxy(function(e){l.addAnonymousTarget(e,f)}),isAdmin:!0,searchPlaceHolder:r["\uc774\ub984"]+"/"+r["\uc544\uc774\ub514"]}):e.goOrgSlide({header:i["\uc0ac\uc6a9\uc790 \ucd94\uac00"],desc:"",contextRoot:n.contextRoot,callback:e.proxy(function(e){l.addAnonymousTarget(e,f)}),isAdmin:!0}),e("div.layer_organogram").css("z-index","100")},addAnonymousTarget:function(t,n){var r=1,s="NONE";if(this.isDuplicatedId(n,t.id))throw e.goMessage(d.duplicatePermission),new Error;var o=i["\uc0ac\uc6a9\uc790"],u="";u="<li data-code='"+t.id+"' data-type='User' data-permission='"+r+"' data-sharedType ='"+s+"'>"+"<span class='name'>"+t.displayName+"</span>"+"<span class='btn_wrap'><span class='ic ic_del' title='"+d.del+"' data-btntype='publicDelete'></span></span>"+"</li>",n.addClass("name_tag").append(u)},isDuplicatedId:function(t,n){var r=t.find("li"),i=!1;return r.each(function(){var t=e(this);if(parseInt(t.attr("data-code"))==parseInt(n))return i=!0,!1}),i},toggleBoardType:function(){var e=this.$el.find("input[name=type]:radio:checked").val(),t=this.$el.find("#headerPartWrapTr");e=="CLASSIC"?t.show():t.hide()},toggleHeaderFlag:function(){var e=this.$el.find("input[name=headerFlag]:radio:checked").val(),t=this.$el.find("#headerFlagOption");e=="true"?(t.show(),this.sortableHeaderFlag()):t.hide()},sortableHeaderFlag:function(){this.$el.find("#headerListPart").sortable({delay:100,axis:"y",items:"tr",hoverClass:"headerText"}),this.$el.find("#headerListPart").disableSelection()},headerAdd:function(){var t=this.$el.find("#headerName"),n=e.trim(t.val()),r=!1;if(!n)return t.focus(),!1;this.$el.find('tr[data-type="headerPart"]').each(function(){if(e(this).attr("data-headername")==n){e(this).attr("data-headerdeleteflag","false"),e(this).show(),e("#headerName").val(""),r=!0;return}});if(!r){var i=[];i.push({name:n});var s=h({dataset:i,lang:d,headerLength:function(){return e.goValidation.realLength(this.name)}});e("#headerListPart").append(s),e("#headerName").val(""),e("#headerByte").html("0")}},headerModify:function(t){var n=e(t.currentTarget).parents("tr").first();return n.find("span.headerTextPart").hide().end().find("span.headerInputPart").show(),!1},headerSave:function(t){var n=e(t.currentTarget).parent(),r=n.parents("tr").first(),i=n.siblings("input").val(),s=r.find("span.headerText");return r.attr("data-headername",i),r.find("span.headerTextPart").show(),s.html(i),r.find("span.headerInputPart").hide(),!1},headerCancel:function(t){var n=e(t.currentTarget).parents("tr").first();return n.find("span.headerTextPart").show(),n.find("span.headerInputPart").hide(),!1},headerDelete:function(t){var n=e(t.currentTarget),r=n.parents("tr").first();r.attr("data-headerdeleteflag","true"),r.hide()},headerLengthValidate:function(t,n,r){var i=e.goValidation.realLength(t.val());parseInt(i)>n?t.val(t.attr("data-value")):(typeof r=="function"&&r(i),t.attr("data-value",t.val()))},addHeaderLengthValidate:function(){var t=e("#headerName"),n=30,r=function(e){var n=t.closest("div");n.find("#headerByte").text(e)};this.headerLengthValidate(t,n,r)},editHeaderLengthValidate:function(t){var n=e(t.currentTarget),r=30,i=function(e){var t=n.closest("span.headerInputPart");t.find("#headerByte").text(e)};this.headerLengthValidate(n,r,i)},cancelModifyCompanyBoard:function(){n.router.navigate("/board/manage",!0)},modifyTextFormTrans:function(t){var n=e(t.currentTarget);n.attr("data-type")=="title"?n.parent().parent().append('<input class="w_half input" type="text" id="title" value="'+n.html()+'"/>'):n.parent().parent().append('<textarea class="w_full input" id="description">'+n.html()+"</textarea>"),this.$el.find("span.btn_box").hide(),n.hide()},modifyFormTrans:function(t){var n=e(t.currentTarget),r=n.parent().parent().find("span.editWrap");r.attr("data-type")=="title"?n.parent().parent().append('<input class="w_half input" type="text" id="title" value="'+r.html()+'"/>'):n.parent().parent().append('<textarea class="w_full input" id="description">'+r.html()+"</textarea>"),n.parent().parent().find("span.editWrap").hide(),n.hide()},setBoardModifyDate:function(t){var n=this;this.$el.find('input[name="status"][value="'+t.status+'"]').attr("checked",!0),e.each(t.managers,function(e,t){n.setManager(t)}),this.$el.find('input[name="share"][value="'+t.sharedFlag+'"]').attr("checked",!0),t.sharedFlag&&(e("#partPublicWrap").show(),this.$el.find("#partPublicWrap").parent().find("#groupUl").show(),u.render({id:"#partPublicWrap",type:"add"}),e.each(t.owners,function(e,t){n.setJointOwners(t)}));if(t.anonymFlag&&t.anonymousWriterPostOption.allowed&&!t.anonymousWriterPostOption.allUser){var r=n.$el.find("#postGroupWrap").find("#groupUl");e.each(t.anonymousWriterPostOption.specificUsers,function(e,t){r.append(n.createliListForAllowedAnonymousWriter(t))})}if(t.anonymFlag&&t.anonymousWriterPostCommentOption.allowed&&!t.anonymousWriterPostCommentOption.allUser){var i=n.$el.find("#postCommentGroupWrap").find("#groupUl");e.each(t.anonymousWriterPostCommentOption.specificUsers,function(e,t){i.append(n.createliListForAllowedAnonymousWriter(t))})}this.$el.find('input[name="commentFlag"][value="'+t.commentFlag+'"]').attr("checked",!0),this.$el.find('input[name="sendMailFlag"][value="'+t.sendMailFlag+'"]').attr("checked",!0),t.headerFlag&&this.$el.find('input[name="headerFlag"][value="true"]').attr("checked",!0);if(t.postHeaders.length||t.headerFlag){this.toggleHeaderFlag(),this.$el.find('input[name="headerRequiredFlag"]').attr("checked",t.headerRequiredFlag);var s=h({dataset:t.postHeaders,lang:d,headerLength:function(){return e.goValidation.realLength(this.name)}});this.$el.find("#headerListPart").append(s),this.sortableHeaderFlag(),this.$el.find('#headerFlagOption tr[data-headerdeleteflag="true"]').hide()}t.notificationFlag&&this.$el.find("input#byNew").attr("checked",t.notificationFlag)},createliListForAllowedAnonymousWriter:function(e){var t="<li data-code='"+e.userId+"' data-type='"+e.type+"'>"+"<span class='name'>"+e.name+"</span>"+"<span class='btn_wrap'><span class='ic ic_del' title='"+d.del+"' data-btntype='publicDelete'></span></span>"+"</li>";return t},setManager:function(t){var n=e("#boardManagerList");t&&!n.find('li[data-id="'+t.id+'"]').length?n.find("li.creat").before(f(e.extend(t,{lang:d}))):e.goAlert(r["\uc624\ub958"],i["\uc774\ubbf8 \uc6b4\uc601\uc790\ub85c \uc9c0\uc815"])},setJointOwners:function(e){var t=this.$el.find("#partPublicWrap").parent().find("#groupUl"),n,r,s,o;if(e.ownerShip=="MASTER")return;e.permission=="3"?(r="3",s=d.read+"/"+d.write):(r="1",s=d.read),e.sharedType=="TO_SUB"?o="("+i["\ud558\uc704 \ubd80\uc11c \ud3ec\ud568"]+")":o="";var u=e.ownerInfo.split("|"),a=u[0],f=u[1];u[1]==undefined&&(f=u[0],e.ownerType=="User"?a=i["\uc0ac\uc6a9\uc790"]:e.ownerType=="Department"&&(a=i["\ubd80\uc11c"]));if(e.sharedType==undefined||e.sharedType==null)e.sharedType="NONE";n="<li data-code='"+e.ownerId+"' data-type='"+e.ownerType+"' data-sharedtype='"+e.sharedType+"' data-permission='"+r+"'>"+"<span class='major'>["+a+" : "+f+"]</span>"+"<span class='minor'>"+s+o+"</span>"+"<span class='btn_border'><span class='ic ic_delete' title='"+d.del+"' data-btntype='publicDelete'></span></span>"+"</li>",t.append(n)},setOwners:function(t){var r=[];r.push({ownerShip:"MASTER",ownerType:"Company",ownerId:n.session().companyId,scope:t=="true"?"PART":"ALL",permission:"3"});if(t=="true"){var i=e("#partPublicWrap").parent().find("#groupUl").find("li");if(i.length<1)return;i.each(function(){r.push({ownerShip:"JOINT",ownerType:e(this).attr("data-type")?e(this).attr("data-type"):"DomainCode",ownerId:e(this).attr("data-code"),scope:"ALL",permission:e(this).attr("data-permission"),sharedType:e(this).attr("data-sharedtype")?e(this).attr("data-sharedtype"):"NONE"})})}return r},setManagerIds:function(){var t=[],n=e("#boardManagerList").find("li[data-id]");return n.each(function(){t.push(e(this).attr("data-id"))}),t},getNotificationFlag:function(){var t="",n=e("input[name=anonymFlag]:radio:checked").val()=="true"?!0:!1;return this.boardId&&(n=this.boardData.anonymFlag),n?!1:e("input#byNew").is(":checked").toString()},createAnonymousOption:function(e,t,n){return{allowed:e,allUser:t,specificUsers:n}},createCompanyBoard:function(){var t=e("#title").val(),r=e("input[name=anonymFlag]:radio:checked").val(),s=e("#description").val(),o=e("input[name=type]:radio:checked").val(),u=e("input[name=sendMailFlag]:radio:checked").val(),a=e("input[name=commentFlag]:radio:checked").val(),f=[],l=[],c=e("input[name=share]:radio:checked").val(),h=this.getNotificationFlag();f=this.setOwners(c);var p=e("input[name=publicWriterSettingForPost]:checkbox").is(":checked")||!1,v=e("input[name=publicWriterSettingForPostComment]:checkbox").is(":checked")||!1,m=e("div[name=publicWriterDetailForPost]"),g=e("div[name=publicWriterDetailForPostComment]"),y=m.find("input[name=targetForPost]:radio:checked").val(),b=g.find("input[name=targetForPostComment]:radio:checked").val(),w=[];w=m.find("#groupUl").find("li");var E=[];w!=undefined&&w.length!=0&&w.each(function(){E.push({type:"User",typeId:e(this).attr("data-code"),userId:e(this).attr("data-code")})});var S=[];S=g.find("#groupUl").find("li");var x=[];S!=undefined&&S.length!=0&&S.each(function(){x.push({type:"User",typeId:e(this).attr("data-code"),userId:e(this).attr("data-code")})});var T=this.createAnonymousOption(p,y,E),N=this.createAnonymousOption(v,b,x);if(f==undefined||f.length==0){e.goMessage(i["\uacf5\uac1c \ubc94\uc704 \uc9c0\uc815"]);return}l=this.setManagerIds();if(e.trim(t)==""){e.goMessage(d.no_title);return}if(!e.goValidation.isCheckLength(2,64,t)){e.goMessage(n.i18n(d.alert_length,{arg1:"2",arg2:"64"})),e("#title").focus();return}if(e.trim(s)!=""&&!e.goValidation.isCheckLength(2,2e3,s)){e.goMessage(n.i18n(d.alert_length,{arg1:"2",arg2:"2000"})),e("#description").focus();return}var C=n.contextRoot+"ad/api/company/board",k={type:o,name:t,anonymFlag:r,commentFlag:a,description:s,sharedFlag:c,managerIds:l,owners:f,notificationFlag:h,sendMailFlag:u,anonymousWriterPostOption:T,anonymousWriterPostCommentOption:N},L=[],A="false",O="false",M="STREAM";A=this.$el.find("input[name=headerFlag]:radio:checked").val(),O=this.$el.find("input[name=headerRequiredFlag]").is(":checked"),M=this.$el.find("input[name=type]:radio:checked").val(),A=="true"&&M=="CLASSIC"&&(this.$el.find('tr[data-type="headerPart"]').each(function(t){L.push({id:e(this).attr("data-headerid"),name:e(this).attr("data-headername"),deletedFlag:e(this).attr("data-headerdeleteflag"),sortOrder:t})}),k.headerFlag=A,k.postHeaders=L,k.headerRequiredFlag=O);var _=this.$el.find(".select-node").last();_.length>0&&(k.parentId=_.val());var D=this;e.go(C,JSON.stringify(k),{qryType:"POST",contentType:"application/json",responseFn:function(e){e.code==200&&(D.allowIp.trigger("saveConfig",{targetId:e.data.id,appName:"BOARD"}),n.router.navigate("/board/manage",!0))},error:function(t){var n=JSON.parse(t.responseText);e.goMessage(n.message),n.name=="board.name.duplicated"&&D.$el.find("#title").focus()}})},modifyCompanyBoard:function(){var t=this,r=e("#boardId").val(),s=e("#title").val();s||(s=t.boardModel.get("name"));var o,u=e("#description");u?o=u.val():o=e("span.editWrap[data-type='description']").html();if(e.trim(s)==""){e.goMessage(d.no_title);return}if(!e.goValidation.isCheckLength(2,64,s)){e.goMessage(n.i18n(d.alert_length,{arg1:"2",arg2:"64"})),e("#title").focus();return}if(e.trim(o)!=""&&!e.goValidation.isCheckLength(2,2e3,o)){e.goMessage(n.i18n(d.alert_length,{arg1:"2",arg2:"2000"})),e("#description").focus();return}var a=[],f=[],l=e("input[name=share]:radio:checked").val(),c=e("input[name=commentFlag]:radio:checked").val(),h=e("input[name=sendMailFlag]:radio:checked").val(),p=this.getNotificationFlag();a=this.setOwners(l);if(a==undefined||a.length==0){e.goMessage(i["\uacf5\uac1c \ubc94\uc704 \uc9c0\uc815"]);return}f=this.setManagerIds();var v=e("input[name=publicWriterSettingForPost]:checkbox").is(":checked")||!1,m,g=[];if(v){var y=e("div[name=publicWriterDetailForPost]");m=y.find("input[name=targetForPost]:radio:checked").val();if(m=="false"){var b=[];b=y.find("#groupUl").find("li"),b!=undefined&&b.length!=0&&b.each(function(){g.push({type:"User",typeId:e(this).attr("data-code"),userId:e(this).attr("data-code")})})}}var w=this.createAnonymousOption(v,m,g),E=e("input[name=publicWriterSettingForPostComment]:checkbox").is(":checked")||!1,S,x=[];if(E){var T=e("div[name=publicWriterDetailForPostComment]");S=T.find("input[name=targetForPostComment]:radio:checked").val();var N=[];N=T.find("#groupUl").find("li"),N!=undefined&&N.length!=0&&N.each(function(){x.push({type:"User",typeId:e(this).attr("data-code"),userId:e(this).attr("data-code")})})}var C=this.createAnonymousOption(E,S,x),k="PUT",L=n.contextRoot+"ad/api/board/"+r,A={id:this.boardId,name:s,description:o,commentFlag:c,sharedFlag:l,managerIds:f,owners:a,notificationFlag:p,sendMailFlag:h,homeExposureFlag:t.boardData.homeExposureFlag,anonymousWriterPostOption:w,anonymousWriterPostCommentOption:C},O=[],M=this.$el.find("input[name=headerFlag]:radio:checked").val(),_=this.$el.find("input[name=headerRequiredFlag]").is(":checked"),D=0;M=="true"&&(this.$el.find('tr[data-type="headerPart"]').each(function(t){O.push({id:e(this).attr("data-headerid"),name:e(this).attr("data-headername"),deletedFlag:e(this).attr("data-headerdeleteflag"),sortOrder:t}),e(this).attr("data-headerdeleteflag")=="true"&&D++}),O.length-D<1&&(M=!1,_=!1),A.postHeaders=O),A.headerFlag=M,A.headerRequiredFlag=_,this.modifyAction(L,k,A),t.allowIp.trigger("saveConfig")},modifyAction:function(t,r,i){var s=this;e.go(t,JSON.stringify(i),{qryType:r,contentType:"application/json",responseFn:function(e){e.code==200&&n.router.navigate("/board/manage",!0)},error:function(t){var n=JSON.parse(t.responseText);e.goMessage(n.message),n.name=="board.name.duplicated"&&s.$el.find("#title").focus()}})},cancelCompanyBoard:function(){n.router.navigate("/board/manage",!0)},addManager:function(t){var r=this,i=e.goOrgSlide({header:d.board_manager_select,desc:"",callback:r.setManager,target:t,isAdmin:!0,contextRoot:n.contextRoot})},deleteMember:function(t){e(t.currentTarget).parents("li").remove()},deletePublicRange:function(t){e(t.currentTarget).parents("li").first().remove()},togglePublicRadio:function(t){var n=this.$el.find("input[name=share]:radio:checked").val();n=="true"?(e("#partPublicWrap").show(),this.$el.find("#partPublicWrap").parent().find("#groupUl").show(),u.render({id:"#partPublicWrap",type:"add"})):(e("#partPublicWrap").hide(),this.$el.find("#partPublicWrap").parent().find("#groupUl").hide())},addChildNodesSelect:function(){var t=this,r=".select-node",i=this.$(r).last(),o={};this.$(r).length>0&&(o.parentId=i.val()),e.ajax(n.config("contextRoot")+"ad/api/company/board/folders",{data:o,contentType:"application/json",dataType:"json"}).then(function(n){var r;if(n.data&&n.data.length===0){e.goSlideMessage(s["\uac8c\uc2dc\ud310\uadf8\ub8f9\uc774 \uc874\uc7ac\ud558\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4"]);return}r=t._makeSelectNode(n.data);if(i.length>0){var o=i.parent();o.nextAll(".wrap_select").remove(),o.after(r)}else t.$el.find(".btn-add-select-node").before(r)})},_addChildNodesSelect:function(e){this.addChildNodesSelect("company")},_makeSelectNode:function(t){var n=this.$(".select-node").length,r=n>1?n-1:1,i=e('<span class="wrap_select"><select name="parentId-'+r+'" class="select-node"></select></span>'),s=[];return _.each(t,function(e){var t=e.nodeValue||e.title||e.name;s.push(this._makeFolderOptionHtml(e.id,t))},this),i.find("select").html(s.join("\n")),i},_makeFolderOptionHtml:function(e,t,n){var r=n&&e===n?' selected="selected"':"";return'<option value="'+e+'"'+r+">"+t+"</option>"}});return m});