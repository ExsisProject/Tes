(function(){define(function(require){var e=require("backbone"),t=require("hogan"),n=require("i18n!admin/nls/admin");require("GO.util");var r={contact_title:n["\uadf8\ub8f9\uba85"],contact_count:n["\uc5f0\ub77d\ucc98 \uac1c\uc218"],migration:n["\uc8fc\uc18c\ub85d \uc774\uad00"],list_to_csv:n["\ubaa9\ub85d \ub2e4\uc6b4\ub85c\ub4dc"],dept_amounts_empty:n["\ub4f1\ub85d\ub41c \ubd80\uc11c\uc790\ub8cc\uac00 \uc5c6\uc2b5\ub2c8\ub2e4."],migration_info:n["\uc8fc\uc18c\ub85d {{arg1}}\ub85c \uc774\ub3d9"],migration_head:n["\uc8fc\uc18c\ub85d \uc774\uad00"]},i=["<div class='dataTables_wrapper'>","<div class='toolbar_top header_tb'>","<div class='critical'>","<span class='btn_tool' id='dept_data_migration'><span class='ic_adm ic_move'></span><span class='txt'>{{lang.migration}}</span></span>","</div><div class='optional'>","<span class='btn_tool' id='dept_data_down'><span class='ic_adm ic_down'></span><span class='txt'>{{lang.list_to_csv}}</span></span>","</div>","</div>","</div>","<div class='content_tb'><div class='dataTables_wrapper'>","<table class='chart size dataTable'>","<thead>","<tr>","<th class='sorting'><span class='title_sort'>{{lang.contact_title}}<ins class='ic'></ins><span class='selected'></span></span></th>","<th class='sorting_desc last'><span class='title_sort'>{{lang.contact_count}}<ins class='ic'></ins><span class='selected'></span></span></th>","</tr>","</thead>","</table>","</div></div>","</div>"].join(""),s=e.View.extend({events:{},initialize:function(e){this.deptId=e.id,this.events=$.extend({},e.__super__.events),this._super_=e.__super__},render:function(){var e=t.compile(i).render({lang:r});return this.$el.html(e),this.makeGrid(),this},makeGrid:function(){var e=["ad/api/department",this.deptId,"groups"];this.grid=$.goGrid({el:this.$("table"),method:"GET",url:GO.config("contextRoot")+e.join("/"),emptyMessage:'<p class="data_null"><span class="ic_data_type ic_no_data"></span><span class="txt">'+r.dept_amounts_empty+"</span></p>",defaultSorting:[[1,"asc"]],pageUse:!1,sDomUse:!1,checkbox:!0,checkboxData:"id",displayLength:999,columns:[{mData:"name",sWidth:"250px",bSortable:!0,fnRender:function(e){return e.aData.name}},{mData:"contactCount",sClass:"align_r",sWidth:"100px",bSortable:!1,fnRender:function(e){return e.aData.contactCount||0}}],fnDrawCallback:function(e){$(".dataTables_scroll tr>td:last-child, .dataTables_scroll tr>th:last-child, .dataTables_scrollBody tr:last-child").addClass("last")}})},migration:function(){var e=this.grid.tables.getCheckedIds(),t=this;if(!t._super_.checkboxValidate.apply(t,new Array(e)))return;$.goOrgSlide({header:r.migration_head,type:"department",isAdmin:!0,contextRoot:GO.contextRoot,callback:$.proxy(function(n){if(n.type=="root")return;var i='<p class="add">'+GO.i18n(r.migration_info,{arg1:n.name})+"</p>";$.goConfirm(i,"",function(){$.ajax({type:"PUT",async:!0,data:JSON.stringify({ids:e}),dataType:"json",contentType:"application/json",url:GO.config("contextRoot")+"ad/api/contact/transfer/dept/"+n.id}).done(function(e){t._super_.reload.apply(t),$.goOrgSlide.close()})})},this)})},download:function(){GO.util.downloadCsvFile("ad/api/contact/department/"+this.deptId+"/groups/download")}});return s})}).call(this);