(function(){define(["jquery","backbone","app","i18n!nls/commons","i18n!admin/nls/admin","i18n!approval/nls/approval","hgn!admin/templates/appr_official_doc_sign","file_upload"],function(e,t,n,r,i,s,o,u){var a,f={head_title:"\uc9c1\uc778",title:r["\uc81c\ubaa9"],sign_img:"\uc9c1\uc778 \uc774\ubbf8\uc9c0",creation_success_msg:i["\uc800\uc7a5\ub418\uc5c8\uc2b5\ub2c8\ub2e4. \uc591\uc2dd \ubaa9\ub85d\uc73c\ub85c \uc774\ub3d9\ud569\ub2c8\ub2e4."],cancel_and_go_to_list_msg:i["\ucde8\uc18c\ud558\uc168\uc2b5\ub2c8\ub2e4. \uc774\uc804 \ud654\uba74\uc73c\ub85c \uc774\ub3d9\ud569\ub2c8\ub2e4."],creation_fail_msg:i["\uc800\uc7a5\ud560 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4."],upload_sign_img:"\uc9c1\uc778 \uc62c\ub9ac\uae30",state:i["\uc0ac\uc6a9\uc5ec\ubd80"],hidden:i["\uc228\uae40"],normal:i["\uc815\uc0c1"],use:s["\uc0ac\uc6a9"],unuse:s["\ubbf8\uc0ac\uc6a9"],name_invalid_length:i["\uc81c\ubaa9\uc740 20\uc790\uae4c\uc9c0 \uc785\ub825\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4."],name_required:i["\uc81c\ubaa9\uc744 \uc785\ub825\ud558\uc138\uc694."],duplicated_name:i["\uc81c\ubaa9\uc774 \uc911\ubcf5\ub418\uc5c8\uc2b5\ub2c8\ub2e4."],modify:r["\uc218\uc815"],select:r["\uc120\ud0dd"],add:r["\ucd94\uac00"],"delete":r["\uc0ad\uc81c"],save:r["\uc800\uc7a5"],cancel:r["\ucde8\uc18c"],"\uc9c1\uc778 \ub4f1\ub85d \ud544\uc218":"\uc9c1\uc778\uc5d0 \uc0ac\uc6a9\ud560 \uc774\ubbf8\uc9c0\ub97c \ub4f1\ub85d\ud574\uc8fc\uc138\uc694."};return OfficialDocSignView=t.View.extend({el:"#layoutContent",model:null,initialize:function(e){this.model=e.model,this.initBindingEvents()},initBindingEvents:function(){this.$el.off("click","#save_btn"),this.$el.off("click","#cancel_btn"),this.$el.on("click","#save_btn",e.proxy(this._onSaveClicked,this)),this.$el.on("click","#cancel_btn",e.proxy(this._onCancelClicked,this))},render:function(){this.$el.html(o(this._makeTmplData(this.model))),this.initSignUpload()},_makeTmplData:function(e){var t=GO.contextRoot+"resources/images/admin/no_stamp.png",n=!_.isEmpty(e.get("path"));e.set("hasPath",n),n||e.set("defaultPath",t);var r=function(){return function(e){return e.replace('value="'+this.state+'"','value="'+this.state+'" checked')}},i={lang:f,wrappedState:r};return _.extend(i,e.toJSON())},initSignUpload:function(){var t=this,n={el:"#swfupload-control",context_root:GO.contextRoot,button_text:"<span class='buttonText' style='font-size : 12px'>"+f.upload_sign_img+"</span>",button_style:"color:#ffffff; font-size:12px; text-align:center;",button_height:22,button_width:80,progressBarUse:!1,url:"ad/api/file?GOAdminSSOcookie="+e.cookie("GOAdminSSOcookie")};(new u(n)).queue(function(e,t){}).start(function(e,t){}).progress(function(e,t){}).success(function(n,i,s){if(GO.util.fileUploadErrorCheck(i))return e.goMessage(GO.util.serverMessage(i)),!1;var o=i.data,u=o.fileName,a=o.filePath,f=o.hostId,l=o.thumbnail,c=o.fileExt.toLowerCase(),h=new RegExp("(jpeg|jpg|gif|png|bmp)","gi"),p=h.test(c);p?(e("#thumbnail_image").attr("src",l).attr("data-filepath",a).attr("data-filename",u).attr("host-id",f),t.model.set("hasPath",!0)):e.goMessage(r["\ud3ec\uba67 \uacbd\uace0"])}).complete(function(e,t){console.info(t)}).error(function(e,t){console.info(t)})},_onSaveClicked:function(){var t=this;this.model.set("name",this.$el.find("input[name=name]").val()),this.model.set("state",this.$el.find("input[name=state]:checked").val());if(!this.model.isValid())return this.model.validationError=="name_invalid_length"||this.model.validationError=="name_required"?(e.goMessage(f[this.model.validationError]),this.$el.find(":input[name=name]").select()):e.goMessage(f[this.model.validationError]),!1;var n=e("#thumbnail_image");if(!this.model.get("hasPath")&&this.model.isNew())return e.goMessage(f["\uc9c1\uc778 \ub4f1\ub85d \ud544\uc218"]),!1;thumbnail_image={filePath:n.attr("data-filepath"),fileName:n.attr("data-filename"),hostId:n.attr("host-id")},thumbnail_image["filePath"]==undefined&&thumbnail_image["fileName"]==undefined&&(thumbnail_image=null),this.model.set("sign",thumbnail_image);if(this.requestProcessing)return;this.requestProcessing=!0,this.model.save({},{url:GO.contextRoot+"ad/api/approval/manage/official/sign/",success:e.proxy(function(t,n,r){e.goAlert(f.creation_success_msg,"",this._goToFormListView)},this),error:function(t,n,r){var i=f.creation_fail_msg;return _.contains(n.responseJSON.name,"bad.request")&&(i=f.duplicated_name),e.goMessage(i),!1},complete:function(){t.requestProcessing=!1}})},_onCancelClicked:function(){return e.goAlert(f.cancel_and_go_to_list_msg,"",e.proxy(this._goToFormListView,this)),!1},_goToFormListView:function(){return GO.router.navigate("approval/manage/official",{trigger:!0}),!1}}),OfficialDocSignView})}).call(this);