(function(){define(["backbone","app","admin/models/attnd_ext_config","hgn!admin/templates/attnd_manager","hgn!approval/templates/add_org_member","i18n!nls/commons","i18n!admin/nls/admin","jquery.go-orgslide","jquery.go-validation"],function(e,t,n,r,i,s,o){function f(e,t,n){}var u={label_setting:o["\uadfc\ud0dc\uad00\ub9ac \uc124\uc815"],label_manager:o["\uc6b4\uc601\uc790"],label_add_manager:o["\uc6b4\uc601\uc790 \ucd94\uac00"],label_attendance_fix_ermissions:o["\uadfc\ud0dc \uc218\uc815 \uad8c\ud55c"],label_item:o["\ud56d\ubaa9"],label_fix_ermissions:o["\uc218\uc815 \uad8c\ud55c"],label_time:o["\uc2dc\uac04"],label_status:o["\uc0c1\ud0dc"],label_chief:o["\ubd80\uc11c\uc7a5"],label_vice_chief:o["\ubd80\ubd80\uc11c\uc7a5"],label_member:o["\ubd80\uc11c\uc6d0(\ubcf8\uc778)"],label_open_state:o["\uadfc\ud0dc \ud604\ud669 \uacf5\uac1c"],label_open_state_stats:o["\ubd80\uc11c \ud604\ud669 \ubc0f \ud1b5\uacc4 \uacf5\uac1c"],label_open_state_caption:o["\uadfc\ud0dc \ud604\ud669 \uacf5\uac1c \uc124\uba85"],label_use_charge_history_tooltip:o["\ubcc0\uacbd\uc774\ub825 \uc0ac\uc6a9\uc5ec\ubd80 \ud234\ud301"],label_use_charge_history:o["\ubcc0\uacbd\uc774\ub825 \uc0ac\uc6a9\uc5ec\ubd80"],label_use:o["\uc0ac\uc6a9"],label_not_use:o["\uc0ac\uc6a9\ud558\uc9c0 \uc54a\uc74c"],label_save:s["\uc800\uc7a5"],label_cancel:s["\ucde8\uc18c"],label_modify:s["\uc218\uc815"],label_sync_noti:o["\uadfc\ud0dc\ub3d9\uae30\ud654 \uacbd\uace0"]},a=e.View.extend({events:{"click .creat":"showOrgSlide","click #btn_save":"saveAttndSetting","click #btn_cancel":"resetAttndSetting","click .ic_del":"removeManager"},initialize:function(){this.model=new e.Model,this.model.url=t.contextRoot+"ad/api/ehr/attnd/manage",this.attndExtConfig=new n},render:function(){var e=this.attndExtConfig.fetch().promise();return $.when(e).done(_.bind(function(){this.$el.empty(),this.model.fetch({async:!1}),this.$el.html(r({lang:u,data:this.model.toJSON(),timeEditAuthData:$.parseJSON(this.model.get("timeEditAuth")),statusEditAuthData:$.parseJSON(this.model.get("statusEditAuth")),isSyncActive:this.attndExtConfig.get("syncActive")}))},this)),this},showOrgSlide:function(e){var n=this;$.goOrgSlide({header:o["\uc6b4\uc601\uc790 \ucd94\uac00"],desc:"",callback:n.addMaster,target:e,isAdmin:!0,contextRoot:t.contextRoot})},addMaster:function(e){var t=$("#addManagerEl");e&&!t.find('li[data-id="'+e.id+'"]').length?t.find("li.creat").before(i($.extend(e,{lang:u}))):$.goMessage(s["\uc774\ubbf8 \uc120\ud0dd\ub418\uc5c8\uc2b5\ub2c8\ub2e4."])},saveAttndSetting:function(){var e=this,n=[];$.each($("#addManagerEl li"),function(e,t){var r=$(t).attr("data-id");r!=undefined&&n.push({userId:$(t).attr("data-id")})}),e.model.set("admins",n,{silent:!0}),e.model.set("timeEditAuth",'{"manager" : '+$("#timeManager").is(":checked")+', "master" : '+$("#timeMaster").is(":checked")+', "moderator" : '+$("#timeModerator").is(":checked")+', "member" : '+$("#timeMember").is(":checked")+"}",{silent:!0}),e.model.set("statusEditAuth",'{"manager" : '+$("#statusManager").is(":checked")+', "master" : '+$("#statusMaster").is(":checked")+', "moderator" : '+$("#statusModerator").is(":checked")+', "member" : '+$("#statusMember").is(":checked")+"}",{silent:!0}),e.model.set("useAttendActivityLogs",$("#onUseAttendActivityLogs").is(":checked"),{silent:!0}),e.model.set("useDeptSituationAndStats",$("#openStateStats").is(":checked"),{silent:!0}),t.EventEmitter.trigger("common","layout:setOverlay",""),e.model.save({},{type:"PUT",success:function(n,r){r.code=="200"&&($.goMessage(s["\uc800\uc7a5\ub418\uc5c8\uc2b5\ub2c8\ub2e4."]),t.EventEmitter.trigger("common","layout:clearOverlay",!0),e.render())},error:function(e,n){n.responseJSON.name=="InvalidAttndAdminException"?$.goMessage(n.responseJSON.message):$.goMessage(s["\uc800\uc7a5\uc5d0 \uc2e4\ud328 \ud558\uc600\uc2b5\ub2c8\ub2e4."]),t.EventEmitter.trigger("common","layout:clearOverlay",!0)}})},resetAttndSetting:function(){this.render()},removeManager:function(e){$(e.currentTarget).closest("li").remove()}});return a})})();