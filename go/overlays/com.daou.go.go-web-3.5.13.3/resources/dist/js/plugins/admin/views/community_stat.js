define(["jquery","backbone","app","hgn!admin/templates/community_stat","hgn!admin/templates/list_empty","i18n!nls/commons","i18n!admin/nls/admin","jquery.go-popup","jquery.go-sdk","jquery.go-grid","GO.util","jquery.go-validation"],function(e,t,n,r,i,s,o){var u=null,a={label_total_community:o["\ucd1d \ucee4\ubba4\ub2c8\ud2f0 \uc218 :"],label_count:o["\uac1c"],label_mb:o.MB,label_total_storage:o["\ucd1d \uc0ac\uc6a9\ub7c9 :"],label_down:o["\ubaa9\ub85d \ub2e4\uc6b4\ub85c\ub4dc"],label_name:o["\ucee4\ubba4\ub2c8\ud2f0 \uba85"],label_master:o["\ub9c8\uc2a4\ud130"],label_created:o["\uc0dd\uc131\uc77c"],label_members:o["\ud68c\uc6d0\uc218(\uba85)"],label_boards:o["\uac8c\uc2dc\ud310 \uc218(\uac1c)"],label_posts:o["\uac8c\uc2dc\ubb3c \uc218(\uac1c)"],label_storage:o["\uc0ac\uc6a9\ub7c9(MB)"],label_search:s["\uac80\uc0c9"],label_usage_desc:o["\uc0ac\uc6a9\ub7c9\uc815\ubcf4 \uc548\ub0b4"]},f=t.View.extend({el:"#layoutContent",unbindEvent:function(){this.$el.off("click","span.btn_search"),this.$el.off("keydown","span.search_wrap input"),this.$el.off("click","span#btn_down_community")},bindEvent:function(){this.$el.on("click","span.btn_search",e.proxy(this.search,this)),this.$el.on("keydown","span.search_wrap input",e.proxy(this.searchKeyboardEvent,this)),this.$el.on("click","span#btn_down_community",e.proxy(this.csvDownloadCommunity,this))},initialize:function(){this.listEl="#communityList",this.dataTable=null,this.unbindEvent(),this.bindEvent()},csvDownloadCommunity:function(){var e="ad/api/community/statistic/list/download?",t=this.dataTable.listParams,n={property:t.property,direction:t.direction,type:t.type,keyword:t.keyword,searchtype:t.searchtype};GO.util.downloadCsvFile(e+GO.util.jsonToUrlParam(n))},render:function(){this.$el.empty(),this.$el.html(r({lang:a,selectType:[{name:o["\ucee4\ubba4\ub2c8\ud2f0 \uba85"],value:"name"},{name:o["\ub9c8\uc2a4\ud130"],value:"masterUser"}]})),this.renderCommunityList()},renderCommunityList:function(){var t=this;this.dataTable=e.goGrid({el:this.listEl,method:"GET",url:GO.contextRoot+"ad/api/community/statistic/list",emptyMessage:i({label_desc:o["\ucee4\ubba4\ub2c8\ud2f0\uac00 \uc5c6\uc2b5\ub2c8\ub2e4."]}),defaultSorting:[[0,"desc"]],sDomType:"admin",displayLength:n.session("adminPageBase"),columns:[{mData:"name",bSortable:!0,sClass:"align_l"},{mData:"masterUser",sWidth:"150px",bSortable:!0,fnRender:function(e){return e.aData.masterUser+" "+e.aData.masterPosition}},{mData:"boardCount",sClass:"align_r",sWidth:"130px",bSortable:!0},{mData:"postCount",sClass:"align_r",sWidth:"130px",bSortable:!0},{mData:"totalSize",sClass:"align_r",sWidth:"130px",bSortable:!0,fnRender:function(e){return GO.util.byteToMega(e.aData.totalSize)}}],fnDrawCallback:function(e){t.$el.find(".toolbar_top .custom_header").append(t.$el.find("#btn_down_community").show())}})},search:function(){var t=this.$el.find('.table_search input[type="text"]'),r=t.val();t.trigger("focusout").blur();if(e.trim(r)==""){e.goAlert(s["\uac80\uc0c9\uc5b4\ub97c \uc785\ub825\ud558\uc138\uc694."]);return}if(!e.goValidation.isCheckLength(2,32,r)){e.goAlert(n.i18n(o["0\uc790\uc774\uc0c1 0\uc774\ud558 \uc785\ub825\ud574\uc57c\ud569\ub2c8\ub2e4."],{arg1:"2",arg2:"32"}));return}this.dataTable.tables.search(this.$el.find(".table_search select").val(),r)},searchKeyboardEvent:function(e){e.keyCode==13&&this.search()}});return f});