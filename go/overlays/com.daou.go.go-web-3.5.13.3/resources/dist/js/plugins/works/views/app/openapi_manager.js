define("works/views/app/openapi_manager",function(require){function h(){var e=this;o.checkAppManager(this.config.get("admins"));var t=this.getSupportFields(),n=this.model.toJSON(),r=n.id&&n.id>0;this.$el.html(s({lang:c,model:n,config:this.config.toJSON(),supportFields:t,hasSupportFields:t.length>0,isModify:r})),this.settingConfigValue(n),this.fieldParamCheck();var i=new f({baseConfigModel:e.config,pageName:c["\uc678\ubd80 \ub370\uc774\ud130 \uac00\uc838\uc624\uae30"],useActionButton:!0,infoDesc:c["\uc678\ubd80 \ub370\uc774\ud130 \uac00\uc838\uc624\uae30 \uc124\uba85"]});return i.setElement(this.$("#worksContentTop")),i.render(),this}function p(){return t(this.layoutView.render()).then(this.layoutView.setContent(this))}function d(){var e=t.defer();return this.config.fetch({success:e.resolve,error:e.reject}),e.promise}function v(){var e=t.defer();return this.model.fetch({success:e.resolve,error:e.reject}),e.promise}var e=require("backbone"),t=require("when"),n=require("works/models/applet_baseconfig"),r=require("works/models/applet_openapi"),i=require("works/views/app/home/works_home_layout"),s=require("hgn!works/templates/app/openapi_manager"),o=require("works/libs/util"),u=require("i18n!nls/commons"),a=require("i18n!works/nls/works"),f=require("works/views/app/layout/manage_content_top"),l=require("works/collections/fields"),c={"\uc0ac\uc6a9\uc5ec\ubd80":a["API \uc5f0\ub3d9 \uc0ac\uc6a9\uc5ec\ubd80"],"\uc0ac\uc6a9\uc5ec\ubd80\uc124\uba85":a["API \uc5f0\ub3d9 \uc0ac\uc6a9\uc5ec\ubd80\uc124\uba85"],"\uc0ac\uc6a9\uc548\ud568\uc54c\ub9bc":a["API \uc5f0\ub3d9 \uc0ac\uc6a9\uc548\ud568\uc54c\ub9bc"],"\uc0ac\uc6a9":u["\uc0ac\uc6a9"],"\uc0ac\uc6a9\uc548\ud568":u["\uc0ac\uc6a9\uc548\ud568"],"\ud0a4\uad00\ub9ac":a["\uc778\uc99d\ud0a4 \uad00\ub9ac"],"\ud0a4\uad00\ub9ac\uc124\uba85":a["\uc778\uc99d\ud0a4 \uad00\ub9ac\uc124\uba85"],"\ud0a4\uc5c6\uc74c":a["\ubc1c\uae09\ub41c \ud0a4\uac00 \uc5c6\uc2b5\ub2c8\ub2e4"],"\ubc1c\uae09":a["\ubc1c\uae09"],"\uc7ac\ubc1c\uae09":a["\uc7ac\ubc1c\uae09"],"\ud0a4\ubc1c\uae09":a["\uc778\uc99d\ud0a4 \ubc1c\uae09"],"\uc778\uc99d\ud0a4\uc7ac\ubc1c\uae09":a["\uc778\uc99d\ud0a4 \uc7ac\ubc1c\uae09"],"\uc778\uc99d\ud0a4\uc7ac\ubc1c\uae09\ud655\uc778":a["\uc778\uc99d\ud0a4 \uc7ac\ubc1c\uae09\ud655\uc778"],"\uc5f0\ub3d9\ud56d\ubaa9\uad00\ub9ac":a["\uc5f0\ub3d9\ud56d\ubaa9\uad00\ub9ac"],"\uc5f0\ub3d9\ud56d\ubaa9\uad00\ub9ac\uc124\uba85":a["\uc5f0\ub3d9\ud56d\ubaa9\uad00\ub9ac\uc124\uba85"],"\uc720\ud6a8\uae30\uac04":a["\uc720\ud6a8\uae30\uac04"],"\uc778\uc99d\ud0a4 \uc720\ud6a8\uae30\uac04":a["\uc778\uc99d\ud0a4 \uc720\ud6a8\uae30\uac04"],"\uc778\uc99d\ud0a4 \uc720\ud6a8\uae30\uac04 \ub9cc\ub8cc":a["\uc778\uc99d\ud0a4 \uc720\ud6a8\uae30\uac04 \ub9cc\ub8cc"],"\ucef4\ud3ec\ub10c\ud2b8\uba85":a["\ucef4\ud3ec\ub10c\ud2b8\uba85"],"\ucef4\ud3ec\ub10c\ud2b8 \ud0c0\uc785":a["\ucef4\ud3ec\ub10c\ud2b8 \ud0c0\uc785"],"\ucef4\ud3ec\ub10c\ud2b8\uc5c6\uc74c":a["\ucef4\ud3ec\ub10c\ud2b8\uc5c6\uc74c"],"\ud30c\ub77c\ubbf8\ud130\uba85":a["\ud30c\ub77c\ubbf8\ud130\uba85"],"\uc218\uc815\uc0ad\uc81c\uc5f0\ub3d9\uc124\uc815":a["\uc218\uc815\uc0ad\uc81c\uc5f0\ub3d9\uc124\uc815"],"\uc218\uc815\uc0ad\uc81c\uc5f0\ub3d9\uc124\uc815\uc124\uba85":a["\uc218\uc815\uc0ad\uc81c\uc5f0\ub3d9\uc124\uc815\uc124\uba85"],"\ucef4\ud3ec\ub10c\ud2b8\uc120\ud0dd":a["\ucef4\ud3ec\ub10c\ud2b8\uc120\ud0dd"],"\uc678\ubd80 \ub370\uc774\ud130 \uac00\uc838\uc624\uae30":a["\uc678\ubd80 \ub370\uc774\ud130 \uac00\uc838\uc624\uae30"],"\uc678\ubd80 \ub370\uc774\ud130 \uac00\uc838\uc624\uae30 \uc124\uba85":a["\uc678\ubd80 \ub370\uc774\ud130 \uac00\uc838\uc624\uae30 \uc124\uba85"],"validate.empty.token":a["API \uc5f0\ub3d9\uc744 \uc0ac\uc6a9\ud558\uc2dc\ub824\uba74 \uc778\uc99d\ud0a4\ub97c \ubc1c\uae09\ubc1b\uc73c\uc138\uc694"],"validate.check.field":a["\uc5f0\ub3d9\ud56d\ubaa9\uc744 \uc120\ud0dd\ud558\uc138\uc694"],"validate.empty.field":a["\ud30c\ub77c\ubbf8\ud130\uba85\uc744 \uc785\ub825\ud558\uc138\uc694"],"validate.invalid.field":a["\ud30c\ub77c\ubbf8\ud130 \uc785\ub825\uac12 \uccb4\ud06c"],"validate.empty.update":a["\uc218\uc815\uc0ad\uc81c \uc5f0\ub3d9 \ucef4\ud3ec\ub10c\ud2b8 \uc120\ud0dd"],"validate.notmatch.update":a["\uc218\uc815\uc0ad\uc81c \uc5f0\ub3d9 \ucef4\ud3ec\ub10c\ud2b8 \uc120\ud0dd \ud544\uc218"],"validate.field.length":GO.i18n(u["0\uc790\uc774\uc0c1 0\uc774\ud558 \uc785\ub825\ud574\uc57c\ud569\ub2c8\ub2e4."],{arg1:1,arg2:20}),text:a["\ud14d\uc2a4\ud2b8"],textarea:a["\uba40\ud2f0 \ud14d\uc2a4\ud2b8"],number:a["\uc22b\uc790"],select:a["\ub4dc\ub86d \ubc15\uc2a4"],checkbox:a["\uccb4\ud06c\ubc15\uc2a4"],radio:a["\ub2e8\uc77c \uc120\ud0dd"],listbox:a["\ub9ac\uc2a4\ud2b8\ubc15\uc2a4"],date:a["\ub0a0\uc9dc"],time:a["\uc2dc\uac04"],datetime:a["\ub0a0\uc9dc\uc640 \uc2dc\uac04"],regist:u["\uc800\uc7a5"],cancel:u["\ucde8\uc18c"],gosettinghome:a["\uad00\ub9ac \ud648\uc73c\ub85c \uc774\ub3d9"],goapphome:a["\ud574\ub2f9 \uc571\uc73c\ub85c \uc774\ub3d9"],"\uc0ad\uc81c":u["\uc0ad\uc81c"],"\ud655\uc778":u["\ud655\uc778"],"\ucde8\uc18c":u["\ucde8\uc18c"]};return e.View.extend({className:"go_content go_renew go_works_home app_temp",events:{"click #generationKeyLink":"onGenerationKey","click #reGenerationKeyLink":"onReGenerationKey","click #useApiBtnWrap button":"onChangeApiUse","click #fieldParamAllCheck":"onFieldParamAllCheck",'click [name="cidCheckbox"]':"onFieldParamCheck","click #btn-confirm":"onSave","click #btn-cancel":"onCancel","click #btn-gosettinghome":"gosettinghome","click #btn-goapphome":"goapphome","click #goAppHomeNav":"goapphome"},initialize:function(e){e=e||{},this.layoutView=i.create(),e.hasOwnProperty("appletId")&&(this.model=new r({appletId:e.appletId}),this.config=new n({id:e.appletId}),this.fields=new l([],{appletId:e.appletId,includeProperty:!0}),this.model.on("invalid",this.handleError,this))},handleError:function(e,t){_.isArray(t)?_.each(t,function(e){if(e.name=="fieldParam"&&e.item){var t=$("#param"+e.cid);$.goError(c[e.message],t.parent()),t&&t.addClass("error")}}):$.goError(c[t.message])},render:function(){return t.all([p.call(this),this.fields.fetch()]).then(_.bind(d,this)).then(_.bind(v,this)).then(_.bind(h,this)).otherwise(function(t){console.log(t.stack)})},onGenerationKey:function(){this.popupView=$.goPopup({pclass:"layer_normal",header:c["\ud0a4\ubc1c\uae09"],contents:'<table class="form_type go_form_basic"><tr><th><span class="title">'+c["\uc720\ud6a8\uae30\uac04"]+"</span></th>"+"<td>"+'<span class="wrap_date">'+'<input id="keyExpireDate" class="txt wfix_small txt_mini" type="text" name="keyExpireDate" value="" readonly="readonly">'+'<span class="ic ic_calendar"></span>'+"</span>"+"</td>"+"</tr>"+"</table>",openCallback:$.proxy(function(){this.initDatePicker()},this),buttons:[{btext:c["\ud655\uc778"],btype:"confirm",callback:$.proxy(function(){var e=this,t={expireDate:$("#keyExpireDate").val()};$.ajax({type:"POST",dataType:"json",url:GO.contextRoot+"api/works/applets/"+this.model.appletId+"/openapi/token",data:t,success:function(t){var n=t.data;e.makeApiKeyDesc(n)},error:function(e){$.goError(e.message)}})},this)},{btext:c["\ucde8\uc18c"],callback:$.proxy(function(){},this)}]})},makeApiKeyDesc:function(e){var t=$("#apiKeyExpireDateDesc");if(!e.token||e.token.length==0)t.removeClass("info").addClass("caution"),t.find("span.txt").text(c["\ud0a4\uc5c6\uc74c"]);else{$("#apiKeyInput").val(e.token);var n=c["\uc778\uc99d\ud0a4 \uc720\ud6a8\uae30\uac04 \ub9cc\ub8cc"];e.valid&&(n=GO.i18n(c["\uc778\uc99d\ud0a4 \uc720\ud6a8\uae30\uac04"],{arg1:e.expireDate,arg2:e.remainingDays})),t.removeClass("caution").addClass("info"),t.find("span.txt").text(n)}},onReGenerationKey:function(){var e=$("#useApiOn").hasClass("on");e&&$.goConfirm(c["\uc778\uc99d\ud0a4\uc7ac\ubc1c\uae09"],c["\uc778\uc99d\ud0a4\uc7ac\ubc1c\uae09\ud655\uc778"],$.proxy(function(){this.onGenerationKey()},this))},onChangeApiUse:function(e){function r(e){$("#useApiBtnWrap button").removeClass("on"),$(e.currentTarget).addClass("on")}var t=$(e.currentTarget).attr("id");if(t=="useApiOff"){var n=$("#useApiBtnWrap").data("useapi");n?$.goConfirm(c["\uc0ac\uc6a9\uc5ec\ubd80"],c["\uc0ac\uc6a9\uc548\ud568\uc54c\ub9bc"],$.proxy(function(){r(e)},this)):r(e)}else r(e)},onFieldParamAllCheck:function(e){var t=$("input[name='cidCheckbox']"),n=$(e.currentTarget).is(":checked");t.attr("checked",n)},onFieldParamCheck:function(){this.fieldParamCheck()},fieldParamCheck:function(){var e=$("input[name='cidCheckbox']").length,t=$("input[name='cidCheckbox']:checked").length,n=$("#fieldParamAllCheck");e>0&&e==t?n.attr("checked",!0):n.attr("checked",!1)},initDatePicker:function(){var e=$("#keyExpireDate");e.val(GO.util.now().add(1,"months").format("YYYY-MM-DD")),e.datepicker({dateFormat:"yy-mm-dd",changeMonth:!0,changeYear:!0,yearSuffix:"",minDate:"+1d"})},getSupportFields:function(){var e=this.fields.getOpenApiFields(),t=e.toJSON();return _.each(t,function(e){e.fieldName=c[e.fieldType]}),t},settingConfigValue:function(e){var t={valid:e.validKey,token:e.apiKey,expireDate:e.expireDate,remainingDays:e.remainingDays};this.makeApiKeyDesc(t),_.each(e.fieldParamMap,function(e,t){$("#check"+t).attr("checked",!0),$("#param"+t).val(e)}),e.useUpdate&&$("#updateFieldSelect").val(e.updateFieidCid)},onSave:function(e){e.preventDefault(),this.model.set({appletId:this.model.appletId}),this.model.set({useApi:$("#useApiOn").hasClass("on")}),this.model.set({apiKey:$("#apiKeyInput").val()});var t={};$("#fieldParamTbody tr").each(function(e){var n=$(this).find("input[name='cidCheckbox']");n.is(":checked")&&(t[n.val()]=$.trim($(this).find("input[name='paramName']").val()))}),this.model.set({fieldParamMap:t}),this.model.set({useUpdate:$("#useApiUpdateOn").is(":checked")}),this.model.set({updateFieidCid:$("#updateFieldSelect").val()});if(!this.validateForm())return;this.model.save({},{success:function(){$.goMessage(u["\uc800\uc7a5\ub418\uc5c8\uc2b5\ub2c8\ub2e4."])},error:function(e,t){$.goError(t.responseJSON.message)}})},validateForm:function(){return o.errorDescRemover({targets:[this.$('input[name="paramName"]')]},this),this.model.isValid()},onCancel:function(e){var t=this;e.preventDefault(),$.goConfirm(u["\ucde8\uc18c\ud558\uc2dc\uaca0\uc2b5\ub2c8\uae4c?"],u["\uc785\ub825\ud558\uc2e0 \uc815\ubcf4\uac00 \ucd08\uae30\ud654\ub429\ub2c8\ub2e4."],function(){h.call(t)})},gosettinghome:function(){o.goSettingHome(this.model.appletId)},goapphome:function(){o.goAppHome(this.model.appletId)}})});