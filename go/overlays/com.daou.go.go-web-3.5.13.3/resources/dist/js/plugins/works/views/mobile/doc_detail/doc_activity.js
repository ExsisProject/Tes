define("works/views/mobile/doc_detail/doc_activity",function(require){var e=require("when"),t=require("backbone"),n=require("app"),r=require("works/views/mobile/doc_detail/doc_activity_item"),i=require("views/mobile/header_toolbar"),s=require("works/collections/applet_activities"),o=require("i18n!nls/commons"),u={"\ud65c\ub3d9\uae30\ub85d\ub4f1\ub85d":{id:"btnWriteActivity",text:o["\ub4f1\ub85d"],triggerFunc:"works-write-activity"}},a=t.View.extend({el:"#content",initialize:function(e){this.appletId=e.appletId,this.docId=e.docId,this.activities=new s({docId:e.docId,appletId:e.appletId}),this.currentPage=1,this.headerBindEvent()},dataFetch:function(){var t=e.defer(),n=this.activities.fetch();return $.when(n).done(function(){t.resolve()}),t.promise},headerBindEvent:function(){GO.EventEmitter.off("trigger-action"),GO.EventEmitter.on("trigger-action","works-write-activity",this.goActivityCreate,this)},render:function(){var e=this;return this.dataFetch().done(function(){e.models=e.activities.models,e.models.length==0?GO.router.navigate("works/applet/"+e.appletId+"/doc/"+e.docId+"/navigate",!0):(e.renderActivity(),e.renderHeaderToolBar())}),this},renderActivity:function(){var e=this.models[this.currentPage-1],t=new r({model:e,appletId:this.appletId,docId:this.docId});this.$el.empty().html(t.el),t.render()},renderHeaderToolBar:function(){i.render({title:this.currentPage+"/"+this.models.length,actionMenu:this.getUseMenus(),isLeftBtn:this.currentPage>1,leftBtnCallback:$.proxy(this._onClickPrevious,this),isRightBtn:this.currentPage<this.models.length,rightBtnCallback:$.proxy(this._onClickNext,this),isClose:!0})},getUseMenus:function(){var e=[];return e.push(u.\ud65c\ub3d9\uae30\ub85d\ub4f1\ub85d),e},goActivityCreate:function(){n.router.navigate("works/applet/"+this.appletId+"/doc/"+this.docId+"/activity",!0)},_onClickPrevious:function(){this.currentPage--,this.renderActivity(),this.renderHeaderToolBar()},_onClickNext:function(){this.currentPage++,this.renderActivity(),this.renderHeaderToolBar()}});return a});