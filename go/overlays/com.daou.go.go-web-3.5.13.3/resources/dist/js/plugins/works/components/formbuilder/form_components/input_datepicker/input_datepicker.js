define("works/components/formbuilder/form_components/input_datepicker/input_datepicker",function(require){var e=require("app"),t=require("go-nametags"),n=require("works/component_type"),r=require("works/components/formbuilder/core/form_component"),i=require("works/components/formbuilder/core/component_registry"),s=require("works/components/formbuilder/core/views/base_form"),o=require("works/components/formbuilder/core/views/base_detail"),u=require("works/components/formbuilder/core/views/base_option"),a=require("works/components/alarm_setting/views/alarm_setting"),f=require("works/components/formbuilder/form_components/input_datepicker/input_datepicker_validator"),l=require("hgn!works/components/formbuilder/form_components/input_datepicker/form"),c=require("hgn!works/components/formbuilder/form_components/input_datepicker/detail"),h=require("hgn!works/components/formbuilder/form_components/input_datepicker/option"),p=require("i18n!works/nls/works"),d=require("i18n!nls/commons"),v=_.extend(d,p,{"\uc774\ub984\uc744 \uc785\ub825\ud574\uc8fc\uc138\uc694":p["\uc774\ub984\uc744 \uc785\ub825\ud574\uc8fc\uc138\uc694."],"\uc124\uba85\uc744 \uc785\ub825\ud574\uc8fc\uc138\uc694":p["\uc124\uba85\uc744 \uc785\ub825\ud574\uc8fc\uc138\uc694."],MINUTE:d["\ubd84 \uc804"],HOUR:d["\uc2dc\uac04 \uc804"],DAY:d["\uc77c \uc804"]}),m=u.extend({customEvents:{"click input[name=defaultAsNow]":"_updateUseBackdrop","click .ic_reset":"dateClear","click [data-alarm-setting]":"_onClickAlarmSetting","change input[data-date]":"toggleClearIcon"},renderBody:function(){this.$el.html(h({lang:v,model:this.model.toJSON(),isMultiple:this.options.multiple}));var e=this.model.get("defaultAsNow");this.$("input[data-date='start']").datepicker({yearSuffix:"",dateFormat:"yy-mm-dd",changeMonth:!0,changeYear:!0,beforeShow:function(e,t){},onClose:_.bind(function(e){this.model.set("defaultDate",e)},this)}),this._changeSettingByDefaultAsNow(e),this.options.multiple||this._initAlarmView()},_updateUseBackdrop:function(e){var t=$(e.currentTarget),n=t.is(":checked");this._changeSettingByDefaultAsNow(n)},_changeSettingByDefaultAsNow:function(e){e?(this.$("input[data-date='start']").attr("disabled",!0),this.$("input[data-date='start']").val("").trigger("change"),this.model.set({defaultAsNow:!0,defaultDate:""})):(this.model.set({defaultAsNow:!1,defaultDate:this.model.get("defaultDate")}),this.$("input[data-date='start']").val(this.model.get("defaultDate")).attr("disabled",!1).trigger("change"))},dateClear:function(){this.$("input[data-date='start']").val("").trigger("change"),this.model.set({defaultDate:""})},toggleClearIcon:function(){this.$(".ic_reset").toggle(!_.isEmpty(this.$("input[data-date='start']").val()))},_onClickAlarmSetting:function(){this.popupView=$.goPopup({pclass:"layer_normal layer_deadline_alarm",header:d["\uc54c\ub78c \uc124\uc815"],buttons:[{autoclose:!1,btext:d["\ud655\uc778"],btype:"confirm",callback:$.proxy(function(){var t=e.getData();if(!t)return!1;this.model.set("useAlarm",t&&!!t.timers.length),this.model.set("alarms",t),this._renderAlarmItems(),t&&this.popupView.close()},this)},{btext:d["\ucde8\uc18c"],btype:"cancel"}]});var e=new a({userFields:this._getUserFields(),useMinute:!1,useHour:!1,alarms:this.model.get("alarms")||{}});this.popupView.find(".content").html(e.render().el),this.popupView.reoffset()},_initAlarmView:function(){this.alarmTagView=t.create([],{useAddButton:!1}),this.alarmTagView.$el.on("nametag:removed",$.proxy(function(){var e=this.alarmTagView.getNameTagList(),t=_.map(e,function(e){return{type:e.type,time:e.time}},this),n=this.model.get("alarms");this.model.unset("alarms"),this.model.set("alarms",_.extend(n,{timers:t})),this.model.set("useAlarm",!!n.timers.length)},this)),this.$("#alarms").append(this.alarmTagView.el),this._renderAlarmItems()},_renderAlarmItems:function(){this.alarmTagView.removeAll();var e=this.model.get("alarms")||{},t=e.timers||[];_.each(t,function(e){var t=e.time+e.type,n=e.time+v[e.type];this.alarmTagView.addTag(t,n,{attrs:{type:e.type,time:e.time},removable:!0})},this)}}),g=s.extend({initialize:function(){s.prototype.initialize.apply(this,arguments),this.validator=new f},render:function(){var t=this.appletDocModel.get("alarms"),n=_.findWhere(t,{fieldCid:this.clientId})||{},r=n.timers,i=_.map(r,function(e){var t=e.type||"";return e.time+v[t.toUpperCase()]}).join(", ");this.$body.html(l({model:this.model.toJSON(),label:e.util.escapeHtml(this.model.get("label")),"isEditable?":this.isEditable(),timersLabel:i})),this.$body.find("input[data-date='start']").datepicker({yearSuffix:"",dateFormat:"yy-mm-dd",changeMonth:!0,changeYear:!0,onSelect:$.proxy(function(){this.appletDocModel.set(this.getDataFromView()),this.toggleClearIcon()},this)}),this.isEditable()&&this.$("input[data-date='start']").prop("disabled",!0);var s=this._getInputValue();_.isEmpty(s)||this.$body.find("input[data-date='start']").val(s).trigger("change")},events:function(){return this.isEditable()?s.prototype.events:_.extend({},s.prototype.events,{"click .ic_reset":"dateClear","change input[data-date]":"toggleClearIcon"})},dateClear:function(){this.$("input[data-date='start']").val("").trigger("change"),this.appletDocModel.set(this.getDataFromView())},validate:function(){var e=this.$body.find("input[data-date='start']"),t=this.validator.validate({value:e.val()},this.model.toJSON());return t.isValid||this.printErrorTo(e,t.message),t.isValid},getFormData:function(){return this.isMultiple()&&this.appletDocModel.set(this.clientId,this._getMultipleData()),this.appletDocModel.toJSON()},getDataFromView:function(){var e=[],t={};return this.isMultiple()?(e.push(this.getSubmitValue()),_.each(this.getMultipleViews(),function(t){e.push(t.getSubmitValue())})):e=this.getSubmitValue(),t[this.getCid()]=e,t},remove:function(){s.prototype.remove.apply(this,arguments)},getSubmitValue:function(){var t=null,n=this.$body.find("input[data-date='start']").val();return _.isEmpty(n)||(t=e.util.toMoment(n).format("YYYYMMDD")),t},_getDefaultValue:function(){var t=this.model.get("defaultDate")||null;return this.appletDocModel.id?t="":this.model.get("defaultAsNow")&&(t=e.util.now().format("YYYYMMDD")),t},_getInputValue:function(){var e="",t=this.appletDocModel.get(this.clientId);!t&&this.model.get("defaultAsNow")?e=moment().format("YYYY-MM-DD"):typeof t!="undefined"&&t!==""&&t!==null||!this.model.get("defaultDate")?e="":e=this.model.get("defaultDate");var n=e;if(t){var r=t.match(/(\d{4})(\d{2})(\d{2})/);t=r?r[1]+"-"+r[2]+"-"+r[3]:t,n=t}return n},toggleClearIcon:function(){this.$(".ic_reset").toggle(!_.isEmpty(this.$("input[data-date='start']").val())),this.appletDocModel.set(this.getDataFromView())}}),y=o.extend({render:function(){var t=this.appletDocModel.get("alarms"),n=_.findWhere(t,{fieldCid:this.clientId})||{},r=n.timers,i=_.map(r,function(e){var t=e.type||"";return e.time+v[t.toUpperCase()]}).join(", ");this.$body.html(c({model:this.model.toJSON(),label:e.util.escapeHtml(this.model.get("label")),userData:this._getUserData(),timersLabel:i}))},getTitle:function(){return this._getUserData()},_getUserData:function(){var e=this.appletDocModel.get(this.clientId),t;return _.isEmpty(e)?t="":t=moment(e,"YYYYMMDD").format("YYYY-MM-DD"),t}}),b=r.define(n.Date,{name:p["\ub0a0\uc9dc"],valueType:"DATE",group:"basic",properties:{label:{defaultValue:p["\ub0a0\uc9dc"]},hideLabel:{defaultValue:!1},guide:{defaultValue:""},guideAsTooltip:{defaultValue:!0},required:{defaultValue:!1},defaultAsNow:{defaultValue:!1},defaultDate:{defaultValue:""}},OptionView:m,FormView:g,DetailView:y});i.addComponent(b)});