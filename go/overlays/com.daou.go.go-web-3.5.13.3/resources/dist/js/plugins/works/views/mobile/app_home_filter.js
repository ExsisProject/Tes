define("works/views/mobile/app_home_filter",function(require){var e=require("i18n!works/nls/works"),t=require("works/components/filter/models/filter"),n=require("works/libs/util"),r=require("works/components/filter/collections/filter_conditions"),i=Hogan.compile(['<div class="critical">','<div class="filter_search">','<input type="text" class="txt" id="searchFilterText" placeholder="{{searchText}}">','<button type="submit" class="btn_search"><span class="ico_sch_submit"></span></button>',"</div>","</div>",'<div class="optional">','<div class="btn_submenu">','<select name="filterSelector" style="width:100px;"></select>',"</div>","</div>"].join(""));return Backbone.View.extend({el:"#filterSection",initialize:function(e){var t=this;this.appletId=e.appletId,this.filterId=e.filterId,this.filters=e.filters,this.baseFilters=this.filters.getBaseFilters(),this.mineFilters=this.filters.getMineFilters(),$.when(this.baseFilters.fetch(),this.mineFilters.fetch()).then($.proxy(function(){this._renderFilters()},this)),this.fields=e.fields,this._initFilter(this.filterId),this.filter.fetch({success:function(){t._onSyncFilter(!0)},statusCode:{404:function(){t._onSyncFilter()}}}),this.conditions=new r(this.filter.get("conditions"))},render:function(){return this.$el.html(i.render({searchText:e["\ud14d\uc2a4\ud2b8 \uac80\uc0c9"]})),this},events:{"change select[name='filterSelector']":"_onChangeFilter","vclick .btn_search":"_onClickSearch","keyup #searchFilterText":"_keyUpSearch"},_keyUpSearch:function(e){e.keyCode===13&&this._onClickSearch()},_onClickSearch:function(){this.filter.set("searchKeyword",$.trim(this.$("#searchFilterText").val())),this._search()},_renderFilters:function(){var t=Hogan.compile('<option value="{{id}}" {{#selected}}selected{{/selected}}>{{name}}</option>'),r=this.$('select[name="filterSelector"]');r.find("option").remove(),r.append(t.render({id:"",name:e["\uae30\ubcf8 \ud544\ud130"]+" ---"})),r.append(t.render({id:"all",name:e["\ubaa8\ub4e0 \ub370\uc774\ud130"]})),r.append(t.render({id:"createdBy",name:e["\ub0b4\uac00 \ub4f1\ub85d\ud55c \ub370\uc774\ud130"]})),this.baseFilters.each(function(e){r.append(t.render({id:e.id,name:e.get("name")}))},this),this.mineFilters.length&&r.append(t.render({id:"",name:e["\uac1c\uc778 \ud544\ud130"]+" ---"})),this.mineFilters.each(function(e){r.append(t.render({id:e.id,name:e.get("name")}))},this),this.filterId&&r.val(this.filterId),n.saveFilterStorage("works/applet/"+this.appletId+"/filter/mobile",this.filterId)},_onChangeFilter:function(){this.$("#searchFilterText").val("");var e=this.$("select").val();if(!e)return;n.saveFilterStorage("works/applet/"+this.appletId+"/filter/mobile",e),this._initFilter(e),e==="all"?(this.conditions.reset([]),this._search()):this.filter.fetch({success:$.proxy(function(){this._onSyncFilter(!1)},this)})},_initFilter:function(e){var n={appletId:this.appletId};e==="createdBy"?this.filter=new t(_.extend(n,t.getCreatedByFilterOptions())):(parseInt(e)>0&&(n.id=parseInt(e)),this.filter=new t(n))},_onSyncFilter:function(e){this.conditions.reset(this.filter.get("conditions")),this.conditions.mergeFromFields(this.fields.toJSON()),this.fields.mergeFromConditions(this.conditions.toJSON()),this.filter.set("conditions",this.conditions.toJSON()),this._search(e)},_search:function(e){this.$el.trigger("searchByFilter",{queryString:this.filter.getSearchQuery(this.conditions),useStorePage:!!e})}})});