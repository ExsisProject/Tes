define("works/home/views/home",function(require){var e=require("i18n!nls/commons"),t=require("i18n!works/nls/works"),n={"folder.name.length":GO.i18n(e["0\uc790\uc774\uc0c1 0\uc774\ud558 \uc785\ub825\ud574\uc57c\ud569\ub2c8\ub2e4."],{arg1:2,arg2:20}),"\uc0c8 \ud3f4\ub354":t["\uc0c8 \ud3f4\ub354"],"\uc774\ub984 \ubc14\uafb8\uae30":t["\uc774\ub984 \ubc14\uafb8\uae30"],"\ub9cc\ub4e4\uae30":t["\ub9cc\ub4e4\uae30"],"\uc571 \ub0b4\ubcf4\ub0b4\uae30 \uc124\uba85":t["\uc571 \ub0b4\ubcf4\ub0b4\uae30 \uc124\uba85"],"\uc571 \uac00\uc838\uc624\uae30 \uc124\uba85":t["\uc571 \uac00\uc838\uc624\uae30 \uc124\uba85"],"\uc571 \uc774\ub984 \uac80\uc0c9":t["\uc571 \uc774\ub984 \uac80\uc0c9"],"\uc571 \uba85\uc744 \uc785\ub825\ud558\uc138\uc694":t["\uc571 \uba85\uc744 \uc785\ub825\ud558\uc138\uc694."],"\ud15c\ud50c\ub9bf \uc120\ud0dd":t["\ud15c\ud50c\ub9bf \uc120\ud0dd"],"\ud15c\ud50c\ub9bf \uc120\ud0dd \uc124\uba85":t["\ud15c\ud50c\ub9bf \uc120\ud0dd \uc124\uba85"],"\ud30c\uc77c \uac00\uc838\uc624\uae30":t["\ud30c\uc77c \uac00\uc838\uc624\uae30"],"\ud30c\uc77c \uac00\uc838\uc624\uae30 \uc124\uba85":t["\ud30c\uc77c \uac00\uc838\uc624\uae30 \uc124\uba85"],"\ucc98\uc74c\ubd80\ud130 \ub9cc\ub4e4\uae30":t["\ucc98\uc74c\ubd80\ud130 \ub9cc\ub4e4\uae30"],"\ucc98\uc74c\ubd80\ud130 \ub9cc\ub4e4\uae30 \uc124\uba85":t["\ucc98\uc74c\ubd80\ud130 \ub9cc\ub4e4\uae30 \uc124\uba85"],"\uc571 \uc0dd\uc131\uc740 \uad00\ub9ac\uc790\uac00 \uc9c0\uc815\ud55c \uc0ac\uc6a9\uc790\ub9cc \uac00\ub2a5\ud569\ub2c8\ub2e4":t["\uc571 \uc0dd\uc131\uc740 \uad00\ub9ac\uc790\uac00 \uc9c0\uc815\ud55c \uc0ac\uc6a9\uc790\ub9cc \uac00\ub2a5\ud569\ub2c8\ub2e4"],"\uc790\uc138\ud55c \uc0ac\ud56d\uc740 \uad00\ub9ac\uc790\uc5d0\uac8c \ubb38\uc758\ud558\uc2dc\uae30 \ubc14\ub78d\ub2c8\ub2e4":t["\uc790\uc138\ud55c \uc0ac\ud56d\uc740 \uad00\ub9ac\uc790\uc5d0\uac8c \ubb38\uc758\ud558\uc2dc\uae30 \ubc14\ub78d\ub2c8\ub2e4"]},r=require("works/home/models/applet_folder"),i=require("works/views/app/home/works_home_layout"),s=require("works/home/views/base_home"),o=require("works/views/app/layout/content_top"),u=require("components/backdrop/backdrop"),a=require("works/home/views/applet_folder_item"),f=require("works/components/guide_layer/views/guide_layer"),l=require("works/home/views/applet_import"),c=require("hgn!works/home/templates/home"),h=require("components/go-fileuploader/main");return s.extend({events:_.extend(s.prototype.events,{"click [data-el-sort-btn]":"_onClickSort","click [data-el-sort-item]":"_onClickSortItem","click [data-el-create]":"_onClickCreate","click [data-el-create-folder]":"_onClickCreateFolder","click [tab-applet-export]":"_onClickExportTab","click [tab-applet-import]":"_onClickImportTab","click [data-el-app-search-btn]":"_onClickSearch","keyup #appName":"_onKeyupSearch","click #btn-appname-search":"_searchAppName","click #cancel_search":"_clearAppName","click [data-add-applet]":"_goCreateAppIntro","click [data-add-applet-first-default-template]":"_createAppletByFirstDefaultTemplate","click #goToWorksHome":"_goToWorksHome"}),initialize:function(){s.prototype.initialize.apply(this,arguments),this.deferred=$.Deferred(),this.layoutView=i.create(),this.contentTopView=new o,this.$el.on("popupFolderLayer",$.proxy(function(e,t){this._popupFolderLayer(e,t)},this))},render:function(){s.prototype.render.apply(this,arguments),this._renderLayout.call(this),this.$el.html(c({isOrderByName:this.order==="name",lang:_.extend(this.lang,n),contextRoot:GO.contextRoot,appName:GO.util.getAppName("works")})),this.initFileUpload();if(GO.locale=="ko"){var e=new f({isSetting:!1});this.$(".bar").append(e.render().el),$("#guideBadge").draggable({containment:"body"})}return this.deferred.resolve(),this.contentTopView.setElement(this.$("header")),this.contentTopView.render(),this.$toggleLayoutEl=this.$(".go_content"),this._toggleLayout(this.viewType),this._setContent(this.applets.getType()),this},initFileUpload:function(){var e=this,n={context_root:GO.contextRoot,url:GO.config("contextRoot")+"api/file/direct",progressBarUse:!1,multiple:!1,validateFileType:"dwt",validateFileTypeMessage:t["dwt \ud30c\uc77c\ub9cc \ub4f1\ub85d \uac00\ub2a5\ud569\ub2c8\ub2e4."],isWorks:!0};this.$el.find("#file-uploader a").attr("data-attachtype","file"),n.progress=function(){e.backdropLayer.toggle(!1),GO.EventEmitter.trigger("common","layout:setOverlay","")},n.success=function(t){var n=t.data;if(GO.util.fileUploadErrorCheck(t))return $.goAlert(GO.util.serverMessage(t)),!1;if(GO.util.isFileSizeZero(t))return $.goAlert(GO.util.serverMessage(t)),!1;e._createAppletByFile(n),GO.EventEmitter.trigger("common","layout:clearOverlay",!0)},n.error=function(e){console.log(e),$.goSlideMessage(e,"caution")},h.bind(this.$el.find("#file-uploader a"),n)},_goCreateAppIntro:function(e){var t=this.applets.getType()==="folder"?"?folderId="+this.applets.getFolderId():"";e.preventDefault(),GO.router.navigate("works/applet/create/intro"+t,!0)},_createAppletByFirstDefaultTemplate:function(n){n.preventDefault(),n.stopPropagation(),this.backdropLayer.toggle(!1),GO.EventEmitter.trigger("common","layout:setOverlay",""),$.ajax({url:GO.contextRoot+"api/works/applets/default",contentType:"application/json",type:"POST",success:$.proxy(function(e){GO.EventEmitter.trigger("common","layout:clearOverlay",!0);var n=e.data.id;$.goSlideMessage(t["\uc571\uc774 \uc0dd\uc131\ub418\uc5c8\uc2b5\ub2c8\ub2e4."]),this.applets.getType()==="folder"&&this._moveApplet(n,this.applets.getFolderId(),null,!1),setTimeout($.proxy(function(){GO.router.navigate("works/applet/"+n+"/settings/userform",!0)}),500)},this),error:$.proxy(function(t){$.goSlideMessage(e["\uc2e4\ud328\ud588\uc2b5\ub2c8\ub2e4."])},this)})},_createAppletByFile:function(n){$.ajax({url:GO.contextRoot+"api/works/applets/file",contentType:"application/json",type:"POST",data:JSON.stringify(n),success:$.proxy(function(e){var n=e.data.id;$.goSlideMessage(t["\uc571\uc774 \uc0dd\uc131\ub418\uc5c8\uc2b5\ub2c8\ub2e4."]),this.applets.getType()==="folder"&&this._moveApplet(n,this.applets.getFolderId(),null,!1),setTimeout($.proxy(function(){GO.router.navigate("works/applet/"+n+"/home",!0)}),500)},this),error:$.proxy(function(t){var n=t.responseJSON;n.name=="subform-validate"?$.goSlideMessage(n.message):$.goSlideMessage(e["\uc2e4\ud328\ud588\uc2b5\ub2c8\ub2e4."])},this)})},_onClickCreate:function(){this.backdropLayer||(this.backdropLayer=new u({el:this.$("[el-backdrop-create]")}),this.backdropLayer.linkBackdrop(this.$("[data-el-create]")))},_onClickCreateFolder:function(e){e.stopPropagation(),this.backdropLayer.toggle(!1),this._popupFolderLayer(e)},_onClickSortItem:function(e){var t=$(e.currentTarget),n=t.attr("data-el-sort-item");this.applets.setOrder(n),this.applets.fetch({reset:!0}),this.applets.getType()!="search"&&(this.folders.setOrder(n),this.folders.fetch({reset:!0})),this.$(".ic_check_1").hide(),t.find(".ic_check_1").show(),GO.util.store.set(GO.session("id")+"-works-home-order",n,"local")},_clearAppName:function(){this.$("#appName").val("")},_searchAppName:function(){var e=$("#appName").val().trim();_.isEmpty(e)?(this.applets.setType("all"),$("[data-el-app-search-btn]").removeClass("searching")):(this.applets.setType("search"),$("[data-el-app-search-btn]").addClass("searching")),this.applets.setKeyword(e),this.applets.fetch({reset:!0})},_onClickExportTab:function(e){var t=$(e.currentTarget);this.$("[tab-applet-export]").attr("class","active"),this.$("[tab-applet-import]").attr("class","selectable"),this.$("[data-applet-share-info]").html(n["\uc571 \ub0b4\ubcf4\ub0b4\uae30 \uc124\uba85"]),this.exportApplets.fetch(),this._renderExportAppletList()},_onClickImportTab:function(e){var t=$(e.currentTarget);this.$("[tab-applet-export]").attr("class","selectable"),this.$("[tab-applet-import]").attr("class","active"),this.$("[data-applet-share-info]").html(n["\uc571 \uac00\uc838\uc624\uae30 \uc124\uba85"]),this.$("[data-share-item-list]").empty(),this.importApplets.fetch(),this._renderImportAppletList()},_renderImportAppletList:function(){this.$("[data-share-item-list]").empty(),this.appImportListView=new l({models:this.importApplets}),this.$("[data-share-item-list]").append(this.appImportListView.render().el)},_commonAction:function(e){s.prototype._commonAction.apply(this,arguments),this._setTitle(e)},_setTitle:function(e,t){e=e||this.applets.getType();var n=this.folders.findWhere({id:parseInt(this.applets.getFolderId())});t=t||n?n.get("name"):"";var r=Hogan.compile('<span class="nav"><a {{#isFolderType}}class="prev" data-all{{/isFolderType}} id="goToWorksHome"><span>{{title}}</span></a>{{#isFolderType}}<span><span>&gt;</span></span><a><span>'+t+"</span><a/>"+"{{/isFolderType}}"+"</span>");this.contentTopView.setTitle(r.render({type:e,title:this.lang[e==="folder"?"all":e],isFolderType:e==="folder"}))},_goToWorksHome:function(){GO.router.navigate(GO.router.getPackageName(),{trigger:!0})},_onClickFolderItem:function(e){s.prototype._onClickFolderItem.apply(this,arguments);var t=$(e.currentTarget).attr("data-folder-id"),n=this.folders.findWhere({id:parseInt(t)});this._setTitle("folder",n.get("name"))},_onClickSort:function(){this.sortBackdropLayer||(this.sortBackdropLayer=new u({el:this.$("[el-backdrop-sort]")}),this.sortBackdropLayer.linkBackdrop(this.$("[data-el-sort-btn]")))},_onClickSearch:function(){this.searchBackdropLayer||(this.searchBackdropLayer=new u({el:this.$("[el-backdrop-search]")}),this.searchBackdropLayer.linkBackdrop(this.$("[data-el-app-search-btn]")))},_onKeyupSearch:function(e){e.preventDefault();if(e.keyCode!=13&&!_.isEmpty($("#appName").val()))return;this._searchAppName()},_toggleEvent:function(){var e=this.applets.getType();e=="all"||e=="folder"?(this._bindDraggable(),this._enableDroppable()):e=="favorite"?(this._enableSortable(),this._disableDroppable()):this._disableSortable()},_toggleLayout:function(){var e=s.prototype._toggleLayout.apply(this,arguments),t={card:"list",list:"card"};this.$("[data-toggle-layout]").removeClass("ic_list_1").removeClass("ic_card_1").addClass("ic_"+t[e]+"_1")},_onSyncFolders:function(){this.deferred.done($.proxy(function(){s.prototype._onSyncFolders.call(this),this._renderSideFolders(),this._toggleEvent(),this._setTitle()},this))},_renderSideFolders:function(){this.$("[data-side-group-list]").empty(),this.folders.sortByName(),this.folders.each(function(e){var t=new a({model:e,tagName:"li",className:"folder",type:"side"});this.$("[data-side-group-list]").append(t.render().el)},this)},_onSyncApplets:function(){s.prototype._onSyncApplets.apply(this,arguments),this._toggleEvent();var e=this.applets.getType()==="favorite",t=this.applets.getType()==="all"||this.applets.getType()==="search";this.$("[data-el-sort-btn]").toggle(!e),this.$("[data-el-app-search-btn]").toggle(t),t||(this.$("#appName").val(""),this.$("[data-el-app-search-btn]").removeClass("searching"))},_onSyncExportAppletList:function(){s.prototype._onSyncExportAppletList.apply(this,arguments),this._toggleEvent()},_bindDraggable:function(){this.$("div.app_item").draggable({appendTo:"body",cursorAt:{left:10,top:10},containment:"body",start:function(){$(this).data("startingScrollTop",$(document.body).scrollTop())},drag:function(e,t){t.position.top-=parseInt($(this).data("startingScrollTop"))},helper:function(e){var t=$(e.currentTarget).data("view").model.id;return'<div class="drag works_drag" data-applet-id="'+t+'">'+'<span class="ic_works ic_body_folder_s"></span>'+'<span class="subject">'+$(e.currentTarget).data("view").model.get("name")+"</span>"+"</div>"}})},_toggleHoverClass:function(e,t){var n=e.is("div.group")?e.find("a").first():e;n.toggleClass("drag_do",t)},_bindDroppable:function(){this.$("div.group, li.folder, h1[data-folder-id]").droppable({hoverClass:"hover",out:$.proxy(function(e){this._toggleHoverClass($(e.target),!1)},this),over:$.proxy(function(e){this._toggleHoverClass($(e.target),!0)},this),drop:$.proxy(function(e,n){this._toggleHoverClass($(e.target),!1);var r=$(e.target).attr("data-folder-id");r=r==="root"?null:r;var i=this.applets.getType()==="folder"?this.applets.getFolderId():null;if(r===i)return;var s=n.helper.attr("data-applet-id"),o=this.applets.findWhere({id:parseInt(s)}),u=r?this.folders.findWhere({id:parseInt(r)}):null,a=o.get("name"),f=r?u.get("name"):t["\ub098\uc758 \ud3f4\ub354"];$.goConfirm(t["\uc571\uc744 \uc774\ub3d9\ud558\uc2dc\uaca0\uc2b5\ub2c8\uae4c?"],GO.i18n(t["\uc120\ud0dd\ud55c {{applet}}\uc744(\ub97c) {{folder}}\ub85c \uc774\ub3d9\ud569\ub2c8\ub2e4.<br />\ud655\uc778 \ud074\ub9ad\uc2dc \uc774\ub3d9\ub429\ub2c8\ub2e4."],{applet:a,folder:f}),$.proxy(function(){this._moveApplet(s,r,i,!0)},this))},this)})},_bindSortable:function(){var e=!1;this.$("[data-app-list]").sortable({items:".app_item",tolerance:"pointer",containment:"body",change:function(){e=!0},sort:function(t,n){if($.browser.webkit&&e){var r=$(window).scrollTop();n.helper.css({top:n.position.top+r+"px"})}},stop:$.proxy(function(t,n){e=!0;var r=n.item.parent(),i=[];r.find("div.app_item").each(function(e,t){var n=$(t).data("view");i.push(n.getAppletId())}),this.applets.reorder(i)},this)})},_enableSortable:function(){this._bindSortable(),this.$("[data-app-list]").sortable("enable")},_disableSortable:function(){this._bindSortable(),this.$("[data-app-list]").sortable("disable")},_enableDroppable:function(){this._bindDroppable(),this.$("div.group, li.folder, h1[data-folder-id]").droppable("enable")},_disableDroppable:function(){this._bindDroppable(),this.$("div.group, li.folder, h1[data-folder-id]").droppable("disable")},_moveApplet:function(e,n,r,i){$.ajax({type:"PUT",contentType:"application/json",url:GO.contextRoot+"api/works/folders/move",data:JSON.stringify({oldFolderId:r,appletId:e,newFolderId:n}),success:$.proxy(function(){this.applets.fetch(),i&&$.goMessage(t["\uc774\ub3d9\ub418\uc5c8\uc2b5\ub2c8\ub2e4."])},this)})},_popupFolderLayer:function(t,i){var s=!!i,o=s?i.get("name"):"",u='<table class="table_form_mini"><tbody><tr><td><input class="input w_max" type="text" id="folderName" value="'+o+'" />'+"</td></tr>"+"</tbody></table>",a=$.goPopup({header:s?n["\uc774\ub984 \ubc14\uafb8\uae30"]:n["\uc0c8 \ud3f4\ub354"],contents:u,pclass:"layer_normal new_layer layer_works_new",buttons:[{btext:e["\ud655\uc778"],btype:"confirm",autoclose:!1,callback:$.proxy(function(t){var o=t.find("#folderName"),u=o.val();i=i||new r,i.set({name:u});var a=i.validate();if(a){$.goError(n[a],o);return}i.save({},{success:$.proxy(function(){t.close(),$.goMessage(s?e["\uc218\uc815\ub418\uc5c8\uc2b5\ub2c8\ub2e4."]:e["\ucd94\uac00\ub418\uc5c8\uc2b5\ub2c8\ub2e4."]),this.folders.fetch()},this)})},this)},{btext:e["\ucde8\uc18c"],btype:"normal"}]});a.find(".btn_layer_x").hide(),a.find("#folderName").focus()},_renderLayout:function(){this.layoutView.render().done($.proxy(function(){this.layoutView.setContent(this),this.layoutView.$el.removeClass("go_full_screen").addClass("do_skin")},this))}})});