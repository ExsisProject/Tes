define("works/components/report/view/chart_setting",function(require){var e=["DAY","MONTH","YEAR"],t=require("works/constants/value_type"),n=require("i18n!nls/commons"),r=require("i18n!works/nls/works"),i={MINUTE:r.MINUTE,HOUR:r.HOUR,DAY:r.DAY,WEEK:r.WEEK,MONTH:r.MONTH,QUARTER:r.QUARTER,YEAR:r.YEAR,"\ucc28\ud2b8 \uc774\ub984":r["\ucc28\ud2b8 \uc774\ub984"],"\ucc28\ud2b8 \ud0c0\uc785":r["\ucc28\ud2b8 \ud0c0\uc785"],"\uc138\ub85c \ub9c9\ub300\ud615":r["\uc138\ub85c \ub9c9\ub300\ud615"],"\uaebe\uc740 \uc120\ud615":r["\uaebe\uc740 \uc120\ud615"],"\uc6d0\ud615":r["\uc6d0\ud615"],"\uc18d\ub3c4 \uadf8\ub798\ud504":r["\uc18d\ub3c4 \uadf8\ub798\ud504"],"\uadf8\ub8f9\ubcc4 \ud1b5\uacc4":r["\uadf8\ub8f9\ubcc4 \ud1b5\uacc4"],"\ubaa9\ud45c\uac12":r["\ubaa9\ud45c\uac12"],"\uc9d1\uacc4 \ubc29\uc2dd":r["\uc9d1\uacc4 \ubc29\uc2dd"],"\uc815\ub82c":r["\uc815\ub82c"],"\uac1c\uc218":r["\uac1c\uc218"],"\ud569\uacc4":r["\ud569\uacc4"],"\ud3c9\uade0":r["\ud3c9\uade0"],"\ucd5c\ub300\uac12":r["\ucd5c\ub300\uac12"],"\ucd5c\uc18c\uac12":r["\ucd5c\uc18c\uac12"],"\uadf8\ub8f9\uc5c6\uc74c":r["\uadf8\ub8f9\uc5c6\uc74c"],"\uc0ad\uc81c\ub41c \ud56d\ubaa9":r["\uc0ad\uc81c\ub41c \ud56d\ubaa9"],"\ud56d\ubaa9\uc774 \uc0ad\uc81c\ub418\uc5c8\uc2b5\ub2c8\ub2e4 \uc124\uba85":r["\ud56d\ubaa9\uc774 \uc0ad\uc81c\ub418\uc5c8\uc2b5\ub2c8\ub2e4 \uc124\uba85"],"\uae30\ubcf8\ud615":r["\uae30\ubcf8\ud615"],"\ub204\uc801\ud615":r["\ub204\uc801\ud615"],"\ucf64\ubcf4 \ucc28\ud2b8":r["\ucf64\ubcf4 \ucc28\ud2b8"],"\ud14c\ub9c8 \uc9c0\uc815":r["\ud14c\ub9c8 \uc9c0\uc815"],"\ucc28\ud2b8 \ubbf8\ub9ac\ubcf4\uae30":r["\ucc28\ud2b8 \ubbf8\ub9ac\ubcf4\uae30"],"\ub370\uc774\ud130 \uac12 \ud45c\uc2dc":r["\ub370\uc774\ud130 \uac12 \ud45c\uc2dc"]},s=require("components/number_form/number_form"),o=Hogan.compile('<option value="{{type}}">{{label}}</option>'),u=require("hgn!works/components/report/template/chart_setting");return Backbone.View.extend({initialize:function(e){this.appletId=e.appletId,this.chartFields=e.chartFields,this.numberFields=e.numberFields,this.model.on("change:title",this._validateTitle,this),this.model.on("change:goal",this._validateGoal,this),this.model.on("change:groupByCid",this._validateGroupByCid,this),this.model.on("change:subGroupByCid",this._validateGroupByCid,this),this.model.on("change:stack",this._validateStack,this),this.model.on("change:subStack",this._validateSubStack,this)},events:{"click [data-chart-theme]":"_onClickChartTheme","click [data-combination-label]":"_onClickCombination","change #fields":"_onChangeField","change #subFields":"_onChangeSubField","change #chartTitle":"_validateTitle","change [data-combination-input]":"_onChangeCombination","change #chartType":"_onChangeChartType","change #aggMethod":"_onChangeAggMethod","change #subAggMethod":"_onChangeSubAggMethod","focusout [el-gauge-value]":"_validateGoal"},render:function(){return this.$el.html(u({lang:i,model:this.model.toJSON(),chartFields:this.chartFields.toJSON(),numberFields:this.numberFields.toJSON(),hasNumberFields:this.numberFields.length>0})),this.$el.attr("data-chart-cid",this.model.cid),this.numberFormView=new s({inputClass:"txt w_min",inputSelector:{"el-gauge-value":""}}),this.numberFormView.setElement(this.$("[el-number-form-wrapper]")),this.numberFormView.render(),this._renderTimeFormatItem(),this._setData(),this},_setData:function(){this.$("#chartType").val(this.model.get("chartType")),this._onChangeChartType(),this.numberFormView.setValue(this.model.get("goal")||""),this.$("#fields").val(this.model.get("groupByCid")),this.$("#subFields").val(this.model.get("subGroupByCid")),this.$("#stack").val(_.isUndefined(this.model.get("stack"))?"false":this.model.get("stack")+""),this.$("#subStack").val(_.isUndefined(this.model.get("subStack"))?"false":this.model.get("subStack")+""),this.model.get("rangeOption")&&this.$("#rangeOption").val(this.model.get("rangeOption")),this.model.get("subRangeOption")&&this.$("#subRangeOption").val(this.model.get("subRangeOption")),this.model.get("combination")&&this.$("[data-combination-input]").prop("checked",!0),this._toggleCombinationArea(this.model.get("combination")),this._onChangeField(),this._onChangeSubField(),this._setAggArea(),this._onChangeAggMethod(),this._onChangeSubAggMethod(),this._setTheme()},_setAggArea:function(){this.isDeletedAggField()?(this.$("#aggMethod").val("COUNT"),this.$("#aggCid").val("")):(this.$("#aggMethod").val(this.model.get("aggMethod")),this.$("#aggCid").val(this.model.get("aggCid"))),this.isDeletedSubAggField()?(this.$("#subAggMethod").val("COUNT"),this.$("#subAggCid").val("")):(this.$("#subAggMethod").val(this.model.get("subAggMethod")),this.$("#subAggCid").val(this.model.get("subAggCid")))},_setTheme:function(){var e=null;this.model.get("theme")?e=this.$('[data-chart-theme="'+this.model.get("theme")+'"]'):e=this.$el.find(".chart_skin :first"),e.addClass("on"),e.addClass("chart_skin_on")},_onClickChartTheme:function(e){var t=$(e.currentTarget);t.siblings(".on").removeClass("on"),t.siblings(".chart_skin_on").removeClass("chart_skin_on"),t.addClass("on"),t.addClass("chart_skin_on")},_onChangeCombination:function(e){var t=$(e.currentTarget).is(":checked");this._changeCombination(t)},_onClickCombination:function(){this.$("[data-combination-input]").click()},_changeCombination:function(e){this._toggleCombinationArea(e)},_onChangeChartType:function(){var e=this.$("#chartType").val(),t=e==="GAUGE",n=e==="LINE"||e==="COLUMN";this.$("[el-fields]").toggle(!t),this.$("[el-gauge-value-area]").toggle(t),this.$("#subFields").toggle(n),t||this.$el.find("[el-gauge-value]").val(""),n?this.$("#subChartType").val(e==="LINE"?"COLUMN":"LINE"):(this.$el.find("#subFields").val(""),this.$el.find("#subRangeOption").val(""),this._onChangeSubField(),this.$el.find("[data-combination-input]").prop("checked",!1),this._changeCombination(!0)),this.$el.find("[data-combination-input-area]").toggle(n),this.$el.find("[data-combination-area]").toggle(!!n&&!!this.$el.find("[data-combination-input]").is(":checked")),this._toggleStack(n),this._toggleSubStack(n)},_onChangeField:function(){this._toggleDateTimeView(this.$("#fields").find("option:selected").attr("data-value-type"),"rangeOption")},_onChangeSubField:function(){this._toggleDateTimeView(this.$("#subFields").find("option:selected").attr("data-value-type"),"subRangeOption")},_onChangeAggMethod:function(){var e=this.$("#aggMethod").val(),t=e==="COUNT",n=t?null:this.$("#aggCid").val();this.numberFields.length>0&&n==null&&this.$("#aggCid").val(this.numberFields.models[0].get("cid")),this.$("#aggCid").toggle(!t)},_onChangeSubAggMethod:function(){var e=this.$("#subAggMethod").val(),t=e==="COUNT",n=this.$("#subAggCid").val();!t&&this.numberFields.length>0&&n==null&&this.$("#subAggCid").val(this.numberFields.models[0].get("cid")),this.$("#subAggCid").toggle(!t)},_toggleDateTimeView:function(e,n){var r=this.$("#"+n),i=_.contains([t.DATE,t.DATETIME,t.TIME],e),s=t.TIME===e;i?s?r.toggle(!1):r.toggle(!0):r.toggle(!1)},_toggleCombinationArea:function(e){this.$("[data-combination-area]").toggle(!!e)},_toggleStack:function(e){this.$("#stack").toggle(e)},_toggleSubStack:function(e){this.$("#subStack").toggle(e)},_renderTimeFormatItem:function(){var t=this.$("select[data-postfix]");t.empty(),_.each(e,function(e){t.append(o.render({type:e,label:i[e]}))},this)},save:function(){var e=this.$el.find("#fields :selected").attr("data-value-type"),n=this.$el.find("#subFields :selected").attr("data-value-type"),r=_.contains([t.DATE,t.DATETIME,t.TIME],e);r||this.$el.find("#rangeOption").val(""),r=_.contains([t.DATE,t.DATETIME,t.TIME],n),r||this.$el.find("#subRangeOption").val("");var i=this.$el.find("#aggMethod").val();"COUNT"==i&&this.$el.find("#aggCid").val(""),this.model.set("title",this.$el.find("#chartTitle").val()),this.model.set("chartType",this.$el.find("#chartType").val()),this.model.set("subChartType",this.$el.find("#subChartType").val()),this.model.set("aggMethod",i),this.model.set("aggCid",this.$el.find("#aggCid").val()),this.model.set("subAggMethod",this.$el.find("#subAggMethod").val()),this.model.set("subAggCid",this.$el.find("#subAggCid").val()),this.model.set("stack","true"===this.$el.find("#stack").val()),this.model.set("subStack","true"===this.$el.find("#subStack").val()),this.model.set("goal",parseInt(this.numberFormView.getValue())),this.model.set("groupByCid",this.$el.find("#fields").val()),this.model.set("rangeOption",this.$el.find("#rangeOption").val()),this.model.set("subGroupByCid",this.$el.find("#subFields").val()),this.model.set("theme",this.$el.find(".chart_skin_on").attr("data-chart-theme")),this.model.set("subRangeOption",this.$el.find("#subRangeOption").val()),this.model.set("combination",this.$el.find("[data-combination-input]").prop("checked")),this.model.set("aggField",this.$el.find("#aggCid").val())},isValid:function(){return this._validateTitle()?this._validateGoal()?this._validateGroupByCid()?this._validateStack()?this._validateSubStack()?!0:!1:!1:!1:!1:!1},_validateTitle:function(){var e=this.$el.find("#chartTitle").val();return e.length<1||e.length>20?($.goError(GO.i18n(n["0\uc790\uc774\uc0c1 0\uc774\ud558 \uc785\ub825\ud574\uc57c\ud569\ub2c8\ub2e4."],{arg1:1,arg2:20}),this.$("#chartTitle"),!1,!0),!1):!0},_validateGoal:function(){var e=this.$el.find("#chartType").val();return e==="GAUGE"&&!this.$el.find("[el-gauge-value]").val()?($.goError(n["\ud544\uc218\ud56d\ubaa9\uc744 \uc785\ub825\ud558\uc9c0 \uc54a\uc558\uc2b5\ub2c8\ub2e4."],this.$("[el-gauge-value]"),!1,!0),!1):!0},_validateGroupByCid:function(){return this.model.get("subGroupByCid")&&!this.model.get("groupByCid")?($.goError(n["\ud544\uc218\ud56d\ubaa9\uc744 \uc785\ub825\ud558\uc9c0 \uc54a\uc558\uc2b5\ub2c8\ub2e4."],this.$("#fields"),!1,!0),this.model.set("subGroupByCid",null),this.$("#subFields").val(""),!1):!0},_validateStack:function(){return this.model.get("stack")==="true"&&!this.model.get("subGroupByCid")?($.goError(r["\ub204\uc801\ud615 \uc124\uba85"],this.$("#stack"),!1,!0),!1):!0},_validateSubStack:function(){return this.model.get("subStack")==="true"&&!this.model.get("subGroupByCid")?($.goError(r["\ub204\uc801\ud615 \uc124\uba85"],this.$("#subStack"),!1,!0),!1):!0},isDeletedAggField:function(){return this.model.get("hasDeletedField")&&!this.numberFields.hasFieldByCid(this.model.get("aggCid"))},isDeletedSubAggField:function(){return this.model.get("hasDeletedField")&&!this.numberFields.hasFieldByCid(this.model.get("subAggCid"))}})});