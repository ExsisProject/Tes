define("works/views/app/report/report_item_table",function(require){var e=require("works/views/app/report/report_item"),t=require("works/views/app/report/works_report_filter"),n=require("works/constants/value_type"),r=require("works/components/report/view/table_setting"),i=require("works/components/report/view/table_preview"),s=require("works/components/report/models/table_model"),o=require("works/components/filter/models/filter_condition"),u=require("works/components/filter/collections/filter_conditions");return e.extend({initialize:function(t){e.prototype.initialize.call(this,t),this.type="data",this.appletId=t.appletId,this.fields=t.fields,this.chartFields=this.fields.getChartFields(),this.numberFields=this.fields.getNumberFields();var n=this.chartFields.length?this.chartFields.toJSON()[0]:{},r=this.chartFields.length?this.chartFields.toJSON()[0]:{};this.tableModel=t.tableModel?t.tableModel:new s({appletId:this.appletId,aggMethod:this.aggMethod,calculateField:r,standardField:n,rangeOption:this.chartFields.length?this.getDefaultRangeOption(r.valueType):"",rowCount:this.rowCount,direction:this.direction,q:this.q}),this.conditions=new u,this.contentWrap=$(t.contentWrap)},render:function(){this._setTableView()},_setTableView:function(){if(!this._isValidComponent()){this._previewRender(!0);return}$.when(this.tableModel.fetch()).then($.proxy(function(){this._previewRender()},this))},_previewRender:function(e){this.tablePreview=new i({model:this.tableModel,appletId:this.appletId,chartFields:this.chartFields}),this.contentWrap.empty(),this.contentWrap.append(this.tablePreview.render(e).el)},reload_setting:function(){return this.tableSettingView.isValid()?(this.tableSettingView.save(),this._setTableView(),!0):!1},reload_filter:function(){return this.conditions=this.filterView._getConditions(),this.tableModel.setQueryString(this.filterView._getFilterQuery()),this._setTableView(),!0},getSettingTmpl:function(){return this.tableSettingView=new r({appletId:this.appletId,chartFields:this.chartFields,numberFields:this.numberFields,model:this.tableModel}),this.tableSettingView.render().el},getFilterTmpl:function(){var e=_.map(this.conditions.toJSON(),function(e){return e.fieldCid});return _.each(this.fields.toArray(),function(t){t.set("isUsed",e.includes(t.get("cid")))}),this.filterView=new t({conditions:this.conditions.clone(),fields:this.fields}),this.filterView.render().el},getDefaultRangeOption:function(e){var t=_.contains([n.DATE,n.DATETIME],e),r=n.TIME===e;return r?"HOUR":t?"DAY":""},toJSON:function(){return{tableModel:this.tableModel.toJSON(),conditions:this.conditions.toJSON(),type:this.type}},toObject:function(e){this.tableModel=new s(e.data.tableModel),this.conditions=new u,this.tableModel.appletId=this.appletId;for(var t=0;t<e.data.conditions.length;t++)this.conditions.push(new o(e.data.conditions[t]))},_isValidComponent:function(){if(!this._isValidCid(this.tableModel.get("standardField")))return!1;if(!this._isValidCid(this.tableModel.get("calculateField")))return!1;var e=this,t=this.tableModel.get("subQuery");if(!t)return!0;var n=_.filter(JSON.parse(t),function(t){var n=e.chartFields.findByCid(t.componentId);return n?!1:!0});return n.length>0?!1:!0},_isValidCid:function(e){var e=this.chartFields.findByCid(e.cid);return e?!0:!1}})});