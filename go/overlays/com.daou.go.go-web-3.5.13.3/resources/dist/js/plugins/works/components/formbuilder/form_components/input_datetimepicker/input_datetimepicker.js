define("works/components/formbuilder/form_components/input_datetimepicker/input_datetimepicker",function(require){var e=require("app"),t=require("go-nametags"),n=require("works/component_type"),r=require("works/components/formbuilder/core/form_component"),i=require("works/components/formbuilder/core/component_registry"),s=require("works/components/formbuilder/core/views/base_form"),o=require("works/components/formbuilder/core/views/base_detail"),u=require("works/components/formbuilder/core/views/base_option"),a=require("works/components/alarm_setting/views/alarm_setting"),f=require("works/components/formbuilder/core/views/time_select"),l=require("works/components/formbuilder/form_components/input_datetimepicker/input_datetimepicker_validator"),c=require("hgn!works/components/formbuilder/form_components/input_datetimepicker/form"),h=require("hgn!works/components/formbuilder/form_components/input_datetimepicker/detail"),p=require("hgn!works/components/formbuilder/form_components/input_datetimepicker/option"),d=require("i18n!works/nls/works"),v=require("i18n!nls/commons"),m=require("works/libs/util"),g=_.extend(v,{"\uc774\ub984\uc744 \uc785\ub825\ud574\uc8fc\uc138\uc694":d["\uc774\ub984\uc744 \uc785\ub825\ud574\uc8fc\uc138\uc694."],"\uc124\uba85\uc744 \uc785\ub825\ud574\uc8fc\uc138\uc694":d["\uc124\uba85\uc744 \uc785\ub825\ud574\uc8fc\uc138\uc694."],MINUTE:v["\ubd84 \uc804"],HOUR:v["\uc2dc\uac04 \uc804"],DAY:v["\uc77c \uc804"]}),y=u.extend({customEvents:{"click .ic_reset":"dateClear","click input[name=defaultAsNow]":"_updateUseBackdrop","click ul[el-time-list] li":"_onSelect","click [data-alarm-setting]":"_onClickAlarmSetting","keydown input[data-time]":"_onKeydown","change input[data-time]":"_onChange","change input[data-date]":"toggleClearIcon"},renderBody:function(){this.$el.html(p({lang:g,model:this.model.toJSON(),isMultiple:this.options.multiple})),this.$("input[data-date='start']").datepicker({yearSuffix:"",dateFormat:"yy-mm-dd",changeMonth:!0,changeYear:!0,beforeShow:function(e,t){},onClose:_.bind(function(e){this.model.set("defaultDate",e)},this)}),this.timeSelectView=new f({useBackdrop:!0}),this.$(".wrap_select").html(this.timeSelectView.render().el),this.timeSelectView.linkBackdrop(this.$("input[data-time='start']")),this._changeSettingByDefaultAsNow(this.model.get("defaultAsNow")),this.options.multiple||this._initAlarmView()},_changeSettingByDefaultAsNow:function(e){e?(this.timeSelectView.unBindBackdrop(),this.timeSelectView.$("input[data-time='start']").val("").prop("disabled",!0),this.$("input[data-date='start']").val("").prop("disabled",!0).trigger("change"),this.model.set({defaultDate:"",defaultTime:"",defaultAsNow:!0})):(this.timeSelectView.bindBackdrop(),this.timeSelectView.$("input[data-time='start']").val(this.model.get("defaultTime")).prop("disabled",!1),this.$("input[data-date='start']").val(this.model.get("defaultDate")).prop("disabled",!1).trigger("change"),this.model.set("defaultAsNow",!1))},_updateUseBackdrop:function(e){var t=$(e.currentTarget),n=t.is(":checked");this._changeSettingByDefaultAsNow(n),this.model.trigger("change")},_onSelect:function(e){e.stopPropagation();var t=$(e.currentTarget),n=t.find("span.txt").text();this.$("input[data-time='start']").val(n),this.timeSelectView.toggle(!1),this._selectOption()},_onKeydown:function(e){if(e.keyCode&&e.keyCode!=13)return;e.preventDefault();var t=$(e.currentTarget),n=t.val();this.timeSelectView.toggle(!1),this.$("input[data-time='start']").val(m.parseTime(n)),this._selectOption()},_onChange:function(e){var t=$(e.currentTarget),n=t.val();this.$("input[data-time='start']").val(m.parseTime(n)),this._selectOption()},_selectOption:function(){var e=this.timeSelectView.$("input[data-time='start']").val();this.model.set("defaultTime",e)},dateClear:function(){this.$("input[data-date='start']").val("").trigger("change"),this.model.set({defaultDate:""})},toggleClearIcon:function(){this.$(".ic_reset").toggle(!_.isEmpty(this.$("input[data-date='start']").val()))},_onClickAlarmSetting:function(){this.popupView=$.goPopup({pclass:"layer_normal layer_deadline_alarm",header:v["\uc54c\ub78c \uc124\uc815"],buttons:[{autoclose:!1,btext:v["\ud655\uc778"],btype:"confirm",callback:$.proxy(function(){var t=e.getData();if(!t)return!1;this.model.set("useAlarm",t&&!!t.timers.length),this.model.set("alarms",t),this._renderAlarmItems(),t&&this.popupView.close()},this)},{btext:v["\ucde8\uc18c"],btype:"cancel"}]});var e=new a({userFields:this._getUserFields(),alarms:this.model.get("alarms")||{}});this.popupView.find(".content").html(e.render().el),this.popupView.reoffset()},_initAlarmView:function(){this.alarmTagView=t.create([],{useAddButton:!1}),this.alarmTagView.$el.on("nametag:removed",$.proxy(function(){var e=this.alarmTagView.getNameTagList(),t=_.map(e,function(e){return{type:e.type,time:e.time}},this),n=this.model.get("alarms");this.model.unset("alarms"),this.model.set("alarms",_.extend(n,{timers:t})),this.model.set("useAlarm",!!n.timers.length)},this)),this.$("#alarms").append(this.alarmTagView.el),this._renderAlarmItems()},_renderAlarmItems:function(){this.alarmTagView.removeAll();var e=this.model.get("alarms")||{},t=e.timers||[];_.each(t,function(e){var t=e.time+e.type,n=e.time+g[e.type];this.alarmTagView.addTag(t,n,{attrs:{type:e.type,time:e.time},removable:!0})},this)}}),b=s.extend({initialize:function(){s.prototype.initialize.apply(this,arguments),this.validator=new l},render:function(){var t=this.appletDocModel.get(this.getCid());if(!t&&(this.model.get("defaultAsNow")||this.model.get("defaultDate")||this.model.get("defaultTime"))){var n={},r=this._getDefaultValue();n[this.getCid()]=r,this.appletDocModel.set(n)}e.util.isMobile()?this.initRenderMobile():this.initRender()},events:function(){return this.isEditable()?s.prototype.events:_.extend({},s.prototype.events,{"click .ic_reset":"dateClear","click ul[el-time-list] li":"_onSelect","keydown input[data-time]":"_onKeydown","change input[data-time]":"_onChange","change input[data-date]":"_onChangeDate"})},initRender:function(){var t=this.appletDocModel.get("alarms"),n=_.findWhere(t,{fieldCid:this.clientId})||{},r=n.timers,i=_.map(r,function(e){var t=e.type||"";return e.time+g[t.toUpperCase()]}).join(", ");this.$body.html(c({model:this.model.toJSON(),label:e.util.escapeHtml(this.model.get("label")),"isEditable?":this.isEditable(),timersLabel:i})),this.$("input[data-date='start']").datepicker({yearSuffix:"",dateFormat:"yy-mm-dd",changeMonth:!0,changeYear:!0,onSelect:_.bind(function(){this._onChangeDate()},this)}),this.$("input[data-date='start']").val(this._getDate()),this.toggleClearIcon(),this.timeSelectView=new f({useBackdrop:!this.isEditable()}),this.$body.find("span.wrap_select").html(this.timeSelectView.render().el),this.timeSelectView.linkBackdrop(this.$("input[data-time='start']")),this.timeSelectView.$("input[data-time='start']").val(this._getTime()),this.isEditable()&&this.$("input[data-date='start'], input[data-time='start']").prop("disabled",!0)},initRenderMobile:function(){this.$body.html(c({model:this.model.toJSON(),label:e.util.escapeHtml(this.model.get("label")),inputValue:this._getTime(),"isEditable?":this.isEditable(),"isMobile?":e.util.isMobile()})),this.$("input[data-date='start']").datepicker({yearSuffix:"",dateFormat:"yy-mm-dd",changeMonth:!0,changeYear:!0}),this.isEditable()&&this.$("input[data-date='start']").prop("disabled",!0),this.$("input[data-date='start']").val(this._getDate())},dateClear:function(){this.$("input[data-date='start']").val("").trigger("change")},_onChangeDate:function(){this.toggleClearIcon(),this.appletDocModel.set(this.getDataFromView())},toggleClearIcon:function(){this.$(".ic_reset").toggle(!_.isEmpty(this.$("input[data-date='start']").val()))},remove:function(){s.prototype.remove.apply(this,arguments)},_getDate:function(){var t=this.appletDocModel.get(this.clientId)||{},n;this.appletDocModel.id?n="":(n=this.model.get("defaultDate")||"",this.model.get("defaultAsNow")&&(n=moment().format("YYYY-MM-DD")));var r=n,i=_.isArray(t)?_.compact(t).length:t&&t.length>0;return i&&(r=e.util.toMoment(t).format("YYYY-MM-DD")),r},_getTime:function(){var t=this.appletDocModel.get(this.clientId),n;this.appletDocModel.id?n="":(n=this.model.get("defaultTime")||"",this.model.get("defaultAsNow")&&(n=moment().format("HH:mm")));var r=n,i=_.isArray(t)?_.compact(t).length:t&&t.length>0;return i&&(r=e.util.toMoment(t).format("HH:mm")),r},_onSelect:function(e){e.stopPropagation();var t=$(e.currentTarget),n=t.find("span.txt").text();this.$body.find("input[data-time='start']").val(n),this.appletDocModel.set(this.getDataFromView()),this.timeSelectView.toggle(!1)},_onKeydown:function(e){if(e.keyCode&&e.keyCode!=13)return;e.preventDefault();var t=$(e.currentTarget),n=t.val();this.timeSelectView.toggle(!1),this.$body.find("input[data-time='start']").val(m.parseTime(n)),this.appletDocModel.set(this.getDataFromView())},_onChange:function(e){var t=$(e.currentTarget),n=t.val();this.$body.find("input[data-time='start']").val(m.parseTime(n)),this.appletDocModel.set(this.getDataFromView())},getFormData:function(){return this.isMultiple()&&this.appletDocModel.set(this.clientId,this._getMultipleData()),this.appletDocModel.toJSON()},getDataFromView:function(){var e=[],t={};return this.isMultiple()?(e.push(this.getSubmitValue()),_.each(this.getMultipleViews(),function(t){e.push(t.getSubmitValue())})):e=this.getSubmitValue(),t[this.getCid()]=e,t},getSubmitValue:function(){var t,n;n=this.$body.find('input[data-date="start"]').val(),e.util.isMobile()?t=this.$body.find('input[type="time"]').val():t=this.timeSelectView?this.timeSelectView.$('input[data-time="start"]').val():"";var r=_.isEmpty(n)||_.isEmpty(t);return r?null:moment(n+"T"+t)},validate:function(){var t=this.$body.find('input[data-date="start"]'),n=e.util.isMobile()?this.$body.find('input[type="time"]'):this.timeSelectView.$('input[data-time="start"]'),r=this.validator.validate({dateValue:t.val(),timeValue:n.val()},this.model.toJSON());return r.isValid||(r.type=="required_date"?this.printErrorTo(t,r.message):r.type=="required_time"&&this.printErrorTo(n,r.message)),r.isValid},_getDefaultValue:function(){var t=this.model.get("defaultDate"),n=this.model.get("defaultTime");this.model.get("defaultAsNow")&&(t=e.util.now().format("YYYY-MM-DD"),n=e.util.now().format("HH:mm"));var r=_.isEmpty(t)&&_.isEmpty(n);return r?null:moment(t+"T"+n)}}),w=o.extend({render:function(){var t,n=this.appletDocModel.get(this.clientId)||"";n&&(t=e.util.toMoment(this.appletDocModel.get(this.clientId)).format("YYYY-MM-DD(ddd) HH:mm"));var r=this.appletDocModel.get("alarms"),i=_.findWhere(r,{fieldCid:this.clientId})||{},s=i.timers,o=_.map(s,function(e){var t=e.type||"";return e.time+g[t.toUpperCase()]}).join(", ");this.$body.html(h({model:this.model.toJSON(),label:e.util.escapeHtml(this.model.get("label")),userData:t,timersLabel:o}))},getTitle:function(){return e.util.toMoment(this.appletDocModel.get(this.clientId)).format("YYYY-MM-DD(ddd) HH:mm")}}),E=r.define(n.Datetime,{name:d["\ub0a0\uc9dc\uc640 \uc2dc\uac04"],valueType:"DATETIME",group:"basic",properties:{label:{defaultValue:d["\ub0a0\uc9dc\uc640 \uc2dc\uac04"]},hideLabel:{defaultValue:!1},guide:{defaultValue:""},guideAsTooltip:{defaultValue:!0},required:{defaultValue:!1},defaultAsNow:{defaultValue:!1},defaultDate:{defaultValue:""},defaultTime:{defaultValue:""}},OptionView:y,FormView:b,DetailView:w});i.addComponent(E)});