define("works/collections/applet_simples",function(require){var e=require("app"),t=require("when"),n=require("works/libs/util"),r=require("works/models/applet_simple"),i=require("collections/base_collection");return i.extend({comparator:"seq",model:r,initialize:function(e,t){i.prototype.initialize.apply(this,arguments),this.options=t||{},this.url=_.isString(this.options.url)?this.options.url:this.url,this.type=this.options.type||"base",this.folderId=this.options.folderId,this.keyword=this.options.keyword},url:function(){var e=this._makeParam();return this._urlMap()[this.type]+(e?"?"+e:"")},parse:function(e){return _.each(e.data,function(e){e.templateId=e.id,e.asDefault==0&&(e.id="c_"+e.id)}),e.data},_urlMap:function(){return{base:e.config("contextRoot")+"api/works/applets",all:e.config("contextRoot")+"api/works/folders/root",folder:e.config("contextRoot")+"api/works/folders/"+this.folderId+"/applets",favorite:e.config("contextRoot")+"api/works/applets/favorites",manage:e.config("contextRoot")+"api/works/applets/manage",share:e.config("contextRoot")+"api/works/folders/root",accessible:e.config("contextRoot")+"api/works/applets/accessible",search:e.config("contextRoot")+"api/works/applets/accessible/search"}},reorder:function(e){var r=this,i=t.defer();return n.reqReorderList([_.result(this,"urlRoot"),"/applets/favorites"].join("/"),e).then(function(t){_.map(e,function(e,t){var n=r.get(e);n.set("seq",t)}),r.sort(),i.resolve(r)},i.reject),i.promise},urlRoot:function(){return e.config("contextRoot")+"api/works"},setUrl:function(e){this.url=e},mergeAppletToFavorite:function(e){this.each(function(e){e.set("isFavorite",!0)});var t=e.clone();t.each(function(e){var t=this.findWhere({id:e.id});if(_.isObject(t))return;this.push(e)},this)},findByKeyword:function(e){return e?this.filter(function(t){return t.get("name").indexOf(e)>-1}):[]},getType:function(){return this.type},setType:function(e){this.type=e},setFolderId:function(e){this.folderId=e},getFolderId:function(){return this.folderId},setOrder:function(e){this.orderBy=e},setKeyword:function(e){this.keyword=e},_makeParam:function(){var e={};return this.type=="favorite"?$.param(e):(this.options.writable&&(e.onlyWritable="true"),this.orderBy&&(e.orderBy=this.orderBy),this.keyword&&(e.keyword=this.keyword),$.param(e))}})});