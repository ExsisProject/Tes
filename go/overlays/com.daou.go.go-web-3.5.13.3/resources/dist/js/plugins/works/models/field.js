define("works/models/field",function(require){var e=require("app"),t=require("works/constants/field_type"),n=require("works/constants/value_type"),r=require("works/constants/condition_type"),i=require("works/components/filter/models/base_type"),s=require("works/components/formbuilder/form_components/formula/formula_util");return i.extend({initialize:function(){this.modelName="filter_field"},defaults:{cid:"",label:""},fieldToCondition:function(){var e={fieldCid:this.get("cid"),label:this.get("label"),conditionType:this._convertValueTypeToConditionType(),valueType:this.get("valueType")};return this.isSelectValueType()&&(e.options=this.get("options")),e},fieldToColumn:function(){var e=this.toJSON();return{fieldCid:e.cid,fieldLabel:e.label}},isNumberValueType:function(){return n.NUMBER==this.get("valueType")},isDateValueType:function(){return n.DATE==this.get("valueType")},isDateTimeValueType:function(){return n.DATETIME==this.get("valueType")},isTimeValueType:function(){return n.TIME==this.get("valueType")},isFormulaTargetType:function(){return this.isNumberValueType()||this.isDateValueType()||this.isDateTimeValueType()||this.isTimeValueType()},isFieldMappingFieldType:function(){return t.FIELD_MAPPING===this.get("fieldType")},isStatusFieldType:function(){return t.STATUS==this.get("fieldType")},isDocNoType:function(){return t.DOCNO==this.get("fieldType")},isFormulaType:function(){return t.FORMULA==this.get("fieldType")},isAppletDocsValueType:function(){return n.APPLETDOCS==this.get("valueType")},isDayTimeFormulaFieldType:function(){var e=this.get("properties")||{};return this.isFormulaType()&&(_.contains(["time","day"],e.expressionType)||_.contains(["TIME","DATE","DATETIME"],e.dateValueType))},isDateTimeToDayFormulaFieldType:function(){var e=this.get("properties")||{};return this.isFormulaType()&&_.contains("day",e.expressionType)&&_.contains(["DATE","DATETIME"],e.dateValueType)},isDateTimeToTimeFormulaFieldType:function(){var e=this.get("properties")||{};return this.isFormulaType()&&_.contains("time",e.expressionType)&&_.contains(["DATE","DATETIME"],e.dateValueType)},isTimeToTimeFormulaFieldType:function(){var e=this.get("properties")||{};return this.isFormulaType()&&_.contains("time",e.expressionType)&&_.contains("TIME",e.dateValueType)},getDisplayValue:function(t,r){r=r||{};var i=t.get("values")[this.get("cid")];if(this.isStatusFieldType())return t.get("status")?e.util.escapeHtml(t.get("status").name):"-";if(this.isDocNoType())return t.get("docNo")?e.util.escapeHtml(t.get("docNo")):"-";if(_.isUndefined(i)||_.isNull(i))return"-";if(this.isSelectValueType()){var o=this.get("options");i=_.isArray(i)?i:[i];var u=_.map(i,function(e){var t=_.findWhere(o,{value:e});return t?t.displayText:""});return _.compact(u)}if(this.isOrgType())return i=_.isArray(i)?i:[i],_.map(i,function(e){return e.name+" "+(e.position||"")},this);if(this.isDateValueType())return[i.substr(0,4),i.substr(4,2),i.substr(6,2)].join("-");if(this.isDateTimeValueType())return moment(i).format("YYYY-MM-DD HH:mm");if(this.isNumberValueType()){if(!r)return i;if(r.expressionType!="time"){if(r.expressionType=="day")return r.dateValueType==n.DATE||r.dateValueType==n.DATETIME?s.dateTimeToDayDisplayText(i):i;var a=r.dataType?r.dataType:"NUMBER";return a=="PERCENT"?i+" "+"%":a=="POINT"?i:(r.thousandComma&&(i=e.util.numberWithCommas(i)),r.fixType=="prefix"?r.unitText+" "+i:r.fixType=="postfix"?i+" "+r.unitText:i)}if(r.dateValueType==n.TIME)return s.timeToTimeDisplayText(i);if(r.dateValueType==n.DATE||r.dateValueType==n.DATETIME)return s.dateTimeToTimeDisplayText(i)}if(this.isAppletDocsValueType()){var f=_.compact(_.map(i,function(t){var n=t.text,i=r.dataType?r.dataType:"NUMBER";return i=="PERCENT"?n+" "+"%":i=="POINT"?n:(r.thousandComma&&(n=e.util.numberWithCommas(n)),r.fixType=="prefix"?r.unitText+" "+n:r.fixType=="postfix"?n+" "+r.unitText:n)}));return f.length?f:"-"}if(this.isTextValueType()){var l=_.isArray(i)?_.compact(i).join(", "):i;return e.util.textToHtml(l?l:"-")}return e.util.textToHtml(_.isString(i)?i:"-")},convertDateTimeValue:function(e){if(_.isString(e)&&e.length>0){if(this.isDateValueType())return e.split("-").join("");if(this.isDateTimeValueType())return moment(e,"YYYY-MM-DD HH:mm").format("YYYY-MM-DDTHH:mm:ss.SSSZ")}return e},convertDateTimeAndNumberFormat:function(e,t){if(!e)return e;if(this.isDateValueType())return[e.substr(0,4),e.substr(4,2),e.substr(6,2)].join("-");if(this.isDateTimeValueType())return moment(e).format("YYYY-MM-DD HH:mm");if(this.isNumberValueType()){if(!t||!e)return e;if(t.expressionType!="time")return t.expressionType=="day"?t.dateValueType==n.DATE||t.dateValueType==n.DATETIME?s.dateTimeToDayDisplayText(e):e:e;if(t.dateValueType==n.TIME)return s.timeToTimeDisplayText(e);if(t.dateValueType==n.DATE||t.dateValueType==n.DATETIME)return s.dateTimeToTimeDisplayText(e)}return null},getDisplayValueContainsTemplate:function(t,r){r=r||{};var i=t.get("values")[this.get("cid")];if(this.isNumberValueType()){var o=r.expressionType=="time"||r.expressionType=="day";if(!r||o&&!i)return i;if(r.expressionType!="time"){if(r.expressionType=="day")return r.dateValueType==n.DATE||r.dateValueType==n.DATETIME?s.dateTimeToDayDisplayText(i):i;var u=r.dataType?r.dataType:"NUMBER";return u!="NUMBER"&&(_.isUndefined(i)||_.isNull(i))&&(i=""),u=="PERCENT"?this.getPercentTemplate(i):u=="POINT"?this.getPointTemplate(i,r):(r.thousandComma&&(i=e.util.numberWithCommas(i)),r.fixType=="prefix"?r.unitText+" "+i:r.fixType=="postfix"?i+" "+r.unitText:i)}if(r.dateValueType==n.TIME)return s.timeToTimeDisplayText(i);if(r.dateValueType==n.DATE||r.dateValueType==n.DATETIME)return s.dateTimeToTimeDisplayText(i)}if(this.isAppletDocsValueType()){var a=this,f=_.compact(_.map(i,function(t){var n=t.text,i=r.dataType?r.dataType:"NUMBER";return i!="NUMBER"&&(_.isUndefined(n)||_.isNull(n))&&(n=""),i=="PERCENT"?a.getPercentTemplate(n):i=="POINT"?a.getPointTemplate(n,r):(r.thousandComma&&(n=e.util.numberWithCommas(n)),r.fixType=="prefix"?r.unitText+" "+n:r.fixType=="postfix"?n+" "+r.unitText:n)}));return f.length?f:"-"}return this.getDisplayValue(t,r)},getOrgTemplateValue:function(e,t){if(this.isOrgType()){var r=[],i=_.contains(n.MULTI_VALUED_TYPES,this.get("valueType"));return i&&r.push("item"),_.isUndefined(e)||_.isNull(e)?"":(e=_.isArray(e)?e:[e],_.map(e,function(e){var n=e.position?" "+e.position:"",i=(t===!1?!1:this.isUserType())?"data-profile":"";return'<span class="'+r.join(" ")+'" '+i+' data-id="'+e.id+'">'+e.name+n+"</span>"},this))}return e},getValue:function(t,n){n=n||{};var r=t.get("values")[this.get("cid")];if(this.isStatusFieldType())return t.get("status")?e.util.escapeHtml(t.get("status").name):"";if(this.isDocNoType())return t.get("docNo")?t.get("docNo"):"";if(_.isUndefined(r)||_.isNull(r))return"";if(this.isSelectValueType())return _.isArray(r)?r:[r];if(this.isOrgType())return r=_.isArray(r)?r:[r],_.map(r,function(e){return e.name+" "+(e.position||"")},this);var i=this.convertDateTimeAndNumberFormat(r,n);if(i)return i;if(this.isAppletDocsValueType()){var s=_.compact(_.map(r,function(t){var r=t.text;return n.thousandComma&&(r=e.util.numberWithCommas(r)),n.fixType==="prefix"?n.unitText+" "+r:n.fixType==="postfix"?r+" "+n.unitText:r}));return s.length?s:""}if(this.isTextValueType()){var o=_.isArray(r)?_.compact(r).join(", "):r;return e.util.htmlToText(o)}return r},_convertValueTypeToConditionType:function(){switch(this.get("valueType")){case n.NUMBER:case n.FORMULA:return r.NUMBER;case n.DATE:return r.DATE;case n.TIME:return r.TIME;case n.DATETIME:return r.DATETIME;case n.SELECT:case n.SELECTS:case n.USER:case n.USERS:case n.DEPTS:return r.SELECT;case n.STEXT:case n.STEXTS:case n.TEXT:case n.FILES:case n.APPLETDOCS:return r.TEXT;default:this.get("valueType")}},getPercentTemplate:function(e){return e=e?e:0,'<span class="com_gage"><span class="wrap_gage"><span class="gage" id="percentGage" style="width:'+e+'%"></span>'+"</span>"+'<span class="txt">'+e+"%</span>"+"</span>"},getPointTemplate:function(e,t){var n='<span class="com_rate"><span class="wrap_rate">';for(var r=0;r<t.maxLength;r++){var i=r<parseFloat(e)?"":"ic_star_off";n=n+'<ins style="cursor: default;" class="ic_star '+i+'"></ins>'}return n+"</span></span>"}})});