define("works/components/formbuilder/form_components/input_file/input_file",function(require){var e=require("app"),t=require("works/component_type"),n=require("works/components/formbuilder/core/form_component"),r=require("works/components/formbuilder/core/component_registry"),i=require("works/components/formbuilder/core/views/base_form"),s=require("works/components/formbuilder/core/views/base_detail"),o=require("works/components/formbuilder/core/views/base_option"),u=require("hgn!works/components/formbuilder/form_components/input_file/form"),a=require("hgn!works/components/formbuilder/form_components/input_file/detail"),f=require("hgn!works/components/formbuilder/form_components/input_file/option"),l=require("attach_file"),c=require("file_upload"),h=require("works/libs/util"),p=require("components/go-fileuploader/mobile"),d=require("webfolder/views/mobile/m_home"),v=Hogan.compile('<li data-path="{{path}}" data-name="{{name}}" data-id="{{id}}"><span class="item_image"><span class="thumb"><img src="{{thumbSmall}}" alt="{{name}}"></span><span class="img_tit">{{name}}</span><span class="txt">({{size}})</span><a class="iscroll-tap-highlight"><span class="btn_wrap" data-btntype="attachDelete"><span class="ic ic_del"></span></span></a></span></li>'),m=Hogan.compile('<li class="{{errorClass}}" data-path="{{attach.path}}" data-name="{{attach.name}}" data-id="{{attach.id}}"><span class="item_file"><span class="ic_file {{style}}"></span><span class="name">{{attach.name}}</span><span class="size"> ({{fileSizeStr}})</span><span class="optional" data-btntype="attachDelete"><a class="wrap_ic_file"><span class="txt ic ic_file_del"></span></a></span> {{errorMessage}}</span></li>'),g=require("i18n!works/nls/works"),y=require("i18n!nls/commons"),b={"\uc774\ub984":y["\uc774\ub984"],"\uc774\ub984\uc228\uae30\uae30":g["\uc774\ub984\uc228\uae30\uae30"],"\uc124\uba85":g["\uc124\uba85"],"\uc774\ub984\uc744 \uc785\ub825\ud574\uc8fc\uc138\uc694":g["\uc774\ub984\uc744 \uc785\ub825\ud574\uc8fc\uc138\uc694."],"\uc124\uba85\uc744 \uc785\ub825\ud574\uc8fc\uc138\uc694":g["\uc124\uba85\uc744 \uc785\ub825\ud574\uc8fc\uc138\uc694."],"\ud234\ud301\uc73c\ub85c \ud45c\ud604":g["\ud234\ud301\uc73c\ub85c \ud45c\ud604"],"\ud544\uc218 \uc785\ub825 \ucef4\ud3ec\ub10c\ud2b8":g["\ud544\uc218 \uc785\ub825 \ucef4\ud3ec\ub10c\ud2b8"],"\ud30c\uc77c\ucca8\ubd80":y["\ud30c\uc77c\ucca8\ubd80"],save:y["\ub2e4\uc6b4\ub85c\ub4dc"],preview:y["\ubbf8\ub9ac\ubcf4\uae30"],"\uc774 \uacf3\uc5d0 \ud30c\uc77c\uc744 \ub4dc\ub798\uadf8 \ud558\uc138\uc694":y["\uc774 \uacf3\uc5d0 \ud30c\uc77c\uc744 \ub4dc\ub798\uadf8 \ud558\uc138\uc694"],"\uc774 \uacf3\uc5d0 \ud30c\uc77c\uc744 \ub4dc\ub798\uadf8 \ud558\uc138\uc694 \ub610\ub294":y["\uc774 \uacf3\uc5d0 \ud30c\uc77c\uc744 \ub4dc\ub798\uadf8 \ud558\uc138\uc694 \ub610\ub294"],"\ud30c\uc77c\uc120\ud0dd":y["\ud30c\uc77c\uc120\ud0dd"],"\ucca8\ubd80\ud30c\uc77c 1\uac1c\uc758 \ucd5c\ub300 \uc6a9\ub7c9\uc740 NNN MB \uc774\uba70 \ucd5c\ub300 N\uac1c \uae4c\uc9c0 \ub4f1\ub85d \uac00\ub2a5\ud569\ub2c8\ub2e4":e.i18n(y["\ucca8\ubd80\ud30c\uc77c 1\uac1c\uc758 \ucd5c\ub300 \uc6a9\ub7c9\uc740 {{size}} MB \uc774\uba70 \ucd5c\ub300 {{number}} \uac1c \uae4c\uc9c0 \ub4f1\ub85d \uac00\ub2a5\ud569\ub2c8\ub2e4"],{size:e.config("commonAttachConfig").maxAttachSize,number:e.config("commonAttachConfig").maxAttachNumber})},w=o.extend({renderBody:function(){this.$el.html(f({lang:b,model:this.model.toJSON()}))}}),E=i.extend({isInitFileUploader:!1,isSaaS:e.session().brandName=="DO_SAAS",totalAttachSize:0,totalAttachCount:0,render:function(){this.$body.html(u({lang:b,"editable?":this.isEditable(),"hasAttach?":this.appletDocModel.get(this.clientId)?!0:!1,"isMobile?":e.util.isMobile(),"isMobileApp?":e.config("isMobileApp"),"isAndroidApp?":e.util.isAndroidApp(),"isWebFolderUsable?":e.config("isWebFolderAvailable"),label:e.util.escapeHtml(this.model.get("label")),model:this.model.toJSON(),isSaaS:this.isSaaS})),this.isEditable()||(this.appletDocModel.get(this.clientId)&&this.renderAttaches(this.appletDocModel.get(this.clientId)),e.config("isMobileApp")?this.setAttachCallBack():setTimeout($.proxy(function(){this.isInitFileUploader||(this.isInitFileUploader=!0,this.initFileUpload())},this),500))},attachValidate:function(t){var n=null,r=e.util.getFileNameAndTypeData(t);e.config("allowedFileUploadSize")&&(n=e.config("allowedFileUploadSize")/1024/1024);try{$.goValidation.attachValidate("#attachWrap ul li",r,n),e.session().brandName=="DO_SAAS"&&p.attachFileValidateBySaaS(r.size)}catch(i){var s=i.message;if(s=="AttachSizeException")e.util.delayAlert(e.i18n(y["\ucca8\ubd80\ud560 \uc218 \uc788\ub294 \ucd5c\ub300 \uc0ac\uc774\uc988\ub294 0MB \uc785\ub2c8\ub2e4."],"arg1",n));else{if(s=="AttachNumberExceptionBySaaS")throw e.util.delayAlert(e.i18n(y["\ucd5c\ub300 \ucca8\ubd80 \uac2f\uc218\ub294 0\uac1c \uc785\ub2c8\ub2e4."],"arg1",e.config("commonAttachConfig").maxAttachNumber)),new Error("overMaxAttachNumber");s=="NotFoundExtException"&&e.util.delayAlert(y["\ucca8\ubd80\ud560 \uc218 \uc5c6\ub294 \ud30c\uc77c \uc785\ub2c8\ub2e4."])}throw new Error("Attach Validation Error")}},events:function(){return e.util.isMobile()?this.isEditable()?i.prototype.events:_.extend({},i.prototype.events,{"change input[type='file']":"upload","vclick #attachWrap span[data-btntype=attachDelete]":"attachDelete","vclick #callFile":"callFile","vclick #btnAttachLayer":"btnAttachLayer","vclick #attachWebfolder":"attachWebfolder"}):this.isEditable()?i.prototype.events:_.extend({},i.prototype.events,{"click span.ic_del":"attachDelete","dragover .dropZone":"_dragOver","dragleave .dropZone":"_dragLeave","drop .dropZone":"_drop"})},_dragOver:function(e){e.preventDefault(),e.stopPropagation(),e.originalEvent.dataTransfer.dropEffect="move",$(e.currentTarget).addClass("drag_file")},_dragLeave:function(e){e.preventDefault(),e.stopPropagation(),$(e.currentTarget).removeClass("drag_file")},_drop:function(e){this._dragLeave(e)},callFile:function(){if(!this.fileUploadCountValidate())return!1;var t=e.config("allowedFileUploadSize")?e.config("allowedFileUploadSize")/1024/1024:-1,n=e.config("commonAttachConfig").maxAttachNumber-this.$("#attachWrap li").size();h.callFile(this.clientId,t,n)},btnAttachLayer:function(e){return $("div.option_display").data("attachable","true"),this.toggleAttachEl(),!1},toggleAttachEl:function(){$("#attachLayer").css("display")=="block"?this.closeAttachLayer():($("input").blur().focusout(),this.setAttachOverlay(),this.openAttachLayer())},closeAttachLayer:function(){$("#popAttachOverlay").remove(),$("#attachLayer").hide()},openAttachLayer:function(){var e=$("#attachLayer");$(window).height()<$(".go_content").height()&&e.css("top","25%"),e.show(),this.bindCustomEvent()},bindCustomEvent:function(){var e=this;$("#callCamera").off("vclick"),$("#callAlbum").off("vclick"),$("#callCamera").on("vclick",function(){return e.closeAttachLayer(),e.callCameraComponent(),!1}),$("#callAlbum").on("vclick",function(){return e.closeAttachLayer(),e.callAlbumComponent(),!1})},setAttachOverlay:function(){var e=this,t=$('<div id="popAttachOverlay" class="overlay" style="z-index:101"/>');this.closeAttachLayer(),$(".go_wrap").after(t);var n=function(){$("#popAttachOverlay").click(function(t){e.toggleAttachEl(t)})};setTimeout(n,1e3)},callAlbumComponent:function(){h.callAlbum(this.clientId)},callCameraComponent:function(){h.callCamera(this.clientId)},fileUploadCountValidate:function(){var t=this.$("#attachWrap li").size(),n=e.config("commonAttachConfig").maxAttachNumber;return t>=n?(alert(e.i18n(y["\ucd5c\ub300 \ucca8\ubd80 \uac2f\uc218\ub294 0\uac1c \uc785\ub2c8\ub2e4."],"arg1",n)),!1):!0},attachWebfolder:function(e){var t=this;return this.webFolderView=new d({}),$("#goBody").hide(),this.webFolderView.render({callback:function(e){return t.uploadWebFolder(e),!1}}),!1},upload:function(t){var n=this,r=$(t.currentTarget),i=r.get(0).files||{};_.each(i,function(t){var r=new FormData;r.append("file",t),r.append("GOSSOcookie",$.cookie("GOSSOcookie")),$.ajax({url:e.contextRoot+"api/file",type:"POST",contentType:!1,processData:!1,data:r,success:function(e){n.attachFileSuccess(e)}})}),r.val("")},uploadWebFolder:function(t){var n=this;$.ajax({url:"/api/webfolder/mail/attach/write",type:"POST",contentType:"application/json; charset=UTF-8",processData:!1,data:JSON.stringify(t),async:!1}).done(function(t){setTimeout(function(){e.util.appLoading(!1),n.checkUploadFile(t)},1e3)})},checkUploadFile:function(e){var t=this;_.each(e.data,function(n){var r={code:e.code,message:e.message};r.data={filePath:n.upkey,fileSize:n.size,fileName:n.name,hostId:n.hostId,uid:n.uid?n.uid:"",type:"normal",notChage:!0,fileExt:n.extension,thumbnail:["/thumb/temp/",n.hostId,"/small",n.upkey].join("")},t.attachFileSuccess(r)})},attachParser:function(e){return{extention:e.fileExt,name:e.fileName,path:e.filePath,size:e.fileSize,thumbSmall:e.thumbnail}},attachFileSuccess:function(t){var n="",r="";!e.config("isMobileApp")&&e.util.fileUploadErrorCheck(t)&&(n="<strong class='caution'>"+e.util.serverMessage(t)+"</strong>",r="attachError");var i=typeof t=="string"?JSON.parse(t):t.data;try{this.attachValidate(i)}catch(s){s.message==="overMaxAttachNumber"&&$("#div.option_display").data("attachable","false");return}this.$("#attachWrap").show(),this.addAttachEl(this.attachParser(i),n,r),this.appletDocModel.set(this.getDataFromView())},setAttachCallBack:function(){var e=this,t="attachFileSuccess"+this.clientId;window[t]=function(t){e.attachFileSuccess(t)}},addAttachEl:function(t,n,r){var i=t.extention;t.size=e.util.getHumanizedFileSize(t.size),e.util.isImage(i)?this.$(".img_wrap").append(v.render(t)).show():this.$(".file_wrap").append(m.render({attach:t,errorMessage:n,errorClass:r,fileSizeStr:t.size,style:e.util.getFileIconStyle(t)})).show()},renderAttaches:function(t){var n=this,r="editModeAttachArea",i=l.create(null,t,"temp","edit");i.done(function(i){n.$("#"+r).replaceWith(i.el),$(i.$el).find("span.name").each(function(e,t){$(t).html($(t).text()).addClass("cursor_def")}),i.$el.attr({id:r}),t.length>0&&n.$("#attachWrap").show(),i.$el.on("removedFile",function(){e.util.isMobile()&&n.afterMobileAttachDelete()}),n.listenTo(i.observer,"removeFile",$.proxy(function(){n.appletDocModel.set(n.getDataFromView())},this));var s=0;_.each(t,function(e,t){s+=parseInt(e.size,0)}),$(i.$el).closest("div.dropZone").find("span.total_size").html(e.util.displayHumanizedAttachSizeStatus(s))})},attachDelete:function(t){t.preventDefault(),$(t.target).closest("li").remove(),e.util.isMobile()?this.$("#attachWrap").find("li").length<1&&this.$("#attachWrap").hide():this.setViewedTotalAttachSize(),this.appletDocModel.set(this.getDataFromView())},afterMobileAttachDelete:function(){this.$("#attachWrap").find("li").length<2&&this.$("#attachWrap").hide()},initFileUpload:function(t){var n=e.util.useButtonWindow(),r=this,t={el:this.$("#swfupload-control"),context_root:e.contextRoot,useButtonWindow:n,button_title:b["\ud30c\uc77c\uc120\ud0dd"],button_text:"<span class='txt'>"+b["\ud30c\uc77c\uc120\ud0dd"]+"</span>",url:"api/file?GOSSOcookie="+$.cookie("GOSSOcookie"),textTmpl:["<span class='btn_file''>","{text}","<input type='file' name='file' title='{title}' multiple='' accept={accept} />","</span>"].join(""),dropZone:'div[data-cid="'+this.clientId+'"] div.dropZone',progressEl:"div[data-cid="+this.clientId+"] div.progress"};n&&(t.button_height=26),r.setViewedTotalAttachSize();var i=parseInt(e.config("commonAttachConfig").maxAttachSize),s=i*1024*1024,o=parseInt(e.config("commonAttachConfig").maxAttachNumber);(new c(t)).queue(function(e,t){}).start(function(t,n){if(!e.config("attachFileUpload"))return $.goAlert(y["\ud30c\uc77c\ucca8\ubd80\uc6a9\ub7c9\ucd08\uacfc"]),r.$el.find("div.dropZone").removeClass("drag_file"),!1;if(r.isSaaS){if(s<n.size)return $.goMessage(e.i18n(y["\ucca8\ubd80\ud560 \uc218 \uc788\ub294 \ucd5c\ub300 \uc0ac\uc774\uc988\ub294 0MB \uc785\ub2c8\ub2e4."],"arg1",i)),r.$el.find("div.dropZone").removeClass("drag_file"),!1;r.totalAttachSize+=n.size;var u=$("div[data-cid="+this.clientId).find("li").length+r.totalAttachCount+1;if(o<u)return $.goMessage(e.i18n(y["\ucd5c\ub300 \ucca8\ubd80 \uac2f\uc218\ub294 0\uac1c \uc785\ub2c8\ub2e4."],"arg1",o)),r.$el.find("div.dropZone").removeClass("drag_file"),!1;r.totalAttachCount++}}).progress(function(e,t){}).success(function(t,n,i){if(e.util.fileUploadErrorCheck(n))i.find(".item_file").append("<strong class='caution'>"+e.util.serverMessage(n)+"</strong>"),i.addClass("attachError");else if(e.util.isFileSizeZero(n))return $.goAlert(e.util.serverMessage(n)),!1;var s=n.data.hostId,o=n.data.fileSize,u=e.util.getHumanizedFileSize(o),a=n.data.fileName;i.attr("data-hostId",s),i.attr("data-size",o),e.util.isImage(n.data.fileExt)?(i.find(".item_image").append("<span class='name'>"+a+"</span>"+"<span class='size'>("+u+")</span>"),r.$el.find("#createModeAttachArea").find("ul.img_wrap").append(i)):(r.$el.find("#createModeAttachArea").find("ul.file_wrap").append(i),$(i).find("span.name").addClass("cursor_def")),r.appletDocModel.set(r.getDataFromView()),r.setViewedTotalAttachSize(),r.resetAttachSizeAndCount()}).complete(function(e,t){}).error(function(e,t){t.jqXHR&&(t.jqXHR.statusText=="abort"?$.goAlert(y["\ucde8\uc18c\ub418\uc5c8\uc2b5\ub2c8\ub2e4."]):$.goAlert(y["\uc5c5\ub85c\ub4dc\uc5d0 \uc2e4\ud328\ud558\uc600\uc2b5\ub2c8\ub2e4."]),r.resetAttachSizeAndCount())})},validate:function(){return this.model.get("required")&&this.$("li").length<1?(this.printErrorTo(this.$(".btn_minor_s"),g["\ud544\uc218 \ud56d\ubaa9\uc785\ub2c8\ub2e4."]),!1):!0},getDataFromView:function(){var e={};return e[this.clientId]=this.getAttaches(),e},getAttaches:function(){this.setViewedTotalAttachSize();var e=[];return _.each(this.$("li:not(.attachError)"),function(t){if($(t).is(":hidden")){$(t).remove();return}e.push({id:$(t).attr("data-id")||null,path:$(t).attr("data-path"),name:$(t).attr("data-name"),hostId:$(t).attr("data-hostId")})}),e},getViewedTotalAttachSize:function(){var e=0;return $("div[data-cid="+this.clientId).find("#dropZone li").each(function(t,n){e+=parseInt(n.getAttribute("data-size"),0)}),e},setViewedTotalAttachSize:function(){if(this.isSaaS){var t=this.getViewedTotalAttachSize();$("div[data-cid="+this.clientId).find("span.total_size").html(e.util.displayHumanizedAttachSizeStatus(t))}},resetAttachSizeAndCount:function(){this.isSaaS&&(this.totalAttachSize=0,this.totalAttachCount=0)}}),S=s.extend({render:function(){this.$body.html(a({model:this.model.toJSON(),label:e.util.escapeHtml(this.model.get("label"))})),this.renderAttach()},renderAttach:function(){var t=this,n="attachArea",r=l.create(null,this.appletDocModel.get(this.clientId),function(n){return e.contextRoot+"api/works/applets/"+t.getAppletId()+"/docs/"+t.docId+"/download/"+n.id});r.done(function(e){t.$("#"+n).replaceWith(e.el),e.$el.addClass("feed origin"),e.$el.attr({id:n,"data-type":"view"})})}}),x=n.define(t.File,{name:y["\ud30c\uc77c\ucca8\ubd80"],valueType:"FILES",group:"basic",properties:{label:{defaultValue:y["\ud30c\uc77c\ucca8\ubd80"]},hideLabel:{defaultValue:!1},guide:{defaultValue:""},guideAsTooltip:{defaultValue:!0},required:{defaultValue:!1}},OptionView:w,FormView:E,DetailView:S});r.addComponent(x)});