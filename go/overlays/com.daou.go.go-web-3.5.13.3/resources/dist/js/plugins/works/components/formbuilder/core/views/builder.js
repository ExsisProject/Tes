define("works/components/formbuilder/core/views/builder",function(require){var e=require("backbone"),t=require("works/components/formbuilder/core/models/adapters"),n=require("works/models/applet_form"),r=require("works/components/formbuilder/core/views/form_toolbox"),i=require("works/components/formbuilder/core/views/form_design"),s=require("works/components/formbuilder/constants");return e.View.extend({className:"formbuilder build_body",toolboxView:null,designView:null,appletId:null,observer:null,model:null,initialize:function(o){o=o||{},this.$el.empty(),this.observer=_.extend({},e.Events),this.appletId=null,o.hasOwnProperty("appletId")&&(this.appletId=o.appletId);var u={appletId:this.appletId,observer:this.observer,appletFormModel:o.model};u.appletFormModel.subFormId&&(this.mainFormModel=new n({appletId:this.appletId}),this.mainFormModel.fetch({async:!1}),u.mainFormModel=this.mainFormModel),this.toolboxView=new r(u),u.model=t.toAppletFormModel(this.model),this.designView=new i(u),this.listenTo(this.observer,s.REQ_FORM_SAVE,this._requestFormSave),this.listenTo(this.observer,s.REQ_DELETE_SUBFORM,this._requestDeleteSubForm),this.listenTo(this.observer,s.REQ_GOTO_SETTINGS_HOME,this._requestGoToSettingsHome),this.listenTo(this.observer,s.REQ_GOTO_APP_HOME,this._requestGoToAppHome),this.listenTo(this.observer,s.REQ_CHANGE_FORM,this._requestChangeForm),this.listenTo(this.observer,s.REQ_CREATE_FORM,this._requestCreateForm)},render:function(){this.$el.append(this.toolboxView.el,this.designView.el),this.toolboxView.render(),this.designView.render(),this._bindDocumentClickEvent()},remove:function(){e.View.prototype.remove.apply(this,arguments),this.toolboxView.remove(),this.designView.remove(),this.observer.off(),$(document).off(".canvas-container")},attachTo:function(e){this.$el.appendTo(e),this.render()},resize:function(e){this.toolboxView.resize(e),this.designView.resize(e)},setContenTopElement:function(e){this.designView.setContenTopElement(e)},_bindDocumentClickEvent:function(){function e(e,t){if(e&&e.which===3)return;if($(e.target).closest(document).length<1)return;if(!t)return;$(document).trigger($.Event(t,{relatedTarget:e.target}))}function t(t){e(t,s.EVENT_SELECT_COMPONENT)}$(document).on("click.canvas-container",t)},_requestFormSave:function(e,t,n){this.trigger(s.REQ_FORM_SAVE,e,t,n)},_requestDeleteSubForm:function(e,t,n){this.trigger(s.REQ_DELETE_SUBFORM,e,t,n)},_requestGoToSettingsHome:function(){this.trigger(s.REQ_GOTO_SETTINGS_HOME)},_requestGoToAppHome:function(){this.remove(),this.trigger(s.REQ_GOTO_APP_HOME)},_requestChangeForm:function(e){var t=this;GO.EventEmitter.trigger("common","layout:setOverlay",""),setTimeout(function(){t.trigger(s.REQ_CHANGE_FORM,e),GO.EventEmitter.trigger("common","layout:clearOverlay",!0)},600)},_requestCreateForm:function(){this.trigger(s.REQ_CREATE_FORM)}})});