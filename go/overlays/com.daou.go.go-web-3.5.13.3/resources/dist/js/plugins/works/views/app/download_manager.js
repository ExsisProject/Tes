define("works/views/app/download_manager",function(require){var e=require("i18n!nls/commons"),t=require("i18n!works/nls/works"),n={"\uc9c4\ud589\uc911":e["\uc9c4\ud589\uc911"],"\ub2e4\uc6b4\ub85c\ub4dc":e["\ub2e4\uc6b4\ub85c\ub4dc"],"\uad00\ub9ac":t["\uad00\ub9ac"],"\ud398\uc774\uc9c0 \uc81c\ubaa9":t["\ub370\uc774\ud130 \ubaa9\ub85d \ub2e4\uc6b4\ub85c\ub4dc"],"\ud398\uc774\uc9c0 \uc124\uba85":t["\ub370\uc774\ud130 \ubaa9\ub85d \ub2e4\uc6b4\ub85c\ub4dc \uc124\uba85"],"\uc5f0\uacb0\ub41c \uc571":t["\uc5f0\uacb0\ub41c \uc571"],"\uc5f0\uacb0 \ucef4\ud3ec\ub10c\ud2b8":t["\uc5f0\uacb0 \ucef4\ud3ec\ub10c\ud2b8"],"\uc2e0\uccad\uc790":t["\uc2e0\uccad\uc790"],"\uc5f0\uacb0 \uad8c\ud55c":t["\uc5f0\uacb0 \uad8c\ud55c"],"\ubcf4\uae30 \uad8c\ud55c":t["\ubcf4\uae30 \uad8c\ud55c"],"\ucc38\uc870\ubaa9\ub85d \uc124\uba85":t["\ucc38\uc870\ubaa9\ub85d \uc124\uba85"],"\ubaa9\ub85d\uc774 \uc5c6\uc2b5\ub2c8\ub2e4":t["\ubaa9\ub85d\uc774 \uc5c6\uc2b5\ub2c8\ub2e4."],"\uc2e0\uccad\uc77c":t["\uc2e0\uccad\uc77c"],"\ud544\ud130":t["\ud544\ud130"],"\ub370\uc774\ud130 \uc218":t["\ub370\uc774\ud130 \uc218"],"\ub2e4\uc6b4\ub85c\ub4dc \uc0c1\ud0dc":t["\ub2e4\uc6b4\ub85c\ub4dc \uc0c1\ud0dc"],"\ube44\uace0":t["\ube44\uace0"],"\ubaa9\ub85d \ub2e4\uc6b4\ub85c\ub4dc \uc774\ub825":t["\ubaa9\ub85d \ub2e4\uc6b4\ub85c\ub4dc \uc774\ub825"],"\ub2e4\uc6b4\ub85c\ub4dc \ubaa9\ub85d \uc0ad\uc81c \uc54c\ub9bc":t["\ub2e4\uc6b4\ub85c\ub4dc \ubaa9\ub85d \uc0ad\uc81c \uc54c\ub9bc"],"\ub300\uae30":t["\ub300\uae30"],"\ud30c\uc77c\uc0ad\uc81c":t["\ud30c\uc77c\uc0ad\uc81c"],"\ud30c\uc77c \uc0ad\uc81c":t["\ud30c\uc77c \uc0ad\uc81c"],"\ucca8\ubd80\ud30c\uc77c\uc744 \uc0ad\uc81c\ud558\uc2dc\uaca0\uc2b5\ub2c8\uae4c?":t["\ucca8\ubd80\ud30c\uc77c\uc744 \uc0ad\uc81c\ud558\uc2dc\uaca0\uc2b5\ub2c8\uae4c?"],"\uc9c4\ud589 \ucde8\uc18c":t["\uc9c4\ud589 \ucde8\uc18c"],"\uc9c4\ud589 \ucde8\uc18c \uc124\uba85":t["\uc9c4\ud589 \ucde8\uc18c \uc124\uba85"]},r=require("works/constants/download_state_type"),i=require("grid"),s=require("works/views/app/base_setting"),o=require("hgn!works/templates/app/download_manager"),u=require("works/components/filter/collections/filter_conditions"),a=require("collections/paginated_collection"),f=a.extend({url:function(){return GO.config("contextRoot")+"api/works/applets/"+this.appletId+"/docs/export?"+this.makeParam()},setAppletId:function(e){this.appletId=e}});return s.extend({className:"go_content go_renew go_works_home app_temp",events:_.extend(s.prototype.events,{"click [el-cancel-btn]":"_onClickCancel","click [el-download-btn]":"_onClickFileDownload","click [el-fileDelete-btn]":"_onClickFileDelete"}),initialize:function(o){this.lang=n,this.appletId=o.appletId,o.isPageActionUse=!1,s.prototype.initialize.call(this,o),this.collection=new f,this.collection.setAppletId(this.appletId),this.listView=new i({tableClass:"type_normal",useToolbar:!1,checkbox:!1,collection:this.collection,columns:[{name:"requester",className:"name",label:t["\uc2e0\uccad\uc790"],sortable:!0,render:function(e){return e.get("requester").name}},{name:"createdAt",className:"date",label:t["\uc2e0\uccad\uc77c"],sortable:!0,render:function(e){return GO.util.basicDate2(e.get("createdAt"))}},{name:"filter",className:"filter",label:t["\ud544\ud130"],sortable:!1,render:function(e){var t="",n=new u(e.get("conditions"));return e.get("conditionText")?t=e.get("conditionText"):n.length>0&&(t=n.getLabelTexts()),'<span class="txt" data-condition-label>'+t+"</span>"}},{name:"totalCount",className:"data_num",label:t["\ub370\uc774\ud130 \uc218"],sortable:!0,render:function(e){if(e.toJSON().hasOwnProperty("totalCount")&&e.toJSON().hasOwnProperty("progressCount")){var t=e.get("status");if((t==r.DONE||t==r.FILE_DELETED)&&e.get("totalCount")==e.get("progressCount"))return GO.util.numberWithCommas(e.get("totalCount"))}return"-"}},{name:"download_status",className:"downloading",label:t["\ub2e4\uc6b4\ub85c\ub4dc \uc0c1\ud0dc"],render:function(n){var i=n.get("status"),s=n.get("id"),o="";switch(i){case r.READY:o='<span class="txt">'+t["\ub300\uae30"]+"</span>"+'<span class="btn_fn7" el-cancel-btn id="'+s+'">'+'<span class="txt">'+e["\ucde8\uc18c"]+"</span>"+"</span>";break;case r.PROGRESS:var u=n.toJSON().hasOwnProperty("totalCount")?n.get("totalCount"):-1,a=n.toJSON().hasOwnProperty("progressCount")?n.get("progressCount"):0;if(u>=0&&a>=0){var f=Math.round(a/u*100);o='<span class="txt">'+e["\uc9c4\ud589\uc911"]+"("+f+"%)</span>"+'<span class="btn_fn7" el-cancel-btn id="'+s+'">'+'<span class="txt">'+e["\ucde8\uc18c"]+"</span>"+"</span>"}else o='<span class="txt">-</span>';break;case r.DONE:o='<span class="btn_fn7" el-download-btn id="'+s+'">'+'<span class="txt">'+e["\ub2e4\uc6b4\ub85c\ub4dc"]+"</span>"+"</span>"+'<span class="btn_fn7" el-fileDelete-btn id="'+s+'">'+'<span class="txt">'+t["\ud30c\uc77c\uc0ad\uc81c"]+"</span>"+"</span>";break;case r.FILE_DELETED:o='<span class="txt">'+t["\ud30c\uc77c \uc0ad\uc81c"]+"</span>";break;case r.CANCELED:o='<span class="txt" >'+e["\ucde8\uc18c"]+"</span>";break;default:o='<span class="txt">--</span>'}return o}}]}),this.collection.fetch()},render:function(){s.prototype.render.call(this),this.$("[el-content]").prepend(o({lang:n,model:this.model})),this.renderList()},renderList:function(){this.$("#histories").html(this.listView.render().el),this.autoReload()},_onClickCancel:function(n){var r=this,i=$(n.currentTarget).attr("id");$.goPopup({pclass:"layer_normal new_layer layer_works_new new_wide",header:t["\uc9c4\ud589 \ucde8\uc18c"],modal:!0,contents:'<p class="desc">'+t["\uc9c4\ud589 \ucde8\uc18c \uc124\uba85"]+"</p>",buttons:[{btext:t["\uc9c4\ud589 \ucde8\uc18c"],autoclose:!1,btype:"confirm",callback:function(t){r.deleteDownloadItem(i,e["\ucde8\uc18c\ub418\uc5c8\uc2b5\ub2c8\ub2e4."]),t.close()}},{btext:e["\ucde8\uc18c"],btype:"cancel"}]})},_onClickFileDownload:function(e){var t=$(e.currentTarget).attr("id");window.location.href=GO.contextRoot+"api/works/applets/"+this.appletId+"/docs/export/"+t+"/download"},_onClickFileDelete:function(n){var r=$(n.currentTarget).attr("id");$.goConfirm(t["\ucca8\ubd80\ud30c\uc77c\uc744 \uc0ad\uc81c\ud558\uc2dc\uaca0\uc2b5\ub2c8\uae4c?"],"",$.proxy(function(){this.deleteDownloadItem(r,e["\uc0ad\uc81c\ub418\uc5c8\uc2b5\ub2c8\ub2e4."])},this))},deleteDownloadItem:function(t,n){GO.util.preloader($.ajax({type:"DELETE",contentType:"application/json",url:GO.contextRoot+"api/works/applets/"+this.appletId+"/docs/export/"+t,success:$.proxy(function(){$.goMessage(n),this.collection.fetch()},this),error:function(){$.goError(e["\uad00\ub9ac \uc11c\ubc84\uc5d0 \uc624\ub958\uac00 \ubc1c\uc0dd\ud558\uc600\uc2b5\ub2c8\ub2e4"])}}))},autoReload:function(){var e=this,t=setInterval(function(){e.$el.parent().length>0?e.collection.fetch():clearInterval(t)},5e3)}})});