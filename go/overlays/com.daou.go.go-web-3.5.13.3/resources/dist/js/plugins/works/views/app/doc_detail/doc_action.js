define("works/views/app/doc_detail/doc_action",function(require){var e=require("backbone"),t=require("hgn!works/templates/app/doc_detail/doc_action"),n=require("components/select/views/select"),r=require("i18n!nls/commons"),i=require("i18n!works/nls/works"),s=require("works/libs/util"),o=require("works/collections/applet_simples"),u={"\uc218\uc815":r["\uc218\uc815"],"\uc0ad\uc81c":r["\uc0ad\uc81c"],"\ubaa9\ub85d":r["\ubaa9\ub85d"],"\uc778\uc1c4":r["\uc778\uc1c4"],"\ubcf5\uc0ac":r["URL \ubcf5\uc0ac"],"\ub2e4\ub978 \uc571\uc73c\ub85c \ub370\uc774\ud130 \ubcf5\uc0ac":i["\ub2e4\ub978 \uc571\uc73c\ub85c \ub370\uc774\ud130 \ubcf5\uc0ac"],"\uc704":r["\uc704"],"\uc544\ub798":r["\uc544\ub798"]},a=require("works/models/action");return e.View.extend({events:{'click a[name="btnAction"]':"doAction","click #btnEdit":"goEdit","click #btnDelete":"doDelete","click #taskPrint":"printPopup","click #goToListBtn":"_onClickList","click #previous":"_onClickPrevious","click #next":"_onClickNext"},initialize:function(e){this.options=e||{},this.isAdmin=e.isAdmin,this.subFormId=e.subFormId,this.docId=this.model.id,this.appletId=this.model.get("appletId"),this.actions=e.actions,this.writableApplets=new o([],{writable:!0,type:"accessible"}),this.isOrgDocPopup=e.isOrgDocPopup?e.isOrgDocPopup:!1,this.accessibleMainForm=e.accessibleMainForm?e.accessibleMainForm:!1,this.useNavigate=e.useNavigate},render:function(){var e=this.model.get("actions").updatable,n=this.model.get("actions").removable;return this.$el.html(t({data:this.actions.toJSON(),isEditable:e,isDeletable:n,isOrgDocPopup:this.isOrgDocPopup,lang:u,navigate:this.useNavigate&&this._hasNavigateTable(),isShowBtn:function(){return e&&!this.isOrgDocPopup||n}})),this._toggleNavigate(),!this.isOrgDocPopup&&this.accessibleMainForm&&this._renderCopyButton(),this},doAction:function(e){var t=$(e.currentTarget).attr("id"),n=new a({},{appletId:this.appletId,docId:this.docId,actionId:t});n.save({},{type:"PUT",success:$.proxy(function(){this.$el.trigger("doAction")},this),error:function(){$.goAlert(r["\uc800\uc7a5\uc5d0 \uc2e4\ud328 \ud558\uc600\uc2b5\ub2c8\ub2e4."])}})},goEdit:function(){s.goEditDoc({appletId:this.appletId,subFormId:this.subFormId,docId:this.docId})},doDelete:function(){var t=this;$.goCaution(r["\uc0ad\uc81c"],r["\uc0ad\uc81c\ud558\uc2dc\uaca0\uc2b5\ub2c8\uae4c?"],_.bind(function(){var n=new e.Model;n.id=t.appletId,n.url=GO.config("contextRoot")+"api/works/applets/"+t.appletId+"/docs",n.set("ids",[parseInt(t.docId)]),n.save(null,{type:"DELETE",contentType:"application/json",success:function(){t.isOrgDocPopup?window.close():s.goAppHome(t.appletId)}})},this))},_onClickList:function(){GO.router.navigate("works/applet/"+this.appletId+"/home/search",!0)},printPopup:function(){var e=GO.contextRoot+"app/works/applet/"+this.appletId+"/doc/"+this.docId+"/print";GO.util.isValidValue(this.subFormId)&&(e=e+"/"+this.subFormId),window.open(e,"","location=no, directories=no, resizable=yes, status=no, toolbar=no, menubar=no, width=1280, height=650, left=0, top=0, scrollbars=yes")},_renderCopyButton:function(){var e=new n({useScroll:!0,useCheckbox:!1,valueKey:"id",labelKey:"name",iconPathKey:"thumbSmall",collection:this.writableApplets,buttonText:u["\ub2e4\ub978 \uc571\uc73c\ub85c \ub370\uc774\ud130 \ubcf5\uc0ac"]});this.writableApplets.fetch(),this.$("div.critical").append(e.render().el),this.$el.on("clickOption",$.proxy(function(e,t){GO.router.navigate("works/applet/"+this.appletId+"/doc/"+this.docId+"/copy/"+t.value,!0)},this)),e.$el.on("directSelect",$.proxy(function(e,t){GO.router.navigate("works/applet/"+this.appletId+"/doc/"+this.docId+"/copy/"+t.value,!0)},this))},_hasNavigateTable:function(){var e=this._getDocIdsTable();return!!e.length},_getDocIdsTable:function(){return GO.util.store.get(GO.session("id")+"-"+this.appletId+"-docIdsTable")||[]},_getPreviousDocId:function(){var e=this._getDocIdsTable();if(!e.length)return!1;var t=_.indexOf(e,parseInt(this.model.id));return t>0?e[t-1]:!1},_getNextDocId:function(){var e=this._getDocIdsTable();if(!e.length)return!1;var t=_.indexOf(e,parseInt(this.model.id));return t<e.length?e[t+1]:!1},_onClickPrevious:function(){var e=this._getPreviousDocId();if(!e)return;GO.router.navigate("works/applet/"+this.appletId+"/doc/"+e+"/navigate",!0)},_onClickNext:function(){var e=this._getNextDocId();if(!e)return;GO.router.navigate("works/applet/"+this.appletId+"/doc/"+e+"/navigate",!0)},_toggleNavigate:function(){var e=this._getPreviousDocId(),t=this._getNextDocId();e?this.$("#previous").css("display","inline-block"):this.$("#previous").hide(),t?this.$("#next").css("display","inline-block"):this.$("#next").hide()}})});