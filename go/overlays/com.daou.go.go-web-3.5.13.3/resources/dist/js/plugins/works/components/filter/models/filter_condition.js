define("works/components/filter/models/filter_condition",function(require){var e=require("i18n!works/nls/works"),t={"\uc624\ub298\ubd80\ud130":e["\uc624\ub298\ubd80\ud130"],"\uc624\ub298\uae4c\uc9c0":e["\uc624\ub298\uae4c\uc9c0"],"\uc77c\uc804":e["\uc77c\uc804"],"\uc77c\ud6c4":e["\uc77c\ud6c4"],"\ub2ec\uc804":e["\ub2ec\uc804"],"\ub2ec\ud6c4":e["\ub2ec\ud6c4"]},n=require("works/constants/condition_type"),r=require("works/components/filter/models/base_type"),i=require("works/components/filter/collections/filter_condition_options");return r.extend({initialize:function(){this.modelName="filter_condition"},defaults:{values:{}},getLabelText:function(){var e="";if(this.isSelectValueType()){var t=new i(this.get("options"));t.setUsed(this.get("values").values),e=t.labelText()}else this.isOrgType()?e=this.userLabelText():this.isAppletDocValueType()?e=this._appletDocLabelText():e=this._labelText();return e},_labelText:function(){var e="",t=this.get("values");if(!t)return"";switch(this.get("conditionType")){case n.TEXT:e=t.text;break;case n.TIME:e=t.fromTime+" ~ "+t.toTime;break;case n.DATETIME:var r=moment(t.fromDateTime).format("YYYY-MM-DD HH:mm"),i=moment(t.toDateTime).format("YYYY-MM-DD HH:mm");e=r+" ~ "+i;break;case n.RELATIVE_DATETIME:e=this._relativeDateLabel();break;case n.DATE:e=this._dateLabel();break;case n.RELATIVE_DATE:e=this._relativeDateLabel();break;case n.NUMBER:e=this.minValueWithCommas()+" ~ "+this.maxValueWithCommas()}return e},valuesToDateTime:function(){var e=this.get("values"),t=null,n=null;return _.each(this.get("values"),function(r,i){switch(i){case"fromTime":t=moment(moment().format("YYYY-MM-DD")+"T"+r);break;case"toTime":n=moment(moment().format("YYYY-MM-DD")+"T"+r);break;case"fromDateTime":t=moment(moment(r).format("YYYY-MM-DD hh:mm"));break;case"toDateTime":n=moment(moment(r).format("YYYY-MM-DD hh:mm"));break;case"fromValue":t=moment().subtract(parseInt(r),e.fromUnit+"s");break;case"toValue":n=moment().add(parseInt(r),e.toUnit+"s");break;case"fromDate":t=this._yyyymmddToDate(r);break;case"toDate":n=this._yyyymmddToDate(r);break;default:}},this),{fromDateTime:t,toDateTime:n}},isRelativeType:function(){return this.get("conditionType").indexOf("RELATIVE")>-1},minValueWithCommas:function(){return this.get("values")?this.get("conditionType")!=n.NUMBER?(console.warn(this.get("conditionType")+" does not support this method."),""):GO.util.numberWithCommas(parseFloat(this.get("values").minValue)):0},maxValueWithCommas:function(){return this.get("values")?this.get("conditionType")!=n.NUMBER?(console.warn(this.get("conditionType")+" does not support this method."),""):GO.util.numberWithCommas(parseFloat(this.get("values").maxValue)):0},mergeFromFields:function(e){var t=_.findWhere(e,{cid:this.get("fieldCid")});return t?(this.set("label",t.label),this.set("fieldCid",t.cid),this.set("fieldType",t.fieldType),this.set("valueType",t.valueType),this.set("multiple",t.multiple),this.get("conditionType")==n.SELECT&&this.set("options",t.options),!0):!1},modelToQuery:function(){var e="",t=this.get("values"),r="YYYY-MM-DDTHH:mm:ss.SSS",i,s,o,u;switch(this.get("conditionType")){case n.TEXT:if(!t.text)break;e=this.get("fieldCid")+":"+'"'+this._escapeSpecialCharacter(t.text)+'"';break;case n.SELECT:if(t.values&&!t.values.length)break;var a=_.uniq(_.map(t.values,function(e){return _.isObject(e)?e.id=="current"?"me()":e.id:e},this)).join(" ");e=this.get("fieldCid")+(this.isAppletDocValueType()?".id:(":":(")+a+")";break;case n.TIME:e=this.get("fieldCid")+":["+t.fromTime+" TO "+t.toTime+"]";break;case n.DATETIME:i=moment.utc(t.fromDateTime).format(r)+"Z",s=moment.utc(t.toDateTime).format(r)+"Z",e=this.get("fieldCid")+":["+i+" TO "+s+"]";break;case n.RELATIVE_DATETIME:o=t.fromUnit.toUpperCase(),u=t.toUnit.toUpperCase(),i="",s="",o=="NOW"?i=moment.utc(moment().startOf("day")):o=="DAY"?i=moment.utc(moment().subtract("days",t.fromValue).startOf("day")):o=="MONTH"&&(i=moment.utc(moment().subtract("months",t.fromValue).startOf("day"))),u=="NOW"?s=moment.utc(moment().endOf("day")):u=="DAY"?s=moment.utc(moment().add("days",t.toValue).endOf("day")):u=="MONTH"&&(s=moment.utc(moment().add("months",t.toValue).endOf("day"))),e=this.get("fieldCid")+":["+i.format(r)+"Z TO "+s.format(r)+"Z]";break;case n.DATE:e=this.get("fieldCid")+":["+t.fromDate+" TO "+t.toDate+"]";break;case n.RELATIVE_DATE:var f=parseInt(t.fromValue),l=parseInt(t.toValue);o=t.fromUnit,u=t.toUnit;var c=GO.util.now().subtract(f,o+"s").format("YYYYMMDD"),h=GO.util.now().add(l,u+"s").format("YYYYMMDD");e=this.get("fieldCid")+":["+c+" TO "+h+"]";break;case n.NUMBER:if(_.isUndefined(t.minValue)||_.isUndefined(t.maxValue))break;e=this.get("fieldCid")+":["+t.minValue+" TO "+t.maxValue+"]";break;default:}return e},setDefaultValues:function(){this.set("values",this._getDefaultValues(this.get("conditionType")))},userLabelText:function(){return _.map(this.get("values").values,function(e){return e.name}).join(",")},_appletDocLabelText:function(){var e=this.get("values"),t=_.isArray(e.values)?e.values:[e];return _.map(t,function(e){return e.text}).join(",")},_dateLabel:function(){var e=this._yyyymmddToDate(this.get("values").fromDate),t=this._yyyymmddToDate(this.get("values").toDate);return e.format("YYYY-MM-DD")+" ~ "+t.format("YYYY-MM-DD")},_yyyymmddToDate:function(e){var t=[];return t.push(e.substr(0,4)),t.push(e.substr(4,2)),t.push(e.substr(6,2)),moment(t.join("-")+"T00:00")},_relativeDateLabel:function(){var e="",n=this.get("values");switch(n.fromUnit){case"now":e=t["\uc624\ub298\ubd80\ud130"];break;case"day":e=n.fromValue+t["\uc77c\uc804"];break;case"month":e=n.fromValue+t["\ub2ec\uc804"]}e+=" ~ ";switch(n.toUnit){case"now":e+=t["\uc624\ub298\uae4c\uc9c0"];break;case"day":e+=n.toValue+t["\uc77c\ud6c4"];break;case"month":e+=n.toValue+t["\ub2ec\ud6c4"]}return e},_getDefaultValues:function(e){var t=null;switch(e){case n.TEXT:t={text:""};break;case n.SELECT:t={values:[]};break;case n.TIME:t={fromTime:"00:00",toTime:"00:00"};break;case n.DATETIME:t={fromDateTime:new Date,toDateTime:new Date};break;case n.DATE:t={fromDate:GO.util.now().format("YYYYMMDD"),toDate:GO.util.now().format("YYYYMMDD")};break;case n.NUMBER:t={minValue:0,maxValue:0}}return t},_escapeSpecialCharacter:function(e){return e.replace(/[\\+!():^\[\]\{}~*?|&;\/-\\"]/g,"\\$&")}})});