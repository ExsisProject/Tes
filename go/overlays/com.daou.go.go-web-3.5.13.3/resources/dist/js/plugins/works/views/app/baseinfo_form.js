define("works/views/app/baseinfo_form",function(require){function b(){return n(this.layoutView.render()).then(this.layoutView.setContent(this))}function w(){var s=this,o=[],u=t.Collection.extend({comparator:function(e){return-e.get("seq")},parse:function(e){var t=_.map(e,function(e){var t={};return t.src=e,t.seq=parseInt(e.replace(/[a-z\/._]/gi,"")),t});return t}});n(e.ajax({type:"GET",dataType:"json",url:GO.config("contextRoot")+"api/works/applets/icons",success:function(e){o=e.data}})).then(_.bind(S,this)).then(function(){var n="";r.checkAppManager(s.model.get("admins")),n=h["\uae30\ubcf8 \uc815\ubcf4"],s.$el.html(a({lang:p,model:s.model.toJSON(),"isRegist?":s.isRegist,"isSiteAdmin?":s.isSiteAdmin}));var f=e(".app_list"),l=new u;l.set(o,{parse:!0}),l.sort(),l.each(function(e){f.append('<img class="choiceIcon" src="'+e.get("src")+'" alt="'+h["\uc720\uc800 \ub4f1\ub85d \uc544\uc774\ucf58"]+'" >')});var c=new i({baseConfigModel:s.model,pageName:n,isAppNamePrefixed:!s.isRegist,useActionButton:!0,infoDesc:p.infoDesc});c.setElement(this.$("#worksContentTop")),c.render(),E.call(s)})}function E(){var t=this;this.nameTag=f.create({},{useAddButton:!0}),this.$el.find("div.wrap_name_tag").html(this.nameTag.el),_.each(this.model.get("admins"),function(e){var n=e.position||"";t.nameTag.addTag(e.id,e.name+" "+n||"",{removable:!0})},this),this.nameTag.$el.on("nametag:clicked-add",function(){e.goOrgSlide({header:l["\uc6b4\uc601\uc790 \ucd94\uac00"],type:"node",isBatchAdd:!0,externalLang:c,memberTypeLabel:l["\uc6b4\uc601\uc790"],desc:"",contextRoot:GO.config("contextRoot"),callback:e.proxy(t.onAddManagers,t)})})}function S(){var e=this,t=n.defer();return n(this.model.fetch({success:function(){t.resolve()},error:function(){t.reject()}})).otherwise(function(t){console.log(t.stack)}),t.promise}function x(){var e=this,t=new u,r=n.defer();return t.fetch({success:function(t){e.isSiteAdmin=!!t.get("true"),r.resolve()},error:function(){r.reject()}}),r.promise}var e=require("jquery"),t=require("backbone"),n=require("when"),r=require("works/libs/util"),i=require("works/views/app/layout/manage_content_top"),s=require("works/views/app/home/works_home_layout"),o=require("works/models/applet_baseconfig"),u=require("works/models/applet_admin"),a=require("hgn!works/templates/app/baseinfo_form"),f=require("go-nametags");require("jquery.go-orgslide"),require("jquery.go-popup"),require("jquery.go-preloader");var l=require("i18n!admin/nls/admin"),c=require("i18n!nls/commons"),h=require("i18n!works/nls/works"),p={admin:l["\uc6b4\uc601\uc790"],name:h["\uc571 \uc774\ub984"],desc:h["\uc571 \uc124\uba85"],icon:h["\uc571 \uc544\uc774\ucf58"],alarm_msg:h["\uae30\ubcf8\uc124\uc815 \uc6b4\uc601\uc790 \ud234\ud301"],regist:h["\uc571\ub9cc\ub4e4\uae30"],save:c["\uc800\uc7a5"],goback:h["\ub3cc\uc544\uac00\uae30"],add:c["\ucd94\uac00"],cancel:c["\ucde8\uc18c"],gosettinghome:h["\uad00\ub9ac \ud648\uc73c\ub85c \uc774\ub3d9"],goapphome:h["\ud574\ub2f9 \uc571\uc73c\ub85c \uc774\ub3d9"],"\uc571 \uae30\ubcf8 \uc124\uc815":h["\uc571 \uae30\ubcf8 \uc124\uc815"],"\ub9cc\ub4e4\ub824\ub294 \uc571\uc5d0 \ub300\ud55c \uae30\ubcf8 \uc124\uc815\uc744 \ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4":h["\ub9cc\ub4e4\ub824\ub294 \uc571\uc5d0 \ub300\ud55c \uae30\ubcf8 \uc124\uc815\uc744 \ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4"],"\ud68c\uc0ac\uc5d0\uc11c \uc6b4\uc601\ud560 \uc720\uc6a9\ud55c \uc571\uc744 \uc9c1\uc811 \ub514\uc790\uc778\ud574\uc11c \ub9cc\ub4e4\uc5b4\ubcf4\uc138\uc694":h["\ud68c\uc0ac\uc5d0\uc11c \uc6b4\uc601\ud560 \uc720\uc6a9\ud55c \uc571\uc744 \uc9c1\uc811 \ub514\uc790\uc778\ud574\uc11c \ub9cc\ub4e4\uc5b4\ubcf4\uc138\uc694"],"\ud544\uc218 \uc785\ub825 \ucef4\ud3ec\ub10c\ud2b8":h["\ud544\uc218 \uc785\ub825 \ucef4\ud3ec\ub10c\ud2b8"],"\uae30\ubcf8\uc124\uc815 \uc571 \uc124\uba85 \ud234\ud301":h["\uae30\ubcf8\uc124\uc815 \uc571 \uc124\uba85 \ud234\ud301"],"\ub370\uc774\ud130 \ubaa9\ub85d\uc5d0\uc11c \uc124\uba85\uc774 \uae30\ubcf8\uc73c\ub85c \ubcf4\uc774\ub3c4\ub85d \uc124\uc815\ud569\ub2c8\ub2e4":h["\ub370\uc774\ud130 \ubaa9\ub85d\uc5d0\uc11c \uc124\uba85\uc774 \uae30\ubcf8\uc73c\ub85c \ubcf4\uc774\ub3c4\ub85d \uc124\uc815\ud569\ub2c8\ub2e4"],"\uc720\uc800 \ub4f1\ub85d \uc544\uc774\ucf58":h["\uc720\uc800 \ub4f1\ub85d \uc544\uc774\ucf58"],infoDesc:h["\uc774\ub984, \uc124\uba85, \uc544\uc774\ucf58 \ub4f1\uc758 \uc571\uc758 \uae30\ucd08 \uc815\ubcf4\ub97c \uc124\uc815\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4."],waitingMsg:h["\uc800\uc7a5\uc911 \uba54\uc138\uc9c0"]},d=64,v=4999,m=!1,g=o.extend({validate:function(e){var t=[];_.isEmpty(e.name)&&t.push("name_required"),e.name&&e.name.length>d&&t.push("name_invalid_length"),e.desc&&e.desc.length>v&&t.push("desc_invalid_length");if(t.length>0)return t;return},isEmptyAdmins:function(){return this.get("admins")&&this.get("admins").length<1?!0:!1}}),y=t.View.extend({className:"go_content go_renew go_works_home app_temp",initialize:function(e){this.options=e||{},this.folderId=GO.router.getSearch().folderId||"",this.asDefault=GO.router.getSearch().asDefault||"",this.layoutView=s.create(),this.refType=e.refType||"applets",this.model=new g(e.hasOwnProperty("appletId")?{id:e.appletId}:null)},events:{"click #btn-confirm":"_onConfirm","click #btn-goback":"_goBack","click #btn-cancel":"_cancel","click #btn-gosettinghome":"gosettinghome","click #btn-goapphome":"goapphome","click .choiceIcon":"_choiceIcon","click #goAppHomeNav":"goapphome","click #goSettingHomeNav":"gosettinghome","keydown input":"_preventFormSubmit"},onAddManagers:function(e){var t=_.isArray(e)?e:[e];_.each(t,function(e){var t=e.position||"";this.nameTag.addTag(e.id,e.name+" "+t,{removable:!0})},this)},_onConfirm:function(t){t.preventDefault(),this.model.set("admins",this.nameTag.getNameTagList()),this.model.set("name",e(this.el).find("#name").val()),this.model.set("desc",e("#textarea-desc").val()),this.model.set("showDescription",e("input:checkbox[id='showDescription']").is(":checked"));if(!this.validateForm())return!1;this.updateApplet()},updateApplet:function(){var t=null;if(m){e.goSlideMessage(p.waitingMsg);return}this.model.setUrl(GO.config("contextRoot")+"api/works/applets/"+this.model.get("id")+"/base"),this.model.save({},{type:"PUT",beforeSend:function(){t=e.goPreloader(),m=!0},success:function(){e.goMessage(h["\uc800\uc7a5 \ub418\uc5c8\uc2b5\ub2c8\ub2e4"])},error:function(){GO.router.navigate("works",{pushState:!0,trigger:!0})},statusCode:{400:function(){GO.util.error("400",{msgCode:"400-works"})},403:function(){GO.util.error("403",{msgCode:"400-works"})},404:function(){GO.util.error("404",{msgCode:"400-works"})},500:function(){GO.util.error("500")}},complete:function(){t.release(),m=!1}})},_cancel:function(t){var n=this;t.preventDefault(),e.goConfirm(h["\ud3b8\uc9d1 \ucde8\uc18c"],c["\uc785\ub825\ud558\uc2e0 \uc815\ubcf4\uac00 \ucd08\uae30\ud654\ub429\ub2c8\ub2e4."],function(){w.call(n)})},validateForm:function(){r.errorDescRemover({targets:[this.$("#name"),this.$("#textarea-desc")]},this);var t=this.$el.find("form[name=baseinfoForm]"),n=t.find("#name"),i=t.find("#wrap_name_tag ul"),s=t.find("#textarea-desc"),o=null,u=!0;return this.model.isValid()||(_.contains(this.model.validationError,"name_invalid_length")&&(e.goError(h["\uae38\uc774\uac00 \ucd08\uacfc\ud558\uc600\uc2b5\ub2c8\ub2e4"],e(n).parent()),n&&n.addClass("error"),o||(o=n),u=!1),_.contains(this.model.validationError,"name_required")&&(e.goError(h["\uc81c\ubaa9\uc744 \uc785\ub825\ud574 \uc8fc\uc138\uc694"],e(n).parent()),n&&n.addClass("error"),o||(o=n),u=!1),_.contains(this.model.validationError,"desc_invalid_length")&&(e.goError(h["\uc571 \uc124\uba85 \uae38\uc774 \ucd08\uacfc"],e(s).parent()),s&&s.addClass("error"),o||(o=s),u=!1)),this.model.isEmptyAdmins()&&(e.goError(h["\uc6b4\uc601\uc790\ub97c \ucd94\uac00\ud574 \uc8fc\uc138\uc694"],e(i)),i&&i.addClass("enter error"),o||(o=i),u=!1),o&&o.focus(),u},_goBack:function(e){e.preventDefault(),window.history.back()},gosettinghome:function(){r.goSettingHome(this.model.get("id"))},goapphome:function(){r.goAppHome(this.model.get("id"))},_choiceIcon:function(t){var n=e(t.currentTarget).attr("src");e("#thumbSmall").attr("src",n),this.model.set("iconUrl",n)},render:function(){return n(b.call(this)).then(_.bind(x,this)).then(_.bind(w,this)).otherwise(function(t){console.log(t.stack)})},_preventFormSubmit:function(e){e.keyCode===13&&e.preventDefault()}});return y});