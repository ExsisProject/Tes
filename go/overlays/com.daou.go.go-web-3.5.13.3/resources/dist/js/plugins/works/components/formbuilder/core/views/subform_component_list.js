define("works/components/formbuilder/core/views/subform_component_list",function(require){function p(e){var t=$(e).data("component-type");return u.getComponentClass(t)}var e=require("backbone"),t=require("works/component_type"),n=require("works/components/formbuilder/core/component_registry"),r=require("works/components/formbuilder/constants"),i=require("works/components/formbuilder/core/models/adapters"),s=require("works/constants/design_component_type"),o=require("works/components/formbuilder/core/views/toolbox_pane"),u=require("works/components/formbuilder/core/component_manager"),a=require("hgn!works/components/formbuilder/core/templates/toolbox_form_component_item"),f=require("hgn!works/components/formbuilder/core/templates/toolbox_list_item"),l=require("i18n!works/nls/works"),c=require("i18n!nls/commons");require("jquery.ui"),require("jquery.go-popup");var h=o.extend({className:"builder_side_box",title:l["\ucef4\ud3ec\ub10c\ud2b8"],useResizer:!1,titleWrapClassname:"title_tool_edit",contentWrapClassname:"tool_edit",initialize:function(e){e=e||{},o.prototype.initialize.apply(this,arguments),this.mainFormModel=e.mainFormModel.toJSON(),this.mainFormComponents=[],this.tableComponentCids=[],this.canvasCid=this.mainFormModel.data.cid,this._renderListContainer("basic"),this._renderListContainerTitle("basic")},render:function(){this._renderComponents(i.toAppletFormModel(this.mainFormModel).get("components")),this._renderListContainer("design"),this._renderListContainerTitle("design"),this._renderDesignComponents(),this._initDraggable(),this._initDesignComponentDraggable(),this.toggleArrow(!1)},_renderListContainerTitle:function(e){var t="";e=="basic"?t=l["\ub370\uc774\ud130 \ucef4\ud3ec\ub10c\ud2b8"]:e=="design"&&(t=l["\ub514\uc790\uc778 \ucef4\ud3ec\ub10c\ud2b8"]),e=="basic"?this.$(".component-group-"+e).append('<li class="tit"><div class="attr_title"><label>'+t+"</label>"+'<span class="ic_works ic_help_type1" title="'+c["\ub3c4\uc6c0\ub9d0"]+'"></span>'+'<div class="attr_tooltip" style="display: none;">'+l["\ud558\uc704\ud3fc\ub370\uc774\ud130\ucef4\ud3ec\ub10c\ud2b8 \uc124\uba85"]+"</div></div></li>"):this.$(".component-group-"+e).append('<li class="tit"><div class="attr_title"><label>'+t+"</label></div></li>")},_renderComponents:function(e,n){var r=this,n=n||0;_.each(e,function(e){e.emptyChildrenComponent?r._renderComponentItem(e,n):(r._renderComponentItem(e,n),r._renderComponents(e.components,e.type==t.Column?n:n+1))})},_renderComponentItem:function(e,t){if(e.type=="column")return;var n=!1,i=!1;this.mainFormComponents.push(e),e.type=="table"&&this.tableComponentCids.push(e.cid);var s=r.CN_COMPONENT+" "+r.CN_COMPONENT_TYPE;_.contains(this.tableComponentCids,e.parentCid)&&(s=r.CN_COMPONENT,n=!0),e.parentCid!=this.canvasCid&&(s+=" child-component",i=!0);var o=this,u=i?"sub_depth_"+t:"";n&&(u+=_.isEmpty(u)?"disabled":" disabled"),this.$(".component-group-basic").append(a({liClassName:u,className:s,cid:e.cid,componentType:e.type,label:o._getComponentName(e),notDraggable:n,isChildComponent:i}))},_renderListContainer:function(e){var t="component-list",n=$('<ul class="'+t+'"></ul>'),r=null;return n.addClass("component-group-"+e),this.$("."+t).length>0&&(r='<i class="tool_edit_line"></i>'),this.$(".toolbox-content").append(r,n),n},_renderDesignComponents:function(){_.each(s.DESIGN_TYPE,function(e){var t=n.findByType(e);if(!t||t.handlerable===!1)return;var i=t.group;this.$(".component-group-design").length<1&&this._renderListContainer(i),this.$(".component-group-design").append(f({className:r.CN_COMPONENT+" "+r.CN_COMPONENT_TYPE,componentType:t.type,label:t.cname}))},this)},_initDraggable:function(){function i(e){return e.cid&&u.isCreated(e.cid)}var e=this,t=this.$(".component-group-basic ."+r.CN_COMPONENT_TYPE),n="."+r.CN_CONTAINABLE;t.draggable({appendTo:"body",connectToSortable:n,helper:function(t,n){var r=$(t.currentTarget),s=r.attr("data-cid"),o=r.attr("data-name"),a=_.find(e.mainFormComponents,function(e){return e.cid==s});return $helper=u.createDragHelper(o),i(a)?($helper.addClass("err_type"),$helper.find(".icon-helper").addClass("ic_err")):$helper.find(".icon-helper").addClass("ic_"+a.type),$helper},start:function(n){var s=$(n.currentTarget),o=s.attr("data-cid"),u=s.attr("data-name"),a=_.find(e.mainFormComponents,function(e){return e.cid==o});e.observer.trigger(r.EVENT_START_DRAGGING,a.type),$(this).closest("li").addClass("on"),i(a)&&($.goSlideMessage(GO.i18n(l["\ud3fc \ucef4\ud3ec\ub10c\ud2b8 \uc911\ubcf5 \uc5d0\ub7ec\uba54\uc2dc\uc9c0"],{arg1:u}),"caution"),t.draggable("option","connectToSortable",!1))},stop:function(i){e.observer.trigger(r.EVENT_STOP_DRAGGING),$(this).closest("li").removeClass("on"),$(this).removeClass(r.CN_DUPLICATED),t.draggable("option","connectToSortable")||t.draggable("option","connectToSortable",n)}})},_initDesignComponentDraggable:function(){function i(e){return e.cid&&u.isCreated(e.cid)}var e=this,t=this.$(".component-group-design ."+r.CN_COMPONENT_TYPE),n="."+r.CN_CONTAINABLE;t.draggable({appendTo:"body",connectToSortable:n,helper:function(e,t){var n=p(e.currentTarget),r=u.createDragHelper(n.cname);return i(n)?(r.addClass("err_type"),r.find(".icon-helper").addClass("ic_err")):r.find(".icon-helper").addClass("ic_"+n.type),r},start:function(n){var s=p(n.currentTarget);e.observer.trigger(r.EVENT_START_DRAGGING,s.type),$(this).closest("li").addClass("on"),i(s)&&($.goSlideMessage(GO.i18n(l["\ud3fc \ucef4\ud3ec\ub10c\ud2b8 \uc911\ubcf5 \uc5d0\ub7ec\uba54\uc2dc\uc9c0"],{arg1:s.cname}),"caution"),t.draggable("option","connectToSortable",!1))},stop:function(i){e.observer.trigger(r.EVENT_STOP_DRAGGING),$(this).closest("li").removeClass("on"),$(this).removeClass(r.CN_DUPLICATED),t.draggable("option","connectToSortable")||t.draggable("option","connectToSortable",n)}})},_getComponentName:function(e){if(_.contains(s.NAME_FIXED_TYPE,e.type)){var t=n.findByType(e.type);return t.cname}return e.properties.label},toggleArrow:function(e){o.prototype.toggleArrow.apply(this,arguments)},toggleContent:function(e){o.prototype.toggleContent.apply(this,arguments),e||!1?(this.$("."+this.titleWrapClassname).removeClass("off"),this.observer.trigger(r.EVENT_FOLD_COMPONENT_PANNEL)):this.$("."+this.titleWrapClassname).addClass("off")},getMarginHeight:function(){var e=30;return this.$(".toolbox-title").outerHeight()+e}});return h});