define("works/components/chart/views/chart_setting",function(require){var e=["DAY","MONTH","YEAR"],t=require("works/constants/value_type"),n=require("i18n!nls/commons"),r=require("i18n!works/nls/works"),i={MINUTE:r.MINUTE,HOUR:r.HOUR,DAY:r.DAY,WEEK:r.WEEK,MONTH:r.MONTH,QUARTER:r.QUARTER,YEAR:r.YEAR,"\ucc28\ud2b8 \uc774\ub984":r["\ucc28\ud2b8 \uc774\ub984"],"\ucc28\ud2b8 \ud0c0\uc785":r["\ucc28\ud2b8 \ud0c0\uc785"],"\uc138\ub85c \ub9c9\ub300\ud615":r["\uc138\ub85c \ub9c9\ub300\ud615"],"\uaebe\uc740 \uc120\ud615":r["\uaebe\uc740 \uc120\ud615"],"\uc6d0\ud615":r["\uc6d0\ud615"],"\uc18d\ub3c4 \uadf8\ub798\ud504":r["\uc18d\ub3c4 \uadf8\ub798\ud504"],"\uadf8\ub8f9\ubcc4 \ud1b5\uacc4":r["\uadf8\ub8f9\ubcc4 \ud1b5\uacc4"],"\ubaa9\ud45c\uac12":r["\ubaa9\ud45c\uac12"],"\uc9d1\uacc4 \ubc29\uc2dd":r["\uc9d1\uacc4 \ubc29\uc2dd"],"\uc815\ub82c":r["\uc815\ub82c"],"\uac1c\uc218":r["\uac1c\uc218"],"\ud569\uacc4":r["\ud569\uacc4"],"\ud3c9\uade0":r["\ud3c9\uade0"],"\ucd5c\ub300\uac12":r["\ucd5c\ub300\uac12"],"\ucd5c\uc18c\uac12":r["\ucd5c\uc18c\uac12"],"\uadf8\ub8f9\uc5c6\uc74c":r["\uadf8\ub8f9\uc5c6\uc74c"],"\uc0ad\uc81c\ub41c \ud56d\ubaa9":r["\uc0ad\uc81c\ub41c \ud56d\ubaa9"],"\ud56d\ubaa9\uc774 \uc0ad\uc81c\ub418\uc5c8\uc2b5\ub2c8\ub2e4 \uc124\uba85":r["\ud56d\ubaa9\uc774 \uc0ad\uc81c\ub418\uc5c8\uc2b5\ub2c8\ub2e4 \uc124\uba85"],"\uae30\ubcf8\ud615":r["\uae30\ubcf8\ud615"],"\ub204\uc801\ud615":r["\ub204\uc801\ud615"],"\ucf64\ubcf4 \ucc28\ud2b8":r["\ucf64\ubcf4 \ucc28\ud2b8"],"\ud14c\ub9c8 \uc9c0\uc815":r["\ud14c\ub9c8 \uc9c0\uc815"],"\ucc28\ud2b8 \ubbf8\ub9ac\ubcf4\uae30":r["\ucc28\ud2b8 \ubbf8\ub9ac\ubcf4\uae30"],"\ub370\uc774\ud130 \uac12 \ud45c\uc2dc":r["\ub370\uc774\ud130 \uac12 \ud45c\uc2dc"]},s=require("components/number_form/number_form"),o=Hogan.compile('<option value="{{type}}">{{label}}</option>'),u=require("hgn!works/components/chart/templates/chart_setting"),a=require("works/components/chart/views/preview");return Backbone.View.extend({tagName:"li",initialize:function(e){this.appletId=e.appletId,this.chartFields=e.chartFields,this.numberFields=e.numberFields,this.model.on("change:title",this._validateTitle,this),this.model.on("change:goal",this._validateGoal,this),this.model.on("change:groupByCid",this._validateGroupByCid,this),this.model.on("change:subGroupByCid",this._validateGroupByCid,this),this.model.on("change:stack",this._validateStack,this),this.model.on("change:subStack",this._validateSubStack,this)},events:{"click [el-delete]":"_onClickDeleteChart","click [data-chart-preview]":"_onClickChartPreview","click [data-chart-theme]":"_onClickChartTheme","click [show-value]":"_onClickShowValue","click [data-combination-label]":"_onClickCombination","change #fields":"_onChangeField","change #subFields":"_onChangeSubField","change #chartTitle":"_onChangeTitle","change [data-combination-input]":"_onChangeCombination","change #aggCid":"_onChangeAggCid","change #subAggCid":"_onChangeSubAggCid","change #rangeOption":"_onChangeRangeOption","change #subRangeOption":"_onChangeSubRangeOption","change #chartType":"_onChangeChartType","change #aggMethod":"_onChangeAggMethod","change #subAggMethod":"_onChangeSubAggMethod","change #stack":"_onChangeStack","change #subStack":"_onChangeSubStack","focusout [el-gauge-value]":"_onChangeGaugeValue"},render:function(){return this.$el.html(u({lang:i,model:this.model.toJSON(),chartFields:this.chartFields.toJSON(),numberFields:this.numberFields.toJSON(),hasNumberFields:this.numberFields.length>0})),this.$el.attr("data-chart-cid",this.model.cid),this.numberFormView=new s({inputClass:"txt w_min",inputSelector:{"el-gauge-value":""}}),this.numberFormView.setElement(this.$("[el-number-form-wrapper]")),this.numberFormView.render(),this._renderTimeFormatItem(),this._setData(),this},_setData:function(){this.$("#chartType").val(this.model.get("chartType")),this._onChangeChartType(),this.numberFormView.setValue(this.model.get("goal")||""),this.$("#fields").val(this.model.get("groupByCid")),this.$("#subFields").val(this.model.get("subGroupByCid")),this.$("#stack").val(_.isUndefined(this.model.get("stack"))?"false":this.model.get("stack")+""),this.$("#subStack").val(_.isUndefined(this.model.get("subStack"))?"false":this.model.get("subStack")+""),this.model.get("rangeOption")&&this.$("#rangeOption").val(this.model.get("rangeOption")),this.model.get("subRangeOption")&&this.$("#subRangeOption").val(this.model.get("subRangeOption")),this.model.get("combination")&&this.$("[data-combination-input]").prop("checked",!0),this._toggleCombinationArea(this.model.get("combination")),this._onChangeField(),this._onChangeSubField(),this._setAggArea(),this._onChangeAggMethod(),this._onChangeSubAggMethod(),this._setTheme()},_setAggArea:function(){this.isDeletedAggField()?(this.$("#aggMethod").val("COUNT"),this.$("#aggCid").val("")):(this.$("#aggMethod").val(this.model.get("aggMethod")),this.$("#aggCid").val(this.model.get("aggCid"))),this.isDeletedSubAggField()?(this.$("#subAggMethod").val("COUNT"),this.$("#subAggCid").val("")):(this.$("#subAggMethod").val(this.model.get("subAggMethod")),this.$("#subAggCid").val(this.model.get("subAggCid")))},_setTheme:function(){this.$('[data-chart-theme="'+this.model.get("theme")+'"]').addClass("on")},_onClickChartTheme:function(e){var t=$(e.currentTarget);t.siblings(".on").removeClass("on"),t.addClass("on"),this.model.set("theme",t.attr("data-chart-theme"))},_onClickShowValue:function(e){var t=$(e.currentTarget);this.model.set("showValue",t.is(":checked"))},_onClickChartPreview:function(){console.log("_onClickChartPreview");var e=$.goPopup({width:600,header:i["\ucc28\ud2b8 \ubbf8\ub9ac\ubcf4\uae30"],pclass:"layer_normal layer_chart_preview",callback:function(){console.log("callback")},buttons:[{btext:n["\ud655\uc778"],btype:"normal"}]}),t=new a({appletId:this.appletId,model:this.model,chartFields:this.chartFields,numberFields:this.numberFields});e.find(".content").html(t.render().el)},_onClickDeleteChart:function(){this.remove(),this.model.collection.remove([this.model])},_onChangeTitle:function(e){this.model.set("title",$(e.currentTarget).val())},_onChangeCombination:function(e){var t=$(e.currentTarget).is(":checked");this._changeCombination(t)},_onClickCombination:function(){this.$("[data-combination-input]").click()},_changeCombination:function(e){this.model.set("combination",e),this._toggleCombinationArea(e)},_onChangeChartType:function(){var e=this.$("#chartType").val(),t=e==="GAUGE",n=e==="LINE"||e==="COLUMN";this.$("[el-fields]").toggle(!t),this.$("[el-gauge-value-area]").toggle(t),this.$("#subFields").toggle(n),this.model.set("chartType",e),t||(this.$(["el-gauge-value"]).val(""),this.model.set("goal","")),n?this.$("#subChartType").val(e==="LINE"?"COLUMN":"LINE"):(this.$("#subFields").val(""),this.model.set("subGroupByCid",null),this.model.set("subRangeOption",null),this.$("[data-combination-input]").prop("checked",!1),this._changeCombination(!0),this.model.set("combination",!1)),this.$("[data-combination-input-area]").toggle(n),this.$("[data-combination-area]").toggle(!!n&&!!this.model.get("combination")),this._toggleStack(n),this._toggleSubStack(n)},_onChangeGaugeValue:function(){this.model.set("goal",parseInt(this.numberFormView.getValue()))},_onChangeField:function(){this.model.set("groupByCid",this.$("#fields").val()),this._toggleDateTimeView(this.$("#fields").find("option:selected").attr("data-value-type"),"rangeOption")},_onChangeSubField:function(){this.model.set("subGroupByCid",this.$("#subFields").val()),this._toggleDateTimeView(this.$("#subFields").find("option:selected").attr("data-value-type"),"subRangeOption")},_onChangeRangeOption:function(e){this.model.set("rangeOption",$(e.currentTarget).val())},_onChangeSubRangeOption:function(e){this.model.set("subRangeOption",$(e.currentTarget).val())},_onChangeAggMethod:function(){var e=this.$("#aggMethod").val(),t=e==="COUNT",n=t?null:this.$("#aggCid").val();this.numberFields.length>0&&n==null&&this.$("#aggCid").val(this.numberFields.models[0].get("cid")),this.$("#aggCid").toggle(!t),this.model.set("aggMethod",e),this.model.set("aggCid",n)},_onChangeSubAggMethod:function(){var e=this.$("#subAggMethod").val(),t=e==="COUNT",n=t?null:this.$("#subAggCid").val();this.numberFields.length>0&&n==null&&this.$("#subAggCid").val(this.numberFields.models[0].get("cid")),this.$("#subAggCid").toggle(!t),this.model.set("subAggMethod",e),this.model.set("subAggCid",n)},_onChangeAggCid:function(e){this.model.set("aggCid",$(e.currentTarget).val())},_onChangeSubAggCid:function(e){this.model.set("subAggCid",$(e.currentTarget).val())},_onChangeStack:function(e){this.model.set("stack",GO.util.toBoolean($(e.currentTarget).val()))},_onChangeSubStack:function(e){this.model.set("subStack",GO.util.toBoolean($(e.currentTarget).val()))},_toggleDateTimeView:function(e,n){var r=this.$("#"+n),i=_.contains([t.DATE,t.DATETIME,t.TIME],e),s=t.TIME===e;i?s?(r.toggle(!1),this.model.set(n,"HOUR")):(r.toggle(!0),this.model.set(n,r.val())):(r.toggle(!1),this.model.set(n,null))},_toggleCombinationArea:function(e){this.$("[data-combination-area]").toggle(!!e)},_toggleStack:function(e){this.$("#stack").toggle(e)},_toggleSubStack:function(e){this.$("#subStack").toggle(e)},_renderTimeFormatItem:function(){var t=this.$("select[data-postfix]");t.empty(),_.each(e,function(e){t.append(o.render({type:e,label:i[e]}))},this)},_validateTitle:function(){this.model.isInvalidTitle()&&$.goError(GO.i18n(n["0\uc790\uc774\uc0c1 0\uc774\ud558 \uc785\ub825\ud574\uc57c\ud569\ub2c8\ub2e4."],{arg1:1,arg2:20}),this.$("#chartTitle"),!1,!0)},_validateGoal:function(){this.model.isInvalidGoal()&&$.goError(n["\ud544\uc218\ud56d\ubaa9\uc744 \uc785\ub825\ud558\uc9c0 \uc54a\uc558\uc2b5\ub2c8\ub2e4."],this.$("[el-gauge-value]"),!1,!0)},_validateGroupByCid:function(){this.model.get("subGroupByCid")&&!this.model.get("groupByCid")&&($.goError(n["\ud544\uc218\ud56d\ubaa9\uc744 \uc785\ub825\ud558\uc9c0 \uc54a\uc558\uc2b5\ub2c8\ub2e4."],this.$("#fields"),!1,!0),this.model.set("subGroupByCid",null),this.$("#subFields").val(""))},_validateStack:function(){this.model.get("stack")==="true"&&!this.model.get("subGroupByCid")&&$.goError(r["\ub204\uc801\ud615 \uc124\uba85"],this.$("#stack"),!1,!0)},_validateSubStack:function(){this.model.get("subStack")==="true"&&!this.model.get("subGroupByCid")&&$.goError(r["\ub204\uc801\ud615 \uc124\uba85"],this.$("#subStack"),!1,!0)},isDeletedAggField:function(){return this.model.get("hasDeletedField")&&!this.numberFields.hasFieldByCid(this.model.get("aggCid"))},isDeletedSubAggField:function(){return this.model.get("hasDeletedField")&&!this.numberFields.hasFieldByCid(this.model.get("subAggCid"))}})});