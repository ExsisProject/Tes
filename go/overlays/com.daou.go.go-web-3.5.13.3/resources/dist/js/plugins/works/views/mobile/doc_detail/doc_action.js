define("works/views/mobile/doc_detail/doc_action",function(require){var e=require("backbone"),t=require("app"),n=require("i18n!nls/commons"),r=require("i18n!works/nls/works"),i=require("i18n!board/nls/board"),s=require("works/libs/util"),o=require("works/views/app/doc_detail/doc_action"),u=require("works/models/action"),a={"\uc0c1\ud0dc\ubcc0\uacbd":{selectId:"selectAction",text:r["\uc0c1\ud0dc\ubcc0\uacbd"],selectTriggerFunc:"status-change"},"\ud65c\ub3d9\uae30\ub85d\ub4f1\ub85d":{id:"btnWriteActivity",text:r["\ud65c\ub3d9\uae30\ub85d"],triggerFunc:"works-write-activity"},"\ud65c\ub3d9\uae30\ub85d":{id:"btnActivity",text:r["\ud65c\ub3d9\uae30\ub85d"],cls:"btn_comments",triggerFunc:"works-activity"},"\uc774\uc804":{id:"previous",text:n["\uc704"],triggerFunc:"works-prev",inMoreBtn:!0},"\ub2e4\uc74c":{id:"next",text:n["\uc544\ub798"],triggerFunc:"works-next",inMoreBtn:!0},"\ubaa9\ub85d":{id:"btnList",text:n["\ubaa9\ub85d"],triggerFunc:"works-list",inMoreBtn:!0},"\uc218\uc815":{id:"btnEdit",text:n["\uc218\uc815"],triggerFunc:"works-edit",inMoreBtn:!0},"\uc0ad\uc81c":{id:"btnDelete",text:n["\uc0ad\uc81c"],triggerFunc:"works-delete",inMoreBtn:!0},"URL \ubcf5\uc0ac":{id:"works-url-copy",text:n["URL \ubcf5\uc0ac"],triggerFunc:"works-url-copy"}};return o.extend({events:{},initialize:function(e){this.options=e||{},this.isAdmin=e.isAdmin,this.docId=this.model.id,this.appletId=this.model.get("appletId"),this.subFormId=e.subFormId,this.isWriter=this.model.isCreator(GO.session("id")),this.actions=e.actions,this.useNavigate=e.useNavigate,this.activityCount=e.activityCount,$(document).off("backdrop"),$(document).on("backdrop",$.proxy(function(e){this.closeMoreLayout(e)},this)),this.headerBindEvent()},headerBindEvent:function(){GO.EventEmitter.off("trigger-action"),GO.EventEmitter.on("trigger-action","status-change",this.doAction,this),GO.EventEmitter.on("trigger-action","works-edit",this.goEdit,this),GO.EventEmitter.on("trigger-action","works-delete",this.doDelete,this),GO.EventEmitter.on("trigger-action","works-write-activity",this.goActivityCreate,this),GO.EventEmitter.on("trigger-action","works-activity",this.goActivity,this),GO.EventEmitter.on("trigger-action","works-prev",this._onClickPrevious,this),GO.EventEmitter.on("trigger-action","works-next",this._onClickNext,this),GO.EventEmitter.on("trigger-action","works-list",this._onClickList,this),GO.EventEmitter.on("trigger-action","works-url-copy",this.copyUrl,this)},render:function(){return this.getUseMenus()},getUseMenus:function(){var e=[],t=this.model.get("actions").updatable,n=this.model.get("actions").removable;return this.actions.length>0&&(e.push(a.\uc0c1\ud0dc\ubcc0\uacbd),this.actions.forEach($.proxy(function(t){var n={selectId:"selectAction",id:t.get("id"),text:t.get("name")};e.push(n)}),this)),this.activityCount==0?e.push(a.\ud65c\ub3d9\uae30\ub85d\ub4f1\ub85d):(a.\ud65c\ub3d9\uae30\ub85d.commentsCount=this.activityCount,e.push(a.\ud65c\ub3d9\uae30\ub85d)),e.push(a["URL \ubcf5\uc0ac"]),t&&e.push(a.\uc218\uc815),n&&e.push(a.\uc0ad\uc81c),this.useNavigate&&this._hasNavigateTable()&&this._getPreviousDocId()&&e.push(a.\uc774\uc804),this.useNavigate&&this._hasNavigateTable()&&this._getNextDocId()&&e.push(a.\ub2e4\uc74c),e.push(a.\ubaa9\ub85d),e},closeMoreLayout:function(e){var t=$(e.currentTarget).find("#more_layout");t.is(":visible")&&t.hide()},goActivity:function(){t.router.navigate("works/applet/"+this.appletId+"/doc/"+this.docId+"/activities",!0)},goActivityCreate:function(){t.router.navigate("works/applet/"+this.appletId+"/doc/"+this.docId+"/activity",!0)},goEdit:function(){s.goEditDoc({appletId:this.appletId,subFormId:this.subFormId,docId:this.docId})},doDelete:function(){var t=this;if(confirm(n["\uc0ad\uc81c\ud558\uc2dc\uaca0\uc2b5\ub2c8\uae4c?"])){var r=new e.Model;r.id=t.appletId,r.url=GO.config("contextRoot")+"api/works/applets/"+t.appletId+"/docs",r.set("ids",[parseInt(t.docId)]),r.save(null,{type:"DELETE",contentType:"application/json",success:function(){s.goAppHome(t.appletId)}})}},doAction:function(){var e=this,t=$("#selectAction").val();if(!t)return;var r=new u({},{appletId:this.appletId,docId:this.docId,actionId:t});r.save({},{type:"PUT",success:function(){var t=GO.util.isInvalidValue(e.subFormId)?"works/applet/"+e.appletId+"/doc/"+e.docId:"works/applet/"+e.appletId+"/doc/"+e.docId+"/"+e.subFormId;GO.router.navigate(t,{trigger:!0,replace:!0})},error:function(){alert(n["\uc800\uc7a5\uc5d0 \uc2e4\ud328 \ud558\uc600\uc2b5\ub2c8\ub2e4."])}})},initWindowEvent:function(){this.orientationWindowEvent={name:"orientation",event:function(){this.$el.find("#tool_bar").append(this.actionBar.render().el),this.actionBar.renderToolbar(),this._toggleNavigate()}},this.setTimeoutToWindowEventHandler(this.orientationWindowEvent)},setTimeoutToWindowEventHandler:function(e){var t=this;$(window).on(e.name,function(){this.timeout&&clearTimeout(this.timeout),this.timeout=setTimeout($.proxy(e.event,t),200)})},_onClickList:function(){GO.router.navigate("works/applet/"+this.appletId+"/home",!0)},copyUrl:function(){GO.util.copyUrl()}})});