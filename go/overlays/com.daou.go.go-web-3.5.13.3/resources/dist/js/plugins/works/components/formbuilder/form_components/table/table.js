define("works/components/formbuilder/form_components/table/table",function(require){function y(t,n){var r=[],i=this.$("table.type_normal"),s=this.getComponents();e.isArray(t)?r=t:r=[t];var o=Math.max(i.find("tr").length,r.length);for(var u=0;u<o;u++){var a=r[u],f="tr:nth-child("+(u+1)+")";if(!a)continue;this.$(f).length?this.$(f).attr("data-cloneable","Y"):i.append(b(s)),this.$(f).find("td").length<1&&w(this.$(f),s),E.call(this,this.$(f),a),e.isFunction(n)&&n(this.$(f),a)}this.$("tr:first").find("a.btn-remove-row").remove()}function b(e){var t=$('<tr data-cloneable="Y"></tr>');return w(t,e),t}function w(t,n){e.each(n,function(e){t.append('<td data-cid="'+e.cid+'"></td>')})}function E(t,n){e.isUndefined(t.attr("data-cloneable"))&&t.attr("data-cloneable","Y"),!S(n)&&N(t)&&t.attr("data-cloneable","N");var r=s.getInstance(this.viewType),i=r.getComponentByCid(n.getCid());if(t.find(n.el).length)return;t.find("td[data-cid="+n.getCid()+"]").toggle(i.visible).html(n.el)}function S(e){return e.getViewType()!=="form"?!1:e.isCloneable()}function x(e){e.wrap('<td data-cid="'+e.data("cid")+'"></td>')}function T(){if(e.isUndefined(navigator))return!1;var t=navigator.userAgent,n=/msie|trident/i.test(t),r=t.match(/(?:msie |rv:)(\d+(\.\d+)?)/i);return n&&r&&r.length>0?r[1]==="8.0":!1}function N(e){return e.attr("data-cloneable")==="Y"}function L(t,n){var r=1;return e.each(t,function(t){if(this.clientId==t.cid)return;var i=n.get(t.cid);i&&e.isArray(i)&&r<i.length&&(r=i.length)},this),r}var e=require("underscore"),t=require("app"),n=require("works/component_type"),r=require("works/components/formbuilder/core/form_component"),i=require("works/components/formbuilder/core/component_registry"),s=require("works/components/formbuilder/core/component_manager"),o=require("works/components/formbuilder/core/views/containable_form"),u=require("works/components/formbuilder/core/views/base_detail"),a=require("works/components/formbuilder/core/views/base_option"),f=require("hgn!works/components/formbuilder/form_components/table/detail"),l=require("hgn!works/components/formbuilder/form_components/table/table_form"),c=require("hgn!works/components/formbuilder/form_components/table/table_option"),h=require("hgn!works/components/formbuilder/form_components/table/table_buttons"),p=require("i18n!works/nls/works"),d=require("i18n!nls/commons"),v=require("works/components/formbuilder/constants"),m=require("works/constants/component_type");require("browser");var g={"\uc774\ub984":d["\uc774\ub984"],"\uc124\uba85":p["\uc124\uba85"],"\uc774\ub984\uc744 \uc785\ub825\ud574\uc8fc\uc138\uc694":p["\uc774\ub984\uc744 \uc785\ub825\ud574\uc8fc\uc138\uc694."],"\uc124\uba85\uc744 \uc785\ub825\ud574\uc8fc\uc138\uc694":p["\uc124\uba85\uc744 \uc785\ub825\ud574\uc8fc\uc138\uc694."],"\ud234\ud301\uc73c\ub85c \ud45c\ud604":p["\ud234\ud301\uc73c\ub85c \ud45c\ud604"],"\uc774\ub984\uc228\uae30\uae30":p["\uc774\ub984\uc228\uae30\uae30"],tableName:p["\ud14c\uc774\ube14 \uc774\ub984"],"\uc635\uc158":p["\uc635\uc158"],"\ucd94\uac00":d["\ucd94\uac00"],"\uc0ad\uc81c":d["\uc0ad\uc81c"]},C=o.extend({events:{"click .table-buttons .btn-add-row":"_addTableRow","click .table-buttons .btn-remove-row":"_removeTableRow"},initialize:function(e){o.prototype.initialize.apply(this,arguments),this.$el.addClass("table"),this.listenTo(this.observer,"changeDisplay",this._onChangeDisplay),this.listenTo(this.model,"change:label",this._onChangeLabel),this.listenTo(this.model,"change:hideLabel",this._onChangeHideLabel),this.listenTo(this.model,"change:guideAsTooltip",this._onChangeGuideAsTooltip),this.listenTo(this.model,"change:guide",this._onChangeGuide),this.isRendered=!1},render:function(){this.isRendered||(this.isRendered=!0,this.$body.addClass("table_box"),this.$body.html(l({model:this.model.toJSON(),label:t.util.escapeHtml(this.model.get("label")),clientId:this.getCid()})),this._onChangeHideLabel(),this._onChangeGuide(),this.isEditable()&&(this.getContainerEl().addClass(v.CN_CONTAINABLE),this._addDropPlaceholder()))},_onChangeLabel:function(){this.$("[data-model-label]").html(t.util.escapeHtml(this.model.get("label")))},_onChangeHideLabel:function(){this.$('[data-selector="!hideLabel"]').toggle(!this.model.get("hideLabel")),this._toggleGuideArea()},_onChangeGuideAsTooltip:function(){this._toggleGuideArea()},_onChangeGuide:function(){this._toggleGuideArea(),this.$('[data-model="guide"]').text(this.model.get("guide"))},_toggleGuideArea:function(){var e=this.model.get("guideAsTooltip"),t=!!this.model.get("guide");this.$('[data-selector="guideAsTooltip"]').css("display",!!e&&t&&!this.model.get("hideLabel")?"inline-block":"none"),this.$('[data-selector="!guideAsTooltip"]').css("display",!e&&t?"inline-block":"none")},getContainerEl:function(){return this.$(".table-container")},getChildElements:function(){return this.getContainerEl().find("."+v.CN_COMPONENT)},initChildComponent:function(e){return o.prototype.initChildComponent.apply(this,arguments),this.isEditable()&&e.setMultiple(!0),e},appendChildView:function(t){y.call(this,t,e.bind(this._appendButtons,this))},sortItems:"td:not(.unsortable)",sortPlaceholder:{element:function(){return $('<div class="'+v.CN_PLACEHOLDER+'"></div>')[0]},update:function(){}},sortStop:function(e,t){if(!this.sortCheckAcceptComponent(e,t))return;if(this.isComponentTypeElement(t.item))return;if(t.item.parent("td")){var n=s.getComponent(t.item.data("cid"));this.orderComponent(n),this.observer.trigger(v.EVENT_STOP_SORTING)}},sortReceive:function(e,t){var n,r;if(!this.sortCheckAcceptComponent(e,t)){this.revertUnacceptableComponent(e,t);return}if(this.isComponentTypeElement(t.item)){var i=t.item.data("component-type");n=this.createComponent(i,this.getCid());if(!n)return;var o=this.getComponentView(n);this.$("."+v.CN_COMPONENT_TYPE).replaceWith(o.el),o.renderNode(),r=o.$el}else n=s.getComponent(t.item.data("cid")),r=t.item;n.setMultiple(!0),x(r),this._removeDropPlaceholder(),this.orderComponent(n)},sortRemove:function(e,t){if(!this.sortCheckAcceptComponent(e,t))this.revertUnacceptableComponent(e,t);else{var n=o.prototype.sortRemove.apply(this,arguments);n.setMultiple(!1),t.item.replaceWith(this.getComponentView(n).el)}},afterRemoveComponent:function(e){var t=o.prototype.afterRemoveComponent.apply(this,arguments);this.$("td[data-cid="+t.getCid()+"]:empty").length>0&&this.$("td[data-cid="+t.getCid()+"]:empty").remove(),this._addDropPlaceholder()},_addDropPlaceholder:function(){if(!T())return;if(this.getComponents().length>0)return;if(this.$(".drop-placeholder").length>0)return;var e=$('<td class="drop-placeholder"></td>');this.getContainerEl().append(e)},_removeDropPlaceholder:function(){this.$(".drop-placeholder").remove()},_appendButtons:function(e){if(this.isEditable())return;var t=e.find(".table-buttons");if(N(e))t.length||(e.find("td[data-blank]").remove(),t=$(h({lang:g})));else{var n=e.find("td[data-blank]");!n.length&&!t.length&&(t="<td data-blank>&nbsp;</td>")}e.append(t)},_addTableRow:function(t){t.preventDefault();var n=$(t.currentTarget),r=n.closest("tr"),i=r.index(),o=this.getComponents(),u=b(o);return e.each(o,function(e){var t=s.getComponent(e.cid),n=t.getView(),r=n.createMultipleView({},i);r&&E.call(this,u,r)},this),this._appendButtons(u),r.after(u),u.find("[data-el-masking]").toggle(),!1},_removeTableRow:function(t){t.preventDefault();var n=$(t.currentTarget),r=n.closest("tr"),i=n.closest("table[data-cid="+this.getCid()+"]"),o=this.getComponents(),u=e.map(r.find("[data-id]"),function(e){return $(e).attr("data-id")});return e.each(o,function(e,t){var n=s.getComponent(e.cid),r=n.getView();r.removeMultipleView(u[t])}),i.find("tr").length>1?r.remove():$.goAlert(d["\uc0ad\uc81c\ud560 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4."]),!1},_onChangeDisplay:function(t){this.$("td[data-cid="+t.cid+"]").toggle(t.flag);var n=this.$('tr[data-cloneable="N"]'),r=!1;e.each(n.find("td:has(div)"),function(e){if($(e).css("display")!=="none")return r=!0,!1}),n.toggle(r)}}),k=u.extend({initialize:function(e){u.prototype.initialize.apply(this,arguments),this.$el.addClass("table")},render:function(){this.$body.addClass("table_box"),this.$body.html(f({model:this.model.toJSON(),label:t.util.escapeHtml(this.model.get("label")),clientId:this.getCid()}))},getContainerEl:function(){return this.$(".table-container")},appendChildView:function(e){y.call(this,e)}}),A=a.extend({renderBody:function(){this.$el.html(c({lang:g,model:this.model.toJSON()}))}}),O=r.define(n.Table,{name:p["\ud14c\uc774\ube14 \uc601\uc5ed"],group:"basic",acceptComponent:[n.Text,n.Number,n.Date,n.Time,n.Datetime,n.Select],properties:{label:{defaultValue:g.tableName},hideLabel:{defaultValue:!1},guide:{defaultValue:""},guideAsTooltip:{defaultValue:!0}},OptionView:A,FormView:C,DetailView:k,initialize:function(){this.getMaxRow=function(){return this.maxRow>1?this.maxRow:(this.maxRow=L(this.components,this.getAppletDocModel()),this.maxRow)}}});i.addComponent(O)});