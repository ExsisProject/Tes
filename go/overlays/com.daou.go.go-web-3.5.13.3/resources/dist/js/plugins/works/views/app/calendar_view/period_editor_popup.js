define("works/views/app/calendar_view/period_editor_popup",function(require){var e=require("backbone"),t=require("app"),n=require("hgn!works/templates/app/calendar_view/period_editor_popup"),r=require("hgn!works/templates/app/calendar_view/period_editor_item"),i=require("i18n!nls/commons"),s=require("i18n!works/nls/works"),o={"\uc885\ub8cc\uc77c":s["\uc885\ub8cc\uc77c"],"\uc2dc\uc791\ub0a0\uc9dc\uc120\ud0dd":s["\uc2dc\uc791\ub0a0\uc9dc \uc120\ud0dd"],"\uc885\ub8cc\ub0a0\uc9dc\uc120\ud0dd":s["\uc885\ub8cc\ub0a0\uc9dc \uc120\ud0dd"],"\ub0a0\uc9dc\ud56d\ubaa9\ucd94\uac00":s["\ub0a0\uc9dc\ud56d\ubaa9 \ucd94\uac00"]},u=10,a=e.View.extend({tagName:"li",className:"period_item",events:{"click [data-delete]":"_onClickDelete","click .wrap_toggle_btn label":"_onToggleSwitch","change .startField select":"_onChangeStartSelect","change .endField select":"_onChangeEndSelect"},initialize:function(e){this.dateFields=e.dateFields},render:function(){return this.$el.html(r({lang:o,dateFields:this.dateFields})),this},_onChangeStartSelect:function(e){var t=$(e.currentTarget),n=t.find("option:selected"),r=t.closest(".period_item").find(".endField select"),i=r.find("option:selected");i.attr("data-value-type")!=="none"&&this.validateStartEndOption(n,i)},_onChangeEndSelect:function(e){var t=$(e.currentTarget),n=t.find("option:selected"),r=t.closest(".period_item").find(".startField select"),i=r.find("option:selected");this.validateStartEndOption(i,n)},validateStartEndOption:function(e,n){var r=n.parent().find("option[data-value-type='none']");e.attr("data-value-type")!==n.attr("data-value-type")?($.goSlideMessage(t.i18n(s["'{{arg1}}'\uc640 '{{arg2}}'\uc740 \ub370\uc774\ud130 \ud45c\uae30\ubc29\uc2dd\uc774 \ub2ec\ub77c \ub370\uc774\ud130\ub97c \ud45c\uc2dc\ud560 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4.(ex. \ub0a0\uc9dc vs \ub0a0\uc9dc\uc640 \uc2dc\uac04)"],{arg1:e.text(),arg2:n.text()})),r.prop("selected",!0)):e.val()===n.val()&&($.goSlideMessage(s["\uc2dc\uc791\ub0a0\uc9dc\uc640 \uc885\ub8cc\ub0a0\uc9dc\uac00 \ub3d9\uc77c\ud558\uc5ec \ub370\uc774\ud130\ub97c \ud45c\uc2dc\ud560 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4."]),r.prop("selected",!0))},_onClickDelete:function(e){if($("#period_items .period_item").length==1)return $.goSlideMessage(s["\ud558\ub098 \uc774\uc0c1\uc758 \ub0a0\uc9dc \ud56d\ubaa9\uc774 \ud544\uc694\ud569\ub2c8\ub2e4."]);$(e.currentTarget).closest(".period_item").remove()},_onToggleSwitch:function(e){var t=$(e.currentTarget),n=t.closest(".period_item"),r=n.find("input"),i=n.find(".date_wave"),s=n.find(".endField"),o=r.prop("checked");r.prop("checked",o?!1:!0),i.css("display",o?"none":"inline-block"),s.css("display",o?"none":"inline-block")}});return e.View.extend({events:{"click #addRow":"addRow"},initialize:function(e){this.options=e||{},this.periods=e.periods||[],this.dateFields=e.dateFields||[]},render:function(){this.$el.html(n({lang:o}));var e=this;this.periods.forEach(function(t){var n=e.addRow();n.attr("period_id",t.id),n.find(".startField select").val(t.startCid),t.endCid?(n.find(".endField select").val(t.endCid),n.find("input[type='checkbox']").prop("checked",!0),n.find(".date_wave, .endField").css("display","inline-block")):n.find("input[type='checkbox']").prop("checked",!1)})},addRow:function(e){var n=this.$el.find("#period_items div").length;if(n==u){$.goSlideMessage(t.i18n(s["\ucd5c\ub300 \uc120\ud0dd \uac2f\uc218\ub294 {{arg1}}\uac1c \uc785\ub2c8\ub2e4."],{arg1:u}));return}var r=new a({dateFields:this.dateFields}),i=r.render().$el;return this.$el.find("#period_items").append(i),_.isUndefined(e)&&this.$el.find(".showEndField").show(),i},savePeriods:function(e){var n=this._getData(),r=this._validateData(n);if(!r)return;$.ajax({url:t.contextRoot+"api/works/applet/"+e+"/calendarview/periods",type:"PUT",contentType:"application/json",dataType:"json",data:JSON.stringify(n)}).done(function(){$.goMessage(i["\uc800\uc7a5\ub418\uc5c8\uc2b5\ub2c8\ub2e4."]),t.router.navigate("works/applet/"+e+"/calendar",!0)}).fail(function(){$.goMessage(i["\uc2e4\ud328\ud588\uc2b5\ub2c8\ub2e4."])})},_getData:function(){var e=[],t=this.$el.find("#period_items .period_item");return _.each(t,function(t){var n=$(t).attr("period_id"),r=$(t).find(".startField option:selected"),i=$(t).find(".endField option:selected"),s=$(t).find(".wrap_toggle_btn input:checkbox").prop("checked");e.push({id:n,startCid:r.val(),endCid:s?i.val():undefined})}),e},_validateData:function(e){if(e.length==0)return $.goMessage(s["\ud558\ub098 \uc774\uc0c1\uc758 \ub0a0\uc9dc \ud56d\ubaa9\uc774 \ud544\uc694\ud569\ub2c8\ub2e4."]),!1;var t=_.collect(e,function(e){return JSON.stringify(_.omit(e,"id"))}),n=_.uniq(t);return t.length!=n.length?($.goMessage(s["\uc911\ubcf5\ub41c \ub0a0\uc9dc \ud56d\ubaa9\uc774 \uc788\uc2b5\ub2c8\ub2e4."]),!1):!0}})});