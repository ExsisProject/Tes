define("works/components/formbuilder/form_components/org_dept/org_dept",function(require){var e=require("app"),t=require("when"),n=require("works/component_type"),r=require("works/components/formbuilder/core/form_component"),i=require("works/components/formbuilder/core/component_registry"),s=require("works/components/formbuilder/core/views/base_form"),o=require("works/components/formbuilder/core/views/base_detail"),u=require("works/components/formbuilder/core/views/base_option"),a=require("collections/joined_depts"),f=require("hgn!works/components/formbuilder/form_components/org_dept/form"),l=require("hgn!works/components/formbuilder/form_components/org_dept/detail"),c=require("hgn!works/components/formbuilder/form_components/org_dept/option"),h=require("views/mobile/m_org"),p=require("works/libs/util"),d=require("go-nametags"),v=require("i18n!works/nls/works"),m=require("i18n!nls/commons");require("jquery.go-orgslide");var g=10,y={"\uc774\ub984":m["\uc774\ub984"],"\uc124\uba85":v["\uc124\uba85"],"\uc774\ub984\uc744 \uc785\ub825\ud574\uc8fc\uc138\uc694":v["\uc774\ub984\uc744 \uc785\ub825\ud574\uc8fc\uc138\uc694."],"\uc124\uba85\uc744 \uc785\ub825\ud574\uc8fc\uc138\uc694":v["\uc124\uba85\uc744 \uc785\ub825\ud574\uc8fc\uc138\uc694."],"\ud234\ud301\uc73c\ub85c \ud45c\ud604":v["\ud234\ud301\uc73c\ub85c \ud45c\ud604"],"\ud544\uc218 \uc785\ub825 \ucef4\ud3ec\ub10c\ud2b8":v["\ud544\uc218 \uc785\ub825 \ucef4\ud3ec\ub10c\ud2b8"],"\uae30\ubcf8\uac12":v["\uae30\ubcf8\uac12"],"\uc138\ubd80\ud56d\ubaa9":v["\uc138\ubd80\ud56d\ubaa9"],"\ucd94\uac00":m["\ucd94\uac00"],"\uc0ad\uc81c":m["\uc0ad\uc81c"],"\uc774\ub984\uc228\uae30\uae30":v["\uc774\ub984\uc228\uae30\uae30"],"\ubd80\uc11c \uc120\ud0dd \ud5c8\uc6a9 \uc218":v["\ubd80\uc11c \uc120\ud0dd \ud5c8\uc6a9 \uc218"],"\uc81c\ud55c \uc5c6\uc74c":v["\uc81c\ud55c \uc5c6\uc74c"],"\uae30\ubcf8 \uac12 \uc9c0\uc815":v["\uae30\ubcf8 \uac12 \uc9c0\uc815"],"\ub4f1\ub85d\uc790\uc758 \ubd80\uc11c\ub97c \uae30\ubcf8\uac12\uc73c\ub85c \uc9c0\uc815":v["\ub4f1\ub85d\uc790\uc758 \ubd80\uc11c\ub97c \uae30\ubcf8\uac12\uc73c\ub85c \uc9c0\uc815"],"\ubd80\uc11c \ucd5c\ub300\uac12":e.i18n(v["\ucd5c\ub300 {{arg}}\uac1c \ubd80\uc11c\uae4c\uc9c0 \uc124\uc815 \uac00\ub2a5"],"arg",g)},b=u.extend({customEvents:{"keypress input[name=allowDeptCount]":"replaceNumber","focusout input[name=allowDeptCount]":"_setAllowDeptCount"},replaceNumber:function(e){var t=e.keyCode?e.keyCode:e.which;if(!p.isNumber(t)){var n=$(e.currentTarget).val().replace(/[^0-9]/gi,"");return $(e.currentTarget).val(n),e.preventDefault(),!1}},_setAllowDeptCount:function(e){var t=$(e.currentTarget);!t.val()||parseInt(t.val())<1?(this.model.set(t.attr("name"),1),t.val(1)):parseInt(t.val())>g?(this.model.set(t.attr("name"),g),t.val(g)):(this.model.set(t.attr("name"),parseInt(t.val())),t.val(parseInt(t.val())))},onAddDepts:function(e){var t=_.isArray(e)?e:[e];_.each(t,function(e){this.nameTag.addTag(e.id,e.name,{attrs:e,removable:!0})},this),this.model.set("depts",this.nameTag.getNameTagList())},renderBody:function(){var t=this;this.$el.html(c({model:this.model.toJSON(),lang:y})),this.nameTag=d.create({},{useAddButton:!0}),this.$("div[name='nameTagArea']").html(this.nameTag.el),_.each(this.model.get("depts"),function(e){t.nameTag.addTag(e.id,e.name,{attrs:e,removable:!0})},this),this.nameTag.$el.on("nametag:clicked-add",function(){$.goOrgSlide({header:v["\ubd80\uc11c \ucd94\uac00"],type:"department",desc:"",contextRoot:e.config("contextRoot"),callback:$.proxy(function(e){e.type=="org"&&t.onAddDepts(e)},t)})}),this.nameTag.$el.on("nametag:removed",$.proxy(this.onRemoveDept,this))},onRemoveDept:function(e,t){var n=new Backbone.Collection(this.model.get("depts")),r=n.findWhere({id:t});n.remove(r),this.model.set("depts",n.toJSON())}}),w=s.extend({initialize:function(){this.registerDept=null;var e=a.fetch();if(e.length){var t=_.find(e.models,function(e){return e.get("userDepartmentOrder")==1});this.registerDept=t||e.at(0)}s.prototype.initialize.apply(this,arguments)},render:function(){this.$body.html(f({model:this.model.toJSON(),label:e.util.escapeHtml(this.model.get("label")),lang:y})),this.initRender()},initRender:function(){var t=this;this.nameTag=d.create({},{useAddButton:!0}),this.$("div[name='nameTagArea']").html(this.nameTag.el),this.isEditable()||(this.nameTag.$el.on("nametag:clicked-add",function(){e.util.isMobile()?t.mobileNametTagCallback():t.namtTagCallback()}),this.nameTag.$el.on("nametag:removed",$.proxy(this.onRemove,this))),this.addCurrentDeptByOption(),_.each(t._getDepts(),function(e){t.nameTag.addTag(e.id,e.name,{attrs:e,removable:!t.isEditable()})},t),t.appletDocModel.set(t.getDataFromView())},mobileNametTagCallback:function(){var t=this,n=_.map(t.nameTag.getNameTagList(),function(e){return{id:e.id,username:e.name}});e.router.navigate(e.router.getUrl()+"#org",{trigger:!1,pushState:!0}),this.orgView=new h({type:"department"}),this.orgView.render({title:v["\ubd80\uc11c \ucd94\uac00"],checkedUser:n,callback:function(e){return _.each(t.nameTag.getNameTagList(),function(e){t.nameTag.removeTag(e.id)},t),t.onAddDepts(e),!1}}),e.EventEmitter.trigger("common","layout:scrollToTop",this)},namtTagCallback:function(){var t=this;$.goOrgSlide({header:v["\ubd80\uc11c \ucd94\uac00"],type:"department",desc:"",contextRoot:e.config("contextRoot"),callback:$.proxy(function(e){e.type=="org"&&t.onAddDepts(e)},t)})},addCurrentDeptByOption:function(){this.model.get("useDefaultRegister")&&!this.isEditable()&&!this.appletDocModel.id&&this.registerDept&&this.nameTag.addTag(this.registerDept.get("id"),this.registerDept.get("name"),{attrs:this.registerDept.toJSON(),removable:!0})},_getDepts:function(){return this.appletDocModel.id?this.appletDocModel.get(this.getCid()):this.appletDocModel.get(this.getCid())||this.model.get("depts")},validate:function(){var t=this.$('div[name="nameTagArea"]'),n=this.nameTag.getNameTagList();return this.model.get("required")&&n.length<1?(this.printErrorTo(t,v["\ud544\uc218 \ud56d\ubaa9\uc785\ub2c8\ub2e4."]),!1):n.length>this.model.get("allowDeptCount")?(this.printErrorTo(t,e.i18n(v["\ucd5c\ub300 {{arg}}\uac1c \ubd80\uc11c\uae4c\uc9c0 \uc124\uc815\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4"],"arg",this.model.get("allowDeptCount"))),!1):n.length>g?(this.printErrorTo(t,e.i18n(v["\ucd5c\ub300 {{arg}}\uac1c \ubd80\uc11c\uae4c\uc9c0 \uc124\uc815\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4"],"arg",g)),!1):!0},getDataFromView:function(){var e={};return e[this.clientId]=this.nameTag?this.nameTag.getNameTagList():"",e},onAddDepts:function(e){var t=_.isArray(e)?e:[e];_.each(t,function(e){this.nameTag.addTag(e.id,e.name,{attrs:e,removable:!0})},this),this.appletDocModel.set(this.getDataFromView())},onRemove:function(){this.appletDocModel.set(this.getDataFromView())},_getDefaultValue:function(){var e=this.model.get("depts")||[];return this.model.get("useDefaultRegister")&&this.registerDept&&e.push(this.registerDept),e}}),E=o.extend({render:function(){var t=_.each(this.appletDocModel.get(this.clientId),function(e){e.displayName=e.name});this.$body.html(l({model:this.model.toJSON(),userData:t,label:e.util.escapeHtml(this.model.get("label")),"isMobile?":e.util.isMobile(),lang:y}))},getTitle:function(){var e=this.appletDocModel.get(this.clientId)||[],t=_.each(e,function(e){e.displayName=e.name});return t.length<1?"":_.pluck(this.appletDocModel.get(this.clientId),"displayName").join(", ")}}),S=r.define(n.OrgDept,{type:"org_dept",name:v["\ubd80\uc11c \uc120\ud0dd"],valueType:"DEPTS",group:"basic",properties:{label:{defaultValue:v["\ubd80\uc11c \uc120\ud0dd"]},hideLabel:{defaultValue:!1},guide:{defaultValue:""},guideAsTooltip:{defaultValue:!0},required:{defaultValue:!1},noLimit:{defaultValue:!0},useDefaultRegister:{defaultValue:!1},allowDeptCount:{defaultValue:"1"},depts:{defaultValue:[]}},OptionView:b,FormView:w,DetailView:E});i.addComponent(S)});