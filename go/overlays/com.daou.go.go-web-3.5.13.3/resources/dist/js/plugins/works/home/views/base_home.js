define("works/home/views/base_home",function(require){require("jquery.mobile");var e=require("i18n!nls/commons"),t=require("i18n!works/nls/works"),n={all:t["Works \ud648"],favorite:t["\uc990\uaca8\ucc3e\ub294 \uc571"],manage:t["\uc6b4\uc601\uc911\uc778 \uc571"],share:t["\uc571 \uacf5\uc720\ud558\uae30"],buttonTitle:t["\uc571 \ucd94\uac00\ud558\uae30"],buttonDesc:t["\uc571 \ub9cc\ub4e4\uae30 \uc548\ub0b4\ubb38\uad6c"],"\ub9ac\uc2a4\ud2b8 \ud615\ud0dc\ub85c \ubcf4\uae30":t["\ub9ac\uc2a4\ud2b8 \ud615\ud0dc\ub85c \ubcf4\uae30"],"\uce74\ub4dc \ud615\ud0dc\ub85c \ubcf4\uae30":t["\uce74\ub4dc \ud615\ud0dc\ub85c \ubcf4\uae30"],"\uc815\ub82c":t["\uc815\ub82c"],"\uac00\ub098\ub2e4 \uc21c":t["\uac00\ub098\ub2e4 \uc21c"],"\ucd5c\uadfc \uc5f4\uc5b4\ubcf8 \uc21c":t["\ucd5c\uadfc \uc5f4\uc5b4\ubcf8 \uc21c"],"\uc804\uccb4":e["\uc804\uccb4"],"\ub098\uc758 \ud3f4\ub354":t["\ub098\uc758 \ud3f4\ub354"],"\ud3f4\ub354 \ub9cc\ub4e4\uae30":t["\ud3f4\ub354 \ub9cc\ub4e4\uae30"],"\ud3f4\ub354 \ub9cc\ub4e4\uae30 \uc124\uba85":t["\ud3f4\ub354 \ub9cc\ub4e4\uae30 \uc124\uba85"],"\uc571 \ub0b4\ubcf4\ub0b4\uae30":t["\uc571 \ub0b4\ubcf4\ub0b4\uae30"],"\uc571 \uac00\uc838\uc624\uae30":t["\uc571 \uac00\uc838\uc624\uae30"],"\uc571 \ub0b4\ubcf4\ub0b4\uae30 \uc124\uba85":t["\uc571 \ub0b4\ubcf4\ub0b4\uae30 \uc124\uba85"],"\uc571 \uba85\uc744 \uc785\ub825\ud558\uc138\uc694":t["\uc571 \uba85\uc744 \uc785\ub825\ud558\uc138\uc694."],"\uc6d0\ud558\ub294 \uc571\uc744\uac04\ud3b8\ud558\uac8c \ub9cc\ub4e4\uc5b4\ubcf4\uc138\uc694":t["\uc6d0\ud558\ub294 \uc571\uc744 \uac04\ud3b8\ud558\uac8c \ub9cc\ub4e4\uc5b4\ubcf4\uc138\uc694!"]},r=require("works/constants/works"),i=require("works/models/applet_admin"),s=require("works/collections/applet_simples"),o=require("works/home/collections/applet_folders"),u=require("works/home/collections/applet_export_list"),a=require("works/home/collections/applet_import_list"),f=require("works/models/applet_accessible"),l=require("works/home/views/applet_item"),c=require("works/home/views/applet_folder_item"),h=require("works/home/views/applet_export");return Backbone.View.extend({events:{"vclick [data-all]":"_onClickHome","vclick [data-favorite]":"_onClickFavorite","vclick [data-manage]":"_onClickManage","vclick [data-toggle-layout]":"_onClickToggleLayout","vclick a[data-folder-id]":"_onClickFolderItem","vclick [applet-share]":"_onClickShareAppletList"},initialize:function(e){e=e||{},this.appletType=e.appletType||GO.util.store.get(GO.session("id")+"-works-home-tab-type")||r.WORKS_HOME_TAB_TYPE.ALL,this.folderId=e.folderId;var t="works/home/"+this.appletType+(this.appletType==="folder"?"/"+this.folderId:"");GO.router.navigate(t,{replace:!0}),this.viewType=GO.util.store.get(GO.session("id")+"-works-home-view-type")||r.APPLET_VIEW_TYPE.CARD,this.lang=n,this.order=GO.util.store.get(GO.session("id")+"-works-home-order")||"name",this.hasAccessibleApplet=new f,this.folders=new o([],{orderBy:this.order}),this.applets=new s([],{type:this.appletType,folderId:this.folderId}),this.checkAdmin=new i,this.exportApplets=new u,this.importApplets=new a,this.listenTo(this.checkAdmin,"sync",this._onSyncCheckAdmin),this.listenTo(this.hasAccessibleApplet,"sync",this._onSyncHasAccessibleApplets),this.listenTo(this.folders,"remove",this._onDestroyFolder),this.listenTo(this.folders,"sync",this._onSyncFolders),this.listenTo(this.applets,"sync",this._onSyncApplets),this.listenTo(this.exportApplets,"sync",this._onSyncExportAppletList),this.applets.setOrder(this.order)},render:function(){return this.fetch(),this},fetch:function(){var e=$.Deferred();return $.when(this.hasAccessibleApplet.fetch()).then($.proxy(function(){e.resolve()},this)).then($.proxy(function(){e.reject()},this)),e},_onSyncFolders:function(){this._renderFolders()},_onSyncApplets:function(){this._toggleIconClass(this.applets.getType()),this.$("[data-app-list]").empty(),this._renderApplets(),this._toggleFolders(),this._toggleAddButtonAndEmptyMessage()},_onSyncCheckAdmin:function(){this._toggleAppletShare(),this._toggleAddButtonAndEmptyMessage()},_onSyncExportAppletList:function(){this._renderExportAppletList()},_onDestroyFolder:function(e){e.id===parseInt(this.applets.getFolderId())&&(this.applets.setType("all"),GO.router.navigate("works/home/all",{replace:!0})),this.folders.fetch(),GO.util.preloader(this.applets.fetch())},_toggleIconClass:function(e){this.$("#worksTabs").find("li").removeClass("on"),this.$('[data-btn-type="'+e+'"]').addClass("on")},_commonAction:function(e){this._toggleIconClass(e),this.applets.setType(e),e!="share"&&GO.util.store.set(GO.session("id")+"-works-home-tab-type",e,"local"),GO.util.preloader(this.applets.fetch({reset:!0})),this._pushState("works/home/"+e)},_pushState:function(e){var t=GO.router.getUrl();t!==e&&GO.router.navigate(e)},_onClickFolderItem:function(e){e.preventDefault(),this._setContent("folder");var t=$(e.currentTarget).attr("data-folder-id");this.applets.setType("folder"),this.applets.setFolderId(t),GO.util.preloader(this.applets.fetch()),this._pushState("works/home/folder/"+t),$(window).scrollTop(0)},_onClickHome:function(){this._setContent("all"),this.$("[data-group-list]").show(),this._commonAction("all"),this.$("section.search_wrap").show(),this._setInitializeAppSearch()},_onClickFavorite:function(){this._setContent("favorite"),this.$("[data-group-list]").hide(),this._commonAction("favorite"),this.$("section.search_wrap").hide()},_onClickManage:function(){this._setContent("manage"),this.$("[data-group-list]").hide(),this._commonAction("manage"),this.$("section.search_wrap").hide()},_onClickShareAppletList:function(){this._setContent("share"),this._commonAction("share"),this.exportApplets.fetch()},_setInitializeAppSearch:function(){this.$("#appName").val(""),this.$("[data-el-app-search-btn]").removeClass("searching")},_setContent:function(e){e=e||this.applets.getType(),e==="share"?(this._setToggleLayout("list"),this.$("[data-base-options]").hide(),this.$("[data-works-home]").hide(),this.$("[data-share-content]").show(),this.$("[tab-applet-export]").attr("class","active"),this.$("[tab-applet-import]").attr("class","selectable"),this.$("[data-applet-share-info]").html(n["\uc571 \ub0b4\ubcf4\ub0b4\uae30 \uc124\uba85"])):(this._setToggleLayout(),this.$("[data-base-options]").show(),this.$("[data-works-home]").show(),this.$("[data-share-content]").hide())},_setToggleLayout:function(e){e=_.isUndefined(e)?GO.util.store.get(GO.session("id")+"-works-home-view-type")||"card":"list",this.$toggleLayoutEl.removeClass("list_type").removeClass("card_type").addClass(e+"_type")},_onClickToggleLayout:function(){this._toggleLayout()},_toggleLayout:function(e){return e=_.isUndefined(e)?this.$toggleLayoutEl.hasClass("card_type")?"list":"card":e,this.$toggleLayoutEl.removeClass("list_type").removeClass("card_type").addClass(e+"_type"),GO.util.store.set(GO.session("id")+"-works-home-view-type",e,"local"),e},_renderApplets:function(){this.applets.each(function(e){var t=new l({model:e});this.$("[data-app-list]").append(t.render().el)},this),this.applets.length||this._renderAppletEmpty()},_renderFolders:function(){this.$("[data-group-list]").empty(),this.folders.each(function(e){var t=new c({model:e});this.$("[data-group-list]").append(t.render().el)},this)},_onSyncHasAccessibleApplets:function(){if(!this.hasAccessibleApplet.get("false")){var e=$.Deferred();return GO.util.preloader($.when(this.checkAdmin.fetch(),this.folders.fetch(),this.applets.fetch()).then($.proxy(function(){this.appletType=="share"&&this._shareFetch(),e.resolve()},this)).then($.proxy(function(){e.reject()},this))),e}GO.router.navigate("works/start",{pushState:!0,trigger:!0})},_renderAppletEmpty:function(){var n=t["\uc571\uc5c6\uc74c \uc804\uccb4 \uc81c\ubaa9"],i=t["\uc571\uc5c6\uc74c \uc804\uccb4 \ub0b4\uc6a9"];this.applets.getType()==r.WORKS_HOME_TAB_TYPE.FAVORITE?(n=t["\uc571\uc5c6\uc74c \uc990\uaca8\ucc3e\uae30 \uc81c\ubaa9"],i=t["\uc571\uc5c6\uc74c \uc990\uaca8\ucc3e\uae30 \ub0b4\uc6a9"]):this.applets.getType()==r.WORKS_HOME_TAB_TYPE.MANAGE?(n=t["\uc571\uc5c6\uc74c \uc6b4\uc601\uc911 \uc81c\ubaa9"],i=t["\uc571\uc5c6\uc74c \uc6b4\uc601\uc911 \ub0b4\uc6a9"]):this.applets.getType()==r.WORKS_HOME_TAB_TYPE.SEARCH&&(n=e["\uac80\uc0c9\uacb0\uacfc\uc5c6\uc74c"],i=""),this.$("[data-empty-title]").text(n),this.$("[data-empty-desc]").text(i)},_renderExportAppletList:function(){this.$("[data-share-item-list]").empty(),this.appExportListView=new h({models:this.exportApplets}),this.$("[data-share-item-list]").append(this.appExportListView.render().el)},_toggleAppletShare:function(){this.checkAdmin.isWorksAdmin()?this.$("[data-side-share]").show():this.$("[data-side-share]").hide()},_shareFetch:function(){this.checkAdmin.isWorksAdmin()?this.exportApplets.fetch():GO.util.error("403",{msgCode:"400-works"})},_toggleFolders:function(){var e=this.applets.getType()==="all";this.$("[data-group-list]").toggle(e)},_toggleAddButtonAndEmptyMessage:function(){var e=!!this.checkAdmin.get("true");this.$("[data-add-applet]").toggle(e),this.$("[data-app-create]").toggle(e),this.$("[data-app-create-auth]").toggle(!e),this.$("[data-app-create-title]").toggle(e);if(this.applets.getType()==r.WORKS_HOME_TAB_TYPE.SEARCH){var t=!this.applets.length;this.$("[data-empty-message]").toggle(t),this.$("[data-add-applet]").toggle(!t)}else{var n=GO.util.isMobile()?!1:this.checkAdmin.get("true"),t=!n&&!this.applets.length&&(this.applets.getType()==="all"?!this.folders.length:!0);this.$("[data-empty-message]").toggle(t)}}})});