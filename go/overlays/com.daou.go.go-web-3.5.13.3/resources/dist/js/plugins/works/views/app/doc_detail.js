define("works/views/app/doc_detail",function(require){var e=require("works/models/applet_doc"),t=require("works/models/applet_form"),n=require("works/components/masking_manager/models/masking"),r=require("works/collections/fields"),i=require("works/models/integration"),s=require("works/views/app/base_applet"),o=require("works/views/app/doc_detail/doc_activity"),u=require("works/views/app/doc_detail/doc_action"),a=require("works/views/app/doc_detail/doc_log"),f=require("works/components/consumer/views/consumer"),l=require("works/views/app/doc_content"),c=require("hgn!works/templates/app/doc_detail"),h=require("i18n!works/nls/works"),p=require("i18n!task/nls/task"),d=require("i18n!nls/commons"),v=require("when"),m=require("works/constants/value_type"),g={activity:p["\ud65c\ub3d9\uae30\ub85d"],attach:d["\ucca8\ubd80\ud30c\uc77c"],writeActivity:p["\ud65c\ub3d9\uae30\ub85d \uc4f0\uae30"],fold:h["\uc811\uae30"],loading:d["\uc7a0\uc2dc\ub9cc \uae30\ub2e4\ub824\uc8fc\uc138\uc694"],history:p["\ubcc0\uacbd\uc774\ub825"]},y=Backbone.Collection.extend({model:Backbone.Model,initialize:function(e){this.options=e||{},this.appletId=e.appletId,this.docId=e.docId},url:function(){return GO.config("contextRoot")+"api/works/applets/"+this.appletId+"/docs/"+this.docId+"/actions"}});return s.extend({appletFormModel:null,canvasView:null,initialize:function(i){i=i||{},this.useSearch=!0,this.useNavigate=i.useNavigate,s.prototype.initialize.apply(this,arguments),i.hasOwnProperty("isPrint")&&(this.isPrint=i.isPrint),this.fieldsOfIntegrationApplet={},this.subFormId=i.subFormId?i.subFormId:0,this.fields=new r([],{appletId:i.appletId,subFormId:i.subFormId,includeProperty:!0}),this.appletFormModel=new t({appletId:i.appletId,subFormId:this.subFormId}),this.masking=new n({appletId:this.appletId}),this.masking.fetch(),this.docId=i.docId,this.model=new e({id:this.docId,appletId:this.appletId,subFormId:this.subFormId}),this.actions=new y({appletId:this.appletId,docId:this.docId}),this.filters.on("changeFilter.filters",this._onChangeFilter,this),this._initRender(),this.$el.on("navigate:integrationDoc",$.proxy(function(e,t){var n=_.findWhere(this.model.get("integratedAppsAccessable"),{appletId:t.integrationAppletId}),r=GO.contextRoot+"app/works/applet/",i="width=1280,height=600,status=yes,scrollbars=no,resizable=no";n.accessable?window.open(r+t.integrationAppletId+"/doc/"+t.integrationDocId,"_blank"):window.open(r+t.appletId+"/refer/"+t.integrationAppletId+"/doc/"+t.integrationDocId,"help",i)},this)),this.$el.on("doAction",$.proxy(function(){$.when(this.model.fetch(),this.actions.fetch()).done($.proxy(function(){this._removeNeedToSetProcess(),this._renderAction(),this._renderDocLog(),$.goMessage(d["\ubcc0\uacbd\ub418\uc5c8\uc2b5\ub2c8\ub2e4."])},this))},this))},render:function(){$.when(s.prototype.render.apply(this,arguments),this.appletFormModel.fetch({statusCode:{403:function(){GO.util.error("403",{msgCode:"403-works-accessibleform"})}}}),this.masking.deferred,this.actions.fetch(),this.model.fetch(),this.fields.fetch()).then($.proxy(function(){var e=$.Deferred();return this.fields.getFieldsOfIntegrationApplet().done(_.bind(function(t){this.fieldsOfIntegrationApplet=t,e.resolve()},this)),e},this)).then($.proxy(function(){this.model.isCreator(GO.session("id"))||this.appletFormModel.mergeMaskingValue(this.masking.get("fieldCids")),this._renderContent(),this._renderActivity(),this._renderAction(),this._renderDocLog()},this)).then($.proxy(function(){this._renderConsumer()},this)),this.model.deferred.done($.proxy(function(){_.contains(this.masking.get("fieldCids"),this.model.get("titleCid"))&&!this.model.isCreator(GO.session("id"))&&this._renderMaskedTitle()},this))},renderForPrint:function(){return $.when(this.baseConfigModel.fetch(),this.appletFormModel.fetch({statusCode:{403:function(){GO.util.error("403",{msgCode:"403-works-accessibleform"})}}}),this.model.fetch(),this.fields.fetch(),this.masking.deferred).then($.proxy(function(){var e=$.Deferred();return this.fields.getFieldsOfIntegrationApplet().done(_.bind(function(t){this.fieldsOfIntegrationApplet=t,e.resolve()},this)),e},this)).done($.proxy(function(){this.model.isCreator(GO.session("id"))||this.appletFormModel.mergeMaskingValue(this.masking.get("fieldCids")),this._renderContent()},this))},_renderMaskedTitle:function(){this.$("#subject").parent().html('<div class="hidden_data"><span class="help" title="'+h["\uad00\ub9ac\uc790\uc5d0 \uc758\ud574 \ub9c8\uc2a4\ud0b9 \ucc98\ub9ac \ub41c \ud56d\ubaa9\uc785\ub2c8\ub2e4"]+'"></span>'+"</div>")},_renderConsumer:function(){var e=new f({appletId:this.appletId,docId:this.docId,docText:this.subject});this.$("#consumerArea").html(e.render().el)},_initRender:function(){this.$el.html(c({lang:g,isPrint:this.isPrint}))},_renderContent:function(){this.$("[el-doc-content]").remove();var e=new l({isPrint:this.isPrint,docId:this.docId,model:this.model,baseConfigModel:this.baseConfigModel,appletFormModel:this.appletFormModel,integrationModel:new i(_.extend(this.fieldsOfIntegrationApplet,{fields:this.fields.toJSON()})),formName:this.appletFormModel.get("name"),mainForm:this.appletFormModel.get("mainForm")});this.$(".build_prev_wrap").prepend(e.render().el),this.subject=e._getSubject(),e.printSubjectAndWorkflowText()},_renderAction:function(){this.accessibleMainForm=!1;var e=this;$.ajax({type:"GET",dataType:"json",url:GO.contextRoot+"api/works/applets/"+e.appletId+"/accessible/mainform",success:function(t){e.accessibleMainForm=t.data,e.actionView=new u({model:e.model,isAdmin:e.baseConfigModel.isAdmin(GO.session("id")),subFormId:e.subFormId,actions:e.actions,useNavigate:e.useNavigate,isOrgDocPopup:e.isOrgDocPopup,accessibleMainForm:e.accessibleMainForm}),e.$("#actionArea").html(e.actionView.render().el)}})},_renderActivity:function(){var e=this,t=new o({appletId:this.appletId,docId:this.docId});t.dataFetch().done(function(){t.setElement(e.$("#activitySection")),t.render()}),this.$el.on("change:log",function(){e.logView.logs.setPage(0),e.logView.render()})},_renderDocLog:function(){this.logView=new a({appletId:this.appletId,docId:this.docId,mainForm:this.appletFormModel.get("mainForm")}),this.logView.setElement(this.$("#logSection")),this.logView.render()},_onChangeFilter:function(){GO.router.navigate("works/applet/"+this.appletId+"/home",!0)},_removeNeedToSetProcess:function(){$("#stateArea").siblings(".build_box_data").remove()}})});