define("works/components/filter/views/filter_condition_layer",function(require){require("jquery.go-orgslide");var e=require("i18n!nls/commons"),t={"\ud655\uc778":e["\ud655\uc778"],"\ucde8\uc18c":e["\ucde8\uc18c"]},n=require("works/constants/value_type"),r=require("components/backdrop/backdrop"),i=require("components/date_form/views/date_form"),s=require("works/components/filter/models/filter_condition_option"),o=require("works/components/filter/views/filter_checkable_select"),u=require("works/components/filter/views/filter_text_form"),a=require("works/components/filter/views/filter_integration"),f=require("works/components/filter/views/filter_number_form"),l=require("hgn!works/components/filter/templates/filter_condition_layer");return r.extend({className:"array_option form_box_basic",initialize:function(e){this.fieldType=e.fieldType||e.type,this.valueType=e.valueType||e.type,this.parentCid=e.parentCid,this.fields=e.fields,this.useCheckbox=e.useCheckbox!==!1,this.zIndex=e.zIndex,this.backdropToggleEl=this.$el,this.bindBackdrop(),this.contentView=null,this.$el.on("onClickOption",$.proxy(function(e,t){this._onClickOption(t)},this))},events:{"click a[el-type='submit']":"_onClickSubmit","click a[el-type='cancel']":"_onClickCancel"},render:function(){return this.$el.html(l({lang:t,isAppletDocsType:this._isAppletDocsTypeLayer(),isDateType:this._isDateTypeLayer(),useFooter:this._isSelectTypeConditionLayer()?!1:!0})),this._renderFromValueType(),this},afterShow:function(){this._isImpossibleFocusLayer()||this.$("input[type='text']:first").focus();if(this._isOrgTypeLayer()){var e=this._isUserTypeLayer()?"list":"department";setTimeout($.proxy(function(){this.orgSlide=$.goOrgSlide({type:e,zIndex:this.zIndex,contextRoot:GO.contextRoot,callback:$.proxy(function(e){this._orgCallback(e)},this)}),this.linkBackdrop($(".layer_organogram"))},this),200)}},afterHide:function(){this._isOrgTypeLayer()&&(this.orgSlide=$.goOrgSlide("close")),this._isSelectTypeConditionLayer()&&this.$("[el-search]").val("").trigger("keyup"),this._isAppletDocsTypeLayer()&&(this.contentView.getPopupEl()?this.contentView.getPopupEl().remove():!1)},_renderFromValueType:function(){switch(this.valueType){case n.STEXT:case n.STEXTS:case n.TEXT:case n.FILES:this._renderTextFormView();break;case n.APPLETDOCS:this._renderIntegrationView();break;case n.NUMBER:this._renderNumberFormView();break;case n.DATE:this._renderDateFormView();break;case n.TIME:this._renderTimeFormView();break;case n.DATETIME:this._renderDatetimeFormView();break;case n.SELECT:case n.SELECTS:this._renderCheckableSelectView();break;case n.USER:case n.USERS:case n.DEPTS:this._renderNoSearchCheckableSelectView()}},_renderIntegrationView:function(){this.contentView=new a({fields:this.fields,hasRelativeView:!0,model:this.model}),this.$el.addClass("array_opt_linkage"),this.$("[el-applet-docs-form-wrapper]").addClass("wrap_box_small"),this.$("[el-applet-docs-form]").html(this.contentView.render().el),this.contentView.$el.on("showPopup",$.proxy(function(){this.linkBackdrop(this.contentView.getPopupEl())},this))},_renderTextFormView:function(){this.contentView=new u({model:this.model}),this.$el.prepend(this.contentView.render().el)},_renderNumberFormView:function(){this.contentView=new f({model:this.model}),this.$el.prepend(this.contentView.render().el)},_renderDateFormView:function(){this.contentView=new i({dateTime:this.model.valuesToDateTime(),hasTime:!1,hasRelativeView:!0,values:this.model.get("values"),isRelative:this.model.isRelativeType(),externalModel:this.model}),this.$("[el-date-form-wrapper]").addClass("wrap_box_large"),this.$("[el-date-form]").html(this.contentView.render().el),this.linkBackdrop($("#ui-datepicker-div"))},_renderDatetimeFormView:function(){this.contentView=new i({dateTime:this.model.valuesToDateTime(),hasRelativeView:!0,isRelative:this.model.isRelativeType(),values:this.model.get("values"),externalModel:this.model}),this.$("[el-date-form-wrapper]").addClass("wrap_box_large time_date_option"),this.$("[el-date-form]").html(this.contentView.render().el),this.linkBackdrop($("#ui-datepicker-div")),$("a.ui-datepicker-prev").length==0&&(this.linkBackdrop($("a.ui-datepicker-prev")),this.linkBackdrop($("a.ui-datepicker-next")))},_renderTimeFormView:function(){this.contentView=new i({dateTime:this.model.valuesToDateTime(),hasDate:!1,externalModel:this.model}),this.$("[el-date-form-wrapper]").addClass("wrap_box_small time_date_option"),this.$("[el-date-form]").html(this.contentView.render().el)},_renderCheckableSelectView:function(){this.contentView=new o({useScroll:!0,collection:this.collection,useCheckbox:this.useCheckbox}),this.$el.prepend(this.contentView.render().el)},_renderNoSearchCheckableSelectView:function(){this.contentView=new o({useScroll:!0,collection:this.collection,useSearchForm:!1,valueType:this.valueType}),this.$el.prepend(this.contentView.render().el)},_orgCallback:function(e){var t=new s({value:e.id,label:e.name,isUsed:!0,isOrgType:!0});this.contentView.collection.addOption(t)},_onClickSubmit:function(e){e.stopPropagation();if(typeof this.contentView.isValid=="function"&&!this.contentView.isValid())return!1;typeof this.contentView.setModel=="function"&&this.contentView.setModel(),this.$el.trigger("setLabelText"),this.$el.trigger("changeFilter"),this.toggle(!1)},_onClickCancel:function(e){e.stopPropagation(),typeof this.contentView.resetView=="function"&&this.contentView.resetView(),this.toggle(!1)},_onClickOption:function(e){this._isFieldManager()&&e&&this.toggle(!1)},_isUserTypeLayer:function(){return _.contains([n.USER,n.USERS],this.valueType)},_isDeptTypeLayer:function(){return n.DEPTS==this.valueType},_isOrgTypeLayer:function(){return this._isUserTypeLayer()||this._isDeptTypeLayer()},_isSelectTypeConditionLayer:function(){return _.contains([n.SELECT,n.SELECTS,n.USER,n.USERS,n.DEPTS],this.valueType)},_isDateTypeLayer:function(){return _.contains([n.DATE,n.TIME,n.DATETIME],this.valueType)},_isAppletDocsTypeLayer:function(){return _.contains([n.APPLETDOCS],this.valueType)},_isImpossibleFocusLayer:function(){return _.contains([n.DATE,n.DATETIME,n.APPLETDOCS],this.valueType)},_isFieldManager:function(){return!_.isObject(this.model)}})});