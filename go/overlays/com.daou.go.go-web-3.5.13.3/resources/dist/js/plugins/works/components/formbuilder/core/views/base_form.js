define("works/components/formbuilder/core/views/base_form",function(require){var e=require("when"),t=require("works/components/formbuilder/core/views/base_component"),n=require("works/components/formbuilder/core/component_manager"),r=require("works/components/formbuilder/constants"),i=require("i18n!works/nls/works"),s=require("i18n!nls/commons"),o=require("works/constants/component_type");return require("jquery.go-popup"),t.extend({viewType:"form",cloneable:!0,initialize:function(e){e=e||{},t.prototype.initialize.apply(this,arguments),this.cloneable=!0,_.isBoolean("cloneable")&&this.setCloneable(e.cloneable),this.isEditable()&&(this.listenTo(this.model,"change",this._reloadAndUpdateModel),this._bindButtonEvent())},afterRender:function(){this._renderCode(),this._renderColor(),this._renderBold()},remove:function(){t.prototype.remove.apply(this,arguments),this.$el.off(".baseform")},getFormData:function(){return this.appletDocModel&&this.appletDocModel.toJSON?this.appletDocModel.toJSON():null},validate:function(){return!0},printErrorTo:function(e,t){this.$("."+r.CN_ERROR).remove(),this.$(".build_box_data").after('<p class="'+r.CN_ERROR+'">'+t+"</p>")},createComponent:function(e,t){var r=n.createComponent(e,t);return r?(this.initChildComponent(r),r):!1},isCloneable:function(){return this.cloneable},setCloneable:function(e){this.cloneable=e},_bindButtonEvent:function(){this.isEditable()&&(this.$el.on("click.baseform",".btn-remove",_.bind(this._confirmAndRemoveComponent,this)),this.$el.on("click.baseform",".btn-copy",_.bind(this._copyComponent,this)))},_confirmAndRemoveComponent:function(e){var t=this;e.preventDefault(),e.stopImmediatePropagation();var n=t.type,r=this.subFormId?!1:!0,u=GO.util.store.get(GO.session("id")+"-"+t.appletId+"works-column-component-delete")||!1,a=$("[el-form-tab]").length==1?!0:!1;!a&&!u&&r&&n==o.Columns?$.goPopup({pclass:"layer_normal",header:i["\uceec\ub7fc\uc744 \uc0ad\uc81c\ud558\uc2dc\uaca0\uc2b5\ub2c8\uae4c?"],contents:'<div class="content"><p class="desc">'+i["\uceec\ub7fc\uc0ad\uc81c \uacbd\uace0"]+"</p>"+'<span class="wrap_option" id="notice_option">'+'<input type="checkbox" id="column-component-delete"><label for="column-component-delete">'+s["\ub354\uc774\uc0c1 \ubcf4\uc9c0 \uc54a\uae30"]+"</label></span>"+"</div>",buttons:[{btext:s["\ud655\uc778"],btype:"confirm",callback:$.proxy(function(e){e.find("#column-component-delete").attr("checked")&&GO.util.store.set(GO.session("id")+"-"+t.appletId+"works-column-component-delete",{noConfirm:!0},{type:"session"}),t._removeComponent()},this)},{btype:"close",btext:s["\ucde8\uc18c"]}]}):this._removeComponent()},_removeComponent:function(){var e=this,t=e.subFormId?!1:!0;this._inquiryIsConnectedComponent().then(function(n){if(t)return e._confirmRemoveConnectedComponent(n)}).then(function(){if(t)return e._inquiryIsGanttViewSettingComponent()}).then(function(){if(t)return e._inquiryIsCalendarViewPeriodComponent()}).then(function(){e.remove(),e.observer.trigger(r.REQ_REMOVE_COMPONENT,e.getCid()),n.removeComponent(e.getCid()),e.observer.trigger(r.EVENT_CLEAR_COMPONENT_SELECTED,e.getCid())}).otherwise(function(e){console.log(e.stack)})},_inquiryIsGanttViewSettingComponent:function(){function n(e,t){return t==e.titleFieldCid||t==e.startFieldCid||t==e.endFieldCid}var t=this;return $("header.content_top h1").attr("use-gantt-view")!=="true"?$.Deferred().resolve():e.promise(function(e,r){$.ajax(GO.contextRoot+"api/works/applets/"+t.appletId+"/ganttview/settings",{success:function(o){if(o&&o.data){var u=o.data;n(u,t.getCid())?$.goConfirm(s["\uc0ad\uc81c\ud558\uc2dc\uaca0\uc2b5\ub2c8\uae4c?"],i["\uac04\ud2b8 \ubdf0\uc5d0\uc11c \uc0ac\uc6a9 \uc911\uc778 \ud544\uc218 \ucef4\ud3ec\ub10c\ud2b8\uc785\ub2c8\ub2e4. \uc0ad\uc81c\ud558\uba74 \uac04\ud2b8 \ubdf0\ub97c \uc0ac\uc6a9\ud558\uc9c0 \ubabb\ud569\ub2c8\ub2e4."],e):e()}else r(new Error("Illegal Response Data"))},error:r})})},_inquiryIsCalendarViewPeriodComponent:function(){function n(e,t){var n=!1;return _.each(e,function(e){if(e.startCid==t||e.endCid==t)return n=!0,!1}),n}var t=this;return $("header.content_top h1").attr("use-calendar-view")!=="true"?$.Deferred().resolve():e.promise(function(e,r){$.ajax(GO.contextRoot+"api/works/applet/"+t.appletId+"/calendarview/periods",{success:function(o){if(o&&o.data){var u=o.data;n(u,t.getCid())?$.goConfirm(s["\uc0ad\uc81c\ud558\uc2dc\uaca0\uc2b5\ub2c8\uae4c?"],i["\uce98\ub9b0\ub354 \ubdf0\uc5d0\uc11c \uc0ac\uc6a9 \uc911\uc778 \ucef4\ud3ec\ub10c\ud2b8\uc785\ub2c8\ub2e4. \uc0ad\uc81c\ud558\uba74 \uc0ac\uc6a9 \uc911\uc778 \uce98\ub9b0\ub354 \ubdf0\uc5d0\uc11c \ud574\ub2f9 \ub0a0\uc9dc\uac00 \ub178\ucd9c\ub418\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4."],e):e()}else r(new Error("Illegal Response Data"))},error:r})})},_inquiryIsConnectedComponent:function(){function n(e){return e&&_.isArray(e)&&e.length>0}var t=this;return e.promise(function(e,r){var i=GO.config("contextRoot")+"api/works/applets/"+t.getAppletId()+"/fields/"+t.getCid()+"/integration";$.ajax(i,{success:function(t){t&&t.data?e(n(t.data||[])):r(new Error("Illegal Response Data"))},error:r})})},_confirmRemoveConnectedComponent:function(t){return e.promise(function(e,n){t||!1?$.goConfirm(i["\uc5f0\ub3d9 \ucef4\ud3ec\ub10c\ud2b8 \uc0ad\uc81c \ud655\uc778 \ud0c0\uc774\ud2c0"],i["\uc5f0\ub3d9 \ucef4\ud3ec\ub10c\ud2b8 \uc0ad\uc81c \ud655\uc778 \uba54\uc2dc\uc9c0"],e):e()})},_copyComponent:function(e){e.preventDefault(),e.stopPropagation();var t=n.getComponent("cxx1"),i=this.$el.attr("data-cid"),s=this.searchNode(t,i);if(_.isUndefined(s)||_.isNull(s))return;var o=s.parentCid,u=this.copyAndPaste(s,o);if(_.isUndefined(u)||_.isNull(u))return;this.observer.trigger(r.REQ_ORDER_COMPOMENT,u,s.position+1),this.getComponentView(u).$el.trigger("click")},copyAndPaste:function(e,r){var s=e.type,u=_.clone(e.properties);if(t.prototype._checkSpecialCode(s)){$.goSlideMessage(GO.i18n(i["\ud3fc \ucef4\ud3ec\ub10c\ud2b8 \uc911\ubcf5 \uc5d0\ub7ec\uba54\uc2dc\uc9c0"],{arg1:u.label}),"caution");return}var a=this.createComponent(s,r);s===o.Columns&&(a=this.createColumnToCopy(a,u.count)),u.code="",a.setProperties(u),a.multiple=e.multiple;var f=n.getComponentByCid(r);return this.renderCopiedComponent(a,f,e.parentCid==r),this.appendContainableComponents(e,a),a},createColumnToCopy:function(e,t){var n=this,r=e.__componentModel__.attributes.count;if(t>r){var i=t-r;for(var s=0;s<i;s++){var u=n.createComponent(o.Column,e.cid);e.addComponent(u.toJSON())}}return e.__componentModel__=null,e},renderCopiedComponent:function(e,t,n){var r=this.getComponentView(e),i=this.getComponentView(t);if(t.type===o.Table){var s='<td data-cid="'+e.cid+'"></td>';n?this.$el.closest("td").after(s).next("td").append(r.el):i.$el.find("tr").append(s).find("td:last").append(r.el)}else t.type===o.Column?n?this.$el.after(r.el):i.$el.find("div.containable").append(r.el):this.$el.after(r.el);r.renderNode()},appendContainableComponents:function(e,t){function h(e,t){var r=n.getComponentByCid(t);_.each(e,function(e){var n=i.copyAndPaste(e,t);if(_.isUndefined(n)||_.isNull(n))return;r.addComponent(n.toJSON())})}var r=e.components;if(_.isEmpty(r))return;var i=this,s=e.type;if(s===o.Table)h(r,t.cid);else if(s===o.Columns){var u=r,a=u.length;for(var f=0;f<a;f++){var l=u[f],c=t.components[f];h(l.components,c.cid)}}},searchNode:function(e,t){if(e.cid===t)return e;if(e.components!=null){var n=null;for(var r=0;r<e.components.length;r++){n=this.searchNode(e.components[r],t);if(n){_.isUndefined(n.position)&&(n.position=r);break}}return n}return null},_reloadAndUpdateModel:function(){this.renderNode(),this.observer.trigger(r.REQ_UPDATE_COMPONENT,this.getCid()),this._renderColor(),this._renderBold()},_renderCode:function(){if(this.isEditable()&&this.model.get("code")){var e='&nbsp;&nbsp;<span class="num_code" style="cursor: default;">'+this.model.get("code")+"</span>";this.$("span.box_label_wrap").find("label").append(e)}},_renderColor:function(){this.model.get("color")&&this.$(".box_label_wrap").find("label").removeClass(function(e,t){return(t.match(/(^|\s)bgcolor\S+/g)||[]).join(" ")}).addClass("bgcolor"+this.model.get("color"))},_renderBold:function(){var e=!!this.model.get("bold");e&&this.$(".box_label_wrap").find("label").addClass("st")}})});