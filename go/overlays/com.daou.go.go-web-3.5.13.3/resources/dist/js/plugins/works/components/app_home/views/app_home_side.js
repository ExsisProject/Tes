define("works/components/app_home/views/app_home_side",function(require){var e=require("views/base_view"),t=require("works/components/app_home/views/app_home_side_filter_item"),n=require("works/components/app_home/views/app_home_side_shortcuts"),r=require("works/components/filter/views/filter_list"),i=require("components/backdrop/backdrop"),s=require("works/models/calendar_view"),o=require("works/models/gantt_view"),u=require("hgn!works/components/app_home/templates/app_home_side"),a=require("hgn!works/components/app_home/templates/app_home_side_view_menu"),f=require("when"),l=require("i18n!nls/commons"),c=require("i18n!works/nls/works");require("jquery.go-validation");var h={"\ubaa8\ub4e0 \ubb38\uc11c":c["\ubaa8\ub4e0 \ub370\uc774\ud130"],"\ud3b8\uc9d1":l["\ud3b8\uc9d1"],"\uc811\uae30":l["\uc811\uae30"],"\uc218\uc815\uc644\ub8cc":l["\uc218\uc815\uc644\ub8cc"],"\ucde8\uc18c":l["\ucde8\uc18c"],"\ub0b4\uac00 \ub4f1\ub85d\ud55c \ub370\uc774\ud130":c["\ub0b4\uac00 \ub4f1\ub85d\ud55c \ub370\uc774\ud130"],"\uae30\ubcf8 \ud544\ud130":c["\uae30\ubcf8 \ud544\ud130"],"\uac1c\uc778 \ud544\ud130":c["\uac1c\uc778 \ud544\ud130"],"\ub2e4\ub978 \uc0ac\uc6a9\uc790\uc758 \ud544\ud130 \uc0ac\uc6a9\ud558\uae30":c["\ub2e4\ub978 \uc0ac\uc6a9\uc790\uc758 \ud544\ud130 \uc0ac\uc6a9\ud558\uae30"],"\uce98\ub9b0\ub354":l["\uce98\ub9b0\ub354"],"\uc774\ub984 \ubcc0\uacbd":c["\uc774\ub984 \ubcc0\uacbd"],"\uc0ad\uc81c":l["\uc0ad\uc81c"],"\ub9ac\uc2a4\ud2b8 \ubdf0":c["\ub9ac\uc2a4\ud2b8 \ubdf0"],"\uac04\ud2b8 \ubdf0":c["\uac04\ud2b8 \ubdf0"],"\uce98\ub9b0\ub354 \ubdf0":c["\uce98\ub9b0\ub354 \ubdf0"],"\ub9ac\ud3ec\ud2b8":c["\ub9ac\ud3ec\ud2b8"],"\ubdf0":c["\ubdf0"]},p={statusCode:{400:function(){GO.util.error("404",{msgCode:"400-common"})},403:function(){GO.util.error("403",{msgCode:"400-common"})},404:function(){GO.util.error("404",{msgCode:"400-common"})},500:function(){GO.util.error("500")}}};return e.extend({className:"go_side",events:{"click [el-default]":"_onClickDefaultFilter","click [data-el-create]":"_onClickCreateByForm","click #creteAppletDoc":"_onClickCreateAppletDoc","click [data-el-create-doc]":"_onClickAddAppletDocByBackdrop","click span[data-reorder]":"_onClickReorder","click #otherFilter":"_onClickOtherFilter","click span[data-fold]":"_onClickFold","click span[data-save]":"_onClickSave","click span[data-cancel]":"_onClickCancel","click #works_view_list li#calendar_view a, #add_calendar_view":"_onClickCalendarView","click #calendar_view_setting_btn":"_onClickCalendarViewSetting","click #works_view_list li#gantt_view a, #add_gantt_view":"_onClickGanttView","click #gantt_view_setting_btn":"_onClickGanttViewSetting","click #works_view_list li[el-rename]":"_onClickViewRename","click #works_view_list li[el-delete]":"_onClickViewDelete","click #goToListView":"_onClickListView","click #goToReport":"_onClickReportView"},initialize:function(e){e=e||{},this.appletId=e.appletId,this.accessibleForms=e.accessibleForms,this.hasOnlyOneForm=this.accessibleForms.length==1,this.filters=e.filters,this.isAdmin=e.isAdmin,this.baseConfigModel=e.baseConfigModel,this.share=e.share,this.baseFilters=this.filters.getBaseFilters(),this.baseFilters.on("sync",this._onSyncBaseFilters,this),this.baseFilters.on("remove",this._onRemoveBaseFilters,this),this.baseFilters.fetch(p),this.mineFilters=this.filters.getMineFilters(),this.mineFilters.on("sync",this._onSyncMineFilters,this),this.mineFilters.on("remove",this._onRemoveMineFilters,this),this.mineFilters.fetch(p),this.calendarViewModel=new s({appletId:this.appletId}),this.ganttViewModel=new o({appletId:this.appletId}),this.applets=e.applets,this.subFormId=e.subFormId},render:function(){var e=this.accessibleForms.length>0;return this.$el.html(u({lang:h,isAdmin:this.isAdmin,appName:l.Works,contextRoot:GO.config("contextRoot"),hasAccessibleForm:e})),this._renderViewMenu(),this._renderShortcuts(),e&&(this._renderAddAppletDoc(),this._setFoldFilterList(),this._toggleSideRegisterButton()),$("#side").on("resetFilterHeight",$.proxy(function(){this._setFilterAreaHeight()},this)),this},_renderMineFilters:function(){var e=this.$("#mineFilters");e.find("li").remove(),this._renderFiltersByCollection(this.mineFilters,e,!0)},_renderBaseFilters:function(){var e=this.$("#baseFilters");e.find("li:not([el-default])").remove(),this._renderFiltersByCollection(this.baseFilters,e,this.isAdmin)},_renderFiltersByCollection:function(e,n,r){e.each(function(i){var s=new t({appletId:this.appletId,model:i,collection:e,auth:r});n.append(s.render().el)},this)},_renderShortcuts:function(){var e=new n({applets:this.applets});this.$("section[el-title]").after(e.render().el)},_renderAddAppletDoc:function(){var e=_.first(this.accessibleForms),t=e.mainForm?"mainForm":e.id,n=[];n.push('<section class="function" id="registerButtonArea">'),this.hasOnlyOneForm&&!e.mainForm?n.push('<a class="btn_function" data-formId="'+e.id+'"data-el-create>'):n.push('<a class="btn_function" id="creteAppletDoc">'),n.push('<span class="txt">'+l["\ub4f1\ub85d"]+"</span>"),this.accessibleForms.length>1?(n.push("</a>"),n.push('<span class="ic_set ic_arrow_open" data-el-create></span>'),n.push('<div class="array_option layer_side_func on" style="display:none;" el-backdrop-create>'),n.push('<ul class="array_type">'),_.each(this.accessibleForms,function(e){e.mainForm?n.push('<li data-el-create-doc data-id="'+t+'" style="display: list-item;">'):n.push('<li data-el-create-doc data-id="'+e.id+'" style="display: list-item;">'),n.push('<span class="txt">'+e.name+"</span>"),e.mainForm&&n.push('<span class="label_state normal">main</span>'),n.push("</li>")}),n.push("</ul>"),n.push("</div>"),n.push("</section>")):(n.push("</a>"),n.push("</section>")),this.$(".side_nav").after(n.join("\n"))},_onClickCreateByForm:function(){if(this.hasOnlyOneForm){var e=this.$("[data-el-create]").attr("data-formId");this._goCreateDoc(e)}else this.backdropLayer||(this.backdropLayer=new i({el:this.$("[el-backdrop-create]")}),this.backdropLayer.linkBackdrop(this.$("[data-el-create]")))},_onSyncMineFilters:function(){this._renderMineFilters()},_onSyncBaseFilters:function(){this._renderBaseFilters()},_renderViewMenu:function(){var e=[];this.useCalendarView=this.baseConfigModel.get("useCalendarView"),this.useGanttView=this.baseConfigModel.get("useGanttView"),this.useCalendarView&&e.push(this.calendarViewModel.fetch()),this.useGanttView&&(this.ganttViewModel.setType("GET"),e.push(this.ganttViewModel.fetch())),this._ganttViewSynced=$.Deferred(),f.all(e).then($.proxy(function(){var e=GO.router.getUrl(),t=e.indexOf("/home")>0,n=e.indexOf("/gantt")>0,r=e.indexOf("/calendar")>0,i=e.indexOf("/report")>0,s=this.useCalendarView;if(s){var o=this.calendarViewModel.toJSON();s=o.periodExist||this.isAdmin}var u=this.useGanttView;this._ganttViewSynced.resolve(),this.$el.find("#filter_area").before(a({lang:h,calendarViewModel:o,ganttViewModel:this.ganttViewModel.toJSON(),isAdmin:this.isAdmin,showAdditionalView:this.isAdmin||s||u,showCalendarView:s,addCalendarView:this.isAdmin&&!s,showCalendarEl:s||this.isAdmin&&!s,showGanttView:u,addGanttView:this.isAdmin&&!u,showGanttEl:u||this.isAdmin&&!u,showListView:s||u,selectListView:t?"on":"",selectGanttView:n?"on":"",selectCalendarView:r?"on":"",selectReportView:i?"on":""})),this._setFilterAreaHeight()},this))},_setFilterAreaHeight:function(){var e=this._getFilterAreaHeight();this.$el.find("#filter_area").height(e-2)},_getFilterAreaHeight:function(){var e=window.innerHeight;GO.isAdvancedTheme()||(e-=$(".go_header_advanced").outerHeight(!0)+2);var t=$("#side").outerHeight(!0),n=this.$el.find("#filter_area").outerHeight(!0),r=this.$el.find("#guide_area").outerHeight(!0);return e-(t-n-r)},_onRemoveMineFilters:function(){this._renderMineFilters()},_onRemoveBaseFilters:function(){this._renderBaseFilters()},_onClickDefaultFilter:function(e){var t=$(e.currentTarget).attr("data-id");GO.util.store.set(GO.session("id")+"-"+this.appletId+"-works-last-filter-id",t);var n=GO.util.store.get("applet-viewtype");n=="calendar"||n=="gantt"?GO.router.navigate("works/applet/"+this.appletId+"/"+n,!0):(GO.router.navigate("works/applet/"+this.appletId+"/home",{replace:!0}),this.filters.trigger("changeFilter.filters",t))},_onClickAddAppletDocByBackdrop:function(e){e.stopPropagation(),this.$el.trigger("storeParam");var t=$(e.currentTarget).attr("data-id");this._goCreateDoc(t==="mainForm"?null:t)},_onClickCreateAppletDoc:function(e){this._goCreateDoc(this.subFormId)},_goCreateDoc:function(e){GO.util.isInvalidValue(e)?GO.router.navigate("works/applet/"+this.appletId+"/doc/new",!0):GO.router.navigate("works/applet/"+this.appletId+"/doc/new/"+e,!0)},_onClickOtherFilter:function(){this.popupView=$.goPopup({pclass:"layer_normal layer_app_search",header:c["\ud544\ud130 \uac80\uc0c9"],buttons:[{btext:l["\ub2eb\uae30"],callback:$.proxy(function(){},this)}]}),this.filterListView=new r({appletId:this.appletId}),this.filterListView.$el.on("onClickListItem",$.proxy(function(e,t){this.filters.trigger("changeFilter.filters",t.id,t.type),this.popupView.close()},this)),this.popupView.find(".content").html(this.filterListView.render().el),this.filterListView.defer.done($.proxy(function(){this.popupView.reoffset()},this))},_onClickFold:function(e){var t=$(e.currentTarget),n=t.parents("h1").hasClass("folded"),r=t.closest("section").attr("data-type");this._toggleFilterListByType(r,n),GO.util.store.set(GO.session("id")+"-works-side-fold-"+r,n,"local")},_toggleFilterListByType:function(e,t){var n=this.$('section[data-type="'+e+'"]'),r=n.find("span[data-fold]");n.find("ul").toggle(t),t?(n.find("h1").removeClass("folded"),r.attr("title",l["\uc811\uae30"])):(n.find("h1").addClass("folded"),r.attr("title",l["\ud3bc\uce58\uae30"]))},_setFoldFilterList:function(){var e=GO.util.store.get(GO.session("id")+"-works-side-fold-base"),t=GO.util.store.get(GO.session("id")+"-works-side-fold-mine");this._toggleFilterListByType("base",_.isUndefined(e)?!0:e),this._toggleFilterListByType("mine",_.isUndefined(t)?!0:t)},_onClickReorder:function(e){var t=$(e.currentTarget).closest("section"),n=t.attr("data-type");n==="base"&&this.$("[el-default]").hide(),t.find("span.btn_wrap").toggle(),t.addClass("lnb_edit").sortable({items:"li",opacity:"1",delay:100,cursor:"move",hoverClass:"move",containment:t,forceHelperSize:"true",helper:"clone",placeholder:"ui-sortable-placeholder"}).sortable("enable")},_onClickSave:function(e){var t=$(e.currentTarget).attr("data-type"),n=_.map(this.$("#"+t+"Filters").find("li[data-id]:not([el-default])"),function(e){return $(e).attr("data-id")});$.ajax({type:"PUT",contentType:"application/json",url:GO.contextRoot+"api/works/applets/"+this.appletId+"/filters/"+t,data:JSON.stringify({ids:n}),success:$.proxy(function(){this[t+"Filters"].fetch().done($.proxy(function(){this._disableSortable(t)},this)),$.goMessage(l["\ubcc0\uacbd\ub418\uc5c8\uc2b5\ub2c8\ub2e4."])},this)})},_onClickCancel:function(e){var t=$(e.currentTarget).attr("data-type");this._disableSortable(t)},_onClickReportView:function(){GO.router.navigate("works/applet/"+this.appletId+"/reports",!0)},_onClickCalendarView:function(){GO.router.navigate("works/applet/"+this.appletId+"/calendar",!0)},_onClickGanttView:function(){GO.router.navigate("works/applet/"+this.appletId+"/gantt",!0)},_onClickListView:function(){GO.router.navigate("works/applet/"+this.appletId+"/home",!0)},_onClickCalendarViewSetting:function(e){this._bindBackdrop(this.$("#calendar-backdrop"),this.$("#calendar_view_setting_btn"))},_onClickGanttViewSetting:function(){this._bindBackdrop(this.$("#gantt-backdrop"),this.$("#gantt_view_setting_btn"))},_bindBackdrop:function(e,t){var n=new i;n.backdropToggleEl=e,n.linkBackdrop(t)},_onClickViewRename:function(e){e.stopPropagation();var t=$(e.currentTarget).parent().closest("li").attr("id")=="calendar_view";if(t)var n=c["\ubcc0\uacbd\ud560 \uce98\ub9b0\ub354\ubdf0 \uc774\ub984\uc744 \uc785\ub825\ud558\uc138\uc694."],r=this.calendarViewModel.get("name"),i=c["\uce98\ub9b0\ub354\ubdf0 \uc774\ub984 \ubcc0\uacbd"];else var n=c["\ubcc0\uacbd\ud560 \uac04\ud2b8\ubdf0 \uc774\ub984\uc744 \uc785\ub825\ud558\uc138\uc694."],r=this.ganttViewModel.get("name"),i=c["\uac04\ud2b8\ubdf0 \uc774\ub984 \ubcc0\uacbd"];var s=['<div class="content">','<p class="desc">'+n+"</p>",'<div class="form_type">','<input el-new-name class="txt_mini w_max" type="text" value="'+r+'">',"</div>","</div>"].join("");this.renamePopup=$.goPopup({modal:!0,header:i,width:500,contents:s,buttons:[{btext:l["\ud655\uc778"],btype:"confirm",callback:$.proxy(function(){var e=this.renamePopup.find("input[el-new-name]").val();t?this._renameCalendarView(e):this._renameGanttView(e)},this)},{btext:l["\ucde8\uc18c"],btype:"normal"}]})},_renameCalendarView:function(e){if(!$.goValidation.isCheckLength(1,64,e))return $.goMessage(GO.i18n(l["0\uc790\uc774\uc0c1 0\uc774\ud558 \uc785\ub825\ud574\uc57c\ud569\ub2c8\ub2e4."],{arg1:"1",arg2:"64"}));var t=this;this.calendarViewModel.save({name:e},{type:"PUT",success:function(n,r){r.code=="200"&&(t.$el.find("#calendar_view_"+n.get("id")+" .txt").text(e),$.goMessage(l["\uc800\uc7a5\ub418\uc5c8\uc2b5\ub2c8\ub2e4."]))},error:function(e,t){var n=JSON.parse(t.responseText);$.goMessage(n.message)}})},_renameGanttView:function(e){if(!$.goValidation.isCheckLength(1,64,e))return $.goMessage(GO.i18n(l["0\uc790\uc774\uc0c1 0\uc774\ud558 \uc785\ub825\ud574\uc57c\ud569\ub2c8\ub2e4."],{arg1:"1",arg2:"64"}));var t=this;$.ajax({type:"PUT",dataType:"json",contentType:"application/json",url:GO.contextRoot+"api/works/applets/"+this.appletId+"/ganttview/rename",data:JSON.stringify({str:e}),success:function(n){t.$el.find("#gantt_view_"+n.data.id+" .txt").text(e),t.ganttViewModel.set({name:e}),$.goMessage(l["\uc800\uc7a5\ub418\uc5c8\uc2b5\ub2c8\ub2e4."])},error:function(e){$.goError(e.message)}})},_onClickViewDelete:function(e){e.stopPropagation();var t=this,n=$(e.currentTarget).parent().closest("li").attr("id")=="calendar_view";$.goCaution(l["\uc0ad\uc81c \uc2dc \ubcf5\uad6c\ub418\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4."],l["\uc0ad\uc81c\ud558\uc2dc\uaca0\uc2b5\ub2c8\uae4c?"],function(){t.ganttViewModel.setType("DELETE");var e=n?t.calendarViewModel:t.ganttViewModel;GO.util.preloader(e.destroy({success:function(){GO.router.navigate("works/applet/"+t.appletId+"/home",!0),$.goSlideMessage(l["\uc0ad\uc81c\ub418\uc5c8\uc2b5\ub2c8\ub2e4."])},error:function(e,t){var n=JSON.parse(t.responseText);$.goError(n.message)}}))})},_savePeriods:function(){this.periodEditorPopupView.savePeriods(this.appletId)},_disableSortable:function(e){var t=this.$('section[data-type="'+e+'"]');e==="base"&&this.$("[el-default]").show(),t.removeClass("lnb_edit").sortable("disable"),t.find("span.btn_wrap").toggle();var n={base:"_renderBaseFilters",mine:"_renderMineFilters"};this[n[e]]()},_toggleSideRegisterButton:function(){this.share.get("docAddible")||this.$("#registerButtonArea").hide()}})});