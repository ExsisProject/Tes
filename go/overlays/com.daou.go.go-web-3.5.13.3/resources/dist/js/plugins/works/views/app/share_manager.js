define("works/views/app/share_manager",function(require){function g(){console.log("renderMain");var e=this;u.checkAppManager(this.config.get("admins"));var t=this.fields.getUserFieldsExceptMappingFields();this.$el.html(s({lang:m,config:this.config.toJSON(),userTypes:t.toJSON(),hasUserTypes:t.length>0}));var n=new l({baseConfigModel:e.config,pageName:f["\uc811\uadfc \uc81c\uc5b4 \uad00\ub9ac"],useActionButton:!0,infoDesc:m.infoDesc});n.setElement(this.$("#worksContentTop")),n.render(),this.circleView=new o({selector:"#accessUser",isAdmin:!1,isWriter:!0,circleJSON:e.model.get("circle"),nodeTypes:["user","department","position","grade","duty","usergroup"]}),this.circleView.render(),this.model.get("public")?this.$("#public").prop("checked",!0).trigger("change"):this.$("#custom").prop("checked",!0).trigger("change");var r=this.model.get("closedOption");return r=="SELECTED"?this.$("input[id=closedOption_selected]").attr("checked",!0):r=="OPEN"?(this.$("input[id=closedOption_open]").attr("checked",!0),this.$("tr[el-use-closed]").hide()):r=="CLOSED"&&this.$("input[id=closedOption_closed]").attr("checked",!0),this._setRolesAndPushes(),this._renderFilterViewContent(),this}function y(){return t(this.layoutView.render()).then(this.layoutView.setContent(this))}function b(){var e=t.defer();return this.config.fetch({success:e.resolve,error:e.reject}),e.promise}function w(){var e=t.defer();return this.model.fetch({success:e.resolve,error:e.reject}),e.promise}var e=require("backbone"),t=require("when"),n=require("works/models/applet_baseconfig"),r=require("works/models/applet_share"),i=require("works/views/app/home/works_home_layout"),s=require("hgn!works/templates/app/share_manager"),o=require("views/circle"),u=require("works/libs/util"),a=require("i18n!nls/commons"),f=require("i18n!works/nls/works"),l=require("works/views/app/layout/manage_content_top"),c=require("works/collections/fields"),h=require("works/models/base_filter_setting"),p=require("works/views/app/base_filter_item"),d=require("works/views/app/base_filter_group_item"),v=require("works/models/share_config_setting");require("jquery.go-orgtab"),require("jquery.go-orgslide");var m={desc:f["\uacf5\uc720\uc790\uad00\ub9ac \uc124\uba85"],useClosed:f["\ube44\uacf5\uac1c \uc0ac\uc6a9"],closedDesc:f["\ube44\uacf5\uac1c \uc124\uba85"],closedSelected:f["\ube44\uacf5\uac1c \uc0ac\uc6a9\uc790\uc120\ud0dd"],closed:f["\ube44\uacf5\uac1c\ub9cc"],open:f["\uacf5\uac1c\ub9cc"],title:f["\uacf5\uc720 \uc124\uc815"],regist:a["\uc800\uc7a5"],cancel:a["\ucde8\uc18c"],pub:f["\uc804\uc0ac \uc124\uc815"],custom:f["\uc0ac\uc6a9\uc790 \uc124\uc815"],goback:f["\ub3cc\uc544\uac00\uae30"],add:a["\ucd94\uac00"],gosettinghome:f["\uad00\ub9ac \ud648\uc73c\ub85c \uc774\ub3d9"],goapphome:f["\ud574\ub2f9 \uc571\uc73c\ub85c \uc774\ub3d9"],"\uacf5\uc720\uc790 \uc124\uc815":f["\uacf5\uc720\uc790 \uc124\uc815"],titleDesc:f["\uacf5\uc720\uad00\ub9ac \uc548\ub0b4\ubb38\uad6c"],infoDesc:f["\uc811\uadfc\uc81c\uc5b4 \uc124\uba85"],"\ub370\uc774\ud130 \ub4f1\ub85d \uad8c\ud55c":f["\ub370\uc774\ud130 \ub4f1\ub85d \uad8c\ud55c"],"\ub370\uc774\ud130 \uc218\uc815 \uad8c\ud55c":f["\ub370\uc774\ud130 \uc218\uc815 \uad8c\ud55c"],"\ub370\uc774\ud130 \uc0ad\uc81c \uad8c\ud55c":f["\ub370\uc774\ud130 \uc0ad\uc81c \uad8c\ud55c"],"\uc218\uc815 \uc54c\ub9bc \ub300\uc0c1":f["\uc218\uc815 \uc54c\ub9bc \ub300\uc0c1"],"\uacf5\uc720\uc790 \uc804\uccb4":f["\uacf5\uc720\uc790 \uc804\uccb4"],"\ub4f1\ub85d\uc790":f["\ub4f1\ub85d\uc790"],"\uc6b4\uc601\uc790":f["\uc6b4\uc601\uc790"],"filter.name.length":GO.i18n(a["0\uc790\uc774\uc0c1 0\uc774\ud558 \uc785\ub825\ud574\uc57c\ud569\ub2c8\ub2e4."],{arg1:2,arg2:50}),"filter.name.blank":a["\uacf5\ubc31\ubb38\uc790\ub294 \uc785\ub825\ud560 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4."],"filter.name.unused.char":a["\uc0ac\uc6a9\ud560 \uc218 \uc5c6\ub294 \ubb38\uc790\uc785\ub2c8\ub2e4."],"filter.name.invalid":GO.i18n(f["{{arg0}}\ub9cc \uc785\ub825\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4."],{arg0:f["\ud55c\uae00, \uc601\ubb38, \uc22b\uc790"]}),"filter.description.length":GO.i18n(a["\ucd5c\ub300 {{arg1}}\uc790 \uae4c\uc9c0 \uc785\ub825\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4."],{arg1:200}),"rule.rule.null":f["\ud544\ud130\uaddc\uce59\uc744 \uc785\ub825\ud574 \uc8fc\uc138\uc694."],"rule.name.length":GO.i18n(a["0\uc790\uc774\uc0c1 0\uc774\ud558 \uc785\ub825\ud574\uc57c\ud569\ub2c8\ub2e4."],{arg1:2,arg2:50}),"rule.description.length":GO.i18n(a["\ucd5c\ub300 {{arg1}}\uc790 \uae4c\uc9c0 \uc785\ub825\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4."],{arg1:200}),"rule.filterRule.invalid":f["\uc720\ud6a8\ud558\uc9c0 \uc54a\ub294 \ud544\ud130\uaddc\uce59\uc785\ub2c8\ub2e4."],"\ucd94\uac00":a["\ucd94\uac00"],"\ud544\ud130\uba85":f["\ud544\ud130\uba85"],"\uc124\uba85":f["\uc124\uba85"],"\ud544\ud130 \uc870\uac74":f["\ud544\ud130 \uc870\uac74"],"\uc0ad\uc81c":a["\uc0ad\uc81c"],"\ubaa9\ub85d\uc774 \uc5c6\uc2b5\ub2c8\ub2e4":f["\ubaa9\ub85d\uc774 \uc5c6\uc2b5\ub2c8\ub2e4."],"\ud544\ud130 \uc870\uac74 \ub300\uc0c1 \uc124\uc815":f["\ud544\ud130 \uc870\uac74 \ub300\uc0c1 \uc124\uc815"],"\ud544\ud130\uaddc\uce59":f["\ud544\ud130\uaddc\uce59"],"\ub370\uc774\ud130 \ubaa9\ub85d \uc870\ud68c \uad8c\ud55c \uc124\uc815":f["\ub370\uc774\ud130 \ubaa9\ub85d \uc870\ud68c \uad8c\ud55c \uc124\uc815"],"\ub370\uc774\ud130 \ubaa9\ub85d \uc870\ud68c \uad8c\ud55c \uc124\uc815 \uc124\uba85":f["\ub370\uc774\ud130 \ubaa9\ub85d \uc870\ud68c \uad8c\ud55c \uc124\uc815 \uc124\uba85"],"\ub370\uc774\ud130 \uc0c1\uc138 \uad8c\ud55c \uc124\uc815":f["\ub370\uc774\ud130 \uc0c1\uc138 \uad8c\ud55c \uc124\uc815"],"\ub370\uc774\ud130 \uc0c1\uc138 \uad8c\ud55c \uc124\uc815 \uc124\uba85":f["\ub370\uc774\ud130 \uc0c1\uc138 \uad8c\ud55c \uc124\uc815 \uc124\uba85"],"\ub300\uc0c1":a["\ub300\uc0c1"],"\uacf5\uac1c\ubb38\uc11c\ub9cc \ub4f1\ub85d \uc124\uc815 \uc2dc \ubb38\uad6c":f["\uacf5\uac1c\ubb38\uc11c\ub9cc \ub4f1\ub85d \uc124\uc815 \uc2dc \ubb38\uad6c"],"\uc218\uc815 \uc54c\ub9bc \ub300\uc0c1 \uc124\uba85":"\u203b "+f["\uc218\uc815 \uc54c\ub9bc \ub300\uc0c1 \uc124\uba85"]};return e.View.extend({className:"go_content go_renew go_works_home app_temp",events:{"change input[name=shareType]":"toggleCircle","change input[name=closedOption]":"toggleClosedOption","click #btn-confirm":"onSave","click #btn-cancel":"onCancel","click #btn-gosettinghome":"gosettinghome","click #btn-goapphome":"goapphome","click #goAppHomeNav":"goapphome","click #goSettingHomeNav":"gosettinghome","click [el-add-filter]":"_onClickAddFilter","click [el-add-role]":"_onClickAddGroup"},initialize:function(e){e=e||{},this.layoutView=i.create(),e.hasOwnProperty("appletId")&&(this.model=new r({id:e.appletId}),this.config=new n(e.hasOwnProperty("appletId")?{id:e.appletId}:null),this.fields=new c([],{appletId:e.appletId,includeProperty:!0}),this.baseFilterSetting=new h({appletId:e.appletId}),this.baseFilterSetting.on("sync",this._renderFilterViewContent,this),this.$el.on("removeFilterItem",_.bind(this._onRemoveFilter,this)))},render:function(){return t.all([y.call(this),this.fields.fetch()]).then(this.baseFilterSetting.fetch()).then(_.bind(b,this)).then(_.bind(w,this)).then(_.bind(g,this)).otherwise(function(t){console.log(t.stack)})},_renderFilterViewContent:function(){this._renderFilters(),this._renderRules()},_renderFilters:function(){this.$("#filters").empty(),this.baseFilterSetting.baseFilters.each(function(e){this._appendFilterItem(e)},this)},_renderRules:function(){this.$("#groups").empty(),this.baseFilterSetting.baseFilterGroups.each(function(e){var t=_.isUndefined(e.get("circle"));t&&(e.set("isDefault",t),_.isUndefined(e.get("rule"))&&e.set("rule","")),this._appendFilterGroupItem(e)},this)},_onClickAddFilter:function(){this._appendFilterItem()},_onClickAddGroup:function(){this._appendFilterGroupItem()},_onRemoveFilter:function(){this.$("#filters").find("tr:not([el-null])").length===1&&this.$("tr[el-null]").show()},onSave:function(e){e.preventDefault();var t=this.baseFilterSetting.validate();return t?($.goError(m[t]),!1):(this.model.set("addDocRoles",this._getMemberAddDocFromView()),this.model.set("editDocRoles",this._getEditDocRolesFromView()),this.model.set("deleteDocRoles",this._getDeleteDocRolesFromView()),this.model.set("editDocPushes",this._getEditDocPushesFromView()),this.model.set("public",this.$("#public").is(":checked")),this.model.set("closedOption",this.$("input[name=closedOption]:checked").val()),this.model.get("public")?this.model.set("circle",{nodes:[]}):this.model.set("circle",this.circleView.getData()),this.shareConfigSetting=new v({appletId:this.model.get("id")}),this.shareConfigSetting.set("share",this.model),this.shareConfigSetting.set("baseFilterConfig",this.baseFilterSetting),this.shareConfigSetting.save({},{type:"PUT",success:function(){$.goMessage(a["\uc800\uc7a5\ub418\uc5c8\uc2b5\ub2c8\ub2e4."])}}),!1)},onCancel:function(e){var n=this;e.preventDefault(),$.goConfirm(a["\ucde8\uc18c\ud558\uc2dc\uaca0\uc2b5\ub2c8\uae4c?"],a["\uc785\ub825\ud558\uc2e0 \uc815\ubcf4\uac00 \ucd08\uae30\ud654\ub429\ub2c8\ub2e4."],function(){t(w.call(n),n.baseFilterSetting.fetch()).then(_.bind(b,n)).then(_.bind(g,n)).otherwise(function(t){console.log(t.stack)})})},gosettinghome:function(){u.goSettingHome(this.model.get("id"))},goapphome:function(){u.goAppHome(this.model.get("id"))},toggleCircle:function(e){$(e.target).val()=="custom"?$("#circleArea").show():$("#circleArea").hide()},toggleClosedOption:function(e){$(e.target).val()=="OPEN"?$("#closedOption_open_desc").show():$("#closedOption_open_desc").hide()},_getMemberAddDocFromView:function(){return this._getCheckboxValueByParentSelector("tr[el-add-roles]")},_getEditDocRolesFromView:function(){return this._getCheckboxValueByParentSelector("tr[el-edit-roles]")},_getDeleteDocRolesFromView:function(){return this._getCheckboxValueByParentSelector("tr[el-delete-roles]")},_getEditDocPushesFromView:function(){return this._getCheckboxValueByParentSelector("tr[el-edit-pushes]")},_getCheckboxValueByParentSelector:function(e){return _.map(this.$(e).find('input[type="checkbox"]:checked'),function(e){return $(e).val()})},_setRolesAndPushes:function(){this._setMemberAddDocToView(),this._setEditDocRolesToView(),this._setDeleteDocRolesToView(),this._setEditDocPushesToView()},_setMemberAddDocToView:function(){this._setCheckboxValueByType("addDocRoles")},_setEditDocRolesToView:function(){this._setCheckboxValueByType("editDocRoles")},_setDeleteDocRolesToView:function(){this._setCheckboxValueByType("deleteDocRoles")},_setEditDocPushesToView:function(){this._setCheckboxValueByType("editDocPushes")},_setCheckboxValueByType:function(e){_.each(this.model.get(e),function(t){this.$("#"+e+t).prop("checked",!0)},this)},_appendFilterItem:function(t){t||(t=new e.Model),this.baseFilterSetting.addBaseFilterItem(t);var n=new p({model:t,fields:this.fields,appletId:this.appletId,filters:this.filters});this.$("[el-null]").hide(),this.$("#filters").append(n.render().el)},_appendFilterGroupItem:function(e){e||(e=h.getGroupModelInstance()),this.baseFilterSetting.addBaseFilterGroupItem(e);var t=new d({model:e});this.$("#groups").append(t.render().el)}})});