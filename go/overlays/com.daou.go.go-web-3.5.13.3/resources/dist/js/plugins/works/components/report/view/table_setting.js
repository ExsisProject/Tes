define("works/components/report/view/table_setting",function(require){var e=["DAY","MONTH","YEAR"],t=require("backbone"),n=require("components/number_form/number_form"),r=Hogan.compile('<option value="{{type}}">{{label}}</option>'),i=require("hgn!works/components/report/template/table_setting"),s=require("hgn!works/components/report/template/table_setting_sub_query"),o=require("works/constants/value_type"),u=require("i18n!nls/commons"),a=require("i18n!admin/nls/admin"),f=require("i18n!works/nls/works"),l=require("i18n!report/nls/report"),c=Hogan.compile(['<option value="COUNT">{{{lang.\uac1c\uc218}}}</option>','<option value="SUM">{{{lang.\ud569\uacc4}}}</option>','<option value="AVG">{{{lang.\ud3c9\uade0}}}</option>','<option value="MAX">{{{lang.\ucd5c\ub300\uac12}}}</option>','<option value="MIN">{{{lang.\ucd5c\uc18c\uac12}}}</option>'].join("")),h={MINUTE:f.MINUTE,HOUR:f.HOUR,DAY:f.DAY,WEEK:f.WEEK,MONTH:f.MONTH,QUARTER:f.QUARTER,YEAR:f.YEAR,"\ud14c\uc774\ube14 \uc774\ub984":f["\ud14c\uc774\ube14 \uc774\ub984"],"\uc9d1\uacc4 \ubc29\uc2dd":f["\uc9d1\uacc4 \ubc29\uc2dd"],"\uc815\ub82c":f["\uc815\ub82c"],"\uac1c\uc218":f["\uac1c\uc218"],"\ud569\uacc4":f["\ud569\uacc4"],"\ud3c9\uade0":f["\ud3c9\uade0"],"\ucd5c\ub300\uac12":f["\ucd5c\ub300\uac12"],"\ucd5c\uc18c\uac12":f["\ucd5c\uc18c\uac12"],"\ubbf8\ub9ac\ubcf4\uae30":l["\ubbf8\ub9ac\ubcf4\uae30"],"\ub0b4\ub9bc\ucc28\uc21c\uc73c\ub85c \uc815\ub82c":f["\ub0b4\ub9bc\ucc28\uc21c\uc73c\ub85c \uc815\ub82c"],"\uc624\ub984\ucc28\uc21c\uc73c\ub85c \uc815\ub82c":f["\uc624\ub984\ucc28\uc21c\uc73c\ub85c \uc815\ub82c"],"\ud56d\ubaa9\uc774 \uc0ad\uc81c\ub418\uc5c8\uc2b5\ub2c8\ub2e4 \uc124\uba85":f["\ud56d\ubaa9\uc774 \uc0ad\uc81c\ub418\uc5c8\uc2b5\ub2c8\ub2e4 \uc124\uba85"],"\uae30\uc900 \uceec\ub7fc":f["\uae30\uc900 \uceec\ub7fc"],"\uceec\ub7fc":f["\uceec\ub7fc"],"\ubcf4\uc870 \uceec\ub7fc":f["\ubcf4\uc870 \uceec\ub7fc"],"\uc815\ub82c \uc21c\uc11c":a["\uc815\ub82c \uc21c\uc11c"],"\uc0ad\uc81c":u["\uc0ad\uc81c"],"\ucd94\uac00":u["\ucd94\uac00"]};return t.View.extend({events:{"click [data-table-preview]":"_onClickChartPreview","click span[row-add]":"_onClickAdd","click span[row-delete]":"_onClickDelete","change #calculateCid":"_onChangeCalculateCid","change #standardCid":"_onChangeStandardCid","change select[sub_query_select]":"_onChangeSubQuery","change #tableTitle":"_validateTitle","change input[el-row-count]":"_validateRowCount"},initialize:function(e){this.appletId=e.appletId,this.chartFields=e.chartFields,this.numberFields=e.numberFields},render:function(){return this.$el.html(i({lang:h,title:this.model.get("title"),chartFields:this.chartFields.toJSON(),numberFields:this.numberFields.toJSON(),hasChartFields:this.chartFields.length>0,hasNumberFields:this.numberFields.length>0})),this.$el.attr("data-table-cid",this.model.cid),this._renderTimeFormatItem(),this._renderSubQueryItem(),this.numberFormView=new n({inputSelector:{"el-row-count":""}}),this.numberFormView.setElement(this.$("[el-number-form-wrapper]")),this.numberFormView.render(),this._setData(),this},_setData:function(){this.$el.find("#aggMethod").val(this.model.get("aggMethod")),this.$el.find("#standardCid").val(this.model.get("standardField").cid),this.$el.find("#calculateCid").val(this.model.get("calculateField").cid),this.$el.find("#rangeOption").val(this.model.get("rangeOption")),this.$el.find("#direction").val(this.model.get("direction")),this.$el.find("[el-row-count]").val(this.model.get("rowCount")),this.$el.find("#calculateCid").trigger("change"),this._toggleDateTimeView(this.model.get("standardField").valueType,"rangeOption")},_renderTimeFormatItem:function(){var t=this.$("select[data-postfix]");t.empty(),_.each(e,function(e){t.append(r.render({type:e,label:h[e]}))},this)},_renderSubQueryItem:function(){var e=this.model.get("subQuery");if(!e)return;var t=this;_.each(JSON.parse(e),function(e){t._onClickAdd();var n=t.$("#subQueryWrap").last().find("select[data-cid]");n.val(e.componentId),n.trigger("change"),t.$("#subQueryWrap").last().find("select[data-method]").val(e.method)})},isValid:function(){return this._validateTitle()?this._validateRowCount()?!0:!1:!1},_validateTitle:function(){var e=this.$el.find("#tableTitle").val();return e.length<1||e.length>20?($.goError(GO.i18n(u["0\uc790\uc774\uc0c1 0\uc774\ud558 \uc785\ub825\ud574\uc57c\ud569\ub2c8\ub2e4."],{arg1:1,arg2:20}),this.$("#tableTitle"),!1,!0),!1):!0},_validateRowCount:function(){var e=parseInt(this.numberFormView.getValue());return e<1||20<e?($.goError(GO.i18n(f["0\uc774\uc0c1 0\uc774\ud558\ub85c \uc785\ub825\ud574\uc57c\ud569\ub2c8\ub2e4"],{arg1:1,arg2:20}),this.$el.find("[el-row-count]"),!1,!0),!1):!0},save:function(){var e=this.$("#tableTitle").val();this.model.set("title",e);var t=this.$("#rangeOption").val();this.model.set("rangeOption",t);var n=this.$("#aggMethod").val();this.model.set("aggMethod",n);var r=this.$("#calculateCid").val();this.model.set("calculateField",this.chartFields.findByCid(r).toJSON());var i=this.$("#direction").val();this.model.set("direction",i);var s=parseInt(this.numberFormView.getValue());this.model.set("rowCount",s);var o=this.$("#standardCid").val(),u=this.chartFields.findByCid(o).toJSON();this.model.set("standardField",u);var a=[];_.each(this.$("#subQueryWrap").children("tr[sub_query]"),function(e){var t=$(e).find("select[data-cid]").val(),n=$(e).find("select[data-method]").val();a.push({method:n,componentId:t})}),this.model.set("subQuery",JSON.stringify(a))},_onChangeStandardCid:function(){var e=this.$("#standardCid").val(),t=this.chartFields.findByCid(e).toJSON();this._toggleDateTimeView(t.valueType,"rangeOption")},_onChangeCalculateCid:function(){var e=this.$el.find("#calculateCid :selected").attr("data-value-type");"NUMBER"===e?(this.$el.find("#aggMethod").children().remove(),this.$el.find("#aggMethod").append(c.render({lang:h})),this.$el.find("#aggMethod").val(this.model.get("aggMethod"))):this.$el.find("#aggMethod").children(":gt(0)").remove()},_onChangeSubQuery:function(e){var t=this.$(e.target.options[e.target.selectedIndex]).attr("data-value-type"),n=this.$(e.target).closest("td").find("[data-method]");"NUMBER"===t?(n.children().remove(),n.append(c.render({lang:h}))):n.children(":gt(0)").remove()},_onClickAdd:function(){this.$("[row-add]").hide(),this.$("#subQueryWrap").append(s({lang:h,chartFields:this.chartFields.toJSON(),hasNumberFields:this.numberFields.length>0,hasChartFields:this.chartFields.length>0}))},_onClickDelete:function(e){this.$("[row-add]").show(),$(e.target).closest("tr").remove()},_toggleDateTimeView:function(e,t){var n=this.$("#"+t),r=_.contains([o.DATE,o.DATETIME,o.TIME],e),i=o.TIME===e;r?i?(n.toggle(!1),this.model[t]="HOUR"):(n.val()||n.val("DAY"),n.toggle(!0),this.model[t]=n.val()):(n.toggle(!1),this.model[t]=null)}})});