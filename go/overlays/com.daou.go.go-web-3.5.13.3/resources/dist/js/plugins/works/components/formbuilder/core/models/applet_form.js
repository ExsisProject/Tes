define("works/components/formbuilder/core/models/applet_form",function(require){var e=require("underscore"),t=require("backbone"),n=require("works/components/formbuilder/core/cid_generator"),r=require("i18n!works/nls/works"),i=t.Model.extend({search:function(e){return s(this.getRootNode(),e)},getIndex:function(t){var n=this.getParentNode(t),r=-1;if(n){var i=e.pluck(n.components,"cid");r=e.indexOf(i,t.cid)}return r},insert:function(e,t,n){if(!this._isValidNode(e))return new Error("Illegal Node");if(e.parentCid){var r=this.search(e.parentCid);r.components===null&&(r.components=[]),t===0?r.components.unshift(e):t>0?r.components.splice(t,0,e):r.components.push(e);if(n||!1)this.trigger("change"),this.trigger("change:node:"+e.parentCid)}},update:function(t,n){var r;if(!this._isValidNode(t))return new Error("Illegal Node");r=this.search(t.cid),e.extend(r,t);if(n||!1)this.trigger("change"),this.trigger("change:node:"+t.cid)},order:function(t,n,r){function c(t,n){return t.components===null||e.where(t.components,{cid:n}).length<1}function h(e,t){return e.cid===t.cid}function p(e,t){return t===e}function d(e,t){return e===t-1}if(t.parentCid){var i=this.search(t.parentCid);if(c(i,t.cid)){this.insert(t,n,r);return}var s=e.pluck(i.components,"cid"),o=e.indexOf(s,t.cid);if(o===n)return;var u=[],a=i.components.length;t=e.findWhere(i.components,{cid:t.cid});for(var f=0;f<a;f++){var l=i.components[f];if(h(t,l))continue;p(n,f)&&o<n?u.push(l,t):p(n,f)&&o>n?u.push(t,l):u.push(l)}n>a&&u.push(t),i.components=u;if(r||!1)this.trigger("change"),this.trigger("change:node:"+t.parentCid);return i}},remove:function(t,n){var r=this.getParentNode(t),i=n||!1;if(r){var s=e.pluck(r.components||[],"cid"),o=e.indexOf(s,t.cid);if(o<0)return;r.components.splice(o,1),i||(this.trigger("change"),this.trigger("remove:node:"+t.cid))}},checkValidate:function(){if(!this._displayRuleValidation())return r["\uc798\ubabb\ub41c \ub178\ucd9c \uc870\uac74\uc774 \uc788\uc2b5\ub2c8\ub2e4. \ub178\ucd9c \uc870\uac74\uc744 \uc218\uc815\ud574 \uc8fc\uc138\uc694."];var t=this.get("components");return e.isArray(t)&&t.length>0?!1:r["\ucef4\ud3ec\ub10c\ud2b8 \ucd5c\uc18c\uac2f\uc218 \uac80\uc99d \uc624\ub958\uba54\uc2dc\uc9c0"]},getRootNode:function(){return this.attributes},getParentNode:function(t){var n=null,r;return e.isString(t)?r=t:e.isObject(t)&&t.cid&&(r=t.cid),e.isString(r)&&(n=o(this.getRootNode(),r)),n},_isValidNode:function(t){return e.isObject(t)?t&&!e.isString(t.cid)?!1:!0:!1},_displayRuleValidation:function(){function n(r,i){r.cid===i?t=!0:e.each(r.components,function(e){if(e.cid===i)return t=!0,!1;n(e,i)})}var t=!1;return e.each(this.get("components"),function(e){var t=e.properties.rule;if(t){var r=t.listenComponentId;n(e,r)}}),!t}}),s=function(e,t){if(e.cid===t)return e;if(e.components!=null){var n=null;for(var r=0;r<e.components.length;r++){n=s(e.components[r],t);if(n)break}return n}return null},o=function(t,n){var r=null;if(t.cid!==n&&t.components&&e.isArray(t.components))for(var i=0;i<t.components.length;i++){var s=t.components[i];s.cid===n?r=t:r=o(s,n);if(r)break}return r};return{create:function(t){if(e.isUndefined(t))t={type:"canvas",cid:n.generate(),parentCid:null,components:[]};else if(e.isObject(t)&&t.type&&t.type!=="canvas")throw new Error("AppletFormModel \uac1d\uccb4\uac00 \uc544\ub2d9\ub2c8\ub2e4.");return new i(t)}}});