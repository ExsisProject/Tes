define("works/components/formbuilder/form_components/input_number/input_number",function(require){var e=require("underscore"),t=require("app"),n=require("works/components/formbuilder/core/component_manager"),r=require("works/component_type"),s=require("works/components/formbuilder/constants"),o=require("works/components/formbuilder/core/form_component"),u=require("works/components/formbuilder/core/component_registry"),a=require("works/components/formbuilder/core/views/base_component"),f=require("works/components/formbuilder/core/views/base_form"),l=require("works/components/formbuilder/core/views/base_detail"),c=require("works/components/formbuilder/core/views/base_option"),h=require("works/components/formbuilder/form_components/input_number/input_number_validator"),p=require("hgn!works/components/formbuilder/form_components/input_number/form"),d=require("hgn!works/components/formbuilder/form_components/input_number/detail"),v=require("hgn!works/components/formbuilder/form_components/input_number/option"),m=require("hgn!works/components/formbuilder/form_components/input_number/aggr_form"),g=require("hgn!works/components/formbuilder/form_components/input_number/aggr_detail"),y=require("i18n!works/nls/works"),b=require("i18n!nls/commons"),w=require("works/libs/util"),E={"\uc774\ub984":b["\uc774\ub984"],"\uc124\uba85":y["\uc124\uba85"],"\uc774\ub984\uc744 \uc785\ub825\ud574\uc8fc\uc138\uc694":y["\uc774\ub984\uc744 \uc785\ub825\ud574\uc8fc\uc138\uc694."],"\uc124\uba85\uc744 \uc785\ub825\ud574\uc8fc\uc138\uc694":y["\uc124\uba85\uc744 \uc785\ub825\ud574\uc8fc\uc138\uc694."],"\ud234\ud301\uc73c\ub85c \ud45c\ud604":y["\ud234\ud301\uc73c\ub85c \ud45c\ud604"],"\ud544\uc218 \uc785\ub825 \ucef4\ud3ec\ub10c\ud2b8":y["\ud544\uc218 \uc785\ub825 \ucef4\ud3ec\ub10c\ud2b8"],"\uae30\ubcf8\uac12":y["\uae30\ubcf8\uac12"],"\ucd5c\uc18c \uc785\ub825 \uc218":y["\ucd5c\uc18c \uc785\ub825 \uc218"],"\ucd5c\ub300 \uc785\ub825 \uc218":y["\ucd5c\ub300 \uc785\ub825 \uc218"],"\uc785\ub825 \ub108\ube44 \uc870\uc808":y["\uc785\ub825 \ub108\ube44 \uc870\uc808"],"\ud37c\uc13c\ud2b8\uc124\uba85":y["\ud37c\uc13c\ud2b8\uc124\uba85"],"\uc811\uc0ac \ud45c\uae30":y["\uc811\uc0ac \ud45c\uae30"],"\uc811\ub450\uc0ac":y["\uc811\ub450\uc0ac"],"\uc811\ubbf8\uc0ac":y["\uc811\ubbf8\uc0ac"],"\uc18c\uc218\uc810 \uc790\ub9ac \uc218":y["\uc18c\uc218\uc810 \uc790\ub9ac \uc218"],"1,000 \ub2e8\uc704 \uc27c\ud45c \ud45c\uc2dc":y["1,000 \ub2e8\uc704 \uc27c\ud45c \ud45c\uc2dc"],"\uc774\ub984\uc228\uae30\uae30":y["\uc774\ub984\uc228\uae30\uae30"],"\ud14c\uc774\ube14 \uc790\ub3d9\uacc4\uc0b0":y["\ud14c\uc774\ube14 \uc790\ub3d9\uacc4\uc0b0"],"\ud14c\uc774\ube14 \uc790\ub3d9\uacc4\uc0b0 \uc0ac\uc6a9\ud568":y["\ud14c\uc774\ube14 \uc790\ub3d9\uacc4\uc0b0 \uc0ac\uc6a9\ud568"],"\ud569\uacc4":y["\ud569\uacc4"],"\ud3c9\uade0":y["\ud3c9\uade0"],"\ud569\uacc4 \uacc4\uc0b0":y["\ud569\uacc4 \uacc4\uc0b0"],"\ud3c9\uade0 \uacc4\uc0b0":y["\ud3c9\uade0 \uacc4\uc0b0"],"\ud14c\uc774\ube14 \uc790\ub3d9\uacc4\uc0b0 \uc124\uba85":y["\ud14c\uc774\ube14 \uc790\ub3d9\uacc4\uc0b0 \uc124\uba85"],"\uc120\ud0dd\ud558\uc138\uc694":b["\uc120\ud0dd\ud558\uc138\uc694."],"\uad00\ub9ac\uc790\uc5d0 \uc758\ud574 \ub9c8\uc2a4\ud0b9 \ucc98\ub9ac \ub41c \ud56d\ubaa9\uc785\ub2c8\ub2e4":y["\uad00\ub9ac\uc790\uc5d0 \uc758\ud574 \ub9c8\uc2a4\ud0b9 \ucc98\ub9ac \ub41c \ud56d\ubaa9\uc785\ub2c8\ub2e4"],"\uc22b\uc790":y["\uc22b\uc790"],"\ube44\uc728":y["\ube44\uc728"],"\ub4f1\uae09":y["\ub4f1\uae09"],"\uc22b\uc790\uc720\ud615\uc124\uba85":y["\uc22b\uc790\uc720\ud615\uc124\uba85"],"\uc720\ud615":y["\uc720\ud615"]},S={NUMBER:"NUMBER",PERCENT:"PERCENT",POINT:"POINT"},x={dataType:S.NUMBER,minLength:1,maxLength:1e11,width:250,widthUnit:"px",fixType:"postfix",decimalPoints:2},T={SUM:"SUM",AVR:"AVR"},N=[16,35,36,37,38,39,46];require("jquery.maskMoney"),require("jquery.go-popup");var C=a.extend({className:"number-aggrview",render:function(){this.$body.html(m({placeholder:this.model.get("tableAggrType")===T.AVR?E["\ud3c9\uade0 \uacc4\uc0b0"]:E["\ud569\uacc4 \uacc4\uc0b0"]}));var e=this.model.get("width"),t=this.model.get("dataType")?this.model.get("dataType"):S.NUMBER;t==S.NUMBER&&this.resizeWidth(e,this.model.get("widthUnit"))},setValue:function(e){this.$el.find("input[type=text]").val(e)},resizeWidth:function(e,t){this._getInputElement().outerWidth(e+t)},_getInputElement:function(){return this.$("input[type=text]")}}),k=l.extend({className:"number-aggrview",__rendered__:!1,initialize:function(e){l.prototype.initialize.apply(this,arguments),this.__rendered__=!1,this.value=null,(e||{}).value&&(this.value=e.value)},setValue:function(e){this.value=e,this.__rendered__&&this.render()},render:function(){var e=this.model.get("dataType")?this.model.get("dataType"):S.NUMBER;this.$body.html(g({model:this.model.toJSON(),label:t.util.escapeHtml(this.model.get("label")),userData:this.value,isPrefix:this.model.get("fixType")==="prefix",aggrTypeText:this.model.get("tableAggrType")===T.AVR?E["\ud3c9\uade0"]:E["\ud569\uacc4"],isNumber:e==S.NUMBER,isPercent:e==S.PERCENT,isPoint:e==S.POINT})),this.__rendered__=!0}}),L=c.extend(e.extend({},{customEvents:{"blur input[name=minLength], input[name=maxLength], input[name=width], input[name=decimalPoints]":"_checkOptionValidate","keypress input[name=minLength], input[name=maxLength]":"onlyNumberWithMinus","keypress input[name=width], input[name=decimalPoints]":"onlyNumber","keyup input[name=minLength], input[name=maxLength]":"replaceNumberWithMinus","keyup input[name=width], input[name=decimalPoints]":"replaceNumber","keypress input[name=defaultValue]":"_validateDefaultValue","keyup input[name=defaultValue]":"_validateDefaultValueBanHan","focusout input[name=defaultValue]":"_validateDefaultValueFocusOut","focusout input[name=minLength], input[name=maxLength]":"_validateMinMaxValueFocusOut","click input[name=useTableAutoAggr]":"_toggleAggrTypeSection","click input[name=dataType]":"_changeDataType"},initialize:function(e){c.prototype.initialize.call(this,e),this.component=n.getComponent(this.options.clientId),this.observer=this.component.getObserver(),this.listenTo(this.observer,s.REQ_ORDER_COMPOMENT,this.renderBody)},renderBody:function(){var e=n.getComponent(this.component.getParentCid()),t=this.model.get("dataType")?this.model.get("dataType"):S.NUMBER;this.$el.html(v({lang:E,model:this.model.toJSON(),isPrefix:this.model.get("fixType")==="prefix",AggrType:T,DataType:S,isInTable:e?e.type==="table":!1,isNumber:t==S.NUMBER,isPercent:t==S.PERCENT,isPoint:t==S.POINT})),this.__changeOptionByDataType(t),this.__changeDefaultValueByDataType(t),this.$el.find("select[name=aggrType]").val(this.model.get("aggrType")||""),n.isNew(this.clientId)||this.$('input[name="dataType"]').attr("disabled",!0)},_checkOptionValidate:function(t){var n=$(t.currentTarget),r=n.attr("name"),i=n.val();i==""&&e.has(x,r)&&(n.val(x[r]),this.model.set(r,x[r]));if(parseInt(this.$("input[name=minLength]").val())>parseInt(this.$("input[name=maxLength]").val()))if(parseInt(this.$("input[name=maxLength]").val())==0)this.$("input[name=minLength]").val(0),this.model.set("minLength",0);else{var s=this.model.get("dataType")==S.NUMBER?x.minLength:0;this.$("input[name=minLength]").val(s),this.model.set("minLength",s)}},onlyNumberWithMinus:function(e){var t=e.keyCode?e.keyCode:e.which,n="";e.which==null?n=String.fromCharCode(e.keyCode):e.which!=0&&e.charCode!=0&&(n=String.fromCharCode(e.which));if(!w.isNumber(t)&&/[^0-9\-]/gi.test(n))return e.preventDefault(),!1},onlyNumber:function(e){var t=e.keyCode?e.keyCode:e.which;if(!w.isNumber(t))return e.preventDefault(),!1},replaceNumberWithMinus:function(e){var t=e.keyCode?e.keyCode:e.which,n=$(e.currentTarget),r=n.val();if(!w.isNumber(t)&&/[^0-9\-]/gi.test(r)){var i=$(e.currentTarget).val().replace(/[^0-9]/gi,"");return $(e.currentTarget).val(i),e.preventDefault(),!1}},replaceNumber:function(e){var t=e.keyCode?e.keyCode:e.which;if(!w.isNumber(t)){var n=$(e.currentTarget).val().replace(/[^0-9]/gi,"");return $(e.currentTarget).val(n),e.preventDefault(),!1}},_validateDefaultValue:function(e){var t=e.keyCode?e.keyCode:e.which;if(!w.isNumber(t,[45,46]))return e.preventDefault(),!1},_validateDefaultValueBanHan:function(e){$(e.currentTarget).val($(e.currentTarget).val().replace(/[^0-9\.\,\-]/gi,"")),this._updateText(e)},_validateDefaultValueFocusOut:function(e){var t=parseInt(this.$("input[name=defaultValue]").val());parseInt(this.$("input[name=minLength]").val())>t&&(this.$("input[name=defaultValue]").val(0),this.model.set("defaultValue",0)),parseInt(this.$("input[name=maxLength]").val())<t&&(this.$("input[name=defaultValue]").val(0),this.model.set("defaultValue",0))},_validateMinMaxValueFocusOut:function(e){var t=this.model.get("dataType")==S.PERCENT,n=parseInt(this.model.get("minLength")),r=parseInt(this.model.get("maxLength"));if(t&&n<x.minLength||n>x.maxLength)this.$('input[name="minLength"]').val(x.minLength),this.model.set("minLength",this.$('input[name="minLength"]').val());if(r>x.maxLength||r<x.minLength)this.$('input[name="maxLength"]').val(x.maxLength),this.model.set("maxLength",this.$('input[name="maxLength"]').val())},_toggleAggrTypeSection:function(e){var t=$(e.currentTarget),n=t.is(":checked"),r=this.$("#aggrTypeSection");r.toggle(n),this.model.set("useTableAutoAggr",n),n||this.model.set("tableAggrType",T.SUM)},_changeDataType:function(e){var t=$(e.currentTarget),n=t.val();this.__changeOptionByDataType(n),this.__changeDefaultValueByDataType(n),this.__changeOptionValueByDataType(),this.model.set("dataType",n)},__changeDefaultValueByDataType:function(e){e==S.NUMBER?(x.minLength=1,x.maxLength=1e11,x.decimalPoints=2):e==S.PERCENT?(x.minLength=0,x.maxLength=100,x.decimalPoints=0):e==S.POINT&&(x.minLength=1,x.maxLength=10,x.decimalPoints=0)},__changeOptionByDataType:function(e){e==S.NUMBER?(this.$("[disable-el-percent]").show(),this.$("[disable-el-point]").show()):e==S.PERCENT?(this.$("[disable-el-point]").show(),this.$("[disable-el-percent]").hide()):(this.$("[disable-el-percent]").show(),this.$("[disable-el-point]").hide())},__changeOptionValueByDataType:function(){this.$('input[name="minLength"]').val(x.minLength),this.$('input[name="maxLength"]').val(x.maxLength),this.$('input[name="decimalPoints"]').val(x.decimalPoints),this.model.set("minLength",this.$('input[name="minLength"]').val()),this.model.set("maxLength",this.$('input[name="maxLength"]').val()),this.model.set("decimalPoints",this.$('input[name="decimalPoints"]').val())}})),A=f.extend({events:{"keyup input[type=text]":"_onInputNumber","change input[type=text]":"_onInputNumber"},initialize:function(){f.prototype.initialize.apply(this,arguments),this.__numberFomatter__options={decimalPoints:this._getDecimalPoints(),thousandComma:this._isUseThousandComma(),useTableAutoAggr:this._isUseTableAutoAggr(),tableAggrType:this._getTableAggrType()},this.validator=new h},render:function(){var n=parseFloat(this.appletDocModel.get(this.clientId));if(e.isNaN(n)){var r=parseFloat(this.model.get("defaultValue"));e.isNaN(r)||this.appletDocModel.set(this.clientId,r)}var s=this.model.get("dataType")?this.model.get("dataType"):S.NUMBER;this.$body.html(p({model:this.model.toJSON(),label:t.util.escapeHtml(this.model.get("label")),clientId:this.clientId,inputValue:this._validRenderNumber(this.model),isPrefix:this.model.get("fixType")==="prefix",isReadonly:this.isEditable(),"editable?":this.isEditable(),useTableAutoAggr:this._isUseTableAutoAggr(),aggrPlaceholderText:this._getAggrTypeText(),isMasking:this.isMasking(),lang:E,isNumber:s==S.NUMBER,isPercent:s==S.PERCENT,isPoint:s==S.POINT,points:function(){var e=[],t=parseInt(this.model.maxLength)>10?10:parseInt(this.model.maxLength);for(i=0;i<t;i++)e[i]={index:i,customClass:i<this.inputValue?"":"ic_star_off"};return e}})),this.$("input").trigger("change");var o=this.model.get("width");s==S.NUMBER&&this.resizeWidth(o,this.model.get("widthUnit"))},renderNode:function(){var t=f.prototype.renderNode.apply(this,arguments),n=this._getComponent();return!n.visible&&this.__aggrView__&&this.__aggrView__._toggleComponent(n.visible),this.isMultiple()&&this._isUseTableAutoAggr()&&!this.isEditable()&&n.visible&&(e.isArray(t)||(t=[t]),this._setAggrFormView(this._createAggrFormView()),t.push(this._getAggrFormView()),this._setAggrField()),t},createMultipleView:function(t){var n=f.prototype.createMultipleView.apply(this,arguments);return this.isMultiple()&&this._isUseTableAutoAggr()&&!this.isEditable()&&n.$el.on("keyup.inputnumber","input[type=text]",e.bind(this._setAggrField,this)),this._setAggrField(),n},removeMultipleView:function(e){f.prototype.removeMultipleView.apply(this,arguments),this._setAggrField(),this.appletDocModel.set(this.clientId,this._getMultipleData())},resizeWidth:function(e,t){this._getInputElement().outerWidth(e+t)},getFormData:function(){return this.isMultiple()&&this.appletDocModel.set(this.clientId,this._getMultipleData()),this.appletDocModel.toJSON()},getDataFromView:function(){var t=this,n=[],r={};return this.isMultiple()?(n.push(t._removeComma(this.$("input[type=text]").val())),e.each(this.getMultipleViews(),function(e){n.push(t._removeComma(e.$("input[type=text]").val()))})):n=this._removeComma(this.$("input[type=text]").val()),r[this.getCid()]=n,r},validate:function(){var e=this.$("input[type=text]"),t=e.val(),n=this.validator.validate({value:t},this.model.toJSON());return n.isValid||this._printErrorTo(n.message),n.isValid},_setAggrFormView:function(e){if(this.__aggrView__)return;e.$el.attr("cid",e.cid),this.__aggrView__=e},_getAggrFormView:function(){return this.__aggrView__},_createAggrFormView:function(){var e=new C({type:this.getType(),appletId:this.getAppletId(),clientId:this.getCid(),parentCid:this.getParentCid(),components:[],model:this.model.clone(),appletDocModel:this.appletDocModel||null,editable:this.isEditable(),multiple:!1,cloneable:!1,observer:this.observer});return e.render(),e},_isUseThousandComma:function(){return this.model.get("thousandComma")===!0},_getDecimalPoints:function(){return parseInt(this.model.get("decimalPoints")||x.decimalPoints)},_isUseTableAutoAggr:function(){return this.model.get("useTableAutoAggr")===!0},_getTableAggrType:function(){return this.model.get("tableAggrType")},_printErrorTo:function(e){var t=this.$("input[type=text]");t.trigger("focus"),this.printErrorTo(t,e)},_onRestore:function(){this.$("input[type=text]").val(this.appletDocModel.get(this.clientId)).trigger("change")},_onInputNumber:function(t){if(e.contains(N,t.keyCode))return;var n=this.getDataFromView()[this.clientId];this.appletDocModel.set(this.clientId,n);var r=this._validateNumber(t);this._isUseTableAutoAggr()&&this.isMultiple()&&this._setAggrField(t);var i=this.model.get("dataType")?this.model.get("dataType"):S.NUMBER;i==S.PERCENT?this.$("#percentGage").width(r+"%"):i==S.POINT&&$(t.currentTarget).siblings(".com_rate").find(".ic_star").each(function(e,t){e<r?$(this).removeClass("ic_star_off"):$(this).addClass("ic_star_off")})},_validateNumber:function(e){var t=$(e.currentTarget),n=this._processNumberFormat(t.val());return t.val(n),n},_processNumberFormat:function(n,r){var i=this.__numberFomatter__options;return r&&(i=e.extend(e.clone(this.__numberFomatter__options),{decimalPoints:12})),t.util.formatNumber(n,i)},_removeComma:function(e){return e?parseFloat((e||"").replace(/,/gi,"")):null},_getInputElement:function(){return this.$("input[type=text]")},_validRenderNumber:function(){var e=this.appletDocModel.get(this.clientId);if(!this.appletDocModel.id){var t=e||this.model.get("defaultValue");e=t!=""?parseFloat(t):""}return this._processNumberFormat(e,!0)},getAggrValue:function(){var t=0,n=this.getMultipleViews(!0),r=e.union([this],n),i=0;return e.each(r,function(n){var r=parseFloat(this._removeComma(n.$el.find("input[type=text]").val()));e.isNumber(r)&&!e.isNaN(r)&&(t+=r,i++)},this),this._getTableAggrType()===T.AVR&&i>0&&(t/=i),i?t:""},_setAggrField:function(){if(this.isEditable())return;var t=this.getAggrValue();this._getAggrFormView()&&e.isNumber(t)&&this._getAggrFormView().setValue(this._processNumberFormat(t))},_getAggrTypeText:function(){return this.model.get("tableAggrType")===T.AVR?E["\ud3c9\uade0 \uacc4\uc0b0"]:E["\ud569\uacc4 \uacc4\uc0b0"]}}),O=l.extend({initialize:function(){l.prototype.initialize.apply(this,arguments),this.__numberFomatter__options={decimalPoints:this._getDecimalPoints(),thousandComma:this._isUseThousandComma(),useTableAutoAggr:this._isUseTableAutoAggr(),tableAggrType:this._getTableAggrType()}},render:function(){var e=this.model.get("dataType")?this.model.get("dataType"):S.NUMBER;this.$body.html(d({model:this.model.toJSON(),label:t.util.escapeHtml(this.model.get("label")),userData:this._getValidNumber(),isPrefix:this.model.get("fixType")==="prefix",isMasking:this.isMasking(),lang:E,isNumber:e==S.NUMBER,isPercent:e==S.PERCENT,isPoint:e==S.POINT,points:function(){var e=[],t=parseInt(this.model.maxLength)>10?10:parseInt(this.model.maxLength);for(i=0;i<t;i++)e[i]={index:i,customClass:i<parseFloat(this.userData)?"":"ic_star_off"};return e}}));var n=this.model.get("width");e==S.NUMBER&&this.resizeWidth(n,this.model.get("widthUnit"))},renderNode:function(){var t=f.prototype.renderNode.apply(this,arguments);return this.isMultiple()&&this._isUseTableAutoAggr()&&!this.isEditable()&&(e.isArray(t)||(t=[t]),this._setAggrDetailView(this._createAggrDetailView()),t.push(this._getAggrDetailView())),t},resizeWidth:function(e,t){this._getInputElement().outerWidth(e+t)},getTitle:function(){return this._getValidNumber()},getAggrValue:function(){var t=0,n=this.getMultipleViews(!0),r=0;return n.unshift(this),e.each(n,function(n){var i=n.appletDocModel.get(n.getCid());e.isNumber(i)&&!e.isNaN(i)&&(t+=i,r++)},this),this._getTableAggrType()===T.AVR&&r>0&&(t/=r),t},_createAggrDetailView:function(){var e=this.getAggrValue(),t=new k({value:this._processNumberFormat(e),type:this.getType(),appletId:this.getAppletId(),clientId:this.getCid(),parentCid:this.getParentCid(),components:[],model:this.model.clone(),appletDocModel:null,editable:this.isEditable(),multiple:!1,observer:this.observer});return t.render(),t},_getInputElement:function(){return this.$("input[type=text]")},_setAggrDetailView:function(e){this.__aggrView__=e},_getAggrDetailView:function(){return this.__aggrView__},_isUseThousandComma:function(){return this.model.get("thousandComma")===!0},_getDecimalPoints:function(){return parseInt(this.model.get("decimalPoints")||x.decimalPoints)},_isUseTableAutoAggr:function(){return this.model.get("useTableAutoAggr")===!0},_getTableAggrType:function(){return this.model.get("tableAggrType")},_getValidNumber:function(){var e=this.appletDocModel.get(this.clientId);return this._processNumberFormat(e)},_processNumberFormat:function(e){return t.util.formatNumber(e,this.__numberFomatter__options)}}),M=o.define(r.Number,{name:y["\uc22b\uc790"],valueType:"NUMBER",group:"basic",properties:{label:{defaultValue:y["\uc22b\uc790"]},hideLabel:{defaultValue:!1},guide:{defaultValue:""},guideAsTooltip:{defaultValue:!0},required:{defaultValue:!1},defaultValue:{defaultValue:null},dataType:{defaultValue:x.dataType},minLength:{defaultValue:x.minLength},maxLength:{defaultValue:x.maxLength},width:{defaultValue:x.width},widthUnit:{defaultValue:x.widthUnit},unitText:{defaultValue:""},fixType:{defaultValue:x.fixType},decimalPoints:{defaultValue:x.decimalPoints},thousandComma:{defaultValue:!0},useTableAutoAggr:{defaultValue:!1},tableAggrType:{defaultValue:""}},OptionView:L,FormView:A,DetailView:O});u.addComponent(M)});