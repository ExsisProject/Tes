define("works/collections/fields",function(require){var e=require("collections/base_collection"),t=require("works/models/field"),n=require("works/constants/field_type"),r=require("works/constants/value_type"),i={};return e.extend({model:t,initialize:function(t,n){e.prototype.initialize.call(this,n),n=n||{},this.collectionName="filter_fields",this.appletId=n.appletId,this.subFormId=n.subFormId,this.includeProperty=n.includeProperty,this.includeDocNoAndProcess=n.includeDocNoAndProcess,this.type=n.type,this.fieldsOfIntegrationApplet={}},url:function(){var e=this.type?"/"+this.type:"",t=GO.contextRoot+"api/works/applets/"+this.appletId+e+"/fields";return GO.util.isValidValue(this.subFormId)&&(t=t+"/"+this.subFormId),this.includeProperty&&(t+="?p=true"),this.includeDocNoAndProcess&&(t+=this.includeProperty?"&dp=true":"?dp=true"),t},getFields:function(e){var t=_.map(e,function(e){return e.cid}),n=t.map(function(e){return this.findByCid(e)},this);return this._clone(n)},getFieldsOfIntegrationApplet:function(){var e=this.filter(function(e){return e.get("valueType")===r.APPLETDOCS}),t=_.uniq(_.compact(_.map(e,function(e){var t=e.get("properties")||{};return t.integrationAppletId}))),n=[];_.each(t,function(e){var t=new this.constructor([],{appletId:e,type:"consumers",includeProperty:!0});this.fieldsOfIntegrationApplet[e]=t,n.push(t.fetch())},this);var i=$.Deferred();return $.when.apply($,n).done(_.bind(function(){i.resolve(this.fieldsOfIntegrationApplet)},this)).fail(_.bind(function(){i.resolve(this.fieldsOfIntegrationApplet)},this)),i},getLinkableFields:function(){var e=this.filter(function(e){return(e.get("valueType")===r.APPLETDOCS||e.get("valueType")===r.NUMBER&&e.get("fieldType")!=n.FORMULA||e.get("valueType")===r.STEXT&&e.get("fieldType")!=n.DOCNO)&&!e._isMultiple()});return this._clone(e)},getDisplayFields:function(){var e=this.filter(function(e){return _.contains(n.APPLETDOC_DISPLAY_FIELD_TYPES,e.get("fieldType"))&&!e._isMultiple()},this);return this._clone(e)},getLinkableTextFields:function(){var e=this.filter(function(e){return(e.get("valueType")===r.STEXT||e.get("valueType")===r.APPLETDOCS)&&!e._isMultiple()});return this._clone(e)},getUserFields:function(){var e=this.filter(function(e){return e.get("valueType")===r.USERS});return this._clone(e)},getUserFieldsExceptMappingFields:function(){var e=this.filter(function(e){return e.get("valueType")===r.USERS&&e.get("fieldType")!==n.FIELD_MAPPING});return this._clone(e)},getFilterFields:function(){var e=this.filter(function(e){return _.contains(n.FILTER_FIELD_TYPES,e.get("fieldType"))},this);return this._clone(e)},getColumnFields:function(){var e=this.filter(function(e){return _.contains(n.COLUMN_FIELD_TYPES,e.get("fieldType"))&&!e._isMultiple()},this);return this._clone(e)},getChartFields:function(){var e=this.filter(function(e){return _.contains(n.CHART_FIELD_TYPES,e.get("fieldType"))&&!e._isMultiple()},this);return this._clone(e)},getNumberFields:function(){var e=this.filter(function(e){return r.NUMBER==e.get("valueType")&&!e._isMultiple()});return this._clone(e)},getListenableFields:function(){var e=this.filter(function(e){return _.contains(n.LISTENABLE_TYPES,e.get("fieldType"))&&!e.get("multiple")});return this._clone(e)},getMappableFields:function(){var e=this.filter(function(e){return _.contains(n.MAPPABLE_TYPES,e.get("fieldType"))&&!e._isMultiple()},this);return this._clone(e)},findByKeyword:function(e){return e?this.filter(function(t){return t.get("label").indexOf(e)>-1}):[]},unuseAllField:function(){this.each(function(e){e.set("isUsed",!1)})},mergeFromConditions:function(e){this.each(function(t){var n=_.map(e,function(e){return e.fieldCid}),r=_.contains(n,t.get("cid"));t.set("isUsed",r)})},mergeFromColumns:function(e){var t=_.map(e,function(e){return e.fieldCid});this.each(function(e){var n=_.contains(t,e.get("cid"));e.set("isUsed",n)})},getPropertyByFieldCid:function(e){if(!e)return null;var t=this.findWhere({cid:e});return t&&t.get("cid")?t.get("cid"):null},hasFieldByCid:function(e){var t=this.findWhere({cid:e});return _.isObject(t)},findByLabel:function(e){return this.findWhere({label:e})},findByCid:function(e){return this.findWhere({cid:e})},findByCode:function(e){return this.find(function(t){var n=t.get("properties")||{};return n.code==e},this)},getMappingFields:function(){var e=this.filter(function(e){return _.contains([r.STEXT,r.TEXT,r.NUMBER,r.SELECT,r.SELECTS,r.DATE,r.TIME,r.DATETIME,r.FILES,r.USER,r.USERS,r.DEPTS,r.APPLETDOCS],e.get("valueType"))&&!this._irreplaceableInValueType(e)&&e.get("fieldType")!==n.FIELD_MAPPING&&e.get("fieldType")!==n.FORMULA},this),t=this.clone();return t.reset(e)},getOpenApiFields:function(){var e=this.filter(function(e){return _.contains([r.STEXT,r.TEXT,r.NUMBER,r.SELECT,r.SELECTS,r.DATE,r.TIME,r.DATETIME],e.get("valueType"))&&!this._irreplaceableInValueType(e)&&e.get("fieldType")!==n.FIELD_MAPPING&&e.get("fieldType")!==n.FORMULA},this),t=this.clone();return t.reset(e)},getAvailableMappingFields:function(e){var t=e.get("valueType"),n=e.get("multiple"),r=this.clone(),i={STEXT:this._getMappingFieldsOfSText(n),TEXT:this._getMappingFieldsOfText(),NUMBER:this._getMappingFieldsOfNumber(n),SELECT:this._getMappingFieldsOfSelect(n),SELECTS:this._getMappingFieldsOfSelects(),DATE:this._getMappingFieldsOfDate(n),TIME:this._getMappingFieldsOfTime(n),DATETIME:this._getMappingFieldsOfDateTime(n),FILES:this._getMappingFieldsOfFiles(),USERS:this._getMappingFieldsOfUsers(),USER:this._getMappingFieldsOfUser(),DEPTS:this._getMappingFieldsOfDepts(),APPLETDOCS:this._getMappingFieldsOfAppletDocs(e)}[t];return r.reset(i)},getMaskableFields:function(){var e=this.filter(function(e){return _.contains(r.MASKABLE_TYPES,e.get("valueType"))||n.FIELD_MAPPING===e.get("fieldType")},this),t=this.clone();return t.reset(e)},rejectFields:function(e){var t=this.reject(function(t){return _.contains(e,t.get("cid"))},this),n=this.clone();return n.reset(t)},_getMappingFieldsOfSText:function(e){return this.filter(function(t){return _.contains([r.STEXT,r.NUMBER,r.SELECT,r.SELECTS,r.USERS,r.DEPTS,r.APPLETDOCS],t.get("valueType"))&&!this._irreplaceableInValueType(t)&&this._tableValidation(t,e)},this)},_getMappingFieldsOfText:function(){return this.filter(function(e){return _.contains([r.STEXT,r.TEXT,r.NUMBER,r.SELECT,r.SELECTS,r.USERS,r.DEPTS,r.APPLETDOCS],e.get("valueType"))&&!this._irreplaceableInValueType(e)},this)},_getMappingFieldsOfNumber:function(e){return this.filter(function(t){return _.contains([r.NUMBER],t.get("valueType"))&&this._tableValidation(t,e)},this)},_getMappingFieldsOfSelect:function(e){return this.filter(function(t){return _.contains([r.SELECT],t.get("valueType"))&&!this._irreplaceableInValueType(t)&&this._tableValidation(t,e)},this)},_getMappingFieldsOfSelects:function(){return this.filter(function(e){return _.contains([r.SELECT,r.SELECTS],e.get("valueType"))&&!this._irreplaceableInValueType(e)},this)},_getMappingFieldsOfDate:function(e){return this.filter(function(t){return _.contains([r.DATE,r.DATETIME],t.get("valueType"))&&!this._irreplaceableInValueType(t)&&this._tableValidation(t,e)},this)},_getMappingFieldsOfTime:function(e){return this.filter(function(t){return _.contains([r.TIME,r.DATETIME],t.get("valueType"))&&!this._irreplaceableInValueType(t)&&this._tableValidation(t,e)},this)},_getMappingFieldsOfDateTime:function(e){return this.filter(function(t){return _.contains([r.DATETIME],t.get("valueType"))&&this._tableValidation(t,e)},this)},_getMappingFieldsOfFiles:function(){return this.filter(function(e){return _.contains([r.FILES],e.get("valueType"))},this)},_getMappingFieldsOfUsers:function(){return this.filter(function(e){return _.contains([r.USERS,r.USER],e.get("valueType"))},this)},_getMappingFieldsOfUser:function(){return this.filter(function(e){return _.contains([r.USER],e.get("valueType"))},this)},_getMappingFieldsOfDepts:function(){return this.filter(function(e){return _.contains([r.DEPTS],e.get("valueType"))},this)},_getMappingFieldsOfAppletDocs:function(e){return this.filter(function(t){var n=t.get("properties")||{},i=e.get("properties")||{};return _.contains([r.STEXT,r.SELECT],t.get("valueType"))&&!this._irreplaceableInValueType(t)||t.get("valueType")===r.APPLETDOCS&&n.integrationAppletId===i.integrationAppletId&&n.integrationFieldCid===i.integrationFieldCid},this)},_irreplaceableInValueType:function(e){return _.contains(n.IRREPLACEABLE_IN_VALUE_TYPES,e.get("fieldType"))},_tableValidation:function(e,t){return t||!e._isMultiple()},_clone:function(e){var t=this.clone();return t.reset(e)},pick:function(e){return this._clone(this.map(function(t){return _.pick(t.toJSON(),e)}))}},{getFieldsByAppletId:function(e){var t=i[e];return t||(t=new this([],{appletId:e}),i[e]=t),t}})});