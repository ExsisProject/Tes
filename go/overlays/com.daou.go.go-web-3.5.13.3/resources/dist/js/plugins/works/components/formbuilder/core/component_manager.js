define("works/components/formbuilder/core/component_manager",function(require){var e=require("works/components/formbuilder/core/component_registry"),t=require("hgn!works/components/formbuilder/core/templates/drag_helper"),n={},r=function(e){return e=e||"instance",n[e]||n.instance},i=function(){};return i.init=function(e,t){t=t||{};var r=new i;return t.type&&(n[t.type]=r),n.instance=r,r.init.call(r,e),r},i.initMainForm=function(e,t){var n=r();return n.initMainForm.apply(n,arguments)},i.getInstance=function(e){return r(e)},i.createDragHelper=function(){var e=r();return e.createDragHelper.apply(e,arguments)},i.createComponent=function(){var e=r();return e.createComponent.apply(e,arguments)},i.getComponentClass=function(){var e=r();return e.getComponentClass.apply(e,arguments)},i.getComponentName=function(){var e=r();return e.getComponentName.apply(e,arguments)},i.addComponent=function(){var e=r();return e.addComponent.apply(e,arguments)},i.isCreated=function(){var e=r();return e.isCreated.apply(e,arguments)},i.isNew=function(){var e=r();return e.isNew.apply(e,arguments)},i.getComponent=function(){var e=r();return e.getComponent.apply(e,arguments)},i.getComponentsByType=function(){var e=r();return e.getComponentsByType.apply(e,arguments)},i.getComponents=function(){var e=r();return e.getComponents.apply(e,arguments)},i.getComponentByCid=function(){var e=r();return e.getComponentByCid.apply(e,arguments)},i.getFields=function(){var e=r();return e.getFields.apply(e,arguments)},i.removeComponent=function(){var e=r();return e.removeComponent.apply(e,arguments)},i.clear=function(){var e=r();return e.clear.apply(e,arguments)},i.clearNewComponent=function(){var e=r();return e.clearNewComponent.apply(e,arguments)},i.getMainFormComponent=function(){var e=r();return e.getMainFormComponent.apply(e,arguments)},_.extend(i.prototype,{__created__:{},__isNew__:{},__mainForm__:{},init:function(e){this.clear(),e&&this.addComponent(e,!0)},initMainForm:function(e,t){t&&(this.__mainForm__={}),e&&this._addMainFormComponent(e)},createDragHelper:function(e){var n=200,r=32,i=$(t({label:e,width:n,height:r}));return i.outerWidth(n),i.outerHeight(r),i},createComponent:function(t,n){var r=e.findByType(t);if(r.cid&&this.isCreated(r.cid))return!1;var i=new r;return n!=null&&i.setParentCid(n),this.__created__[i.getCid()]=i,this.__isNew__[i.getCid()]=i,i},getComponentClass:function(t){return e.findByType(t)},getComponentName:function(e){return this.getComponentClass(e).cname},addComponent:function(t,n){if(t&&!t.cid)throw new Error("Illegal node data");if(this.isCreated(t)&&!n&&!0)return this.__created__[t.cid];var r=e.findByType(t.type),i=new r(t);return this.__created__[i.getCid()]=i,i},isCreated:function(e){return _.isString(e)?this.__created__[e]:e&&e.cid&&this.__created__[e.cid]},isNew:function(e){var t;if(_.isString(e))t=e;else{if(!e||!e.cid)return!1;t=e.cid}return _.contains(_.keys(this.__isNew__),t)},getComponent:function(e){return this.__created__[e]},getComponentsByType:function(e){return _.filter(this.getComponents(),function(t){return e===t.getType()},this)},getComponents:function(){return _.values(this.__created__)},getComponentByCid:function(e){return _.findWhere(this.getComponents(),{cid:e})},getFields:function(){var e=this.getComponents();return _.map(e,function(e){return{cid:e.cid,fieldType:e.type,label:e.properties.label,multiple:e.multiple,options:e.properties.items||[],valueType:e.valueType,properties:e.properties}})},removeComponent:function(e){var t=this._parseComponentBy(e);t.remove(),delete this.__created__[t.getCid()],delete this.__isNew__[t.getCid()]},clear:function(){_.each(this.__created__,function(e){this.removeComponent(e)},this),this.__created__={},this.__isNew__={}},clearNewComponent:function(){this.__isNew__={}},getMainFormComponent:function(e){return this.__mainForm__[e]},_parseComponentBy:function(e){var t;return _.isString(e)?t=this.getComponent(e):t=e,t},_addMainFormComponent:function(e){var t=e.cid;this.__mainForm__[t]=e;if(!e.emptyChildrenComponent){var n=this;_.each(e.components,function(e){n._addMainFormComponent(e)})}}}),i});