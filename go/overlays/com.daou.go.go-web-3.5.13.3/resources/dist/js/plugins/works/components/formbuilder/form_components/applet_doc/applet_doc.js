define("works/components/formbuilder/form_components/applet_doc/applet_doc",function(require){require("jquery.go-validation");var e=require("underscore"),t=require("app"),n=require("when"),r=require("go-nametags"),s=require("works/components/formbuilder/form_components/applet_doc/dndtags_mobile"),o=require("works/component_type"),u=require("works/components/formbuilder/core/form_component"),a=require("works/components/formbuilder/core/component_registry"),f=require("works/components/formbuilder/core/component_manager"),l=require("works/components/formbuilder/core/views/base_form"),c=require("works/components/formbuilder/core/views/base_detail"),h=require("works/components/formbuilder/core/views/base_option"),p=require("hgn!works/components/formbuilder/form_components/applet_doc/form"),d=require("hgn!works/components/formbuilder/form_components/applet_doc/detail"),v=require("hgn!works/components/formbuilder/form_components/applet_doc/option"),m=require("works/libs/util"),g=require("works/components/applet_doc_search/views/applet_doc_search"),y=require("works/components/app_list/views/app_list"),b=require("works/models/applet_doc_summary"),w=require("works/collections/docs"),E=require("works/collections/fields"),S=require("works/models/field"),x=require("works/components/integration_manager/models/integration"),T=require("works/models/applet_baseconfig"),N=require("works/views/mobile/search_refer_apps"),C=require("works/components/masking_manager/models/masking"),k=require("works/constants/value_type"),L=require("i18n!works/nls/works"),A=require("i18n!nls/commons"),O={"\uc774\ub984":A["\uc774\ub984"],"\uc124\uba85":L["\uc124\uba85"],"\uc774\ub984\uc744 \uc785\ub825\ud574\uc8fc\uc138\uc694":L["\uc774\ub984\uc744 \uc785\ub825\ud574\uc8fc\uc138\uc694."],"\uc124\uba85\uc744 \uc785\ub825\ud574\uc8fc\uc138\uc694":L["\uc124\uba85\uc744 \uc785\ub825\ud574\uc8fc\uc138\uc694."],"\ud234\ud301\uc73c\ub85c \ud45c\ud604":L["\ud234\ud301\uc73c\ub85c \ud45c\ud604"],"\ud544\uc218 \uc785\ub825 \ucef4\ud3ec\ub10c\ud2b8":L["\ud544\uc218 \uc785\ub825 \ucef4\ud3ec\ub10c\ud2b8"],"\uc774\ub984\uc228\uae30\uae30":L["\uc774\ub984\uc228\uae30\uae30"],"\uac80\uc0c9":A["\uac80\uc0c9"],"\uc124\uc815":A["\uc124\uc815"],"\ucd94\uac00":A["\ucd94\uac00"],"\uc5f0\ub3d9\uc571":L["\uc5f0\ub3d9\uc571"],"\uc5f0\ub3d9 \ucef4\ud3ec\ub10c\ud2b8":L["\uc5f0\ub3d9 \ucef4\ud3ec\ub10c\ud2b8"],"\ub370\uc774\ud130 \uc5f0\ub3d9":L["\ub370\uc774\ud130 \uc5f0\ub3d9"],"\uc120\ud0dd \ucd5c\ub300 \uac1c\uc218":L["\uc120\ud0dd \ucd5c\ub300 \uac1c\uc218"],"\uc571\uc744 \uba3c\uc800 \uc120\ud0dd\ud558\uc138\uc694.":L["\uc571\uc744 \uba3c\uc800 \uc120\ud0dd\ud558\uc138\uc694."],"\ub370\uc774\ud130 \uc5f0\uacb0 \uc2dc, \uac80\uc0c9 \ub178\ucd9c \ud56d\ubaa9":L["\ub370\uc774\ud130 \uc5f0\uacb0 \uc2dc, \uac80\uc0c9 \ub178\ucd9c \ud56d\ubaa9"],"\uc571 \uac80\uc0c9 \uc124\uba85":L["\uc571 \uac80\uc0c9 \uc124\uba85"],"\uc5f0\ub3d9 \uad8c\ud55c \uc124\uba85":L["\uc5f0\ub3d9 \uad8c\ud55c \uc124\uba85"],"\uc5f0\ub3d9\ud560 \uc218 \uc788\ub294 \ud56d\ubaa9\uc774 \uc5c6\uc2b5\ub2c8\ub2e4.":L["\uc5f0\ub3d9\ud560 \uc218 \uc788\ub294 \ud56d\ubaa9\uc774 \uc5c6\uc2b5\ub2c8\ub2e4."],"\uc571 \uac80\uc0c9":L["\uc571 \uac80\uc0c9"],"\ub370\uc774\ud130 \uac80\uc0c9":L["\ub370\uc774\ud130 \uac80\uc0c9"],"\ucd5c\ub300 \uc120\ud0dd \uac1c\uc218\ub97c \ucd08\uacfc\ud558\uc600\uc2b5\ub2c8\ub2e4.":L["\ucd5c\ub300 \uc120\ud0dd \uac1c\uc218\ub97c \ucd08\uacfc\ud558\uc600\uc2b5\ub2c8\ub2e4."],"\uc0ad\uc81c\ub41c \uc5f0\ub3d9 \uc124\uba85":L["\uc0ad\uc81c\ub41c \uc5f0\ub3d9 \uc124\uba85"],"\uac80\uc0c9 \ub178\ucd9c \ud56d\ubaa9 \uc5c6\uc74c \uc124\uba85":L["\uac80\uc0c9 \ub178\ucd9c \ud56d\ubaa9 \uc5c6\uc74c \uc124\uba85"],"\uc5f0\ub3d9 \uc571 \uc5c6\uc74c \uc124\uba85":L["\uc5f0\ub3d9 \uc571 \uc5c6\uc74c \uc124\uba85"],"\uad00\ub9ac\uc790\uc5d0 \uc758\ud574 \ub9c8\uc2a4\ud0b9 \ucc98\ub9ac \ub41c \ud56d\ubaa9\uc785\ub2c8\ub2e4":L["\uad00\ub9ac\uc790\uc5d0 \uc758\ud574 \ub9c8\uc2a4\ud0b9 \ucc98\ub9ac \ub41c \ud56d\ubaa9\uc785\ub2c8\ub2e4"]},M={maxCount:10},_=h.extend({popupView:null,appListView:null,appNameTagView:null,fieldNameTagView:null,fields:null,optionListSettingView:null,applet:null,customEvents:{"blur input[name=maxCount]":"_checkOptionValidate","keypress input[name=maxCount]":"onlyNumber","keyup input[name=maxCount]":"replaceNumber","click [el-select-app]":"_onClickSelectApp","click [el-add-field]":"_onClickAddField","change #fields":"_onChangeFields"},initialize:function(e){h.prototype.initialize.call(this,e),this.fields=new E([],{appletId:this.model.get("integrationAppletId"),type:"consumers"}),this.fields.on("sync",this._onSyncFields,this),this.model.get("integrationAppletId")&&(this.fields.fetch(),this.applet=new T({id:this.model.get("integrationAppletId")}),this.applet.fetch({success:$.proxy(function(){this._syncApplet()},this),error:$.proxy(function(e,t){t.responseJSON.name==="not.found"&&(this.model.set("isDeletedApplet",!0),this._renderAppItem())},this),statusCode:{}}))},renderBody:function(){this.$el.html(v({lang:O,model:this.model.toJSON()})),this._initAppNameTagView(),this._initFieldNameTagView(),this._renderAppItem(),this._renderFieldOptions(),this._renderDisplayOptions(),this._renderSelectedDisplayItems()},_syncApplet:function(){var e=this.applet.get("name");this.model.set("appletName",e),this.$("#appArea").find('li[data-id="'+this.applet.id+'"]').find("span.name").text(e)},_appletChangeable:function(){var e=f.getComponent(this.clientId);if(!e)return;return f.isNew(this.clientId)?!0:!this.model.get("integrationAppletId")||this.model.get("integrationAppletId")!=e.properties.integrationAppletId},_integrationFieldChangeable:function(){var e=f.getComponent(this.clientId);if(!e)return;return f.isNew(this.clientId)?!0:!this.model.get("integrationFieldCid")||this.model.get("integrationFieldCid")!=e.properties.integrationFieldCid},_initAppNameTagView:function(){this.appNameTagView=r.create([],{useAddButton:!1}),this.appNameTagView.$el.on("nametag:removed",$.proxy(function(){this.model.unset("integrationAppletId"),this.model.unset("integrationFieldCid"),this.model.unset("appletName"),this.model.unset("fields"),this.model.unset("displayFields"),this.model.unset("selectedDisplayFields"),this.renderBody()},this)),this.$("#appArea").append(this.appNameTagView.el)},_initFieldNameTagView:function(){this.fieldNameTagView=r.create({useAddButton:!1}),this.fieldNameTagView.$el.on("nametag:removed",$.proxy(function(e,t){var n=new E(this.model.get("selectedDisplayFields")),r=n.findWhere({cid:t});n.remove(r),this.model.set("selectedDisplayFields",n.toJSON())},this)),this.$("#fieldArea").append(this.fieldNameTagView.el),this.fieldNameTagView.$el.sortable({stop:$.proxy(function(){var t=e.map(this.fieldNameTagView.$("li"),function(e){var t=$(e).attr("data-id"),n=this.fields.findWhere({cid:t});return n.pick(["cid","label","valueType"])},this);this.model.set("selectedDisplayFields",t)},this)})},_onClickSelectApp:function(){this.popupView=$.goPopup({pclass:"layer_normal layer_app_search",header:O["\uc571 \uac80\uc0c9"],contents:'<p class="desc">'+O["\uc571 \uac80\uc0c9 \uc124\uba85"]+"</p><hr>",buttons:[{btext:A["\ud655\uc778"],btype:"confirm",callback:$.proxy(function(){var e=this.appListView.getCheckedData();if(!e)return;this.model.set({integrationAppletId:e.get("id"),appletName:e.get("name")}),this._addApplet()},this)},{btext:A["\ucde8\uc18c"],btype:"cancel"}]}),this.appListView=new y({useBottomButton:!1}),this.popupView.find("div.content").append(this.appListView.render().el),this.appListView.$el.on("renderingComplete",$.proxy(function(){this.appListView.$("div.dataTables_paginate").css({"padding-top":"0px"}),this.popupView.reoffset()},this))},_addApplet:function(){this._renderAppItem(),this.model.set("fields",[]),this.model.set("integrationFieldCid",""),this.fields.appletId=this.model.get("integrationAppletId"),this.fields.fetch()},_renderAppItem:function(){this._appletChangeable()||this.$("span[el-select-app]").hide(),this.model.get("integrationAppletId")&&this.appNameTagView&&(this.appNameTagView.removeAll(),this.appNameTagView.addTag(this.model.get("integrationAppletId"),this.model.get("appletName"),{removable:this._appletChangeable()}),this.model.get("isDeletedApplet")&&this.appNameTagView.$("span.name").wrapInner("<strike></stike>"))},_onChangeFields:function(){var e=this.$("#fields").val(),t=this.model.get("integrationFieldCid");this._removeDisplayField(t),this._removeDisplayField(e),this._addDisplayField(e,!0),this.model.set("integrationFieldCid",e)},_mergedFields:function(t){this.model.set("isDeletedField",!1);var n=this.model.get("fields")||[];e.each(n,function(e){var n=t.findWhere({cid:e.cid});n||e.cid==this.model.get("integrationFieldCid")&&this.model.set("isDeletedField",!0)},this);var r=new E(n);return t.each(function(e){var t=r.findWhere({cid:e.get("cid")});t?t.set("label",e.get("label")):r.push(e)}),r},_mergedDisplayFields:function(){var t=this.fields.getColumnFields(),n=this.model.get("selectedDisplayFields")||[];n=e.reject(n,function(e){return!t.findWhere({cid:e.cid})});var r=new E(n);return t.each(function(e){var t=r.findWhere({cid:e.get("cid")});t&&t.set("label",e.get("label"))}),r},_onSyncFields:function(){var e=this.fields.getLinkableFields();e.comparator="label",e.sort();var t=e.toJSON(),n=this.fields.getDisplayFields().pick(["cid","label"]).toJSON(),r=this.model.get("integrationFieldCid")||(t.length>0?t[0].cid:"");this.model.set("fields",this._mergedFields(e).pick(["cid","label"]).toJSON()),this.model.set("integrationFieldCid",r),this.model.set("displayFields",n),this.model.set("selectedDisplayFields",this._mergedDisplayFields().pick(["cid","label","valueType"]).toJSON()),this._renderFieldOptions(),this._renderDisplayOptions(),this._renderSelectedDisplayItems(),this.model.get("selectedDisplayFields").length||this._addDisplayField(this.$("#fields").val(),!0)},_renderFieldOptions:function(){var t=this.model.get("fields");e.isUndefined(t)?t=[]:t.length===0&&t.push({cid:"",label:O["\uc5f0\ub3d9\ud560 \uc218 \uc788\ub294 \ud56d\ubaa9\uc774 \uc5c6\uc2b5\ub2c8\ub2e4."]}),this._renderOptions(t,this.$("#fields")),this.$("#fields").css("color",this.model.get("isDeletedField")?"red":""),this.model.get("integrationFieldCid")&&this.$("#fields").val(this.model.get("integrationFieldCid")),!f.isNew(this.clientId)&&!this._integrationFieldChangeable()&&this.$("#fields").prop("disabled","disabled")},_renderDisplayOptions:function(){var e=this.model.get("displayFields")||[];this._renderOptions(e,this.$("#displayFields"))},_renderOptions:function(t,n){t.length==0&&(t=[{cid:"",label:O["\uc571\uc744 \uba3c\uc800 \uc120\ud0dd\ud558\uc138\uc694."]}]);var r=e.map(t,function(e){return'<option value="'+e.cid+'">'+e.label+"</option>"});n.html(r)},_onClickAddField:function(){this._addDisplayField(this.$("#displayFields").val())},_addDisplayField:function(t,n){if(!t)return;var r=this.fields.findWhere({cid:t});if(!r)return;var i=this.model.get("selectedDisplayFields")||[],s=new E(i),o=e.isObject(s.findWhere({cid:r.get("cid")}));if(o)return;n&&(s.remove(this.model.get("integrationFieldCid")),i=s.toJSON());var u=e.pick(r.toJSON(),["cid","label","valueType"]);i.push(u),this.model.unset("selectedDisplayFields"),this.model.set("selectedDisplayFields",i),this._renderTextFieldItem(u,n)},_removeDisplayField:function(e){var t=this.model.get("selectedDisplayFields")||[],n=new E(t),r=n.findWhere({cid:e});n.remove(r),this.model.unset("selectedDisplayFields"),this.model.set("selectedDisplayFields",n.toJSON()),this.fieldNameTagView.removeTag(e)},_renderSelectedDisplayItems:function(){this.fieldNameTagView&&this.fieldNameTagView.removeAll(),e.each(this.model.get("selectedDisplayFields"),function(e){var t=e.cid==this.model.get("integrationFieldCid");this._renderTextFieldItem(e,t)},this)},_renderTextFieldItem:function(t,n){if(this.fieldNameTagView){this.fieldNameTagView.addTag(t.cid,t.label,{attrs:t,removable:n?!1:!0});var r=this.fieldNameTagView.$("span.name");e.each(r,function(e){var t=$(e);t.siblings("span.ic_drag").length||t.before('<span class="ic_works ic_drag"></span>')})}},onlyNumber:function(e){var t=e.keyCode?e.keyCode:e.which;if(!m.isNumber(t))return e.preventDefault(),!1},replaceNumber:function(e){var t=e.keyCode?e.keyCode:e.which;if(!m.isNumber(t)){var n=$(e.currentTarget).val().replace(/[^0-9]/gi,"");return $(e.currentTarget).val(n),e.preventDefault(),!1}},_checkOptionValidate:function(t){var n=$(t.currentTarget),r=n.attr("name"),i=n.val();i==""&&e.has(M,r)&&(n.val(M[r]),this.model.set(r,M[r])),r=="maxCount"&&i>20&&(n.val(20),this.model.set(r,20))}}),D=l.extend({fieldsFetched:null,initialize:function(e){e=e||{},l.prototype.initialize.call(this,e),this.fieldsFetched=$.Deferred(),this.masking=new C({appletId:this.model.get("integrationAppletId")}),this.model.get("integrationAppletId")?(this.fields=new E([],{appletId:this.model.get("integrationAppletId"),includeProperty:!0,type:"consumers"}),this.fields.fetch().done($.proxy(function(){this.fieldsFetched.resolve()},this)),this.masking.fetch()):(this.fieldsFetched.resolve(),this.masking.deferred.resolve()),this.docs=new w([],{type:"producerDocs",appletId:this.appletId,referAppletId:this.model.get("integrationAppletId"),fieldCid:this.model.get("integrationFieldCid"),fieldValueType:this.getIntegrationFieldValueType(this.model.get("integrationFieldCid"))||""}),this.docs.pageSize=10,this._initNameTag()},render:function(){this.$body.html(p({lang:O,model:this.model.toJSON(),label:t.util.escapeHtml(this.model.get("label")),clientId:this.clientId,inputValue:this._getInputValue(),isReadonly:this.isEditable(),"editable?":this.isEditable(),isMasking:this.isMasking()})),this.resizeWidth(this.model.get("width"),this.model.get("widthUnit")==="percent"?"%":this.model.get("widthUnit")),this.masking.deferred.done(e.bind(function(){var t=e.contains(this.masking.get("fieldCids"),this.model.get("integrationFieldCid"));t&&this.setMasking(!0),this.$("div.build_box_data").append(this.fieldNameTagView.el),this._renderNameTag()},this))},events:function(){return t.util.isMobile()?this.isEditable()?l.prototype.events:e.extend({},l.prototype.events,{"click a[el-button]":"_onClickButtonMobileType"}):this.isEditable()?l.prototype.events:e.extend({},l.prototype.events,{"click a[el-button]":"_onClickButton"})},validate:function(){if(!this.model.get("required"))return!0;var e=this.getDataFromView()[this.clientId].length>0;return e?!0:(this.printErrorTo("div:last",L["\ud544\uc218 \ud56d\ubaa9\uc785\ub2c8\ub2e4."]),!1)},_initNameTag:function(){var n={useAddButton:!1,className:"list_comp"};this.fieldNameTagView=t.util.isMobile()?new s(n):r.create([],n),this._renderNameTag(),this.fieldNameTagView.$el.on("nametag:removed",$.proxy(function(t,n){var r=this.fieldNameTagView.getNameTagList(),i={};this.appletDocModel.set(this.clientId,r),this._changeValue(r),e.isArray(r)&&r.length>0&&(i=r[0],i.appletId=this.model.get("integrationAppletId")),i.id?this._fetchAppletDocModel(i).done($.proxy(function(e){this.observer.trigger("applet_doc:removed",this.clientId,n,e.data,this.fields.toJSON())},this)):this.observer.trigger("applet_doc:removed",this.clientId,n,{},this.fields.toJSON())},this))},_renderNameTag:function(){this.fieldNameTagView.removeAll(),e.each(this.appletDocModel.get(this.clientId),function(e){var n=this.model.get("integrationFieldCid"),r=k.NUMBER===this.getIntegrationFieldValueType(n),s=r?"":e.text,o=!1,u="";if(r){s=e.text;var a=f.getInstance(this.viewType),l=a.getComponent(this.clientId),c=l.getIntegrationModel(),h=c.getPropertiesByIntegrationAppletId(this.clientId),p=h.dataType?h.dataType:"NUMBER";if(p=="PERCENT")t.util.isInvalidValue(s)?s="-":(o=!0,u=s,s='<span class="com_gage"><span class="wrap_gage"><span class="gage" id="percentGage" style="width:'+s+'%"></span></span><span class="txt">'+s+"%</span></span>");else if(p=="POINT")if(t.util.isInvalidValue(s))s="-";else{o=!0,u=s;var d='<span class="com_rate"><span class="wrap_rate">';for(i=0;i<h.maxLength;i++){var v=i<parseFloat(s)?"":"ic_star_off";d=d+'<ins style="cursor: default;" class="ic_star '+v+'"></ins>'}d+="</span></span>",s=d}else h.thousandComma&&(s=t.util.numberWithCommas(s)),h.fixType==="prefix"&&(s=h.unitText+" "+s),h.fixType==="postfix"&&(s=s+" "+h.unitText)}this.fieldNameTagView.addTag(e.id,s,{attrs:e,removable:!0,isTemplate:o,liCustomClass:o?"comp":"",templateText:u})},this),this.fieldNameTagView.$("li[data-id]").wrapInner('<span class="item_file"></span>'),this.isMasking()&&this.fieldNameTagView.$("span.item_file").html('<div class="hidden_data"><span class="help" title="'+O["\uad00\ub9ac\uc790\uc5d0 \uc758\ud574 \ub9c8\uc2a4\ud0b9 \ucc98\ub9ac \ub41c \ud56d\ubaa9\uc785\ub2c8\ub2e4"]+'"></span>'+"</div>")},_onClickButton:function(){this.integration=new x({appletId:this.appletId}),$.when(this.integration.fetch(),this.fieldsFetched).done($.proxy(function(){this._renderAppletDocSearch()},this))},_renderAppletDocSearch:function(){this.popupView=$.goPopup({pclass:"layer_normal layer_app_search",header:O["\ub370\uc774\ud130 \uac80\uc0c9"],buttons:[{btext:A["\ub2eb\uae30"],callback:$.proxy(function(){},this)}]});var t=new g({model:this.model,docs:this.docs,fieldsOfIntegrationApp:this.fields,integration:this.integration});this.popupView.find("div.content").html(t.render().el),this.popupView.on("onClickListItem",$.proxy(function(e,t){this._addDoc(t)},this)),t.on("rendered:appletDocSearch",e.bind(this.popupView.reoffset))},_onClickButtonMobileType:function(){this.integration=new x({appletId:this.appletId}),this.integration.fetch().done($.proxy(function(){this._renderMobileSearchRefer()},this))},_renderMobileSearchRefer:function(){var e=this.$(".txt_error");e.remove();var n=this.$(".btn_minor_s"),r=this.model.get("selectedDisplayFields").length>0,i=this.integration.getListAuthByCid(this.model.get("integrationAppletId"));if(!r||!i||!this.model.get("integrationAppletId"))this.model.get("integrationAppletId")?r?this.printErrorTo(n,t.i18n(O["\uc5f0\ub3d9 \uad8c\ud55c \uc124\uba85"])):this.printErrorTo(n,t.i18n(O["\uac80\uc0c9 \ub178\ucd9c \ud56d\ubaa9 \uc5c6\uc74c \uc124\uba85"])):this.printErrorTo(n,t.i18n(O["\uc5f0\ub3d9 \uc571 \uc5c6\uc74c \uc124\uba85"]));else{var s=this,o=new N({selectedDocs:this.fieldNameTagView.getNameTagList(),appletId:this.appletId,referModel:this.model,callbackAddDoc:function(e){s._addDocMobile(e),$(".go_wrap").show()},callbackCancel:function(){$(".go_wrap").show()}});$(".go_wrap").hide(),$("body").append(o.el),o.render()}},_addDoc:function(t){var n=this.fieldNameTagView.getNameTag(t.id).length;if(n){$.goMessage(A["\uc774\ubbf8 \ucd94\uac00\ub418\uc5b4 \uc788\uc2b5\ub2c8\ub2e4."]);return}var r=n?0:1,i=this.fieldNameTagView.$("li[data-id]").length,s=i+r>parseInt(this.model.get("maxCount")),o=this.model.get("integrationFieldCid");if(s){$.goError(O["\ucd5c\ub300 \uc120\ud0dd \uac1c\uc218\ub97c \ucd08\uacfc\ud558\uc600\uc2b5\ub2c8\ub2e4."]);return}var u=t.values[o]||"",a={id:t.id,text:e.isArray(u)?e.map(u,function(e){return e.text}):u},f=a.text,l="";if(k.NUMBER===this.getIntegrationFieldValueType(o)){var c=e.find(t.columnFields,function(e){return e.get("cid")==o});l=f,f=c.getDisplayValueContainsTemplate(new Backbone.Model(t),c.get("properties"))}var h=this.fieldNameTagView.addTag(a.id,f,{attrs:{id:a.id,text:f},removable:!0,isTemplate:!0,templateText:l});h.wrapInner('<span class="item_file"></span>'),this.isMasking()&&this.fieldNameTagView.$("span.item_file").html('<div class="hidden_data"><span class="help" title="'+O["\uad00\ub9ac\uc790\uc5d0 \uc758\ud574 \ub9c8\uc2a4\ud0b9 \ucc98\ub9ac \ub41c \ud56d\ubaa9\uc785\ub2c8\ub2e4"]+'"></span>'+"</div>");var p=this.appletDocModel.get(this.clientId)||[];p.push(a),this.appletDocModel.set(this.clientId,p),this._changeValue(p),this._fetchAppletDocModelAndNotify(t),$.goMessage(A["\ucd94\uac00\ub418\uc5c8\uc2b5\ub2c8\ub2e4."])},_getColumnFields:function(){var e=this.fields.getFields(this.model.get("selectedDisplayFields"));return e.filter(function(e){return this.fields.findWhere({cid:e.get("cid")})},this)},_addDocMobile:function(t){var n=this.model.get("integrationFieldCid"),r=this.fieldNameTagView.getNameTagList(),i=[];this.docs=new w(t,{type:"producerDocs",appletId:this.appletId,referAppletId:this.model.get("integrationAppletId"),fieldCid:this.model.get("integrationFieldCid"),columnFields:this._getColumnFields()}),e.each(r,function(e){this.fieldNameTagView.removeTag(e.id)},this),this.docs.each(function(t){var r=t.toJSON(),s=r.values[this.model.get("integrationFieldCid")]||"",o={id:r.id,text:e.isArray(s)?e.map(s,function(e){return e.text}):s},u=o.text,a="";if(k.NUMBER===this.getIntegrationFieldValueType(n)){var f=e.find(this.docs.columnFields,function(e){return e.get("cid")==n});a=u,u=f.getDisplayValueContainsTemplate(new Backbone.Model(r),f.get("properties"))}this.fieldNameTagView.addTag(o.id,u,{attrs:{id:o.id,text:o.text},removable:!0,isTemplate:!0,templateText:a}),this.isMasking()&&this.fieldNameTagView.$("span.item_file").html('<div class="hidden_data"><span class="help" title="'+O["\uad00\ub9ac\uc790\uc5d0 \uc758\ud574 \ub9c8\uc2a4\ud0b9 \ucc98\ub9ac \ub41c \ud56d\ubaa9\uc785\ub2c8\ub2e4"]+'"></span>'+"</div>"),i.push(o)},this),this.appletDocModel.set(this.clientId,i),this._changeValue(i);if(this.docs.length>0){var s=this.docs.first();this._fetchAppletDocModelAndNotify(s.toJSON())}},_fetchAppletDocModel:function(e){var n=new b({},{producerDocId:e.id,appletId:this.appletId,producerAppletId:e.appletId}),r=n.fetch();return t.util.preloader(r),r},_fetchAppletDocModelAndNotify:function(e){var t=this;this._fetchAppletDocModel(e).done(function(e){t.observer.trigger("applet_doc:add",t.clientId,e.data,t.fields.toJSON())})},_searchInputTmpl:function(){return Hogan.compile(['<input type="txt_mini" id="searchKeyword" class="txt_mini" />','<span class="btn_minor_s" id="searchBtn">','<span class="txt">{{lang.\uac80\uc0c9}}</span>',"</span>"].join("")).render({lang:O})},getDataFromView:function(){var t={};return t[this.clientId]=e.map(this.$("li"),function(e){return $(e).data("attrs")}),t},_getInputValue:function(){var e=this.appletDocModel.get(this.getCid()),t=this.model.get("defaultValue");return e&&e.length>0&&(t=e),t},getIntegrationFieldValueType:function(t){var n=e.find(this.model.get("selectedDisplayFields"),function(e){return e.cid==t},this);return n?n.valueType:""},fetchAppletDocModel:function(e){this._fetchAppletDocModelAndNotify(e)}}),P=c.extend({events:{"click span[data-integrat-doc]":"_onClickAppletItem"},initialize:function(e){e=e||{},c.prototype.initialize.call(this,e),this.masking=new C({appletId:this.model.get("integrationAppletId")}),this.model.get("integrationAppletId")?this.masking.fetch():this.masking.deferred.resolve()},render:function(){return this.$body.html(d({model:this.model.toJSON(),label:t.util.escapeHtml(this.model.get("label")),isMasking:this.isMasking(),iconTitle:L["\ub370\uc774\ud130 \uc5f0\ub3d9"]})),this.masking.deferred.done(e.bind(function(){var t=e.contains(this.masking.get("fieldCids"),this.model.get("integrationFieldCid"));t&&this.setMasking(!0),this._initNameTag()},this)),this},getTitle:function(){return e.map(this.appletDocModel.get(this.clientId),function(e){return e.text}).join(", ")},_onClickAppletItem:function(e){var t=$(e.currentTarget).closest("li[data-id]").data("attrs");this.$el.trigger("navigate:integrationDoc",{appletId:this.appletId,integrationAppletId:this.model.get("integrationAppletId"),integrationDocId:t.id})},_initNameTag:function(){this.fieldNameTagView=r.create([],{useAddButton:!1,className:"list_comp"}),this._renderNameTag(),this.$("div.build_box_data").append(this.fieldNameTagView.el)},_renderNameTag:function(){e.each(this.appletDocModel.get(this.clientId),function(e){var n=this.model.get("integrationFieldCid"),r=k.NUMBER===this.getIntegrationFieldValueType(n),s=r?"":e.text,o=!1,u="";if(r){s=e.text;var a=f.getInstance(this.viewType),l=a.getComponent(this.clientId),c=l.getIntegrationModel(),h=c.getPropertiesByIntegrationAppletId(this.clientId),p=h.dataType?h.dataType:"NUMBER";if(p=="PERCENT")t.util.isInvalidValue(s)?s="-":(o=!0,u=s,s='<span class="com_gage"><span class="wrap_gage"><span class="gage" id="percentGage" style="width:'+s+'%"></span></span><span class="txt">'+s+"%</span></span>");else if(p=="POINT")if(t.util.isInvalidValue(s))s="-";else{o=!0,u=s;var d='<span class="com_rate"><span class="wrap_rate">';for(i=0;i<h.maxLength;i++){var v=i<parseFloat(s)?"":"ic_star_off";d=d+'<ins class="ic_star '+v+'"></ins>'}d+="</span></span>",s=d}else h.thousandComma&&(s=t.util.numberWithCommas(s)),h.fixType==="prefix"&&(s=h.unitText+" "+s),h.fixType==="postfix"&&(s=s+" "+h.unitText)}this.fieldNameTagView.addTag(e.id,s,{attrs:e,removable:!1,isTemplate:o,liCustomClass:o?"comp":"",templateText:u})},this),this.fieldNameTagView.$("li[data-id]").wrapInner("<span data-integrat-doc></span>"),this.fieldNameTagView.$("li[data-id]").not(".comp").find("span.name").addClass("linkage"),this.fieldNameTagView.$("li[data-id]>span").attr("style","cursor: pointer"),this.isMasking()&&this.fieldNameTagView.$("span.item_file").html('<div class="hidden_data"><span class="help" title="'+O["\uad00\ub9ac\uc790\uc5d0 \uc758\ud574 \ub9c8\uc2a4\ud0b9 \ucc98\ub9ac \ub41c \ud56d\ubaa9\uc785\ub2c8\ub2e4"]+'"></span>'+"</div>")},getIntegrationFieldValueType:function(t){var n=e.find(this.model.get("selectedDisplayFields"),function(e){return e.cid===t},this);return n?n.valueType:""}}),H=u.define(o.AppletDocs,{name:O["\ub370\uc774\ud130 \uc5f0\ub3d9"],valueType:"APPLETDOCS",group:"extra",properties:{appletName:"",integrationAppletId:null,integrationFieldCid:"",selectedDisplayFields:[],maxCount:{defaultValue:10},label:{defaultValue:O["\ub370\uc774\ud130 \uc5f0\ub3d9"]},hideLabel:{defaultValue:!1},guide:{defaultValue:""},guideAsTooltip:{defaultValue:!0},required:{defaultValue:!1}},OptionView:_,FormView:D,DetailView:P});a.addComponent(H)});