define("works/models/base_filter_setting",function(require){var e=["AND","OR","NOT"],t=require("works/libs/filter_rule_validator"),n=Backbone.Collection.extend({initialize:function(){this.on("change",this._change,this),this.on("destroy",this._destroy,this)},_change:function(){this.trigger("changeChildModel")},_destroy:function(){this.trigger("destroyChildModel")}}),r=Backbone.Model.extend({defaults:{circle:{nodes:[]}}});return Backbone.Model.extend({defaults:{filters:[],rules:[]},initialize:function(e){e=e||{},this.appletId=e.appletId,this.baseFilters=new n,this.baseFilterGroups=new n({model:r}),this.baseFilters.on("changeChildModel",this._syncBaseFilters,this),this.baseFilters.on("destroyChildModel",this._syncBaseFilters,this),this.baseFilterGroups.on("changeChildModel",this._syncBaseFilterGroups,this),this.baseFilterGroups.on("destroyChildModel",this._syncBaseFilterGroups,this),this.on("sync",this._syncParentToChild,this)},url:function(){return GO.contextRoot+"api/works/applets/"+this.appletId+"/basefilters"},validate:function(){var n=[],r=null;return _.each(this.get("filters"),function(t){var i=t.name;if(!/^[\u3131-\u314e\uac00-\ud7a3a-zA-Z0-9]+$/.test(i))return r="filter.name.invalid",!1;if(!i||i.length<2||i.length>50)return r="filter.name.length",!1;if($.trim(i).indexOf(" ")>-1)return r="filter.name.blank",!1;if(_.contains(e,i.toUpperCase()))return r="filter.name.unused.char",!1;if(t.description&&t.description.length>200)return r="filter.description.length",!1;n.push(i)},this),_.each(this.get("rules"),function(e){var i=e.isDefault||!1;if(!i&&!e.rule)return r="rule.rule.null",!1;if(e.description&&e.description.length>200)return r="rule.description.length",!1;var s=new t(n,e.rule),o=s.evaluate();if(!o.validate)return r="rule.filterRule.invalid",!1},this),r},addBaseFilterItem:function(e){this.baseFilters.add(e),this._syncBaseFilters()},addBaseFilterGroupItem:function(e){this.baseFilterGroups.add(e),this._syncBaseFilterGroups()},_syncParentToChild:function(){this.baseFilters.reset(this.get("filters")),this.baseFilterGroups.reset(this.get("rules"))},_syncBaseFilters:function(){this.set("filters",this.baseFilters.toJSON())},_syncBaseFilterGroups:function(){this.set("rules",this.baseFilterGroups.toJSON())}},{getGroupModelInstance:function(){return new r}})});