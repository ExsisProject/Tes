define("works/components/formbuilder/form_components/formula/formula_util",function(require){var e=require("i18n!works/nls/works"),t=require("works/constants/value_type"),n={"\uc77c":e["\uc77c"],"\uc2dc\uac04":e["\uc2dc\uac04"],"\ubd84":e["\ubd84"]},r=function(e){var t=e>=0?!0:!1,n=Math.abs(e),r=n/864e5,i=Math.floor(r),s=(n-i*864e5)/36e5,o=Math.floor(s),u=Math.floor((n-i*864e5-o*36e5)/6e4);return{day:i,hour:o,minute:u,isPositive:t}},i=function(e){var t="";return e.hour==0?t=e.minute+n["\ubd84"]:e.minute==0?t=e.hour+n["\uc2dc\uac04"]:t=e.hour+n["\uc2dc\uac04"]+" "+e.minute+n["\ubd84"],e.isPositive||(t="-"+t),t},s=function(e){var t="";return e.hour==0&&e.minute==0?t=e.day+n["\uc77c"]:e.day==0&&e.minute==0?t=e.hour+n["\uc2dc\uac04"]:e.day==0&&e.hour==0?t=e.minute+n["\ubd84"]:e.day!=0&&e.hour!=0&&e.minute==0?t=e.day+n["\uc77c"]+" "+e.hour+n["\uc2dc\uac04"]:e.day==0&&e.hour!=0&&e.minute!=0?t=e.hour+n["\uc2dc\uac04"]+" "+e.minute+n["\ubd84"]:t=e.day+n["\uc77c"]+" "+e.hour+n["\uc2dc\uac04"]+" "+e.minute+n["\ubd84"],e.isPositive||(t="-"+t),t},o=function(e){try{var t=e.split(":"),n=parseInt(t[0])*60+parseInt(t[1]);return n}catch(r){return NaN}},u=function(e,n,r){if(t.DATE==n)if(_.isString(e)&&e.length>0){var i=new Date(e.substring(0,4),e.substring(4,6)-1,e.substring(6,8));val=parseInt(i.getTime())}else val=NaN;else if(t.TIME==n)e&&e.length>0?val=o(e):val=parseInt(e);else if(t.DATETIME==n)if(_.isString(e)&&e.length>0){var i=new Date(e);val=parseInt(i.getTime())}else moment.isMoment(e)?val=parseInt(e.toDate().getTime()):val=NaN;else val=r.dataType=="PERCENT"?e/100:e},a=function(e){var t=Array.prototype.slice.call(arguments,1);return function(){var n=function(){},r,i;return n.prototype=e.prototype,r=new n,i=e.apply(r,t),Object(i)===i?i:r}},f=function(e,t){var n="return "+(t?t:"void(0)")+";",r;e.unshift(Function),e.push(n);try{return r=a.apply(undefined,e),r()}catch(i){return function(){}}},o=function(e){try{var t=e.split(":"),n=parseInt(t[0])*60+parseInt(t[1]);return n}catch(r){return NaN}},l=function(e){var n=[];return _.each(e,function(e){var r=e.valueType,i=e.value,s;if(t.DATE==r)if(_.isString(i)&&i.length>0){var u=new Date(i.substring(0,4),i.substring(4,6)-1,i.substring(6,8));s=parseInt(u.getTime())}else s=NaN;else if(t.TIME==r)i&&i.length>0?s=o(i):s=parseInt(i);else if(t.DATETIME==r)if(_.isString(i)&&i.length>0){var u=new Date(i);s=parseInt(u.getTime())}else moment.isMoment(i)?s=parseInt(i.toDate().getTime()):s=NaN;else{var a=parseFloat(i);s=e.multiple?i:e.dataType=="PERCENT"?a/100:a}_.isNumber(s)||(s=null),n.push(s)},this),n};return{dayToMinuteForDayFormula:function(e){var t=e>=0?!0:!1,n=Math.abs(e),r=n/6e4,i=Math.floor(r);return t?i:i*-1},timeToMinuteForDayFormula:function(e){var t=r(e),n=(t.day*24+t.hour)*60+t.minute;return t.isPositive?n:n*-1},timeToTimeDisplayText:function(e){var t=e>=0?!0:!1,n=Math.abs(e),r=parseInt(n/60),s=parseInt(n%60),o={hour:r,minute:s,isPositive:t};return i(o)},dateTimeToTimeDisplayText:function(e){var t=r(e);return t.hour=t.day*24+t.hour,t.day=0,i(t)},dateTimeToDayDisplayText:function(e){return s(r(e))},convertValueList:function(e,t,n){return u(e,t,n)},getExpressionCodes:function(e){var t=/[\+\*\-\%\/\(\)]/gi,n=_.compact(e.split(t));return _.map(n,function(e){return e.replace(/ /gi,"")})},getFormulaValue:function(e,n,r){var i=e.dateValueType,s=e.expressionType,o=e.expression,u=e.decimalPoints,a=f(n,o),c=a.apply(null,l(r));return c?(!i==t.TIME&&!s=="day"&&!s=="time"&&(c=GO.util.fixFloatingPoint(c,u)),c):""}}});