define("works/views/app/report/report_item_chart",function(require){var e=require("works/views/app/report/report_item"),t=require("works/views/app/report/works_report_filter"),n=require("works/components/chart/models/chart_setting"),r=require("works/components/report/view/chart_setting"),i=require("works/components/report/view/chart"),s=require("works/components/filter/models/filter_condition"),o=require("works/components/filter/collections/filter_conditions"),u=require("hgn!works/components/report/template/item_empty_preview"),a=require("i18n!works/nls/works"),f={"\ub9ac\ud3ec\ud2b8 \uc544\uc774\ud15c \ucef4\ud3ec\ub10c\ud2b8 \uc0ad\uc81c \uacbd\uace0":a["\ub9ac\ud3ec\ud2b8 \uc544\uc774\ud15c \ucef4\ud3ec\ub10c\ud2b8 \uc0ad\uc81c \uacbd\uace0"]};return e.extend({initialize:function(t){e.prototype.initialize.call(this,t),this.type="chart",this.chartView={},this.appletId=t.appletId,this.fields=t.fields,this.chartFields=this.fields.getChartFields(),this.numberFields=this.fields.getNumberFields(),this.chartOption=this.chartFields.length?{fieldCid:this.chartFields.at(0).get("cid")}:{},this.conditions=new o,this.contentWrap=$(t.contentWrap),t.chartModel?this.chartModel=t.chartModel:(this.chartOption.title=a["\uc0c8 \ucc28\ud2b8"],this.chartModel=new n(this.chartOption))},render:function(){if(this._isValidComponent()){this._setChartsView();return}this._setEmptyView()},_setChartsView:function(e){this.chartView=new i({model:this.chartModel,appletId:this.appletId,chartFields:this.chartFields,numberFields:this.numberFields,useToolbox:!1}),this.contentWrap.empty(),this.contentWrap.append(this.chartView.el),this.chartView.render(),this.chartView._fetchChartData()},_setEmptyView:function(){this.contentWrap.empty(),this.contentWrap.append(u({lang:f}))},reload_setting:function(){return this.chartSettingView.isValid()?(this.chartSettingView.save(),this._setChartsView(),!0):!1},reload_filter:function(){return this.conditions=this.filterView._getConditions(),this.chartModel.setQueryString(this.filterView._getFilterQuery()),this.chartView._fetchChartData(),!0},getSettingTmpl:function(){return this.chartSettingView=new r({chartFields:this.chartFields,numberFields:this.numberFields,model:this.chartModel,appletId:this.appletId}),this.chartSettingView.render().el},getFilterTmpl:function(){var e=_.map(this.conditions.toJSON(),function(e){return e.fieldCid});return _.each(this.fields.toArray(),function(t){t.set("isUsed",e.includes(t.get("cid")))}),this.filterView=new t({conditions:this.conditions.clone(),fields:this.fields}),this.conditions=this.filterView._getConditions(),this.filterView.render().el},_reloadField:function(){this.chartFields=this.fields.getChartFields(),this.numberFields=this.fields.getNumberFields(),this.chartOption=this.chartFields.length?{fieldCid:this.chartFields.at(0).get("cid")}:{},this.chartModel=new ChartSetting(this.chartOption)},_isValidComponent:function(){var e=this.chartModel.get("aggCid");if(e&&!this.chartFields.findByCid(e))return!1;var t=this.chartModel.get("groupByCid");if(t&&!this.chartFields.findByCid(t))return!1;var n=this.chartModel.get("subGroupByCid");return n&&!this.chartFields.findByCid(n)?!1:!0},toJSON:function(){return{chartModel:this.chartModel.attributes,conditions:this.conditions.toJSON(),type:this.type}},toObject:function(e){this.chartModel=new n(e.data.chartModel),this.conditions=new o,this.chartModel.appletId=this.appletId;for(var t=0;t<e.data.conditions.length;t++)this.conditions.push(new s(e.data.conditions[t]))}})});