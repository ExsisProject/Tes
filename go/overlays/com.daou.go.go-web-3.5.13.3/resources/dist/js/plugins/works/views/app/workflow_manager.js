define("works/views/app/workflow_manager",function(require){function b(){var e=this,n=t.defer();return this.model.fetch({success:function(){e.stats=new o(e.model.get("statuses")),e.flows=new s(e.model.get("transitions")),e.template=e.model.get("template"),e.flows.addFirstFlow(e.stats.firstFlow().get("name"),e.model.get("addPushes")),n.resolve()},error:n.reject}),n.promise}function w(){t(x.call(this)).then(_.bind(b,this)).then(_.bind(T,this)).then(_.bind(function(){p.checkAppManager(this.baseConfigModel.get("admins")),E.call(this),this.$el.html(l({lang:m,useProcess:this.model.get("useProcess"),baseConfigModel:this.baseConfigModel.toJSON()}));var t=new r({baseConfigModel:this.baseConfigModel,pageName:d["\ud504\ub85c\uc138\uc2a4 \uad00\ub9ac"],useActionButton:!0,infoDesc:m.infoDesc});t.setElement(this.$("#worksContentTop")),t.render(),_mxGraph=new f,_mxGraph.render(),_mxGraph.drawJsonData(this.stats.toJSON(),this.flows.transitions().toJSON(),this.template,this.flows.at(0).toJSON(),y),self.$("#notUseProcess").trigger("change")},this)).otherwise(function(t){console.log(t.stack)})}function E(){y=[],y=y.concat(g);var e=_.where(this.fields.toJSON(),{fieldType:"org"});e.length>0&&(y=y.concat(_.map(e,function(e){return{value:e.cid,lang:e.label}})))}function S(){return t(this.layoutView.render()).then(this.layoutView.setContent(this))}function x(){var e=t.defer();return this.baseConfigModel.fetch({success:e.resolve,error:e.reject}),e.promise}function T(){var e=t.defer();return this.fields.fetch({success:e.resolve,error:e.reject}),e.promise}var e=require("backbone"),t=require("when"),n=require("works/views/app/home/works_home_layout"),r=require("works/views/app/layout/manage_content_top"),i=require("works/models/applet_baseconfig"),s=require("works/collections/workflow_flows"),o=require("works/collections/workflow_stats"),u=require("works/models/workflow_manager"),a=require("works/collections/fields"),f=require("works/views/app/workflow_graph"),l=require("hgn!works/templates/app/workflow_manager"),c=require("i18n!task/nls/task"),h=require("i18n!admin/nls/admin"),p=require("works/libs/util"),d=require("i18n!works/nls/works"),v=require("i18n!nls/commons"),m={ADMIN:c["\uc6b4\uc601\uc790"],REGISTRANT:c["\ub4f1\ub85d\uc790"],tagRequired:d["\uc0c1\ud0dc\uc0ac\uc6a9\uc548\ud568"],"\uc0c1\ud0dc\uad00\ub9ac":d["\uc0c1\ud0dc\uad00\ub9ac"],"\uc0c1\ud0dc\uad00\ub9ac \uc548\ub0b4\ubb38\uad6c3":d["\uc0c1\ud0dc\uad00\ub9ac \uc548\ub0b4\ubb38\uad6c3"],add:v["\ucd94\uac00"],statusName:h["\uc0c1\ud0dc\uba85"],completionStatus:h["\uc644\ub8cc \uc0c1\ud0dc"],destroy:v["\uc0ad\uc81c"],"\uc0c1\ud0dc":h["\uc0c1\ud0dc"],"\ucd94\uac00":h["\ucd94\uac00"],"\uc0c1\ud0dc \ud750\ub984":d["\uc0c1\ud0dc \ud750\ub984"],"\uc0c1\ud0dc \ud750\ub984 \uc124\uba85":d["\uc0c1\ud0dc \ud750\ub984 \uc124\uba85"],startStatus:h["\uc2dc\uc791 \uc0c1\ud0dc"],nextStatus:h["\ub2e4\uc74c \uc0c1\ud0dc"],statusModifierButton:d["\uc0c1\ud0dc\ubcc0\uacbd \ubc84\ud2bc\uba85"],statusModifiers:h["\uc0c1\ud0dc \ubcc0\uacbd\uc790"],notificationTarget:h["\uc0c1\ud0dc \ubcc0\uacbd \uc54c\ub9bc\ub300\uc0c1"],administration:v["\uad00\ub9ac"],regist:v["\uc800\uc7a5"],cancel:v["\ucde8\uc18c"],gosettinghome:d["\uad00\ub9ac \ud648\uc73c\ub85c \uc774\ub3d9"],goapphome:d["\ud574\ub2f9 \uc571\uc73c\ub85c \uc774\ub3d9"],infoDesc:d["\ud504\ub85c\uc138\uc2a4 \uad00\ub9ac \uc124\uba85"],color:v["\uc0c9\uc0c1"],"\uc218\uc815 \uc54c\ub9bc \ub300\uc0c1 \uc124\uba85":d["\uc218\uc815 \uc54c\ub9bc \ub300\uc0c1 \uc124\uba85"],"\uc0c1\ud0dc\uba85\uc744 \uc785\ub825\ud558\uc138\uc694.":d["\uc0c1\ud0dc\uba85\uc744 \uc785\ub825\ud558\uc138\uc694."],"\uc0c1\ud0dc \uc21c\uc11c \ubcc0\uacbd":d["\uc0c1\ud0dc \uc21c\uc11c \ubcc0\uacbd"]},g=[{value:"ADMIN",lang:m.ADMIN},{value:"REGISTRANT",lang:m.REGISTRANT}],y=[];return e.View.extend({_mxGraph:null,flows:null,stats:null,template:null,className:"go_content go_renew go_works_home app_temp",events:{"click #flowView, #statSection_2 #statTable":"beforeElementClick","click #btnAddStat":"addStat","click #btn-confirm":"onSave","click #btn-cancel":"onCancel","change #notUseProcess":"toggleByNotUseProcessFlag","click #btn-gosettinghome":"gosettinghome","click #btn-goapphome":"goapphome","click #goAppHomeNav":"goapphome","click #goSettingHomeNav":"gosettinghome"},initialize:function(e){e=e||{},this.layoutView=n.create(),e.hasOwnProperty("appletId")&&(this.model=new u({id:this.options.appletId}),this.baseConfigModel=new i(e.hasOwnProperty("appletId")?{id:e.appletId}:null),this.fields=new a([],{appletId:e.appletId}));if(!mxClient.isBrowserSupported()){mxUtils.error("Browser is not supported!",200,!1);return}},render:function(){return t(S.call(this)).then(_.bind(w,this)).otherwise(function(t){console.log(t.stack)})},beforeElementClick:function(){var e=$("#notUseProcess").is(":checked");if(e)return $.goError(d["\uc0c1\ud0dc\ub97c \uc0ac\uc6a9\ud558\uc9c0 \uc54a\uc744 \uacbd\uc6b0 \uc218\uc815\ud560\uc218 \uc5c6\uc2b5\ub2c8\ub2e4."]),!1},toggleByNotUseProcessFlag:function(e){var t=$(e.target).is(":checked");t?(this.$("#flowView, #statSection_1, #statSection_2").find("input, select").prop("disabled",!0).addClass("disabled").end().find("span.chip").css("cursor","default").end().find("span.wrapBtn").hide(),this.$("#btnAddStat").hide(),this.$("#statTable").sortable(),this.$("#addStatName").attr("disabled",!0),this.$("div.wrap_process").css("opacity","0.5"),_mxGraph.disabled()):(this.$("#flowView, #statSection_1, #statSection_2").find("input, select").prop("disabled",!1).removeClass("disabled").end().find("span.chip").css("cursor","pointer").end().find("span.wrapBtn").show(),this.$("#btnAddStat").show(),this.$("#statTable").sortable(),this.$("#addStatName").attr("disabled",!1),this.$("div.wrap_process").css("opacity",""),_mxGraph.enabled())},addStat:function(){var t=this.$("#addStatName"),n=t.val();if(!$.goValidation.isCheckLength(2,20,n)){$.goError(GO.i18n(v["0\uc790\uc774\uc0c1 0\uc774\ud558 \uc785\ub825\ud574\uc57c\ud569\ub2c8\ub2e4."],{arg1:"2",arg2:"20"}),t,!1,!1),t.focus();return}var r=new e.Model({name:n,color:0});_mxGraph.addStat(r.toJSON())&&t.val("")},onSave:function(e){e.preventDefault();if(!_mxGraph.isValidData())return;var t={statuses:_mxGraph.getStats(),addPushes:_mxGraph.getFirstFlow(),template:JSON.stringify(_mxGraph.getTemplate()),useProcess:!$("#notUseProcess").is(":checked"),transitions:_mxGraph.getTransitions()};if(!this.validate(t))return;this.model.set(t),this.model.save({},{success:function(){$.goMessage(v["\uc800\uc7a5\ub418\uc5c8\uc2b5\ub2c8\ub2e4."])},error:function(e,t){$.goError(t.responseJSON.message)}})},onCancel:function(e){var t=this;e.preventDefault(),$.goConfirm(v["\ucde8\uc18c\ud558\uc2dc\uaca0\uc2b5\ub2c8\uae4c?"],v["\uc785\ub825\ud558\uc2e0 \uc815\ubcf4\uac00 \ucd08\uae30\ud654\ub429\ub2c8\ub2e4."],function(){w.call(t)})},gosettinghome:function(){p.goSettingHome(this.model.get("id"))},goapphome:function(){p.goAppHome(this.model.get("id"))},readyValidate:function(){this.$(".go_error, p.caution").remove(),this.$(".error").removeClass("error")},validate:function(e){this.readyValidate();var t=!0;return e.useProcess&&e.statuses.length<1?($.goError(d["\uc0c1\ud0dc\ub294 1\uac1c \uc774\uc0c1 \ubc18\ub4dc\uc2dc \uc124\uc815\ud574\uc57c\ud569\ub2c8\ub2e4."]),t=!1,t):t},goError:function(e,t,n,r){var i=t?!1:!0;if(n)return $(t).siblings("p").remove(),!1;if(i)$.goSlideMessage(e,"caution");else{var s=['<p class="desc caution">',e,"</p>"],o=s.join("");r&&(o=$(o).delay(3e3).fadeOut(500,function(){$(this).remove()})),$(t).siblings("p").remove().end().after(o)}}})});