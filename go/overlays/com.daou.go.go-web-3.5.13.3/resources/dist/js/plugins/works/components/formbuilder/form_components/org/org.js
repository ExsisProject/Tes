define("works/components/formbuilder/form_components/org/org",function(require){var e=require("app"),t=require("works/component_type"),n=require("works/components/formbuilder/core/form_component"),r=require("works/components/formbuilder/core/component_registry"),i=require("works/components/formbuilder/core/views/base_form"),s=require("works/components/formbuilder/core/views/base_detail"),o=require("works/components/formbuilder/core/views/base_option"),u=require("hgn!works/components/formbuilder/form_components/org/form"),a=require("hgn!works/components/formbuilder/form_components/org/detail"),f=require("hgn!works/components/formbuilder/form_components/org/option"),l=require("views/mobile/m_org"),c=require("works/libs/util"),h=require("go-nametags"),p=require("i18n!works/nls/works"),d=require("i18n!nls/commons");require("jquery.go-orgslide");var v=30,m={"\uc774\ub984":d["\uc774\ub984"],"\uc124\uba85":p["\uc124\uba85"],"\uc774\ub984\uc744 \uc785\ub825\ud574\uc8fc\uc138\uc694":p["\uc774\ub984\uc744 \uc785\ub825\ud574\uc8fc\uc138\uc694."],"\uc124\uba85\uc744 \uc785\ub825\ud574\uc8fc\uc138\uc694":p["\uc124\uba85\uc744 \uc785\ub825\ud574\uc8fc\uc138\uc694."],"\ud234\ud301\uc73c\ub85c \ud45c\ud604":p["\ud234\ud301\uc73c\ub85c \ud45c\ud604"],"\ud544\uc218 \uc785\ub825 \ucef4\ud3ec\ub10c\ud2b8":p["\ud544\uc218 \uc785\ub825 \ucef4\ud3ec\ub10c\ud2b8"],"\uae30\ubcf8\uac12":p["\uae30\ubcf8\uac12"],"\uc138\ubd80\ud56d\ubaa9":p["\uc138\ubd80\ud56d\ubaa9"],"\ucd94\uac00":d["\ucd94\uac00"],"\uc0ad\uc81c":d["\uc0ad\uc81c"],"\uc774\ub984\uc228\uae30\uae30":p["\uc774\ub984\uc228\uae30\uae30"],"\uc0ac\uc6a9\uc790 \uc120\ud0dd \ud5c8\uc6a9 \uc218":p["\uc0ac\uc6a9\uc790 \uc120\ud0dd \ud5c8\uc6a9 \uc218"],"\uc81c\ud55c \uc5c6\uc74c":p["\uc81c\ud55c \uc5c6\uc74c"],"\uae30\ubcf8 \uac12 \uc9c0\uc815":p["\uae30\ubcf8 \uac12 \uc9c0\uc815"],"\ub4f1\ub85d\uc790\ub97c \uae30\ubcf8\uac12\uc73c\ub85c \uc9c0\uc815":p["\ub4f1\ub85d\uc790\ub97c \uae30\ubcf8\uac12\uc73c\ub85c \uc9c0\uc815"],"\uc0ac\uc6a9\uc790 \ucd5c\ub300\uac12":e.i18n(p["\ucd5c\ub300 {{arg}}\uba85\uae4c\uc9c0 \uc124\uc815 \uac00\ub2a5"],"arg",v)},g=o.extend({customEvents:{"keypress input[name=allowMemberCount]":"replaceNumber","focusout input[name=allowMemberCount]":"_setAllowMemberCount"},replaceNumber:function(e){var t=e.keyCode?e.keyCode:e.which;if(!c.isNumber(t)){var n=$(e.currentTarget).val().replace(/[^0-9]/gi,"");return $(e.currentTarget).val(n),e.preventDefault(),!1}},_setAllowMemberCount:function(e){var t=$(e.currentTarget);!t.val()||parseInt(t.val())<1?(this.model.set(t.attr("name"),1),t.val(1)):parseInt(t.val())>v?(this.model.set(t.attr("name"),v),t.val(v)):(this.model.set(t.attr("name"),parseInt(t.val())),t.val(parseInt(t.val())))},onAddMembers:function(e){var t=_.isArray(e)?e:[e];_.each(t,function(e){var t=e.position?e.name+" "+e.position:e.name;this.nameTag.addTag(e.id,t,{attrs:e,removable:!0})},this),this.model.set("members",this.nameTag.getNameTagList())},renderBody:function(){var t=this;this.$el.html(f({model:this.model.toJSON(),lang:m})),this.nameTag=h.create({},{useAddButton:!0}),this.$("div[name='nameTagArea']").html(this.nameTag.el),_.each(this.model.get("members"),function(e){var n=e.position?e.name+" "+e.position:e.name;t.nameTag.addTag(e.id,n,{attrs:e,removable:!0})},this),this.nameTag.$el.on("nametag:clicked-add",function(){$.goOrgSlide({header:p["\uc0ac\uc6a9\uc790 \ucd94\uac00"],type:"node",isBatchAdd:!0,externalLang:d,desc:"",contextRoot:e.config("contextRoot"),callback:_.bind(t.onAddMembers,t)})}),this.nameTag.$el.on("nametag:removed",$.proxy(this.onRemoveMember,this))},onRemoveMember:function(e,t){var n=new Backbone.Collection(this.model.get("members")),r=n.findWhere({id:t});n.remove(r),this.model.set("members",n.toJSON())}}),y=i.extend({render:function(){this.$body.html(u({model:this.model.toJSON(),label:e.util.escapeHtml(this.model.get("label")),lang:m})),e.config("isMobileApp")&&this.setAppCallBack(),this.initRender()},setAppCallBack:function(){var e=this,t="addSuccess"+this.clientId;window[t]=function(t){var n=JSON.parse(t);_.each(e.nameTag.getNameTagList(),function(t){e.nameTag.removeTag(t.id)},e),e.onAddMembers(n)}},initRender:function(){var t=this;this.nameTag=h.create({},{useAddButton:!0}),this.$("div[name='nameTagArea']").html(this.nameTag.el),this.isEditable()||(this.nameTag.$el.on("nametag:clicked-add",function(){e.util.isMobile()?t.mobileNametTagCallback():t.namtTagCallback()}),this.nameTag.$el.on("nametag:removed",$.proxy(this.onRemoveMember,this))),this.addCurrentMemberByOption(),_.each(this._getMembers(),function(e){var t=e.position?e.name+" "+e.position:e.name;t&&this.nameTag.addTag(e.id,t,{attrs:e,removable:!this.isEditable()})},this),this.appletDocModel.set(this.getDataFromView())},mobileNametTagCallback:function(){var t=this,n=_.map(t.nameTag.getNameTagList(),function(e){return{id:e.id,username:e.name,position:e.position}});e.config("isMobileApp")?c.callOrg(t.clientId,n):(e.router.navigate(e.router.getUrl()+"#org",{trigger:!1,pushState:!0}),this.orgView=new l({}),this.orgView.render({title:p["\uc0ac\uc6a9\uc790 \ucd94\uac00"],checkedUser:n,callback:function(e){return _.each(t.nameTag.getNameTagList(),function(e){t.nameTag.removeTag(e.id)},t),t.onAddMembers(e),!1}}),e.EventEmitter.trigger("common","layout:scrollToTop",this))},namtTagCallback:function(){var t=this;$.goOrgSlide({header:p["\uc0ac\uc6a9\uc790 \ucd94\uac00"],type:"node",isBatchAdd:!0,externalLang:d,desc:"",contextRoot:e.config("contextRoot"),callback:_.bind(t.onAddMembers,t)})},addCurrentMemberByOption:function(){if(this.model.get("useDefaultRegister")&&!this.isEditable()&&!this.appletDocModel.id){var t=e.session("id"),n=e.session().name+" "+e.session().position;this.nameTag.addTag(t,n,{attrs:e.session(),removable:!0})}},_getMembers:function(){var e=this.appletDocModel.get(this.getCid());return this.appletDocModel.id||e?e?_.isArray(e)?e:[e]:e:this.model.get("members")},validate:function(){var t=this.$('div[name="nameTagArea"]'),n=this.nameTag.getNameTagList();return this.model.get("required")&&n.length<1?(this.printErrorTo(t,p["\ud544\uc218 \ud56d\ubaa9\uc785\ub2c8\ub2e4."]),!1):n.length>this.model.get("allowMemberCount")?(this.printErrorTo(t,e.i18n(p["\ucd5c\ub300 {{arg}}\uba85\uae4c\uc9c0 \uc124\uc815\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4"],"arg",this.model.get("allowMemberCount"))),!1):n.length>v?(this.printErrorTo(t,e.i18n(p["\ucd5c\ub300 {{arg}}\uba85\uae4c\uc9c0 \uc124\uc815\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4"],"arg",v)),!1):!0},getDataFromView:function(){var e={};return e[this.clientId]=this.nameTag?this.nameTag.getNameTagList():"",e},onAddMembers:function(e){var t=_.isArray(e)?e:[e];_.each(t,function(e){var t=e.position?e.name+" "+e.position:e.name;this.nameTag.addTag(e.id,t,{attrs:e,removable:!0})},this),this.appletDocModel.set(this.getDataFromView())},onRemoveMember:function(){this.appletDocModel.set(this.getDataFromView())},_getDefaultValue:function(){var t=this.model.get("members")||[];return this.model.get("useDefaultRegister")&&t.push(e.session()),t}}),b=s.extend({render:function(){var t=_.each(this.appletDocModel.get(this.clientId),function(e){e.displayName=e.position?e.name+" "+e.position:e.name});this.$body.html(a({model:this.model.toJSON(),userData:t,label:e.util.escapeHtml(this.model.get("label")),"isMobile?":e.util.isMobile(),lang:m}))},getTitle:function(){var e=this.appletDocModel.get(this.clientId)||[],t=_.each(e,function(e){e.displayName=e.position?e.name+" "+e.position:e.name});return t.length<1?"":_.pluck(this.appletDocModel.get(this.clientId),"displayName").join(", ")}}),w=n.define(t.Org,{type:"org",name:p["\uc0ac\uc6a9\uc790 \uc120\ud0dd"],valueType:"USERS",group:"basic",properties:{label:{defaultValue:p["\uc0ac\uc6a9\uc790 \uc120\ud0dd"]},hideLabel:{defaultValue:!1},guide:{defaultValue:""},guideAsTooltip:{defaultValue:!0},required:{defaultValue:!1},noLimit:{defaultValue:!0},useDefaultRegister:{defaultValue:!1},allowMemberCount:{defaultValue:"1"},members:{defaultValue:[]}},OptionView:g,FormView:y,DetailView:b});r.addComponent(w)});