(function(){define(["jquery","backbone","app","hgn!community/templates/master_update","community/models/update","community/views/side_members","community/views/side2","community/models/info","i18n!nls/commons","i18n!community/nls/community","jquery.go-validation"],function(e,t,n,r,i,s,o,u,a,f){var l={common_save:a["\uc800\uc7a5"],common_cancel:a["\ucde8\uc18c"],community_name:a["\uc774\ub984"],community_desc:f["\uc18c\uac1c"],community_master:f["\ub9c8\uc2a4\ud130"],community_manager:f["\ubd80\ub9c8\uc2a4\ud130"],community_add:a["\ucd94\uac00"],community_modify:a["\ubcc0\uacbd"],community_share:f["\uacf5\uc720"],community_public:f["\uacf5\uac1c"],community_private:a["\ube44\uacf5\uac1c"],community_publicflag:f["\uacf5\uac1c\uc5ec\ubd80"],"delete":a["\uc0ad\uc81c"]},c=t.View.extend({manage:!1,unbindEvent:function(){this.$el.off("click","#btnCancel"),this.$el.off("click","#btnSave")},bindEvent:function(){this.$el.on("click","#btnSave",e.proxy(this.communityUpdate,this)),this.$el.on("click","#btnCancel",e.proxy(this.updateCancel,this))},initialize:function(e){this.options=e||{},this.unbindEvent(),this.bindEvent(),this.communityId=this.options.communityId,this.model=new i},render:function(){this.$el.empty();var t=u.read({communityId:this.communityId}).toJSON();t.memberType!="MASTER"&&t.memberType!="MODERATOR"&&(n.router.navigate("community/"+this.communityId,{trigger:!0,pushState:!0}),e.goAlert(f["\uc811\uadfc \ud560 \uc218 \uc5c6\ub294 \uba54\ub274\uc785\ub2c8\ub2e4."],f["\ub9c8\uc2a4\ud130, \ubd80\ub9c8\uc2a4\ud130 \uad8c\ud55c\uc774 \ud544\uc694\ud569\ub2c8\ub2e4."]));var i=this.model.read({communityId:this.communityId}).toJSON();this.$el.html(r({model:i,isMaster:function(){var e=i.masters.length>0?!0:!1;return e&&GO.session().id==i.masters[0].userId},lang:l})),i.description==""&&e("#modifyDesc").text(f["\ucee4\ubba4\ub2c8\ud2f0 \uc124\uba85\uc744 \uc785\ub825\ud574\uc8fc\uc138\uc694"])},communityUpdate:function(t){var r=e("#content").find(".tab_menu").attr("data-id"),u=this,f=this.$el.find("form[name=formUpdateCommunity]"),l=[],c=f.find('input[name="name"]'),h=f.find('[name="description"]');this.model=new i,e.each(f.serializeArray(),function(e,t){t.name=="managerId"?l.push(t.value):u.model.set(t.name,t.value,{silent:!0})});var p=function(t,n){return e.goMessage(t),n&&n.focus().addClass("error"),!1};if(!e.goValidation.isCheckLength(2,32,this.model.get("name")))return p(n.i18n(a["0\uc790\uc774\uc0c1 0\uc774\ud558 \uc785\ub825\ud574\uc57c\ud569\ub2c8\ub2e4."],{arg1:"2",arg2:"32"}),c),!1;if(!e.goValidation.isCheckLength(0,124,this.model.get("description")))return p(n.i18n(a["0\uc790\uc774\uc0c1 0\uc774\ud558 \uc785\ub825\ud574\uc57c\ud569\ub2c8\ub2e4."],{arg1:"0",arg2:"124"}),h),!1;this.model.set({id:r,managerIds:l},{silent:!0}),this.model.save({},{success:function(t,n){if(n.code=="200"){s.render(r),u.render();var i=new o;i.render(r),e("#sideNav").empty(),i.renderInfo(r),e("#title").text(n.data.name),e.goMessage(a["\uc800\uc7a5\ub418\uc5c8\uc2b5\ub2c8\ub2e4."])}},error:function(t,n){n.msg?e.goAlert(n.msg):n.responseJSON&&n.responseJSON.message&&e.goAlert(n.responseJSON.message),n.focus&&f.find('input[name="'+n.focus+'"]').focus()}})},updateCancel:function(){var t=this;e.goConfirm(a["\ucde8\uc18c\ud558\uc2dc\uaca0\uc2b5\ub2c8\uae4c?"],a["\uc785\ub825\ud558\uc2e0 \uc815\ubcf4\uac00 \ucd08\uae30\ud654\ub429\ub2c8\ub2e4."],function(){t.render()})}});return{render:function(e){var t=new c({el:".tab_conent_wrap",communityId:e});return t.render()}}})}).call(this);