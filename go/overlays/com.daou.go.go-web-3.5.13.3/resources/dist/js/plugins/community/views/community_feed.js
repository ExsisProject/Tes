(function(){define(["jquery","backbone","app","community/collections/myfeeds","hgn!community/templates/community_feed","hgn!community/templates/feed_list_more","hgn!community/templates/community_user_null","i18n!nls/commons","i18n!community/nls/community","i18n!board/nls/board","jquery.go-grid","jquery.go-preloader"],function(e,t,n,r,i,s,o,u,a,f){var l={joincommunity:a["\uac00\uc785 \ucee4\ubba4\ub2c8\ud2f0"],community_name:a["\ucee4\ubba4\ub2c8\ud2f0 \uba85"],search:u["\uac80\uc0c9"],community:u["\ucee4\ubba4\ub2c8\ud2f0"],all_post:a["\uc804\uccb4 \uae00"],community_member:a["\ud68c\uc6d0"],new_post:a["\uc0c8 \uae00 \ub4f1\ub85d"],thumnail:a["\ucd08\uc0c1\ud654"],post_null:a["\uc544\uc9c1 \uc791\uc131 \ub41c \uae00\uc774 \uc5c6\uc2b5\ub2c8\ub2e4."],total:a["\ucd1d"],count:f["\uac1c"],not_community:a["\uac00\uc785\ub41c \ucee4\ubba4\ub2c8\ud2f0\uac00 \uc5c6\uc2b5\ub2c8\ub2e4."],join_community:a["\uac00\uc785\ud558\uae30"],no_auth:f["\uc5f4\ub78c\uad8c\ud55c\uc774 \uc5c6\ub294 \uac8c\uc2dc\ubb3c\uc785\ub2c8\ub2e4."],no_posts:f["\ub4f1\ub85d\ub41c \uae00\uc774 \uc5c6\uc2b5\ub2c8\ub2e4."],more_view:f["\ub354 \ubcf4\uae30"],new_post:u["\uc0c8\uae00"]},c=t.View.extend({rankEl:null,el:".tab_contents",events:function(){},initialize:function(){this.unbindEvent(),this.bindEvent(),this.collection=r.create(),this.hasCommunity=this.options.hasCommunity!=undefined?this.options.hasCommunity:!0},bindEvent:function(){this.$el.on("click","ul.home_list li",e.proxy(this.viewDetailLi,this)),this.$el.on("click","#moreButton",e.proxy(this.listMore,this)),this.$el.on("click","span.photo a, a.name",e.proxy(this.showProfileCard,this)),this.$el.on("click",".boardName",e.proxy(this.moveBoardLink,this)),this.$el.on("click",".category_link",e.proxy(this.moveCommunityLink,this))},unbindEvent:function(){this.$el.off("click","ul.home_list li"),this.$el.off("click","#moreButton"),this.$el.off("click","span.photo a"),this.$el.off("click",".boardName"),this.$el.off("click",".category_link")},render:function(){var t=this;e(window).unbind("scroll.community"),e(window).bind("scroll.community",function(n){d_height=e(document).height(),w_height=e(window).height(),s_height=d_height-w_height,d_top=e(document).scrollTop(),s_height-d_top<2&&t.$el.find("div.bottom_action").is(":visible")&&t.listMore()});var n=e.goPreloader();n.render(),this.collection.fetch({data:{page:0,offset:15},async:!1,statusCode:{403:function(){GO.util.error("403",{msgCode:"400-board"})},404:function(){GO.util.error("404",{msgCode:"400-board"})},500:function(){GO.util.error("500")}},success:function(n){var r=t.makeTemplete({collection:n});t.$el.html(r),t.hasCommunity?n.size()<=0&&(e('li[data-id="noPost"]').show(),e('li[data-id="noPost"]').css("display","")):(e('li[data-id="noCommunity"]').show(),e('li[data-id="noCommunity"]').css("display","")),t.moreBtnHide(n)}}).done(function(){n.release()})},showProfileCard:function(t){ProfileView=require("views/profile_card");var n=e(t.currentTarget).attr("data-userid");n!=""&&ProfileView.render(n,t.currentTarget),t.stopPropagation()},moveBoardLink:function(t){var r=e(t.currentTarget).parents("li").first(),i=r.attr("data-communityid"),s=r.attr("data-boardid");n.router.navigate("community/"+i+"/board/"+s,!0),t.stopPropagation()},moveCommunityLink:function(t){var r=e(t.currentTarget).parents("li").first(),i=r.attr("data-communityid");n.router.navigate("community/"+i,!0),t.stopPropagation()},listMore:function(){var e=this,t=parseInt(this.collection.page.page)+1,n={page:t,offset:"15"};this.collection=r.getCollection(n);var i=e.makeTemplete({collection:this.collection,type:"more"});this.$el.find("ul.article_list").append(i),this.moreBtnHide(this.collection)},moreBtnHide:function(t){if(t.length==0){e("#moreButton").hide();return}var n=t.page.lastPage;n?e("#moreButton").hide():e("#moreButton").show()},makeTemplete:function(e){var t=e.collection,n=t.toJSON(),r=e.type,o,u=function(){return this.type=="CLASSIC"?"classic":"feed"},a=function(){return parseInt(this.recommendCount)==0?"zero":""},f=function(e){return GO.util.snsDate(this.createdAt)},c=function(){var e=this.type;return e=="CLASSIC"?!0:!1},h=function(){return GO.util.textToHtml(GO.util.convertMSWordTag(this.summary))},p=function(){return GO.util.textToHtml(this.title)},d=function(){return this.summary==" $$#HIDDEN_POST#$$ "},v=function(){return this.hiddenPost};return r?o=s({dataSet:n,isZero:a,titleParse:p,contentParse:h,dateParse:f,isClassic:c,lang:l,isPostHidden:v,isTitleHidden:d,boardType:u}):o=i({dataSet:t.toJSON(),isZero:a,titleParse:p,contentParse:h,dateParse:f,isClassic:c,lang:l,isPostHidden:v,isTitleHidden:d,boardType:u}),o},viewDetailLi:function(t){var n=e(t.currentTarget);if(n.attr("data-id")=="noCommunity")return;this.moveCommunityAction(n),t.stopPropagation()},moveCommunityAction:function(t){var r=t.attr("data-communityid"),i=t.attr("data-boardType"),s=t.attr("data-boardId"),o=t.attr("data-postId"),u=t.attr("class"),a=t.attr("data-hidden");isNoCommunityOrNoPost=t.attr("data-id");if(a=="true"){e.goMessage(f["\uac8c\uc2dc\uae00 \uc5f4\ub78c\ubd88\uac00 \uba54\uc138\uc9c0"]);return}if(isNoCommunityOrNoPost=="noCommunity"||isNoCommunityOrNoPost=="noPost")return!1;i=="CLASSIC"?n.router.navigate("community/"+r+"/board/"+s+"/post/"+o,!0):i=="STREAM"?n.router.navigate("community/"+r+"/board/"+s+"/post/"+o+"/stream",!0):n.router.navigate("community/"+r+"/board/"+s,!0)}});return{render:function(e){var t=new c(e);return t.render()}}})}).call(this);