(function(){define(["jquery","backbone","app","community/models/add_member","community/models/info","hgn!community/templates/add_member","hgn!community/templates/add_org_member","board/views/board_title","i18n!nls/commons","i18n!community/nls/community","jquery.go-popup","jquery.go-orgslide"],function(e,t,n,r,i,s,o,u,a,f){tplVar={invite_desc:f["\u203b \uc0c8\ub85c \ucd08\ub300\ud560 \uba64\ubc84\ub97c \uc120\ud0dd\ud558\uc2dc\uace0, \uc544\ub798 '\ucd08\ub300' \ubc84\ud2bc\uc744 \ud074\ub9ad\ud558\uc2dc\uba74 \uac00\uc785\uc774 \uc644\ub8cc\ub429\ub2c8\ub2e4."],add_member:f["\uba64\ubc84 \ucd94\uac00"],invite_ok:f["\ucd08\ub300"],community_cancel:a["\ucde8\uc18c"],empty_member:f["\ucd08\ub300\ud560 \uba64\ubc84\uac00 \uc5c6\uc2b5\ub2c8\ub2e4."]};var l=t.View.extend({el:"#content",manage:!1,events:{"click #btnAddMember":"getOrgList","click #addMemberOK":"saveAddMember","click #addMemberCancel":"cancelAddMember","click ul.name_tag li span.ic_del":"deleteMember"},initialize:function(e){this.formName="formAddMember"},render:function(e){this.communityId=e;var t=i.read({communityId:e}).toJSON(),n=s({lang:tplVar,name:t.name,communityId:e});this.$el.html(n),u.render({el:".content_top",dataset:{name:t.name},isCommunity:!0})},addMember:function(t){var n=_.isArray(t)?t:[t],r=n.length==1,i=e("#addMembers");_.each(n,function(t){e("#communityMembers").find('a[data-userId="'+t.id+'"]').length?r&&e.goMessage(f["\uc774\ubbf8 \ucee4\ubba4\ub2c8\ud2f0 \uba64\ubc84\uc785\ub2c8\ub2e4"]):t&&!i.find('li[data-id="'+t.id+'"]').length?i.find("li.creat").before(o(e.extend(t,{lang:tplVar}))):r&&e.goMessage(f["\uc774\ubbf8 \uc120\ud0dd\ub418\uc5c8\uc2b5\ub2c8\ub2e4."])})},cancelAddMember:function(){var t=this;e.goConfirm(a["\ucde8\uc18c\ud558\uc2dc\uaca0\uc2b5\ub2c8\uae4c?"],a["\uc785\ub825\ud558\uc2e0 \uc815\ubcf4\uac00 \ucd08\uae30\ud654\ub429\ub2c8\ub2e4."],function(){t.render(t.communityId)})},deleteMember:function(t){e(t.currentTarget).parents("li").remove()},getOrgList:function(t){var n=this;e.goOrgSlide({header:f["\ucd08\ub300\ud558\uae30"],desc:"",contextRoot:GO.contextRoot,callback:n.addMember,externalLang:a,memberTypeLabel:f["\uba64\ubc84"],isBatchAdd:!0})},saveAddMember:function(t){var i=this,s=this.$el.find("form[name="+this.formName+"]"),o=[],u=e(".select_nav").attr("data-id");e(s.serializeArray()).each(function(e,t){t.name=="memberId"&&o.push(t.value)});if(o.length==0){e.goAlert(tplVar.empty_member);return}this.model=new r,this.model.set({communityId:u,userIds:o},{silent:!0}),this.model.save({},{success:function(e,t){t.code=="200"&&n.router.navigate("community/"+u,!0)},error:function(t,n){n.msg&&e.goAlert(n.msg),n.focus&&s.find('input[name="'+n.focus+'"]').focus()}})}});return{render:function(e){var t=new l;return t.render(e)}}})}).call(this);