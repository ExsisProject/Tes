(function(){define(["jquery","backbone","app","underscore","community/collections/communities","community/models/communities","hgn!community/templates/side","hgn!community/templates/side_item","hgn!community/templates/side_select_communities","i18n!nls/commons","i18n!community/nls/community"],function(e,t,n,r,i,s,o,u,a,f,l){var c={community_empty:l["\uc9c0\uae08 \uc990\uac70\uc6b4 \ucee4\ubba4\ub2c8\ud2f0\ub97c \ub9cc\ub4e4\uc5b4\ubcf4\uc138\uc694!"],community_wait:l["\uac1c\uc124\ub300\uae30"],community_cancel:l["\uac1c\uc124\ucde8\uc18c"],member_wait:l["\uac00\uc785\ub300\uae30"],member_cancel:l["\uac00\uc785\ucde8\uc18c"],join_community:l["\uac00\uc785 \ucee4\ubba4\ub2c8\ud2f0"],new_community:l["\ucee4\ubba4\ub2c8\ud2f0 \ub9cc\ub4e4\uae30"],community_master:l["\ub9c8\uc2a4\ud130"],cancel:f["\ucde8\uc18c"],modify:f["\uc218\uc815\uc644\ub8cc"],fold:f["\uc811\uae30"],unfold:f["\ud3bc\uce58\uae30"],community_master:f["\uad00\ub9ac"],community_modify:f["\uc218\uc815"],community:f["\ucee4\ubba4\ub2c8\ud2f0"],community_home:l["\ucee4\ubba4\ub2c8\ud2f0 \ud648"]},h=t.View.extend({el:"#side",initialize:function(){this.unbindEvent(),this.bindEvent(),this.collection=i.create()},unbindEvent:function(){this.$el.off("click","#community_reorder"),this.$el.off("click","#reorder_ok"),this.$el.off("click","#reorder_cancel"),this.$el.off("click","#communitySide ul>li"),this.$el.off("click","#communitySide ul>li")},bindEvent:function(){this.$el.on("click","#community_reorder",e.proxy(this.bindCommunityReorder,this)),this.$el.on("click","#reorder_ok",e.proxy(this.saveCommunityReorder,this)),this.$el.on("click","#reorder_cancel",e.proxy(this.cancelCommunityReorder,this)),this.$el.on("click","#communitySide ul>li",e.proxy(this.dragOver,this)),this.$el.on("click","#communitySide ul>li",e.proxy(this.dragOut,this))},render:function(e){var t=this,i=!1,s=!1;r.isUndefined(e)||(i=r.isUndefined(e.communityId)?!0:!1,s=r.isUndefined(e.isOpen)?!0:e.isOpen),i&&this.$el.html(o({lang:c,context_root:GO.contextRoot,appName:GO.util.getAppName("community")})),this.collection.fetch({async:!0,success:function(e){var r=e.toJSON()||[],o=i?u:a,f=o({dataset:r,lang:c,context_root:n.config("contextRoot"),isDataset:r.length?!0:!1,isPublicFlag:function(){return this.publicFlag==1?!0:!1},isCommunityStatusWait:function(){return this.status=="WAIT"?!0:!1},isMemberTypeMaster:function(){return this.memberType=="MASTER"||this.memberType=="MODERATOR"?!0:!1},isMemberStatusWait:function(){return this.memberStatus=="WAIT"?!0:!1},isMemberStatusOnline:function(){return this.memberType=="USER"&&this.memberStatus=="ONLINE"?!0:!1},isNewPost:function(){return this.newPostCount>0?!0:!1},isOpen:s});i?t.$el.find("#side_list").html(f):t.$el.find("#sideNav").append(f),t.$el.find(".edit_only").hide()}})},bindCommunityReorder:function(e){this.$el.find("#communitySide").addClass("lnb_edit").sortable({items:"li",opacity:"1",delay:100,cursor:"move",hoverClass:"move",containment:"#communitySide",forceHelperSize:"true",helper:"clone",placeholder:"ui-sortable-placeholder"}),this.$el.find("#community_reorder").hide(),this.$el.find("#reorder_ok").show(),this.$el.find("#reorder_cancel").show(),this.$el.find(".edit_only").show()},saveCommunityReorder:function(){var t=this,n=[];this.$el.find("li.community").each(function(t,r){n.push(e(r).attr("data-id"))}),this.model=new s,this.model.save({communityIds:n},{type:"PUT",success:function(e,n){n.code=="200"&&(t.$el.find("#communitySide").removeClass("lnb_edit").sortable("destroy"),t.$el.find("#reorder_ok").hide(),t.$el.find("#reorder_cancel").hide(),t.$el.find(".edit_only").hide(),t.$el.find("#community_reorder").show(),t.$el.find("#toggleCommunityList").show())},error:function(t,n){n.msg&&e.goAlert(n.msg),n.focus&&form.find('input[name="'+n.focus+'"]').focus()}})},cancelCommunityReorder:function(){this.$el.find("#communitySide").removeClass("lnb_edit");var e=!this.$el.find("#toggleCommunityList").parents("h1").hasClass("folded");this.render({isOpen:e})},dragOver:function(t){e(t.currentTarget).addClass("move")},dragOut:function(t){e(t.currentTarget).removeClass("move")}});return{render:function(e){var t=new h;return t.render(e)}}})}).call(this);