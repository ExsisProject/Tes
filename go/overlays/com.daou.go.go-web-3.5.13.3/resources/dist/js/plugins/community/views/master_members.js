(function(){define(["jquery","backbone","app","hgn!community/templates/master_members","hgn!community/templates/member_wait_null","community/models/info","i18n!nls/commons","i18n!community/nls/community","jquery.go-grid","jquery.placeholder"],function(e,t,n,r,i,s,o,u){var a={community_info:u["\uc815\ubcf4"],community_board:u["\uac8c\uc2dc\ud310"],community_members:u["\uba64\ubc84"],community_delete:u["\ud328\uc1c4"],community_member_all:u["\ucee4\ubba4\ub2c8\ud2f0 \uc804\uccb4 \uba64\ubc84 \ub9ac\uc2a4\ud2b8"],community_name:o["\uc774\ub984"],community_dept:u["\uc18c\uc18d"],community_email:u["\uc774\uba54\uc77c"],community_jointat:u["\uac00\uc785 \uc2e0\uccad\uc77c"],community_post_count:u["\uac8c\uc2dc \uae00 \uc218"],community_online:u["\uc0ac\uc6a9\uc911"],community_wait:u["\uac00\uc785 \uc2b9\uc778 \ub300\uae30"],community_member:u["\uc0ac\uc6a9 \uba64\ubc84"],community_leave:u["\ud0c8\ud1f4"],community_accept:u["\uc2b9\uc778"],community_reject:u["\uac70\uc808"],community_total:u["\ucd1d"],community_count:u["\uba85"],community_wait_null:u["\uc2b9\uc778\ub300\uae30\uc911\uc778 \uba64\ubc84\uac00 \uc5c6\uc2b5\ub2c8\ub2e4."],name:o["\uc774\ub984"],placeholder_name:o["\ud50c\ub808\uc774\uc2a4\ud640\ub354\uc774\ub984"],send_mail:u["\uba54\uc77c\ubc1c\uc1a1"],send_mail_all:u["\uc804\uccb4 \uba54\uc77c\ubc1c\uc1a1"]},f=t.View.extend({manage:!1,events:{},initialize:function(e){this.options=e||{},this.unbindEvent(),this.bindEvent(),this.dataTable=null,this.communityId=this.options.communityId,this.status=this.options.status,this.communityName=this.options.communityName},bindEvent:function(){this.$el.on("click","#memberSearch",e.proxy(this.search,this)),this.$el.on("keydown","#memberSearch2 input",e.proxy(this.searchKeyboardEvent,this)),this.$el.on("click","#btnSendMail",e.proxy(this.sendMail,this)),this.$el.on("click","#btnSendMailAll",e.proxy(this.sendMailAll,this))},unbindEvent:function(){this.$el.off("click","#memberSearch"),this.$el.off("keydown","#memberSearch2 input"),this.$el.off("click","#btnSendMail"),this.$el.off("click","#btnSendMailAll")},render:function(){this.$el.empty();var t=this.status,s=GO.config("mailExposure");this.$el.html(r({lang:a,isAvailableMail:function(){return n.isAvailableApp("mail")?!0:!1},isOnlineMember:function(){return t=="online"?!0:!1},mailExposure:s})),e("input[placeholder], textarea[placeholder]").placeholder();var o=this,u=[{mData:"name",sWidth:"100px",bSortable:!0},{mData:"departmentName",sWidth:"150px",bSortable:!0},{mData:"email",sWidth:"200px",bSortable:!0},{mData:"createdAt",sWidth:"120px",bSortable:!0,fnRender:function(e){return GO.util.basicDate2(e.aData.createdAt)}},{mData:"postCount",sWidth:"80px",bSortable:!0}];return s||u.splice(2,1),this.dataTable=e.goGrid({el:"#memberList",url:GO.contextRoot+"api/community/"+this.communityId+"/member/"+this.status,method:"get",defaultSorting:[],params:{property:"memberType",direction:"asc"},emptyMessage:i({lang:a}),checkbox:!0,checkboxData:"userId",columns:u,fnDrawCallback:function(e,t){o.renderToolbar(t._iRecordsTotal)}}),this.status=="online"?(e("#onlineMember").attr("checked",!0),e(".wait").remove()):(e("#waitMember").attr("checked",!0),e(".online").remove()),this.dataTable},renderToolbar:function(e){var t=this.$el.find("#toolBar #memberTotalElements").html(e);t.length>0?(this.$el.find(".tool_bar .custom_header").html(this.$el.find("#toolBar").html()),this.$el.find("#toolBar").remove()):this.$el.find("#memberTotalElements").html(e),e<=0&&this.$el.find("#btnMember").remove()},searchKeyboardEvent:function(e){e.keyCode==13&&this.search()},search:function(){var t=this.$el.find(".table_search input"),r=t.val();e("input.search2").attr("placeholder")===this.$el.find("input.search2").val()&&(r="");if(!e.goValidation.isCheckLength(1,32,r))return e.goMessage(n.i18n(u["0\uc790\uc774\uc0c1 0\uc774\ud558 \uc785\ub825\ud574\uc57c\ud569\ub2c8\ub2e4."],{arg1:"1",arg2:"32"})),!1;this.dataTable.tables.search(this.$el.find(".table_search select").val(),r)},sendMail:function(){var t=this.$el.find("form[name=formCommunityMembers]"),n=t.find('tbody input[type="checkbox"]:checked');if(n.size()==0){e.goMessage(u["\uc120\ud0dd\ub41c \uba64\ubc84\uac00 \uc5c6\uc2b5\ub2c8\ub2e4"]);return}var r=this.dataTable.tables.getCheckedData(),i=[];i=e(r).map(function(e,t){if(t.email)return'"'+t.name+'"'+" <"+t.email+">"}).get();if(!i.length)e.goMessage(contactLang["\uba54\uc77c \uc8fc\uc18c\uac00 \uc5c6\uc2b5\ub2c8\ub2e4."]);else{var s={to:i.join(",")};window.open(GO.contextRoot+"app/mail/popup/process?data="+encodeURIComponent(JSON.stringify(s)),"popupRead"+Math.floor(Math.random()*1e6)+1,"scrollbars=yes,resizable=yes,width=1280,height=760")}},sendMailAll:function(e){var t=s.read({communityId:this.communityId}).toJSON(),n={to:'"'+t.name+'" '+"<!"+this.communityId+">"};window.open(GO.contextRoot+"app/mail/popup/process?data="+encodeURIComponent(JSON.stringify(n)),"popupRead"+Math.floor(Math.random()*1e6)+1,"scrollbars=yes,resizable=yes,width=1280,height=760")}});return{render:function(e,t){var n=new f({el:".tab_conent_wrap",communityId:e,status:t});return n.render()}}})}).call(this);