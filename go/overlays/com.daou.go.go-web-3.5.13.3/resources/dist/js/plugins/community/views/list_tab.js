(function(){define(["jquery","backbone","app","i18n!nls/commons","hgn!community/templates/list_tab","hgn!community/templates/community_detail","community/views/community_feed","community/views/community_user","community/views/community_all","community/views/community_rank","community/models/join","community/models/leave","community/models/remove","community/models/community_popup_info","community/views/side_communities","community/collections/boards","i18n!community/nls/community","i18n!board/nls/board","board/views/board_title","jquery.go-grid","jquery.go-popup","jquery.placeholder"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y){var b={community:r["\ucee4\ubba4\ub2c8\ud2f0"],all_post:m["\uc804\uccb4 \uae00"],community_member:m["\ud68c\uc6d0"],new_post:m["\uc0c8 \uae00 \ub4f1\ub85d"],my_community:m["\uac00\uc785 \ucee4\ubba4\ub2c8\ud2f0"],all:r["\uc804\uccb4"],feed:g["\ucd5c\uadfc\uae00"],master:m["\ub9c8\uc2a4\ud130"],moderator:m["\ubd80\ub9c8\uc2a4\ud130"],description:m["\uc18c\uac1c"],create_at:m["\uac1c\uc124\uc77c"],cnt_person:m["\uba85"],cnt_posts:m["\uac1c"],member:m["\uba64\ubc84"],non_member:m["\ube44\uba64\ubc84"],go_to_community:m["\ucee4\ubba4\ub2c8\ud2f0 \uc785\uc7a5\ud558\uae30"],join_community:m["\ucee4\ubba4\ub2c8\ud2f0 \uac00\uc785\ud558\uae30"],wait_community:m["\ucee4\ubba4\ub2c8\ud2f0 \uac00\uc785\ub300\uae30"],community_home:m["\ucee4\ubba4\ub2c8\ud2f0 \ud648"],all_community:m["\uc804\uccb4 \ucee4\ubba4\ub2c8\ud2f0"]},w=t.Model.extend({url:"/api/community/home/feed/exposure"}),E=t.View.extend({listEl:null,el:"#content",manage:!1,initialize:function(){this.unbindEvent(),this.bindEvent(),this.homeExposureModel=new w},bindEvent:function(){this.$el.on("click","#communityByFeed",e.proxy(this.getCommunityByFeed,this)),this.$el.on("click","#communityByUser",e.proxy(this.getCommunityByUser,this)),this.$el.on("click","#communityByAll",e.proxy(this.getCommunityByAll,this)),this.$el.on("click","#btn_CommunityByAll",e.proxy(this.getCommunityByAll,this)),this.$el.on("click","#communityCreate",e.proxy(this.communityCreate,this)),this.$el.on("click",".communityAction",e.proxy(this.communityAction,this)),this.$el.on("click",".comm",e.proxy(this.getCommunityInfo,this)),this.$el.on("click","#communitySearch2",e.proxy(this.search,this)),this.$el.on("keydown","#communitySearch input",e.proxy(this.searchKeyboardEvent,this)),this.$el.on("click","ul.comm_group_list li",e.proxy(this.getCommunityInfo,this))},unbindEvent:function(){this.$el.off("click","#communityByFeed"),this.$el.off("click","#communityByUser"),this.$el.off("click","#communityByAll"),this.$el.off("click","#btn_CommunityByAll"),this.$el.off("click","#communityCreate"),this.$el.off("click",".communityAction"),this.$el.off("click",".comm"),this.$el.off("click","#communitySearch2"),this.$el.off("keydown","#communitySearch input"),this.$el.off("click","ul.comm_group_list li")},render:function(){this.$el.html(i({lang:b})),y.render({el:".content_top",dataset:{name:b.community_home},isCommunity:!0});var t=e("li.community").size();f.render(),this.homeExposureModel.fetch({async:!1}),this.homeExposureModel.has(!0)?(e("#communityByFeed").addClass("active"),this.listEl=o.render({hasCommunity:this.homeExposureModel.has(!0)})):(e("#communityByAll").addClass("active"),this.listEl=a.render())},communityCreate:function(){n.router.navigate("community/create",!0)},getCommunityByFeed:function(t){this.moveListTab(),e("#communityByFeed").addClass("active"),this.listEl=o.render({hasCommunity:this.homeExposureModel.has(!0)})},getCommunityByUser:function(t){this.moveListTab(),e("#communityByUser").addClass("active"),this.listEl=u.render()},getCommunityByAll:function(t){this.moveListTab(),e("#communityByAll").addClass("active"),this.listEl=a.render()},moveListTab:function(t){this.$el.find(".active").removeClass("active"),e("#toolBar").remove(),e(".dataTables_wrapper").remove(),e(".table_search").remove()},_reloadTables:function(){this.listEl!=undefined&&this.listEl.tables.fnClearTable(),f.render(e(".select_txt").attr("data-id"))},getCommunityHome:function(t){var r=e(t.currentTarget).attr("data-id"),i=e(t.currentTarget).attr("data-memberStatus"),s=e(t.currentTarget).attr("data-communityStatus"),o=e(t.currentTarget).attr("data-publicflag");s=="WAIT"?e.goAlert(m["\uc544\uc9c1 \uac1c\uc124\uc774 \uc2b9\uc778\ub418\uc9c0 \uc54a\uc558\uc2b5\ub2c8\ub2e4."],m["\uad00\ub9ac\uc790\uc758 \uc2b9\uc778\uc774 \ud544\uc694\ud569\ub2c8\ub2e4."]):o=="true"?n.router.navigate("community/"+r,!0):i=="ONLINE"?n.router.navigate("community/"+r,!0):e.goAlert(m["\uc544\uc9c1 \uac00\uc785\ub418\uc9c0 \uc54a\uc558\uc2b5\ub2c8\ub2e4."],m["\ucee4\ubba4\ub2c8\ud2f0 \uad00\ub9ac\uc790\uc758 \uc2b9\uc778\uc774 \ud544\uc694\ud569\ub2c8\ub2e4."])},communityAction:function(t){var r=this,i=e(t.currentTarget).parents("tr").first().find(".comm");i.length<1&&(i=e(t.currentTarget));var s=i.attr("data-id"),o=i.attr("data-memberStatus"),u=i.attr("data-communityStatus"),a=i.attr("data-memberType");u=="WAIT"?o=="ONLINE"?e.goCaution(m["\ucee4\ubba4\ub2c8\ud2f0 \uac1c\uc124\uc744 \ucde8\uc18c\ud558\uc2dc\uaca0\uc2b5\ub2c8\uae4c?"],"",function(){r.communityRemove(s)}):e.goAlert(m["\uc544\uc9c1 \uac1c\uc124\uc774 \uc2b9\uc778\ub418\uc9c0 \uc54a\uc558\uc2b5\ub2c8\ub2e4."],m["\uad00\ub9ac\uc790\uc758 \uc2b9\uc778\uc774 \ud544\uc694\ud569\ub2c8\ub2e4."]):o=="ONLINE"?a=="MASTER"?e.goConfirm(m["\ud604\uc7ac \ucee4\ubba4\ub2c8\ud2f0 \ub9c8\uc2a4\ud130\uc785\ub2c8\ub2e4."],m["\ub9c8\uc2a4\ud130 \uad8c\ud55c\uc744 \uc591\ub3c4\ud55c \ud6c4\uc5d0 \ud0c8\ud1f4\uac00 \uac00\ub2a5\ud569\ub2c8\ub2e4. \uad00\ub9ac \ud398\uc774\uc9c0\ub85c \uc774\ub3d9\ud558\uc2dc\uaca0\uc2b5\ub2c8\uae4c?"],function(){n.router.navigate("community/"+s+"/admin",!0)}):e.goCaution(m["\ud604\uc7ac \ucee4\ubba4\ub2c8\ud2f0\uc5d0\uc11c \ud0c8\ud1f4\ud558\uc2dc\uaca0\uc2b5\ub2c8\uae4c?"],m["\ud0c8\ud1f4\ud558\uc5ec\ub3c4 \uc774\uc804\uc5d0 \uc791\uc131\ud558\uc600\ub358 \uac8c\uc2dc\ubb3c\ub4e4\uc740 \uc720\uc9c0\ub429\ub2c8\ub2e4."],function(){r.communityLeave(s)}):o=="WAIT"?e.goConfirm(m["\uac00\uc785 \ucde8\uc18c\ub97c \ud558\uc2dc\uaca0\uc2b5\ub2c8\uae4c?"],"",function(){r.communityLeave(s)}):e.goConfirm(m["\uac00\uc785\uc744 \uc2e0\uccad\ud558\uc2dc\uaca0\uc2b5\ub2c8\uae4c?"],m["\ucee4\ubba4\ub2c8\ud2f0 \uac00\uc785\uc740 \uad00\ub9ac\uc790\uc758 \uc2b9\uc778\uc774 \ud544\uc694\ud569\ub2c8\ub2e4."],function(){r.communityJoin(s)})},communityJoin:function(t){var n=this;this.model=new l,this.model.set("communityId",t,{silent:!0}),this.model.save({},{success:function(e,t){t.code=="200"&&(n._reloadTables(),d.render())},error:function(t,n){e.goMessage(r["\uc800\uc7a5\uc5d0 \uc2e4\ud328 \ud558\uc600\uc2b5\ub2c8\ub2e4."]),n.msg&&e.goAlert(n.msg),n.focus&&form.find('input[name="'+n.focus+'"]').focus()}})},communityLeave:function(t){var i=this;this.model=new c,this.model.set("communityId",t,{silent:!0}),this.model.save({},{type:"DELETE",success:function(e,t){t.code=="200"&&(i._reloadTables(),d.render())},error:function(i,s){var o=JSON.parse(s.responseText);o.name=="already.community.master"?e.goConfirm(m["\ud604\uc7ac \ucee4\ubba4\ub2c8\ud2f0 \ub9c8\uc2a4\ud130\uc785\ub2c8\ub2e4."],m["\ub9c8\uc2a4\ud130 \uad8c\ud55c\uc744 \uc591\ub3c4\ud55c \ud6c4\uc5d0 \ud0c8\ud1f4\uac00 \uac00\ub2a5\ud569\ub2c8\ub2e4. \uad00\ub9ac \ud398\uc774\uc9c0\ub85c \uc774\ub3d9\ud558\uc2dc\uaca0\uc2b5\ub2c8\uae4c?"],function(){n.router.navigate("community/"+t+"/admin",!0)},r["\ud655\uc778"]):o.name=="already.community.board.master"&&(e.goConfirm(m["\ud604\uc7ac \ucee4\ubba4\ub2c8\ud2f0 \uac8c\uc2dc\ud310 \uc6b4\uc601\uc790\uc785\ub2c8\ub2e4."],m["\uc6b4\uc601\uc790 \uad8c\ud55c\uc744 \uc591\ub3c4\ud55c \ud6c4\uc5d0 \ud0c8\ud1f4\uac00 \uac00\ub2a5\ud569\ub2c8\ub2e4. \uad00\ub9ac \ud398\uc774\uc9c0\ub85c \uc774\ub3d9\ud558\uc2dc\uaca0\uc2b5\ub2c8\uae4c?"],function(){this.boards=v.create(),this.boards.setVariables(t,"active"),this.boards.fetch({async:!0,success:function(t){var r=t.toJSON();e.each(r,function(e,t){if(t.actions.managable==1)return n.router.navigate("community/"+t.communityId+"/board/"+t.board.id+"/admin",!0),!1})}})}),r["\ud655\uc778"])}})},communityRemove:function(t){var n=this;this.model=new h,this.model.setCommunityId(t),this.model.set("id",t,{silent:!0}),this.model.destroy({success:function(e,t){t.code=="200"&&(n._reloadTables(),d.render())},error:function(t,n){n.msg&&e.goAlert(n.msg),n.focus&&form.find('input[name="'+n.focus+'"]').focus()}})},searchKeyboardEvent:function(e){e.keyCode==13&&this.search()},search:function(){var t=this.$el.find('.table_search input[type="text"]'),i=t.val();e("input.search2").attr("placeholder")===e("input.search2").val()&&(i="");if(!e.goValidation.isCheckLength(2,64,i))return e.goMessage(n.i18n(r["0\uc790\uc774\uc0c1 0\uc774\ud558 \uc785\ub825\ud574\uc57c\ud569\ub2c8\ub2e4."],{arg1:"2",arg2:"64"})),!1;this.listEl.tables.search(this.$el.find(".table_search select").val(),i,t)},getMemberType:function(e,t){return e=="ONLINE"?(t=="MASTER"?(memberMessage=m["\ub9c8\uc2a4\ud130"],memberTypeClass="type master"):t=="MODERATOR"?(memberMessage=m["\ubd80\ub9c8\uc2a4\ud130"],memberTypeClass="type sub_master"):(memberMessage=m["\uba64\ubc84"],memberTypeClass="type member"),btnMessage=m["\ucee4\ubba4\ub2c8\ud2f0 \uc785\uc7a5\ud558\uae30"]):e=="WAIT"?(memberMessage=m["\ube44\uba64\ubc84"],memberTypeClass="type guest"):(memberMessage=m["\ube44\uba64\ubc84"],memberTypeClass="type guest"),'<span class="type_grade"><span class="'+memberTypeClass+'">'+memberMessage+"</span></span>"},mouseHover:function(t){e(t.currentTarget).text(m["\uac00\uc785\ucde8\uc18c"])},mouseOut:function(t){e(t.currentTarget).text(m["\ucee4\ubba4\ub2c8\ud2f0 \uac00\uc785\ub300\uae30"])},getCommunityInfo:function(t){var n=this,r=e(t.currentTarget).parents("tr").first().find(".comm"),i=r.attr("data-id");r.length<1&&(i=e(t.currentTarget).attr("data-id"));var o=p.read({communityId:i}).toJSON(),u=n.getMemberType(o.memberStatus,o.memberType)+_.escape(o.name);o.publicFlag||(u="<span class='ic_side ic_private'></span>"+u),this.popupEl=e.goPopup({header:u,width:"300px",pclass:"layer_comm_info layer_normal",buttons:n.returnBtn(t,o),contents:s({lang:b,data:o,createAt:GO.util.basicDate2(o.createdAt),memberMessage:memberMessage})}),o.memberStatus=="WAIT"&&!o.publicFlag&&(this.popupEl.on("mouseover","a.btn_major_s",e.proxy(this.mouseHover,this)),this.popupEl.on("mouseout","a.btn_major_s",e.proxy(this.mouseOut,this)))},returnBtn:function(t,n){var r;n.memberStatus=="ONLINE"?r=m["\ucee4\ubba4\ub2c8\ud2f0 \uc785\uc7a5\ud558\uae30"]:n.memberStatus=="WAIT"&&n.publicFlag?r=m["\ucee4\ubba4\ub2c8\ud2f0 \uc785\uc7a5\ud558\uae30"]:n.memberStatus=="WAIT"&&!n.publicFlag?r=m["\ucee4\ubba4\ub2c8\ud2f0 \uac00\uc785\ub300\uae30"]:r=m["\ucee4\ubba4\ub2c8\ud2f0 \uac00\uc785\ud558\uae30"];var i=this;return!n.publicFlag||n.memberStatus!="NONE"?[{btype:"confirm",btext:r,autoclose:!1,callback:function(){n.publicFlag||n.memberStatus=="ONLINE"?i.getCommunityHome(t):(e.goPopup.close(),i.communityAction(t))}}]:[{btype:"confirm",btext:m["\ucee4\ubba4\ub2c8\ud2f0 \uc785\uc7a5\ud558\uae30"],bclass:"btn_moveCommunity",callback:function(){i.getCommunityHome(t)}},{btype:"confirm",btext:m["\ucee4\ubba4\ub2c8\ud2f0 \uac00\uc785\ud558\uae30"],bclass:"btn_joinCommunity",autoclose:!1,callback:function(){e.goPopup.close(),i.communityAction(t)}}]}});return{render:function(){var e=new E;return e.render()}}})}).call(this);