define(["jquery","backbone","app","hgn!community/templates/side","community/views/side_communities","community/models/leave","community/collections/boards","i18n!nls/commons","i18n!community/nls/community","amplify"],function(e,t,n,r,i,s,o,u,a,f){var l=GO.session("loginId")+"-community-join-toggle",c=null,h=t.View.extend({el:"#side",initialize:function(){},unBindEvent:function(){this.$el.off("click","a.toggleCommunityList"),this.$el.off("click","a.communityName"),this.$el.off("click","span.masterHome"),this.$el.off("click","#communityCreate"),this.$el.off("click","span.joinCancel"),this.$el.off("click","span.communityLeave")},bindEvent:function(){this.$el.on("click","a.toggleCommunityList",e.proxy(this.slideCommunityToggle,this)),this.$el.on("click","a.communityName",e.proxy(this.getCommunityHome,this)),this.$el.on("click","span.masterHome",e.proxy(this.getCommunityMaster,this)),this.$el.on("click","#communityCreate",e.proxy(this.communityCreate,this)),this.$el.on("click","span.joinCancel",e.proxy(this.setJoinCancel,this)),this.$el.on("click","span.communityLeave",e.proxy(this.setCommunityLeave,this))},render:function(){this.unBindEvent(),this.bindEvent(),i.render({isOpen:this.getStoredCategoryIsOpen(l)})},getCommunityHome:function(t){var r=e(t.currentTarget).parents("li"),i=r.attr("data-id"),s=r.attr("data-status"),o=r.attr("data-publicFlag");memberStatus=r.attr("data-memberStatus"),s=="WAIT"?e.goAlert(a["\uc544\uc9c1 \uac1c\uc124\uc774 \uc2b9\uc778\ub418\uc9c0 \uc54a\uc558\uc2b5\ub2c8\ub2e4."],a["\uad00\ub9ac\uc790\uc758 \uc2b9\uc778\uc774 \ud544\uc694\ud569\ub2c8\ub2e4."]):o=="false"&&memberStatus!="ONLINE"?e.goAlert(a["\uc544\uc9c1 \uac00\uc785\ub418\uc9c0 \uc54a\uc558\uc2b5\ub2c8\ub2e4."],a["\ucee4\ubba4\ub2c8\ud2f0 \uad00\ub9ac\uc790\uc758 \uc2b9\uc778\uc774 \ud544\uc694\ud569\ub2c8\ub2e4."]):n.router.navigate("community/"+i,!0)},getCommunityMaster:function(t){var r=e(t.currentTarget).parents("li"),i=r.attr("data-id"),s=r.attr("data-status");s=="WAIT"?e.goAlert(a["\uc544\uc9c1 \uac1c\uc124\uc774 \uc2b9\uc778\ub418\uc9c0 \uc54a\uc558\uc2b5\ub2c8\ub2e4."],a["\uad00\ub9ac\uc790\uc758 \uc2b9\uc778\uc774 \ud544\uc694\ud569\ub2c8\ub2e4."]):n.router.navigate("community/"+i+"/admin",!0)},slideCommunityToggle:function(t){var n=this,r=e(t.currentTarget),i=r.parents("h1"),s=i.find(".ic_hide_up");r.parents("h1.community").next("ul").slideToggle("fast",function(){e(this).css("display")=="block"?(i.removeClass("folded"),s.attr("title",u["\uc811\uae30"])):(i.addClass("folded"),s.attr("title",u["\ud3bc\uce58\uae30"]));var t=i.hasClass("folded");n.storeCategoryIsOpen(l,!t)})},setJoinCancel:function(t){var n=this,r=e(t.currentTarget).parents("li"),i=r.attr("data-id");e.goCaution(a["\uac00\uc785 \ucde8\uc18c\ub97c \ud558\uc2dc\uaca0\uc2b5\ub2c8\uae4c?"],"",function(){n.communityLeave(i)})},setCommunityLeave:function(t){var n=this,r=e(t.currentTarget).parents("li"),i=r.attr("data-id");e.goCaution(a["\ud604\uc7ac \ucee4\ubba4\ub2c8\ud2f0\uc5d0\uc11c \ud0c8\ud1f4\ud558\uc2dc\uaca0\uc2b5\ub2c8\uae4c?"],a["\ud0c8\ud1f4\ud558\uc5ec\ub3c4 \uc774\uc804\uc5d0 \uc791\uc131\ud558\uc600\ub358 \uac8c\uc2dc\ubb3c\ub4e4\uc740 \uc720\uc9c0\ub429\ub2c8\ub2e4."],function(){n.communityLeave(i)})},communityCreate:function(){n.router.navigate("community/create",!0)},communityLeave:function(t){var r=this;this.model=new s,this.model.set("communityId",t,{silent:!0}),this.model.save({},{type:"DELETE",success:function(e,t){t.code=="200"&&i.render()},error:function(r,i){var s=JSON.parse(i.responseText);s.name=="already.community.master"?e.goConfirm(a["\ud604\uc7ac \ucee4\ubba4\ub2c8\ud2f0 \ub9c8\uc2a4\ud130\uc785\ub2c8\ub2e4."],a["\ub9c8\uc2a4\ud130 \uad8c\ud55c\uc744 \uc591\ub3c4\ud55c \ud6c4\uc5d0 \ud0c8\ud1f4\uac00 \uac00\ub2a5\ud569\ub2c8\ub2e4. \uad00\ub9ac \ud398\uc774\uc9c0\ub85c \uc774\ub3d9\ud558\uc2dc\uaca0\uc2b5\ub2c8\uae4c?"],function(){n.router.navigate("community/"+t+"/admin",!0)},u["\ud655\uc778"]):s.name=="already.community.board.master"&&(e.goConfirm(a["\ud604\uc7ac \ucee4\ubba4\ub2c8\ud2f0 \uac8c\uc2dc\ud310 \uc6b4\uc601\uc790\uc785\ub2c8\ub2e4."],a["\uc6b4\uc601\uc790 \uad8c\ud55c\uc744 \uc591\ub3c4\ud55c \ud6c4\uc5d0 \ud0c8\ud1f4\uac00 \uac00\ub2a5\ud569\ub2c8\ub2e4. \uad00\ub9ac \ud398\uc774\uc9c0\ub85c \uc774\ub3d9\ud558\uc2dc\uaca0\uc2b5\ub2c8\uae4c?"],function(){this.boards=o.getCollection(t,"active"),boardResult=this.boards.toJSON(),e.each(boardResult,function(e,t){if(t.actions.managable==1)return n.router.navigate("community/"+t.communityId+"/board/"+t.board.id+"/admin",!0),!1})}),u["\ud655\uc778"])}})},getStoredCategoryIsOpen:function(e){var t="";return window.sessionStorage?t=f.store.sessionStorage(e):t=f.store(e),t==undefined&&(t=!0),t},storeCategoryIsOpen:function(e,t){return f.store(e,t,{type:window.sessionStorage?"sessionStorage":null})}},{create:function(){return c===null&&(c=new layoutView),c.render()}});return h});