define("docs/views/docslist/normal_list",function(require){var e=require("jquery"),t=require("underscore"),n=require("backbone"),r=require("when"),i=require("app"),s=require("docs/views/select_folder_popup"),o=require("docs/views/base_docs"),u=require("docs/views/docslist/base_docs_list"),a=require("views/pagesize"),f=require("views/pagination"),l=require("docs/views/content_top"),c=require("docs/views/docslist/doclist_item"),h=require("docs/views/side"),p=require("docs/collections/docs_base_list"),d=require("docs/models/docs_doc_item"),v=require("hgn!docs/templates/docslist/base_docslist"),m=require("docs/models/doc_folder_info"),g=require("hgn!docs/templates/docslist/docslist_empty"),y=require("i18n!nls/commons"),b=require("i18n!docs/nls/docs"),w=require("i18n!approval/nls/approval"),E={"\uc81c\ubaa9":b["\uc81c\ubaa9"],"\ub0b4\uc6a9":y["\ub0b4\uc6a9"],"\ub4f1\ub85d\uc790":b["\ub4f1\ub85d\uc790"],"\uac80\uc0c9":y["\uac80\uc0c9"],placeholder_search:y["\ud50c\ub808\uc774\uc2a4\ud640\ub354\uac80\uc0c9"],search_all:w["\uc804\uccb4\uae30\uac04"],search_month:w["\uac1c\uc6d4"],search_year:w["\ub144"],search_input:w["\uae30\uac04\uc785\ub825"],"\ub4f1\ub85d":y["\ub4f1\ub85d"],"\uc0ad\uc81c":y["\uc0ad\uc81c"],"\uc774\ub3d9":y["\uc774\ub3d9"],"\ubaa9\ub85d\ub2e4\uc6b4\ub85c\ub4dc":y["\ubaa9\ub85d \ub2e4\uc6b4\ub85c\ub4dc"]},S=p.extend({initialize:function(e){p.prototype.initialize.apply(this,arguments),this.folderId=e.folderId},model:d,url:function(){return"/api/docs/folder/"+this.folderId+"/docses?"+this._makeParam()}}),x=n.Model.extend({url:function(){var e="/api/docs";return e}}),T=n.Model.extend({url:function(){var e=["/api/docs/foler/"+this.folderId+"/docs/move/"+this.targetFolderId].join("/");return e},setFolderId:function(e){this.folderId=e},setTargetFolderId:function(e){this.targetFolderId=e}});return o.extend({initialize:function(e){this.initProperty="completeDate",this.initDirection="desc",this.initPage=20,this.ckeyword="",this.collection=new S({folderId:e.folderId}),this.folderModel=new m({id:e.folderId}),this.collection.usePeriod=!0;var t=sessionStorage.getItem("list-history-baseUrl"),n=new RegExp("(#)?docs/folder/"+e.folderId+"/docses$");t&&n.test(t)?(this.initProperty=sessionStorage.getItem("list-history-property"),this.initDirection=sessionStorage.getItem("list-history-direction"),this.initSearchtype=sessionStorage.getItem("list-history-searchtype"),this.ckeyword=sessionStorage.getItem("list-history-keyword").replace(/\+/gi," "),this.duration=sessionStorage.getItem("list-history-duration"),this.fromDate=sessionStorage.getItem("list-history-fromDate"),this.toDate=sessionStorage.getItem("list-history-toDate"),this.collection.setListParam()):(this.collection.pageSize=this.initPage,this.collection.setDuration(),this.collection.setSort(this.initProperty,this.initDirection)),sessionStorage.clear(),this.collection.bind("reset",this.resetList,this),o.prototype.initialize.apply(this,arguments)},columns:{"\uc120\ud0dd":y["\uc120\ud0dd"],"\ub4f1\ub85d\uc77c":y["\ub4f1\ub85d\uc77c"],"\uc81c\ubaa9":b["\uc81c\ubaa9"],"\ucca8\ubd80":b["\ucca8\ubd80"],"\ub4f1\ub85d\uc790":b["\ub4f1\ub85d\uc790"],count:5},sorts:{"\ub4f1\ub85d\uc77c":"completeDate","\uc81c\ubaa9":"title","\ub4f1\ub85d\uc790":"creatorName"},fetchFolderInfo:function(){return e.when(this.folderModel.fetch({statusCode:{403:function(){i.util.error("403")},404:function(){i.util.error("404",{msgCode:"400-common"})},500:function(){i.util.error("500")}},success:function(e,t){t.data.readable||i.util.error("403")}}))},renderContentTop:function(e){var t=this,n=new l({});e.getContentElement().html(n.el),n.render(),e.setContent(t),n.setTitle(i.util.escapeHtml(this.folderModel.getName()));var r=this.folderModel.isFavorite();n.setFavoriteTmpl(r,t.folderModel.get("id"))},render:function(){return o.prototype.render.apply(this,arguments),this.isRemovable=this.folderModel.isRemovable(),this.isRemovable||(this.columns={"\ub4f1\ub85d\uc77c":y["\ub4f1\ub85d\uc77c"],"\uc81c\ubaa9":b["\uc81c\ubaa9"],"\ucca8\ubd80":b["\ucca8\ubd80"],"\ub4f1\ub85d\uc790":b["\ub4f1\ub85d\uc790"],count:4}),this.folderModel.useDocNum()?(this.columns["\ubb38\uc11c\ubc88\ud638"]=b["\ubb38\uc11c\ubc88\ud638"],this.columns.count=this.columns.count+1):this.columns["\ubb38\uc11c\ubc88\ud638"]&&(delete this.columns["\ubb38\uc11c\ubc88\ud638"],this.columns.count=this.columns.count-1),this.$el.html(v({lang:E,columns:this.columns,usePage:!0,useToolbar:!0,isReadable:this.folderModel.isReadable(),isWritable:this.folderModel.isWritable(),isRemovable:this.isRemovable})),this._renderList(),this._renderPageSize(),this._renderPages(),this},resetList:function(t){var n=this.collection.url().replace("/api/",""),r=i.router.getUrl().replace("#","");r.indexOf("?")<0?i.router.navigate(n,{replace:!0}):r!=n&&i.router.navigate(n,{trigger:!1,pushState:!0}),e(".list_docs > tbody").empty();var s=this.columns,o="docs",u=this;t.each(function(t){t.folderType=u.collection.folderType;var n=new c({model:t,listType:o,columns:s,isCheckboxVisible:!0});e(".list_docs > tbody").append(n.render().el)}),t.length==0&&e(".list_docs > tbody").html(g({columns:s,lang:{doclist_empty:b["\ubb38\uc11c\uc5c6\uc74c"]}})),this._renderPages()},_renderPageSize:function(){this.pageSizeView=new a({pageSize:this.collection.pageSize}),this.pageSizeView.render(),this.pageSizeView.bind("changePageSize",this.selectPageSize,this)},_renderPages:function(){this.pageView=new f({pageInfo:this.collection.pageInfo()}),this.pageView.bind("paging",this.selectPage,this),this.$el.find("div.tool_absolute > div.dataTables_paginate").remove(),this.$el.find("div.tool_absolute").append(this.pageView.render().el)},selectPage:function(e){this.collection.setPageNo(e),this.collection.fetch()},selectPageSize:function(e){this.collection.setPageSize(e),this.collection.fetch()},_renderList:function(){this.checkboxColumn={id:"checkedAllDocs",name:"checkedAllDocs"};var e=new u({collection:this.collection,columns:this.columns,sorts:this.sorts,duration:this.duration,fromDate:this.fromDate,toDate:this.toDate,usePeriod:!0,usePage:!0,isCheckboxVisible:this.isRemovable?!0:!1,checkboxColumn:this.checkboxColumn});this.$el.find("#base_doclist").append(e.render().el),e.setInitSort(),this._bindEvent(e)},_bindEvent:function(e){var t=this;this.$el.find("input#keyword").keydown(function(t){e.searchByEnter(t)}),this.$el.find(".btn_search2").click(function(t){e.search()}),this.$el.find("a#download").click(function(e){t._downloadList()}),this.$el.find("a#bulkDelete").click(function(e){t._bulkDelete(e)}),this.$el.find("a#createDocs").click(function(e){t._createDocs()}),this.$el.find("a#bulkMove").click(function(e){t._moveDocs(e)})},_moveDocs:function(n){var r=e("input.doclist_item_checkbox:checked"),i=this,o=i.folderModel.get("id");if(r.length<1){e.goMessage(b["\uc120\ud0dd\ubb38\uc11c\uc5c6\uc74c"]);return}var u=[];r.each(function(){u.push(e(this).attr("data-docsinfoid"))}),this.popup=e.goPopup({pclass:"layer_normal doc_layer",header:b["\ubb38\uc11c\uc774\ub3d9"],width:300,top:"40%",contents:"<div class='list_wrap'></div>",buttons:[{btext:y["\ud655\uc778"],btype:"confirm",callback:function(n){var r=n.find(".on span[data-folderid]").attr("data-folderid");if(!r)return e.goMessage(b["\ubb38\uc11c\ud568\uc744 \uc120\ud0dd\ud574 \uc8fc\uc138\uc694."]),!1;if(r==o)return e.goMessage(b["\ub2e4\ub978\ubb38\uc11c\ud568\uc120\ud0dd\uc54c\ub9bc"]),!1;var s=new T;s.setFolderId(o),s.setTargetFolderId(r);var a=e.goPreloader();s.save({ids:u},{silent:!0,type:"PUT",beforeSend:function(){a.render()},success:function(t,r){e.goMessage(b["\ubb38\uc11c\uc774\ub3d9\uc644\ub8cc"]),n.close(),e("input:checkbox").attr("checked",!1),i.collection.fetch()},error:function(n,r){var i=r.responseJSON;return!t.isUndefined(i)&&i.message?(e.goError(i.message),!1):(e.goError(y["\uc800\uc7a5\uc5d0 \uc2e4\ud328 \ud558\uc600\uc2b5\ub2c8\ub2e4."]),!1)},complete:function(){a.release()}})}},{btext:y["\ucde8\uc18c"],btype:"normal"}]}),(new s({popupType:"move"})).renderList().then(e.proxy(function(){this.popup.reoffset()},this))},_createDocs:function(){var e=this,t=e.folderModel.get("id");i.router.navigate("docs/create/"+t,!0)},_downloadList:function(){var e=this,t=e.folderModel.get("id");window.location.href=i.contextRoot+"api/docs/folder/"+t+"/docses/download"},_bulkDelete:function(t){var n=e("input.doclist_item_checkbox:checked"),r=this;if(n.length<1){e.goMessage(b["\uc120\ud0dd\ubb38\uc11c\uc5c6\uc74c"]);return}var i=[];n.each(function(){i.push(e(this).attr("data-docsinfoid"))});var s=new x;e.goConfirm(b["\ubb38\uc11c\uc0ad\uc81c\ud655\uc778"],b["\ubb38\uc11c\uc0ad\uc81c\uc124\uba85"],function(){var t=e.goPreloader();s.set({ids:i}),s.save({},{silent:!0,type:"DELETE",beforeSend:function(){t.render()},success:function(){e.goMessage(y["\uc0ad\uc81c\ub418\uc5c8\uc2b5\ub2c8\ub2e4."]),e("input:checkbox").attr("checked",!1),r.collection.fetch()},error:function(){e.goError(y["\uc2e4\ud328\ud588\uc2b5\ub2c8\ub2e4."])},complete:function(){t.release()}})})}})});