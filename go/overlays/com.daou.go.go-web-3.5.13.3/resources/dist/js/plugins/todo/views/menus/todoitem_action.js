define("todo/views/menus/todoitem_action",["components/history_menu/main","hgn!todo/templates/menus/menu_items_menu","todo/views/menus/search_member","todo/views/menus/select_label","todo/views/menus/remove_confirm","todo/views/menus/move_card","todo/views/menus/duedate","i18n!todo/nls/todo","i18n!nls/commons","components/go-fileuploader/main","components/go-fileuploader/mobile"],function(e,t,n,r,i,s,o,u,a,f,l){function d(){var e=v.call(this),t=this.model,n={url:e.fileUrl,webFolderUrl:e.webFolderUrl+"/webfolder",isToDo:!0};this.$el.find(".todoitem-attach-file a").attr("data-attachtype","file"),GO.util.isMobile()?(GO.util.isMobileApp()?(this.$el.find(".todoitem-attach-image a").attr("data-attachtype","image"),n.url=this.$el.find(".go-fileuploader a").data("url")):n.error=function(){alert(a["\uc5c5\ub85c\ub4dc\uc5d0 \uc2e4\ud328\ud558\uc600\uc2b5\ub2c8\ub2e4."])},n.success=function(e){var n=typeof e=="string"?JSON.parse(e):e.data;window.target.context.className.indexOf("todoitem-attach-webfolder")>-1?t.addFile(n.data):(n.hasOwnProperty("data")&&(n=n.data),GO.util.isMobileApp()?t.updateFile(m(n)):t.addFile(n))}):(n.success=function(e){t.addFile(e)},n.error=function(e){$.goSlideMessage(e,"caution")}),GO.util.isMobile()?l.bind(this.$el.find(".go-fileuploader a"),n):f.bind(this.$el.find(".go-fileuploader a"),n)}function v(){var e={},t=this.model;return e.webFolderUrl=[GO.config("contextRoot")+"api/todo",t.get("todoId"),"item",t.id,"file"].join("/"),GO.util.isMobileApp()?e.fileUrl=GO.config("contextRoot")+"api/file":e.fileUrl=e.webFolderUrl,e}function m(e){return{name:e.fileName,size:e.fileSize,extention:e.fileExt,path:e.filePath}}var c,h=e.HistoriableMenuView,p=[];return p.push({classname:"todoitem-members",next_view:"",menu_name:u["\ub2f4\ub2f9\uc790"],icon_class:!1,has_child:!1}),p.push({classname:"todoitem-labels",next_view:"",menu_name:u["\ub77c\ubca8"],icon_class:!1,has_child:!1}),p.push({classname:"todoitem-duedate",next_view:"",menu_name:u["\uae30\ud55c\uc77c"],icon_class:!1,has_child:!1}),p.push({classname:"todoitem-attach-file go-fileuploader",next_view:"",menu_name:a["\ud30c\uc77c \ucca8\ubd80"],icon_class:!1,has_child:!1}),GO.util.isAndroidApp()&&p.push({classname:"todoitem-attach-image go-fileuploader",next_view:"",menu_name:a["\uc774\ubbf8\uc9c0 \ucca8\ubd80"],icon_class:!1,has_child:!1}),GO.util.isMobile()&&GO.config("isWebFolderAvailable")&&p.push({classname:"todoitem-attach-webfolder go-fileuploader",next_view:"",menu_name:a["\uc790\ub8cc\uc2e4"],icon_class:!1,has_child:!1}),p.push({classname:"move-todoitem",next_view:"",menu_name:a["\uc774\ub3d9"],icon_class:!1,has_child:!1}),p.push({classname:"remove-todoitem",next_view:"",menu_name:a["\uc0ad\uc81c"],icon_class:!1,has_child:!1}),TodoItemActionMenuView=h.extend({id:"todoitem-action-menu",className:"content",template:t,name:"todoitem-action-menu",title:u["\uce74\ub4dc \uc561\uc158"],todoModel:null,events:{"click .todoitem-members":"_callSearchMemberMenu","click .todoitem-labels":"_callSelectLabelMenu","click .remove-todoitem":"_callRemoveConfirmMenu","click .move-todoitem":"_callMoveCardMenu","click .todoitem-duedate":"_callDuedateMenu"},initialize:function(e){e=e||{},this.todoModel=e.todoModel,h.prototype.initialize.call(this,e)},render:function(){this.$el.empty().append(this.template({menulist:p})),this.setMenuClass("layer_todo_board"),d.call(this)},_callSearchMemberMenu:function(e){e.preventDefault(),this.forward(new n({model:this.model,todoModel:this.todoModel}))},_callSelectLabelMenu:function(e){var t;e.preventDefault(),t=new r({model:this.model,todoModel:this.todoModel}),this.forward(t)},_callRemoveConfirmMenu:function(e){var t=this;if(!this.todoModel.isMember(GO.session("id")))return!1;e.preventDefault(),this.forward(new i({subject:u["\uce74\ub4dc \uc0ad\uc81c \ud0c0\uc774\ud2c0"],description:u["\uce74\ub4dc \uc0ad\uc81c \ud655\uc778 \uba54\uc2dc\uc9c0"],afterClick:function(){t.model.remove().then(function(){t.close()})}}))},_callMoveCardMenu:function(e){var t=this;if(!this.todoModel.isMember(GO.session("id")))return!1;e.preventDefault(),this.forward(new s({model:this.model,todoModel:this.todoModel}))},_callDuedateMenu:function(e){e.preventDefault(),this.forward(new o({model:this.model}))}}),TodoItemActionMenuView});