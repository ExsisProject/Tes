define("todo/views/site/todo_column",["backbone","app","todo/constants","todo/models/todo_item","todo/views/site/todo_card","todo/views/menus/main","todo/views/site/edit_text_form","hgn!todo/templates/todo_column","todo/libs/util","i18n!nls/commons","i18n!todo/nls/todo","jquery.go-validation","jquery.go-popup"],function(e,t,n,r,i,s,o,u,a,f,l){function v(){var e=m.call(this),t=e.length;t>0?(_.each(e,_.bind(g,this)),y.call(this,t)):w.call(this)}function m(){return this.todoItemList.where({todoCategoryId:this.model.id})}function g(e){var t=new i({model:e,todoModel:this.todoModel,onRemoved:_.bind(function(e){this.todoItemList.remove(e.model)},this)});this.$el.find(d.detail.cardContainer).append(t.el),this.subViews.push(t)}function y(e){var t=this.$el.find(".ui-card-count"),n=e||(m.call(this)||[]).length,r=n>0;r&&t.text(n),t.toggle(r)}function b(){return this.$el.find(".null_data")}function w(){this.$el.find(d.detail.cardContainer).empty().append('<p class="null_data">'+l["\ub4f1\ub85d\ub41c \uce74\ub4dc \uc5c6\uc74c"]+"</p>")}function E(){b.call(this).remove()}function S(){var e=this.$el.find(d.detail.todoCard).length,t=b.call(this).length;e>0&&t>0?E.call(this):e<=0&&t<=0&&w.call(this)}function x(){var e=_.findWhere(this.todoModel.getCategories(),{id:this.model.id});e&&this.model.set(e)}function T(e,t,n){return a.callActionForMember(e,t,n)}var c,h,p,d=n.SELECTORS;return h=o.extend({todoModel:null,categoryModel:null,initialize:function(e){this.todoModel=e.todoModel,this.categoryModel=e.categoryModel,this.name="add-card-form-"+this.todoModel.id,o.prototype.initialize.call(this,e)},_confirm:function(e){var n=this,i=this.getValue(),s=this.categoryModel.id;if(!$.goValidation.isCheckLength(1,1e3,i))return $.goMessage(t.i18n(f["0\uc790\uc774\uc0c1 0\uc774\ud558 \uc785\ub825\ud574\uc57c\ud569\ub2c8\ub2e4."],{arg1:1,arg2:1e3})),this.$el.find("textarea").focus(),!1;e.preventDefault(),r.createFromTodo(this.todoModel,s,i).then(function(e){n.confirm(e)})}}),p=o.extend({todoModel:null,categoryModel:null,initialize:function(e){this.todoModel=e.todoModel,this.categoryModel=e.categoryModel,this.name="edit-column-title-form-"+this.todoModel.id,o.prototype.initialize.call(this,e)},_confirm:function(e){var n=this,r=this.getValue(),i=this.categoryModel.id;if(!$.goValidation.isCheckLength(1,1e3,r))return $.goMessage(t.i18n(f["0\uc790\uc774\uc0c1 0\uc774\ud558 \uc785\ub825\ud574\uc57c\ud569\ub2c8\ub2e4."],{arg1:1,arg2:1e3})),$("textarea[name=content]").focus(),!1;e.preventDefault(),this.todoModel.updateCategoryTitle(i,r).then(function(e){n.confirm(e)})}}),c=e.View.extend({className:"ui-todocolumn ui-column-container board_column_wrap",template:u,subViews:[],events:{"click .btn-add-card":"_callAddCardForm","click .btn-action-menu":"_callActionMenu","click .ui-column-title":"_callEditTitleForm"},initialize:function(e){e=e||{},this.subViews=[],this.todoModel=e.todoModel,this.todoItemList=e.todoItemList,this.columnWidth=e.columnWidth,this.$el.addClass("ui-todocolumn-"+this.model.id),this.$el.attr("data-categoryid",this.model.id),this.$el.data("view",this),this.render(),this.listenTo(this.todoModel,"change:categories",x,this),t.EventEmitter.on("todo","resize:column",this.resize,this)},remove:function(){_.each(this.subViews,function(e){e.remove()}),e.View.prototype.remove.apply(this,arguments)},render:function(){this.$el.empty().append(this.template({category:this.model.toJSON(),title:t.util.unescapeHtml(this.model.get("title")),"editable?":this.todoModel.isMember(t.session("id")),label:{add_card:l["\uce74\ub4dc \ucd94\uac00"]}})),this.columnWidth&&this.$el.width(this.columnWidth),v.call(this)},resize:function(){var e=$(d.detail.boardContent).height(),t=this.$el.find("header").outerHeight(),n=this.$el.find(".create_form").outerHeight(),r=this.$el.find(d.detail.cardContainer).outerHeight(),i=this.$el.find(d.detail.addCardButton).outerHeight(),s=50,o=t+r+i+s+n,u=this.$el.find(d.common.scrollContainer);if(!this.$el.parents("body").length)return;if(r<=0)return;o<e?u.height(r):u.height(e-t-i-s-n),S.call(this),y.call(this)},reorder:function(e){this.model.set("seq",e)},takeOutCardView:function(e){this.subViews=_.reject(this.subViews,function(t,n){return e.getItemId()===t.getItemId()})},_callAddCardForm:function(e){var n=$(e.currentTarget),r=n.parent(),i=this.$el.find(d.common.scrollContainer),s=this,o;e.preventDefault(),T.call(this,this.todoModel,e,function(e){o=new h({todoModel:s.todoModel,categoryModel:s.model,afterConfirm:function(e){E.call(s),s.todoItemList.add(e),g.call(s,e),t.EventEmitter.trigger("todo","resize:column"),r.show()},afterCancel:function(){t.EventEmitter.trigger("todo","resize:column"),r.show()}}),r.hide().after(o.el),t.EventEmitter.trigger("todo","resize:column"),i.scrollTop(i.get(0).scrollHeight),r.parent().find('textarea[name="content"]').focus()})},_callActionMenu:function(e){var t=$(e.currentTarget),n=this;e.preventDefault(),T.call(this,this.todoModel,e,function(e){s.attachTo(t,new s.ColumnActionMenuView({columnView:n}))})},_callEditTitleForm:function(e){var n=$(e.currentTarget),r=n.closest("h1"),i=r.find(".ui-column-title"),s=this,o;e.preventDefault(),T.call(this,this.todoModel,e,function(e){o=new p({todoModel:s.todoModel,categoryModel:s.model,content:i.text(),afterConfirm:function(e){i.text(t.util.unescapeHtml(e.get("title"))),r.show()},afterCancel:function(){r.show()}}),r.hide().after(o.el)})}}),c});