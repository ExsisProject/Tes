define("todo/views/site/card_detail",["backbone","app","todo/views/site/card_activity_list","todo/views/site/edit_text_form","todo/views/menus/main","todo/libs/util","hgn!todo/templates/add_checklistitem_form","hgn!todo/templates/todo_card_content","text!todo/templates/partials/_member_button.html","text!todo/templates/partials/_user_thumbnail.html","i18n!nls/commons","i18n!todo/nls/todo","components/go-fileuploader/main","components/go-fileuploader/mobile","libs/go-utils","jquery.go-validation","jquery.go-popup","jquery.fancybox-buttons","jquery.fancybox-thumbs","jquery.fancybox","go-fancybox"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d){function x(){var e={};t.util.isMobile()?e={left:0,top:0,"margin-left":0}:e={left:"50%",top:"35px","margin-left":"-400px"},this.$el.find(".ui-todocard-content").css(e)}function T(){var e=this.model;if(!t.util.isMobile()){var n=this;setTimeout(function(){R.call(n)},300)}}function N(){_.each(this.subViews,function(e){e.remove()})}function C(){var e=new n({todoItemModel:this.model});this.$el.find(".card-detail-container").append(e.el),e.render(),this.subViews.activityListView=e}function k(){$(".ui-todocard-container").scroll(_.bind(function(){L.call(this)},this))}function L(){var e=$(".ui-todocard-container").scrollTop();this.$el.find(".action-buttons").stop().animate({top:e+"px"},350)}function A(){var e={url:this.$el.find("[data-fileuploader]").data("url")||t.config("contextRoot")+"api/file",webFolderUrl:this.$el.find("[data-webfolder-uploader]").data("url")+"/webfolder",isToDo:!0},n=this.model;e.totalAttachSize=this.getViewedTotalAttachSize(),e.totalAttachCount=this.model.get("attaches").length,t.util.isMobile()?(e.success=function(e){var r=typeof e=="string"?JSON.parse(e):e.data;window.target.context.id==="todoWebFolder"?n.addFile(r.data):(r.hasOwnProperty("data")&&(r=r.data),t.util.isMobileApp()?n.updateFile(O(r)):n.addFile(r))},t.util.isMobileApp()||(e.error=function(){$.goSlideMessage("upload fail","caution")})):(e.success=function(e){n.addFile(e)},e.error=function(e){$.goSlideMessage(e,"caution")},e.dropZone=this.$("#dropZone"),e.progressEl=this.$("div.progress")),t.util.isMobile()?p.bind(this.$el.find("[data-fileuploader]"),e):h.bind(this.$el.find("[data-fileuploader]"),e)}function O(e){return{name:e.fileName,size:e.fileSize,extention:e.fileExt,path:e.filePath}}function M(){var e=this.model,t;this.$el.find(".ui-checklist-items").sortable({items:".ui-checklist-item",connectWith:".ui-checklist-items",start:function(n,r){var i=r.item.closest(".ui-checklist-container");t=e.getChecklist(i.data("checklistid"))},stop:function(n,r){var i=r.item.closest(".ui-checklist-container"),s=t.id,o=i.data("checklistid"),u=r.item.data("itemid"),a=D(i.find(".ui-checklist-item"),u);e.moveChecklistItem(s,u,o,a)}})}function D(e,t){var n=0;return e.each(function(e,r){if($(r).data("itemid")===t){n=e;return}}),n}function P(e,t){return s.callActionForMember.call(this,this.todoModel,e,t)}function H(){var e=this.model.get("dueDate"),n=this.todoModel.getCategory(this.model.get("todoCategoryId")),r=this.model.get("checklists"),i=this.model.get("attaches"),s=t.util.autolink(t.util.escapeHtml(this.model.get("content")||""));return{title:t.util.escapeHtml(this.model.get("title")),content:s,view_cid:this.cid,model:this.model.toJSON(),column_name:n.title,lang:v,checklists:I.call(this,r),attaches:q.call(this,i),"editable?":this.todoModel.isMember(t.session("id")),"hasMembers?":this.model.hasMembers(),"hasLabels?":this.model.hasLabels(),"hasDuedate?":!!e,duedate:e?j(e):!1,"delayed?":this.model.isDelayed(),"hasChecklists?":this.model.hasChecklists(),"hasAttaches?":t.util.isMobileApp()?i.length>0?!0:!1:!0,"canAttachImage?":F(),fileUploadUrl:B.call(this),"isMobile?":t.util.isMobile(),"isWebFolderUsable?":t.config("isWebFolderAvailable"),isSaaS:this.isSaaS,label:{close:l["\ub2eb\uae30"],member:c["\ub2f4\ub2f9\uc790"],label:c["\ub77c\ubca8"],add:l["\ucd94\uac00"],input_description:c["\uc0c1\uc138\ub0b4\uc6a9 \uc785\ub825"],timeline:c["\ud0c0\uc784\ub77c\uc778"],duedate:c["\uae30\ud55c\uc77c"],checklist:c["\uc138\ubd80\uc791\uc5c5"],attach_file:l["\ud30c\uc77c\ucca8\ubd80"],attach_image:l["\uc774\ubbf8\uc9c0 \ucca8\ubd80"],action:c["\uc561\uc158"],move:l["\uc774\ub3d9"],remove_card:l["\uc0ad\uc81c"],add_label:c["\ub77c\ubca8 \ucd94\uac00"],add_member:c["\ub2f4\ub2f9\uc790 \uc9c0\uc815"],preview:l["\ubbf8\ub9ac\ubcf4\uae30"],remove:l["\uc0ad\uc81c"],download:l["\ub2e4\uc6b4\ub85c\ub4dc"],add_checklist_item:c["\ud56d\ubaa9 \ucd94\uac00"],webfolder:l["\uc790\ub8cc\uc2e4"],"\uc774 \uacf3\uc5d0 \ud30c\uc77c\uc744 \ub4dc\ub798\uadf8 \ud558\uc138\uc694":l["\uc774 \uacf3\uc5d0 \ud30c\uc77c\uc744 \ub4dc\ub798\uadf8 \ud558\uc138\uc694"],"\uc774 \uacf3\uc5d0 \ud30c\uc77c\uc744 \ub4dc\ub798\uadf8 \ud558\uc138\uc694 \ub610\ub294":l["\uc774 \uacf3\uc5d0 \ud30c\uc77c\uc744 \ub4dc\ub798\uadf8 \ud558\uc138\uc694 \ub610\ub294"],"\ud30c\uc77c\uc120\ud0dd":l["\ud30c\uc77c\uc120\ud0dd"],"\ucca8\ubd80\ud30c\uc77c 1\uac1c\uc758 \ucd5c\ub300 \uc6a9\ub7c9\uc740 NNN MB \uc774\uba70 \ucd5c\ub300 N\uac1c \uae4c\uc9c0 \ub4f1\ub85d \uac00\ub2a5\ud569\ub2c8\ub2e4":t.i18n(l["\ucca8\ubd80\ud30c\uc77c 1\uac1c\uc758 \ucd5c\ub300 \uc6a9\ub7c9\uc740 {{size}} MB \uc774\uba70 \ucd5c\ub300 {{number}} \uac1c \uae4c\uc9c0 \ub4f1\ub85d \uac00\ub2a5\ud569\ub2c8\ub2e4"],{size:t.config("commonAttachConfig").maxAttachSize,number:t.config("commonAttachConfig").maxAttachNumber})}}}function B(){var e={},n=this.model;return e.webFolderUrl=[t.config("contextRoot")+"api/todo",n.get("todoId"),"item",n.id,"file"].join("/"),t.util.isMobileApp()?e.fileUrl=t.config("contextRoot")+"api/file":e.fileUrl=e.webFolderUrl,e}function j(e){return s.parseDuedate(e)}function F(){return t.util.isAndroidApp()}function I(e){return _.map(e,function(e){_.map(e.checklistItems,function(e){e.checked=e.checkFlag==="Y"})}),e}function q(e){var n=[],r=[],i=this.todoModel,s=this.model;return _.each(e||[],function(e){var o=$.extend(!0,{},e);o.removable=i.isMember(t.session("id")),o.humanSize=d.getHumanizedFileSize(o.size),o.downloadUrl=[t.config("contextRoot")+"api/todo",s.get("todoId"),"item",s.id,"download",o.id].join("/"),o.hasOwnProperty("updatedAt")&&(o.updatedAt=moment(o.updatedAt).format("YYYY-MM-DD(dd) HH:mm")),d.isImage(o.name)?t.util.isMobile()&&!o.mobilePreview?n.push(o):r.push(o):n.push(o)}),{files:n,images:r}}function R(){$(".fancybox-thumbs").goFancybox()}var v={copy_url:l["URL \ubcf5\uc0ac"]},m,g,y,b,w,E,S;return g=r.extend({initialize:function(e){e=e||{},e.content=t.util.unescapeHtml(this.model.get("title")),this.name="card-title-edit-form-"+this.model.id,r.prototype.initialize.call(this,e)},_confirm:function(e){var n=this,r=this.getValue();if(!$.goValidation.isCheckLength(1,1e3,r))return $.goMessage(t.i18n(l["0\uc790\uc774\uc0c1 0\uc774\ud558 \uc785\ub825\ud574\uc57c\ud569\ub2c8\ub2e4."],{arg1:1,arg2:1e3})),this.$el.find("textarea").focus(),!1;e.preventDefault(),this.model.updateTitle(r).then(function(e){n.remove(),n.afterConfirm.call(n,e)})}}),y=r.extend({initialize:function(e){e=e||{},e.content=t.util.unescapeHtml(this.model.get("content")),e.enterNewLine=!0,e.autoExpand=!0,e.removable=!0,this.name="card-desc-edit-form-"+this.model.id,r.prototype.initialize.call(this,e)},_confirm:function(e){var t=this,n=this.getValue();e.preventDefault(),this.model.updateContent(n).then(function(e){t.remove(),t.afterConfirm.call(t,e)})},_destroy:function(e){var t=this,n=this.model;e.preventDefault(),i.attachTo($(e.currentTarget),new i.RemoveConfirmMenuView({subject:c["\uce74\ub4dc \uc0c1\uc138\ub0b4\uc6a9 \uc0ad\uc81c \ud655\uc778 \ud0c0\uc774\ud2c0"],description:c["\uce74\ub4dc \uc0c1\uc138\ub0b4\uc6a9 \uc0ad\uc81c \ud655\uc778 \uba54\uc2dc\uc9c0"],afterClick:function(){var e=this;n.updateContent("").then(function(n){t.remove(),t.afterRemove.call(t,n),e.back()})}}))}}),b=r.extend({checklist:null,initialize:function(e){e=e||{},this.checklist=this.model.getChecklist(e.checklistId),e.content=t.util.unescapeHtml(this.checklist.title),this.name="checklist-title-edit-form-"+this.model.id,r.prototype.initialize.call(this,e)},_confirm:function(e){var n=this,r=this.getValue();if(!$.goValidation.isCheckLength(1,1e3,r))return $.goMessage(t.i18n(l["0\uc790\uc774\uc0c1 0\uc774\ud558 \uc785\ub825\ud574\uc57c\ud569\ub2c8\ub2e4."],{arg1:1,arg2:1e3})),this.$el.find("textarea").focus(),!1;e.preventDefault(),this.model.updateChecklistTitle(this.checklist.id,r).then(function(e){n.remove(),n.afterConfirm.call(n,n)})}}),w=r.extend({className:"checklist-item-addform check_item",checklist:null,template:o,events:function(){var e=_.result(r.prototype,"events")||{};return _.extend({},e,{"focus .checklist-item-text":"_showActionBtn","submit #form-checklist-item":"_confirm"})},initialize:function(e){e=e||{},e.templateVariables=$.extend(!0,{},{label:{add_checklist_item:c["\ud56d\ubaa9 \uc785\ub825"]}},e.templateVariables||{}),this.name="checklist-item-form-"+this.model.id,this.checklist=this.model.getChecklist(e.checklistId),r.prototype.initialize.call(this,e)},getValue:function(){return d.stripIllegalTags(this.$el.find("input[name=title]").val())},_showActionBtn:function(e){this.$el.find(".checklist-item-actions").show()}}),E=w.extend({initialize:function(e){e=e||{},this.name="checklist-item-add-form-"+this.model.id,w.prototype.initialize.call(this,e)},_confirm:function(e){var n=this,r=this.getValue();if(!$.goValidation.isCheckLength(1,1e3,r))return $.goMessage(t.i18n(l["0\uc790\uc774\uc0c1 0\uc774\ud558 \uc785\ub825\ud574\uc57c\ud569\ub2c8\ub2e4."],{arg1:1,arg2:1e3})),this.$el.find("textarea").focus(),!1;e.preventDefault(),this.model.addChecklistItem(this.checklist.id,r).then(function(e){n.confirm(n)})}}),S=w.extend({initialize:function(e){e=e||{},this.name="checklist-item-edit-form-"+this.model.id,this.checklistItemId=e.checklistItemId,w.prototype.initialize.call(this,e)},_confirm:function(e){var n=this,r=this.getValue();if(!$.goValidation.isCheckLength(1,1e3,r))return $.goMessage(t.i18n(l["0\uc790\uc774\uc0c1 0\uc774\ud558 \uc785\ub825\ud574\uc57c\ud569\ub2c8\ub2e4."],{arg1:1,arg2:1e3})),this.$el.find("textarea").focus(),!1;e.preventDefault(),this.model.updateChecklistItemTitle(this.checklist.id,this.checklistItemId,r).then(function(e){n.confirm(n)})}}),m=e.View.extend({className:"ui-todocard-container overlay_scroll",categoryModel:null,subViews:{},events:{"click .ui-card-title h1":"_callCardTitleEditForm","click .btn-edit-content":"_callCardDescEditForm","click .ui-card-content":"_callCardDescEditForm","click .ui-card-content a":"_stopPropagation","click .btn-close":"_close","click .btn-add-member":"_callSearchMemberMenu","click .btn-duedate":"_callDuedateMenu","click .btn-add-checklist":"_addChecklist","click .btn-edit-label":"_callSelectLabelMenu","click .btn-card-move":"_callMoveCardMenu","click .btn-card-remove":"_callRemoveCardConfirmMenu","click .ui-user-photo":"_callMemberProfileMenu","click .ui-checklist-container h2":"_callChecklistTitleEditForm","click .btn-checklist-remove":"_callRemoveChecklistConfirmMenu","click .btn-add-checklist-item":"_callChecklistItemAddForm","click .ui-checklist-item-text":"_callChecklistItemEditForm","click .ui-checklist-checkbox":"_checkChecklistItem","click .btn-file-remove":"_callRemoveFileConfirmMenu","click .btn-file-preview":"_callFilePreviewWindow","click .btn-file-download":"_downloadFile","click .btn-image-view":"_viewImage","click .btn-checklistitem-remove":"_removeChecklistItem","click #scrollToTop_card_detail":"_scrollToTop","dragover #dropZone":"_dragOver","dragleave #dropZone":"_dragLeave","drop #dropZone":"_drop"},_stopPropagation:function(e){return e.stopPropagation(),!0},initialize:function(n){var r=this;n=n||{},this.todoModel=n.todoModel,this.$el.data("view",this),e.View.prototype.initialize.call(this,n),this._initRender(),this.listenTo(this.model,"change:members",this.reloadContent),this.listenTo(this.model,"change:labels",this.reloadContent),this.listenTo(this.model,"change:title",this.reloadContent),this.listenTo(this.model,"change:content",this.reloadContent),this.listenTo(this.model,"change:dueDate",this.reloadContent),this.listenTo(this.model,"change:checklists",this.reloadContent),this.listenTo(this.model,"change:attaches",this.reloadContent),t.EventEmitter.on("todo","close:cardLayer",this.remove,this),this.$el.on("click.go.todo",function(e){e.target==this&&r.close(),$(document).trigger("go.todo.clearmenu")}),this.$el.on("scroll",function(e){r.timeout&&clearTimeout(r.timeout),r.timeout=setTimeout(function(){var t=e.currentTarget.scrollTop,n=this.$("#scrollToTop_card_detail");t==0?n.hide():t>0&&!n.is(":visible")&&n.show()},20)}),this.isSaaS=t.session().brandName=="DO_SAAS"},_dragOver:function(e){e.preventDefault(),e.stopPropagation(),e.originalEvent.dataTransfer.dropEffect="move",$("#dropZone").addClass("drag_file")},_dragLeave:function(e){e.preventDefault(),e.stopPropagation(),$("#dropZone").removeClass("drag_file")},_drop:function(e){this._dragLeave(e)},_scrollToTop:function(e){$(e.currentTarget).parent().parent().scrollTop(0)},render:function(){this._renderContent(),x.call(this),T.call(this),A.call(this),M.call(this),C.call(this),L.call(this),k.call(this)},remove:function(){return N.call(this),e.View.prototype.remove.apply(this,arguments)},reloadContent:function(){N.call(this),this._renderContent(),T.call(this),A.call(this),M.call(this),C.call(this)},close:function(){this.remove(),t.router.navigate("todo/"+this.todoModel.id,{pushState:!0,trigger:!1})},_initRender:function(){this.$el.html('<div class="ui-todocard-content layer_type_detail layer_todo_card"></div>')},_renderContent:function(){this.$(".ui-todocard-content").empty().append(u(H.call(this),{_member_button:a,_user_thumbnail:f})),this.setViewedTotalAttachSize()},_close:function(e){e.preventDefault(),this.close()},_callCardTitleEditForm:function(e){return e.preventDefault(),P.call(this,e,function(e){var t=$(e.currentTarget),n=t.closest(".ui-card-title"),r=this,i;i=new g({model:this.model,afterConfirm:function(){r.model.hasChanged("title")||r.model.trigger("change:title")},afterCancel:function(){r.reloadContent()}}),n.find("h1").hide(),n.find(".ui-column-name").hide(),n.append(i.el)})},_callCardDescEditForm:function(e){return e.preventDefault(),P.call(this,e,function(e){var t=$(e.currentTarget),n=t.closest(".ui-content-container"),r=this.$el.find(".ui-card-content"),i=this,s,o={model:this.model,afterConfirm:function(){i.model.hasChanged("content")||i.model.trigger("change:content")},afterCancel:function(){i.reloadContent()}};this.model.get("content")&&this.model.get("content").length>0?(o.textareaHeight=r.height(),o.textareaMaxHeight=$(document).height()-r.offset().top*2):o.textareaRows=10,s=new y(o),n.empty().append(s.el)})},_callSearchMemberMenu:function(e){return e.preventDefault(),P.call(this,e,function(e){var t=$(e.currentTarget),n=this.model;i.attachTo(t,new i.SearchMemberMenuView({zIndex:999,model:n,todoModel:this.todoModel}))})},_callDuedateMenu:function(e){return e.preventDefault(),P.call(this,e,function(e){var t=$(e.currentTarget),n=this.model;i.attachTo(t,new i.DuedateMenuView({model:n}))})},_addChecklist:function(e){var t=this;return e.preventDefault(),P.call(this,e,function(e){this.model.createChecklist(c["\uc138\ubd80\uc791\uc5c5"]).then(function(e){var n=t.$el.find(".ui-checklist-container").last();n.find(".btn-add-checklist-item").trigger("click")}).otherwise(function(e){console.log(e.stack)})})},_callSelectLabelMenu:function(e){return e.preventDefault(),P.call(this,e,function(e){var t=$(e.currentTarget),n=this.model;i.attachTo(t,new i.SelectLabelMenuView({model:n,todoModel:this.todoModel}))})},_callMoveCardMenu:function(e){return e.preventDefault(),P.call(this,e,function(e){var t=$(e.currentTarget),n=this.model;i.attachTo(t,new i.MoveCardMenuView({model:n,todoModel:this.todoModel}))})},_callRemoveCardConfirmMenu:function(e){return e.preventDefault(),P.call(this,e,function(e){var t=$(e.currentTarget),n=this,r=this.model;i.attachTo(t,new i.RemoveConfirmMenuView({subject:c["\uce74\ub4dc \uc0ad\uc81c \ud0c0\uc774\ud2c0"],description:c["\uce74\ub4dc \uc0ad\uc81c \ud655\uc778 \uba54\uc2dc\uc9c0"],afterClick:function(){var e=this;r.remove().then(function(){n.close(),e.back()})}}))})},_callRemoveFileConfirmMenu:function(e){return e.preventDefault(),P.call(this,e,function(e){var t=$(e.currentTarget),n=t.closest(".ui-attach-file"),r=n.data("attachid"),s=this.model;i.attachTo(t,new i.RemoveConfirmMenuView({subject:c["\ud30c\uc77c \uc0ad\uc81c \ud0c0\uc774\ud2c0"],description:c["\ud30c\uc77c \uc0ad\uc81c \ud655\uc778 \uba54\uc2dc\uc9c0"],afterClick:function(){var e=this;s.removeFile(r).then(function(){e.back()})}}))})},_callMemberProfileMenu:function(e){var t=$(e.currentTarget),n=parseInt(t.data("userid")),r=this.model;e.preventDefault(),i.attachTo(t,new i.CardMemberProfileMenuView({todoModel:this.todoModel,todoItemModel:r,userId:n}))},_callChecklistTitleEditForm:function(e){return e.preventDefault(),P.call(this,e,function(e){var t=$(e.currentTarget),n=t.closest(".ui-checklist-container"),r=parseInt(n.data("checklistid")),i;i=new b({model:this.model,checklistId:r,afterCancel:function(){t.show()}}),t.hide().after(i.el)})},_callChecklistItemAddForm:function(e){return e.preventDefault(),P.call(this,e,function(e){var t=$(e.currentTarget),n=t.closest(".ui-checklist-container"),r=parseInt(n.data("checklistid")),i;i=new E({model:this.model,checklistId:r,afterCancel:function(){t.show()}}),t.hide().before(i.el)})},_callChecklistItemEditForm:function(e){return e.preventDefault(),P.call(this,e,function(e){var t=$(e.currentTarget),n=t.closest(".ui-checklist-item"),r=t.closest(".ui-checklist-container"),i=t.closest(".ui-checklist-item"),s=parseInt(r.data("checklistid")),o=parseInt(i.data("itemid")),u;u=new S({model:this.model,checklistId:s,checklistItemId:o,content:t.text(),afterCancel:function(){n.show()}}),n.hide().after(u.el)})},_checkChecklistItem:function(e){return e.preventDefault(),P.call(this,e,function(e){var t=$(e.currentTarget),n=t.closest(".ui-checklist-container"),r=t.closest(".ui-checklist-item"),i=parseInt(n.data("checklistid")),s=parseInt(r.data("itemid")),o;this.model.toggleChecklistItem(i,s)})},_callRemoveChecklistConfirmMenu:function(e){return e.preventDefault(),P.call(this,e,function(e){var t=$(e.currentTarget),n=t.closest(".ui-checklist-container"),r=parseInt(n.data("checklistid")),s=this.model;i.attachTo(t,new i.RemoveConfirmMenuView({subject:c["\uccb4\ud06c\ub9ac\uc2a4\ud2b8 \uc0ad\uc81c \ud0c0\uc774\ud2c0"],description:c["\uccb4\ud06c\ub9ac\uc2a4\ud2b8 \uc0ad\uc81c \ud655\uc778 \uba54\uc2dc\uc9c0"],afterClick:function(){var e=this;s.removeChecklist(r).then(function(){e.back()})}}))})},_callFilePreviewWindow:function(e){var n=$(e.currentTarget),r=n.closest(".ui-attach-file"),i=r.data("attachid"),s=this.model,o=s.getFile(i);e.preventDefault(),o.preview&&o.hasOwnProperty("encrypt")&&t.util.preview(o.encrypt)},_downloadFile:function(e){var n=this,r=$(e.currentTarget),i=r.closest(".ui-attach-file"),s=r.attr("data-fancybox-group"),o=this.model,u=i.data("attachid"),a=o.getFile(u);e.preventDefault();if(t.util.isMobile()){if(!a.download)return!1;if(d.isImage(a.name))if(s){var f=r.parent().parent().find('a[data-fancybox-group="'+s+'"]'),l=[],c=0;$.each(f,function(e,t){var r=$(t),i=r.closest(".ui-attach-file").data("attachid");l.push({fileName:r.attr("title"),url:n._getDownloadUrl(i)}),i==u&&(c=e)}),t.util.attachImages(l,c)}else t.util.attachImages([{fileName:a.name,url:n._getDownloadUrl(u)}],0);else{var h=location.protocol+"//"+location.host;t.util.attachFiles(h+n._getDownloadUrl(u),a.name,a.size)}}else location.href=n._getDownloadUrl(u)},_viewImage:function(e){var n=this,r=$(e.currentTarget),i=r.closest(".ui-attach-file"),s=r.attr("data-fancybox-group"),o=this.model,u=i.data("attachid"),a=o.getFile(u);e.preventDefault();if(t.util.isMobile()){if(s){var f=r.parent().parent().find('a[data-fancybox-group="'+s+'"]'),l=[],c=0;$.each(f,function(e,t){var r=$(t),i=r.closest(".ui-attach-file").data("attachid");l.push({fileName:r.attr("title"),url:n._getDownloadUrl(i)}),i==u&&(c=e)}),t.util.attachImages(l,c)}}else t.util.attachImages([{fileName:a.name,url:n._getDownloadUrl(u)}],0)},_getDownloadUrl:function(e){var n=this.model;return[t.config("contextRoot")+"api/todo",n.get("todoId"),"item",n.id,"download",e].join("/")},_removeChecklistItem:function(e){var t=$(e.currentTarget),n=t.closest(".ui-checklist-item"),r=t.closest(".ui-checklist-container"),i=n.data("itemid"),s=r.data("checklistid");e.preventDefault(),this.model.removeChecklistItem(s,i).otherwise(function(e){console.log(e.stack)})},syncLabels:function(){var e=[];_.each(this.model.get("labels"),function(t){var n=_.findWhere(this.todoModel.get("labels"),{id:t.id});e.push(n)},this),this.model.set("labels",e),this.model.hasLabels()&&this.reloadContent()},getViewedTotalAttachSize:function(){var e=0;return $("div.content_attach").find(".ui-attach-file").each(function(){e+=parseInt(this.getAttribute("data-size"),0)}),e},setViewedTotalAttachSize:function(){if(this.isSaaS){var e=this.getViewedTotalAttachSize();this.$el.find("#total_size").html(t.util.displayHumanizedAttachSizeStatus(e))}}},{create:function(e,n){var r,i=t.util.isMobile()?"body":".go_body",s=["todo",e.id,"card",n.id].join("/");t.EventEmitter.trigger("todo","go.todo.detail.clearlayers"),r=new m({model:n,todoModel:e}),$(i).append(r.el),r.render(),t.router.navigate(s,{pushState:!0,trigger:!1})}}),m});