define("todo/views/menus/todo_list",["app","todo/models/todos","components/history_menu/main","hgn!todo/templates/menus/menu_items_menu","hgn!todo/templates/partials/_submenu_item","todo/views/menus/create_todo","todo/libs/util","libs/go-utils","i18n!todo/nls/todo","jquery.ui"],function(e,t,n,r,i,s,o,u,a){function g(e){this.myTodoList=e.myTodoList||t.createForMyBoard(),this.favoriteTodoList=e.favoriteTodoList||t.createForFavorite(),this.listenTo(this.myTodoList,"add",this._reloadMyTodoList),this.listenTo(this.myTodoList,"remove",this._reloadMyTodoList),this.listenTo(this.favoriteTodoList,"add",this._reloadFavoriteTodoList),this.listenTo(this.favoriteTodoList,"remove",this._reloadFavoriteTodoList),this.listenTo(this.favoriteTodoList,"resort",this._reloadFavoriteTodoList)}function y(){E("favorite",this.$el.find(p.favorite_list),this.favoriteTodoList),E("my",this.$el.find(p.my_todo_list),this.myTodoList),b.call(this)}function b(){var e=this;this.$el.find(".favorite-list .submenu-list").sortable({items:"li",containment:"#todo-list-menu",stop:function(t,n){var r=n.item.parent(),i=[];r.find("li").each(function(e,t){var n=$(t).data("todoid");i.push(n)}),e.favoriteTodoList.reorder(i).then(function(t){e.favoriteTodoList.trigger("resort")}).otherwise(function(e){console.log(e)})}})}function w(e){var t={my:p.my_todo_list,favorite:p.favorite_list}[e],n={my:this.myTodoList,favorite:this.favoriteTodoList}[e];E(e,this.$el.find(t),n)}function E(e,t,n){var r=t.find(".submenu-list");N(e)==="Y"?S(t):x(t),n.length>0?(t.data("type",e),r.empty(),n.each(function(e){r.append(L(e))}),t.show()):t.hide()}function S(e){var t=e.find(".submenu-list");t.hide(),e.find(".btn-arrow").removeClass("ic_hide_up").addClass("ic_hide_down")}function x(e){var t=e.find(".submenu-list");t.show(),e.find(".btn-arrow").removeClass("ic_hide_down").addClass("ic_hide_up")}function T(e){var t=e.closest(p.foldable),n=t.find(p.submenu_list),r=t.data("type");n.is(":visible")?(S(t),k(r,v.folded)):(x(t),k(r,v.unfolded))}function N(e){var t=h.get(C(e));return t||(k(e,m),t=m),t}function C(e){return d+"-todolist-"+e+"-folded"}function k(e,t){h.set(C(e),t)}function L(e){return i({model:e.toJSON(),board_url:"todo/"+e.id})}var f,l=n.HistoriableMenuView,c=[],h=u.store,p={menuitem:".menuitem",foldable:".foldable",submenu_list:".submenu-list",favorite_list:".favorite-list",my_todo_list:".my-todo-list"},d=e.session("id"),v={folded:"Y",unfolded:"N"},m=v.unfolded;return c.push({classname:"create-todo",next_view:"create_todo",menu_name:a["\uc0c8\ubcf4\ub4dc \ub9cc\ub4e4\uae30"],icon_class:"ic_plus",has_child:!1}),c.push({classname:"goto-dashboard",next_view:"",menu_name:a["ToDO+ \ud648"],icon_class:"ic_home",has_child:!1}),c.push({classname:"favorite-list",next_view:"",menu_name:a["\uc990\uaca8\ucc3e\ub294 \ubcf4\ub4dc"],icon_class:"ic_star",has_child:!0}),c.push({classname:"my-todo-list",next_view:"",menu_name:a["\ub0b4 \ubcf4\ub4dc"],icon_class:"ic_myboard",has_child:!0}),f=l.extend({id:"todo-list-menu",className:"content",name:"todo-list-menu",title:"Board",template:r,myTodoList:null,favoriteTodoList:null,events:{"click .create-todo a":"_callCreateTodoMenuView","click .menuitem-title":"_toggleSubmenu","click .link-board-url":"_navigate","click .goto-dashboard":"_goToDashboard"},initialize:function(e){e=e||{},g.call(this,e),l.prototype.initialize.call(this,e)},render:function(){var e=this.template({menulist:c});this.$el.empty().append(e),this.setMenuClass("layer_todo_board"),y.call(this)},_reloadMyTodoList:function(){w.call(this,"my")},_reloadFavoriteTodoList:function(){w.call(this,"favorite")},_toggleSubmenu:function(e){e.preventDefault(),T($(e.currentTarget))},_callCreateTodoMenuView:function(e){var t=new s({myTodoList:this.myTodoList});e.preventDefault(),this.forward(t)},_navigate:function(t){var n=$(t.currentTarget).find("a").attr("href");t.preventDefault(),e.router.navigate(n,{pushState:!0,trigger:!0}),this.close()},_goToDashboard:function(t){t.preventDefault(),e.router.navigate("todo",{pushState:!0,trigger:!0}),this.close()}},{create:function(e,t,n){return new f(_.extend({myTodoList:e,favoriteTodoList:t},n||{}))}}),f});