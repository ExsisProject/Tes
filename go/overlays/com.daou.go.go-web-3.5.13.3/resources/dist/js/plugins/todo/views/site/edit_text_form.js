define("todo/views/site/edit_text_form",["backbone","hgn!todo/templates/card_add_form","i18n!nls/commons","libs/go-utils","mousetrap"],function(e,t,n,r,i){function f(){var e=this;i.bind(["enter"],function(t){var n=$(t.target);if(!n.is("textarea.mousetrap"))return!0;e.enterNewLine||(t.preventDefault?t.preventDefault():t.returnValue=!1,e._confirm(t))})}function l(){var e=this.$el.find("textarea");this.textareaMaxHeight>0&&e.css("max-height",this.textareaMaxHeight),this.textareaHeight>0&&e.height(this.textareaHeight)}function c(e){var t=e.clientHeight,n=e.scrollHeight,r=Math.abs($(e).outerHeight()-$(e).innerHeight())||0;n>t&&$(e).height(n+r)}function h(){setTimeout(_.bind(function(){var e=this;$(document).on("go.todo.cleareditform",function(t){var n=$(t.relatedTarget);if(n.closest(e.$el).length>0)return;e.$el.is(":visible")&&e.close()})},this),300)}function p(){o.set(a+"."+this.name,this.getValue(),{type:"session"})}function d(){o.set(a+"."+this.name,null,{type:"session"})}var s,o=r.store,u="form_edit_text",a="go.todo."+GO.session("id");return s=e.View.extend({className:"create_form",template:t,name:"edit-text-form",textareaRows:0,textareaHeight:0,textareaMaxHeight:0,autoExpand:!1,removable:!1,templateVariables:{},events:{"click .btn-submit":"_confirm","click .btn-cancel":"_cancel","click .btn-remove":"_destroy","keyup textarea":"_resizeTextarea"},initialize:function(e){e=e||{},this.content=e.content||o.get(a+"."+this.name)||"",this.afterConfirm=e.afterConfirm||function(){},this.afterCancel=e.afterCancel||function(){},this.afterRemove=e.afterRemove||function(){},this.enterNewLine=e.enterNewLine||!1,this.autoExpand=e.autoExpand||!1,this.removable=e.removable||!1,this.textareaRows=e.textareaRows||0,this.textareaHeight=e.textareaHeight||0,this.textareaMaxHeight=e.textareaMaxHeight||0,this.templateVariables=$.extend(!0,{},e.templateVariables||{},{form_name:u,content:this.content,textareaRows:this.textareaRows,removable:this.removable,label:{save:n["\uc800\uc7a5"],cancel:n["\ucde8\uc18c"],remove:n["\uc0ad\uc81c"]}}),this.render()},delegateEvents:function(){e.View.prototype.delegateEvents.apply(this,arguments),f.call(this)},undelegateEvents:function(){e.View.prototype.undelegateEvents.apply(this,arguments),i.reset()},render:function(){this.$el.empty().append(this.template(this.templateVariables)),l.call(this),h.call(this),this.$el.find("textarea").focus()},remove:function(){$(document).off("go.todo.cleareditform"),e.View.prototype.remove.apply(this,arguments)},getValue:function(){return r.stripIllegalTags(this.$el.find("textarea").val())},confirm:function(){d.call(this),this.remove(),this.afterConfirm.apply(this,arguments)},cancel:function(){d.call(this),this.remove(),this.afterCancel.apply(this,arguments)},destroy:function(){d.call(this),this.remove(),this.afterRemove.apply(this,arguments)},close:function(){p.call(this),this.remove(),this.afterCancel.apply(this,arguments)},afterCancel:function(){},afterConfirm:function(){},_confirm:function(e){e.preventDefault(),this.confirm()},_cancel:function(e){e.preventDefault(),this.cancel()},_keyPress:function(e){if(e.keyCode!==13)return;this.enterNewLine||(e.preventDefault(),this._confirm(e))},_resizeTextarea:function(e){console.log(e);if(e.keyCode!==13)return;this.autoExpand&&c(e.currentTarget)},_destroy:function(e){e.preventDefault(),this.destroy()}}),s});