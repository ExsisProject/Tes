define("todo/views/menus/duedate",["components/history_menu/main","hgn!todo/templates/menus/duedate_menu","i18n!todo/nls/todo","i18n!nls/commons","jquery.ui"],function(e,t,n,r){function f(){var e=this.model.get("dueDate"),t;return e?t=moment(this.model.get("dueDate")):t=l(),t}function l(){var e=moment().format("YYYY-MM-DDT")+"12:00:00",t;return moment().isBefore(e)?t=e:t=moment().format("YYYY-MM-DDT")+"23:59:00",moment(t)}function c(e){var t,n=/^([1-3][0-9]{3})[\-\/\.](1[012]|0?[1-9])[\-\/\.]([123][0-9]|0?[1-9])/,r=/^([1-3][0-9]{3})(0[1-9]|1[012])(0[1-9]|[1-3][0-9])/;return n.test(e)&&moment(e).isValid()?t=moment(e):r.test(e)&&moment(e,"YYYYMMDD").isValid()?t=moment(e,"YYYYMMDD"):t=l(),t.format(o)}function h(e){var t;return moment(e,"HH:mm").isValid()?t=moment(e,"HH:mm"):moment(e,"H:m").isValid()?t=moment(e,"H:m"):moment(e,"HH:m").isValid()?t=moment(e,"HH:m"):moment(e,"H:mm").isValid()?t=moment(e,"H:mm"):moment(e,"Hm").isValid()?t=moment(e,"Hm"):moment(e,"Hmm").isValid()?t=moment(e,"Hmm"):moment(e,"HHm").isValid()?t=moment(e,"HHm"):moment(e,"HHmm").isValid()?t=moment(e,"HHmm"):t=l(),t.format(u)}function p(){var e=this.$el.find("input[name=date]");$.datepicker.setDefaults($.datepicker.regional[GO.config("locale")]),this.$el.find(".ui-datepicker-container").datepicker({defaultDate:f.call(this).toDate(),changeMonth:!0,changeYear:!0,yearSuffix:"",onSelect:function(t){e.val(t)}})}var i,s=e.HistoriableMenuView,o="YYYY-MM-DD",u="HH:mm",a="12:00";return i=s.extend({id:"duedate-menu",className:"content",name:"duedate-menu",title:n["\uae30\ud55c\uc77c"],template:t,events:{"click .btn-confirm":"_save","click .btn-cancel":"_remove","keypress input[name=date]":"_getValidDate","keypress input[name=time]":"_getValidTime"},initialize:function(e){e=e||{},s.prototype.initialize.call(this,e)},render:function(){var e=f.call(this);this.$el.empty().append(this.template({date:e.format(o),time:e.format(u),"hasDuedate?":this.model.hasDuedate(),label:{confirm:n["\uae30\ud55c\uc77c \uc9c0\uc815"],cancel:n["\uae30\ud55c\uc77c \ud574\uc81c"]}})),this.setMenuClass("layer_calendar_mini"),this.$el.find(".ui-datepicker-container").show(),p.call(this)},_save:function(e){var t=c(this.$el.find("input[name=date]").val()),n=h(this.$el.find("input[name=time]").val()),r=t+"T"+n+":00",i=this;e.preventDefault(),this.model.updateDueDate(r).then(function(e){i.back()})},_remove:function(e){var t=this;e.preventDefault(),this.model.removeDueDate().then(function(e){t.back()})},_getValidDate:function(e){var t=$(e.currentTarget);e.which==13&&t.val(c(t.val()))},_getValidTime:function(e){var t=$(e.currentTarget);e.which==13&&t.val(h(t.val()))}}),i});