define(["when","views/layouts/default","todo/models/todos","todo/views/site/content_top","go-ignoreduplicatemethod"],function(e,t,n,r,i){function u(){var e=".history-menu";$(document).on("click.go.todo",f).on("click.go.todo",l)}function a(e,t){if(e&&e.which===3)return;if($(e.target).closest(document).length<1)return;$(document).trigger($.Event(t,{relatedTarget:e.target}))}function f(e){a(e,"go.todo.clearmenu")}function l(e){a(e,"go.todo.cleareditform")}function c(){var e=this,t=new i;$(window).on("resize.todo",function(n){t.bind(function(){p.call(e)})})}function h(){this.trigger("resize:content",this.getContentPageHeight(),this)}function p(){var e=this.$el.find(".go_body"),t=$(window).height(),n=parseInt(e.css("min-height")),r=45;this.$el.find("#content").css("padding-bottom",0),this.$el.find(".go_wrap").children(":not(.go_body)").each(function(e,n){t-=$(n).outerHeight()}),t=Math.max(n,t),this.$el.find(".go_body").height(t),this.$el.find("#content").height(t),this.trigger("resize:content",t-this.$el.find(".content_top").outerHeight(),this)}function d(){var e=new r(this.collections);this.$el.find(".go_content").empty().append(e.el),e.render()}var s,o="skin_todo_type";return s=t.extend({name:"todo",className:"go_skin_default go_full_screen todo go_renew go_todo",useRedirectPolicy:!1,collections:{},initialize:function(e){t.prototype.initialize.call(this,e),GO.config("workspace_expansion_button_visible",!1),this.collections={}},_init:function(){this.setUseSide(!1),this.setUseContentWrapper(!0),GO.session().theme!=="THEME_ADVANCED"&&this.setUseOrganogram(!1)},render:function(){this.off("resize:content");var r=this,i=e.defer();return r.appName="todo",n.fetchCollections.call(this).then(function(e){return r.collections=e,t.prototype.render.call(r)}).then(function(){d.call(r),p.call(r),c.call(r),u.call(r),i.resolve(r)}).otherwise(i.reject),i.promise},remove:function(){t.prototype.remove.apply(this,arguments),$(document).off(".go.todo")},setTheme:function(e){this.$el.addClass(o+e)},getContentPageHeight:function(){var e=this.getContentElement().height(),t=this.$el.find(".content_top").outerHeight();return e-t},setTitle:function(){}},{__instance__:null}),s});