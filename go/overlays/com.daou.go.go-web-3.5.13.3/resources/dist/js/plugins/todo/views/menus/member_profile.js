define("todo/views/menus/member_profile",["components/history_menu/main","hgn!todo/templates/menus/member_profile_menu","text!todo/templates/menus/menu_items_menu.html","todo/views/menus/remove_confirm","i18n!todo/nls/todo","i18n!nls/commons"],function(e,t,n,r,i,s){function l(e){return{board:c.call(this),card:h.call(this)}[e]}function c(){var e=[],t=this.todoModel;return t.isOwner(GO.session("id"))?GO.session("id")!==this.userId&&(e.push({classname:"change-owner",next_view:"",menu_name:i["\uc6b4\uc601\uc790\ub85c \uc9c0\uc815"],icon_class:!1,has_child:!1}),e.push({classname:"remove-member",next_view:"",menu_name:i["\uc774 \uba64\ubc84\ub97c \ubcf4\ub4dc\uc5d0\uc11c \uc81c\uc678"],icon_class:!1,has_child:!1})):GO.session("id")===this.userId&&e.push({classname:"leave-board",next_view:"",menu_name:i["\ubcf4\ub4dc\uc5d0\uc11c \ub098\uac00\uae30"],icon_class:!1,has_child:!1}),e}function h(){var e=[];return e.push({classname:"remove-member",next_view:"",menu_name:i["\uc774 \uba64\ubc84\ub97c \uce74\ub4dc\uc5d0\uc11c \uc81c\uc678"],icon_class:!1,has_child:!1}),e}var o,u,a,f=e.HistoriableMenuView;return o=f.extend({id:"member-profile-menu",className:"content",template:t,name:"member-profile-menu",title:i["\uba64\ubc84"],menuList:[],initialize:function(e){e=e||{},this.userId=e.userId,this.todoModel=e.todoModel,this.memberInfo=this.todoModel.getMember(this.userId),this.menuList=l.call(this,this.type||"board"),f.prototype.initialize.call(this,e)},render:function(){this.$el.empty().append(this.template({member:this.memberInfo,menulist:this.menuList,mailExposure:GO.config("mailExposure")},{menu_items_menu:n})),this.setMenuClass("layer_new_board")}}),u=o.extend({type:"board",events:{"click .change-owner a":"_changeOwner","click .remove-member a":"_callRemoveMemberConfirmMenu","click .leave-board a":"_callLeaveConfirmMenu"},initialize:function(e){e=e||{},o.prototype.initialize.call(this,e)},_changeOwner:function(e){var t=this,n=GO.session("id"),o=this.userId;if(!this.todoModel.isOwner(n))return!1;e.preventDefault(),this.forward(new r({subject:i["\uc6b4\uc601\uc790 \ubcc0\uacbd \ud0c0\uc774\ud2c0"],description:i["\uc6b4\uc601\uc790 \ubcc0\uacbd \ud655\uc778 \uba54\uc2dc\uc9c0"],buttonText:s["\ubcc0\uacbd"],afterClick:function(){t.todoModel.updateOwner(o).then(function(e){t.close()})}}))},_callRemoveMemberConfirmMenu:function(e){var t=this,n=GO.session("id"),s=this.userId;if(!this.todoModel.isOwner(n))return!1;e.preventDefault(),this.forward(new r({subject:i["\ubcf4\ub4dc \uba64\ubc84 \uc0ad\uc81c \ud0c0\uc774\ud2c0"],description:i["\ubcf4\ub4dc \uba64\ubc84 \uc0ad\uc81c \ud655\uc778 \uba54\uc2dc\uc9c0"],buttonText:i["\uc81c\uc678"],afterClick:function(){t.todoModel.removeMember(s).then(function(e){t.back(2),t.close()})}}))},_callLeaveConfirmMenu:function(e){var t=this,n=GO.session("id");if(this.todoModel.isOwner(n)||!this.todoModel.isMember(n))return!1;e.preventDefault(),this.forward(new r({subject:i["\ubcf4\ub4dc\ub098\uac00\uae30 \ud0c0\uc774\ud2c0"],description:i["\ubcf4\ub4dc\ub098\uac00\uae30 \ud655\uc778 \uba54\uc2dc\uc9c0"],buttonText:i["\ub098\uac00\uae30"],afterClick:function(){t.todoModel.leaveMember(n).then(function(e){t.close(),GO.router.navigate("todo",{pushState:!0,trigger:!0})})}}))}}),a=o.extend({type:"card",events:{"click .remove-member":"_removeMember"},initialize:function(e){e=e||{},this.todoItemModel=e.todoItemModel,o.prototype.initialize.call(this,e)},_removeMember:function(e){var t=$(e.currentTarget),n=this.memberInfo.id,r=this;e.preventDefault(),this.todoItemModel.removeMember(n).then(function(e){r.close()})}}),{BoardMemberProfileMenuView:u,CardMemberProfileMenuView:a}});