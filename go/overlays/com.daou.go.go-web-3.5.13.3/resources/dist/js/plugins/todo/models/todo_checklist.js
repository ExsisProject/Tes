define("todo/models/todo_checklist",["when","app","todo/models/base","todo/models/todo_checklist_item","todo/libs/util"],function(e,t,n,r,i){function o(e){return r.newFromChecklist(this,this.getChecklistItem(e))}function u(e,t){return _.map(e,function(e){e.id===t.id&&_.extend(e,t.toJSON())}),e}var s;return s=n.Model.extend({todoItemModel:null,urlRoot:function(){return[t.config("contextRoot")+"api/todo",this.todoItemModel.get("todoId"),"item",this.get("todoItemId"),"checklist"].join("/")},updateTitle:function(t){var n=e.defer();return this.save({title:t},{success:n.resolve,error:function(e,t,r){t.responseJSON.code==404&&t.responseJSON.name=="todo.not.found.element"&&$.goSlideMessage(t.responseJSON.message,"caution"),n.reject(t)}}),n.promise},remove:function(){var t=e.defer();return this.destroy({success:t.resolve,error:function(e,n,r){t.reject(n)}}),t.promise},getChecklistItem:function(e){return _.findWhere(this.getChecklistItems(),{id:e})},getChecklistItems:function(){return this.get("checklistItems")||[]},getNextItemSeq:function(){return this.getChecklistItems().length},getCheckedItems:function(){return _.filter(this.getChecklistItems(),function(e){return e.checkFlag==="Y"})},getCheckedItemCount:function(){return this.getCheckedItems().length},addItem:function(e){var t={},n=this.getChecklistItems();return e instanceof r?t=e.toJSON():t=e,n.push(t),this.set("checklistItems",n),this},createItem:function(t){var n=this,i=this.getChecklistItems();return r.createFromChecklist(this,t).then(function(t){return n.addItem(t),e.resolve(t)},e.reject)},updateItemTitle:function(t,n){var i=this.getChecklistItem(t),s=this.getChecklistItems(),o=r.newFromChecklist(this,i),a=this;return o.updateTitle(n).then(function(t){return a.set("checklistItems",u(s,t)),e.resolve(a)},e.reject)},toggleItem:function(t){var n=this.getChecklistItem(t),i=this.getChecklistItems(),s=r.newFromChecklist(this,n),o=this;return s.toggle().then(function(t){return o.set("checklistItems",u(i,t)),e.resolve(o)},e.reject)},removeItem:function(t){var n=this.getChecklistItem(t),s=i.convertArrayToCollection(this.getChecklistItems(),r),o=r.newFromChecklist(this,n),u=this;return o.remove().then(function(){return s.remove(o),u.set("checklistItems",s.toJSON()),e.resolve()},e.reject)},moveItem:function(t,n,r){var i=o.call(this,t),s=this.getChecklistItems(),u=this;return i.move(n,r).then(function(t){return e.resolve(t)},e.reject)}},{newFromTodoItem:function(e,t){var n;return n=new s(_.extend(t,{todoItemId:e.id})),n.todoItemModel=e,n},createFromTodoItem:function(t,n){var r=this.newFromTodoItem(t,{title:n}),i=e.defer();return r.save({seq:t.getNextChecklistSeq()},{success:i.resolve,error:function(e,t,n){t.responseJSON.code==404&&t.responseJSON.name=="todo.not.found.element"&&$.goSlideMessage(t.responseJSON.message,"caution"),i.reject(t)}}),i.promise}}),s});