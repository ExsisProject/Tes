define("todo/models/todo_activities",["when","app","todo/models/base","todo/models/todo_activity","todo/libs/util"],function(e,t,n,r,i){function p(e,t,n,r){var i={todo:c,todoItem:h}[e],s;return i?(s=new i(n,r),s.targetModel=t,s):new Error("Invalid Model Type")}var s=1,o=20,u="comments",a=r.TodoItemActivityModel,f=r.TodoItemCommentModel,l,c,h;return l=n.Collection.extend({targetModel:null,page:s,offset:o,initialize:function(e,t){var n,r;n=t.page||s,r=t.pageSize||o,this.setPageOption(n,r)},setPageOption:function(e,t){var n=0;return e=e||s,pageSize=t||o,e>0&&(this.page=e-1,this.offset=pageSize),this},getPageList:function(t,n){var r=e.defer();try{this.setPageOption(t,n).fetch({success:r.resolve,error:function(e,t,n){r.reject(t)}})}catch(i){r.reject(i)}return r.promise}}),c=l.extend({url:function(){return[t.config("contextRoot")+"api/todo",this.targetModel.id,"activity?page="+this.page+"&offset="+this.offset].join("/")}}),h=l.extend({activityType:u,initialize:function(e){e=e||{},l.prototype.initialize.apply(this,arguments),this.activityType=e.activityType||u},model:function(e,t){var n={comment:f,action:a}[e.activityType];return n.newForTodoItem(t.collection.targetModel,e,t)},url:function(){return[t.config("contextRoot")+"api/todo",this.targetModel.get("todoId"),"item",this.targetModel.id,this.activityType+"?page="+this.page+"&offset="+this.offset].join("/")},setActivityType:function(e){return this.activityType=e,this},isActivated:function(e){return this.activityType===e},createComment:function(t){var n=this;return r.createComment(this.targetModel,t).then(function(t){return n.add(t),e.resolve(n)},e.reject)},updateComment:function(t,n){var r=this.get(t),s=this,o;return r?o=r.updateContent(n).then(function(t){return s.set([t]),e.resolve(t)},e.resolve):o=e.reject(i.createResponseError(404,"Not Fount")),o},removeComment:function(t){var n=this.get(t),r=this,s;return n?s=n.remove().then(function(){return r.remove(t),e.resolve()},e.resolve):s=e.reject(i.createResponseError(404,"Not Fount")),s}}),{TodoActivities:c,TodoItemActivities:h,newForTodo:function(e,t,n){return p("todo",e,t,n)},newForTodoItem:function(e,t,n){return p("todoItem",e,t,n)}}});