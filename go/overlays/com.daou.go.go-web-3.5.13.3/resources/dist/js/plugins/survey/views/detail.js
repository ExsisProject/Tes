(function(){define(["survey/views/base/detail","app","survey/views/detail/response","survey/views/detail/result","attach_file","views/profile_card","comment","components/backdrop/backdrop","survey/helpers/html","survey/libs/util","hgn!survey/templates/detail","text!survey/templates/detail_toolbar.html","i18n!nls/commons","i18n!survey/nls/survey","jquery.go-popup"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p){function m(e,n){e.$el.append(l({context_root:t.config("contextRoot"),survey_id:n.id,title:n.get("title"),status:n.get("status"),previewMode:e.previewMode,"creator?":n.isCreator(t.session("id")),creator:{id:n.get("creator").id,display_name:n.getCreatorName(),thumbnail:n.hasDeptName()?null:n.get("creator").thumbnail},availableResultDownload:n.isCreator(t.session("id"))||n.isReferrer(t.session("id")),updated_at:t.util.basicDate(n.get("updatedAt")),private_text:n.isPrivate()?p["\ube44\uacf5\uac1c"]:p["\uacf5\uac1c"],editable_text:n.get("editable")?p["\ud5c8\uc6a9"]:p["\ud5c8\uc6a9\uc548\ud568"],survey_period:a.getSurveyPeriod(n),target_count:n.getTargetCount(),response_count:n.getResponseCount(),no_response_count:n.getNoResponseCount(),guidance:n.getGuidance(),"before_start?":n.isBeforeStart(),"isReady?":n.isReady(),"started?":n.isStarted(),"progressing?":n.isProgressing(),"stopped?":n.isStopped(),"finished?":n.isFinished(),"isAvailableMail?":t.isAvailableApp("mail"),"accessible?":e.accessible(),"responded?":n.isResponseDone(),"editable?":n.editable(),"use_comment?":n.commentable(),label:{close:h["\ub2eb\uae30"],result:p["\uc124\ubb38 \uacb0\uacfc"],editable:p["\ucc38\uc5ec \ud6c4 \uc218\uc815"],previous:h["\uc774\uc804"],next:h["\ub2e4\uc74c"],list:h["\ubaa9\ub85d"],copy:h["URL \ubcf5\uc0ac"],reply:h["\ub313\uae00"],creator:h["\uc791\uc131\uc790"],created_date:h["\uc791\uc131\uc77c"],period:p["\uc124\ubb38 \uae30\uac04"],download_result:p["\uc124\ubb38\uacb0\uacfc \ub2e4\uc6b4\ub85c\ub4dc"],send_mail:p["\ubbf8\ucc38\uc5ec\uc790\uc5d0\uac8c \uc54c\ub9bc \ubcf4\ub0b4\uae30"],target_all:p["\uc804\uccb4 \ucc38\uc5ec\uc790"],respondent:p["\ucc38\uc5ec\uc644\ub8cc"],no_respondent:p["\ubbf8\ucc38\uc5ec"],modify_survey:h["\uc218\uc815"],start_survey:h["\uc9c4\ud589"],stop_survey:h["\uc911\uc9c0"],finished_survey:p["\ub9c8\uac10"],remove_survey:h["\uc0ad\uc81c"],copy_survey:h["\ubcf5\uc0ac"],modify_response:p["\uc751\ub2f5 \uc218\uc815"],go_home:p["\uc124\ubb38 \ud648\uc73c\ub85c"],send_mail_desc:p["\uba54\uc77c\uc54c\ub9bc \uc124\uba85"]},msg:{responded:p["\uc124\ubb38 \uc644\ub8cc \uba54\uc2dc\uc9c0"],not_accessible:p["\uc124\ubb38 \uc0c1\uc138 \uc811\uadfc\uad8c\ud55c \uc5c6\uc74c \uba54\uc2dc\uc9c0"]}},{toolbar:c})),n.isStopped()&&$("#btn-send-mail").hide(),n.hasDeptName()&&e.$el.find(".article_header .info").css("margin-left","0px"),i.create("#survey-attach-placeholder",n.getAttaches(),function(n){return t.config("contextRoot")+"api/survey/"+e.model.id+"/download/"+n.id}),n.commentable()&&g(e,n)}function g(e,t){var n=o.render({el:e.$el.find("#comment-placeholder"),typeUrl:"survey",typeId:e.model.id,onAfterRender:function(t){e.$el.find(".reply-count").text(t.collection.length)}});n.$el.on("comment:change",function(t,n,r){e.$el.find(".reply-count").text(r)})}function y(){return f.goToLastList()}var d=e.prototype,v;return v=e.extend({className:"content_page",events:{"click #btn-down-result":"_downloadResult","click #btn-send-mail":"_sendMail","click .creator-info":"_showProfileCard","click .btn_more":"_showMore","click .toggle_detail":"_toggleDetail"},initialize:function(e){_.extend(this.events,d.events),d.initialize.apply(this,arguments),this.ResponseView=n,this.ResultView=r},render:function(){var e=this;this.model.fetch({success:function(n){if(n.isStopped()&&!n.isCreator(t.session("id"))){$.goAlert(p["\uc911\uc9c0\ub41c \uc124\ubb38"],p["\uc911\uc9c0\ub41c \uc124\ubb38 \uc548\ub0b4\ubb38"],function(){t.router.navigate("survey",{trigger:!0})},h["\ud655\uc778"]);return}n.previewMode=e.previewMode,m(e,n),e._renderDetailSubView(n)},error:function(){t.util.error("500")},statusCode:{403:function(){t.util.error("403",{msgCode:"400-survey"})},404:function(){t.util.error("404",{msgCode:"400-survey"})},500:function(){t.util.error("500")}}})},_downloadResult:function(){t.util.downloadCsvFile("api/survey/"+this.model.id+"/result/download")},_sendMail:function(){var e=t.contextRoot+"api/survey/"+this.model.id+"/sendmail";$.goConfirm(h["\uba54\uc77c \ubcf4\ub0b4\uae30"],p["\ubbf8\ucc38\uc5ec\uc790\uc5d0\uac8c \uc54c\ub9bc"],function(){$.ajax(e,{async:!1,contentType:"application/json",error:function(){f.raiseRequestError()}})})},_showProfileCard:function(e){var t=$(e.currentTarget).attr("data-userid");return t&&s.render(t,e.currentTarget),!1},_showMore:function(e){this.backdropView||(this.backdropView=new u,this.backdropView.backdropToggleEl=$("div[el-backdrop]"),this.backdropView.linkBackdrop($(e.currentTarget)))},_toggleDetail:function(){var e=this.$el.find(".toggle_detail > span");e.hasClass("ic_arrow_up_type4")?e.removeClass("ic_arrow_up_type4").addClass("ic_arrow_down_type4").attr("title",h["\uc5f4\uae30"]):e.removeClass("ic_arrow_down_type4").addClass("ic_arrow_up_type4").attr("title",h["\ub2eb\uae30"]),this.$el.find(".sub_report").toggle()}}),v})})();