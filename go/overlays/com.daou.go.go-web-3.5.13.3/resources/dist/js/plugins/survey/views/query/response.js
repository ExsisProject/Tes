(function(){define(["backbone","survey/models/query","helpers/form","survey/libs/util","survey/helpers/html","i18n!nls/commons","i18n!survey/nls/survey","jquery.go-popup"],function(e,t,n,r,i,s,o){function a(e){function u(e){return h(e)?!0:!1}function a(e){var t=e.model.getMaxOfSelectable();return h(e)?t>0&&e.$el.find("input:checked").length>t?(d(e),!1):!0:!1}function l(e){return p.call(e,"input[type=text]",t)}function c(e){return p.call(e,"textarea",i)}function h(e){var t=e.$el.find("input:checked");return e.model.isRequired()&&t.length<1?(d(e),!1):!0}function p(t,i){var s=this.$el.find(t),o=s.val(),u=this.model.isRequired();return u&&!o?(d(e),!1):o&&o.length>i?(n.printError(s,r.getStringLengthError(1,i)),s.focus(),!1):!0}function d(e){r.alert(o["\ud544\uc218\uc9c8\ubb38 \ubbf8\uc751\ub2f5 \ud0c0\uc774\ud2c0"],o["\ud544\uc218\uc9c8\ubb38 \ubbf8\uc751\ub2f5 \uba54\uc2dc\uc9c0"],s["\ub2eb\uae30"]),f.call(e)}var t=255,i=1e3;return e.model.isSelectType()?u(e):e.model.isMultiSelectType()?a(e):e.model.isTextType()?l(e):e.model.isTextareaType()?c(e):e.model.isScoreType()?u(e):!1}function f(){var e=this.$el.position(),t=$(window).innerHeight(),n=e.top-t/2;$(document).scrollTop(n)}function l(e){return i.getQueryViewTemplate(e)}function c(e,t,r){var s=[],o="query_"+t,u=r.answer||"",a=r.selected||!1,f={select:"radio",mselect:"checkbox",text:"text",score:"radio"}[e],l="<li>";switch(e){case"select":case"mselect":r.caseType==="input"?(l='<li class="etc">',s.push(i.getSelectUserInput(f,o,r))):s.push(n[f].call(n,o,r.id,{label:r.description,checked:a}));break;case"text":s.push('<div class="wrap_txt"><input class="txt w_max" type="'+f+'" name="'+o+'" value="'+u+'"></div>');break;case"textarea":s.push('<div class="wrap_txtarea"><textarea class="txtarea w_max" name="'+o+'" rows="5">'+u+"</textarea></div>");break;case"score":s.push(n[f].call(n,o,r.id,{label:r.description,checked:a}))}return l+"\n"+s.join("\n")+"\n"+"</li>"}var u=e.View.extend({tagName:"li",className:"query-response",events:{"click input[type=checkbox]":"_checkSelectedMax"},initialize:function(){this.model||(this.model=new t),this.template=l(this.model),this.$el.data("instance",this)},render:function(){this.$el.append(this.template),this.model.isScoreType()&&this.$el.find(".wrap_answer").addClass("ranking"),_.each(this.model.getCases(),function(e,t){$(c(this.model.get("type"),this.model.id,e)).data("model",e).appendTo(this.$el.find(".wrap_answer"))},this)},updateQueryCase:function(){var e=[],t=!1;return this.$el.find(".wrap_answer li").each(_.bind(function(n,r){var i=$(r).data("model"),s=$(r).find("input[type=text], textarea").val(),o=this.model.isGroupOfText();o?(i.selected=!0,t=s.length>0):(i.selected=$(r).find("input").is(":checked"),i.selected&&(t=!0)),i.answer=s,e.push(i)},this)),this.model.set("cases",e),this.model.set("answered",t),this},getUpdatedModel:function(){return this.updateQueryCase(),this.model},validate:function(){return a(this)},_checkSelectedMax:function(e){var t=this.model.getMaxOfSelectable();return this.model.isMultiSelectType()?t<=0?!0:this.$el.find("input[type=checkbox]:checked").length>t?(r.alert("",GO.i18n(o["\ubcf5\uc218 \uc120\ud0dd \ucd5c\ub300\uc120\ud0dd \ucd08\uacfc \uc624\ub958 \uba54\uc2dc\uc9c0"],{max:t}),s["\ub2eb\uae30"]),!1):!0:!0},_alert:function(e,t){$.goAlert("",o["\ud544\uc218\uc9c8\ubb38 \ubbf8\uc751\ub2f5 \uba54\uc2dc\uc9c0"],"",s["\ub2eb\uae30"])}});return u})})();