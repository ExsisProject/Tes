define(function(require){var e=require("backbone"),t=require("i18n!nls/commons"),n=require("components/comment/views/comment_content"),r=require("components/comment/views/comment_form"),i=require("attach_file"),s=require("components/emoticon/views/emoticons"),o=e.View.extend({tagName:"li",events:{"click #edit":"renderEditForm","click #delete":"destroy","click #cancel":"cancel","click #reply":"toggleReplyForm"},initialize:function(e){this.rootUrl=e.rootUrl,this.rootId=e.rootId,this.typeUrl=e.typeUrl,this.typeId=e.typeId,this.isWritable=e.isWritable,this.isReply=e.isReply&&this.isWritable,this.uid=e.uid,this.popupPrint=e.popupPrint||!1,this.availableAnonymousWriterOptionInPostComment=e.availableAnonymousWriterOptionInPostComment||!1,this.anonymFlag=e.anonymFlag||!1,this.isPublicWriter=e.model?e.model.get("publicWriter")||!1:!1,this.emoticon=new s,this.model.set({typeUrl:this.typeUrl,typeId:this.typeId})},render:function(){return this.commentView=new n({model:this.model,isReply:this.isReply,writable:this.isWritable,popupPrint:this.popupPrint}),this.$el.html(this.commentView.render().el),this.renderAttachView(),this.model.isThread()&&this.$el.addClass("depth_in"),this},renderEditForm:function(){this.commentForm=new r({model:this.model,uid:this.uid,anonymFlag:this.anonymFlag,availableAnonymousWriterOptionInPostComment:this.availableAnonymousWriterOptionInPostComment,isPublicWriter:this.isPublicWriter}),this.$el.html(this.commentForm.render().el),this.commentForm.$("textarea").trigger("keyup"),this.$el.addClass("reply_create reply_edit"),this.model.isThread()&&this.$el.addClass("reply_create")},destroy:function(){var e=this,n=function(){e.model.destroy({success:function(t,n){e.$el.trigger("change:attach",0-t.get("attaches").length),e.$el.trigger("change:log"),e.$el.trigger("comment:reset"),e.$el.remove()},error:function(e,t){$.goError(t.responseJSON.message)}})};$.goCaution(t["\ub313\uae00 \uc0ad\uc81c"],t["\uc0ad\uc81c\ud558\uc2dc\uaca0\uc2b5\ub2c8\uae4c?"],n)},cancel:function(e){this.emoticon.moveToMainEmoticonView($(e.currentTarget)),this.render(),this.$el.removeClass("reply_create reply_edit")},renderAttachView:function(){var e=this,t=this.isBoard()?"/attaches/":"/download/";this.model.get("attaches").length&&i.create(this.$("#attachPart"),this.model.get("attaches"),function(n){return GO.contextRoot+"api/"+e.rootUrl+"/"+e.rootId+"/comment/"+e.model.id+t+n.id})},isBoard:function(){return this.rootUrl.split("/")[0]=="board"},toggleReplyForm:function(e){var n=this.$("#reply").find("span.txt_b");if(this.replyForm)this.emoticon.moveToMainEmoticonView($(e.currentTarget)),this.replyForm.remove(),this.replyForm=null,n.text(t["\ub313\uae00"]);else{var i=$("<li class='depth_in reply_create'></li>"),s=new r({typeUrl:this.typeUrl,typeId:this.typeId,commentId:this.model.id,uid:this.uid,availableAnonymousWriterOptionInPostComment:this.availableAnonymousWriterOptionInPostComment||!1,anonymFlag:this.anonymFlag||!1});this.replyForm=i.append(s.render().el),this.$el.after(this.replyForm),n.text(t["\ucde8\uc18c"])}}});return o});