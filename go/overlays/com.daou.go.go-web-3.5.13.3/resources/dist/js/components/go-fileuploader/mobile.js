define("components/go-fileuploader/mobile",["jquery","underscore","app","i18n!nls/commons","browser","webfolder/views/mobile/m_home","jquery.fileupload"],function(e,t,n,r,i,s){function o(o,u){function m(e){return e.parents("#comment_edit_control").siblings("[data-emoticon-edit-part]").find("img").length>0?(n.util.delayAlert(r["\uc120\ud0dd\ud55c \uc774\ubaa8\ud2f0\ucf58 \uc0ad\uc81c \ud6c4 \ud30c\uc77c\uc744 \ucca8\ubd80\ud574\uc8fc\uc138\uc694."]),!1):!0}function g(t){e.ajax({url:"/api/webfolder/mail/attach/write",type:"POST",contentType:"application/json; charset=UTF-8",processData:!1,data:JSON.stringify(t),async:!1,error:function(e){window.attachFileFail(e)}}).done(function(e){setTimeout(function(){n.util.appLoading(!1),u.isToDo?y(e):b(e)},1e3)})}function y(n){t.each(n.data,function(t){x(t.size);var n={fileExt:t.extension,fileName:t.name,fileSize:t.size,filePath:t.upkey,thumbnail:["/thumb/temp/",t.hostId,"/small",t.upkey].join(""),hostId:t.hostId};e.ajax({url:u.webFolderUrl,type:"POST",async:!1,data:n,success:function(e){window.attachFileSuccess(e)},error:function(e){window.attachFileFail(e)}})})}function b(e){t.each(e.data,function(e){x(e.size);var t={};t.data={filePath:e.upkey,fileSize:e.size,fileName:e.name,hostId:e.hostId,preview:e.preview,uid:e.uid?e.uid:"",type:"normal",notChage:!0,fileExt:e.extension,thumbnail:["/thumb/temp/",e.hostId,"/small",e.upkey].join("")},window.attachFileSuccess(t)})}function w(){var e=window.target.closest('div[id*="_fileuploader"]').attr("id"),r=!t.isUndefined(e)&&(e.indexOf("form")>-1||e.indexOf("item")>-1||e.indexOf("reply")>-1);r&&(window.target.closest('div[id*="_fileuploader"]').data("attachable","true"),n.EventEmitter.trigger("m_comment",e))}function E(i){var s=e(i.currentTarget),o=s.get(0).files;t.each(o,function(t){var i=new FormData,s=S(t.name);if(s==undefined){alert(r["\ucca8\ubd80\ud560 \uc218 \uc5c6\ub294 \ud30c\uc77c \uc785\ub2c8\ub2e4."]);return}if(n.config("excludeExtension")){var o=e.inArray(s.toLowerCase(),n.config("excludeExtension").split(","));if(o>=0)return alert(n.i18n(r["\ud655\uc7a5\uc790\uac00 \ub561\ub561\uc778 \uac83\ub4e4\uc740 \ucca8\ubd80 \ud560 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4."],"arg1",n.config("excludeExtension"))),!1}x(t.size),i.append("file",t),i.append("GOSSOcookie",e.cookie("GOSSOcookie")),e.ajax({url:u.url||n.contextRoot+"api/file",type:"POST",async:!1,contentType:!1,processData:!1,data:i,success:function(e){window.attachFileSuccess(e)},error:function(e){window.attachFileFail(e)}})}),s.val("")}function S(e){var t=e.split(".");return t[t.length-1]}function x(e){var t=n.config("allowedFileUploadSize")?n.config("allowedFileUploadSize"):-1;try{if(t>-1&&t<e)throw new Error("AttachSizeException")}catch(i){var s=i.message;throw s=="AttachSizeException"&&n.util.delayAlert(n.i18n(r["\ucca8\ubd80\ud560 \uc218 \uc788\ub294 \ucd5c\ub300 \uc0ac\uc774\uc988\ub294 0MB \uc785\ub2c8\ub2e4."],"arg1",t/1024/1024)),new Error("Attach Validation Error - AppConfig")}}u=u||{};var a=e('<div id="popAttachOverlay" class="overlay" style="z-index:101"/>'),f=e('<span class="btn_wrap"><a href="javascript:;" id="btnAttachLayer"><span class="btn btn_attach_photo"></span></a></span>'),l=e('<span data-upload-btn class="btn_wrap" style="position:relative"><span><span class="btn btn_attach_file"></span><input type="file" multiple name="file" class="btn_image_upload" style="position:absolute;left:0;top:0;width:40px;height:40px;opacity:0"/></span></span>'),c=e('<span class="btn_wrap"><a href="javascript:;" data-bypass id="callFile"><span class="btn btn_attach_file"></span></a></span>'),h=e('<input type="file" name="file" class="btn_image_upload" accept="image/*" style="position:absolute;left:0;top:0;width:68px;height:68px;opacity:0" />'),p=e('<div class="btn_wrap"><a href=""><span class="btn btn_attach_folder"></span></a></div>'),d=e('<input class="btn_image_upload" type="file" multiple name="file" title="'+r["\ud30c\uc77c \ucca8\ubd80"]+'" alt="'+r["\ud30c\uc77c \ucca8\ubd80"]+'" style="cursor:pointer">'),v={"font-size":0,position:"absolute",left:"0px",top:"0px",width:"100%",height:"100%",opacity:0};u.isContact?n.config("isMobileApp")?e(".photo a").addClass("btn_attach_photo"):o.html(h):u.isToDo?(i.msie&&i.version<11&&t.extend(v,{"font-size":"999px"}),d.css(v),o.css({position:"relative",overflow:"hidden"}).append(d)):(n.util.isAndroidApp()?o.html(c).append(f):o.html(l),n.config("isWebFolderAvailable")&&o.append(p)),window.attachFileSuccess=u.success,window.attachFileFail=u.error,e("[data-upload-btn]").off("vclick"),e("[data-upload-btn]").on("vclick",function(t){t.stopImmediatePropagation(),window.target=e(t.currentTarget);if(!m(window.target))return!1;w();if(typeof u.androidCallFile=="function")u.androidCallFile();else{var r=n.config("allowedFileUploadSize")?n.config("allowedFileUploadSize")/1024/1024:-1;n.util.callFile(r)}}),e('input[type="file"].btn_image_upload').off("change"),e('input[type="file"].btn_image_upload').on("change",function(t){e("div.option_display").data("attachable","true"),t.stopImmediatePropagation(),window.target=e(t.currentTarget),w();if(!m(window.target))return!1;E(t)}),e(".btn_attach_folder, #todoWebFolder, .todoitem-attach-webfolder").off("vclick"),e(".btn_attach_folder, #todoWebFolder, .todoitem-attach-webfolder").on("vclick",function(t){e("div.option_display").data("attachable","true"),t.preventDefault(),t.stopPropagation(),window.target=e(t.currentTarget),w();if(!m(window.target))return!1;this.webFolderView=new s({}),e("#goBody").hide(),this.webFolderView.render({callback:function(e){return g(e),!1}})});if(n.util.isAndroidApp()||n.config("isMobileApp")&&u.isContact){u.isToDo&&(d.off("click"),d.on("click",function(t){t.preventDefault(),window.target=e(t.currentTarget);if(o.data("attachtype")==="image")window.GOMobile.callAlbum("attachFileSuccess","attachFileFail");else{var r=n.config("allowedFileUploadSize")?n.config("allowedFileUploadSize")/1024/1024:-1;n.util.callFile(r)}})),e(".btn_attach_photo").off("click"),e("#callAlbum").off("vclick"),e("#callCamera").off("vclick"),e(".btn_attach_file").off("vclick"),e(".btn_attach_photo").on("click",function(t){e("div.option_display").data("attachable","true"),t.stopImmediatePropagation(),window.target=e(t.currentTarget);if(!m(window.target))return!1;w(),T()}),e("#callAlbum").on("vclick",function(e){e.stopImmediatePropagation(),e.stopPropagation(),e.preventDefault(),C(e,n.util.callAlbum)}),e("#callCamera").on("vclick",function(e){e.stopImmediatePropagation(),e.stopPropagation(),e.preventDefault(),C(e,n.util.callCamera)}),e(".btn_attach_file").on("vclick",function(t){t.stopImmediatePropagation(),window.target=e(t.currentTarget);if(!m(window.target))return!1;w();if(typeof u.androidCallFile=="function")u.androidCallFile();else{var r=n.config("allowedFileUploadSize")?n.config("allowedFileUploadSize")/1024/1024:-1;n.util.callFile(r)}});function T(){var t=e("#attachLayer");return t.css("display")=="block"?(t.hide(),e("#popAttachOverlay").remove(),e("#mobileContent").focus().show()):(N(),e(window).height()<e(".go_content").height()&&t.css("top","25%"),t.show(),e("#mobileContent").hide(),e("input").blur().focusout()),!1}function N(){var t=e("#attachLayer");t.hide(),e("#popAttachOverlay").remove(),e(".go_wrap").after(a);var n=function(){e("#popAttachOverlay").click(function(e){T(e)})};setTimeout(n,1e3)}function C(t,r){return e("#popAttachOverlay").remove(),e("#attachLayer").hide(),e("#mobileContent").show(),u.isContact&&r===n.util.callAlbum?n.util.callContactAlbum(1):r(),t&&t.stopPropagation(),!1}}}return{bind:function(t,n){n=n||{},e(t).each(function(t,r){new o(e(r),n)})},getAttachInfo:function(t){var n=[],r=e(t).find("li"),i;return r.each(function(){i={},e(this).attr("data-path")&&(i.path=e(this).attr("data-path")),e(this).attr("data-name")&&(i.name=e(this).attr("data-name")),e(this).attr("data-id")&&(i.id=e(this).attr("data-id")),n.push(i)}),n},attachFileValidateBySaaS:function(r){var i=r,s=e("li[data-size]").length+1,o=n.config("attachSizeLimit")?parseInt(n.config("maxAttachSize")):parseInt(n.config("commonAttachConfig").maxAttachSize),u=n.config("attachNumberLimit")?parseInt(n.config("maxAttachNumber")):parseInt(n.config("commonAttachConfig").maxAttachNumber);t.each(e("li[data-size]"),function(t){i+=e(t).data("size")});if(o*1024*1024<i)throw new Error("AttachSizeException");if(u<s)throw new Error("AttachNumberExceptionBySaaS")}}});