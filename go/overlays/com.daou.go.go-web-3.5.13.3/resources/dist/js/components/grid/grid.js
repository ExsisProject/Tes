define(["i18n!nls/commons","i18n!board/nls/board","i18n!task/nls/task","hgn!grid/templates/grid","hgn!grid/templates/grid_list","views/profile_card","grid/views/pagesize","views/pagination"],function(e,t,n,r,i,s,o,u){var a={search_all:t["\uc804\uccb4\uae30\uac04"],search_month:t["\uac1c\uc6d4"],search_year:t["\ub144"],search_input:t["\uae30\uac04\uc785\ub825"],search:e["\uac80\uc0c9"]};return Backbone.View.extend({className:"dataTables_wrapper",initialize:function(e){this.options=e,this.tableClass=e.tableClass||"type_normal dataTable",this.trClass=e.trClass||"",this.columns=e.columns,this.buttons=e.buttons||[],this.searchOptions=e.searchOptions||[],this.usePeriod=e.usePeriod,this.emptyContent=e.emptyContent,this.useTableScroll=e.useTableScroll,this.useCheckbox=e.checkbox!==!1,this.usePageSize=e.usePageSize!==!1,this.useTopButton=e.useTopButton!==!1,this.useBottomButton=e.useBottomButton!==!1,this.useToolbar=e.useToolbar!==!1,this.isAdmin=e.isAdmin===!0,this.collection.on("fetching",this._showProgress,this),this.collection.on("sync",this._onSyncCollection,this)},events:{"click #checkAll":"_checkAll","click #searchBtn":"_search","click th[data-property]":"_sorting","change tbody input":"_toggleCheckAll","change #duration":"_changeDuration","keypress #searchKeyword":"_keyEventHandler","click [data-profile]":"_profile","click [el-checkbox]":"_onClickCheckbox","click [el-grid-list-item]":"_onClickGridListItem"},render:function(){return this.$el.html(r({tableClass:this.tableClass,useCheckbox:this.useCheckbox,columns:this.columns,useSearch:this.searchOptions.length>0,search:this.searchOptions,usePeriod:this.usePeriod,lang:a,emptyContent:this.emptyContent,useTableScroll:this.useTableScroll,useToolbar:this.useToolbar,isAdmin:this.isAdmin})),this.$pageSize=this.$(".optional"),this._renderListView(),this._renderPageSizeView(),this._renderPageView(),this._markHeader(),this._renderButton(),this._setSearchData(),this.$el.addClass(this.className),this},getCheckedData:function(){return _.map(this.getCheckedIds(),function(e){return this.collection.get(e).toJSON()},this)},getCheckedIds:function(){return _.map(this.$("input[type=checkbox][data-id]:checked"),function(e){return $(e).attr("data-id")})},_renderListView:function(){this.$("tbody").html(i({trClass:this.trClass,useCheckbox:this.useCheckbox,columns:this.columns,collection:this._parseCollection(),columnLength:this.columns.length+(this.useCheckbox?1:0),emptyContent:this.emptyContent||this._defaultEmptyContent()}))},_renderPageSizeView:function(){if(!this.usePageSize)return;_.each(this.$pageSize,function(e){var t=new o({pageSize:this.collection.pageSize});t.setElement($(e)),t.render(),t.bind("changePageSize",this._selectPageSize,this)},this)},_renderPageView:function(){this.pageView&&this.pageView.remove(),this.pageView=new u({pageInfo:this.collection.pageInfo(),useBottomButton:this.useBottomButton}),this.pageView.bind("paging",this._selectPage,this),this.$("#bottomToolbar").append(this.pageView.render().el)},_selectPageSize:function(e){this.collection.setPageSize(e),this.collection.setPageNo(0),this.collection.fetch(),this.$("select[data-el-grid-page-size]").val(e)},_selectPage:function(e){this.collection.setPageNo(e),this.collection.fetch(),this._scrollTop(),this.$el.trigger("selectPage",e)},_checkAll:function(e){var t=$(e.currentTarget).is(":checked");this.$("input[type=checkbox]").prop("checked",t)},_toggleCheckAll:function(){var e=!0;_.each(this.$("tbody").find("input"),function(t){$(t).is(":checked")||(e=!1)}),this.$("#checkAll").prop("checked",e)},_onClickCheckbox:function(e){e.stopPropagation()},_sorting:function(e){if(this.isFetching)return;_.each(this.$("th[el-sortable]"),function(e){$(e).attr("class",$(e).attr("el-sortable"))},this);var t=$(e.currentTarget),n=t.attr("data-property"),r=t.attr("data-direction")=="asc"?"desc":"asc";t.attr("data-direction",r),t.removeClass("sorting"),t.addClass("sorting_"+r),this.collection.property=n,this.collection.direction=r,this.isFetching=!0,this.collection.fetch({success:$.proxy(function(){this.isFetching=!1},this),error:$.proxy(function(){this.isFetching=!1},this)}),this.$el.trigger("sorting:grid",{property:n,direction:r})},_changeDuration:function(){var e=this.$("#duration").val();e=="period"?this._showDurationPeriod():(this.$("#durationPeriod").hide(),this.collection.setDuration(e))},_showDurationPeriod:function(){this.$("#durationPeriod").show(),this.$("#fromDate").datepicker({defaultDate:"+1w",dateFormat:"yy-mm-dd",changeMonth:!0,changeYear:!0,yearSuffix:"",onSelect:function(e){self.$("#toDate").datepicker("option","minDate",e)}}),this.$("#toDate").datepicker({defaultDate:"+1w",dateFormat:"yy-mm-dd",changeMonth:!0,changeYear:!0,yearSuffix:"",onSelect:function(e){self.$("#fromDate").datepicker("option","maxDate",e)}})},_keyEventHandler:function(e){e.which==13&&this._search()},_search:function(){var t=this.$("#searchKeyword");if(t.val().length>64||t.val().length<2){$.goMessage(GO.i18n(e["0\uc790\uc774\uc0c1 0\uc774\ud558 \uc785\ub825\ud574\uc57c\ud569\ub2c8\ub2e4."],{arg1:2,arg2:64}),t,!1,!0);return}this.collection.setSearchType(this.$("#searchTypes").val()),this.collection.setKeyword(this.$("#searchKeyword").val()),this._setDuration(),this.collection.setPageNo(0),this.collection.fetch()},_setDuration:function(){var e=this.$("#duration").val();e=="period"?this.collection.setDuration(e,{fromDate:this.$("#fromDate").val(),toDate:this.$("#toDate").val()}):this.collection.setDuration(e)},_markHeader:function(){var e=this.$("th[data-property='"+this.collection.property+"']");e.attr("data-direction",this.collection.direction),e.removeClass("sorting"),e.addClass("sorting_"+this.collection.direction)},_setSearchData:function(){this.collection.keyword&&this.$("#searchKeyword").val(decodeURIComponent(this.collection.keyword)),this.collection.searchType&&this.$("#searchTypes").val(this.collection.searchType),this.collection.duration&&(this.$("#duration").val(this.collection.duration),this.collection.duration=="period"&&(this._showDurationPeriod(),this.$("#fromDate").val(GO.util.shortDate(this.collection.fromDate)),this.$("#toDate").val(GO.util.shortDate(this.collection.toDate))))},_renderButton:function(){_.each(this.buttons,function(e){_.each(this.$(this._getToolbarSelector()),function(t){var n=$(e.render());$(t).append(n);if(typeof e.type=="undefined")typeof e.onClick=="function"&&n.on("click",e.onClick);else if(typeof e.type=="function"&&e.type()==="submenu"){typeof e.onClick=="function"&&n.on("click","a#downloadBtn",e.onClick);var r=e.getView(),i=n.find("#submenuBtn");i.append(r.render().el),i.attr("backdrop-toggle",!0),r.linkBackdrop(i),r.toggle(!1),n.append(r.$el)}})},this)},_getToolbarSelector:function(){var e="div.critical";return this.useTopButton&&!this.useBottomButton?e="div.custom_header":!this.useTopButton&&this.useBottomButton&&(e="div.custom_bottom"),e},_showProgress:function(){this.$("#processing").show()},hideProgress:function(){this.$("#processing").hide()},_uncheck:function(){this.$("#checkAll").prop("checked",!1)},_drawCallback:function(){typeof this.options.drawCallback=="function"&&this.options.drawCallback(this.collection)},_parseCollection:function(){var e=_.clone(this.collection);return _.map(e.models,function(e){var t=_.map(this.columns,function(t){return{className:t.className,data:t.render(e)}});return{id:e.id,columns:t}},this)},_profile:function(e){e.stopPropagation();var t=e.currentTarget,n=$(t).attr("data-id");if(!n)return;s.render(n,t)},_onSyncCollection:function(){this.hideProgress(),this._renderPageView(),this._uncheck(),this._renderListView(),this._drawCallback(),this.$el.trigger("renderingComplete")},_scrollTop:function(){$(window).scrollTop(this.$el.offset().top)},_onClickGridListItem:function(e){var t=$(e.target);if(t.is("[data-stop-propagation]")||t.parents("[data-stop-propagation]").length)return;var n=$(e.currentTarget).attr("data-id"),r=this.collection.get(n);r&&this.columnFields&&r.set("columnFields",this.columnFields),this.collection.storeParam(),this.$el.trigger("navigate:grid",n),r&&this.$el.trigger("onClickListItem",r.toJSON())},_defaultEmptyContent:function(){return Hogan.compile(['<p class="data_null">','<span class="ic_data_type ic_no_contents"></span>','<span class="txt">{{emptyMessage}}</span>',"</p>"].join("")).render({emptyMessage:n["\ubaa9\ub85d\uc774 \uc5c6\uc2b5\ub2c8\ub2e4"]})}})});