define("components/form_component_manager/approval_form_manager",function(require){var e=require("i18n!nls/commons"),t=require("i18n!approval/nls/approval"),n=_.extend(e,{"\uc9c0\uc815 \uacb0\uc7ac\uc790\uac00 \ucd5c\ub300 \uacb0\uc7ac\uc790 \uc778\uc6d0\uc218\ub97c \ucd08\uacfc\ud558\uc600\uc2b5\ub2c8\ub2e4.":t["\uc9c0\uc815 \uacb0\uc7ac\uc790\uac00 \ucd5c\ub300 \uacb0\uc7ac\uc790 \uc778\uc6d0\uc218\ub97c \ucd08\uacfc\ud558\uc600\uc2b5\ub2c8\ub2e4."],"\uc9c0\uc815 \uacb0\uc7ac\uc790\ub294 10\uac1c\ub97c \ucd08\uacfc \ud558\uc2e4 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4":t["\uc9c0\uc815 \uacb0\uc7ac\uc790\ub294 10\uac1c\ub97c \ucd08\uacfc \ud558\uc2e4 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4"],"\ubd80\uc11c\uac00 \uc5c6\ub294 \uc0ac\uc6a9\uc790\ub294 \ucd94\uac00\ud560 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4.":t["\ubd80\uc11c\uac00 \uc5c6\ub294 \uc0ac\uc6a9\uc790\ub294 \ucd94\uac00\ud560 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4."],addApproval:t["\uacb0\uc7ac \ucd94\uac00"],addAgreement:t["\ud569\uc758 \ucd94\uac00"],addCheck:t["\ud655\uc778 \ucd94\uac00"],addInspection:t["\uac10\uc0ac \ucd94\uac00"],approval:t["\uacb0\uc7ac"],agreement:t["\ud569\uc758"],check:t["\ud655\uc778"],inspection:t["\uac10\uc0ac"],draftUser:e["\uae30\uc548\uc790"],draftUserEmail:e["\uae30\uc548\uc790\uc774\uba54\uc77c"],position:e["\uc9c1\uc704"],empNo:e["\uc0ac\ubc88"],mobileNo:e["\ud578\ub4dc\ud3f0\ubc88\ud638"],directTel:e["\uc9c1\ud1b5\uc804\ud654"],repTel:e["\ub300\ud45c\ubc88\ud638"],fax:e["\ud329\uc2a4"],draftDept:e["\uae30\uc548\ubd80\uc11c"],draftDate:e["\uae30\uc548\uc77c"],completeDate:e["\uc644\ub8cc\uc77c"],docNo:e["\ubb38\uc11c\ubc88\ud638"],recipient:e["\uc218\uc2e0\uc790"],officialDocReceiver:e["\uacf5\ubb38\uc218\uc2e0\ucc98"],officialDocVersionReceiver:"\uacf5\ubb38\uc218\uc2e0\ucc982",preserveDuration:e["\ubcf4\uc874\uc5f0\ud55c"],securityLevel:e["\ubcf4\uc548\ub4f1\uae09"],docClassification:e["\uc804\uc0ac\ubb38\uc11c\ud568"],docReference:e["\ucc38\uc870\uc790"],openOption:e["\uacf5\uac1c\uc5ec\ubd80"],officialDocSender:e["\ubc1c\uc2e0\uba85\uc758"],attachFile:e["\ucca8\ubd80\ud30c\uc77c\uba85"],name_pos:e["\uc774\ub984 \ubc0f \uc9c1\uc704"],user_name:e["\uc774\ub984"],user_pos:e["\uc9c1\uc704"],user_empno:e["\uc0ac\ubc88"],user_org:e["\uc18c\uc18d\ubd80\uc11c"],today:e["\uc624\ub298\ub0a0\uc9dc"]}),r=Hogan.compile(['<li data-activity-type="{{type}}" ','{{#activity.userId}}data-user-id="{{activity.userId}}"{{/activity.userId}} ','{{#activity.deptId}}data-dept-id="{{activity.deptId}}"{{/activity.deptId}} ','{{#activity.id}}data-id="{{activity.id}}"{{/activity.id}}>','<span class="txt">{{activity.displayName}}{{#typeLabel}}({{typeLabel}}){{/typeLabel}}</span>','<i class="ic_prototype ic_prototype_del_s" data-delete-appoint-user></i>',"</li>"].join(" ")),i='<span unselectable="on" contenteditable="false" class="comp_wrap" data-wrapper>',s=['<span contenteditable="false" class="comp_active" style="display:none;">','<span class="Active_dot1"></span><span class="Active_dot2"></span>','<span class="Active_dot3"></span><span class="Active_dot4"></span>',"</span>"].join(" "),o=['<span contenteditable="false" class="comp_hover" data-content-protect-cover="true">','<a contenteditable="false" class="ic_prototype ic_prototype_trash" data-content-protect-cover="true" data-component-delete-button="true"></a>',"</span>"].join(" "),u="</span>",a=require("components/form_component_manager/form_component_manager"),f=require("components/form_component_manager/constants/approval_pallet_items"),l=require("approval/collections/activity_groups"),c=require("approval/models/activity_group"),h=require("approval/models/activity"),p=require("admin/views/appr_line_rule_form"),d=require("hgn!components/form_component_manager/templates/room_type_1_inline"),v=require("hgn!components/form_component_manager/templates/room_type_1_block"),m=require("hgn!components/form_component_manager/templates/room_type_2"),g=require("hgn!components/form_component_manager/templates/form_component_manager"),y=require("admin/views/appr_form_template_list");return a.extend({maxApprovalCountLayer:null,agreementKey:"data-is-agreement",receptionKey:"data-is-reception",events:_.extend(a.prototype.events,{'click [data-right-panel="roomCommon"]':"_onClickRoomCommonPanel",'click [data-add-activity]:not([data-add-activity="apprLineRule"])':"_onClickAddActivity",'click [data-add-activity="apprLineRule"]':"_onClickAddAutoApprovalLine","click [data-delete-appoint-user]":"_onClickDeleteAppointUser","change [data-room-default]":"_onChangeRoomDefaultSetting",'change input[name="approvalType"]:not([value="apprLineRule"])':"_onChangeApprovalType",'change input[name="approvalType"][value="apprLineRule"]':"_onChangeApprLineRule","focus #roomName":"_onFocusRoomName"}),initialize:function(e){this.PALLET_ITEMS=f,this.config=e.config,this.companyIds=e.companyIds,this.backupModel=this.model.toJSON(),this.activityGroups=new l(this.model.get("activityGroups")),this.apprLineRuleCollection=new(Backbone.Collection.extend({url:function(){return GO.contextRoot+"ad/api/approval/apprlinerule"}})),this.apprLineRuleCollection.fetch(),a.prototype.initialize.apply(this,arguments)},render:function(){this.$el.html(g(_.extend(this._getRenderOption(),{model:this.model.toJSON(),assignedActivityDeletable:this.model.get("assignedActivityDeletable"),useDisplayDrafter:this.model.get("useDisplayDrafter"),useIncludeAgreement:this.model.get("useIncludeAgreement"),config:this.config.toJSON()})));var e=!this.model.id&&!this.model.get("templateHtml"),t=e?"":this._convertBlockToInline(this.model.get("templateHtml")),n=_.extend(this.options,{content:this._modelToEditorContent(t)});return this._initEditor(n),this._renderPalletItems(),this._setHeight(),$(window).on("resize",_.bind(function(){this._setHeight()},this)),this.$('input[type="checkbox"]:checked').trigger("change"),this.$("[data-sortable-area]").sortable({items:"li:not(.auto_approve)",stop:_.bind(this._sortRoom,this)}),this._bindOptionsSortable(),this},_onChangeFormName:function(){this.model.set("name",this.$("#formName").val())},_preview:function(){this.$el.siblings(".wrap_prototype_preview").length||this.$el.after(this.preview.render().el);var e=$(this.editor.getDocument()).find("body")[0].innerHTML,t=this._getTemplateHtmlByContent(e);this.preview.show(this.title,t,this._getEditorWidthWithUnit())},_onClickCancel:function(){a.prototype._onClickCancel.apply(this,arguments),this.model.set(this.backupModel)},_onClickSave:function(){this._syncRoomElementToCollection();var t=this;this.activityGroups.each(function(e,n){var r=t._getApprovalRoomBySeq(e.get("seq"));$(r).attr("data-group-seq",n),e.set("seq",n)}),this.model.set("activityGroups",this.activityGroups.toJSON());var n=this.editor.getContent();this.model.set("templateHtml",this._getTemplateHtmlByContent(n));if(!this.activityGroups.length)return $.goMessage(e["\uacb0\uc7ac\uc120\uc744 \ucd94\uac00\ud55c \ud6c4 \uc800\uc7a5\ud574 \uc8fc\uc138\uc694"]),!1;a.prototype._onClickSave.apply(this,arguments)},_syncRoomElementToCollection:function(){var e=this._getAllNormalApprovalRoom(),t=_.map(e,function(e){var t=parseInt(e.getAttribute("data-group-seq")),n=this.activityGroups.findWhere({seq:t});return n||this._generateRoomModel(e),{seq:t,name:e.getAttribute("data-group-name"),maxApprovalCount:e.getAttribute("data-group-max-count")}},this),n=new Backbone.Collection(t),r=_.map(t,function(e){return e.seq}),i=this.activityGroups.filter(function(e){var t=n.findWhere({seq:e.get("seq")});return t?(t.get("maxApprovalCount")>=e.get("activities").length&&e.set(t.toJSON()),!_.contains(r,e.get("seq"))):!0},this);this.activityGroups.remove(i)},_isAgreementOrReception:function(e){var t=e.getAttribute("data-is-agreement")==="true",n=e.getAttribute("data-is-reception")==="true";return t||n},_getRoomDataByElement:function(e){return{seq:parseInt(e.getAttribute("data-group-seq")),maxApprovalCount:e.getAttribute("data-group-max-count"),name:e.getAttribute("data-group-name"),isAgreement:e.getAttribute("data-is-agreement"),isReception:e.getAttribute("data-is-reception"),roomType:e.getAttribute("data-group-type"),type:"room"}},_generateRoomModel:function(e,t){if(this._isAgreementOrReception(e))return;var n=_.extend(this._getRoomDataByElement(e),t),r=new c(n);return this.activityGroups.add(r),r},_initEditor:function(e){_.extend(e,{onLoad:_.bind(this._wrapRoom,this)}),a.prototype._initEditor.call(this,e)},_deleteComponent:function(e){var t=a.prototype._deleteComponent.apply(this,arguments);this.$('[data-attribute-area="room"]').hide();if(this._isAgreementOrReception(t))return;var n=t.getAttribute("data-group-seq");if(n){var r=this.activityGroups.findWhere({seq:parseInt(n)});this.activityGroups.remove(r),this.model.set("activityGroups",this.activityGroups.toJSON()),this.model.set("templateHtml",this.editor.getContent())}},_onClickEditorContent:function(){a.prototype._onClickEditorContent.apply(this,arguments),this._hideApprovalRoomCommonSettingArea()},_onClickComponent:function(e){this.$('[data-attribute-area="room"]').hide();var t=a.prototype._onClickComponent.apply(this,arguments);if(t){var n=t.getAttribute("data-dsl");this.$('[data-attribute-area="room"]').toggle(!n),this.$('[data-attribute-area="component"]').toggle(!!n),this._setComponentEditView(t)}},_getComponentByEvent:function(e){var t=e.target||e.srcElement,n=$(t),r=n.parents(".comp_wrap");return n.parents("[data-group-seq]").length&&!r.length&&this._wrapRoom(),a.prototype._getComponentByEvent.apply(this,arguments)},_onClickRoomCommonPanel:function(){this.$('[data-right-panel-contents="roomCommon"]').is(":visible")&&this._renderRoomSortableArea()},_renderRoomSortableArea:function(){this._syncRoomElementToCollection(),this.$("[data-sortable-area]").empty(),this.activityGroups.each(function(e){this.$("[data-sortable-area]").append(['<li data-group-seq="',e.get("seq"),'"><span class="txt">',e.get("name"),'</span><i class="ic_prototype ic_prototype_move"></i></li>'].join(""))},this)},_onChangeRoomDefaultSetting:function(e){var t=$(e.currentTarget),n=t.attr("name");this.model.set(n,t.is(":checked"))},_onClickAddAutoApprovalLine:function(){var t=$.goPopup({pclass:"layer_normal layer_pay_line",header:n["\uc790\ub3d9\uacb0\uc7ac\uc120"],modal:!0,width:504,buttons:[{btext:e["\ud655\uc778"],autoclose:!1,btype:"confirm",callback:_.bind(function(e){var t=e.find("#apprLineRuleSelect").val(),n=e.find("#apprLineRuleSelect option:selected").attr("data-option-count"),r={type:"apprLineRule",id:t,displayName:e.find("#apprLineRuleSelect option:selected").text(),optionCount:n};this._addApprLineRule(r),e.close()},this)},{btext:e["\ucde8\uc18c"],btype:"cancel"}]}),r=new p({collection:this.apprLineRuleCollection});r.render(),r.renderDetailBoard(),t.reoffset()},_onChangeApprovalType:function(e){var t=$(e.currentTarget),n=t.val();this._toggleApprovalMembersArea(t,n);var r=this.editingComponent.getAttribute("data-group-seq"),i=this.activityGroups.findWhere({seq:parseInt(r)});i.set("use"+GO.util.initCap(n),t.is(":checked")),this.model.set("activityGroups",this.activityGroups.toJSON())},_onChangeApprLineRule:function(e){var t=$(e.currentTarget);this._toggleApprovalMembersArea(t,t.val());var n=this.editingComponent.getAttribute("data-group-seq"),r=this.activityGroups.findWhere({seq:parseInt(n)}),i=t.is(":checked");if(i){var s=this.activityGroups.findWhere({useApprLineRule:!0});s&&s.set("useApprLineRule",!1),r.set("maxApprovalCount",10),this.$("#maxApprovalCount").val(10),this.$('[data-select-custom-value="maxApprovalCount"]').text(10);var o=this._getApprovalRoomBySeq(n);$(o).attr("data-group-max-count",10);var u=this.model.get("apprLineRuleModel");this.model.get("apprLineRuleModel")&&this._appendActivity({type:"apprLineRule",id:u.id,displayName:u.name});var a=this.editingComponent.getAttribute("data-group-type"),f=_.extend(r.toJSON(),{roomType:a});this._replaceApprovalRoom(f)}else this._removeActivity("apprLineRule"),this.model.set("apprLineRuleModel",null);this.model.set("useApprLineRule",i),r.set("useApprLineRule",i),this.$('[data-select-custom="maxApprovalCount"]').attr("disabled",i),this._setAutoApprovalLine()},_replaceApprovalRoom:function(e){this.editingComponent.outerHTML=this._makeRoomTemplate(e,!0),this.editingComponent=this._getSameKindApprovalRoomByData(e)[0],$(this.editingComponent).parent().css("width",e.roomType==="type2"?"100%":"")},_toggleApprovalMembersArea:function(e,t){this.$('[data-approval-members="'+t+'"]').toggle(e.is(":checked")),t==="apprLineRule"&&this._setAutoApprovalLine()},_sortRoom:function(){var e=this.$("[data-sortable-area]").find("li"),t=this._getAllApprovalRoom(),n=_.map(e,function(e){return parseInt($(e).attr("data-group-seq"))});_.each(e,function(e,t){$(e).attr("data-group-seq",t)}),this.activityGroups.each(function(e){var t=e.get("seq"),r=_.indexOf(n,t);e.set("seq",r)}),_.each(t,function(e){if(this._isAgreementOrReception(e))return;var t=$(e),r=parseInt(t.attr("data-group-seq")),i=_.indexOf(n,r);t.attr("data-group-seq",i)},this),this.activityGroups.comparator="seq",this.activityGroups.sort(),this.model.set("activityGroups",this.activityGroups.toJSON()),this.model.set("templateHtml",this.editor.getContent())},_onFocusRoomName:function(){this._hideApprovalRoomCommonSettingArea()},_setComponentEditView:function(e){var t=e.getAttribute("data-dsl");t||this._setApprovalRoomSettingArea(e),a.prototype._setComponentEditView.apply(this,arguments),$.goOrgSlide.close()},_setApprovalRoomSettingArea:function(t){var n=this._getRoomDataByElement(t),r=this._getTitleAndDescription(n),i=(r.title?r.title+" ":"")+e["\uc18d\uc131"];this.$('[data-component-label="room"]').text(i),this.$('[data-desc-area="room"]').text(r.description);var s=this._isAgreementOrReception(t);this.$("[data-normal-room-area]").toggle(!s),this.$("[data-common-room-area]").toggle(!s),this.$('input[name="roomType"]').prop("checked",!1),this.$('input[name="roomType"][value="'+n.roomType+'"]').prop("checked",!0),this._markingInputCover("roomType");if(s)return;this.$("#roomName").val(n.name),this.$("#maxApprovalCount").val(n.maxApprovalCount),this.$('[data-select-custom-value="maxApprovalCount"]').text(n.maxApprovalCount).attr("data-value",n.maxApprovalCount);var o=["approval","agreement","check","inspection","apprLineRule"],u=parseInt(n.seq),a=this.activityGroups.findWhere({seq:u});a||(a=this._generateRoomModel(t,{seq:u})),_.each(o,function(e){var t="use"+GO.util.initCap(e,!0),n=a.get(t),r=this.$('input[name="approvalType"][value="'+e+'"]').prop("checked",!!n);this._markingInputCover("approvalType"),this._toggleApprovalMembersArea(r,e)},this),this._renderActivities(a);var f=a.get("useApprLineRule"),l=this.model.get("apprLineRuleModel");f&&l&&this._appendActivity({type:"apprLineRule",id:l.id,displayName:l.name}),this.$('[data-select-custom="maxApprovalCount"]').attr("disabled",f),this.maxApprovalCountLayer&&this.maxApprovalCountLayer.toggle(!1),this._setAutoApprovalLine()},_setAutoApprovalLine:function(){var e=this.$('[name="approvalType"][value="apprLineRule"]').is(":checked");this.$('[data-activity-type="apprLineRule"]').toggle(e),this.$('[data-add-activity]:not([data-add-activity="apprLineRule"])').toggle(!e),this.$('[data-activity-type]:not([data-activity-type="apprLineRule"])').toggle(!e),this._hideApprovalRoomCommonSettingArea()},_onClickPalletItem:function(e){var t=$(e.currentTarget),n=JSON.parse(t.attr("data-info"));if(n.type==="room"){this._onClickRoom(e);return}a.prototype._onClickPalletItem.apply(this,arguments)},_onClickRoom:function(e){var t=$(e.currentTarget),n=JSON.parse(t.attr("data-info")),r=this.editor.getDocument(),i=this._getAllSameKindApprovalRoomByData(n,r);n.seq=n.seq?n.seq:this._generateRoomSeq(r);if(!this._roomValidation(i,n))return;var s=this._makeRoomTemplate(n);this._setContent(s,!0);if(!n.isAgreement&&!n.isReception){var o=this.activityGroups.findWhere({seq:n.seq});this.activityGroups.remove(o),this.activityGroups.add(new c(n))}},_roomValidation:function(t,n){return!n.isReception&&!n.isAgreement&&t.length>=10?(alert(e["\uc77c\ubc18 \uacb0\uc7ac\uc120\uc740 10\uac1c\uae4c\uc9c0 \uc0ac\uc6a9 \uac00\ub2a5\ud569\ub2c8\ub2e4."]),!1):!n.isReception&&!n.isAgreement||!t.length?!0:(alert(e["\ud574\ub2f9\ucef4\ud3ec\ub10c\ud2b8\ub294 \ud15c\ud50c\ub9bf\ub2f9 \ud55c\uac1c\uc529\ub9cc \uc0ac\uc6a9\uac00\ub2a5\ud569\ub2c8\ub2e4."]),!1)},_onChangeAttribute:function(e){a.prototype._onChangeAttribute.apply(this,arguments);var t=this.editingComponent.getAttribute("data-dsl");if(!t){var n=this._isAgreementOrReception(this.editingComponent),r=this.$("#roomName").val(),i=this.$("#maxApprovalCount").val(),s=this.editingComponent.getAttribute("data-group-seq"),o={type:"room",roomType:this.$('input[name="roomType"]:checked').val(),seq:s};n?(o.name=this.editingComponent.getAttribute("data-group-name"),o.maxApprovalCount=this.editingComponent.getAttribute("data-group-max-count")):(o.name=r,o.maxApprovalCount=i),this.editingComponent.hasAttribute("data-is-reception")&&(o.isReception=this.editingComponent.getAttribute("data-is-reception")),this.editingComponent.hasAttribute("data-is-agreement")&&(o.isAgreement=this.editingComponent.getAttribute("data-is-agreement")),this._replaceApprovalRoom(o);if(!n){var u=this.activityGroups.findWhere({seq:parseInt(s)});u.set("name",r),u.set("maxApprovalCount",i),this.model.set("activityGroups",this.activityGroups.toJSON()),this.model.set("templateHtml",this.editor.getContent())}}},_onClickAddActivity:function(e){var t=this.editingComponent.getAttribute("data-group-seq"),r=$(e.currentTarget).attr("data-add-activity").toUpperCase(),i=function(e){var i=this.activityGroups.findWhere({seq:parseInt(t)}),s={type:r};e.type=="org"?_.extend(s,{userId:null,userName:null,position:null,deptId:e.id,deptName:e.name,displayName:e.name}):_.extend(s,{userId:e.id,userName:e.name,position:e.position,deptId:e.deptId,deptName:e.deptName,displayName:e.displayName});if(i.isExistActivity(s)){$.goAlert(n["\uc774\ubbf8 \ucd94\uac00\ub418\uc5b4 \uc788\uc2b5\ub2c8\ub2e4."]);return}if(i.getActivityCollection().length+1>i.getMaxApprovalCount()){$.goAlert(n["\uc9c0\uc815 \uacb0\uc7ac\uc790\uac00 \ucd5c\ub300 \uacb0\uc7ac\uc790 \uc778\uc6d0\uc218\ub97c \ucd08\uacfc\ud558\uc600\uc2b5\ub2c8\ub2e4."]);return}if(i.getActivityCollection().length+1>10){$.goAlert(n["\uc9c0\uc815 \uacb0\uc7ac\uc790\ub294 10\uac1c\ub97c \ucd08\uacfc \ud558\uc2e4 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4"]);return}if(!h.validate(s))return $.goMessage(n["\ubd80\uc11c\uac00 \uc5c6\ub294 \uc0ac\uc6a9\uc790\ub294 \ucd94\uac00\ud560 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4."]),!1;i.addActivity(s),this.model.set("activityGroups",this.activityGroups.toJSON()),this._appendActivity(s)},s="node",o=this.config.get("agreementAllowType");r=="AGREEMENT"?this.config.get("agreementAllowType")=="DEPARTMENT"?s="department":o=="USER"&&(s="list"):s=_.contains(["APPROVAL","CHECK","INSPECTION"],r)?"list":"node";var u={header:n["add"+r],callback:$.proxy(i,this),contextRoot:GO.contextRoot,type:s,isAdmin:!0};_.isArray(this.companyIds)&&(u.companyIds=this.companyIds),$.goOrgSlide(u)},_renderActivities:function(e){this.$("[data-approval-members]").find("li:not([data-add-activity])").remove(),_.each(e.get("activities"),function(e){this._appendActivity(e)},this)},_removeActivity:function(e){this.$('[data-approval-members="'+e+'"]').find("li:not([data-add-activity])").remove()},_appendActivity:function(e){var t={APPROVAL:"approval",AGREEMENT:"agreement",CHECK:"check",INSPECTION:"inspection",apprLineRule:"apprLineRule"}[e.type];this.$('[data-add-activity="'+t+'"]').before(r.render({type:t,activity:e,typeLabel:n[t]}))},_addApprLineRule:function(e){this._removeActivity("apprLineRule"),this._appendActivity(e);var t=[];if(e.optionCount&&e.optionCount>0)for(var n=0;n<e.optionCount;n++)t.push({});this.model.set("apprLineRuleModel",{id:parseInt(e.id),name:e.displayName,apprLineRuleGroups:t})},_onClickDeleteAppointUser:function(e){var t=parseInt(this.editingComponent.getAttribute("data-group-seq")),n=this.activityGroups.findWhere({seq:t}),r=$(e.currentTarget).parents("[data-activity-type]"),i=r.attr("data-user-id"),s=r.attr("data-dept-id"),o=r.attr("data-id"),u=r.attr("data-activity-type"),a={type:u.toUpperCase()};if(u==="apprLineRule")this.model.set("apprLineRuleModel",null);else{i&&(a.userId=parseInt(i)),s&&(a.deptId=parseInt(s));var f=new Backbone.Collection(n.get("activities")),l=f.findWhere(a);f.remove(l),n.set("activities",f.toJSON()),this.model.set("activityGroups",this.activityGroups.toJSON())}},_getAllSameKindApprovalRoomByData:function(e,t){t=t||this.editor.getDocument();var n=this._getSameKindRoomQuery(e);return $(t).find(n)},_getSameKindApprovalRoomByData:function(e,t){t=t||this.editor.getDocument();var n=this._getSameKindRoomQuery(e);return n+='[data-group-type="'+e.roomType+'"]',n+='[data-group-seq="'+e.seq+'"]',$(t).find(n)},_getSameKindRoomQuery:function(e){var t="[data-group-name]";return e.isAgreement?t+="["+this.agreementKey+'="true"]':e.isReception?t+="["+this.receptionKey+'="true"]':t+="["+this.agreementKey+'!="true"]['+this.receptionKey+'!="true"]',t},_generateRoomSeq:function(e){e=e||this.editor.getDocument();var t=this._getAllNormalApprovalRoom(e),n=_.map(t,function(e){return parseInt($(e).attr("data-group-seq"))});return n.length?_.max(n)+1:0},_getApprovalRoomBySeq:function(e){var t=this.editor.getDocument();return $(t).find('[data-group-seq="'+e+'"]')[0]},_makeRoomTemplate:function(e,t,n){var r=parseInt(e.maxApprovalCount),i=e.roomType==="type1"?n?v:d:m,s=[];for(var o=0;o<r;o++)s.push({});var u=_.clone(e);return i(_.extend(u,{activities:s,withoutCover:t}))},_convertBlockToInline:function(e){var t=$("<span>"+e+"</span>");return _.each(t.find('div[data-group-type="type1"]'),function(e){var t=this._getRoomDataByElement(e);e.outerHTML=this._makeRoomTemplate(t,!0)},this),t[0].innerHTML},_convertInlineToBlock:function(e){var t=$("<span>"+e+"</span>");return _.each(t.find('span[data-group-type="type1"]'),function(e){var t=this._getRoomDataByElement(e);e.outerHTML=this._makeRoomTemplate(t,!0,!0)},this),t[0].innerHTML},_hideApprovalRoomCommonSettingArea:function(){this.$('[data-right-panel-contents="roomCommon"]').slideUp()},_getTemplateHtmlByContent:function(e){var t=new DOMParser,n=t.parseFromString(e,"text/html"),r=$(n).find("[data-group-seq]");_.each(r,function(e){var t=$(e),n=t.parents(".comp_wrap");$.each(n,function(e,n){t.detach(),$(n).after(t),$(n).remove()})},this);var i=this._editorContentToModel(n.body.innerHTML);return $(i).length>1&&(i="<span>"+i+"</span>"),i},_wrapRoom:function(){var e=this.editor.getDocument(),t=this._getAllApprovalRoom(e);_.each(t,function(e){var t=$(e),n=t.attr("data-group-type");t.wrap(i+u);var r=t.parent();n==="type2"&&r.attr("style","width: 100%;"),r.append(s),r.append(o)},this)},_getAllApprovalRoom:function(e){return e=e||this.editor.getDocument(),$(e).find("[data-group-seq]")},_getAllNormalApprovalRoom:function(e){var t=this._getAllApprovalRoom(e);return _.filter(t,function(e){return!this._isAgreementOrReception(e)},this)},_onClickLoadForm:function(){var e=new y({selectCallback:_.bind(function(e){this._setContent(this._modelToEditorContent(e))},this)});e.render()}})});