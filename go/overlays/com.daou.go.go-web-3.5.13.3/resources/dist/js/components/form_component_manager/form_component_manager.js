define("components/form_component_manager/form_component_manager",function(require){var e=require("i18n!nls/commons"),t=_.extend(e,{text:e["\ud14d\uc2a4\ud2b8"],editor:e["\ud3b8\uc9d1\uae30"],textarea:e["\uba40\ud2f0\ud14d\uc2a4\ud2b8"],number:e["\uc22b\uc790"],currency:e["\ud1b5\ud654"],radio:e["\ub2e8\uc77c\uc120\ud0dd"],cSel:e["\ub4dc\ub86d\ubc15\uc2a4"],check:e["\uccb4\ud06c\ubc15\uc2a4"],calendar:e["\ub0a0\uc9dc"],time:e["\uc2dc\uac04"],period:e["\uae30\uac04"],draftUser:e["\uae30\uc548\uc790"],draftUserEmail:e["\uae30\uc548\uc790\uc774\uba54\uc77c"],position:e["\uc9c1\uc704"],empNo:e["\uc0ac\ubc88"],mobileNo:e["\ud578\ub4dc\ud3f0\ubc88\ud638"],directTel:e["\uc9c1\ud1b5\uc804\ud654"],repTel:e["\ub300\ud45c\ubc88\ud638"],fax:e["\ud329\uc2a4"],draftDept:e["\uae30\uc548\ubd80\uc11c"],draftDate:e["\uae30\uc548\uc77c"],completeDate:e["\uc644\ub8cc\uc77c"],docNo:e["\ubb38\uc11c\ubc88\ud638"],recipient:e["\uc218\uc2e0\uc790"],officialDocReceiver:e["\uacf5\ubb38\uc218\uc2e0\ucc98"],officialDocVersionReceiver:"\uacf5\ubb38\uc218\uc2e0\ucc982",preserveDuration:e["\ubcf4\uc874\uc5f0\ud55c"],securityLevel:e["\ubcf4\uc548\ub4f1\uae09"],docClassification:e["\uc804\uc0ac\ubb38\uc11c\ud568"],docReference:e["\ucc38\uc870\uc790"],openOption:e["\uacf5\uac1c\uc5ec\ubd80"],officialDocSender:e["\ubc1c\uc2e0\uba85\uc758"],attachFile:e["\ucca8\ubd80\ud30c\uc77c\uba85"],name_pos:e["\uc774\ub984 \ubc0f \uc9c1\uc704"],user_name:e["\uc774\ub984"],user_pos:e["\uc9c1\uc704"],user_empno:e["\uc0ac\ubc88"],user_org:e["\uc18c\uc18d\ubd80\uc11c"],today:e["\uc624\ub298\ub0a0\uc9dc"],"\uc81c\ubaa9\uc744 \uc785\ub825\ud558\uc138\uc694":e["\uc81c\ubaa9\uc744 \uc785\ub825\ud558\uc138\uc694."],cSum:e["\ud569\uacc4 \uc785\ub825"],rSum:e["\ud569\uacc4 \ud45c\uc2dc"],"\ud569\uacc4 \uc785\ub825 \uc124\uba85":e["\uc22b\uc790 \uc124\uba85"],"\ud569\uacc4 \ud45c\uc2dc \uc124\uba85":e["\uc22b\uc790 \uc124\uba85"],"\uc18c\uc218\uc810 \uc790\ub9ac \uc218":e["\uc18c\uc218\uc810 \uc790\ub9ac \uc218"],"\ubb38\uc11c\ubc88\ud638 \ud0c0\uc785":e["\ubb38\uc11c\ubc88\ud638 \ud0c0\uc785"],"\ubb38\uc11c\ubc88\ud638 \ud0c0\uc785 \uc124\uba85":e["\ubb38\uc11c\ubc88\ud638 \ud0c0\uc785 \uc124\uba85"],"\uc6d0\ubcf8\ubb38\uc11c\ubc88\ud638":e["\uc6d0\ubcf8\ubb38\uc11c\ubc88\ud638"],"\uc218\uc2e0\ubb38\uc11c\ubc88\ud638":e["\uc218\uc2e0\ubb38\uc11c\ubc88\ud638"],onlyNumber:e["\uc22b\uc790\ub9cc \uc785\ub825 \uac00\ub2a5"],"\uc5d0\ub514\ud130\ubcf8\ubb38":e["\uc5d0\ub514\ud130(\ubcf8\ubb38)"],"\uc5d0\ub514\ud130\ud3b8\uc9d1\uae30":e["\uc5d0\ub514\ud130(\ud3b8\uc9d1\uae30)"],"\uae00\uc528 \ud06c\uae30":e["\uae00\uc528 \ud06c\uae30"]}),n='<span unselectable="on" contenteditable="false" class="comp_wrap" data-cid="{{cid}}" data-dsl="{{dsl}}" data-wrapper style="{{style}}" data-value="" data-autotype="{{isAutoType}}">',r=['<span contenteditable="false" class="comp_active" {{^isActive}}style="display:none;"{{/isActive}}>','<span class="Active_dot1"></span><span class="Active_dot2"></span>','<span class="Active_dot3"></span><span class="Active_dot4"></span>',"</span>"].join(" "),i=['<span contenteditable="false" class="comp_hover" data-content-protect-cover="true" data-origin="{{cid}}">','<a contenteditable="false" class="ic_prototype ic_prototype_trash" data-content-protect-cover="true" data-component-delete-button="true"></a>',"</span>"].join(" "),s="</span>",o=[r,i,s].join(" "),u=Hogan.compile(['<li data-value="{{option.value}}">','<i class="ic_prototype ic_prototype_move"></i>','<span class="attr_optipt_wrap">','<input data-option-name class="ipt_prototype" type="text" value="{{option.value}}" data-id="{{option.id}}">',"</span>",'<i class="ic_prototype ic_prototype_del_s" data-delete-option></i>',"</li>"].join(" ")),a=Hogan.compile(['<li data-pallet-item="{{data.type}}" data-info="{{info}}">','<a class="btn_comp btn_comp_approveLine">','<span class="ic_comp {{iconClass}}"></span>','<span class="label">{{label}}</span>',"</a>","</li>"].join(" ")),f=require("hgn!components/form_component_manager/templates/form_component_manager"),l=require("components/backdrop/backdrop"),c=require("components/form_component_manager/constants/templates"),h=require("components/form_component_manager/preview"),p=require("components/form_component_manager/constants/components");return Backbone.View.extend({className:"wrap_prototype",editorId:"formEditor",TIMER_TIME:300,isProcessing:!1,SELECT_DOCUMENT_TYPE_COMPONENTS:[p["\ubb38\uc11c\ubc88\ud638"].data.id],OPTION_AVAILABLE_COMPONENTS:["radio","check","cSel"],ID_AVAILABLE_COMPONENTS:["text","number","textarea","editor","cOrg","calendar","cSum","rSum","label","span"],WIDTH_AVAILABLE_COMPONENTS:["text","number","currency","calendar","cSum","rSum"],REQUIRE_AVAILABLE_COMPONENTS:["text","number","currency","textarea","calendar","cSum"],MAX_LENGTH_AVAILABLE_COMPONENTS:["text","number","currency","textarea","cSum"],CURRENCY_DIGITS_AVAILABLE_COMPONENTS:["currency"],DEFAULT_STR_AVAILABLE_COMPONENTS:["text","number","currency","textarea","calendar"],NUMBER_COMPONENTS:["number","cSum","rSum"],FONT_SIZE_AVAILABLE_COMPONENTS:["draftUser","draftDept","draftUserEmail","position","empNo","mobileNo","directTel","repTel","fax","draftDate","completeDate","docNo","openOption","securityLevel","preserveDuration","docClassification","attachFile","docReference","recipient","officialDocSender"],ID_UN_AVAILABLE_COMPONENTS:[p["\uc81c\ubaa9"].data.id,p["\ubcf8\ubb38 \ub0b4\uc6a9"].data.id,p["\uae30\uc548\uc790"].data.id,p["\uae30\uc548\ubd80\uc11c"].data.id,p["\uae30\uc548\uc790\uc774\uba54\uc77c"].data.id,p["\uc9c1\uc704"].data.id,p["\uc0ac\ubc88"].data.id,p["\ud578\ub4dc\ud3f0\ubc88\ud638"].data.id,p["\uc9c1\ud1b5\uc804\ud654"].data.id,p["\ub300\ud45c\ubc88\ud638"].data.id,p["\ud329\uc2a4"].data.id,p["\uae30\uc548\uc77c"].data.id,p["\uc644\ub8cc\uc77c"].data.id,p["\ubb38\uc11c\ubc88\ud638"].data.id,p["\uacf5\uac1c\uc5ec\ubd80"].data.id,p["\ubcf4\uc548\ub4f1\uae09"].data.id,p["\ubcf4\uc874\uc5f0\ud55c"].data.id,p["\uc804\uc0ac\ubb38\uc11c\ud568"].data.id,p["\ucca8\ubd80\ud30c\uc77c\uba85"].data.id,p["\ucc38\uc870\uc790"].data.id,p["\uc218\uc2e0\uc790"].data.id,p["\ubc1c\uc2e0\uba85\uc758"].data.id,p["\uacf5\ubb38\uc218\uc2e0\ucc98"].data.id,p["\uacf5\ubb38\uc218\uc2e0\ucc982"].data.id],CUSTOM_COMPONENT_LABEL:{maxLength:{text:e["\uc785\ub825 \uac00\ub2a5 \ucd5c\ub300 \uae00\uc790 \uc218 (\uae30\ubcf8 100\uc790)"],textarea:e["\uc785\ub825 \uac00\ub2a5 \ucd5c\ub300 \uae00\uc790 \uc218 (\uae30\ubcf8 100\uc790)"],number:e["\uc785\ub825 \uac00\ub2a5 \ucd5c\ub300 \uc790\ub9bf\uc218"],currency:e["\uc785\ub825 \uac00\ub2a5 \ucd5c\ub300 \uc790\ub9bf\uc218"],cSum:e["\uc785\ub825 \uac00\ub2a5 \ucd5c\ub300 \uc790\ub9bf\uc218"]}},events:{'change input[type="radio"]':"_onChangeRadio",'change input[type="checkbox"]':"_onChangeCheckbox","change select":"_onChangeSelect","click span.btn_help":"_onClickHelp","click [data-cover]":"_onClickInputCover","click .ic_prototype_del_s":"_onClickDeleteButton","click span[data-select-custom]":"_onClickCustomSelect","click [data-select-custom-layer] dd":"_onClickCustomSelectOption","change #numberType":"_onChangeNumberType","change #formName":"_onChangeFormName","change [data-layout-input]":"_onChangeLayout","hover [data-layout-button]":"_onHoverLayout","click [data-layout-button]":"_onClickLayout","click #loadForm":"_onClickLoadForm","click #formEditorPrevie":"_onClickPreview","click #formEditorCancel":"_onClickCancel","click #formEditorSave":"_onClickSave","click [data-left-panel]":"_onClickLeftPanel","click [data-right-panel]":"_onClickRightPanel","click [data-pallet-item]":"_onClickPalletItem","click [data-delete-option]":"_onClickDeleteOption","click [data-add-option]":"_onClickAddOption",'change [data-listen-form="change"]':"_onChangeAttribute","change [data-option-name]":"_onChangeOptionName"},initialize:function(e){this.title=e.title,this.isOfficial=e.isOfficial?e.isOfficial:!1,this.content=e.content,this.saveCallback=e.saveCallback,this.toggleEl=e.toggleEl,this.useLoadForm=e.useLoadForm!==!1,this.preview=new h,this.preview.$el.on("hide",_.bind(function(){this.$el.show()},this)),$(window).on("dext_editor_afterchangemode_event",_.bind(function(){var e=this.editor.getContent(),t=this._modelToEditorContent(e);this.editor.setContent(t)},this)),GO.router.on("beforeNavigate",_.bind(function(){this._cancel()},this))},render:function(){this.$el.html(f(this._getRenderOption()));var e=_.extend(this.options,{content:this._modelToEditorContent(this.content)});return this._initEditor(e),this._renderPalletItems(),this._setHeight(),$(window).on("resize",_.bind(function(){this._setHeight()},this)),this._bindOptionsSortable(),this.$('input[type="checkbox"]:checked').trigger("change"),this},_bindOptionsSortable:function(){this.$("#options").sortable({items:"li:not([data-add-option])",stop:_.bind(this._changeOptions,this)})},_onChangeFormName:function(){this.title=this.$("#formName").val()},_initEditor:function(e){if(this.editor)return;var t=_.extend(e,{contextRoot:GO.config("contextRoot"),height:this._getEditorHeight()+"px",width:this._getEditorWidthWithUnit(),isFormEditor:!0});GO.Editor.create("Dext5Editor",this.$("#"+this.editorId),t),this.editor=GO.Editor.getInstance(this.editorId),this.editor.$el.off("clickEditorContent").on("clickEditorContent",_.bind(this._onClickEditorContent,this)),this.editor.$el.off("keypressEditorContent").on("keypressEditorContent",_.bind(this._onKeyPressEditorContent,this))},_renderPalletItems:function(){var e=["base","auto","advanced"];_.each(e,function(e){var t=this.$("#"+e);_.each(this.PALLET_ITEMS[e],function(e){t.append(a.render(_.extend(e,{info:JSON.stringify(e.data),iconClass:e.iconClass})))})},this)},_onChangeAttribute:function(e){var t=$(e.currentTarget),n=t.attr("type")==="checkbox"?t.is(":checked"):t.val();if(this._validateStringCheck(t,n))return!1;var r=this.editingComponent.getAttribute("data-dsl");if(r){var i=t.attr("name"),s=this._convertDSLToData(r);s[i]=n,this._changeComponent(s)}},_validateStringCheck:function(n,r){var i=n.attr("id");if(i=="maxlength"||i=="width"){var s=new RegExp("[^0-9]","g");if(s.test(r))return $.goError(t.onlyNumber),n.val("").focus(),!0}return i=="defaultstr"&&this._hasCurlyBrace(r)?($.goError(e["\ubd88\uc6a9\ubb38\uc790 \ud3ec\ud568 \uacbd\uace0\uba54\uc2dc\uc9c0"]),!0):!1},_hasCurlyBrace:function(e){return _.indexOf(e,"{")>-1||_.indexOf(e,"}")>-1?!0:!1},_changeComponent:function(e){var t=this.editingComponent.getAttribute("data-cid");this.editingComponent.outerHTML=this._makeTemplate(e,t,!0),this.editingComponent=this._getComponentByCid(t)},_onClickAddOption:function(){if(this._checkProcessing())return;this._preventDuplicationTimer(),this.$("[data-add-option]").before(u.render({option:{value:e["\uc635\uc158"]}})),this._changeOptions()},_onChangeOptionName:function(){this._changeOptions()},_changeOptions:function(){var t=this.editingComponent.getAttribute("data-dsl"),n=this._convertDSLToData(t),r=this.$("#options").find("li:not([data-add-option])").length,i=!0;n.options=_.map(this.$("#options").find("li:not([data-add-option])"),function(t){var n=$(t),s=n.find("input"),o=s.val();r>1&&_.isEmpty(o.trim())&&($.goMessage(e["\uc635\uc158\uc774 2\uac1c \uc774\uc0c1\uc778 \uacbd\uc6b0 \uc635\uc158 \uc774\ub984\uc740 \ud544\uc218\uac12 \uc785\ub2c8\ub2e4."]),i=!1);if(_.indexOf(o,":")>-1||this._hasCurlyBrace(o))$.goMessage(e["\uc0ac\uc6a9\ud560 \uc218 \uc5c6\ub294 \ubb38\uc790\uc785\ub2c8\ub2e4."]),i=!1;return _.indexOf(o,"_")>-1&&(o=o.replace(/_/g,"")),s.val(o),n.attr("data-value",o),{value:o,id:n.attr("data-id")}},this);if(!i)return;this._changeComponent(n)},_onClickInputCover:function(e){var t=$(e.currentTarget);t.siblings("input").trigger("click")},_onChangeRadio:function(e){var t=$(e.currentTarget),n=t.attr("name");this._markingInputCover(n)},_markingInputCover:function(e){_.each(this.$('input[name="'+e+'"]'),function(e){var t=$(e),n=t.siblings("[data-cover]"),r=n.attr("data-cover"),i=t.is(":checked"),s={radio:"ic_prototype_radio ic_prototype_radio_selected",check:"ic_prototype_chk ic_prototype_chk_selected",toggle:"ic_attr_toggle_off ic_attr_toggle_on"}[r].split(" ");n.addClass(s[+i]),n.removeClass(s[+!i])})},_onChangeCheckbox:function(e){var t=$(e.currentTarget),n=t.attr("name");this._markingInputCover(n)},_onClickCustomSelect:function(e){var t=$(e.currentTarget).attr("data-select-custom");this[t+"Layer"]||(this[t+"Layer"]=new l({el:this.$('[data-select-custom-layer="'+t+'"]')}),this[t+"Layer"].linkBackdrop(this.$('[data-select-custom="'+t+'"]')))},_onChangeSelect:function(e){var t=$(e.currentTarget),n=t.parent().find("[data-select-custom-value]");n.text(t.find(":selected").text()),n.attr("data-value",t.val())},_onClickCustomSelectOption:function(e){e.stopPropagation();var t=$(e.currentTarget),n=t.attr("data-value"),r=t.parents("[data-select-custom]").attr("data-select-custom"),i=this.$('[data-select-custom-value="'+r+'"]').attr("data-value");this[r+"Layer"].toggle(!1);if(n===i)return;t.parents('[data-select-custom="'+r+'"]').siblings("select").val(n).trigger("change")},_onChangeNumberType:function(e){var t=$(e.currentTarget).val(),n=this.editingComponent.getAttribute("data-dsl"),r=this._convertDSLToData(n);r.type=t;if(t==="rSum"){var i=r.id||undefined;r={type:"rSum",id:i}}var s=this._convertDataToDSL(r);this.editingComponent.setAttribute("data-dsl",s),this._replaceComponent(r),this._setComponentEditView(this.editingComponent)},_onClickDeleteButton:function(e){$(e.currentTarget).parents("li:first").remove()},_deleteComponent:function(e){var t=this._getComponentByEvent(e);return this._removeComponentElement(t),this.editingComponent=null,this.$("[data-not-selected]").show(),this.$('[data-attribute-area="component"]').hide(),t},_onClickEditorContent:function(e,t){var n=$(t.target);n.hasClass("ic_prototype ic_prototype_trash")?this._deleteComponent(t):this._onClickComponent(t)},_onClickComponent:function(e){var t=this._getComponentByEvent(e);return t==this.editingComponent?t:(this._deActivateComponent(this.editingComponent),t?(this._activateComponent(t),this.editingComponent=t,this._setComponentEditView(t)):this.editingComponent=null,this.$('[data-attribute-area="component"]').toggle(!!t),this.$("[data-not-selected]").toggle(!t),t)},_removeComponentElement:function(e){e.hasAttribute("data-dsl")?$(e).remove():$(e).parent().remove()},_deActivateComponent:function(e){if(!e)return;this._toggleComponent(!1,e)},_activateComponent:function(e){this._toggleComponent(!0,e)},_toggleComponent:function(e,t){if(!t.hasAttribute)return;var n=t.hasAttribute("data-dsl")?$(t).children(".comp_active"):$(t).siblings(".comp_active");n.toggle(e)},_onKeyPressEditorContent:function(e,t){if(!this.editingComponent)return!0;if(t.keyCode===13){var n=$(this.editingComponent),r="<p><br></p>";this.editingComponent.hasAttribute("data-dsl")?n.after(r):n.parent().after(r)}},_setComponentEditView:function(t){var n=t.getAttribute("data-dsl");if(n){var r=this._convertDSLToData(n),i=t.style.fontSize;i&&(r.fontSize=parseInt(i));var s=this._getTitleAndDescription(r),o=(s.title?s.title+" ":"")+e["\uc18d\uc131"];this.$('[data-component-label="component"]').text(o),this.$('[data-desc-area="component"]').text(s.description),this._toggleAvailableSettingView(r)}},_toggleAvailableSettingView:function(t){this.$("#requireSettingArea").parents(".panel").show();var n=_.contains(this.REQUIRE_AVAILABLE_COMPONENTS,t.type);this.$("#requireSettingArea").toggle(n),n&&(this.$("#isRequire").prop("checked",!!t.isRequire),this._markingInputCover("isRequire"));var r=_.contains(this.MAX_LENGTH_AVAILABLE_COMPONENTS,t.type);this.$("#maxLengthSettingArea").toggle(r),r&&(this.$('[data-custom-label="maxLength"]').text(this.CUSTOM_COMPONENT_LABEL.maxLength[t.type]),this.$("#maxlength").val(t.maxlength));var i=_.contains(this.WIDTH_AVAILABLE_COMPONENTS,t.type);this.$("#widthSettingArea").toggle(i),i&&this.$("#width").val(t.width);var s=_.contains(this.CURRENCY_DIGITS_AVAILABLE_COMPONENTS,t.type);this.$("#digitsSettingArea").toggle(s),s&&this.$("#currencyDigits").val(t.currencyDigits);var o=_.contains(this.DEFAULT_STR_AVAILABLE_COMPONENTS,t.type);this.$("#defaultStrSettingArea").toggle(o),o&&this.$("#defaultstr").val(t.defaultstr);var a=_.contains(this.OPTION_AVAILABLE_COMPONENTS,t.type);this.$("[data-option-area]").toggle(a),a&&(this.$("#options").find("li:not([data-add-option])").remove(),_.each(t.options,function(e){this.$("[data-add-option]").before(u.render({option:e}))},this));var f=_.contains(this.ID_AVAILABLE_COMPONENTS,t.type),l=_.contains(this.ID_UN_AVAILABLE_COMPONENTS,t.id);l&&(f=!1),this.$("#idSettingArea").parents(".panel").toggle(f),f&&this.$("#id").val(t.id);var c=_.contains(this.NUMBER_COMPONENTS,t.type);this.$("#autoCalArea").toggle(c);if(c){this.$("#numberType").val(t.type);var h=t.type==="number"?e["\uc77c\ubc18 \uc22b\uc790"]:e[t.type];this.$('[data-select-custom-value="numberType"]').attr("data-value",t.type).text(h)}var p=_.contains(this.SELECT_DOCUMENT_TYPE_COMPONENTS,t.id);this.isOfficial&&(p=!1),this.$("#componentDocTypeArea").toggle(p),p&&(t.componentDocType=="reception"?$("input[name=componentDocType][value='reception']").prop("checked",!0):$("input[name=componentDocType][value='origin']").prop("checked",!0),this._markingInputCover("componentDocType"))},_onClickPalletItem:function(t){var n=$(t.currentTarget),r=JSON.parse(n.attr("data-info"));if(!this._validateDuplicateComponent(r)){alert(e["\ud574\ub2f9\ucef4\ud3ec\ub10c\ud2b8\ub294 \ud15c\ud50c\ub9bf\ub2f9 \ud55c\uac1c\uc529\ub9cc \uc0ac\uc6a9\uac00\ub2a5\ud569\ub2c8\ub2e4."]);return}var i=this._makeTemplate(r,this._generateComponentSeq());this._setContent(i,!0)},_getComponentByCid:function(e){var t=this.editor.getDocument();return $(t).find('[data-dsl][data-cid="'+e+'"]')[0]},_generateComponentSeq:function(){var e=this._getAllComponents(),t=_.map(e,function(e){return parseInt($(e).attr("data-cid"))});return t.length?_.max(t)+1:0},_getAllComponents:function(){return $(this.editor.getDocument()).find("[data-dsl]")},_preventDuplicationTimer:function(){var e=$.Deferred();return this.isProcessing=!0,setTimeout(_.bind(function(){this.isProcessing=!1,console.log("Ready / "+this.isProcessing),e.resolve()},this),this.TIMER_TIME),e},_checkProcessing:function(){return this.isProcessing&&alert(e["\uc5d0\ub514\ud130\uac00 \uc791\uc5c5\uc744 \ucc98\ub9ac\uc911\uc785\ub2c8\ub2e4. \uc7a0\uc2dc\ub9cc \uae30\ub2e4\ub824 \uc8fc\uc138\uc694."]),this.isProcessing},_setContent:function(e,t){if(this._checkProcessing())return;var n=this._preventDuplicationTimer();return this.editor.setContent($.trim(e),t),n},_getComponentByEvent:function(e){var t=e.target||e.srcElement,n=$(t),r=n.parents(".comp_wrap"),i=r.attr("data-dsl")?r[0]:r.find("[data-group-seq]")[0],s=n.hasClass("comp_hover")&&!r.length;return console.log(s?"InvalidMarkup":i),s&&(n.siblings(".comp_active").remove(),n.remove()),i},_validateDuplicateComponent:function(e){if(e.duplicate!==!1)return!0;var t=e.type+(e.id?":"+e.id:"");e.isAutoType&&(t=e.id);var n=this._getAllComponents(),r=_.map(n,function(e){var t=this._convertDSLToData(e.getAttribute("data-dsl")),n=t.type+(t.id?":"+t.id:"");return t.isAutoType&&(n=t.id),n},this);return!_.contains(r,t)},_onClickDeleteOption:function(){this._changeOptions()},_onClickLeftPanel:function(e){var t=$(e.currentTarget).attr("data-left-panel");this.$('[data-left-panel-contents="'+t+'"]').slideToggle()},_onClickRightPanel:function(e){$(e.currentTarget).siblings("[data-right-panel-contents]").slideToggle()},_onClickHelp:function(e){$(e.currentTarget).siblings(".help").slideToggle("fast")},_onClickLoadForm:function(){},_onClickPreview:function(){this._preview()},_preview:function(){this.$el.siblings(".wrap_prototype_preview").length||this.$el.after(this.preview.render().el),console.log("preview");var e=this.editor.getContent(),t=this._editorContentToModel(e);this.preview.show(this.title,t,this._getEditorWidthWithUnit())},_onClickCancel:function(){this._cancel()},_cancel:function(){this.toggleEl.show(),this.$el.remove(),this.preview.remove()},_onClickSave:function(){var e=this.editor.getContent(),t=this._editorContentToModel(e);this.toggleEl.show(),this.preview.remove(),this.$el.remove(),this.saveCallback&&this.saveCallback.apply(this,[this.title,t])},_onHoverLayout:function(e){var t=$(e.currentTarget);t.children(".tooltip_type2").fadeToggle("fast")},_onClickLayout:function(e){var t=$(e.currentTarget);if(t.hasClass("on")||this.resizing)return;this.$("[data-layout-input]").val(""),this.$("[data-custom-wrapper]").hide(),this.$("[data-layout-button]").removeClass("on"),t.addClass("on");var n=t.attr("data-layout-button");n==="wide"?(this.resizing=!0,this.$("#formEditor").animate({"margin-top":"0px","margin-left":"0px",width:"100%"}),this.$(".ruler_w").slideUp(),this._setHeight(),this._resizeEditor()):n==="vertical"?(this.resizing=!0,this._changeFixedWidthLayout()):(this.$("[data-custom-wrapper]").show(),this.$("[data-alert]").show())},_onChangeLayout:function(e){if(this.resizing)return;var t=parseInt($(e.currentTarget).val()),n=_.isNumber(t)&&!_.isNaN(t)&&t>=100&&t<=2e3;this.$(".mode_custom_wrap").toggleClass("err_validation",!n);if(!n)return;this.$("[data-layout-button]").removeClass("on"),this._changeFixedWidthLayout()},_changeFixedWidthLayout:function(){this.$("#formEditor").animate({"margin-top":"30px","margin-left":"15px",width:this._getEditorWidthWithUnit()}),this.$(".ruler_w").slideDown(),setTimeout(_.bind(function(){this._setHeight(),this._resizeEditor()},this),400)},_setHeight:function(){this.$(".comp, .attr").height(this._getContentHeight()),this.$(".doc").height(this._getEditorWrapperHeight())},_getContentHeight:function(){return $(window).outerHeight()-(this.$(".gnb").outerHeight()||61)},_getEditorHeight:function(){return this._getEditorWrapperHeight()-parseInt(this.$("#formEditor").css("margin-top"))},_getEditorWrapperHeight:function(){var e=this._getLayoutType(),t=e==="wide"?0:20;return this._getContentHeight()-t},_resizeEditor:function(){var e=this.editor.getContent();this.editor.destroy(),this.editor=null,this._initEditor(_.extend(this.options,{height:this._getEditorHeight(),width:this._getEditorWidthWithUnit(),content:e})),$(window).on("dext_editor_loaded",_.bind(function(){this.resizing=!1},this))},_getLayoutType:function(){return"wide"},_getEditorWidthWithUnit:function(){return{vertical:"836px",wide:"100%",custom:this.$("[data-layout-input]").val()+"px"}[this._getLayoutType()]},_editorContentToModel:function(e){var t=$("<span>"+e+"</span>");return this._toSpan(t),t[0].innerHTML},_modelToEditorContent:function(e){if(!e)return"";var t=$("<span>"+e+"</span>");return this._toInput(t),t[0].innerHTML},_toSpan:function(t){var n="";_.each(t.find("[data-dsl]"),function(t){var r=t.getAttribute("data-dsl"),i=this._convertDSLToData(r);this._validateDataDsl(i.type)||(n=e["\uc9c0\uc6d0\ud558\uc9c0 \uc54a\ub294 \ud615\ud0dc\uc758 \ub370\uc774\ud130\uac00 \ud3ec\ud568\ub418\uc5c8\uc2b5\ub2c8\ub2e4. \uc591\uc2dd\uc744 \ub2e4\uc2dc \uc218\uc815\ud574\uc8fc\uc138\uc694."]);var s=$(t),o=$("<span></span>"),u=s.parent();for(var a=0;a<3&&u.is("span");a++)u=u.parent();_.each(s.prop("attributes"),function(e){if(e.name==="data-wrapper")return;o.attr(e.name,e.value)}),s.before(o),s.remove();if(i.type==="editor"&&u.is("p")){var f=u.contents();u.replaceWith(f)}},this),_.isEmpty(n)||$.goError(n)},_toInput:function(t){var n="";_.each(t.find("[data-dsl]"),function(e,t){if(e.hasAttribute("data-wrapper"))return;var r=$(e),i=r.attr("data-dsl"),s=this._convertDSLToData(i);if(!this._validateDataDsl(s.type)){n=n.concat(e.outerHTML+"\n	\n");return}var o=this._makeTemplate(s,t);r.after(o),r.remove()},this),_.isEmpty(n)||$.goPopup({title:e["\uc9c0\uc6d0\ud558\uc9c0 \uc54a\ub294 data-dsl\uc744 \uc0ac\uc6a9\ud558\uc168\uc2b5\ub2c8\ub2e4."],message:GO.util.escapeHtml(n),modal:!0,buttons:[{btext:e["\ud655\uc778"],btype:"confirm"}]})},_convertSpecialAttribute:function(e){e=e.replace(/{{([^}}]*)}}/g,function(e,t){return t});var t=/(\$require\$)/gi,n=/(\$autotype\$)/gi,r=/(\$adminedit\$)/gi,i={};return t.test(e)&&(i.isRequire=!0,e=e.replace(t,"")),n.test(e)&&(i.isAutoType=!0,e=e.replace(n,"")),r.test(e)&&(i.isEditable=!1,e=e.replace(r,"")),e.replace(/\$maxlength:([0-9]*)\$/g,function(t,n){i.maxlength=n,e=e.replace(t,"")}),e.replace(/\$width:([0-9]*)\$/g,function(t,n){i.width=n,e=e.replace(t,"")}),e.replace(/\$defaultstr:(.*)\$/g,function(t,n){i.defaultstr=n,e=e.replace(t,"")}),e.replace(/\$simple\$/g,function(t){i.skinType="simple",e=e.replace(t,"")}),e.replace(/\$department\$/g,function(t){i.orgType="department",e=e.replace(t,"")}),e.replace(/currency_([0-9]*)/g,function(e,t){i.currencyDigits=t}),e.replace(/\$componentDocType:(.*)\$/g,function(t,n){i.componentDocType=n,e=e.replace(t,"")}),{dsl:e,returnValue:i}},_convertDSLToData:function(e){var t=this._convertSpecialAttribute(e);e=t.dsl;var n=t.returnValue;e.replace(/:apprLineRuleOption|:apprLineRuleAmount/g,function(t){e=e.replace(t,""),n.id=t.replace(":","")});var r=e.search(/:|_/);r===-1&&(r=e.length);var i=e.substr(r,1),s=e.substring(r+1,e.length);n.type=e.substring(0,r);if(i==="_")if(c[e])n.type=e;else{var o=s.split("_");o.length&&(n.options=[]),_.each(o,function(e){var t=e.split(":");n.options.push({value:t[0],id:t[1]})})}else i===":"&&(n.id=s);return n},_convertDataToDSL:function(e){var t="{{"+e.type;e.currencyDigits&&(t+="_"+e.currencyDigits),e.isRequire&&(t+="$require$"),e.isAutoType&&(t+="$autotype$"),e.isEditable===!1&&(t+="$adminedit$"),e.orgType==="department"&&(t+="$department$"),e.skinType==="simple"&&(t+="$simple$"),!_.isUndefined(e.id)&&e.id!==""&&(t+=":"+e.id);if(e.options&&e.options.length&&!e.currencyDigits){var n=_.map(e.options,function(e){return e.value+(e.id?":"+e.id:"")});t=_.flatten([t,n]).join("_")}return e.defaultstr&&(t+="$defaultstr:"+e.defaultstr+"$"),e.width&&(t+="$width:"+e.width+"$"),e.maxlength&&(t+="$maxlength:"+e.maxlength+"$"),e.componentDocType&&(t+="$componentDocType:"+e.componentDocType+"$"),t+"}}"},_makeTemplate:function(r,i,s){var u=r.type,a=c[u],f=a.template,l=r.type==="label"||r.type==="span"?r.id:r.type,h=r.width?"width: "+r.width+"px;":a.style;r.id==="auto"&&(r.id=i);var p=!1;return u==="editor"&&r.id==="appContent"&&(p=!0),Hogan.compile(n+f.join("")+o).render(_.extend(r,{cid:i,dsl:this._convertDataToDSL(r),label:t[l]||e["\ub808\uc774\ube14"],style:h||"",options:r.options,isActive:s,lang:t,isAutoType:r.isAutoType,isAppContent:p}))},_validateDataDsl:function(e){return c[e]?!0:!1},_getRenderOption:function(){return{lang:t,useTitle:this.title!==!1,title:this.title,useLoadForm:this.useLoadForm,hasAuto:!!this.PALLET_ITEMS.auto,hasAdvanced:!!this.PALLET_ITEMS.advanced}},_replaceComponent:function(e){var t=this.editingComponent.getAttribute("data-cid");this.editingComponent.outerHTML=this._makeTemplate(e,t,!0),this.editingComponent=this._getComponentByCid(t)},_getTitleAndDescription:function(n){var r="";switch(n.type){case"text":n.id==="subject"?r="\uc81c\ubaa9":r="\ud14d\uc2a4\ud2b8";break;case"editor":n.id==="appContent"?r="\ubcf8\ubb38 \ub0b4\uc6a9":r="\ud3b8\uc9d1\uae30";break;case"room":n.isAgreement==="true"?r="\ud569\uc758 \uacb0\uc7ac\uc120":n.isReception==="true"?r="\uc218\uc2e0 \uacb0\uc7ac\uc120":r="\uacb0\uc7ac\uc120";break;case"currency":n.id==="apprLineRuleAmount"?r="\ud1b5\ud654 \uc790\ub3d9\uacb0\uc7ac\uc120":r="\ud1b5\ud654";break;case"radio":n.id==="apprLineRuleOption"?r="\ub2e8\uc77c\uc120\ud0dd \uc790\ub3d9\uacb0\uc7ac\uc120":r="\ub2e8\uc77c\uc120\ud0dd";break;case"cSel":n.id==="apprLineRuleOption"?r="\ub4dc\ub86d\ubc15\uc2a4 \uc790\ub3d9\uacb0\uc7ac\uc120":r="\ub4dc\ub86d\ubc15\uc2a4";break;case"cOrg":n.orgType==="department"?r="\ubd80\uc11c\uc120\ud0dd":r="\uc0ac\uc6a9\uc790\uc120\ud0dd";break;case"label":r={draftUser:"\uae30\uc548\uc790",draftDept:"\uae30\uc548\ubd80\uc11c",draftUserEmail:"\uae30\uc548\uc790\uc774\uba54\uc77c",position:"\uc9c1\uc704",empNo:"\uc0ac\ubc88",mobileNo:"\ud578\ub4dc\ud3f0\ubc88\ud638",directTel:"\uc9c1\ud1b5\uc804\ud654",repTel:"\ub300\ud45c\ubc88\ud638",fax:"\ud329\uc2a4",draftDate:"\uae30\uc548\uc77c",completeDate:"\uc644\ub8cc\uc77c",docNo:"\ubb38\uc11c\ubc88\ud638",openOption:"\uacf5\uac1c\uc5ec\ubd80",securityLevel:"\ubcf4\uc548\ub4f1\uae09",preserveDuration:"\ubcf4\uc874\uc5f0\ud55c",docClassification:"\uc804\uc0ac\ubb38\uc11c\ud568",attachFile:"\ucca8\ubd80\ud30c\uc77c\uba85",docReference:"\ucc38\uc870\uc790",recipient:"\uc218\uc2e0\uc790",officialDocSender:"\ubc1c\uc2e0\uba85\uc758"}[n.id]||"\ub808\uc774\ube14";break;case"span":n.id==="officialDocReceiver"?r="\uacf5\ubb38\uc218\uc2e0\ucc98":n.id==="officialDocVersionReceiver"&&(r="\uacf5\ubb38\uc218\uc2e0\ucc982");break;default:}return r||(r={textarea:"\uba40\ud2f0\ud14d\uc2a4\ud2b8",number:"\uc22b\uc790",check:"\uccb4\ud06c\ubc15\uc2a4",calendar:"\ub0a0\uc9dc",time:"\uc2dc\uac04",period:"\uae30\uac04",name_pos:"\uc774\ub984 \ubc0f \uc9c1\uc704",user_name:"\uc774\ub984",user_pos:"\uc9c1\uc704(\ubcf4\uace0)",user_empno:"\uc0ac\ubc88(\ubcf4\uace0)",user_org:"\uc18c\uc18d\ubd80\uc11c",today:"\uc624\ub298\ub0a0\uc9dc",cSum:"\ud569\uacc4 \uc785\ub825",rSum:"\ud569\uacc4 \ud45c\uc2dc"}[n.type]),{title:e[r]||"",description:t[r+" \uc124\uba85"]||""}}})});