define(function(require){var e=require("backbone"),t=require("i18n!nls/commons"),n=require("components/backdrop/backdrop"),r=require("hgn!components/emoticon/templates/emoticons"),i={next:t["\ub2e4\uc74c"]},s=0,o=0,u=7;return e.View.extend({attributes:{"data-emoticons-wrapper":""},initialize:function(e){this.options=e||{},this._init()},render:function(){return this.groups=GO.emoticonGroups(),this.$el.html(r({lang:i,baseImgUrl:GO.contextRoot+GO.config("emoticonBaseUrl")})),this._backdrop(),this},_init:function(){s=0,o=0},renderEmoticonGroup:function(e){$("[data-emoticon-group-wrapper]").hide();var t=e.parents("[data-replies-wrapper]").find("[data-emoticon-group-wrapper]");t.addClass("layer_normal layer_emoticon"),t.insertAfter(e),this._renderTab(t.find("[data-emoticon-tab-ul]")),this._renderLeftRightBtn(t),this._renderItem(t.find("[data-emoticon-item-ul]"),this.groups[o].groupKey),t.show()},_renderTab:function(e){e.empty();for(var t=s;t<u+s;t++){if(e.find("[data-group-key="+this.groups[t].groupKey+"]").length)continue;var n=t===o?"btn_emoticon on":"btn_emoticon",r=GO.config("emoticonBaseUrl")+"/"+this.groups[t].groupKey+"/"+this.groups[t].tabItemName;e.append('<li><button type="button" class="'+n+'" data-group-key="'+this.groups[t].groupKey+'">'+'<img class="emoticon" src="'+r+'" alt=""></button></li>')}e.find("[data-group-key]").on("click",$.proxy(this._onClickNavi,this))},_renderLeftRightBtn:function(e){var n=e.find("[data-emoticon-tab-wrapper]");n.find('[data-route="previous"]').length<1&&n.prepend('<button class="btn_arrow" title="'+t["\ub2e4\uc74c"]+'" data-route="previous"><span class="ic ic_prev2"></span></button>'),n.find('[data-route="next"]').length<1&&n.append('<button class="btn_arrow" title="'+t["\ub2e4\uc74c"]+'" data-route="next"><span class="ic ic_next2"></span></button>'),e.find("[data-route]").on("click",$.proxy(this._moveToGroup,this))},_renderItem:function(e,t){var n=_.find(this.groups,function(e){return e.groupKey===t},this),r=(n.itemCount+"").length;e.empty();for(var i=1;i<n.itemCount+1;i++){var s=GO.util.numberPad(i,r),o="/"+n.groupKey+"/"+n.namePrefix+s+"."+n.extension,u=GO.config("emoticonBaseUrl")+o;e.append('<li><button type="button" class="btn_emoticon" data-item-path="'+o+'" data-emoticon-item>'+'<img class="emoticon" src="'+u+'" alt=""> </button></li>')}e.find("[data-emoticon-item]").on("click",$.proxy(this._onClickItem,this))},_onClickNavi:function(e){var t=$(e.currentTarget);t.parents("[data-emoticon-tab-ul]").find("[data-group-key]").removeClass("on"),t.addClass("on");var n=t.attr("data-group-key");_.each(this.groups,function(e,t){e.groupKey===n&&(o=t)});var r=t.parents("[data-emoticon-tab-wrapper]").siblings(".scroll_y").find("[data-emoticon-item-ul]");this._renderItem(r,t.attr("data-group-key"))},_onClickItem:function(e){e.preventDefault(),e.stopPropagation();var n=$(e.currentTarget),r=GO.config("emoticonBaseUrl")+n.attr("data-item-path"),i=n.parents("[data-func-wrapper]").siblings("[data-emoticon-edit-part]");i.addClass("thumb_append"),i.siblings("[data-func-wrapper]").find("#create").addClass("on"),i.find("#commentEmoticonImg").length<1?i.append('<img class="emoticon" id="commentEmoticonImg" src="'+r+'" data-selected-emoticon data-item-path="'+n.attr("data-item-path")+'" alt="" >'+'<a data-bypass class="ic ic_del_circle" data-emoticon-delete-btn title="'+t["\uc774\ubaa8\ud2f0\ucf58 \uc0ad\uc81c"]+'"></a>'):(i.find("#commentEmoticonImg").attr("src",r),i.find("#commentEmoticonImg").attr("data-item-path",n.attr("data-item-path"))),$("[data-emoticon-group-wrapper]").hide()},_moveToGroup:function(e){var t=$(e.currentTarget).attr("data-route"),n=s;t==="previous"?n=s>0?s-1:0:t==="next"&&(n=s+u<this.groups.length?s+1:s);if(n!==s){s=n;var r=$(e.currentTarget).siblings(".wrap_list_emoticon").find("[data-emoticon-tab-ul]");this._renderTab(r)}},_backdrop:function(){var e=new n;e.backdropToggleEl=this.$("[data-emoticon-group-wrapper]"),e.linkBackdrop(this.$("[el-backdrop-link]")),e.bindBackdrop()},hasSelectedEmoticon:function(e){return e.parents("[data-func-wrapper]").siblings("[data-emoticon-edit-part]").find("img").length>0?($.goMessage(t["\uc120\ud0dd\ud55c \uc774\ubaa8\ud2f0\ucf58 \uc0ad\uc81c \ud6c4 \ud30c\uc77c\uc744 \ucca8\ubd80\ud574\uc8fc\uc138\uc694."]),!0):!1},hasAttaches:function(e){return e.parents("[data-func-wrapper]").siblings("[data-attaches-edit-part]").find("li:not(.attachError)").length>0?($.goMessage(t["\ucca8\ubd80 \ud30c\uc77c \uc0ad\uc81c \ud6c4 \uc774\ubaa8\ud2f0\ucf58\uc744 \uc120\ud0dd \ud574\uc8fc\uc138\uc694."]),!0):!1},getSelectedEmoticonImgSrc:function(e){var t=e.parents("[data-func-wrapper]").siblings("[data-emoticon-edit-part]").find("img");if(t.length>0)return t.attr("data-item-path")},moveToMainEmoticonView:function(e){var t=e.parents("[data-replies-wrapper]"),n=t.find("[data-emoticon-group-wrapper]"),r=t.find("[data-comment-main-edit]").siblings("[data-emoticons-wrapper]");n.insertAfter(r)}})});