(function(){define(["jquery","backbone","app","i18n!nls/commons","components/comment/collections/comments","components/m_comment/views/item","components/m_comment/views/form","components/m_comment/views/reply","hgn!components/m_comment/templates/temp_attach_image_item","components/go-fileuploader/mobile","views/mobile/header_toolbar","jquery.go-validation","GO.util"],function(e,t,n,r,i,s,o,u,a,f,l){var c=t.View.extend({tagName:"ul",className:"list_reply",events:{"vclick li a.reply":"addReply","keyup textarea":"_expandTextarea"},initialize:function(e){this.headerToolbarView=l,this.options=e||{},this.$el.off(),this.isReply=e.isReply==undefined?!0:e.isReply,this.targetEl=this.options.targetEl,this.typeUrl=this.options.type,this.typeId=this.options.typeId,this.collection=new i({typeUrl:this.typeUrl,typeId:this.typeId}),this.collection.fetch({async:!1}),this.commentFormView=null,this.useCreateForm=e.useCreateForm==undefined?!0:e.useCreateForm,this.boardModel=e.boardModel,this.useCreateForm==0&&(this.isReply=!1),n.EventEmitter.off("m_comment"),n.EventEmitter.on("m_comment","change:comment",_.bind(function(){this.collection.fetch({success:_.bind(function(e){this.render(),n.EventEmitter.trigger("common","change:comment",e.length)},this)})},this))},render:function(){var e=this;return this.commentFormView=new o({typeUrl:this.typeUrl,typeId:this.typeId,boardModel:this.boardModel}),this.$el.html(this.commentFormView.el),this.commentFormView.render(),this.collection.each(function(t,n){e.addComment(t)}),this.useCreateForm||this.$el.find("li.creat").remove(),this.targetEl.append(this.$el),this.commentFormView.attachFileUploader(),this.headerToolbarView.render({isClose:!0,title:r["\ub313\uae00"]}),this},makeCommentItem:function(e){return new s({typeUrl:this.typeUrl,typeId:this.typeId,model:e,isReply:this.isReply,anonymFlag:this.boardModel?this.boardModel.get("anonymFlag"):!1})},addComment:function(e,t){var n=this.makeCommentItem(e);t==undefined?this.$el.find("li.creat").before(n.render().$el):(t.off(),t.replaceWith(n.render().$el)),this.$el.trigger("addComment",[this])},addReply:function(t){var n=e(t.currentTarget),r=n.parents("li"),i=r.attr("comment-id"),s=this.$el.find("li[comment-thread-id='"+i+"']:last"),o=u.create({typeUrl:this.typeUrl,typeId:this.typeId,commentId:i,boardModel:this.boardModel});s.next().hasClass("reply")||s.after(o.render().$el),o.attachFileUploader()},getCommentCount:function(){return this.collection.length},_expandTextarea:function(e){n.util.textAreaExpand(e)}},{__instance__:null,create:function(t){var n=new c({targetEl:e(t.el),type:t.type,typeId:t.typeId,isReply:t.isReply,useCreateForm:t.useCreateForm,boardModel:t.boardModel});return n.render(),__instance__=n,n}});return c})}).call(this);