(function(){define(["jquery","backbone","app","components/favorite/collections/favorite","hgn!components/favorite/templates/favorite","hgn!components/favorite/templates/favorite_modify_item","hgn!components/favorite/templates/favorite_list_item","i18n!nls/commons","amplify","jquery.ui"],function(e,t,n,r,i,s,o,u,a){var f=null,l={favorite:u["\uad00\uc2ec"],favorite_title:u["\uc990\uaca8\ucc3e\uae30"],favorite_edit:u["\ud3b8\uc9d1"],favorite_edit_title:u["\uc990\uaca8\ucc3e\uae30 \ud3b8\uc9d1"],save:u["\uc218\uc815\uc644\ub8cc"],collapse:u["\uc811\uae30"],outspread:u["\ud3bc\uce58\uae30"],cancel:u["\ucde8\uc18c"]},c="",h=t.View.extend({className:"lnb",events:{"click span.ic_list_reorder":"edit","click span.ic_cancel":"reorderCancel","click span.ic_done":"save","mouseover ul>li ":"dragOver","mouseout ul>li":"dragOut","click h1.star>a.txt, h1.star span.toggle_btn":"favoriteToggle"},initialize:function(e){this.options=e||{},this.title=this.options.title||l.favorite_title,this.el=this.options.el,this.link=this.options.link,this.overrideDataSet=this.options.overrideDataSet,this.url=this.options.url,this.liClass=this.options.liClass,this.collection=r.get({url:this.url}),c=n.session("loginId")+"-"+this.options.type+"-favorite-toggle"},render:function(e){var t=this;this.$el.html(i({title:this.title,lang:l,category_is_open:this.getStoredCategoryIsOpen()}));if(this.collection.length>0){var n=this.$el.find("ul"),r=[];this.collection.each(function(r,i){var s=new p({model:r,link:t.link,overrideDataSet:t.overrideDataSet,liClass:t.liClass});n.append(s.render(e).$el)}),this.$el.show()}else this.$el.hide();return this},favoriteToggle:function(t){var n=e(t.currentTarget).parents("h1"),r=n.find("span.toggle_btn"),i=this.$el.find("ul");n.hasClass("folded")?(n.removeClass("folded"),r.attr("title",u["\uc811\uae30"]),i.slideDown(200)):(n.addClass("folded"),r.attr("title",u["\ud3bc\uce58\uae30"]),i.slideUp(200)),this.storeCategoryIsOpen(!n.hasClass("folded"))},getStoredCategoryIsOpen:function(){var e="";return window.sessionStorage?e=a.store.sessionStorage(c):e=a.store(c),e==undefined&&(e=!0),e},storeCategoryIsOpen:function(e){return a.store(c,e,{type:window.sessionStorage?"sessionStorage":null})},reload:function(){this.collection.fetch({async:!1}),this.render(!1)},dragOver:function(t){e(t.currentTarget).addClass("move")},dragOut:function(t){e(t.currentTarget).removeClass("move")},edit:function(){console.info("edit !!");var e=this;this.render(!0),this.$el.find("h1 span.btn_wrap").toggle(),this.$el.addClass("lnb_edit").sortable({items:"li",opacity:"1",delay:100,cursor:"move",hoverClass:"move",containment:"#side_favorite",forceHelperSize:"true",helper:"clone",placeholder:"ui-sortable-placeholder"}).sortable("enable")},reorderCancel:function(){this.$el.removeClass("lnb_edit").sortable("disable"),this.render()},save:function(){var t=[],n=[],r=this;this.$el.find("li").each(function(){var t=e(this).attr("data-id"),i=r.collection.get(t);n.push(i)}),e.go(this.url,JSON.stringify(n),{contentType:"application/json",qryType:"put",async:!1,responseFn:function(){r.$el.removeClass("lnb_edit"),r.$el.find("h1 span.btn_wrap").toggle(),r.$el.trigger("changeFavorite",[n]),r.reload(!1)},error:function(t){var n=JSON.parse(t.responseText);n.message!=null?e.goMessage(n.message):e.goMessage(u["\uc2e4\ud328\ud588\uc2b5\ub2c8\ub2e4."])}})}},{create:function(e){var t=new h(e);return t.render()}}),p=t.View.extend({tagName:"li",events:{"click span.ic_list_del":"remove","click a":"movePage"},initialize:function(e){this.options=e||{},this.model=this.options.model,this.renderFn=this.options.renderFn,this.link=this.options.link,this.overrideDataSet=this.options.overrideDataSet,this.liClass=this._getLiClass(),this.$el.addClass(this.liClass)},_getLiClass:function(){return typeof this.options.liClass=="function"?this.options.liClass.call(this,this.model):this.options.liClass||"report"},render:function(e){var t=e?s:o,n={};return this.overrideDataSet?n=this.overrideDataSet(this.model):n=this.model.toJSON(),this.$el.html(t({data:n,lang:l,renderFn:this.renderFn})),this.$el.attr("data-id",this.model.get("id")),this.$el.attr("data-item","favorite"+this.model.get("id")),this},remove:function(e){this.$el.remove()},movePage:function(){var e=this.link(this.model);sessionStorage.setItem("sideItem","favorite"+this.model.id);var t=function(){n.router.navigate(e,{trigger:!0})};n.util.editorConfirm(t)}});return h})}).call(this);