(function(){define(["backbone","app","components/emailSend/views/send_mail_layer","i18n!nls/commons"],function(e,t,n,r){var i={alert_length:r["0\uc790\uc774\uc0c1 0\uc774\ud558 \uc785\ub825\ud574\uc57c\ud569\ub2c8\ub2e4."],alert_input_email:r["\uc774\uba54\uc77c \uc8fc\uc18c\ub97c \uc785\ub825\ud558\uc138\uc694."],alert_invalid_email:r["\uc798\ubabb\ub41c \uc774\uba54\uc77c \uc8fc\uc18c\uc785\ub2c8\ub2e4."],send_email_title:r["\uba54\uc77c \ubcf4\ub0b4\uae30"],send:r["\ubcf4\ub0b4\uae30"],cancel:r["\ucde8\uc18c"],success:r["\uba54\uc77c\uc744 \ubc1c\uc1a1\ud588\uc2b5\ub2c8\ub2e4."],fail:r["\uc2e4\ud328\ud588\uc2b5\ub2c8\ub2e4."],alert_subject:r["\uc81c\ubaa9\uc744 \uc785\ub825\ud558\uc138\uc694."]},s=e.View.extend({initialize:function(e){this.options=e||{},this.confirmButtonClicked=!1},getMail:function(){var e=[];return $("#toAddrWrap li span.name").each(function(){e.push(GO.util.get_email($(this).data("email")))}),e},sendMail:function(e){var n=this,r={},s=[],o=$("div.go_popup #subject").val(),u=$("#mail_content").val()==undefined?$("#memo").val():$("#mail_content").val();u=GO.util.escapeHtml(u),s=this.getMail();var a,f=this.options.url,l=this.options.targetId;if(s.length<1){$("#addrErrorWrap").text(i.alert_input_email).show(),setTimeout(function(){$("#addrErrorWrap").hide()},3e3);return}if(!this.checkEmailInvalidAddress(s)){$("#addrErrorWrap").text(i.alert_invalid_email).show(),setTimeout(function(){$("#addrErrorWrap").hide()},3e3);return}if($.trim(o)==""){$("#subjectErrorWrap").text(i.alert_subject).show(),setTimeout(function(){$("#subjectErrorWrap").hide()},3e3);return}if($.trim(u)!=""&&!$.goValidation.isCheckLength(-1,1e3,u)){$("#memoErrorWrap").text(t.i18n(i.alert_length,{arg1:"0",arg2:"1000"})).show(),setTimeout(function(){$("#memoErrorWrap").hide()},3e3);return}r={receivers:s,memo:u,subject:o,id:l};if(this.confirmButtonClicked){console.log("prevented dbl click.");return}this.confirmButtonClicked=!0,console.log("ajax starting.."),$.ajax({type:"POST",async:!0,data:JSON.stringify(r),dataType:"json",contentType:"application/json",url:GO.config("contextRoot")+"api/"+f}).done(function(t){$.goSlideMessage(i.success),e.close()}).fail(function(e){$.goSlideMessage(i.fail,"caution")}).complete(function(){console.log("ajax ended."),n.confirmButtonClicked=!1})},checkEmailInvalidAddress:function(e){for(var t=0;t<e.length;t++){var n=e[t];n=$.trim(n);if(n==""||GO.util.checkEmailFormat(n))continue;return!1}return!0},render:function(){var e=this,t=null,r={content:this.options.content,attachInfos:this.options.attachInfos,targetApp:this.options.targetApp};return t=$.goPopup({width:"600px",pclass:"layer_normal send_mail",header:i.send_email_title,contents:"",modal:!1,forceClosePopup:!1,closeCallback:function(){$(".layer_auto_complete").hide()},buttons:[{btype:"confirm",btext:i.send,autoclose:!1,callback:function(t){e.confirmButtonClicked||e.sendMail(t)}},{btype:"normal",btext:i.cancel,autoclose:!1,callback:function(e){$(".layer_auto_complete").hide(),e.close()}}]}),n.create(r),t.reoffset(),this}});return{render:function(e){return(new s(e)).render()}}})}).call(this);