define("components/history_menu/main",["backbone","when","app","components/history_menu/views/historiable_menu","hgn!components/history_menu/templates/main","i18n!nls/commons"],function(e,t,n,r,i,s){function f(e){this.offset=e.offset(),this.width=e.width(),this.height=e.height(),this.outerWidth=e.outerWidth(),this.outerHeight=e.outerHeight()}function l(){setTimeout(_.bind(function(){var e=this;$(document).on("go.todo.clearmenu",function(t){var n=$(t.relatedTarget),r=p.call(e);if(n.closest(e.$el).length>0)return;if(r.connectWith&&n.closest(r.connectWith).length>0)return;e.$el.is(":visible")&&e.close()})},this),300)}function c(e){var t=this,n=$('<div class="ui-backdrop"></div>');return n.css({position:"absolute",left:0,top:0,width:$(window).width(),height:$(window).height(),"z-index":t.zIndex-1,"overflow-y":"auto"}).append(e).appendTo("body").show(),n}function h(){_.each(this.__historyQueue__,function(e){g.call(this)},this)}function p(){return _.last(this.__historyQueue__)}function d(e){var t=this.$el.find(a.container);v.call(this),this.setTitle(e.title),t.append(e.el),e.activate(),e.__menuClasses__&&this.addClass(e.__menuClasses__),this.__historyQueue__.length>1?this.$el.find(a.back_btn).show():this.$el.find(a.back_btn).hide(),y.call(this)}function v(){this.$el.removeClass(function(){return $(this).attr("class")}).addClass(this.className)}function m(){var e=p.call(this);return e&&(e.deactivate(),e.remove()),e}function g(){if(m.call(this)){var e=this.__historyQueue__.pop();delete e}}function y(){n.util.isMobile()?w.call(this):b.call(this)}function b(){var e=this.dimensionHelper.offset.left,t=this.dimensionHelper.offset.top,r=e+this.$el.outerWidth(),i=t+this.$el.outerHeight()+this.dimensionHelper.outerHeight,s=$(window).width(),o=$(window).height(),u={},a=n.session("theme")==="THEME_ADVANCED";if(r>s)u.left=s-this.$el.outerWidth();else{var f=0;a&&(f=$("header.go_header_advanced").width()),u.left=e-f}if(o>this.$el.outerHeight()&&i>o)u.top=o-this.$el.outerHeight()-10;else{var f=-12;a&&(f=31),u.top=t+f}this.$el.css(u)}function w(){var e=0,t=0,n=0;e=this.$el.outerWidth(),t=($(window).width()-e)/2,this.$el.css({left:t,top:n})}var o,u,a={title:"header > h1",container:".ui-menu-container",content:".ui-menu-content",back_btn:".btn-history-back"};return o=e.View.extend({className:"history-menu layer_transition",attributes:{"data-target":"historymenu"},__historyQueue__:[],template:i,connectWith:null,dimensionHelper:null,$caller:null,events:{"click .btn-history-back":"back","click .btn-close":"close"},initialize:function(e){var t=e||{};this.zIndex=e.zIndex||100,this.__historyQueue__=[],this.$el.css({"z-index":this.zIndex}),this.$el.attr("data-cid",this.cid),this.$el.data("go.historymenu",this),this.$caller=t.$caller||$(document),this.dimensionHelper=new f(this.$caller),n.EventEmitter.on("todo","close:cardColumnMenu",this.close,this)},render:function(){var e=this.cid,t=this;this.$el.append(this.template({back:s["\uc774\uc804"],close:s["\ub2eb\uae30"]})),n.util.isMobile()?c(this.$el):l.call(this)},remove:function(){e.View.prototype.remove.apply(this,arguments),$(document).off("go.todo.clearmenu")},add:function(e){this.__historyQueue__.push(e),e.__historyMenu__=this},forward:function(e){m.call(this),this.add(e),d.call(this,e)},back:function(){this.__historyQueue__.length>1?(g.call(this),d.call(this,p.call(this))):this.close()},close:function(){h.call(this),$(".ui-backdrop").remove(),$(document).off(".go.todo.backdrop"),this.remove()},setTitle:function(e){return this.$el.find(a.title).empty().html(e),this},getContainerEl:function(){return this.$el.find(a.container)},getTitleEl:function(){return this.$el.find(a.title)},addClass:function(e){this.$el.addClass(e)}}),{HistoryMenuView:o,HistoriableMenuView:r,SELECTORS:a,create:function(e){var t=new o;return t.render(),t.forward(e),t},attachTo:function(e,t){var r,i=n.util.isMobile()?"body":".go_body";return $(document).trigger("go.todo.clearmenu"),r=new o({$caller:e}),$(i).append(r.el),r.render(),r.forward(t),r}}});