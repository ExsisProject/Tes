define(function(){var e=require("backbone"),t=require("moment"),n="YYYY-MM-DDTHH:mm:ss.SSSZ",r="YYYY-MM-DD (dd)",i={week:{label:"MM-DD (dd)",key:n},day:{label:"HH",key:n}};return e.Model.extend({initialize:function(){this.initMatrix()},defaults:{itemHeight:23,columns:[],headerColSpan:1},initMatrix:function(e){this.initTimes(e),this.initColumns(),this._initHeaderColSpan()},pixelToRatio:function(e){return e/this.get("bodyWidth")*100},ratioToPixel:function(e){return e/100*this.get("bodyWidth")},dateToRatio:function(e){e=e||new Date;var n=t(this.get("startTime")),r=t(this.get("endTime"));return(t(e)-n)/(r-n)*100},dateToPixel:function(e){var t=this.dateToRatio(e);return this.ratioToPixel(t)},setInterval:function(e){this.set("navigationInterval",e)},getColumnLength:function(){return this.get("columns").length},getHeaderColumns:function(){var e=this.get("columns");return this.get("type")=="day"&&(e=_.filter(e,function(e,t){return t%2==0})),e},getDateRange:function(){var e=t(this.get("startTime")),n=t(this.get("endTime")),i=n.diff(e,"day");return i<=1?e.format(r):e.format(r)+" ~ "+n.format(r)},initTimes:function(e){if(e||!this.get("startTime")&&!this.get("endTime")){var r=t(new Date).startOf(this.get("navigationInterval")).format(n),i=t(new Date).endOf(this.get("navigationInterval")).add(1,"milliseconds").format(n);this.set("startTime",r),this.set("endTime",i)}},initColumns:function(){var e=[],n=parseInt(this.get("gridValue")),r=t(this.get("startTime")),s=t(this.get("endTime")).diff(this.get("startTime"),this.get("gridUnit"))/n;for(var o=0;o<s;o++){var u={label:r.format(i[this.get("type")].label),key:r.format(i[this.get("type")].key)};this.get("gridUnit")=="days"&&(u.isSunday=r.day()==0),this.get("gridUnit")=="days"&&(u.isToday=r.isSame(new Date,"day")),e.push(u),r.add(n,this.get("gridUnit"))}this.set("columns",e)},isDayType:function(){return this.get("type")==="day"},_initHeaderColSpan:function(){this.get("type")=="day"&&this.set("headerColSpan",2)}})});