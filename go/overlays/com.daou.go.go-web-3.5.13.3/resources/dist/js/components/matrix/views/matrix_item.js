define(function(require){var e=require("matrix/constants/matrix_event"),t=require("backbone"),n=require("moment"),r=require("hgn!matrix/templates/matrix_item");return t.View.extend({className:"schedule_time",attributes:{"data-matrix-item":"",style:"position: absolute;"},initialize:function(e){this.matrix=e.matrix,this.$el.attr("data-matrix-item",this.model.id),this.$el.data("model",this.model)},render:function(){var e=this.matrix.get("contentRenderer").call(this),t=_.isObject(e)?e.content:e,n=_.isObject(e)?e.title:e,i=_.isObject(e)?!!e.otherCompanyReservation:!1;return this.$el.html(r({content:t,title:n,otherCompanyReservation:i})),this._setPosition(),this.matrix.get("draggable")&&this._initDraggable(),this.matrix.get("resizable")&&this._initResizable(),this},isValid:function(){return this.model.isValid()},revert:function(){this.model.set({startTime:this.model.previous("startTime"),endTime:this.model.previous("endTime")}),this.render()},setEndDateByGrid:function(e){this.model.set("endTime",e),this.model.setEndDateByGrid(1)},_setPosition:function(){this.$el.css(this.model.dateToPosition())},_initDraggable:function(){this.$el.draggable({containment:"parent",grid:this.matrix.get("useGrid")?[this.matrix.get("columnWidth")]:!1,snap:this.matrix.get("useGrid")?!1:".schedule_time",stop:$.proxy(function(t,r){if(this.matrix.get("useGrid")){var i=(r.position.left-r.originalPosition.left)/this.matrix.get("columnWidth");this.model.setDateByGrid(i)}else{var s=this.matrix.pixelToRatio(r.position.left),o=this.model.ratioToDate(s),u=n(this.model.get("endTime")).diff(this.model.get("startTime"));r.helper.css("left",s+"%"),this.model.set({startTime:o,endTime:n(o).add(u).format("YYYY-MM-DDTHH:mm:ss.SSSZ")})}console.log(this.model.toJSON()),this.$el.trigger(e.ITEM_CHANGE,{item:this})},this)})},_initResizable:function(){this.$el.resizable({handles:"e",grid:this.matrix.get("useGrid")?[this.matrix.get("columnWidth")]:!1,stop:$.proxy(function(t,n){if(this.matrix.get("useGrid")){var r=(n.size.width-n.originalSize.width)/this.matrix.get("columnWidth");this.model.setEndDateByGrid(r)}else{var i=this.matrix.pixelToRatio(n.size.width),s=this.matrix.pixelToRatio(n.position.left);n.helper.css({width:i+"%",left:s+"%"}),this.model.set({endTime:this.model.ratioToDate(s+i)})}console.log(this.model.toJSON()),this.$el.trigger(e.ITEM_CHANGE,{ui:n,item:this})},this)})}})});