(function(){define(["underscore","backbone","app","i18n!nls/commons","i18n!admin/nls/admin"],function(e,t,n,r,i){function u(){var e=[];return e.push('<div class="wrap">'),e.push('<span class="wrap_select">'),e.push(a()),e.push("</span>"),e.push('<span class="wrap_select">'),e.push('<select name="class_code"></select>'),e.push("</span>"),e.push('<span class="wrap_btn">'),e.push('<span class="btn_fn9 btn-regist">'+s.label.add+"</span>"),e.push('<span class="btn_fn9 btn-remove-all">'+s.label.remove_all+"</span>"),e.push("</span>"),e.push("</div>"),e.push('<ul class="list_option"></ul>'),e.join("\n")}function a(){var t=[];return t.push('<select name="class_type">'),e.each(s.classtype,function(e,r){(n.session("useOrg")||r!="duty")&&t.push('<option value="'+r+'">'+e+"</option>")}),t.push("</select>"),t.join("\n")}function f(t,n){var i=[];i.push('<option value="">** '+r["\uc120\ud0dd"]+" **</option>"),e.each(n,function(e,t){i.push('<option value="'+e.id+'" data-code="'+e.code+'">'+e.name+"</option>")}),t.empty().append(i.join("\n"))}function l(e,t){var n=[],r=s.classtype[e];return n.push('<li data-id="'+t.id+'" data-type="'+t.type+'" data-name="'+t.name+'" data-code="'+t.code+'">'),n.push('<span class="major">['+r+" : "+t.name+"]</span>"),n.push('<span class="wrap_btn btn-target-class-remove"><span class="ic_side ic_basket_bx" title="'+s.label.remove+'" data-btntype="postdelete"></span></span>'),n.push("</li>"),n.join("\n")}function c(e,t){return t=t||!1,[n.config("contextRoot"),t?"ad/":"","api","/"+e,"/list"].join("")}var s={label:{modify:r["\uc218\uc815"],remove:r["\uc0ad\uc81c"],add:r["\ucd94\uac00"],remove_all:r["\ubaa8\ub450\uc0ad\uc81c"]},classtype:{position:i["\uc9c1\uc704"],grade:i["\uc9c1\uae09"],duty:i["\uc9c1\ucc45"],usergroup:i["\uc0ac\uc6a9\uc790\uadf8\ub8f9"]}},o=t.View.extend({tagName:"div",className:"classcode-picker option_display",events:{"change select[name=class_type]":"loadClassCode","click .btn-regist":"_addClassCode","click .btn-remove-all":"removeAllCode","click .btn-target-class-remove":"_removeSelectedCode"},initialize:function(e){this.options=e||{},this.$el.data("cache",{})},render:function(){this.$el.empty().append(u()),this.loadClassCode()},loadClassCode:function(){var e=this.$el.find("select[name=class_type]").val(),t=this.$el.find("select[name=class_code]");if(this.isCachedData(e))f(t,this.getCacheData(e));else{var n=this;$.ajax(c(e,this.options.isAdmin||!1)).done(function(r){n.setCacheData(e,r.data),f(t,r.data)})}},addClassCode:function(e,t,n,r){this.$el.find("ul.list_option li[data-id="+e+"]").length<1&&this.$el.find("ul.list_option").append(l(t,{id:e,type:t,name:n,code:r||""}))},removeAllCode:function(){this.$el.find("ul.list_option li").remove()},isCachedData:function(e){return typeof this.getCacheData(e)!="undefined"},getCacheData:function(e){return typeof e=="undefined"?this.$el.data("cache"):this.$el.data("cache")[e]},setCacheData:function(e,t){var n=this.getCacheData()||{};n[e]=t,this.$el.data("cache",n)},_addClassCode:function(e){var t=this.$el.find("select[name=class_type] option:selected"),n=this.$el.find("select[name=class_code] option:selected"),r=n.val();!r||this.addClassCode(r,t.val(),n.text(),n.data("code"))},_removeSelectedCode:function(e){$(e.target).closest("li").remove()}});return o})})();