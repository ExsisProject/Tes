(function(e){e.goAliasNodeList=function(e){if(arguments[0]==="close")return this.close();var n=new t;return n.initialize(e),n};var t=function(){var t=!1;return{treeEl:null,defaults:{keyword:null,type:"user",circle:null,selectQuery:"#memberList",callback:null,parentNodeId:null,parentNodeIds:[],parentNodeType:"department",isAdmin:!1,contextRoot:"/",isDndActive:!1,dndDropTarget:null,dropCheck:null,dropFinish:null,dropTo:null,i18n:{},page:0,css:{minHeight:375,maxHeight:400,"overflow-y":"auto"}},initialize:function(t){return this.options=e.extend({},this.defaults),this.options.keyword=t.keyword,t.selectQuery&&(this.options.selectQuery=t.selectQuery),t.type&&(this.options.type=t.type),t.callback&&(this.options.callback=t.callback),t.parentNodeId&&(this.options.parentNodeId=t.parentNodeId),t.parentNodeType&&(this.options.parentNodeType=t.parentNodeType),t.parentNodeIds&&(this.options.parentNodeIds=t.parentNodeIds),t.isAdmin&&(this.options.isAdmin=t.isAdmin),t.contextRoot&&(this.options.contextRoot=t.contextRoot),t.isDndActive&&(this.options.isDndActive=t.isDndActive),t.dndDropTarget&&(this.options.dndDropTarget=t.dndDropTarget),t.dropCheck&&(this.options.dropCheck=t.dropCheck),t.dropFinish&&(this.options.dropFinish=t.dropFinish),t.dropOut&&(this.options.dropOut=t.dropOut),t.dropTo&&(this.options.dropTo=t.dropTo),t.page&&(this.options.page=t.page),t.css&&(this.options.css=t.css),t.circle&&(this.options.circle=t.circle),t.i18n&&(this.options.i18n=t.i18n),t.aliasId&&(this.options.aliasId=t.aliasId),this.$el=e(this.options.selectQuery),this.options.isAdmin&&(this.options.contextRoot=this.options.contextRoot+"ad/"),this.render(),this},render:function(){var n="",r={keyword:this.options.keyword,page:this.options.page,offset:30,id:this.options.aliasId},i=this;n=this.options.contextRoot+"api/mail/alias",this._renderContainer(),this.deferred=e.Deferred();var s=function(e){e.data&&e.data.length?this._renderMemberList(e.data):e.page.page==0&&this._renderEmptyList(),this.$el.off(),this._bindMemberEvent(),this._bindDeptEvent(),this._bindDNDEvent(),this._bindScrollEvent(),this.data=e.data,this.deferred.resolve(this)};setTimeout(function(){t||(t=!0,i.ajaxCalling=e.ajax({url:n,type:"GET",contentType:"application/json",data:r,success:e.proxy(s,i)}).always(function(){t=!1}))},200)},abortAjaxCall:function(){this.ajaxCalling&&this.ajaxCalling.abort()},getSelectedData:function(){var t=e("a.jstree-clicked",this.$el);return t&&t.length>0?this._processSearchData(t.parent()):{}},addClassToDNDTarget:function(){this._bindDNDEvent()},_renderContainer:function(){if(this.options.page==0){var e=Hogan.compile(['<div class="jstree jstree-default" id="searchDepartmentEl" style="border-bottom:1px dashed #c8c8c8;margin:5px;display:none">','    <ul class="department_list"></ul>',"</div>",'<ul class="member_list"></ul>'].join(""));this.$el.empty().html(e.render()).css(this.options.css)}},_renderMemberList:function(t){var n=[],r=Hogan.compile(['<li data-email="{{email}}">',"   <a data-bypass>",'       <ins class="worker"></ins>','       <span class="name" title="{{name}}">{{name}}</span>',"   </a>","</li>"].join(""));e.each(t,function(e,t){t.nodeType!="department"&&n.push(r.render({name:t.name,email:t.email}))}),this.$el.find("p.data_null").remove(),this.$el.find("ul.member_list").append(n.join("")).find("span.name").css("max-width","125px")},_renderEmptyList:function(){var e=Hogan.compile('<p class="data_null"><span class="ic_data_type ic_no_part"></span>{{msg_no_search_result}}</p>');this.$el.find("#searchDepartmentEl").hide(),this.$el.find("ul.member_list").empty().html(e.render({msg_no_search_result:this.options.i18n["\uac80\uc0c9\uacb0\uacfc\uac00 \uc5c6\uc2b5\ub2c8\ub2e4."]}))},_bindMemberEvent:function(){var t=function(t){var n=e(t.currentTarget);this.$el.find("ul").find("li>a").removeClass("jstree-clicked"),n.find("a").addClass("jstree-clicked"),_.isFunction(this.options.callback)&&this.options.callback(this._processSearchData(n),t)};this.$el.on("click contextmenu","ul.member_list > li",e.proxy(t,this))},_bindDeptEvent:function(){var t=function(t){var n=e(t.currentTarget);return this.$el.find("ul").find("li>a").removeClass("jstree-clicked"),n.children("a").addClass("jstree-clicked"),_.isFunction(this.options.callback)&&this.options.callback(this._processSearchData(n),t),!1};this.$el.on("click contextmenu","ul.department_list > li > ul > li",e.proxy(t,this))},_bindDNDEvent:function(){if(this.options.isDndActive){var t=this,n=["ul.member_list > li > a","ul.department_list > li > a"].join(", "),r={appendTo:t.options.dropTo,helper:"clone",revert:"invalid"},i={accept:n,over:function(n,r){var i=t._processSearchData(e(r.draggable).parent());t.options.dropCheck(e(n.target),i)},out:function(n,r){var i=t._processSearchData(e(r.draggable).parent());t.options.dropOut(e(n.target),i)},drop:function(n,r){var i=t._processSearchData(e(r.draggable).parent());t.options.dropFinish(e(n.target),i)}};e(n).draggable(r),e(this.options.dndDropTarget).droppable(i)}},_bindScrollEvent:function(){this.$el.on("scroll","",e.proxy(function(t){var n=e(t.currentTarget);n[0].scrollHeight-n.scrollTop()-n.height()<15&&(this.options.page++,this.render())},this))},_processSearchData:function(e){var t=e.attr("data-dept-ids"),n=e.attr("rel")=="org",r={};r={id:e.data("id"),email:e.data("email"),type:n?"org":"MEMBER"};if(n)r.name=e.find("a:first").text();else{r.name=e.find("a span.name").text(),t!=null&&(r.deptId=t.indexOf(",")>0?t.substring(0,t.indexOf(",")):t);var i="";e.hasClass("jstree-leaf")?i=e.parents("li").find("a:first").text():i=e.find("a span.part").attr("title"),r.deptName=i,r.position=e.find("a span.position").text()||"",r.displayName=r.name+" "+r.position}return r},getData:function(){return this.data}}}})(jQuery);