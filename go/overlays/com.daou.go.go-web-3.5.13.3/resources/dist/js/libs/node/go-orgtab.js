(function(e){var t=Array.prototype.slice,n=e.goOrgTab=function(){if(arguments[0]==="close")return n.close();var e=t.call(arguments);return n.initialize.apply(n,e)};e.fn.imitateKeyEvent=function(){return this.each(function(){var e=function(e){this._o=e,this._value=e.value,this._bindEvents()};e.prototype._bindEvents=function(){var e=this,t=function(e,t,n){e.attachEvent?e.attachEvent("on"+t,n):e.addEventListener(t,n,!1)};t(this._o,"focus",function(){e._timer&&clearInterval(e._timer),e._timer=setInterval(function(){e._value!=e._o.value&&(e._value=e._o.value,e._fireEvent())},50)}),t(this._o,"blur",function(){e._timer&&clearInterval(e._timer),e._timer=null})},e.prototype._fireEvent=function(){if(document.createEvent){var e;window.KeyEvent?(e=document.createEvent("KeyEvents"),e.initKeyEvent("keyup",!0,!0,window,!1,!1,!1,!1,65,0)):(e=document.createEvent("UIEvents"),e.initUIEvent("keyup",!0,!0,window,1),e.keyCode=65),this._o.dispatchEvent(e)}else{var e=document.createEventObject();e.keyCode=65,this._o.fireEvent("onkeyup",e)}},new e(this)})},e.extend(n,{lang:{ko:{"\ub2eb\uae30":"\ub2eb\uae30","\uc120\ud0dd":"\uc120\ud0dd","\uc774\ub984, \uc544\uc774\ub514":"\uc774\ub984, \uc544\uc774\ub514","\uc774\ub984, \uc774\uba54\uc77c":"\uc774\ub984, \uc774\uba54\uc77c","\uc774\ub984, \ubd80\uc11c\uba85, \uc544\uc774\ub514":"\uc774\ub984, \ubd80\uc11c\uba85, \uc544\uc774\ub514","\uac80\uc0c9":"\uac80\uc0c9","\ub354\ubcf4\uae30":"\ub354\ubcf4\uae30","\uc870\uc9c1\uc21c":"\uc870\uc9c1\uc21c","\uac00\ub098\ub2e4\uc21c":"\uac00\ub098\ub2e4\uc21c","\uba64\ubc84\uac00 \uc5c6\uc2b5\ub2c8\ub2e4.":"\uba64\ubc84\uac00 \uc5c6\uc2b5\ub2c8\ub2e4.","\uac80\uc0c9\uacb0\uacfc\uac00 \uc5c6\uc2b5\ub2c8\ub2e4.":"\uac80\uc0c9\uacb0\uacfc\uac00 \uc5c6\uc2b5\ub2c8\ub2e4.","\uacb0\uacfc\uac12\uc774 \ub9ce\uc2b5\ub2c8\ub2e4. \uac80\uc0c9\uc744 \uc774\uc6a9\ud574 \uc8fc\uc138\uc694.":"\uacb0\uacfc\uac12\uc774 \ub9ce\uc2b5\ub2c8\ub2e4. \uac80\uc0c9\uc744 \uc774\uc6a9\ud574 \uc8fc\uc138\uc694.","\uc774\ub984":"\uc774\ub984","\ubd80\uc11c":"\ubd80\uc11c","\uc544\uc774\ub514":"\uc544\uc774\ub514","\uc804\ud654\ubc88\ud638":"\uc804\ud654","\uc9c1\uc704":"\uc9c1\uc704","\uc9c1\ucc45":"\uc9c1\ucc45"},ja:{"\ub2eb\uae30":"\u9589\u3058\u308b","\uc120\ud0dd":"\u9078\u629e","\uc774\ub984, \uc544\uc774\ub514":"\u540d\u524d\u3001ID","\uc774\ub984, \uc774\uba54\uc77c":"\u540d\u524d\u3001\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9","\uc774\ub984, \ubd80\uc11c\uba85, \uc544\uc774\ub514":"\u540d\u524d\u3001\u90e8\u7f72\u540d\u3001ID","\uac80\uc0c9":"\u691c\u7d22","\ub354\ubcf4\uae30":"\u3082\u3063\u3068\u898b\u308b","\uc870\uc9c1\uc21c":"\u7d44\u7e54\u9806","\uac00\ub098\ub2e4\uc21c":"abc\u9806","\uba64\ubc84\uac00 \uc5c6\uc2b5\ub2c8\ub2e4.":"\u30e1\u30f3\u30d0\u30fc\u304c\u3042\u308a\u307e\u305b\u3093\u3002","\uac80\uc0c9\uacb0\uacfc\uac00 \uc5c6\uc2b5\ub2c8\ub2e4.":"\u691c\u7d22\u7d50\u679c\u304c\u3042\u308a\u307e\u305b\u3093\u3002","\uacb0\uacfc\uac12\uc774 \ub9ce\uc2b5\ub2c8\ub2e4. \uac80\uc0c9\uc744 \uc774\uc6a9\ud574 \uc8fc\uc138\uc694.":"\u7d50\u679c\u5024\u304c\u591a\u3044\u3067\u3059\u3002\u691c\u7d22\u3092\u5229\u7528\u3057\u3066\u304f\u3060\u3055\u3044\u3002","\uc774\ub984":"\u540d\u524d","\ubd80\uc11c":"\u90e8\u7f72","\uc544\uc774\ub514":"ID","\uc804\ud654\ubc88\ud638":"\u96fb\u8a71","\uc9c1\uc704":"\u8077\u4f4d","\uc9c1\ucc45":"\u5f79\u8077"},en:{"\ub2eb\uae30":"Close","\uc120\ud0dd":"Select","\uc774\ub984, \uc544\uc774\ub514":"Name, ID","\uc774\ub984, \uc774\uba54\uc77c":"Name, Email","\uc774\ub984, \ubd80\uc11c\uba85, \uc544\uc774\ub514":"Name, Department, ID","\uac80\uc0c9":"Search","\ub354\ubcf4\uae30":"View More","\uc870\uc9c1\uc21c":"By Organization","\uac00\ub098\ub2e4\uc21c":"By Alphabet","\uba64\ubc84\uac00 \uc5c6\uc2b5\ub2c8\ub2e4.":"No Member","\uac80\uc0c9\uacb0\uacfc\uac00 \uc5c6\uc2b5\ub2c8\ub2e4.":"No Result","\uacb0\uacfc\uac12\uc774 \ub9ce\uc2b5\ub2c8\ub2e4. \uac80\uc0c9\uc744 \uc774\uc6a9\ud574 \uc8fc\uc138\uc694.":"There are too many results. Please use the search function.","\uc774\ub984":"Name","\ubd80\uc11c":"Department","\uc544\uc774\ub514":"ID","\uc804\ud654\ubc88\ud638":"Phone","\uc9c1\uc704":"Position","\uc9c1\ucc45":"Title"},zh_CN:{"\ub2eb\uae30":"\u5173\u95ed","\uc120\ud0dd":"\u9009\u62e9","\uc774\ub984, \uc544\uc774\ub514":"\u540d\u5b57\uff0cID","\uc774\ub984, \uc774\uba54\uc77c":"\u540d\u5b57\uff0c\u7535\u5b50\u90ae\u4ef6","\uc774\ub984, \ubd80\uc11c\uba85, \uc544\uc774\ub514":"\u540d\u5b57\uff0c\u90e8\u95e8\u540d\u79f0\uff0cID","\uac80\uc0c9":"\u641c\u7d22","\ub354\ubcf4\uae30":"\u67e5\u770b\u66f4\u591a","\uc870\uc9c1\uc21c":"\u7ec4\u7ec7\u987a\u5e8f","\uac00\ub098\ub2e4\uc21c":"abc\u987a\u5e8f","\uba64\ubc84\uac00 \uc5c6\uc2b5\ub2c8\ub2e4.":"\u6ca1\u6709\u4f1a\u5458","\uac80\uc0c9\uacb0\uacfc\uac00 \uc5c6\uc2b5\ub2c8\ub2e4.":"\u6ca1\u6709\u641c\u7d22\u7ed3\u679c\u3002","\uacb0\uacfc\uac12\uc774 \ub9ce\uc2b5\ub2c8\ub2e4. \uac80\uc0c9\uc744 \uc774\uc6a9\ud574 \uc8fc\uc138\uc694.":"\u7ed3\u679c\u592a\u591a\u3002\u8bf7\u4f7f\u7528\u641c\u7d22\u529f\u80fd\u3002","\uc774\ub984":"\u540d\u5b57","\ubd80\uc11c":"\u90e8\u95e8","\uc544\uc774\ub514":"ID","\uc804\ud654\ubc88\ud638":"\u7535\u8bdd","\uc9c1\uc704":"\u804c\u79f0","\uc9c1\ucc45":"\u804c\u4f4d"},zh_TW:{"\ub2eb\uae30":"\u95dc\u9589","\uc120\ud0dd":"\u9078\u64c7","\uc774\ub984, \uc544\uc774\ub514":"\u540d\u5b57\uff0cID","\uc774\ub984, \uc774\uba54\uc77c":"\u540d\u5b57\uff0c\u96fb\u5b50\u90f5\u4ef6","\uc774\ub984, \ubd80\uc11c\uba85, \uc544\uc774\ub514":"\u540d\u5b57\uff0c\u90e8\u9580\u540d\u7a31\uff0cID","\uac80\uc0c9":"\u641c\u7d22","\ub354\ubcf4\uae30":"\u67e5\u770b\u66f4\u591a","\uc870\uc9c1\uc21c":"\u7d44\u7e54\u9806\u5e8f","\uac00\ub098\ub2e4\uc21c":"abc\u9806\u5e8f","\uba64\ubc84\uac00 \uc5c6\uc2b5\ub2c8\ub2e4.":"\u6c92\u6709\u6703\u54e1","\uac80\uc0c9\uacb0\uacfc\uac00 \uc5c6\uc2b5\ub2c8\ub2e4.":"\u6c92\u6709\u641c\u7d22\u7d50\u679c\u3002","\uacb0\uacfc\uac12\uc774 \ub9ce\uc2b5\ub2c8\ub2e4. \uac80\uc0c9\uc744 \uc774\uc6a9\ud574 \uc8fc\uc138\uc694.":"\u7d50\u679c\u592a\u591a\u3002\u8acb\u4f7f\u7528\u641c\u7d22\u529f\u80fd\u3002","\uc774\ub984":"\u540d\u5b57","\ubd80\uc11c":"\u90e8\u9580","\uc544\uc774\ub514":"ID","\uc804\ud654\ubc88\ud638":"\u96fb\u8a71","\uc9c1\uc704":"\u8077\u7a31","\uc9c1\ucc45":"\u8077\u4f4d"},vi:{"\ub2eb\uae30":"\u0110\u00f3ng","\uc120\ud0dd":"Ch\u1ecdn","\uc774\ub984, \uc544\uc774\ub514":"H\u1ecd t\u00ean, t\u00e0i kho\u1ea3n","\uc774\ub984, \uc774\uba54\uc77c":"Name, Email","\uc774\ub984, \ubd80\uc11c\uba85, \uc544\uc774\ub514":"H\u1ecd t\u00ean, t\u00ean ph\u00f2ng ban, t\u00e0i kho\u1ea3n","\uac80\uc0c9":"T\u00ecm ki\u1ebfm","\ub354\ubcf4\uae30":"Xem th\u00eam","\uc870\uc9c1\uc21c":"Theo t\u1ed5 ch\u1ee9c","\uac00\ub098\ub2e4\uc21c":"Theo Alphabet","\uba64\ubc84\uac00 \uc5c6\uc2b5\ub2c8\ub2e4.":"Kh\u00f4ng c\u00f3 th\u00e0nh vi\u00ean","\uac80\uc0c9\uacb0\uacfc\uac00 \uc5c6\uc2b5\ub2c8\ub2e4.":"Kh\u00f4ng c\u00f3 k\u1ebft qu\u1ea3 t\u00ecm ki\u1ebfm","\uacb0\uacfc\uac12\uc774 \ub9ce\uc2b5\ub2c8\ub2e4. \uac80\uc0c9\uc744 \uc774\uc6a9\ud574 \uc8fc\uc138\uc694.":"C\u00f3 nhi\u1ec1u gi\u00e1 tr\u1ecb k\u1ebft qu\u1ea3. Vui l\u00f2ng s\u1eed d\u1ee5ng t\u00ecm ki\u1ebfm.","\uc774\ub984":"H\u1ecd t\u00ean","\ubd80\uc11c":"Ph\u00f2ng ban","\uc544\uc774\ub514":"H\u1ecd t\u00ean","\uc804\ud654\ubc88\ud638":"tho\u1ea1i nh\u00e0","\uc9c1\uc704":"Ch\u1ee9c v\u1ee5","\uc9c1\ucc45":"Ch\u1ee9c tr\u00e1ch"}},i18n:{},treeEl:null,defaults:{elId:"orgTreeTab",orgElId:"org_tree_tab_content",searchInputId:"org_tree_tab_search_input",searchResultElId:"memberList",contextRoot:"/",loadId:null,companyIds:[],includeLoadIds:[],isMyDeptOpened:!0,isAdmin:!1,isDndActive:!1,multiCompanyVisible:!1,dndDropTarget:null,dropCheck:null,dropOut:null,dropFinish:null,draggables:null,type:"node",locale:"ko",callback:null,css:{minHeight:375,maxHeight:375}},_isTreeShowing:!1,_isSearchShowing:!1,initialize:function(t){var n=!0;this.options=e.extend(!0,{},this.defaults,t),this.options.contextRoot=GO.contextRoot||this.options.contextRoot,this.i18n=this.lang[GO.session("locale")]||this.lang[this.options.locale],this.isAdmin=this.options.isAdmin,this.isAdmin||(this.options.displayFormats=this._getDisplayFormats()),this.isAdmin&&(this.options.contextRoot=GO.contextRoot+"ad/"),t.isOrgServiceOn!=undefined?n=t.isOrgServiceOn:this.isAdmin?n=GO.util.isUseOrgService(this.isAdmin):n=GO.session("useOrgAccess"),this.isOrgServiceOn=n,this._renderTemplate(),this._bindEvents();var r=e("#"+this.options.searchResultElId),i=e("#"+this.options.orgElId).parent();return this.isAdmin||this.isOrgServiceOn?this._loadNodeTree():(i.hide(),r.show(),this._loadNodeList()),this},getSelectedData:function(){return this._isTreeShowing?this.nodeTree.getSelectedData():this.nodeList.getSelectedData()},activateDNDDroppable:function(){this._isTreeShowing?this.nodeTree.addClassToDNDTarget():this.nodeList.addClassToDNDTarget()},_bindEvents:function(){var t=e("#"+this.options.elId),n=t.find("#"+this.options.searchInputId);n.off("keyup"),(e.browser.mozilla||e.browser.opera)&&n.imitateKeyEvent(),n.on("keyup",e.proxy(function(t){var n=e(t.currentTarget).val(),r=e("#"+this.options.elId).find("#"+this.options.searchResultElId),i=e("#"+this.options.elId).find(".orgTree"),s=this;clearTimeout(this.clearTimeOut),this.clearTimeOut=setTimeout(function(){n==""&&s.isOrgServiceOn?(r.hide(),i.show(),s._loadNodeTree()):(i.hide(),r.show(),s._loadNodeList(n)),s.beforeKeyword=n},200)},this))},_renderTemplate:function(){var t=this.i18n["\uc774\ub984, \uc544\uc774\ub514"];this.options.type==="contact"?t=this.i18n["\uc774\ub984, \uc774\uba54\uc77c"]:this.isOrgServiceOn&&(t=this.i18n["\uc774\ub984"]+"/"+this.i18n["\uc544\uc774\ub514"]+"/"+this.i18n["\ubd80\uc11c"]+"/"+this.i18n["\uc9c1\uc704"]+"/"+this.i18n["\uc9c1\ucc45"]+"/"+this.i18n["\uc804\ud654\ubc88\ud638"]);var n=['<section class="search">','    <div class="search_wrap">','    	<form onsubmit="return false;">','        <input id="'+this.options.searchInputId+'" class="search" type="text" placeholder="'+t+'" title="'+t+'" >','        <input class="btn_search" type="button" value="{{lang.search}}" title="{{lang.search}}" evt-rol="mail-search">'," 		</form>","    </div>",'    <div id="detailSearchLayerWrap" style="position:relative;display:none;z-index:60"></div>',"</section>"],r=['<div class="orgTree_wrap">','	<div class="orgTree content_tab_wrap">','		<div id="'+this.options.orgElId+'"></div>',"	</div>",'	<div id="'+this.options.searchResultElId+'" class="content_tab_wrap" style="display: none;border:none;padding:5px 0px 5px 0px">',"	</div>","</div>"],i=this.options.type=="department"?r:n.concat(r),s=Hogan.compile(i.join(""));e("#"+this.options.elId).html(s.render({lang:this.i18n})),e("#"+this.options.elId).find("input[placeholder]").placeholder()},_loadNodeTree:function(){this._isTreeShowing=!0,this._isSearchShowing=!1,this.nodeTree=e.goNodeTree({el:"#"+this.options.orgElId,css:this.options.css,useDisableNodeStyle:this.options.useDisableNodeStyle,useApprReception:this.options.useApprReception,useApprReference:this.options.useApprReference,receiveAllowType:this.options.receiveAllowType,url:this.options.contextRoot+"api/organization/list",loadId:this.options.loadId,companyIds:this.options.companyIds,includeLoadIds:this.options.includeLoadIds,type:this.options.type,isMyDeptOpened:this.options.loadId==undefined?this.options.isMyDeptOpened:!1,callback:e.proxy(function(t){e.isFunction(this.options.callback)&&this.options.callback(t)},this),contextRoot:GO.contextRoot,multiCompanyVisible:this.options.multiCompanyVisible,i18n:this.i18n||{},isAdmin:this.options.isAdmin,isDndActive:this.options.isDndActive,dndDropTarget:this.options.dndDropTarget,dropCheck:this.options.dropCheck,dropFinish:this.options.dropFinish,dropOut:this.options.dropOut,draggables:this.options.draggables,displayFormats:this.options.displayFormats})},_loadNodeList:function(t){this._isTreeShowing=!1,this._isSearchShowing=!0;var n={keyword:t,type:this.options.type,multiCompanyVisible:this.options.multiCompanyVisible,i18n:this.i18n||{},isAdmin:this.options.isAdmin,isOrgServiceOn:this.isOrgServiceOn,parentNodeId:this.options.loadId,parentNodeIds:this.options.includeLoadIds,companyIds:this.options.companyIds,parentSelector:"#"+this.options.elId,useDisableNodeStyle:this.options.useDisableNodeStyle,useApprReception:this.options.useApprReception,useApprReference:this.options.useApprReference,receiveAllowType:this.options.receiveAllowType,selectQuery:"#"+this.options.searchResultElId,isDndActive:this.options.isDndActive,dndDropTarget:this.options.dndDropTarget,dropCheck:this.options.dropCheck,dropFinish:this.options.dropFinish,dropOut:this.options.dropOut,draggables:this.options.draggables,contextRoot:GO.contextRoot,css:this.options.css,displayFormats:this.options.displayFormats};this.nodeList?(this.nodeList.abortAjaxCall(),this.nodeList.initialize(n)):this.nodeList=e.goNodeList(n)},_getDisplayFormats:function(){var e={};return _.isFunction(GO.config)?(e.orgTreeModeratorFormat=this.convertDisplayFormat(GO.config("orgTreeModeratorFormat")),e.orgTreeMemberFormat=this.convertDisplayFormat(GO.config("orgTreeMemberFormat")),e.orgTreeMasterFormat=this.convertDisplayFormat(GO.config("orgTreeMasterFormat"))):_.isUndefined(BASECONFIG)||(e.orgTreeModeratorFormat=this.convertDisplayFormat(BASECONFIG.data.displayConfigModel.orgTreeModeratorFormat),e.orgTreeMemberFormat=this.convertDisplayFormat(BASECONFIG.data.displayConfigModel.orgTreeMemberFormat),e.orgTreeMasterFormat=this.convertDisplayFormat(BASECONFIG.data.displayConfigModel.orgTreeMasterFormat)),e},convertDisplayFormat:function(e){var t=e||"";return t=t.replace(/\{\{/g,"{"),t=t.replace(/\}\}/g,"}"),t}})})(jQuery);