/*! 
 * go-gadget - v1.5.0 
 * 그룹 오피스 가젯 프레임워크
 * 
 * Date: 2014-04-18 

 */

(function(e,t,n,r){t.GO||(t.GO={});var i=t.GO,s={};s.namespace=function(e,n){var r=e.split("."),n=typeof n=="undefined"?!0:!1,i=t;for(var s=0,o=r.length;s<o;s++){if(typeof i[r[s]]=="undefined"){if(!n)throw new Error("\ud574\ub2f9 \ubaa8\ub4c8\uc774 \uc874\uc7ac\ud558\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4.");i[r[s]]={}}i=i[r[s]]}return i},s.isString=function(e){return typeof e=="string"||e instanceof String},s.require=function(e){s.namespace(e,!1)},s.extend=function(t,n){var r=function(){},i=function(e){this._init.apply(this,arguments)};return t.prototype._init||(t.prototype._init=function(){}),r.prototype=e.extend(!0,{},t.prototype,n),i.prototype=new r,i.fn=i.prototype,i.fn.parent=i,i._super=i.__proto__,i},s.parseUrl=function(e){var r=t.location,i=n.createElement("a"),s={};return i.setAttribute("href",e),s={protocol:/^(http|https)/.test(i.protocol)?i.protocol:r.protocol,host:i.host?i.host:r.host,hostname:i.hostname?i.hostname:r.hostname,port:i.port?i.port:r.port,pathname:i.pathname[0]==="/"?i.pathname:"/"+i.pathname,search:i.search?i.search:"",href:i.href,hash:i.hash?i.hash:r.hash},s},s.fixUrl=function(e,t){var n=s.parseUrl(e),r=t||"/",i=n.pathname,o=i[0]==="/"?i.slice(1):i;return r&&i.indexOf(r)!==0&&(i=r+o),[i,n.search,n.hash].join("")},s.serializeForm=function(t,n){n=n||!1;var r=e(t).serializeArray(),i={};return e.each(r,function(e,t){var r=n?encodeURIComponent(t.value):t.value;t.name in i?(i[t.name]instanceof Array||(i[t.name]=[i[t.name]]),i[t.name].push(r)):i[t.name]=r}),i},s.namespace("GO.gadget"),i.gadget.dom={select:function(t){var n=e("<select />").attr("name",t.name),r=t.value.split("|"),i=t.labels?t.labels.split("|"):r,s=t.defaultValue,o=[];for(var u=0,a=r.length;u<a;u++){var f=r[u],l=e('<option value="'+r[u]+'">'+i[u]+"</option>");t.defaultValue===f&&l.prop("selected",!0),o.push(l)}return n.append(o)},checkbox:function(t){var n=e('<input type="checkbox"/>'),r="gadget-opt-cb-"+t.name+"-"+t.value;return n.prop("id",r).prop("name",t.name).prop("checked",t.checked||!1).val(t.value),n},text:function(t){return e("<input />").attr("type","text").attr("name",t.name).val(t.value||"")},textarea:function(t){return e("<textarea>").attr("name",t.name).val(t.value||"")},parse:function(e){return this[e.type].call(this,e)}},s.namespace("GO.gadget"),i.gadget.i18n=function(){function t(e,t){this.locale=t,this.langs=n(e,t)}function n(t,n){var r={};return e.each(t,function(e,t){s.isString(t)&&(r[e]=t)}),n&&e.extend(r,t[n]||{}),r}return t.prototype={parse:function(e,n){n=n||{};var r=this.langs[e];return!r||(r=t.parse(r,n)),r}},t.parse=function(e,t){var n;return n=e.replace(/\{\{([\s\S]+?\}?)\}\}/g,function(e,n){return t[n]||""}),n},t}(),s.namespace("GO.gadget"),i.gadget.ContentProvider=function(){function r(t){if(!t||typeof t.then!="function")return!1;var n=String(e.Deferred().then),r=String(t.then);return n===r}function o(){this.extProps.options.hasOwnProperty("editable")||delete this.options.editable,this.extProps.options.hasOwnProperty("removable")||delete this.options.removable,this.extProps.options.hasOwnProperty("highlight")||delete this.options.highlight}function u(e,t){return console.warn("[:::Gadget errors:::] : Caused by..."),console.log(t.stack?t.stack:t.message),this.extProps.onError(e,t)}function a(e){return e.is(":checkbox")||e.is(":radio")}function f(e,t){e.styleSheet?e.styleSheet.cssText+=t:e.appendChild(n.createTextNode(t))}function l(){var t=[this.langs.refresh.none,i.gadget.i18n.parse(this.langs.refresh.unit_minute,{time:1}),i.gadget.i18n.parse(this.langs.refresh.unit_minute,{time:5}),i.gadget.i18n.parse(this.langs.refresh.unit_minute,{time:10}),i.gadget.i18n.parse(this.langs.refresh.unit_minute,{time:15}),i.gadget.i18n.parse(this.langs.refresh.unit_minute,{time:30}),i.gadget.i18n.parse(this.langs.refresh.unit_hour,{time:1}),i.gadget.i18n.parse(this.langs.refresh.unit_hour,{time:2})],n;return n=e(d(this.langs.refresh.label)).find("li:first").append(i.gadget.dom.select({name:"refresh",value:"-1|1|5|10|15|30|60|120",labels:t.join("|"),defaultValue:"-1"})).end(),n}function c(){var t=e(d(this.langs.personalize.label)),n=i.gadget.dom.checkbox({name:"editable",value:"Y",checked:this.options.editable||!1}),r=i.gadget.dom.checkbox({name:"removable",value:"Y",checked:this.options.removable||!1});return t.find("li:first").append(p(n,this.langs.personalize.editable)).append(p(r,this.langs.personalize.removable)),t}function h(){var t=e(d(this.langs.highlight.label)),n=i.gadget.dom.checkbox({name:"highlight",value:"Y",checked:this.options.highlight||!1});return t.find("li:first").append(p(n,this.langs.highlight.highlight)),t}function p(t,n){var r=e('<span class="wrap_option wrap_label"></span>');return r.append(t,'<label for="'+t.attr("id")+'">'+n+"</label>"),r}function d(e){var t=[];return t.push('<ul class="static_style">'),t.push("<li>"),t.push('<p class="title">'+e+"</p>"),t.push("</li>"),t.push("</ul>"),t.join("\n")}function v(e){var t=[];return t.push('<ul class="type_simple_list">'),t.push('<li class="null_data">'),t.push('<span class="ic_data_type ic_error_page"></span>'),t.push('<p class="desc">'+e+"</p>"),t.push("</li>"),t.push("</ul>"),t.join("\n")}function m(){var e=[];return e.push('<div class="gadget_design_wrap">'),e.push('<div class="go_gadget_header">'),e.push('<div class="gadget_h1">'),e.push('<span class="title">'+this.getTitle()+"</span>"),e.push("</div>"),e.push("</div>"),e.push('<ul class="type_simple_list">'),e.push('<li class="null_data">'),e.push('<span class="ic_data_type ic_error_page"></span>'),e.push('<p class="desc">'+this.langs.msg.load_error+"</p>"),e.push("</li>"),e.push("</ul>"),e.push("</div>"),e.join("\n")}s.require("GO.gadget.i18n"),s.require("GO.gadget.dom");var t=function(t,n,r){var s=this,r=r||{};if(!n)throw new Error("gadget spec data error");this.el=t,this.$el=e(this.el),this.locale=r.locale||"ko",this.contextRoot=r.contextRoot||"/",this.methodType=r.methodType||"create",this.spec={id:n.id,name:n.name||"Title",version:n.version||"1.0",description:n.description||"",author:n.author||""},this.pageTemplate={empty:v,loadError:function(){return m.call(s)}},this.canPersonalize=r.canPersonalize||!1,this.langs=e.extend(!0,{refresh:{label:"\uc0c8\ub85c\uace0\uce68",none:"\uc548\ud568",unit_minute:"{{time}}\ubd84",unit_hour:"{{time}}\uc2dc\uac04"},personalize:{label:"\uac1c\uc778\ud654",editable:"\ud3b8\uc9d1 \uac00\ub2a5",removable:"\uc0ad\uc81c \uac00\ub2a5"},highlight:{label:"\uac00\uc82f \ud14c\ub450\ub9ac",highlight:"\uac15\uc870"},msg:{load_error:"\uc694\uccad\ud558\uc2e0 \ub0b4\uc6a9\uc744 \ubd88\ub7ec\uc624\uc9c0 \ubabb\ud588\uc2b5\ub2c8\ub2e4.<br />\uc624\ub958\uac00 \uc9c0\uc18d\ub420 \uacbd\uc6b0, \uc6b4\uc601\uc790\uc5d0\uac8c \ubb38\uc758\ud574 \uc8fc\uc2ed\uc2dc\uc624."}},r.langs||{}),this.options={},this.extProps={url:"",refreshable:!1,highlightable:!1,events:{},styles:{},langs:{},options:{},defaultOptions:{refresh:-1},setTitle:function(){return s.spec.name},validate:function(e){return!1},renderConfig:function(e){},onSuccess:function(e,t){},onMoved:function(e,t){},onError:function(e,t){s.getContentContainer().empty().append(m.call(s))}},this.dom=i.gadget.dom,this.editorRunner={},this.reqParams={}};return t.prototype={load:function(t){var n=this,r=Array.prototype.slice.call(arguments),o=r.length,u={};if(s.isString(t)){var u=o>1?r[o-1]:{};o>2&&e.isPlainObject(r[1])&&e.extend(!0,this.reqParams,r[1]),e.extend(u,{url:t})}else e.isPlainObject(t)&&(u=t);e.extend(!0,this.extProps,u),this.methodType==="create"&&e.extend(!0,this.options,this.extProps.defaultOptions),this.extProps.spec=this.spec,this.extProps.contextRoot=this.contextRoot,this.extProps.locale=this.locale,this.extProps.i18n=new i.gadget.i18n(this.extProps.langs,this.locale),this.extProps.dom=i.gadget.dom,this.extProps.template=function(e,t,n){var r=Hogan.compile(e);return r.render(t||{},n||{})},this.extProps.pageTemplate=this.pageTemplate,this.extProps.requestContent=this.requestContent,e.extend(!0,this.extProps.options,this.options),this.init()},init:function(){this.delegateEvents(),this.loadStyle(),this.render(),this.setRefresh()},setRefresh:function(){if(this.extProps.refreshable){var t=this.getOptionForm(),n=+this.options.refresh;this.intervalId&&clearInterval(this.intervalId),n>0&&(this.intervalId=setInterval(e.proxy(function(){this.$el.trigger("gadget:request-content")},this),n*60*1e3))}},loadEditor:function(){this.$el.find("[data-role=editable]").each(e.proxy(function(t,n){e(n).data("initstatus")||(this.editorRunner.load(n),e(n).data("initstatus",!0))},this))},getOptionForm:function(){return this.$el.find(".gadget-options-form")},getContentContainer:function(){return this.$el.find(".go-gadget-content")},setLangs:function(t){e.extend(!0,this.langs,t)},setOption:function(t){if(e.isPlainObject(t))e.extend(!0,this.options,t);else{var n=Array.prototype.slice.call(arguments,1);this.options[t]=n[0]}e.extend(!0,this.extProps.options,this.options)},setGadgetOptions:function(t){this.extProps.options=t||{},o.call(this),e.extend(!0,this.options,this.extProps.options)},setEditorRunner:function(t){e.extend(!0,this.editorRunner,t)},getEditorRunner:function(){return this.editorRunner},getEditorData:function(){var t={};return this.$el.find("[data-role=editable][id!='']").each(e.proxy(function(n,r){var i=e(r).attr("name"),s=this.getEditorRunner().getData(r);e.isPlainObject(s)?e.extend(t,s):t[i]=s},this)),t},getOption:function(e){return typeof e=="undefined"?this.options:this.options[e]||""},loadStyle:function(){var t=this,r="go-gadget-style-"+this.spec.id;this.$el.addClass("go-gadget-"+this.spec.id);if(e.isEmptyObject(this.extProps.styles)||e("#"+r).length>0)return;var i=".go-gadget-"+this.spec.id+" .go-gadget-content",s=n.getElementsByTagName("head")[0],o=n.createElement("style");o.type="text/css",o.setAttribute("id",r),s.appendChild(o),e.each(this.extProps.styles,function(e,t){f(o,i+" "+e+" {"+t+"}")})},render:function(){this.setTitle()},setTitle:function(){},getTitle:function(){return this.extProps.setTitle()},isRefreshable:function(){return!!this.extProps.refreshable},isHighlightable:function(){return!!this.extProps.highlightable},renderConfig:function(){var e=this.getOptionForm();e.html("");try{this.extProps.renderConfig(e.get(0))}catch(t){u.call(this,e.get(0),t)}this.isRefreshable()&&(e.prepend(l.call(this)),e.find("select[name=refresh]").val(this.options.refresh||"-1")),this.canPersonalize&&e.append(c.call(this)),this.isHighlightable()&&e.append(h.call(this))},reloadConfig:function(){this.renderConfig(),this.setRefresh()},renderContent:function(e,t){try{this.extProps.onSuccess(e,t)}catch(n){u.call(this,e,n)}},renderError:function(e,t){self.extProps.onError(e,t)},afterMoved:function(e,t){return this.extProps.onMoved(this.getContentContainer().get(0),e,t)},serializeForm:function(){var t=s.serializeForm(this.$el.find(".gadget-options-form"));return e.extend(!0,t,this.getEditorData()),t},validateForm:function(e){return this.extProps.validate(this.$el.find(".gadget-options-form").get(0),e)},requestContent:function(){function u(n){e.ajax(n,o).done(function(e,n,r){t.resolveWith(this,[i,e])}).fail(function(e,n,r){t.rejectWith(this,[i,n])})}var t=e.Deferred(),n=this.extProps,i=this.getContentContainer().get(0),s,o={type:"GET",statusCode:{401:function(){}},beforeSend:function(e){e.setRequestHeader("TimeZoneOffset",-(new Date).getTimezoneOffset()),t.notifyWith(this,[i])}};if(typeof n.url=="function"){s=n.url.call(n);if(r.call(this,s))return s.done(e.proxy(function(e){u.call(this,e)},this)),t}else s=n.url;return s?u.call(this,s):(t.notifyWith(this,[i]),t.resolveWith(this,[i,{}])),t},delegateEvents:function(){var t=this.extProps,n=this.getContentContainer();e.each(this.extProps.events,function(r,i){var o=[],u=i;s.isString(u)&&(u=t[u]);if(r.search(/\s+/)>0){var a=r.search(/\s+/),f=r.slice(0,a),l=r.slice(a+1);o.push(f,l)}else o.push(r);o.push(e.proxy(u||function(){},t)),e.fn.on.apply(n,o)})}},t}()})(jQuery,window,document);