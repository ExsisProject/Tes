(function(){define(["jquery","underscore","backbone","hogan","i18n!nls/commons"],function(e,t,n,r,i){function o(e,t,n,s,o){var a=[];e||(e="");if(s){var f=u();a.push('<li class="'+e+'" data-id="{{id}}" data-position="{{position}}" data-marker="'+f+'" data-mine='+o+">"),a.push('<span class="chip" style="background-color: '+f+'"></span>')}else a.push('<li class="'+e+'" data-id="{{id}}" data-position="{{position}}"'+" data-mine="+o+">");return t?(a.push("{{{title}}}"),a.push('{{#templateText}}<span class="name" style="display:none;">{{templateText}}</span>{{/templateText}}')):a.push('<span class="name">{{title}}</span>'),n&&(a.push('<span class="btn_wrap">'),a.push('<span class="ic_classic ic_del" title="'+i["\uc0ad\uc81c"]+'"></span>'),a.push("</span>")),a.push("</li>"),r.compile(a.join("\n"))}function u(){var e="0123456789ABCDEF".split(""),t="#";for(var n=0;n<6;n++)t+=e[Math.floor(Math.random()*16)];return t}function a(e){e=e||i["\ucd94\uac00"];var t=[];return t.push('<li class="creat add-btn">'),t.push('<span class="btn_wrap">'),t.push('<span class="ic_form ic_addlist"></span>'),t.push('<span class="txt">'+e+"</span>"),t.push("</span>"),t.push("</li>"),t.join("\n")}function f(e){e=e||i["\uc804\uccb4 \uc0ad\uc81c"];var t=[];return t.push('<a class="remove_all_tags btn_rest">'),t.push('<span class="ic16 allDel"></span>'),t.push('<span class="txt">'+e+"</span>"),t.push("</a>"),t.join("\n")}var s=n.View.extend({tagName:"ul",className:"name_tag",events:{"click .add-btn":"_triggerAddTag","click .remove_all_tags":"removeAll"},initialize:function(e){this.options=e||{},this.options.useAddButton=this.options.useAddButton||!1,this.options.useMarker=this.options.useMarker||!1,this.stopPropagation=e.stopPropagation,this.options.useAddButton&&(this.$el.append(a(this.options.addBtnText)),this.options.useRemoveAll&&this.$el.find(".add-btn").append(f(this.options.removeAllBtnText)))},remove:function(){n.View.prototype.remove.apply(this,arguments),this.$el.off()},addTags:function(e,n){var r=t.isArray(e)?e:[e],i=t.has(n,"attrs");t.each(r,function(e){var r=this._makeDisplayName(e),s=t.clone(n);i&&(s.attrs=e),this.addTag(e.id,r,s,e)},this)},addTag:function(t,n,r,i){var s=this,a=r||{},f=o(a.liCustomClass||"",a.isTemplate||!1,a.removable||!1,!1,a.itemIsMine||!1),l=e(f.render({id:t,title:n,templateText:a.templateText,position:i?i.position:""}));i&&l.data("user",i);if(this.getNameTag(t).length)return;!a.attrs||l.data("attrs",a.attrs),a.onCreate&&typeof a.onCreate=="function"&&a.onCreate.call(undefined,l.get(0));if(this.options.useMarker){var c=u();l.prepend('<span class="chip" style="background-color: '+c+'"></span>'),l.attr("data-marker",c)}return this.options.useAddButton?this.$el.find("li.add-btn").before(l):this.$el.append(l),l.find(".ic_del").bind("click",function(r){var i=e(this).closest("li");if(a.onDelete&&typeof a.onDelete=="function"){var o=a.onDelete.call(undefined,t,n);o.done(function(){s._removeTag(i)})}else s._removeTag(i);s.stopPropagation&&r.stopPropagation()}),l},getNameTag:function(e){return this.$el.find('[data-id="'+e+'"]')},removeTag:function(e){this.getNameTag(e).remove()},removeAll:function(e){t.isUndefined(e)||(e.preventDefault(),e.stopPropagation()),this.$("[data-id]").remove()},getNameTagList:function(){var t=[];return this.$el.find("li:not(.add-btn)").each(function(n,r){var i=e(r),s=e.extend(!0,{id:i.data("id"),name:i.find(".name").text()},i.data("attrs")||{});t.push(s)}),t},_removeTag:function(e){var t=e.clone(),n=e.data();e.remove(),t.data(n),this.$el.trigger("nametag:removed",[t.data("id"),t.get(0),t])},_triggerAddTag:function(){this.$el.trigger("nametag:clicked-add",[this])},_makeDisplayName:function(e){return e.displayName||e.name+(e.position?" "+e.position:"")}},{create:function(t,n){var n=n||{},r=new s(n),t=t||[];return e.each(t,function(e,t){r.addTag(t.id,t.title,t.options)}),r}});return s})})();