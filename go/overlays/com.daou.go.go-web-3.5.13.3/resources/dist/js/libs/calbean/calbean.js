(function(e,t){var n=this,r=Array.prototype.slice,i=7,s={day:"day",time:"time"},o={timed:"timed",allday:"allday"},u={time:"txtcolor",day:"bgcolor"},a={"public":"public","private":"private"},f={company:"company",normal:"normal",holiday:"holiday",anniversary:"anniversary"},l={update_calendar_color:"update:calendar-color",add_events:"add:events",reset_events:"reset:events",clear_events:"clear:events",remove_calendars:"remove:calendars",change_view_type:"change:view-type",change_date:"change:date",resize:"resize:calendar",request_show_event:"request:show-event",request_create_event:"request:create-event",changed_date:"changed:date",changed_time:"changed:time",changed_view_type:"changed:view-type"},c=function(e,t){typeof t=="undefined"&&(t=!1);if(e.constructor===Array)return r.call(e);var n=new Object;for(var i in e)n[i]=typeof e[i]=="object"&&t?c(e[i]):e[i];return n},h=function(e,t){if(typeof e!="object")throw new Error("Invalid object.");for(var n in e)if(e[n]===t)return!0;return!1},p=function(){var e=function(){return new Error("Invalid date format")};return e}(),d=function(){var e=r.call(arguments),n=e.length;for(var i=0;i<n;i++)if(!t(e[i]).isValid())return!1;return!0},v=function(e){return t(e).day()===0},m=function(e){return t(e).day()===6},g=function(e,n){var r=t(e).clone().startOf("day"),i=t(n).clone().startOf("day");return r.diff(i)===0},y=function(e){return g(e,new Date)},b=function(e,n){var r=t(e).clone().startOf("month"),i=t(n).clone().startOf("month");return r.diff(i)===0},w=function(e,n){var r=t(n).clone().startOf("month").toDate(),i=t(e).clone().startOf("month").toDate();return i<r},E=function(e,n){var r=t(n).clone().startOf("month").toDate(),i=t(e).clone().startOf("month").toDate();return i>r},S=function(t){e(t).attr("unselectable","on").css("MozUserSelect","none").bind("selectstart.ui",function(){return!1})},x=function(e,n){return Math.ceil(t(n).diff(e,"day",!0))},T=function(){function r(e,t){var n=e.day()-t;return n<0&&(n=this.options.width+n),n}function s(){var e=new Date(this.options.date.getTime()),n=t(e),i=n.clone().startOf("month"),s=r(i,this.options.startday),o=n.clone().endOf("month"),u=i.clone().subtract("days",s),a={cols:this.options.width,rows:Math.ceil((o.date()+s)/this.options.width)};for(var f=0;f<a.rows;f++)for(var l=0;l<a.cols;l++)this.matrix[f]instanceof Array||(this.matrix[f]=[]),this.matrix[f][l]={instance:u.clone().toDate(),year:u.year(),month:u.month(),date:u.date(),day:u.day(),today:y(u),events:[],flags:[],axisX:f,axisY:l},u.add("days",1);return this.rows=a.rows,this.cols=a.cols,this.matrix}function u(e){return e.type===f.holiday||e.type===f.anniversary}function a(e){return e.timeType===o.allday}function l(){var e=this.getFirstCell().instance,n=this.getLastCell().instance,i=this.options.events.length;for(var s=0;s<i;s++){var o,f,l=0,h=0,p=0,d,v,m,y={x:0,y:0},b=0,w=0,E=1,S=!0,T=-1,N=this.options.events[s],C=t(this.getFirstCell().instance);if(!this.isValidEvent(N))continue;u(N)||a(N)?(o=t(N.startTime,"YYYY-MM-DD").clone().startOf("days"),f=t(N.endTime,"YYYY-MM-DD").clone()):(o=t(N.startTime).clone().startOf("days"),f=t(N.endTime).clone()),f.format("HH:mm:ss")==="00:00:00"&&N.timeType==="timed"?(N.endTime=f.format("YYYY-MM-DDTHH:mm:ss.SSSZ"),f.subtract("seconds",1)):f.endOf("days"),l=r(o,this.options.startday),h=x(o,f),this.options.width>1?p=Math.ceil((h+l)/this.options.width):p=h,d=t(N.startTime).toDate()<e?t(e).clone().startOf("days"):o,v=t(N.endTime).toDate()>n?t(n).clone().endOf("days"):f,y=this.getAxis(d),m=x(d,v),b=+y.x,w=+m;if(o.isBefore(t(C),"day")){var k=x(o,C),L=Math.ceil(k/this.options.width);E+=L}while(w>0){var A=this.getCell(y.x,y.y),O=A.flags,M=A.events,_=this.options.width-d.day()-1+this.options.startday,D={id:N.id,type:N.type,summary:N.summary,range:m,total_rows:p,current_row:+E,_ref:N};u(N)?O.push(D):(D.render=!0,T===-1&&(T=c(M)),m>1&&(S?(_>0&&(D.colspan=w>_?_+1:w),S=!1):D.render=!1),A.events[T]=D),this.__eventsIndex__[N.id]=s;if(g(d,v))break;b=+y.x,d.add("days",1),y=this.getAxis(d),y.x>b&&(E++,S=!0,T=-1),w--}}}var n=function(t){this.options=e.extend({date:new Date,startday:0,width:i,events:[]},t||{}),this.matrix=[],this.rows=0,this.cols=0,this.__eventsIndex__={},s.call(this),l.call(this)};n.prototype={updateEvent:function(t){if(!t.id)throw new Error("\uc774\ubca4\ud2b8 ID\uac00 \ud544\uc694\ud569\ub2c8\ub2e4.");var n=this.findEventById(t.id);e.extend(!0,n,t),this.reset()},resetEvents:function(e){this.options.events=e,l.call(this)},setStartday:function(e){if(this.options.startday===e)return;this.options.startday=e,l.call(this)},isValidEvent:function(e){var n=t(e.startTime),r=t(e.endTime);return d(n,r)&&!(r.diff(n)<0)},findEventById:function(e){return this.options.events[this.__eventsIndex__[e]]},getAxis:function(e){var n=t(e),r=t(this.options.date).clone().startOf("month").day(),i=b(e,this.options.date)?r:n.clone().startOf("month").day()+this.options.startday,s=this.options.width===1?i:i%this.options.width,o=s+n.date(),u={x:0,y:0};w(e,this.options.date)?u.x=0:E(e,this.options.date)?u.x=this.getAxisXOfLast():u.x=this.options.width===1?o-1:Math.floor((o-1)/this.options.width),u.y=this.options.width===1?0:(s+n.date())%this.options.width-1,u.y<0&&(u.y=this.options.width+u.y);if(u.x<0||u.x>this.getRowCount()||u.y>this.getColCount())throw new Error("Invalid axis of matrix");return u},getAll:function(){return this.matrix},getCell:function(e,t){return this.matrix[e][t]},getCellByDate:function(e){var t=this.getAxis(e);return this.getCell(t.x,t.y)},getRow:function(e){return this.matrix[e]},getRowByDate:function(e){return this.getRow(this.getAxis(e).x)},getRowCount:function(){return this.rows},getColCount:function(){return this.cols},getFirstCell:function(){return this.matrix[0][0]},getLastCell:function(){return this.matrix[this.getAxisXOfLast()][this.getAxisYOfLast()]},getAxisXOfLast:function(){return this.rows-1},getAxisYOfLast:function(){return this.cols-1}};var c=function(e){var t=0;for(var n=0,r=e.length;n<=r;n++)if(typeof e[n]=="undefined"){t=n;break}return t};return n.__cache__={},n.getInstance=function(e){var r=t(e.date||new Date),i=r.format("YYYYMM");if(n.__cache__[i]==null||typeof n.__cache__[i]=="undefined")n.__cache__[i]=new n(e);return n.__cache__[i]},n}();e.fn.calbean=function(n){function Y(e){return e=e||"td","<"+e+' class="scroll_area timeline-scrollfix"></'+e+">"}var i=e.extend(!0,{type:"weekly",startday:0,date:new Date,lang:"ko",lazy:!1,height:0,maxRows:4,events:[],useAttendeeFetch:!1,i18n:{"\uc885\uc77c\uc77c\uc815":"\uc885\uc77c\uc77c\uc815","\uc2dc\uac04":"\uc2dc\uac04","\ub2eb\uae30":"\ub2eb\uae30","{{count}} \uac1c":"","\uc804\uc0ac\uc77c\uc815":"\uc804\uc0ac\uc77c\uc815"}},n||{}),w=t.weekdaysShort(),E={d:"daily",w:"weekly",m:"monthly"},C="calbean-calendar-",k="calbean_calendar_view",A=i.i18n,O={},M=e(this);S(this);var D=function(){var t=e("."+k).length;M.attr("id")||M.attr("id",C+t),M.hasClass(k)||M.addClass(k),H(),V()},P=function(){function e(e,i){var s={allday:1,timed:2};return(new r(e,i)).pipe(function(t,r){return n(t.startTime,r.startTime)}).pipe(function(t,r){return n(r.endTime,t.endTime)}).pipe(function(t,n){return s[t.timeType]-s[n.timeType]}).pipe(function(n,r){return t(n.startTime).valueOf()-t(r.startTime).valueOf()}).pipe(function(n,r){return t(n.createdAt).valueOf()-t(r.createdAt).valueOf()}).run()}function n(e,t){var n=e.split("T")[0],r=t.split("T")[0],i=-1;return n>r?i=1:n===r&&(i=0),i}function r(e,t){this.a=e,this.b=t,this.__result__=0,this.pipe=function(e){return this.__result__===0&&(this.__result__=e(this.a,this.b)),this},this.run=function(){return this.__result__}}i.events.sort(e)},H=function(){for(var e in l)M.off(l[e]);M.off("click","a.schedule")},B=function(t){t.preventDefault();var n=e(t.currentTarget),r=n.attr("is-init")?n:n.parent(),i=r.data()&&!!r.data().promise?r.data().promise:null;t.stopImmediatePropagation(),i&&i.done(function(){var e=r.data().event;e&&(e.visibility!=="private"||e.auth)&&M.trigger(l.request_show_event,[n.attr("data-calendarId"),n.attr("data-id")])})},j=function(e,t){M.height(t),i.height=t,st()},F=function(e,t){if(!h(E,t))throw new Error("Invalid view type.");i.type=t,st()},I=function(e,n,r){var s=t(n);r=r||[];if(!d(s))throw new p;i.date=s.toDate(),U(r||[]),st()},q=function(e,t,n){var r=!1,s=i.events.length;for(var o=0;o<s;o++){var u=i.events[o];if(u.__merged__&&u.__merged__.include_me&&parseInt(t)===u.__merged__.calendarId)u.__merged__.color=n;else{if(u.calendarId!=t)continue;if(u.color===n)continue;u.color=n}r=!0}r&&st()},R=function(e){var t=i.events.length;for(var n=0;n<t;n++)if(i.events[n].id===e)return!0},U=function(e){var t=!1;e=e||[];if(e.length>0){var n=e.length;for(var r=0;r<n;r++){var s=e[r];if(R(s.id))continue;i.events.push(s),t=!0}t&&P()}return t},z=function(e,t){U(t)&&st()},W=function(e,t,n){i.events=[],st(t||[],n)},X=function(t,n){var r=[],s=!1,o=i.events.length;for(var u=0;u<o;u++){if(e.inArray(i.events[u].calendarId,n)>-1){s=!0;continue}r.push(i.events[u])}s&&(i.events=r,st())},V=function(){M.on(l.update_calendar_color,q),M.on(l.add_events,z),M.on(l.reset_events,W),M.on(l.remove_calendars,X),M.on(l.change_view_type,F),M.on(l.change_date,I),M.on(l.resize,j),M.on("click","a.schedule",B)},J=function(e,t){return t>1||t<=1&&e.timeType===o.allday},K=function(e){return['<span class="time">',t(e).format("HH:mm"),"</span>"].join("")},Q=function(e){return e===a["private"]},G=function(){return'<span class="ic_classic ic_lock"></span>'},Z=function(){var n={calendar:"calendar",timeline:"timeline"},r=function(e){this.matrix=e,this.limit=0,this.type=""+n.calendar,this.classnames={tr:[],td:[]}};return r.prototype={setLimit:function(e){return this.limit=e,this},setType:function(e){return this.type=e,this},addClass:function(e,t){return this.classnames[e].push(t),this},build:function(){var e=[],n=this.matrix.length,r=this._computeTotalRows(this.matrix,this.limit),i=this._generateClassForTable("tr"),s=this._generateClassForTable("td"),o=0;this._rebuildEventsAndFlags();do{e.push(["<tr",i,">"].join("")),o===0&&this._isTimelineType()&&e.push("<th",r>0?[' rowspan="',r+1,'"'].join(""):"",">",this._hasEhrInfo(this.matrix)?A["\uc885\uc77c\uadfc\ud0dc\uc77c\uc815"]:A["\uc885\uc77c\uc77c\uc815"],"</th>");for(var u=0;u<n;u++){var a=this.matrix[u].rebuildSchedule,f=t(this.matrix[u].instance).format("YYYY-MM-DD"),l="",c="";if(a.length>o&&a[o]){if(a[o].render===!1)continue;a[o].colspan&&(c=' colspan="'+a[o].colspan+'"'),l=this._buildDayEvent(a[o])}e.push(["<td",s,c,' data-date="',f,'">'].join("")),e.push(l),e.push("</td>")}this._isTimelineType()&&e.push(Y()),e.push("</tr>"),o++}while(o<r);return r>0&&e.push(this._buildBlankRow(r)),e.join("")},_hasEhrInfo:function(t){var n=!1;return e.each(t,function(t,r){if(r.events.length==0)return!0;e.each(r.events,function(e,t){if(t&&t._ref.hasOwnProperty("referenceId"))return n=!0,!1});if(n)return!1}),n},_computeTotalRows:function(){var e=this.matrix.length,t=0,n=0;for(var r=0;r<e;r++)t=Math.max(t,this._getEventCount(this.matrix[r].events)),this._isTimelineType()&&(n=Math.max(n,this._getEventCount(this.matrix[r].flags)));return t+n},_rebuildEventsAndFlags:function(){var e=0;for(var t=0;t<this.matrix.length;t++)e=Math.max(this._getEventCount(this.matrix[t].flags),e);for(var n=0;n<this.matrix.length;n++)if(this.type=="timeline"){var r=[],i=this.matrix[n].events,s=this.matrix[n].flags,o=new Array(e-s.length);r=r.concat(o,s,i),this.matrix[n].rebuildSchedule=r}else this.matrix[n].rebuildSchedule=this.matrix[n].events},_buildBlankRow:function(e){var n=[],r=this.matrix.length,i=this._generateClassForTable("tr"),s=this._generateClassForTable("td");n.push(["<tr",i,">"].join(""));for(var o=0;o<r;o++){var u=this.matrix[o].events,a=t(this.matrix[o].instance).format("YYYY-MM-DD"),f=u.length-e;n.push(["<td",s,' data-date="',a,'">'].join("")),!this._isTimelineType()&&f>0&&n.push(['<a class="btn_schedule_more" href="#" data-bypass>+',f,A["{{count}} \uac1c"],"</a>"].join("")),n.push("</td>")}return n.push("</tr>"),n.join("")},_getEventCount:function(e){var t=0;if(this._isTimelineType()){var n=e.length;for(var r=0;r<n;r++){var i=e[r];i&&J(i._ref,i.range)&&t++}}else t=this.limit>0?Math.min(e.length,this.limit):e.length;return t},_generateClassForTable:function(e){return this.classnames[e].length>0?[' class="',this.classnames[e].join(" "),'"'].join(""):""},_buildDayEvent:function(e){var t=[],n=["draggable"],r=["schedule"],i="schedule_",u=e.range,a=s.time+"",f=c(e._ref),l=[],h=f.summary;J(f,u)&&(a=s.day);if(this._isTimelineType()&&a===s.time)return"";L(f)&&n.push("ehr_info"),(!L(f)||u!=1)&&n.push(i+a),e.total_rows>1&&(e.current_row>1&&(n.push("schedule_day_left"),l.push('<div class="tail_l"><div></div></div>')),e.current_row<e.total_rows&&(n.push("schedule_day_right"),l.push('<div class="tail_r"><div></div></div>'))),a===s.day&&(f.__merged__?n.push("bgcolor_group"):(!L(f)||u!=1)&&n.push("bgcolor"+(f.color||"1"))),n.push("ev-"+f.id);var p=[];return f.type==="company"&&p.push(f.calendarName),t.push('<div el-event class="',n.join(" "),'">',"\n"),t.push(l.join("\n")),t.push('<a href="#" class="',r.join(" "),'" title="',[h,p.join(",")].join(" ; "),'" data-id="',e.id,'" data-calendarId="',f.calendarId,'" data-duration="',e.range,'" data-startdate="',f.startTime,'" data-bypass>',"\n"),f.timeType===o.timed&&(a===s.time&&t.push('<span class="chip bgcolor'+(f.__merged__?"_group":f.color||"1")+'"></span>',"\n"),t.push(K(f.startTime),"\n")),Q(f.visibility)&&t.push(G(),"\n"),L(f)?(t.push('<span class="chip bgcolor',f.color,'"></span>'),t.push('<span class="info">',h,"</span>",'<span class="name">(',f.creator.name,")</span>","\n")):t.push("<span>",h,"</span>","\n"),t.push("</a>","\n"),t.push("</div>","\n"),t.join("")},_isTimelineType:function(){return this.type===n.timeline}},r}(),et=function(){var n=function(){this.id="layer-schedule-more",this.$el=this._createElement(),this.$el.draggable({containment:e("#calendar-viewport"),handle:".drag_area",cursor:"move"}),this.delegateEvents()};return n.prototype={render:function(e,n,r,i){return this._setPosition(e.currentTarget),this.$el.find("ul").empty().append(this._buildEventList(n,r)),this.$el.find("span.date").text(t(n).format("DD")),i.useAttendeeFetch&&N.call(this,this.$el),this._bindDraggable(),this},_bindDraggable:function(){var t=e("table.bg_row td").first().width();this.$el.find(".draggable").draggable({containment:".month_body",cursor:"move",appendTo:".month_body",revert:"invalid",cursorAt:{left:t/2,top:10},helper:function(n){var r=e(this).clone();return r.width(t),r.addClass("dragged"),r},start:function(){var t=e(this),n=t.find("a").data("id");e(".ev-"+n).css("opacity",.7)},stop:function(t,n){var r=e(this),i=r.find("a").data("id"),s=e(n.helper.context).data("promise");typeof s===undefined?(e(".ev-"+i).css("opacity",1),this.remove()):s.done(e.proxy(function(){e(".ev-"+i).css("opacity",1),this.remove()},this))}})},delegateEvents:function(){return e("body").on("click.schedule-more",e.proxy(this._blur,this)),this.$el.on("click","a.schedule",e.proxy(this._showEvent,this)),this.$el.on("click",".ic_close_s2",e.proxy(this.remove,this)),this.$el.on("mouseover",".drag_area > .btn_border",e.proxy(this._disableDrag,this)),this.$el.on("mouseout",".drag_area > .btn_border",e.proxy(this._enableDrag,this)),this},undelegateEvents:function(){return e("body").off("click.schedule-more"),this.$el.off(),this},remove:function(){return this.undelegateEvents(),this.$el.remove(),n.__instance__=null,this},_showEvent:function(e){return B(e),this.remove(),this},_blur:function(t){var n=e(t.target);if(n.is("a.btn_schedule_more"))return;if(!this.$el.is(":visible"))return;if(n.parents("#"+this.id).length>0)return;return this.remove(),this},_enableDrag:function(){return this.$el.draggable("enable"),this},_disableDrag:function(){return this.$el.draggable("disable"),this},_setPosition:function(e){return this._setOffsetX(e),this._setOffsetY(e),this},_setOffsetX:function(t){var n=e(t),r=e(window).width(),i=n.offset().left,s=i+this.$el.outerWidth();return s>r&&(i=r-this.$el.outerWidth()),this.$el.css("left",i+"px"),this},_setOffsetY:function(t){var n=e(t),r=n.parent().parent().parent().offset().top;return this.$el.css("top",r+"px"),this},_createElement:function(){return e("#"+this.id).length||this._buildLayerWrapper(),e("#"+this.id)},_buildLayerWrapper:function(){var t=[];return t.push(['<div id="',this.id,'" class="layer_normal layer_schedule_more">'].join("")),t.push('<div class="title drag_area">'),t.push(['<span class="date"></span>'].join("")),t.push('<span class="btn_border">'),t.push('<span class="ic_classic ic_close_s2" title="'+A["\ub2eb\uae30"]+'"></span>'),t.push("</span>"),t.push("</div>"),t.push("<ul>"),t.push("</ul>"),t.push("</div>"),e("body").append(t.join("\n")),this},_buildEventList:function(e,n){var r=[];r.push("<li>");for(var i=0,a=n.length;i<a;i++){if(!n[i]||typeof n[i]=="undefined")continue;var f=n[i],l=f._ref,c=l.color,h=t(l.startTime),p=J(l,f.range),d=p&&f.range>1,v=g(e,h),m=g(e,l.endTime),y="",b=["draggable"];p?(L(l)&&b.push("ehr_info"),(!L(l)||!!d)&&b.push("schedule_day"),d&&v&&b.push("schedule_day_left"),d&&m&&b.push("schedule_day_right"),y=u[s.day]):(b.push("schedule_time"),y=u[s.time]),l.__merged__?b.push(y+"_group"):(!L(l)||!!d)&&b.push(y+c),r.push(['<div el-event class="',b.join(" "),'">'].join("")),d&&(v&&r.push('<div class="tail_l"><div></div></div>'),m&&r.push('<div class="tail_r"><div></div></div>'));var w=l.summary+" ; ";l.type=="company"&&(w+=l.calendarName),r.push(['<a href="#" class="schedule" title="',w,'" data-startdate="',h,'" data-calendarId="',l.calendarId,'" data-id="',f.id,'" data-duration="',1,'" data-bypass>'].join("")),l.__merged__&&l.__merged__.include_me&&r.push('<span class="chip bgcolor'+l.__merged__.color+'"></span>',"\n"),l.timeType===o.timed&&r.push(['<span class="time">',h.format("HH:mm"),"</span>"].join("")),L(l)?(r.push(['<span class="chip bgcolor',c,'"></span>'].join("")),r.push(['<span class="info">',l.summary,"</span>",'<span class="name">(',l.creator.name,")</span>"].join(""))):r.push(["<span>",l.summary,"</span>"].join("")),r.push("</a>"),r.push("</div>")}return r.push("</li>"),r.join("\n")}},n.__instance__=null,n.create=function(){return this.__instance__===null&&(this.__instance__=new n),this.__instance__},n.release=function(){var e=this.create();e.remove(),this.__instance__=null},n}(),tt=function(){var n="calendar_month",r="calbean-monthly",i,s,u=function(e){this.options=_.clone(e),this.matrix=new T(this.options),this.rowCount=this.matrix.getRowCount(),this.maxRows=e.maxRows,this.undelegateEvents(),this.delegateEvents()};return u.prototype={render:function(){var e=[];return this.maxRows=Math.floor(this.options.height/this.rowCount/22)-2,e.push(this._buildTableHeader()),e.push(this._buildMonthBody()),M.empty().html(e.join("\n")),this._resetClass(this,E.m),this._resize(this.options.height),this.options.useAttendeeFetch&&N.call(this,M),this._bindDND(),this},_bindDND:function(){var t=M.find("table.bg_row td").first().width();M.find(".draggable").draggable({containment:".month_body",cursor:"move",appendTo:".month_body",revert:"invalid",cursorAt:{left:t/2,top:10},helper:function(n){var r=e(this).clone();return r.width(t),r.addClass("dragged"),r},start:function(){var t=e(this),n=t.find("a").data("id");e(".ev-"+n).css("opacity",.7)},stop:function(t,n){var r=e(n.helper.context).data("promise"),i=e(this),s=i.find("a").data("id");typeof r===undefined?e(".ev-"+s).css("opacity",1):r.done(function(){e(".ev-"+s).css("opacity",1)})}}),M.find("table.bg_row td").droppable({accept:".draggable",tolerance:"intersect",drop:function(t,n){var r=e(n.draggable).find("a"),i=r.data("id"),s=r.data("calendarid"),o=r.data("startdate"),u=e(this).data("date");e(this).removeClass("on");if(!g(o,u)){var a=n.draggable.data("promise"),f=function(){M.trigger(l.changed_date,[i,s,u,e(n.draggable)])};typeof a===undefined?f():a.done(function(){f()})}},over:function(t,n){e(this).addClass("on")},out:function(t,n){e(this).removeClass("on")}})},delegateEvents:function(){return M.on(l.change_view_type+"."+r,e.proxy(this._resetClass,this)),M.on("click."+r,"table.bg_row, table.schedule_row th, table.schedule_row th note, table.schedule_row td:empty",e.proxy(this._requestCreateEvent,this)),M.on("click."+r,"table.schedule_row span.day",function(t){var n=e(t.target);M.trigger(l.changed_view_type,[E.d,n.parent().attr("data-date")])}),M.on("click."+r,"a.btn_schedule_more",e.proxy(this._showMoreEvent,this)),M.on("mousedown."+r,"table.bg_row, table.schedule_row th, table.schedule_row th note, table.schedule_row td:empty",e.proxy(function(t){this._initDragValue(!0);if(!this._isDefaultMouseButton(t))return;i=e(t.target).attr("data-date")||e(t.target).parent().attr("data-date"),M.find("td.dt"+i).addClass("conti_schedule")},this)),M.on("mouseup."+r,"table.bg_row, table.schedule_row th, table.schedule_row th note, table.schedule_row td",e.proxy(this._createEventByDragEvent,this)),M.on("mouseover."+r,"table.bg_row, table.schedule_row th, table.schedule_row th note, table.schedule_row td",e.proxy(this._sameWeekdayByDragEvent,this)),M.on("mouseout."+r,"table.bg_row, table.schedule_row th, table.schedule_row th note, table.schedule_row td",e.proxy(this._sameWeekdayByDragEvent,this)),this},_createEventByDragEvent:function(t){if(!this._isDefaultMouseButton(t)){this._initDragValue(!0);return}var n=this._getDataDate(e(t.target));s=_.isEmpty(s)?n:s;if(!this._validateByDragRegistration()||_.isEmpty(n)){console.info("Skip1 Event, DRAG_DOWN_DATE: "+i),this._initDragValue(!0);return}if(!this._isSameWeekdayAndAfter(n)){if(!this._isSameWeekdayAndAfter(s)){console.info("Skip2 Event, DRAG_DOWN_DATE: "+i),this._initDragValue(!0);return}n=s}var r=GO.util.isAfterOrSameDate(i,n),u=r?i:n,a=r?n:i,f=GO.util.toMoment(a).startOf("day").diff(GO.util.toMoment(u).startOf("day"),"days");for(var c=0;c<f;c++){var h=GO.util.shortDate(GO.util.toMoment(u).add("days",c+1));M.find("td.dt"+h).addClass("conti_schedule")}M.trigger(l.request_create_event,[o.timed,u,null,a]),this._initDragValue(!1)},_painting:function(e){var t=this._getSameWeekdayDates().sort();_.each(t,function(t){GO.util.isAfterOrSameDate(i,t)&&GO.util.isAfterOrSameDate(t,e)&&M.find("td.dt"+t).addClass("conti_schedule")})},_restorePainting:function(e){M.find("td.dt"+e).removeClass("conti_schedule")},_sameWeekdayByDragEvent:function(t){if(!i||!this._isDefaultMouseButton(t))return!1;s||(s=i);var n=this._getDataDate(e(t.target));_.isEmpty(n)&&(e.goError(A["\ub4f1\ub85d\ud560 \uc218 \uc5c6\ub294 \uc77c\uc815 \uacbd\uace0"]),this._initDragValue(!0)),this._isSameWeekdayAndAfter(n)&&(GO.util.isAfterOrSameDate(s,n)?this._painting(n):this._restorePainting(s),s=n)},_initDragValue:function(t){i="",s="",t&&e(".ui-droppable").removeClass("conti_schedule")},_getDataDate:function(e){if(e.attr("data-date"))return e.attr("data-date");var t="";return e.parents().each(function(e,n){n.getAttribute("data-date")&&(t=n.getAttribute("data-date"))}),t},_getSameWeekdayDates:function(){if(!this._validateByDragRegistration())return[];var e=_.map(M.find("td.dt"+i).siblings(),function(e){return e.getAttribute("data-date")});return e.push(i),e},_isSameWeekdayAndAfter:function(e){return this._validateByDragRegistration()&&!GO.util.isAfter(e,i)&&_.contains(this._getSameWeekdayDates(),e)},_validateByDragRegistration:function(){return!_.isEmpty(i)},_isDefaultMouseButton:function(e){return!_.isUndefined(e.button)&&0==e.button},undelegateEvents:function(){return M.off("."+r),this},_showMoreEvent:function(t){t.preventDefault();var n=e(t.currentTarget),r=n.parent().attr("data-date"),i=this.matrix.getCellByDate(r),s=et.create();return s.render(t,r,i.events,this.options),t.stopImmediatePropagation(),this},_resetClass:function(e,t){return t===E.m?M.addClass(n):M.removeClass(n),this},_bindResizeJSEvent:function(e,t){return this._resize(t),this},_resize:function(e){var t=Math.floor((e-M.find(".tb_month_header").outerHeight())/this.rowCount);return M.find(".week_schedule").height(t),this},_requestCreateEvent:function(t){var n=e(t.target),r=n.attr("data-date")||n.parent().attr("data-date");r&&M.trigger(l.request_create_event,[o.timed,r])},_buildTableHeader:function(){var e=[],t=this.matrix.getRow(0);e.push('<table class="type_normal tb_month_header tb_fix">',"<thead><tr>","\n");for(var n=0,r=t.length;n<r;n++){var i=t[n].day,s=w[i],o=[];i===0&&o.push("sun"),i===6&&o.push("sat"),e.push('<th class="',o.join(" "),'">',s,"</th>","\n")}return e.push("</tr></thead>","</table>"),e.join("")},_buildMonthBody:function(){var e=[];e.push('<div class="month_body">');for(var t=0,n=this.matrix.getRowCount();t<n;t++){var r=this.matrix.getRow(t);e.push('<div class="week_schedule">'),e.push(this._buildWeekBgCells(r)),e.push(this._buildWeekScheduleRows(r)),e.push("</div>")}return e.push("</div>"),e.join("\n")},_buildWeekBgCells:function(e){var n=[];n.push("<tr>");for(var r=0,i=e.length;r<i;r++){var s=e[r],o=t(s.instance).format("YYYY-MM-DD"),u=["dt"+o];s.today&&u.push("today"),n.push('<td class="',u.join(" "),'" data-date="',o,'"></td>',"\n")}return n.push("</tr>"),this._tableRowDecorator(n.join(""),"bg_row")},_buildWeekScheduleRows:function(e){var t=[];return t.push(this._buildWeekHeaders(e)),t.push(this._buildWeekEvents(e)),this._tableRowDecorator(t.join(""),"schedule_row")},_buildWeekHeaders:function(e){var n=[],r=e.length;n.push("<tr>");for(var i=0;i<r;i++){var s=e[i],o=t(s.instance).format("YYYY-MM-DD"),u=this._generateClassesOfWeekHeaders(s,this.options.date);n.push('<th class="',u.join(" "),'" data-date="',o,'">',"\n"),n.push('<span class="day">',s.date,"</span>","\n"),n.push(this._buildFlaggedEvent(s.flags)),n.push("</th>","\n")}return n.push("</tr>"),n.join("")},_buildWeekEvents:function(e){var t=new Z(e);return t.setLimit(this.maxRows),t.build()},_hasFlagType:function(e,t){if(!f[t])return!1;for(var n=0,r=e.length;n<r;n++)if(b(GO.util.toMoment(GO.util.dateFormatWithoutTimeZone(e[n]._ref.startTime)),this.options.date)&&e[n].type===f[t])return!0;return!1},_hasHolidayFlag:function(e){return this._hasFlagType(e,"holiday")},_generateClassesOfWeekHeaders:function(e,n){var r=[],i=t(n).month();return e.month===i&&e.day===0&&r.push("sun"),e.month===i&&e.day===6&&r.push("sat"),e.flags.length>0&&r.push("holiday_"+(this._hasHolidayFlag(e.flags)?"on":"off")),e.month<i&&r.push("before"),e.month>i&&r.push("next"),e.today&&r.push("today"),r},_buildFlaggedEvent:function(e){var t=[],n=[];if(e.length<1)return"";for(var r=0,i=e.length;r<i;r++){var s=e[r];!s.summary||n.push(s.summary)}return n.length>0&&t.push('<span title="',n.join(", "),'" class="note">',n.join(", "),"</span>","\n"),t.join("")},_tableRowDecorator:function(e,t){typeof t=="undefined"&&(t=""),t!==""&&(t+=" ");var n=[];return n.push('<table class="',t,'tb_fix"><tbody>',"\n"),n.push(e,"\n"),n.push("</tbody></table>"),n.join("")}},u}(),nt=function(){var n=12,r=60/n,a=r,f=15,c="calendar_week",h="calbean-timeline",b=function(e,n){typeof n=="undefined"&&(n=e),this.__range={from:new Date,to:new Date};if(!d(e,n))throw new p;this.startday=0,this.__range.from=t(e).clone().toDate(),this.__range.to=t(n).clone().toDate(),this.__duration=this._computeDuration(this.__range.from,this.__range.to),this.__scrollTop=-1,this.matrix=new T({date:this.__range.from,width:this.__duration}),M.addClass(c),this.undelegateEvents(),this.delegateEvents()};return b.prototype={buildSkelecton:function(){var e=[],t=0;e.push(this._buildTimelineHeader()),e.push(this._buildTimelineBody()),M.empty().html(e.join("\n")),this._resize(i.height),this._scrollTo(),t=M.find("div.day_schedule table.schedule_row tr.row").length*19,M.find("div.day_schedule table.bg_row tr").height(t),M.find("div.day_schedule table.bg_row th").height(t)},render:function(n){var i=this;this.buildSkelecton(),n.useAttendeeFetch&&N.call(this,M);if(this.__duration>1){var s=M.find("table.schedule_row td").last().width();M.find("table.schedule_row .draggable").draggable({containment:"table.schedule_row tbody",cursor:"move",appendTo:"#calendar-viewport",revert:"invalid",cursorAt:{left:s/2,top:10},helper:function(t){var n=e(this).clone();return n.width(s),n.addClass("dragged"),n},start:function(){var t=e(this),n=t.find("a").attr("data-id");e(".ev-"+n).css("opacity",.7)},stop:function(){var t=e(this),n=t.find("a").data("id");e(".ev-"+n).css("opacity",1)}}),M.find("div.day_schedule table.bg_row td").droppable({greedy:!0,accept:"table.schedule_row .draggable",tolerance:"intersect",drop:function(t,n){var r=e(n.draggable).find("a"),i=r.data("id"),s=r.data("calendarid"),o=r.data("startdate"),u=e(this).data("date");e(this).removeClass("on"),g(o,u)||M.trigger(l.changed_date,[i,s,u,null])},over:function(t,n){e(this).addClass("on")},out:function(t,n){e(this).removeClass("on")}})}var o=0,u=e(".schedule_wrap").first().outerWidth();return M.find(".schedule_wrap .draggable").draggable({containment:".timeline_wrap",cursor:"move",appendTo:".timeline_wrap",revert:"invalid",grid:[e(".schedule_wrap").first().outerWidth()+21,f],drag:function(n,r){var i=r.offset.top,s=i-o,u=Math.abs(s)+5;if(u>f){var a=e(this),l=t(a.attr("data-starttime")),c=t(a.attr("data-endtime")),h=c.diff(l,"minutes"),p=l.clone().startOf("days"),d=Math.ceil(r.position.top+1),v=p.add("minutes",d),m=v.clone().add("minutes",h);e(this).find(".time").text(v.format("HH:mm")),e(this).attr("data-starttime",v.format("YYYY-MM-DDTHH:mm:ss.SSSZ")),e(this).attr("data-endtime",m.format("YYYY-MM-DDTHH:mm:ss.SSSZ")),o=+parseInt(i)}},start:function(t,n){var r=e(this).width(),s=parseInt(e(this).css("left")||"0")>0?e(this).width():u+16;i.preventClickEvent(),e(this).click(function(){return!1}),o=+parseInt(n.offset.top),e(this).css({width:s,opacity:.8,"z-index":"100"}),e(this).attr({"data-org-starttime":e(this).data("starttime"),"data-org-width":r})},stop:function(){e(this).css({width:e(this).attr("data-org-width"),opacity:1,"z-index":"auto"}),e(this).removeAttr("data-org-starttime").removeAttr("data-org-width"),o=0}}),M.find(".tb_week_body tr.cols td").droppable({greedy:!0,accept:".schedule_time",tolerance:"intersect",drop:function(n,r){var i=e(r.draggable),s=i.attr("data-id"),o=i.attr("data-calendarid"),u=i.attr("data-org-starttime"),a=t(i.attr("data-starttime")),f=t(i.attr("data-endtime")),c=f.diff(a,"minutes"),h=e(this).data("date"),p=[h,"T",a.format("HH:mm:ss.SSSZ")].join(""),d=t(p).clone().add("minutes",c).format("YYYY-MM-DDTHH:mm:ss.SSSZ");t(d).format("HH:mm:ss")==="00:00:00"&&(d=t(d).subtract("seconds",1).format("YYYY-MM-DDTHH:mm:ss.SSSZ")),t(u).valueOf()!==t(p).valueOf()&&i.attr({"data-starttime":p,"data-endtime":d}),M.trigger(l.changed_time,[s,o,p,d,M.find("div.week_body_wrap").scrollTop()])}}),M.find(".schedule_wrap .resizable").resizable({containment:"parent",handles:{s:".resize"},grid:a,minHeight:a,autoHide:!0,start:function(e,t){i.preventClickEvent()},stop:function(n,i){var s=e(this),o=s.attr("data-id"),u=s.attr("data-calendarId"),f=s.attr("data-starttime"),c=s.attr("data-endtime"),h=r*Math.ceil(s.outerHeight()/a),p=t(f).add("minutes",h).format("YYYY-MM-DDTHH:mm:ss.SSSZ");t(p).format("HH:mm:ss")==="00:00:00"&&(p=t(p).subtract("seconds",1).format("YYYY-MM-DDTHH:mm:ss.SSSZ")),M.trigger(l.changed_time,[o,u,f,p,M.find("div.week_body_wrap").scrollTop()])}}),this},scrollTo:function(e){this.__scrollTop=e},preventClickEvent:function(e){M.off(".calbean-timeline")},delegateEvents:function(){return M.on("click."+h,"div.schedule_time",B),M.on(l.change_view_type+"."+h,e.proxy(this._resetClass,this)),M.on("click."+h,"td.cell:not(:has(div.schedule_day))",e.proxy(this._createEventFromAlldayEvent,this)),M.on("click."+h,".timeline_wrap",e.proxy(this._createEventFromTimelineWrap,this)),M.on("click."+h,".schedule_wrap",e.proxy(this._createEventFromScheduleWrap,this)),M.on("mouseover."+h,".resizable",function(t){e(t.currentTarget).find(".resize").show()}),M.on("mouseleave."+h,".resizable",function(t){e(t.currentTarget).find(".resize").hide()}),this},undelegateEvents:function(){return M.off("."+h),this},setEvents:function(e){return this.matrix.resetEvents(e),this},resetEvents:function(e){this.matrix.resetEvents(e),this.render()},setStartday:function(e){this.matrix.setStartday(e)},_resetClass:function(t,n){e.inArray(n,[E.w,E.d])>-1?M.addClass(c):M.removeClass(c)},_bindResizeJSEvent:function(e,t){this._resize(t)},_createEventFromAlldayEvent:function(t){return M.trigger(l.request_create_event,[o.allday,e(t.currentTarget).attr("data-date")]),this},_createTimedEvent:function(e,t){var n=this._computeTimeFromTimeline(e,t),r=n.startTime,i=n.endTime;return M.trigger(l.request_create_event,[o.timed,r.format("YYYY-MM-DD"),r.format("HH:mm"),i.format("YYYY-MM-DD"),i.format("HH:mm")]),this},_createEventFromScheduleWrap:function(t){return this._createTimedEvent(t,e(t.currentTarget).attr("data-date"))},_createEventFromTimelineWrap:function(n){var r=e(n.currentTarget),i=r.outerWidth(),s=r.offset(),o=n.pageX-s.left,u=i/this.__duration,a=Math.floor(o/u),f=t(this.__range.from).clone().add("days",a).format("YYYY-MM-DD");return this._createTimedEvent(n,f)},_computeTimeFromTimeline:function(n,i){i=i||new Date;var s=t(i).clone().startOf("days"),o=e(n.currentTarget).offset(),u=n.pageY-o.top,f=Math.floor(u/a)*r,l=s.add("minutes",f),c=l.clone().add("hours",1);return{startTime:l,endTime:c}},_resize:function(e){var t=e-M.find(".tb_week_header").outerHeight()-M.find(".day_schedule").outerHeight();return M.find(".timeline-scrollfix").width(M.find(".week_body_wrap").width()-M.find(".tb_week_body").width()),M.find(".week_body_wrap").height(t),this},_scrollTo:function(){var t=M.find("div.week_body_wrap"),n=t.innerHeight(),r;if(this.__scrollTop>-1)r=this.__scrollTop;else{var i=M.find("#current-timeline"),s=i.position().top;s<550?r=e(".timeline_wrap div[data-time='07:00:00']").position().top:r=s-n/2}return r>0&&M.find("div.week_body_wrap").scrollTop(r),this},_computeDuration:function(e,n){var r=t(e).clone().startOf("day"),i=t(n).clone().endOf("day");return x(r,i)},_buildTimelineHeader:function(){var e=[];return e.push(this._buildWeekHeader()),e.push('<div class="day_schedule">'),e.push(this._buildRangeEventBgCells()),e.push('<table class="schedule_row tb_fix">'),e.push("<tbody>"),e.push(this._buildRangeEvents()),e.push("</tbody>"),e.push("</table>"),e.push("</div>"),e.join("\n")},_buildWeekHeader:function(){var e=[],n=t(this.__range.from).clone();e.push('<table class="tb_week_header tb_fix">'),e.push('<thead class="type_normal">'),e.push("<tr>"),e.push("<th>"+A["\uc2dc\uac04"]+"</th>");for(var r=0;r<this.__duration;r++){var i=[],s=n.format("MM.DD(ddd)");v(n)&&i.push("sun"),m(n)&&i.push("sat"),y(n)&&i.push("today"),e.push(["<th",i.length>0?[' class="',i.join(" "),'"'].join(""):"",'><span class="day">',s,"</span></th>"].join("")),n.add("days",1)}return e.push(Y("th")),e.push("</tr>"),e.push("</thead>"),e.push("</table>"),e.join("\n")},_buildRangeEventBgCells:function(){var e=[],n=t(this.__range.from).clone();e.push('<table class="bg_row tb_fix">'),e.push("<tbody>"),e.push("<tr>"),e.push("<th></th>");for(var r=0;r<this.__duration;r++)e.push('<td data-date="'+n.format("YYYY-MM-DD")+'"></td>'),n.add("days",1);return e.push(Y()),e.push("</tr>"),e.push("</tbody>"),e.push("</table>"),e.join("\n")},_buildRangeEvents:function(){var e=this.matrix.getAxis(this.__range.from),t=this.matrix.getRow(e.x),n=new Z(t);return n.setType("timeline"),n.addClass("tr","row"),n.addClass("td","cell"),n.build()},_buildTimelineBody:function(){var e=[];return e.push('<div class="week_body_wrap">'),e.push('<table class="tb_week_body tb_fix">'),e.push("<tbody>"),e.push(this._buildTimelineBgGrid()),e.push(this._buildTimelineEvents()),e.push("</tbody>"),e.push("</table>"),e.push("</div>"),e.join("\n")},_buildTimelineBgGrid:function(){var e=[],n=t(new Date).startOf("days");e.push('<tr style="height: 1px">'),e.push('<th style="width: 70px; height: 0"></th>'),e.push(['<td class="time_wrap"',this.__duration>1?' colspan="'+this.__duration+'"':"",">"].join("")),e.push('<div class="timeline_wrap">');for(var r=0;r<48;r++)e.push('	<div class="timeline" data-time="'+n.format("HH:mm:ss")+'"></div>'),n.add("minutes",30);return e.push("</div>"),e.push("</td>"),e.push("</tr>"),e.join("\n")},_buildTimelineEvents:function(){var e=[];return e.push('<tr class="cols">'),e.push("<th>"),e.push(this._buildTimelineLabel()),e.push("</th>"),e.push(this._buileTimelineEventCols()),e.push("</tr>"),e.join("\n")},_buildTimelineLabel:function(){var e=[],n=[],r=t().startOf("days"),i={am:r.clone().hours(1).format("A"),pm:r.clone().hours(12).format("A")};n[0]=["<span>",i.am,"</span> "].join(""),n[12]=["<span>",i.pm,"</span> "].join(""),e.push('<div class="time_wrap">');for(var s=0;s<24;s++)e.push(['	<div class="time">',n[s],r.format("hh"),"</div>"].join("")),r.add("hours",1);return e.push(this._buildFlagOfCurrentTime()),e.push("</div>"),e.join("\n")},_buildFlagOfCurrentTime:function(){var e=t(new Date),n=e.clone().startOf("days"),r=Math.ceil(e.diff(n,"minutes",!0)/parseInt(1));return['<div id="current-timeline" class="real_time" style="top: ',r,'px; left: 0px"></div>'].join("")},_getOffsetYByDate:function(e){var n=t(e),r=n.clone().startOf("days");return Math.ceil(n.diff(r,"minutes",!0))},_buileTimelineEventCols:function(){var e=[],n=this.matrix.getRowByDate(this.__range.from);for(var r=0,i=n.length;r<i;r++){var s=n[r],o=s.instance,u=t(o).format("YYYY-MM-DD"),a=s.events;e.push(["<td",y(o)?' class = "today"':"",' data-date="',u,'"',">"].join("")),a.length>0&&e.push('<div class="schedule_wrap" data-date="'+u+'">'),e.push(this._buildScheduleTimeDiv(a)),a.length>0&&e.push("</div>"),e.push("</td>")}return e.join("\n")},_buildScheduleTimeDiv:function(e){if(e.length<1)return"";var t=[],n=this._getTimelineEvents(e);for(var r in n){var i=n[r],o=i._ref,a=i.summary,f="",l=["schedule_time"],c=Q(o.visibility)?G():"";l.push("draggable","resizable"),i.width=this._getPercetageValue(100/i.concurrent,"floor",1),i.left=i.hindex*i.width,i.width=i.isLastIndex&&i.concurrent>i.hindex?i.width*(i.concurrent-i.hindex):i.width,o.__merged__?l.push(u[s.day]+"_group"):l.push(u[s.day]+o.color),f=["top:",i.top,"px;","left:",i.left,"%;","width:",i.width,"%;","height:",i.height,"px"].join(""),t.push('<div class="',l.join(" "),'" style="',f,'" data-id="',r,'" data-calendarId="',o.calendarId,'" data-startTime="',o.startTime,'" data-endTime="',o.endTime,'">',"\n"),t.push('<p class="head">'),o.__merged__&&o.__merged__.include_me&&t.push('<span class="me bgcolor'+o.__merged__.color+'"></span>'),t.push(K(o.startTime)),t.push("</p>"),t.push('<p class="content" title="',a," ; ",'">',c,a,"</p>"),t.push('<div class="resize ui-resizable-handle ui-resizable-s"></div>'),t.push("</div>")}return t.join("")},_getPercetageValue:function(t,n,r){r=r||0,n=n||"round";if(e.inArray(n,["ceil","round","floor"])===-1)throw new Error("Illegal type.");var i=Math.pow(10,r);return Math[n].call(Math,t*i)/i},_getSlotIndexByDate:function(e){return Math.ceil(this._getOffsetYByDate(e)/r)},_getTimelineEvents:function(n){var r={},i=new Array(48);for(var s=0,o=n.length;s<o;s++){if(!n[s])continue;var u=n[s],f=u._ref,l=t(f.startTime),c=this._getSlotIndexByDate(f.startTime),h=this._getSlotIndexByDate(f.endTime),p=h-c;if(J(f,u.range))continue;u.top=l.hour()*60+l.minute()-1,u.height=(p===0?1:p)*a,r[u.id]=u;if(p>0)for(var d=c;d<h;d++)this._createTimeslot(i,u.id,d);else this._createTimeslot(i,u.id,c)}var v=0;for(var d=0,o=i.length;d<o;d++){if(!i[d])continue;var m=i[d].length,g=[];for(var y=0;y<m;y++)g[y]=0;if(m>0)for(var b=0;b<m;b++){var u=r[i[d][b]];v<m&&(v=m),typeof u.hindex=="undefined"&&(u.hindex=e.inArray(0,g)),g[u.hindex]=u.id,u.hindex+1==g.length?typeof u.isLastIndex=="undefined"&&(u.isLastIndex=!0):u.isLastIndex=!1}}for(var w in r){var u=r[w];u.concurrent=v}return r},_createTimeslot:function(e,t,n){return e[n]||(e[n]=[]),e[n].push(t),this}},b}(),rt=function(){var e=function(e){var n=t(e.date).clone(),r=new nt(n);r.setEvents(e.events),r.setStartday(e.startday),this.timlineView=r,this.options=e};return e.prototype.render=function(){this.timlineView.scrollTo(this.options.scrollTo),this.timlineView.render(this.options)},e}(),it=function(){var e=function(e){var n=t(e.date).clone(),r=n.clone().day(0).add("days",e.startday),i=n.clone().day(6).add("days",e.startday),s=new nt(r,i);s.setEvents(e.events),s.setStartday(e.startday),this.timlineView=s,this.options=e};return e.prototype.render=function(){this.timlineView.scrollTo(this.options.scrollTo),this.timlineView.render(this.options)},e}();O.getElement=function(){return M},O.bind=O.on=function(){var t=r.call(arguments);e.fn.on.apply(M,t)},O.unbind=O.off=function(){var t=r.call(arguments);e.fn.off.apply(M,t)},O.resize=function(e){return M.trigger(l.resize,[e]),this},O.changeViewType=function(e){return M.trigger(l.change_view_type,[e]),this},O.changeDate=function(e,t){return M.trigger(l.change_date,[e,t]),this},O.updateCalendarColor=function(e,t){return M.trigger(l.update_calendar_color,[e,t]),this},O.addEvents=function(){var e=r.call(arguments),t=[];for(var n=0,i=e.length;n<i;n++)e[n]instanceof Array?t=t.concat(e[n]):t.push(e[n]);return M.trigger(l.add_events,[t]),this},O.resetEvents=function(e,t){return t=t||!1,M.trigger(l.reset_events,[e,t]),this},O.clearEvents=function(){return M.trigger(l.clear_events),this},O.removeCalendars=function(){var e=r.call(arguments),t=[];for(var n=0,i=e.length;n<i;n++)t.push(e[n]);M.trigger(l.remove_calendars,[t])},O.render=function(e,t){i.lazy&&st(e,t)};var st=function(t,n){typeof t!="undefined"&&t instanceof Array&&(i.events=i.events.concat(t)),e.extend(!0,i,n||{}),P();switch(i.type){case E.d:(new rt(i)).render();break;case E.w:(new it(i)).render();break;case E.m:(new tt(i)).render();break;default:return new Error("Illegal view type")}},ot=function(){D(),i.lazy||st()};return ot(),O};var N=function(t){t.find(".draggable").on("mouseenter",e.proxy(function(t){var n=e(t.currentTarget);if(n.attr("is-init"))return;var r=n.attr("data-id")?n:n.find("[data-id]"),i=r.attr("data-id"),s=r.attr("data-calendarid"),o=e.Deferred();n.data("promise",o),A(s,i).done(e.proxy(function(e){C(n,e.data,o)},this)).fail(function(){k(o)}),n.attr("is-init",!0)},this))},C=function(e,t,n){var r=_.map(t.attendees,function(e){return e.name}).join(","),i=_.where(t.attendees,{id:GO.session("id")}).length>0;t.auth=t.auth||i;if(!t.auth||L(t))e.hasClass("draggable")&&(e.removeClass("draggable"),e.draggable().draggable("destroy")),e.hasClass("resizable")&&(e.removeClass("resizable"),e.resizable("destroy"));e.data("event",t),n.resolve();var s=e.find("[title]");t.type=="normal"&&(t.visibility=="private"&&t.auth||t.visibility=="public")?s.attr("title",s.attr("title")+r):s.attr("title",s.attr("title"))},k=function(e){e.resolve()},L=function(e){return e.referenceId?!0:!1},A=function(t,n){return e.ajax({url:GO.contextRoot+"api/calendar/"+t+"/event/"+n,contentType:"application/json"})}}).call(this,jQuery,moment);