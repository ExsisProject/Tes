define("views/notification/item",function(require){var e=require("underscore"),t=require("backbone"),n=require("app"),r=require("hgn!templates/notification/item"),i=require("i18n!nls/commons"),s=t.View.extend({itemDeleted:!0,tagName:"li",tmplData:null,targetLinkUrl:null,events:{"click .btn_wrap":"deleteLink"},initialize:function(){this.tmplData={profile:this._getProfile(),targetLinkUrl:this._goTargetLinkUrl(),companyName:this._getCompanyName(),createdAt:n.util.snsDate(this.model.get("createdAt")),label:{more:i["\uc790\uc138\ud788 \ubcf4\uae30"],"delete":i["\uc0ad\uc81c"]}}},render:function(){var t=r(e.extend({},this.model.toJSON(),this.tmplData));return this.$el.empty().html(t),this._setAsRead(),this.$el},goToShowUrl:function(){document.location=this._goTargetLinkUrl()},deleteLink:function(e){e.stopPropagation();var t=this,r=this.$el.closest("li"),s=r.find("span[id]").attr("id");t.itemDeleted&&(t.itemDeleted=!1,$.ajax({url:n.config("contextRoot")+"api/my/noti/"+s,type:"DELETE",dataType:"json",success:function(){r.remove(),$.goMessage(i["\uc0ad\uc81c\ub418\uc5c8\uc2b5\ub2c8\ub2e4."]),t.itemDeleted=!0},error:function(){$.goMessage(i["\uc2e4\ud328\ud588\uc2b5\ub2c8\ub2e4."])}}))},_goTargetLinkUrl:function(){var e=this.model.get("linkUrl"),t=this.model.get("companyId"),r=n.session().companies,i=null;for(var s in r)t===s.id&&(i=location.protocol+"//"+s.siteUrl,location.port&&(i+=":"+location.port),i+=n.contextRoot+"tokenlogin?",i+=$.param({token:this._getCookie("GOSSOcookie"),companyId:parseInt(n.session("companyId"))==parseInt(t)?null:t,returnUrl:e}));return i||e},_getCookie:function(e){var t="; "+document.cookie,n=t.split("; "+e+"=");return n.length==2?n.pop().split(";").shift():""},_getProfile:function(){var e="resources/images/photo_my.jpg";return this.model.get("profile")||e},_getCompanyName:function(){var e=this.model.get("companyId"),t,r=n.session().companies,i=n.session().integratedCompanies.length;if(i>1)for(var s in r)e===s.id&&(t=s.companyName+" > ");else t="";return t},_setAsRead:function(){this.model.get("readAt")&&this.$el.addClass("read")}});return s});