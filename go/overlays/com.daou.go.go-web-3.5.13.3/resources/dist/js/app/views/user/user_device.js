(function(){define(["jquery","backbone","app","models/mobile_config","hgn!templates/user/user_device","i18n!nls/commons","i18n!nls/user"],function(e,t,n,r,i,s,o){var u=t.Model.extend({initialize:function(e){this.id=e.id},url:function(){return GO.contextRoot+"api/mobile/device/"+this.id}}),a=t.Collection.extend({url:GO.contextRoot+"api/mobile/device",model:u}),f=t.View.extend({CLASS:{BLOCKED:"ic_ctrl_off",ALLOWED:"ic_ctrl_on"},tagName:"table",className:"type_normal tb_sub tb_mam",initialize:function(e){this.mamDeviceCollection=new a,this.$appendTarget=e.$appendTarget},render:function(){this.mamDeviceCollection.fetch().done(e.proxy(this._renderList,this)).fail(function(){e.goAlert(s["500 \uc624\ub958\ud398\uc774\uc9c0 \ud0c0\uc774\ud2c0"])})},_renderList:function(){this.$el.html(this._makeListTemplate().render(this._makeListData())),this.$appendTarget.html(this.$el),this._bindEvents()},_makeListTemplate:function(){var e=[];return e.push("    <thead>"),e.push("        <tr>"),e.push('            <th class="device">{{lang.deviceName}}</th>'),e.push('            <th class="time">{{lang.lastAccessTime}}</th>'),e.push('            <th class="contact">{{lang.accessSetting}}'),e.push('                <span class="help"><span class="tool_tip top">'),e.push("                    <strong>{{lang.on}}</strong> {{lang.on_desc}} <br><br>"),e.push("                    <strong>{{lang.off}}</strong> {{lang.off_desc}}"),e.push('                    <i class="tail_top"></i>'),e.push("                </span></span>"),e.push("            </th>"),e.push("            <th></th>"),e.push("        </tr>"),e.push("    </thead>"),e.push('    <tbody id="device_list_table_body">'),e.push("        {{^data.deviceList}}"),e.push('        <tr class="topMenu">'),e.push('            <td colspan="4">'),e.push('                <p class="data_null">'),e.push('        			<span class="ic_data_type ic_no_data"></span>'),e.push('        			<span class="txt">{{data.noAccessDevice}}</span>'),e.push("                </p>"),e.push("            </td>"),e.push("        </tr>"),e.push("        {{/data.deviceList}}"),e.push("        {{#data.deviceList}}"),e.push('        <tr class="topMenu" data-id={{id}}>'),e.push('            <td class="device" name="name">{{deviceName}}</td>'),e.push('            <td class="time" name="contact">{{lastAccessTime}}</td>'),e.push('            <td class="contact mam_toggle" name="toggle">'),e.push('                <span class="device_access_setting ic_control {{deviceAccessOnOff}}"></span>'),e.push("            </td>"),e.push('            <td class="mam_delete" name="delete">'),e.push('                <span class="device_access_delete ic_side ic_basket_bx" title="{{lang.del}}"></span>'),e.push("            </td>"),e.push("        </tr>"),e.push("        {{/data.deviceList}}"),e.push("    </tbody>"),Hogan.compile(e.join("\n"))},_makeListData:function(){var e={del:s["\uc0ad\uc81c"],deviceName:s["\uae30\uae30\uba85"],accessSetting:s["\uc811\uc18d\uc124\uc815"],lastAccessTime:s["\ub9c8\uc9c0\ub9c9 \uc811\uc18d\uc2dc\uac04"],on:s["\uc811\uc18d\uc124\uc815 ON"],on_desc:s["\uc811\uc18d\uc124\uc815 ON \uc124\uba85"],off:s["\uc811\uc18d\uc124\uc815 OFF"],off_desc:s["\uc811\uc18d\uc124\uc815 OFF \uc124\uba85"]},t={noAccessDevice:o["\ub4f1\ub85d\ub41c \ubaa8\ubc14\uc77c \uae30\uae30 \uc815\ubcf4\uac00 \uc5c6\uc2b5\ub2c8\ub2e4."],deviceList:[]};return t.deviceList=this.mamDeviceCollection.map(function(e){return{id:e.get("id"),deviceName:e.get("deviceLabel"),lastAccessTime:GO.util.basicDate3(e.get("lastConnected")),deviceAccessOnOff:e.get("blocked")?this.CLASS.BLOCKED:this.CLASS.ALLOWED}},this),{lang:e,data:t}},_noticeTmp:function(e,t){var n=[];return n.push('<div class="content">'),n.push('			<p class="q">'+e+"</p>"),t&&n.push('		<p class="add">'+t+"</p>"),n.push("</div>"),Hogan.compile(n.join("\n"))},_bindEvents:function(){this.$el.off("click","span.device_access_setting"),this.$el.off("click","span.device_access_delete"),this.$el.on("click","span.device_access_setting",e.proxy(this._onAccessSettingClicked,this)),this.$el.on("click","span.device_access_delete",e.proxy(this._onAccessDeleteClicked,this))},_onAccessSettingClicked:function(t){var n=this,r=e(t.currentTarget),i=r.parents("tr").attr("data-id"),o=r.hasClass(this.CLASS.BLOCKED),u,a;o?(u=s["\uc811\uc18d\ud5c8\uc6a9\uc54c\ub9bc"],a=s["\ud5c8\uc6a9\uc54c\ub9bc\ubd80\uc81c"]):(u=s["\uc811\uc18d\ucc28\ub2e8\uc54c\ub9bc"],a=s["\ucc28\ub2e8\uc54c\ub9bc\ubd80\uc81c"]),this.notiPopup=e.goPopup({pclass:"layer_confim layer_colleage",modal:!0,width:"460px",closeIconVisible:!1,contents:this._noticeTmp(u,a).render(),buttons:[{btext:s["\ud655\uc778"],btype:"confirm",autoclose:!1,callback:function(){n._accessSettingProc(i,o)}},{btext:s["\ucde8\uc18c"],btype:"cancel"}]})},_accessSettingProc:function(t,n){var r=this,i=this.mamDeviceCollection.get(t);i.set("blocked",!n),i.save().done(e.proxy(function(e){this.notiPopup.close(),this._renderList()},this))},_onAccessDeleteClicked:function(t){var n=this,r=e(t.currentTarget).parents("tr").attr("data-id"),i=s["\ub4f1\ub85d\uae30\uae30\uc0ad\uc81c"];this.delPopup=e.goPopup({pclass:"layer_confim layer_colleage",modal:!0,width:"460px",closeIconVisible:!1,contents:this._noticeTmp(i).render(),buttons:[{btext:s["\ud655\uc778"],btype:"confirm",autoclose:!1,callback:function(){n._onAccessDeleteProc(r)}},{btext:s["\ucde8\uc18c"],btype:"cancel"}]})},_onAccessDeleteProc:function(t){var n=this.mamDeviceCollection.get(t);n.destroy().done(e.proxy(function(e){this.delPopup.close(),this._renderList()},this))}}),l=t.Model.extend({url:GO.contextRoot+"api/otp/device"}),c=t.View.extend({tagName:"table",className:"type_normal tb_sub tb_mam",lang:{deviceModel:s["\uae30\uae30\uba85"],osType:s["OS \ud0c0\uc785"],registeredAt:s["OTP \ub4f1\ub85d\uc77c"]},initialize:function(e){this.$appendTarget=e.$appendTarget,this.model=new l},render:function(){this.model.fetch().done(e.proxy(function(){this.$el.html(this._makeTemplate().render(this._makeData())),this.$appendTarget.html(this.$el)},this))},_makeTemplate:function(){var e=[];return e.push("<thead>"),e.push("    <tr>"),e.push('        <th class="device">{{lang.deviceModel}}</th>'),e.push('        <th class="time">{{lang.osType}}</th>'),e.push('        <th class="contact">{{lang.registeredAt}}</th>'),e.push("    </tr>"),e.push("</thead>"),e.push('<tbody id="otp_device_list">'),e.push('    <tr class="topMenu">'),e.push('        <td class="device" name="name">{{deviceModel}}</td>'),e.push('        <td class="os_type" name="os_type">{{osType}}</td>'),e.push('        <td class="time" name="time">{{registeredAt}}</td>'),e.push("    </tr>"),e.push("</tbody>"),Hogan.compile(e.join("\n"))},_makeData:function(){return{lang:this.lang,deviceModel:this.model.get("deviceModel"),osType:this.model.get("osType"),registeredAt:GO.util.basicDate3(this.model.get("registeredAt"))}}}),h=t.View.extend({tagName:"div",className:"otp_certify",lang:{otpCertifyTitle:s["OTP \uc0ac\uc6a9\uc774 \uc124\uc815\ub41c \uacc4\uc815\uc785\ub2c8\ub2e4."],otpCertifyDesc:s["OTP \uc0ac\uc6a9 \uc124\uba85"],otpCertifyButton:s["\ubaa8\ubc14\uc77c OTP \uae30\uae30 \uc778\uc99d \uc124\uc815"]},initialize:function(e){this.$appendTarget=e.$appendTarget},render:function(){this.$el.append(this._makeTemplate().render({lang:this.lang})),this.$appendTarget.html(this.$el),this._bindEvents()},_makeTemplate:function(){var e=[];return e.push('    <img src="/resources/images/opt_certify_img.png" alt="opt image" width="290" height="200">'),e.push('    <div class="otp_certify_con">'),e.push('        <span class="otp_certify_title">{{lang.otpCertifyTitle}}</span>'),e.push('        <span class="txt">{{{lang.otpCertifyDesc}}}</span>'),e.push('        <a class="btn_major_s"><span id="otp_regist_button" class="txt">{{lang.otpCertifyButton}}</span></a>'),e.push("    </div>"),Hogan.compile(e.join("\n"))},_bindEvents:function(){this.$el.off("click","#otp_regist_button"),this.$el.on("click","#otp_regist_button",e.proxy(this._onOTPRegistButtonClicked,this))},_onOTPRegistButtonClicked:function(){document.location.href="/otpPreRegist"}}),p=t.View.extend({el:"#content",render:function(){var t=new r;t.fetch().done(e.proxy(function(){this._renderLayout({mamActive:t.isMAMEnabled(),otpActive:t.isOTPEnabled(),otpDeviceRegistered:t.isOTPDeviceRegistered()}),t.isMAMEnabled()&&this._renderMAM(),t.isOTPEnabled()&&(t.isOTPDeviceRegistered()?this._renderOTPList():this._renderRegistGuide())},this))},_renderLayout:function(e){this.$el.html(i({data:e,lang:{title:o["\ubcf4\uc548\uc124\uc815"],deviceList:o["\ub4f1\ub85d\ub41c \uae30\uae30 \uc815\ubcf4"],registNoti:o["\uc0ac\uc6a9\uae30\uae30 \ub4f1\ub85d \uc548\ub0b4"],otpDeviceListTitle:s["OTP \ubc1c\uae09 \uae30\uae30 \uc815\ubcf4"],otpDeviceListDesc:s["OTP \ubc1c\uae09 \uae30\uae30 \uc815\ubcf4 \uc124\uba85"],otpRegister:s["OTP \uc778\uc99d"]}}))},_renderMAM:function(){var e=new f({$appendTarget:this.$("#device_list_table")});e.render()},_renderOTPList:function(){var e=new c({$appendTarget:this.$("#otp_device_list")});e.render()},_renderRegistGuide:function(){var e=new h({$appendTarget:this.$("#otp_device_registration")});e.render()}});return{render:function(){var e=new p;return e.render()}}})}).call(this);