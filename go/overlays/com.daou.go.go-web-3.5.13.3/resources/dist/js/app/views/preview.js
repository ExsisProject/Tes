(function(){define(["jquery","underscore","backbone","app","i18n!nls/commons","jquery.go-popup","jquery.go-sdk"],function(e,t,n,r,i){var s=n.View.extend({tagName:"div",initialize:function(e){this.options=e||{},this.encrypt=this.options.encrypt,this.isChat=n.history.location.pathname.indexOf("chat")>=0},render:function(){var t=this.generatePreviewAttachUrl();return this.$el.append(this.makeLoadingHTML()),e.go(t,"",{qryType:"GET",contentType:"application/json",responseFn:e.proxy(this._onPreviewConvertRequestSuccess,this),error:e.proxy(this._onPreviewConvertRequestError,this)}),this},generatePreviewAttachUrl:function(){var e="/preview/attach/";return this.isChat&&(e="/chat"+e),r.contextRoot+"api"+e+this.encrypt},renderTemp:function(){var t=r.contextRoot+"api/preview/attachTemp";return this.$el.append(this.makeLoadingHTML()),e.go(t,this.options,{qryType:"GET",contentType:"application/json",responseFn:e.proxy(this._onPreviewConvertRequestSuccess,this),error:e.proxy(this._onPreviewConvertRequestError,this)}),this},makeLoadingHTML:function(){return["<div id='popOverlay' class='overlay' style='display:'>","<div class='processing'>","</div>","</div>"].join("")},_onPreviewConvertRequestSuccess:function(e){window.location.href=e.data.str},_onPreviewConvertRequestError:function(t){var n=this._mapErrorToReadableMessage(t);e.goAlert(n,"",function(){window.close()})},_mapErrorToReadableMessage:function(e){if(e.responseText){var t=JSON.parse(e.responseText).message;switch(t){case"invalid.file.extension":return i["\ubbf8\ub9ac\ubcf4\uae30 \uc2dc\uc2a4\ud15c \ubbf8\uc9c0\uc6d0 \ub610\ub294 \ubbf8\uc9c0\uc6d0 \ud655\uc7a5\uc790"];case"drm":return i["\ubbf8\ub9ac\ubcf4\uae30 DRM \ubd88\uac00"];case"encoded":return i["\ubbf8\ub9ac\ubcf4\uae30 \uc554\ud638\ud654 \ubd88\uac00"];case"unsupported":return i["\ubbf8\ub9ac\ubcf4\uae30 \ubbf8\uc9c0\uc6d0 \ud30c\uc77c"];case"timeout":return i["\ubbf8\ub9ac\ubcf4\uae30 \uc694\uccad\uc2dc\uac04 \ub9cc\ub8cc"]}}else if(e.statusText)switch(e.statusText){case"invalid.file.extension":return i["\ubbf8\ub9ac\ubcf4\uae30 \uc2dc\uc2a4\ud15c \ubbf8\uc9c0\uc6d0 \ub610\ub294 \ubbf8\uc9c0\uc6d0 \ud655\uc7a5\uc790"];case"drm":return i["\ubbf8\ub9ac\ubcf4\uae30 DRM \ubd88\uac00"];case"encoded":return i["\ubbf8\ub9ac\ubcf4\uae30 \uc554\ud638\ud654 \ubd88\uac00"];case"unsupported":return i["\ubbf8\ub9ac\ubcf4\uae30 \ubbf8\uc9c0\uc6d0 \ud30c\uc77c"];case"timeout":return i["\ubbf8\ub9ac\ubcf4\uae30 \uc694\uccad\uc2dc\uac04 \ub9cc\ub8cc"]}return i["500 \uc624\ub958\ud398\uc774\uc9c0 \ub0b4\uc6a9"]}});return s})})();