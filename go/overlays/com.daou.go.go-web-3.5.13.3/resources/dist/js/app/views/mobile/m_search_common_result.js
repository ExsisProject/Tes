define("views/mobile/m_search_common_result",function(require){var e=require("underscore"),t=require("backbone"),n=require("app"),r=null,i=t.View.extend({initialize:function(e){this.$el.off(),this.pageNo=0,this.isLastPage=!0,this.collection=e.collection==undefined?"":e.collection,this.searchOptions=e.searchOptions==undefined?"":e.searchOptions,this.renderListFunc=e.renderListFunc==undefined?"":e.renderListFunc,this.renderListMoreFunc=e.renderListMoreFunc==undefined?"":e.renderListMoreFunc},render:function(){this._resultLayerInitScroll()},_fetch:function(){this._collectionFetch().done($.proxy(function(e){this._setIsLastPage(e),this.renderListFunc(e),this._searchResultSetHeight(),this._searchInputBlur()},this))},_collectionFetch:function(){var e=$.Deferred();return this.searchOptions.page=this.pageNo,this.collection.fetch({data:this.searchOptions,success:function(t){e.resolve(t)}}),e},_resultLayerInitScroll:function(){$("#searchDetail").off("scroll.searchLayer"),$("#searchDetail").on("scroll.searchLayer",$.proxy(this._detectSearchScroll,this)),$("#searchResultWrap").css("display","block")},_detectSearchScroll:function(e){var t=$("#searchResultWrap ul");t.length==0&&(t=$("#searchResultWrap dl"));var n=$(e.currentTarget).scrollTop(),r=parseInt(n)>=$("#searchResultWrap").height()-$(window).height()-60;if(r){if(this.isLastPage)return;typeof this.renderListMoreFunc=="function"&&(this.pageNo++,this._collectionFetch().done($.proxy(function(e){this._setIsLastPage(e),e.length!==0&&this.renderListMoreFunc(e)},this)))}},_searchResultSetHeight:function(){$("input").blur().focusout(),setTimeout(function(){var e=$(window).height()-$("#searchNav").outerHeight(!0);$("#searchDetail").css("height",e)},500)},_searchInputBlur:function(){$("#detailSearchWrap input").blur()},_setIsLastPage:function(e){e.page?this.isLastPage=e.page.lastPage:this.isLastPage=e.toJSON()[0].docs.pageInfo.lastPage}});return{set:function(e){return r=new i(e),r.render()},fetch:function(){r._fetch()}}});