(function(){define(["jquery","backbone","app","admin/models/display_config","hgn!templates/user/user_profile","models/user_profile","i18n!nls/commons","i18n!admin/nls/admin","i18n!nls/user","file_upload","jquery.go-validation","jquery.go-popup","jquery.go-sdk"],function(e,t,n,r,s,o,u,a,f,l){var c={mobileNo:!0,directTel:!0,repTel:!0,fax:!0},h=t.View.extend({type:{title:f["\uae30\ubcf8\uc815\ubcf4"],goBack:f["\uc774\uc804\uc73c\ub85c"],image:u["\uc0ac\uc9c4"],imageUpload:u["\uc0ac\uc9c4 \uc62c\ub9ac\uae30"],imageUploadInfo:u["\u203b \uc0ac\uc9c4\uc740 \uc790\ub3d9\uc73c\ub85c 100x100 \uc0ac\uc774\uc988\ub85c \uc801\uc6a9 \ub429\ub2c8\ub2e4."],name:u["\uc774\ub984"],company:f["\ud68c\uc0ac"],department:f["\ubd80\uc11c"],employeeNumber:f["\uc0ac\uc6d0\ubc88\ud638"],position:f["\uc9c1\uc704"],grade:f["\uc9c1\uae09"],job:a["\uc9c1\ubb34"],email:f["\uc774\uba54\uc77c"],externalEmail:f["\uc678\ubd80 \uba54\uc77c"],phone:"Cell.",dirTel:"Dir.",repTel:"Rep.",fax:"Fax.",save:u["\uc800\uc7a5"],cancel:u["\ucde8\uc18c"],modify:u["\uc218\uc815"],saveFail:u["\uc800\uc7a5\uc5d0 \uc2e4\ud328 \ud558\uc600\uc2b5\ub2c8\ub2e4."],saveSuccess:u["\uc800\uc7a5\ub418\uc5c8\uc2b5\ub2c8\ub2e4."],deletePhoto:u["\uc0ad\uc81c"],password:f["\ube44\ubc00\ubc88\ud638"],changPassword:f["\ube44\ubc00\ubc88\ud638 \ubcc0\uacbd"],dept_desc:f["\uacb8\uc9c1\uc758 \uacbd\uc6b0 \ubd80\uc11c\uc758 \uc6b0\uc120\uc21c\uc704\ub97c \ubcc0\uacbd\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4."],label_email_invalid_msg:u["\uc774\uba54\uc77c \ud615\uc2dd\uc774 \uc62c\ubc14\ub974\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4."],label_email_my_mail:f["\ud604\uc7ac \uc774\uba54\uc77c \uc8fc\uc18c\uc640 \ub3d9\uc77c\ud569\ub2c8\ub2e4. \ub2e4\ub978 \uc8fc\uc18c\ub97c \uc785\ub825\ud574 \uc8fc\uc138\uc694"],label_max_length_msg:n.i18n(u["\ucd5c\ub300 {{arg1}}\uc790 \uae4c\uc9c0 \uc785\ub825\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4."],{arg1:"51"}),text_long_max_length_placeholder:n.i18n(u["\ucd5c\ub300 {{arg1}}\uc790 \uae4c\uc9c0\ub9cc \uc785\ub825 \uac00\ub2a5"],{arg1:"100"}),text_long_mid_length_placeholder:n.i18n(u["\ucd5c\ub300 {{arg1}}\uc790 \uae4c\uc9c0\ub9cc \uc785\ub825 \uac00\ub2a5"],{arg1:"50"}),text_short_max_placeholder:n.i18n(u["\ucd5c\ub300 {{arg1}}\uc790 \uae4c\uc9c0\ub9cc \uc785\ub825 \uac00\ub2a5"],{arg1:"20"}),text_job_short_max_placeholder:n.i18n(u["\ucd5c\ub300 {{arg1}}\uc790 \uae4c\uc9c0\ub9cc \uc785\ub825 \uac00\ub2a5"],{arg1:"150"}),text_long_max_length_msg:n.i18n(u["\ucd5c\ub300 {{arg1}}\uc790 \uae4c\uc9c0 \uc785\ub825\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4."],{arg1:"100"}),text_long_mid_length_msg:n.i18n(u["\ucd5c\ub300 {{arg1}}\uc790 \uae4c\uc9c0 \uc785\ub825\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4."],{arg1:"50"}),text_short_max_length_msg:n.i18n(u["\ucd5c\ub300 {{arg1}}\uc790 \uae4c\uc9c0 \uc785\ub825\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4."],{arg1:"20"}),text_job_short_max_length_msg:n.i18n(u["\ucd5c\ub300 {{arg1}}\uc790 \uae4c\uc9c0 \uc785\ub825\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4."],{arg1:"150"}),verify_ok:f["\uc778\uc99d \uc644\ub8cc"],verify_mail_desc:f["\u203b \ubc1c\uc1a1\ub41c \uc778\uc99d \uba54\uc77c\uc744 \ud655\uc778\ud574 \uc8fc\uc138\uc694."],reverify_mail:f["\uc7ac\ubc1c\uc1a1"],externalEmail_tooltip:f["\uc678\ubd80\uba54\uc77c\ud234\ud301"],homepage:a["\ud648\ud398\uc774\uc9c0"],messanger:a["\uba54\uc2e0\uc800"],selfInfo:a["\uc790\uae30\uc18c\uac1c"],memo:a["\uba54\ubaa8"],address:a["\uc8fc\uc18c"],location:a["\uc704\uce58"],birthday:a["\uc0dd\uc77c"],anniversary:a["\uae30\ub150\uc77c"],only_number:a["\uc22b\uc790\ub9cc \uc785\ub825\ud558\uc138\uc694."],lunar_calendar:u["(\uc74c)"],lunar_cal_desc:u["\uc74c\ub825\uc120\ud0dd"],select_desc:u["\uc120\ud0dd"],year:u["\ub144"],month:u["\ub2ec"],day:u["\ub0a0"]},el:"#content",delegateEvents:function(n){return this.undelegateEvents(),t.View.prototype.delegateEvents.call(this,n),this.$el.on("keyup.userconfig","#profileForm :text",e.proxy(this.checkLength,this)),this.$el.on("click.userconfig","#save",e.proxy(this.save,this)),this.$el.on("click.userconfig","#cancel",e.proxy(this.cancel,this)),this.$el.on("click.userconfig","span.txt_form",e.proxy(this.toggle,this)),this.$el.on("click.userconfig","span.tooltip",e.proxy(this.toggle,this)),this.$el.on("click",".btn_fn7",e.proxy(this.deletePhoto,this)),this.$el.on("click","#btn_changePassword",e.proxy(this.changePassword,this)),this.$el.on("blur","input[name='externalEmail']",e.proxy(this.checkEmailFormat,this)),this.$el.on("click","#externalEmailUnverified_form",e.proxy(this.checkEmailFormat,this)),this.$el.on("click","#btn_reVerifyMail",e.proxy(this.sendVerifyMail,this)),this},checkEmailFormat:function(t){var n=e(t.target),r=n.val();r==""&&n.attr("id")=="externalEmailUnverified_form"?r=this.model.get("externalEmailUnverified"):n.nextAll().hide();var i=!0;if(GO.session().email==r){c.externalEmail=!1,e("#myMail").show();return}c.externalEmail=i,e("#myMail").hide(),r&&(i=GO.util.checkEmailFormat(r)),i?n.next().next().hide():n.next().next().show(),c.externalEmail=i},checkLength:function(t){var n=e(t.target),r=e.goValidation.isCheckLength(0,n.attr("maxlength"),n.val());if(n.attr("name")=="externalEmail")return;r?(c[n.attr("name")]=r,n.next().hide()):(c[n.attr("name")]=!1,n.next().show())},checkValidation:function(){e.each(c,function(e,t){if(!t)throw Error("","")});var t=this.getNumbericNames();t.forEach(function(t){var n=e("#profileForm input[name*='"+t+"']");this.isNumbericCheck(n[0])},this)},undelegateEvents:function(){return t.View.prototype.undelegateEvents.call(this),this.$el.off(".userconfig"),this},initialize:function(){e(this.el).removeClass("go_home"),this.model=o.read(GO.session().id),this.displayConfigModel=r.read({admin:!1})},toggle:function(t){if(this.model.get("profileEditable")){var n=e(t.target).parents("td").find("span.txt_form");n.hide(),n.attr("id")&&(e("#verifyOk").hide(),e("#btn_reVerifyMail").hide(),e("#verifyMailDesc").hide()),n.next().show()}},render:function(){var e=this.displayConfigModel.toJSON(),t=function(){return e.blockPasswordChange};this.model.get("birthday")!=undefined&&this.model.get("birthday").length>0?this.model.set("birthdayDate",n.util.shortDate(this.model.get("birthday"))):this.model.set("birthdayDate",""),this.model.get("anniversary")!=undefined&&this.model.get("anniversary").length>0?this.model.set("anniversaryDate",n.util.shortDate(this.model.get("anniversary"))):this.model.set("anniversaryDate","");var r=this.model.toJSON(),i=r.externalEmailUnverified!=undefined&&r.externalEmailUnverified!=""?!0:!1,o=r.externalEmail!=undefined&&r.externalEmail!=""?!0:!1,u=!i&&!o?!0:!1,a=s({type:this.type,user:r,externalEmailIsEmpty:u,hasExternalEmailUnverified:i,hasExternalEmail:o,deptNames:this.__setDepartment(),blockPasswordChange:t,passwordSearchFeature:GO.config("passwordSearchFeature")});this.$el.html(a),this.datePickerInit(),r.profileEditable&&this.initFileUpload(),this.initSortable(),this.customFieldRender(this.model),this._renderBrowserTitle(),this.setBirthdaySelect()},setBirthdaySelect:function(){var t=1900,r=moment().format("YYYY"),s=1,o=12,u=1,a=31,f="",l="",c="",h=[];this.model.get("birthdayDate")!=undefined&&this.model.get("birthdayDate")!=""&&(h=this.model.get("birthdayDate").split("-"));for(i=r;i>=t;i--)parseInt(h[0])==i?f+="<option value="+i+" selected = 'selected'>"+i+this.type.year+"</option>":f+="<option value="+i+">"+i+this.type.year+"</option>";for(i=s;i<=o;i++)parseInt(h[1])==i?l+="<option value="+n.util.leftPad(i,2,"0")+" selected = 'selected'>"+i+this.type.month+"</option>":l+="<option value="+n.util.leftPad(i,2,"0")+">"+i+this.type.month+"</option>";for(i=u;i<=a;i++)parseInt(h[2])==i?c+="<option value="+n.util.leftPad(i,2,"0")+" selected = 'selected'>"+i+this.type.day+"</option>":c+="<option value="+n.util.leftPad(i,2,"0")+">"+i+this.type.day+"</option>";e("#birthdayYear").append(f),e("#birthdayMonth").append(l),e("#birthdayDay").append(c)},initSortable:function(){e("#dept_list").sortable({delay:100,items:"li",start:function(e,t){}})},_renderBrowserTitle:function(){e(document).attr("title",this.type.title+" - "+GO.config("webTitle"))},__setDepartment:function(){var e=this.model.toJSON().deptMembers,t="";if(e.length>0){t+=e[0].deptName;for(var n=1;n<e.length;n++)t+=" / "+e[n].deptName}return t},sendVerifyMail:function(){e.go(GO.contextRoot+"api/email/issue",{},{qryType:"GET",contentType:"application/json",responseFn:function(t){e.goMessage(u["\uba54\uc77c\uc744 \ubc1c\uc1a1\ud588\uc2b5\ub2c8\ub2e4."])},error:function(t){e.goMessage(u["\uc2e4\ud328\ud588\uc2b5\ub2c8\ub2e4."])}})},cancel:function(){return this.reload(),!1},save:function(){try{this.checkValidation()}catch(t){return"onlyNumber"==t.message?e.goMessage(this.type.only_number):e.goAlert(u["\uc785\ub825 \ud56d\ubaa9\uc744 \ud655\uc778\ud574 \uc8fc\uc138\uc694"]),!1}var n=this,r=this.profileBuilder();for(field in r){var i=r[field];i&&typeof i=="string"&&(r[field]=e.trim(i))}return this.model.attributes=e.extend({},this.model.attributes,r),this.model.save(null,{success:function(t){var r="";GO.config("orgSyncWaitMin")>0&&(r=GO.i18n(u["\uae30\ubcf8\uc815\ubcf4 \ud504\ub85c\ud544 \uc800\uc7a5 \uba54\uc2dc\uc9c0"],{term:GO.config("orgSyncWaitMin")})),e.goAlert(n.type.saveSuccess,r,e.proxy(n.reload,n)),e("#sessionThumbnail").attr("src",t.attributes.thumbSmall),GO.useMiniGnb==="true"&&e("#photo_thumb").attr("src",t.attributes.thumbSmall)},error:function(t,r){e.goAlert(n.type.saveFail)}}),!1},reload:function(){this.initialize(),this.render()},changePassword:function(){var e=window.open(GO.contextRoot+"app/my/password","Password","width=630,height=580 top="+(screen.height/2-200)+" left="+(screen.width/2-180));e.sessionStorage.setItem("doAdsExceptPage","true")},deletePhoto:function(){var t=e("#thumbnail_image");t.attr("data-filepath",""),t.attr("data-filename","sample"),t.attr("src",GO.contextRoot+"resources/images/photo_profile_large.jpg")},profileBuilder:function(){var t=e("#profileForm"),r={},i=e("#thumbnail_image"),s={filePath:i.attr("data-filepath").replace(GO.contextRoot,""),fileName:i.attr("data-filename"),hostId:i.attr("host-id")};s["filePath"]==""&&s["fileName"]==""&&(s=null),r.attPhoto=s,e(t.serializeArray()).each(function(e,t){t.name=="anniversary"&&t.value.length>0?r[t.name]=n.util.toISO8601(t.value):r[t.name]=t.value});var o=t.find("#birthdayYear").val(),u=t.find("#birthdayMonth").val(),a=t.find("#birthdayDay").val();if(o==undefined||o==""||u==""||a=="")!this.model||this.model.get("birthday")==""||o==""&&u==""&&a==""?(r.birthday="",r.lunarCal=!1):(r.birthday=this.model.get("birthday"),r.lunarCal=this.model.get("lunarCal"));else{var f=o+"-"+u+"-"+a;r.birthday=n.util.toISO8601(n.util.toMoment(f).add(1,"hours")),r.lunarCal=e("#lunarCal").is(":checked")}return r.deptMembers=[],e.each(e("#dept_list li"),function(){r.deptMembers.push({id:e(this).attr("data-id")})}),r},initFileUpload:function(){var t=this,n={el:"#swfupload-control",context_root:GO.contextRoot,button_text:"<span class='buttonText'>"+this.type.imageUpload+"</span>",button_style:"color:#ffffff; font-size:12px; text-align:center;",button_height:33,button_width:100,progressBarUse:!1,url:"api/file?GOSSOcookie="+e.cookie("GOSSOcookie")};(new l(n)).queue(function(e,t){}).start(function(t,n){console.log("uploadStart"),console.log(n);var r=new RegExp("(jpeg|jpg|gif|png|bmp)","gi"),i=n.type;if(!r.test(i))return e.goMessage(u["\ud3ec\uba67 \uacbd\uace0"]),!1;if(n.size>5242880)return e.goMessage(u["\ucca8\ubd80\ud30c\uc77c \uc6a9\ub7c9\uc740 5MB\uc774\ud558 \uc785\ub2c8\ub2e4."]),!1}).progress(function(e,t){}).success(function(t,n,r){if(GO.util.fileUploadErrorCheck(n))return e.goAlert(GO.util.serverMessage(n)),!1;if(GO.util.isFileSizeZero(n))return e.goAlert(GO.util.serverMessage(n)),!1;var i=n.data,s=i.fileName,o=i.filePath,u=i.hostId,a=i.thumbnail;console.log("fileName :: "+s),e("#thumbnail_image").attr("src",a).attr("data-filepath",o).attr("data-filename",s).attr("host-id",u)}).complete(function(e,t){console.info(t)}).error(function(e,t){console.info(t)})},datePickerInit:function(){var t=e("#birthday"),n=e("#anniversary");e.datepicker.setDefaults(e.datepicker.regional[GO.config("locale")]),t.datepicker({defaultDate:"+1w",dateFormat:"yy-mm-dd",changeMonth:!0,changeYear:!0,yearSuffix:"",yearRange:"c-80:c+10"}),n.datepicker({defaultDate:"+1w",dateFormat:"yy-mm-dd",changeMonth:!0,changeYear:!0,yearSuffix:"",yearRange:"c-80:c+10"})},customFieldRender:function(t){e.ajax({url:GO.contextRoot+"api/customprofile/display/config",type:"GET",success:function(n){var r="";e.each(n.data,function(e,n){var i=t.get(n.profileName)==undefined?"":t.get(n.profileName);r+='<tr><th><span class="title">'+n.name+"</span></th>"+"<td>"+i+"</td>"+"</tr>"}),e("#profileForm tr:nth-last-child(2)").after(r)}})},isNumbericCheck:function(t){if(!t||t.length==0)return;var n=t.value;if(!n||n.length==0)return;if(e.goValidation.isPhoneType(n))return;throw e(t).focus(),Error("onlyNumber","")},getNumbericNames:function(){var e=["repTel","directTel","mobileNo","fax","birthday","anniversary"];return e}});return{render:function(){var e=new h;return e.render()}}})}).call(this);