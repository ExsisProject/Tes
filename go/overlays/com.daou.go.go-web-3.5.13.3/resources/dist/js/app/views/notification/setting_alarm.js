define("views/notification/setting_alarm",function(require){var e=require("underscore"),t=require("backbone"),n=require("hogan"),r=require("app"),i=require("hgn!templates/notification/setting_alarm"),s=require("i18n!nls/commons"),o=require("i18n!nls/notification"),u=require("i18n!approval/nls/approval"),a={mail:s["\uba54\uc77c"],approval:s["\uc804\uc790\uacb0\uc7ac"],works:s.Works,todo:s["ToDO+"],task:s["\uc5c5\ubb34"],survey:s["\uc124\ubb38"],report:s["\ubcf4\uace0"],bbs:s["\uac8c\uc2dc\ud310"],community:s["\ucee4\ubba4\ub2c8\ud2f0"],calendar:s["\uce98\ub9b0\ub354"],addr:s["\uc8fc\uc18c\ub85d"],all:s["\uc804\uccb4\uba54\uc77c\ud568"],inbox:s["\ubc1b\uc740\uba54\uc77c\ud568"],approve:u["\uacb0\uc7ac"],comment:u["\uacb0\uc7ac\ub313\uae00"],receive:u["\uacb0\uc7ac\ub3c4\ucc29"],withdraw:u["\uacb0\uc7ac\ucde8\uc18c"],reject:u["\uacb0\uc7ac\ubc18\ub824"],complete:u["\uacb0\uc7ac\uc644\ub8cc"],docs:s["\ubb38\uc11c\uad00\ub9ac"]},f=t.Model.extend({url:function(){return"/api/user/push"}}),l=t.Model.extend({category:null,url:function(){return"/api/user/push/"+this.category},initialize:function(){},setCategory:function(e){return this.category=e,this}}),c=t.View.extend({initialize:function(){this.appModel=new f,this.eventModel=new l},events:{"click span[btn-push]":"pushSetting"},render:function(t){this.model=t,this.requestEventInfo("approval");var n=t.notiCategory,s;return this.$el.empty().append(i({lang:a,data:this.model})),e.each(n,function(t,n){var i=this.$el.find("li[data-appname='"+n+"']"),o=this.$el.closest("ul[submenu]").length>0,u=i.find("span[btn-push]"),a=u.closest("li[data-appname]").find("ul[submenu]");s=t==1?"ic_toggle_on":"ic_toggle_off",u.addClass(s);var f=u.hasClass("ic_toggle_on");n=="mail"&&t==1&&this.mailToggleSetting(this.model.pushMailBox),n=="approval"&&e.each(this.eventModel.attributes.notiEvent,function(e,t){s=e==1?"ic ic_toggle_on":"ic ic_toggle_off";var n=this.$el.find("li[data-eventname]").find("span[btn-push='"+t+"']");n.attr("class",s)},this),o||a.toggle(f),n=="bbs"&&(n="board"),r.isAvailableApp(n)||this.$el.find("li[data-appname="+n+"]").hide()},this),this.$el},requestEventInfo:function(e){this.eventModel.setCategory(e),this.eventModel.fetch()},mailToggleSetting:function(e,t){var n=this.$el.find("li[data-mail-status=all]").find("span[btn-push]"),r=this.$el.find("li[data-mail-status=inbox]").find("span[btn-push]");e=="all"?(n.attr("class","ic ic_toggle_on"),r.attr("class","ic ic_toggle_off")):e=="inbox"?(n.attr("class","ic ic_toggle_off"),r.attr("class","ic ic_toggle_on")):(n.attr("class","ic ic_toggle_off"),r.attr("class","ic ic_toggle_off"))},getSettingStatus:function(e){var t;return t=this.$el.find("span[btn-push='"+e+"']").hasClass("ic_toggle_on"),t},pushSetting:function(e){e.stopPropagation(),setTimeout(function(){},300);var t=$(e.target),n=t.closest("li[data-appname]").find("ul[submenu]"),r=t.closest("li[data-appname]").find("span[btn-push=mail]"),i=t.closest("ul[submenu]").length>0;t.toggleClass("ic_toggle_on"),t.toggleClass("ic_toggle_off");var s=t.hasClass("ic_toggle_on");i||n.toggle(s),r&&s?t.attr("btn-push")=="all"?this.mailToggleSetting("all"):t.attr("btn-push")=="inbox"?this.mailToggleSetting("inbox"):this.mailToggleSetting("all"):t.attr("btn-push")=="all"?this.mailToggleSetting("inbox"):t.attr("btn-push")=="inbox"&&this.mailToggleSetting("all");var o="none";this.getSettingStatus("mail")&&this.getSettingStatus("all")?o="all":this.getSettingStatus("mail")&&this.getSettingStatus("inbox")&&(o="inbox"),i&&t.closest("li[data-appname=approval]")?this.saveEventInfo(o):this.saveAppInfo(o)},saveAppInfo:function(e){console.log(this.model);var t={mail:this.getSettingStatus("mail"),task:this.getSettingStatus("task"),todo:this.getSettingStatus("todo"),approval:this.getSettingStatus("approval"),report:this.getSettingStatus("report"),community:this.getSettingStatus("community"),survey:this.getSettingStatus("survey"),core:!0,addr:!0,bbs:this.getSettingStatus("bbs"),works:this.getSettingStatus("works"),calendar:this.getSettingStatus("calendar"),docs:this.getSettingStatus("docs")};this.appModel.set({usePush:this.model.usePush,usePushSetting:this.model.usePushSetting,pushStartTime:this.model.pushStartTime,pushEndTime:this.model.pushEndTime,pushMailBox:e||"all",timeZone:this.model.timeZone,pushType:this.model.pushType,notiCategory:t}),this.appModel.save({},{type:"PUT",success:function(e,t){t.code=="200"&&$.goMessage(s["\uc800\uc7a5\ub418\uc5c8\uc2b5\ub2c8\ub2e4."])},error:function(e,t){var n=JSON.parse(t.responseText);$.goMessage(n.message)}})},saveEventInfo:function(e){var t={"document.arrived":this.getSettingStatus("document.arrived"),"document.commented":this.getSettingStatus("document.commented"),"document.completed":this.getSettingStatus("document.completed"),"document.reading.reader.added":!0,"document.received":this.getSettingStatus("document.arrived"),"document.received.returned":!0,"document.receiver.changed":!0,"document.referrence.reader.added":!0,"document.returned":this.getSettingStatus("document.returned"),"document.withdrew":this.getSettingStatus("document.withdrew")};this.appModel.set({usePush:this.eventModel.attributes.usePush,usePushSetting:this.eventModel.attributes.usePushSetting,pushStartTime:this.eventModel.attributes.pushStartTime,pushEndTime:this.eventModel.attributes.pushEndTime,pushMailBox:e||"all",timeZone:this.eventModel.attributes.timeZone,pushType:this.eventModel.attributes.pushType,categoryType:this.eventModel.attributes.categoryType,notiEvent:t}),console.log(this.appModel),this.appModel.save({},{type:"PUT",success:function(e,t){t.code=="200"&&$.goMessage(s["\uc800\uc7a5\ub418\uc5c8\uc2b5\ub2c8\ub2e4."])},error:function(e,t){var n=JSON.parse(t.responseText);$.goMessage(n.message)}})}});return c});