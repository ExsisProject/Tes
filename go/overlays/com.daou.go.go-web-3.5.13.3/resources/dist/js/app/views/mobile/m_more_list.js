define("views/mobile/m_more_list",function(require){var e=require("underscore"),t=require("backbone"),n=require("app"),r=t.View.extend({initialize:function(){},render:function(){},setFetchInfo:function(e,t){this.offScrollEvent(),this.onScrollEvent(),this.dataSet=e,this.collection=t,this.offset=n.config("mobileListOffset")||20,n.router.getUrl()===sessionStorage.getItem(n.constant("navigator","BASE-URL"))?(this.selectedDocId=sessionStorage.getItem(n.constant("navigator","SELECTED-DOC-ID")),this.pageNo=sessionStorage.getItem(n.constant("navigator","PAGE-NO"))):(this.selectedDocId=null,this.pageNo=0),this.pageNo>=1?(this.dataSet.offset=this.offset*(parseInt(this.pageNo)+1),this.pageNo=0):this.dataSet.offset=this.offset,sessionStorage.removeItem(n.constant("navigator","SELECTED-DOC-ID")),sessionStorage.removeItem(n.constant("navigator","PAGE-NO")),sessionStorage.setItem(n.constant("navigator","BASE-URL"),n.router.getUrl())},setRenderListFunc:function(e){this.renderListFunc=e},scrollToEl:function(){if(e.isNull(this.selectedDocId))return!1;var t=JSON.parse(this.selectedDocId),n=this.$el.find("a[data-list-id="+t.listId+"]").closest("li");if(n.length<1)return;var r=n.offset().top-$("#headerToolbar").outerHeight(!0);$("html").animate({scrollTop:r},10)},appendRenderAboveList:function(){if(!this.collection.page&&!this.collection.pageInfo)return;if(typeof this.collection.pageInfo=="function"){if(!this.collection.pageInfo().next)return!1;this.pageNo=this.collection.pageInfo().pageNo}else{if(this.collection.page.lastPage)return!1;this.pageNo=this.collection.page.page}n.util.appLoading(!0),this.dataSet.offset>this.offset&&(this.pageNo=this.dataSet.offset/this.offset-1,this.dataSet.offset=this.offset),this.pageNo=this.pageNo+1,this.dataFetch().done($.proxy(function(e){e.length!==0&&(this.renderListFunc.listFunc(e),n.util.appLoading(!1))},this))},dataFetch:function(){var e=this.collection.url().split("?")[0],t=$.Deferred();return this.dataSet.page=this.pageNo,this.collection.fetch({async:!1,url:e,data:this.dataSet,success:function(e){t.resolve(e)},error:function(e,t){n.util.linkToErrorPage(t)}}),t},setSessionInfo:function(t){var r=$(t.currentTarget),i=r.attr("data-list-id"),s=Math.floor(e.indexOf(e.map(r.closest("ul").find("a[data-list-id]"),function(e){return $(e).attr("data-list-id")}),i.toString())/this.offset),o={listId:i};sessionStorage.setItem(n.constant("navigator","PAGE-NO"),s),sessionStorage.setItem(n.constant("navigator","SELECTED-DOC-ID"),JSON.stringify(o))},detectScroll:function(e){var t=$(e.currentTarget).scrollTop();parseInt(t)>=$(document).height()-$(window).height()-96&&this.appendRenderAboveList();if(t===0){if((!this.pageNo||this.pageNo==0)&&this.dataSet["offset"]==20)return!1;this.dataSet.offset=20,this.selectedDocId=null,this.pageNo=0,n.util.appLoading(!0),this.dataFetch().done($.proxy(function(e){e.length!==0&&(this.$el.find('ul[data-type="list"]').empty(),this.renderListFunc.listFunc(e),n.util.appLoading(!1))},this))}},offScrollEvent:function(){$(window).off("scroll.renderNewPage")},onScrollEvent:function(){$(window).on("scroll.renderNewPage",$.proxy(this.detectScroll,this))}});return r});