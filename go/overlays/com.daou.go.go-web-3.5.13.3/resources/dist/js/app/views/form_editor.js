(function(){define(["backbone","app","jquery","hgn!templates/form_editor","hgn!admin/templates/form_editor","i18n!nls/commons","i18n!report/nls/report","jquery.go-popup","formeditor"],function(e,t,n,r,i,s,o){var u={button:"<a class='{pClass}' id='{targetId}' data-role='button'><span class='txt'>{label}</span></a>",adminButton:"<span class='{pClass}' id='{targetId}'>{label}</span>"},a={editerId:"editArea",lang:t.config("locale")||"ko",top:"20%"},f={form_title:o["\uc591\uc2dd \ud3b8\uc9d1\uae30"],preview:o["\ubbf8\ub9ac\ubcf4\uae30"],form_name:o["\uc591\uc2dd \uc81c\ubaa9"]},l=e.View.extend({initialize:function(){},getContent:function(){return n.goFormEditor.getContent(this.editerId)},getPopupContent:function(e){var t=this,s=e.isAdmin||!1,o={id:e.id||"",name:e.name,lang:f,editerId:this.editerId,actions:function(){if(e.buttons){var r=[];return n.each(e.buttons,function(e,i){var o=i.label,a=i.callback,f=s?u.adminButton:u.button,l=(new Date).getTime()+""+parseInt(Math.random(8)*1e3);pClass="",i.pClass?pClass=i.pClass:s?pClass="btn":pClass="btn_major",f=t.template(f,{label:o,targetId:l,pClass:pClass}),r.push(f),a&&n("body").on("click","#"+l,a)}),r.join("")}}};return s?i(o):r(o)},popupRender:function(e){this.editerId=e.editerId||a.editerId;var t=this,r=n.goPopup({pclass:"layer_normal layer_doc_editor",header:e.title||f.form_title,width:1e3,title:"",modal:!0,contents:t.getPopupContent(e)}),i="";return e.data&&(i=n.goFormEditor.spanToDSL(e.data)),n("#"+this.editerId).goFormEditor({lang:a.lang,editorValue:i}),e.isAdmin?r.css("height","650px"):r.css("height","600px"),r.reoffset(),r},render:function(){},template:function(e,t){return e.replace(/{(\w*)}/g,function(e,n){return t.hasOwnProperty(n)?t[n]:""})}},{preview:function(e,r,i){var s="<div class='doc_wrap' style='min-width:700px'>"+e+"</div>",o="formPreview",u=n.goPopup({header:f.preview,width:900,title:"",id:o,top:a.top,modal:!0,wrapTpl:['<div class="go_preview {pclass}" id="{pid}" data-id="{generateUUID}" data-close="false" style="display:none">','<header><h1>{header}</h1>{headerHtml}<a class="btn_layer_x" data-bypass title="{closeText}"><span class="ic"></span><span class="txt">',"</span></a></header>",'<div class="content">{pTitle}{message}{contents}</div>{buttonwrap}</div>'],contents:"<form id='previewForm' class='form_doc_editor ie9-scroll-fix'></form>",closeCallback:i||function(){n("#"+o).remove()}});u.addClass("go_renew"),u.find("div.content").css({"max-height":"500px",overflow:"auto"});var l={data:s,contextRoot:t.contextRoot,userId:t.session().id,userProfileApi:"api/user/profile",deptName:r};n("#previewForm").setTemplate(l),u.reoffset()}});return l})})();