(function(){define(["jquery","underscore","backbone","app","hgn!templates/mobile/header_toolbar","views/layouts/m_action_bar_default","i18n!nls/commons","GO.util"],function(t,n,r,i,s,o,u){var a=null,f=r.View.extend({el:"#headerToolbar",initialize:function(e){this.unbindEvent(),this.bindEvent()},unbindEvent:function(){this.$el.off("vclick.side","#btnSideMenu"),this.$el.off("vclick","#btnMobileHome"),this.$el.off("vclick","#btnHeaderCheckBox"),this.$el.off("vclick","#btnHeaderCheckCancel"),this.$el.off("vclick","#prevBtn"),this.$el.off("vclick","#closeBtn"),this.$el.off("vclick","a[data-trigger]"),this.$el.off("vclick","[name=document_action]"),this.$el.off("vclick","#more_btn"),this.$el.off("vclick","#commonWriteButton")},bindEvent:function(){this.$el.on("vclick.side","#btnSideMenu",t.proxy(this.showSideMenu,this)),this.$el.on("vclick","#btnMobileHome",t.proxy(this.mobileHome,this)),this.$el.on("vclick","#btnHeaderCheckBox",t.proxy(this.headerCheckBox,this)),this.$el.on("vclick","#btnHeaderCheckCancel",t.proxy(this.closeHeaderCheckBox,this)),this.$el.on("vclick","#prevBtn",t.proxy(this.prevAction,this)),this.$el.on("vclick","#closeBtn",t.proxy(this.layerClosed,this)),this.$el.on("vclick","a[data-trigger]",t.proxy(this.triggerExecute,this)),this.$el.on("vclick","[name=document_action]",t.proxy(this.actApprAction,this)),this.$el.on("vclick","#more_btn",t.proxy(this.moreLayout,this)),this.$el.on("change","select[select-trigger]",t.proxy(this.selecttriggerExecute,this)),this.$el.on("vclick","#commonWriteButton",t.proxy(this.moveWrite,this)),this.$el.on("vclick","#leftBtn",t.proxy(this.seeLeft,this)),this.$el.on("vclick","#rightBtn",t.proxy(this.seeRight,this))},render:function(e){this.options=e||{},this.$sideEl=t("#side"),this.$contentEl=t("#headerToolbar"),this.isList=this.options.isList||!1,this.isSideMenu=this.options.isSideMenu||!1,this.isHome=this.options.isHome||!1,this.title=this.options.title||"",this.isSearch=this.options.isSearch||!1,this.checkedActionMenu=this.options.checkedActionMenu||"",this.checkedTargetEl=this.options.checkedTargetEl||"",this.actionMenu=this.options.actionMenu||"",this.isPrev=this.options.isPrev||!1,this.prevCallback=this.options.prevCallback||"",this.isClose=this.options.isClose||!1,this.closeCallback=this.options.closeCallback||"",this.isWriteBtn=this.options.isWriteBtn||!1,this.writeBtnCallback=this.options.writeBtnCallback||"",this.isLeftBtn=this.options.isLeftBtn||!1,this.leftBtnCallback=this.options.leftBtnCallback||"",this.isRightBtn=this.options.isRightBtn||!1,this.rightBtnCallback=this.options.rightBtnCallback||"",this.$el=this.$el.empty(),this.$el.append(s({isList:this.isList,isSideMenu:this.isSideMenu,isHome:this.isHome,title:this.title,isSearch:this.isSearch,isPrev:this.isPrev,isClose:this.isClose,isWriteBtn:this.isWriteBtn,isLeftBtn:this.isLeftBtn,isRightBtn:this.isRightBtn,isMobileApp:i.config("isMobileApp")}));var n=this.actionMenu?this.actionMenu:this.checkedActionMenu,r=this.actionMenu?"div.optional":"#checkedActionMenu",u=this.actionMenu&&this.title!="";return this.actionBar=new o({useMenuList:n,hasTitle:u}),this.$el.find(r).append(this.actionBar.render().el),(this.isLeftBtn||this.isRightBtn)&&this.setLeftRightBtn(),this.$sideEl.css("visibility","hidden"),this},moveWrite:function(e){e.preventDefault(),e.stopPropagation(),this.$sideEl.is(":visible")&&i.EventEmitter.trigger("common","layout:showSideMenu",this),typeof this.writeBtnCallback=="function"&&this.writeBtnCallback()},blurEl:function(e){return t(e.currentTarget).blur().trigger("focusout"),!1},moreLayout:function(e){e.preventDefault(),e.stopPropagation();var n=t(e.currentTarget).parent().find("div.array_option");this.toggleMoreLayout(n)},toggleMoreLayout:function(e){e.is(":visible")?e.hide():e.show()},actApprAction:function(e){t(e.currentTarget).closest("div.array_option").hide(),i.EventEmitter.trigger("approval",t(e.currentTarget).attr("id"),this)},showSideMenu:function(e){return t(e.currentTarget).blur().trigger("focusout"),i.EventEmitter.trigger("common","layout:showSideMenu",this),e.stopPropagation(),t("div.ui-todocard-content").length>0&&t("div.ui-todocard-content a.btn-close").trigger("click"),!1},layerClosed:function(e){this.prevAction(e)},triggerExecute:function(e){var n=t(e.currentTarget);n.blur().trigger("focusout"),e.preventDefault(),e.stopPropagation(),i.EventEmitter.trigger("trigger-action",n.attr("data-trigger"),this)},selecttriggerExecute:function(e){var n=t(e.currentTarget);n.blur().trigger("focusout"),e.preventDefault(),e.stopPropagation(),i.EventEmitter.trigger("trigger-action",n.attr("select-trigger"),this)},prevAction:function(e){e.preventDefault(),e.stopPropagation();var n=t(e.currentTarget);n.blur().trigger("focusout"),this.routePrev(e)},existSearchResult:function(){return t("#searchResultWrap ul").length>0||t("#searchResultWrap dl").length>0?!0:!1},routePrev:function(e){t(e.currentTarget).blur(),e.stopPropagation();if(typeof this.closeCallback!="function"&&i.util.disagreeContentLoss())return;return this.existSearchResult()&&(t("#goSearch").show(),t("#searchResultWrap").show()),t("#startDate").length&&(t("#startDate").datepicker("hide"),t("#endDate").datepicker("hide")),t("#birthdayDate").length&&(t("#birthdayDate").blur(),t("#birthdayDate").datepicker("hide")),t("#anniversaryDate").length&&(t("#anniversaryDate").blur(),t("#anniversaryDate").datepicker("hide")),typeof this.prevCallback=="function"?this.prevCallback():typeof this.closeCallback=="function"?this.closeCallback():window.history.length==1?i.util.goHome():i.util.isAndroidApp()?window.GOMobile.pressBackKey():window.history.back(),!1},headerCheckBox:function(e){return e.stopPropagation(),t("#headerMenu").is(":visible")?(t("#checkedHeaderMenu").show(),t("#headerMenu").hide(),t("#headerToolbar").addClass("check_nav"),i.util.changeStatusBarColor(!0)):(t("#checkedHeaderMenu").hide(),t("#headerMenu").show(),t("#headerToolbar").removeClass("check_nav"),i.util.changeStatusBarColor(!1)),!1},closeHeaderCheckBox:function(e){e.stopPropagation(),e.preventDefault(),this.headerCheckBox(e),t(this.options.checkedTargetEl).prop("checked",!1)},mobileHome:function(e){e.stopPropagation();if(i.util.disagreeContentLoss())return;return i.router.navigate(i.contextRoot+"home",!0),!1},setTitle:function(e){this.$el.find("h2").html(e)},scrollToTop:function(){return e.stopPropagation(),i.EventEmitter.trigger("common","layout:scrollToTop",this),!1},setLeftRightBtn:function(){var e=this.$el.find("#appTitle");e.wrap('<div class="wrap_num_header"></div>'),e.before('<a id="leftBtn"><span class="btn btn_prev_type2"></span></a>'),e.after('<a id="rightBtn"><span class="btn btn_next_type2"></span></a>'),this.isLeftBtn||this.$el.find("#leftBtn span").addClass("btn_disable"),this.isRightBtn||this.$el.find("#rightBtn span").addClass("btn_disable")},seeLeft:function(e){e.preventDefault(),e.stopPropagation();if(!this.isLeftBtn)return;typeof this.leftBtnCallback=="function"&&this.leftBtnCallback()},seeRight:function(e){e.preventDefault(),e.stopPropagation();if(!this.isRightBtn)return;typeof this.rightBtnCallback=="function"&&this.rightBtnCallback()}},{render:function(e){return a==null&&(a=new f(e)),a.render(e)},checkBoxHeader:function(e){a.headerCheckBox(e)}});return f})}).call(this);