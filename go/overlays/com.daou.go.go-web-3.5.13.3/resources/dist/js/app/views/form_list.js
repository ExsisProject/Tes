(function(){define(["backbone","app","jquery","hgn!templates/app_form_list","i18n!nls/commons","i18n!report/nls/report","models/form","views/form_editor","jquery.go-popup","jquery.go-grid"],function(e,t,n,r,i,s,o,u){var a={button:"<a class='{pClass}' id={targetId} data-role='button'><span class='txt'>{label}</span></a>"},f={editerId:"editArea",lang:"ko",top:"30%"},l={department:s["\ubd80\uc11c"],report_name:s["\ubcf4\uace0\uc11c \uc81c\ubaa9"],selection:i["\uc120\ud0dd"],createdAt:i["\ub4f1\ub85d\uc77c"],form_name:s["\uc591\uc2dd \uc81c\ubaa9"],search:i["\uac80\uc0c9"],form_title:s["\uc591\uc2dd \ubd88\ub7ec\uc624\uae30"],empty_form:s["\uc591\uc2dd\uc774 \uc5c6\uc2b5\ub2c8\ub2e4."],preview:s["\ubbf8\ub9ac\ubcf4\uae30"],dept_form:s["\ubd80\uc11c \ubcf4\uace0\uc11c"],company_form:s["\uc804\uc0ac \uacf5\uc6a9 \uc591\uc2dd"]},c=e.View.extend({el:"#form_popup",events:{"a.btn_layer_x":"close"},initialize:function(e){this.options=e||{},this.oldContent=this.options.oldContent,this.type="department"},render:function(){},close:function(){n("#content").trigger("insert:deptForm",[this.oldContent]),this.popupEl.remove()},popupRender:function(){return this.popupEl=n.goPopup({pclass:"layer_recep_list layer_normal",header:l.form_title,width:750,top:f.top,id:"form_popup",title:"",modal:!0,wrapTpl:['<div class="go_department_form_table {pclass}" id="{pid}" data-id="{generateUUID}" data-close="false" style="display:none">','<header><h1>{header}</h1>{headerHtml}<a class="btn_layer_x" data-bypass title="{closeText}"><span class="ic"></span><span class="txt">',"</span></a></header>",'<div class="content">{pTitle}{message}{contents}</div>{buttonwrap}</div>'],contents:r({lang:l})}),this.popupEl.css("height","600px"),this.unbindEvent(),this.bindEvent(),this.popupEl.reoffset(),this},bindEvent:function(){this.popupEl.on("click.popup","a.btn_layer_x",n.proxy(this.close,this)),this.popupEl.on("click.popup","#formSelect input:radio",n.proxy(this.swapFormType,this)),this.popupEl.on("keydown.popup","div.search_wrap input",n.proxy(this.searchKeyboardEvent,this)),this.popupEl.on("click.popup","div.search_wrap span.btn_search2",n.proxy(this.search,this))},unbindEvent:function(){this.popupEl.off(".popup")},swapFormType:function(e){var t=n(e.currentTarget);this.type=t.val(),this.popupEl.find("div.search_wrap input").val(""),this.type=="department"?this.appFormRender():this.companyFormRender()},appFormRender:function(e){var r=this;this.deptTableId="#department_form_table",n("#company_form").hide(),this.deptFormList?this.deptFormList.tables.reload():this.deptFormList=n.goGrid({el:this.deptTableId,method:"GET",url:t.contextRoot+"api/report/form/department",lengthMenu:[10],dstroy:!0,defaultSorting:[[0,"asc"]],params:this.searchParams,emptyMessage:"<p class='data_null'> <span class='ic_data_type ic_no_data'></span><span class='txt'>"+l.empty_form+"</span>"+"</p>",columns:[{mData:"department",sWidth:"100px",sClass:"align_l",bSortable:!0,fnRender:function(e){var t=e.aData;return t.department.name}},{mData:"folder",sWidth:"100px",sClass:"align_l",bSortable:!0,fnRender:function(e){var t=e.aData;return t.folder.name}},{mData:null,sWidth:"100px",sClass:"",bSortable:!1,fnRender:function(e){var t=e.aData;return'<span class="form_preview" data-id="'+t.id+'"><a class="btn_fn7">'+l.preview+"</a></span>&nbsp;&nbsp;"+'<span class="form_select" data-id="'+t.id+'"><a class="btn_fn11">'+l.selection+"</a></span>"}}],fnDrawCallback:function(e,t,i){var s=n("#department_form").find("div.tool_bar div.custom_header"),a=s.find("#formSelect");a.length==0&&s.html(n("#formSelect").show()),n("#form_popup").find(r.deptTableId+" tr>td:nth-child(3) span.form_preview").css("cursor","pointer").click(function(e){var t=n(e.currentTarget),i=new o({url:"/api/report/form"});i.set({id:t.attr("data-id")}),i.fetch({async:!1}),r.popupEl.css("z-index",90),u.preview(i.get("content"),i.get("department").name),n("#formPreview .btn_layer_x").unbind("click"),n("#formPreview").find(".btn_layer_x").bind("click.gopop",function(){r.popupEl.css("z-index",99),n("#formPreview").remove()})}),n("#form_popup").find(r.deptTableId+" tr>td:nth-child(3) span.form_select").css("cursor","pointer").click(function(e){var t=n(e.currentTarget),i=new o({url:"/api/report/form"});i.set({id:t.attr("data-id")}),i.fetch({async:!1}),n("#content").trigger("insert:deptForm",[i.get("content")]),r.popupEl.remove()})}}),n("#department_form").show()},companyFormRender:function(){var e=this;this.companyTableId="#company_form_table",n("#department_form").hide(),this.companyFormList?this.companyFormList.tables.reload():this.companyFormList=n.goGrid({el:this.companyTableId,method:"GET",url:t.contextRoot+"api/report/form/company",lengthMenu:[10],defaultSorting:[[1,"asc"]],dstroy:!0,params:this.searchParams,sDomUse:!0,emptyMessage:"<p class='data_null'> <span class='ic_data_type ic_no_data'></span><span class='txt'>"+l.empty_form+"</span>"+"</p>",columns:[{mData:"createdAt",sWidth:"100px",sClass:"align_l",bSortable:!0,fnRender:function(e){var n=e.aData;return t.util.basicDate3(e.aData.createdAt)}},{mData:"name",sWidth:"100px",sClass:"align_l",bSortable:!0},{mData:null,sWidth:"100px",sClass:"",bSortable:!1,fnRender:function(e){var t=e.aData;return'<span class="form_preview" data-id="'+t.id+'"><a class="btn_fn7">'+l.preview+"</a></span>&nbsp;&nbsp;"+'<span class="form_select" data-id="'+t.id+'"><a class="btn_fn11">'+l.selection+"</a></span>"}}],fnDrawCallback:function(t,r,i){var s=n("#company_form").find("div.tool_bar div.custom_header"),a=s.find("#formSelect");a.length==0&&s.html(n("#formSelect").show()),n("#form_popup").find(e.companyTableId+" tr>td:nth-child(3) span.form_preview").css("cursor","pointer").click(function(t){var r=n(t.currentTarget),i=new o({url:"/api/report/form"});i.set({id:r.attr("data-id")}),i.fetch({async:!1}),e.popupEl.css("z-index",90),u.preview(i.get("content"),""),n("#formPreview .btn_layer_x").unbind("click"),n("#formPreview").find(".btn_layer_x").bind("click.gopop",function(){e.popupEl.css("z-index",99),n("#formPreview").remove()})}),n("#form_popup").find(e.companyTableId+" tr>td:nth-child(3) span.form_select").css("cursor","pointer").click(function(t){var r=n(t.currentTarget),i=new o({url:"/api/report/form"});i.set({id:r.attr("data-id")}),i.fetch({async:!1}),n("#content").trigger("insert:deptForm",[i.get("content")]),e.popupEl.remove()})}}),n("#company_form").show()},search:function(){var e="",r="";this.type=="department"?(e="#department_form",r=this.deptFormList.tables):(e="#company_form",r=this.companyFormList.tables);var s=n(e+' .table_search input[type="text"]'),o=s.val();if(o.length<2||o.length>64){n.goMessage(t.i18n(i["0\uc790\uc774\uc0c1 0\uc774\ud558 \uc785\ub825\ud574\uc57c\ud569\ub2c8\ub2e4."],{arg1:2,arg2:64})),s.focus();return}r.search(n(e+" .table_search select").val(),o,s,function(){return o&&n.isFunction(o.focus)&&o.trigger("focus"),n("body").append("<div id='popOverlay' class='overlay'></div>"),!0})},searchKeyboardEvent:function(e){e.keyCode==13&&this.search()}});return c})})();