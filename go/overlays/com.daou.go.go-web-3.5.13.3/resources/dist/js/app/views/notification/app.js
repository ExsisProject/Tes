define("views/notification/app",function(require){var e=require("underscore"),t=require("backbone"),n=require("moment"),r=require("app"),i=require("collections/notifications"),s=require("hgn!templates/notification/empty_list"),o=require("views/notification/header"),u=require("views/notification/list"),a=require("i18n!nls/commons"),f=t.View.extend({tagName:"div",className:"portlet_warp",container:null,config:{},defaultConfig:{category:"all",title:a["\ucd5c\uadfc \uc54c\ub9bc"],useDeleteAllButton:!1,pageCount:0,pageOffset:10,isPageLoading:!1,isLastPage:!1},initialize:function(t){this.options=t||{},e.bindAll(this,"deleteAll"),e.bindAll(this,"readAll"),this.config=e.extend({},this.defaultConfig,this.options.config),this.collection=new i([],{category:this.config.category,offset:this.config.pageOffset}),this._initScrollPagination()},_initScrollPagination:function(){var e="scroll.notificationPagination";$(window).unbind(e).bind(e,$.proxy(function(){if(this.config.isPageLoading)return;if(this.config.isLastPage)return;if($(window).scrollTop()!=$(document).height()-$(window).height())return;this._renderContent()},this))},render:function(){return this.$el.empty(),this.$el.html('<section class="list_item list_item_alarm"></section>'),this.container=this.$el.find("section"),this._renderHeader(),this._renderContent(),this._renderBrowserTitle(),this.initNewCount(),this.$el},initNewCount:function(){$.ajax({url:r.config("contextRoot")+"api/home/noti/new",type:"PUT",dataType:"json",success:function(e){$("#noti-count-badge").text(0),$("#noti-count-badge").css("display","none")}})},deleteAll:function(){function t(){$("#noti-count-badge").text(0),e.config.pageCount=0,e.render()}var e=this;$.goPopup({title:a["\uc804\uccb4 \uc54c\ub9bc \uc0ad\uc81c\ucc98\ub9ac"],message:a["\uc54c\ub9bc \uc804\uccb4\ub97c \uc0ad\uc81c\ud558\uc2dc\uaca0\uc2b5\ub2c8\uae4c?"],modal:!0,buttons:[{btext:a["\ud655\uc778"],btype:"confirm",callback:function(){var e=r.contextRoot+"api/my/noti",n="DELETE";$.ajax({type:n,async:!1,dataType:"application/json",url:e,complete:t})}},{btext:a["\ucde8\uc18c"],btype:"normal"}]})},readAll:function(){function t(){$("#noti-count-badge").text(0),e.config.pageCount=0,e.render()}var e=this;$.goPopup({title:a["\uc804\uccb4 \uc54c\ub9bc \uc77d\uc74c\ucc98\ub9ac"],message:a["\uc804\uccb4 \uc54c\ub9bc\uc744 \uc77d\uc74c\uc73c\ub85c \ud558\uc2dc\uaca0\uc2b5\ub2c8\uae4c?"],modal:!0,buttons:[{btext:a["\ud655\uc778"],btype:"confirm",callback:function(){var e=r.contextRoot+"api/my/noti/readall",n="GET";$.ajax({type:n,async:!1,dataType:"application/json",url:e,complete:t})}},{btext:a["\ucde8\uc18c"],btype:"normal"}]})},_renderBrowserTitle:function(){$(document).attr("title",this.config.title+" - "+r.config("webTitle"))},_renderHeader:function(){this.config.buttons=[],this.config.useReadAllNotieButton&&this.config.buttons.push({id:"ReadAll",icontype:"ic_read",label:a["\uc804\uccb4 \uc77d\uc74c"],action:this.readAll}),this.config.useDeleteAllButton&&this.config.buttons.push({id:"DeleteAll",icontype:"ic_del",label:a["\uc804\uccb4 \uc0ad\uc81c"],action:this.deleteAll});var e=new o({icontype:this.config.icontype,title:this.config.title,buttons:this.config.buttons,arrowButton:this.config.arrowButton});this.container.empty().append(e.render())},_renderContent:function(){this.config.isPageLoading=!0,this.collection.setPage(this.config.pageCount),this.collection.fetch().done($.proxy(function(){this.collection.isEmpty()?(this.config.pageCount==0&&this._renderEmptyView(),this.config.isLastPage=!0):(this.collection.length==this.config.pageOffset?this.config.pageCount++:this.config.isLastPage=!0,this._renderListView(),this.config.isPageLoading=!1)},this))},_renderEmptyView:function(){this.container.append(s({message:a["\ucd5c\uadfc \uc54c\ub9bc\uc774 \uc5c6\uc2b5\ub2c8\ub2e4."]})),(this.config.useDeleteAllButton||this.config.useReadAllNotieButton)&&$("#header_button").hide()},_renderListView:function(){var e=new u({collection:this.collection});this.container.append(e.render())}});return f});